"use strict";(()=>{var l=window,q=l.location,u=document,o="undefined"!=typeof chrome&&chrome||{},M=Object.defineProperty,s=(t=o.runtime.getURL("PATH/").replace("/PATH/","")).startsWith("safari-web-extension://"),t=!s&&t.startsWith("moz-extension://"),R=!s&&!t;function F(r){return new Promise(function(n,a){o.tabs.query(r,function(e){var t=o.runtime.lastError;t?a(t):Array.isArray(e)?s&&r&&r.url?(t=e.filter(function(e){return e.url}),n(t)):n(e):a(new Error("No array returned"))}),setTimeout(n,2e3)})}function N(r){var s,i,e,t;return r&&"string"==typeof r?(s=-1===r.indexOf("?"),i=-1===r.indexOf("#"),e=r.split("?")[0].split("#")[0]+"*",t={currentWindow:!0},(e=e)&&(t.url=e),F(t).then(function(e){for(var t=e.length-1;0<=t;t--){var n=e[t],a=n.url;if(a){if(a===r)return n;try{a=new URL(a)}catch(e){continue}if(s&&(a.search=""),i&&(a.hash=""),a.href===r)return n}}return null},function(){return null})):Promise.resolve(null)}function a(e,t){return new Promise(function(n,a){o.tabs.update(e,t,function(e){var t=o.runtime.lastError;t?a(t):n(e)})})}function H(s){return new Promise(function(n,a){function r(e){var t=e.message||"";"openerTabId"in s&&-1!==t.indexOf("openerTabId")?(delete s.openerTabId,n(H(s))):R&&-1!==t.indexOf("Saved groups are not editable")?n():a(e)}try{o.tabs.create(s,function(e){var t=o.runtime.lastError;t?r(t):n(e)})}catch(e){r(e)}})}function U(e){l.open(e,"_blank","noopener")}function W(t){try{l.top.location.href=t}catch(e){U(t)}}function z(t,e){var n=e||null;return a(n,{url:t}).catch(function(){if(!n)return F({active:!0,currentWindow:!0}).then(function(e){return e[0]},function(){return null}).then(function(e){if(e.id)return z(t,e.id);W(t)});W(t)})}function G(e,t,n,r){var a={url:e};return!1===t&&n&&(a.active=!1),r&&(a.openerTabId=r.id,a.index=r.index+1),H(a).then(function(e){var t,n,a;return t=e,n=r,o.tabs.group&&t&&n&&(a=n.groupId,t.groupId!==a)&&o.tabs.group({groupId:a,tabIds:t.id},function(){o.runtime.lastError||(t.groupId=a)}),e},function(){U(e)})}function V(e,t,n,a,r){if(!e)return Promise.reject(new Error("Missing URL"));if(!n){var s;if(t)return s=Boolean(a&&a.incognito),i={incognito:s,url:e},new Promise(function(n,a){o.windows.create(i,function(e){var t=o.runtime.lastError;t?a(t):n(e)})}).catch(function(){return G(e,t,n,a)});if(!1===n)return z(e,r)}var i;return G(e,t,n,a)}t=!0;try{var e=o.i18n.getMessage("@@ui_locale");"string"==typeof e&&"und"!==e&&(j=e.replace("_","-"))}catch(e){t=!1}if(!(e=j))try{var n=o.runtime.getManifest().default_locale;"string"==typeof n&&(e=n.replace("_","-"))}catch(e){}var r,J={},K=J,Q={add:function(){return ie},contains:function(){return ae},getDefaultServices:function(){return de},getLastUsed:function(){return ce},getLastUsedNonToolsPage:function(){return le},init:function(){return ne},onChange:function(){return oe},remove:function(){return re},replace:function(){return se},set:function(){return y},setLastUsed:function(){return ue}};for(r in Q)M(K,r,{get:Q[r],enumerable:!0});var X,i,c,d,Y,f,p=[],g=[],m=[],h=["search","maps","translate","news","youtube","gmail","calendar","drive","keep","tasks"],Z=["youtube","ytstudio","mybusiness","photos","contacts","save","myaccount","passwords","myactivity","myadcenter"],$=["accountchooser","contentblocking","customize","missingpermissions","newtab","portal","pagestateupdate","notifications","removedialog"],ee=["applauncher","extensionsettings"],v={"keep-pro":"keep",keeplite:"keep",shoppinglist:"keep",music:"ytmusic",playmusic:"ytmusic",tiltbrushsketches:"poly",vrblocks:"poly",trackedflightprices:"flights",destinations:"googletravel",flightsandhotels:"googletravel",flightshotels:"googletravel",packages:"googletravel",travelpackages:"googletravel",trips:"googletravel",vacations:"googletravel",googlepay:"gpay",payments:"paymentscenter",chromeapps:"browserapps",chromebookmarks:"browserbookmarks",chrometopsites:"browsertopsites",adwords:"ads",appmaker:"script",calendarlite:"calendar",duo:"meet",express:"shopping",gmaillite:"gmail",gplus:"currents",hangouts:"chat",publicalerts:"covid19",shortlists:"save",webmastertools:"searchconsole"},b={};function te(a){p=[],g=[],Object.keys(b).forEach(function(e){var t=-1!==a.indexOf(e),n=b[e].hidden;(!n||t&&"unused"===n)&&(t?p:g).push(e)}),p=p.sort(function(e,t){return a.indexOf(e)<a.indexOf(t)?-1:1}),g=g.sort(function(e,t){return b[e].label<b[t].label?-1:1})}function ne(e){m=[],f=new Promise(function(e){Y=e}),b=e.servicesDatabase||{};var t=browserStorage.sync.get(["bm_pref__portal__services"]).then(function(e){return e.bm_pref__portal__services}),t=[browserStorage.local.getItem("bm_pref__portal__lastused"),t,e.servicesDatabaseRequest,e.accountRequest],e=Promise.all(t).then(function(e){var t=v[e[0]]||e[0],n=e[1]||h;if(b=e[2],X=e[3],d=t||n[0],i=c=d,X.pageId)return-1===(p=Object.keys(b).filter(function(e){return b[e].brandAccount&&!b[e].hidden}).sort(function(e,t){return Z.indexOf(e)-Z.indexOf(t)})).indexOf(i)&&(i="aboutme"),null;Array.isArray(n)?(e=n.join(" "),Object.keys(v).forEach(function(e){var t=n.indexOf(e);-1!==t&&(n[t]=v[e])}),te(n),e!==p.join(" ")&&browserStorage.sync.setItem("bm_pref__portal__services",p)):(i=t||h[0],te(h))});Y(e)}function y(e){te(e),browserStorage.sync.setItem("bm_pref__portal__services",p),m.forEach(function(e){e(p,g)})}function ae(e){return-1!==p.indexOf(e)}function re(e,t){t=t||p.indexOf(e);-1!==t&&(p.splice(t,1),y(p))}function se(e,t){var n,a;-1!==g.indexOf(t)&&-1!==(n=p.indexOf(e))&&(-1===(a=p.indexOf(t))?(p[n]=t,y(p)):re(e,a))}function ie(e){y(p.concat(e))}function oe(e){var t;m.push(e),t=e,f.then(function(){t(p,g)})}function ce(){return f.then(function(){return 0<p.length?{serviceId:c}:{serviceId:"customize",sessionParameters:{welcome:!0}}})}function le(){return d}function ue(e){i=e,-1===$.indexOf(e)&&(c=e,-1===ee.indexOf(e))&&(d=e),browserStorage.local.setItem("bm_pref__portal__lastused",c)}function de(){return h}var w,P,_,k,fe,I,pe,ge,me,j=new URLSearchParams(q.search),x=u.documentElement,he=!1,L=!1,O=[],S=j.get("page"),E=j.get("environment"),ve=((n=q.pathname).endsWith("/popup.html")?E="popup":n.endsWith("/options.html")&&(S="extensionsettings",E="options"),!1),A=cjgApis.account.missingAccountData,be="";function B(e){return A=e,be=cjgFrontend.urls.createWizPath(A),A}var D=cjgApis.session.init(B).then(B);function C(e,t,n){return V(e,t,n).then(function(){"popup"!==E||n&&!1===t||l.close()})}function ye(t,e,n){return t?e||n?C(t,e,n):"newtab"===E?a(null,{active:!0,url:t}).catch(function(){return C(t)}):N(t).then(function(e){return e?a(e.id,{active:!0}).catch(function(){return C(t)}):C(t)}):Promise.resolve()}var we,T=(()=>{var o=[],c=S||"search",l=!1;return{navigate:function e(t,n){if(n&&n.softInit){if(l)return}else l=!0;var a,r,s=_[t];function i(){t===c&&s.onPageDisplayHandler(n||{})}s&&s.linkOnly?e(s.pageId,s.pageParameters||n):(s&&-1===O.indexOf(t)&&ke(t),a=c=t,r=P.querySelector(":scope > .selected"),a!==(r&&r.dataset.id||null)&&(a=P.querySelector(':scope > [data-id="'+a+'"]'),r&&r.classList.remove("selected"),a)&&a.classList.add("selected"),o.forEach(function(e){e(c)}),S||ue(c),s&&(s.onPageDisplayHandler?i():s.lastPageDisplayCallback=i))},onChange:function(e){o.push(e),e(c)},restore:function(){l=!1,o=[]}}})();function Pe(e){var t=(e=e||{}).serviceData||{},n={onNewTab:!0,portal:cjBasics.navigator.isFirefoxMobile,notifications:S&&t.showNotifications&&A.validSession,accountchooser:S&&A.validSession,signin:S&&!A.validSession};return{missingGooglePermission:ve,instanceParameters:e.instanceParameters||{},darkMode:t.preferDarkMode?!he:L,setOnPageDisplayHandler:e.setOnPageDisplayHandler,account:A,wizPath:be,openTab:ye,requirePage:_e,loadPage:ke,environment:E,standaloneService:S,pageManager:T,userServices:J,servicesDatabase:_,ogbFeatures:n}}function _e(e){var t=_[e]||{},n=t.loadPromise;if(!n){var a="/pages/"+e+"/index.js",r=[k,I,D],s=("portal"!==e&&r.push(fe,me,ge),t.preload||[]),i=(t.pageId&&t.pageId!==e?s.push(t.pageId):r.push(cjBasics.resources.loadScript(a)),t.extraCss&&r.push(cjBasics.resources.loadStyle("/pages/"+e+"/index.css")),t.dnsPrefetch);if(i)for(var o=0;o<i.length;o++){var c=u.createElement("link");c.rel="dns-prefetch",c.href=i[o],u.head.appendChild(c)}Array.isArray(s)&&l.requestIdleCallback&&l.requestIdleCallback(function(){s.forEach(_e)},{timeout:2e3}),Array.isArray(t.dependencies)&&t.dependencies.forEach(function(e){r.push(_e(e))}),n=Promise.all(r),t.loadPromise=n}return n}function ke(e){O.push(e);var t=_[e],n=t.pageId||e,a=t.pageParameters,r=!cjBasics.webRequest.getWrifSupported()&&t.wrifFallbackPageId,r=(r&&(_[r]?n=r:(n="pagestateupdate",a={productId:e})),cjBasics.navigator.isFirefox&&t.firefoxFallbackPageId),r=_[n=r?r:n];ve&&!r.noGooglePermissionNeeded?(n="pagestateupdate",a={productId:e,missingPermissions:!0}):"valid"===r.requireSignin&&cjBasics.webRequest.getHasFirefoxContentBlocking()?(n="pagestateupdate",a={productId:e,contentBlocking:!0}):!A.validSession&&r.requireSignin?(n="pagestateupdate",a={productId:e,signinRequired:!0}):!A.pageId||t.brandAccount&&r.brandAccount||(n="pagestateupdate",a={productId:e,brandAccountUnsupported:!0});r=Pe({serviceData:t,setOnPageDisplayHandler:function(e){t.onPageDisplayHandler=e,setTimeout(function(){"function"==typeof t.lastPageDisplayCallback&&t.lastPageDisplayCallback(),t.lastPageDisplayCallback=null})},instanceParameters:a}),a=cjce.createElement("bm-app",{bmApis:r,pageId:n});a.dataset.id=e,P.appendChild(a)}function Ie(){var r=matchMedia("(prefers-color-scheme: dark)");(L=r.matches)&&x.classList.add("bm-style-flag--dark"),r.addEventListener&&r.addEventListener("change",function(){L=r.matches,x.classList.toggle("bm-style-flag--dark",L);for(var e=P.children,t=0;t<e.length;t++){var n=e[t],a=n.dataset.id;_[a].preferDarkMode||n.classList.toggle("cjmd--dark",L)}})}function je(){u.body.textContent="",(w=u.createElement("div")).className="bm-ele-main",u.body.appendChild(w),pe=browserStorage.sync.getItem("bm_pref__main__language").then(function(e){return cjBasics.lang.overwriteLanguage(e)}),k=pe.then(function(){return _=cjBasics.pages,Object.keys(_).forEach(function(e){var t=_[e].labelI18n;t&&(_[e].label=cjBasics.lang.i18n(t,_[e].label))}),cjBasics.geo.isUsaCheck()&&(_.movies.color=!0,_.movies.iconName="tv",_.movies.label=cjBasics.lang.i18n("cj_i18n_06402","Google TV")),_}),fe=cjBasics.webRequest.restoreWrifSupported(),I="options"===E?(Ie(),Promise.resolve()):browserStorage.sync.getItem("bm_pref__main__theme").then(function(e){if(e&&"auto"!==e){if("light"===e)he=!0,x.classList.add("bm-style-flag--light");else{if("dark"!==e)return;L=!0,x.classList.add("bm-style-flag--dark")}e=u.querySelector('meta[name="color-scheme"]');e&&(e.content=L?"dark":"light")}else Ie()}),0<O.length&&(O=[],T.restore(),cjgApis.session.resetCache(),D=cjgApis.session.init(B).then(B)),"newtab"===E&&(u.title="New Tab for Google™"),ne({accountRequest:D,servicesDatabaseRequest:k}),o.runtime.onMessage.addListener(function(e){e=e&&e.method;e&&"reloadAllInstances"===e&&cjBasics.reloadSelf()});var t,n,e=!S&&"sidebar"!==E&&!cjBasics.navigator.isFirefoxMobile;e&&((t=u.createElement("div")).className="bm-ele-mainportal",n="portal","newtab"===E?(n="newtab",t.classList.add("bm-ele-mainportal--newtab")):t.classList.add("bm-ele-mainportal--sideportal"),w.appendChild(t),Promise.all([k,I]).then(function(){var e=_[n],e=cjce.createElement("bm-app",{pageId:n,bmApis:Pe({serviceData:e})});t.appendChild(e)})),e=e,(P=u.createElement("div")).className="bm-ele-mainwindow","newtab"===E?P.classList.add("bm-ele-mainwindow--newtab"):e&&P.classList.add("bm-ele-mainwindow--sideportal"),w.appendChild(P),setTimeout(function(){x.classList.add("bm-style-flag--loaded")},10),me=("object"!=typeof o.permissions?Promise.resolve(!0):new Promise(function(e){o.permissions.contains({origins:["https://*.google.com/*","https://*.google.com/cjg-auth/*"]},e)})).then(function(e){ve=!e}),ge=cjBasics.navigator.getCurrentTabIdRequest(),Promise.all([k,D,fe,me,I]).then(function(){S?T.navigate(S,{softInit:!0}):ce().then(function(e){var t=e.sessionParameters||{};t.softInit=!0,T.navigate(e.serviceId,t)})},function(e){})}S&&"sidebar"!==E&&x.classList.add("bm-style-flag--singlepage"),cjBasics.navigator.isFirefox&&x.classList.add("bm-style-flag--firefox"),"popup"!==E&&"options"!==E||(x.classList.add("bm-style-flag--no-cloak"),"popup"===E?(cjBasics.navigator.isMac&&setTimeout(function(){o.runtime.sendMessage({method:"closeAuthPopup"})},100),(cjBasics.navigator.isFirefox||cjBasics.navigator.isMac&&!cjBasics.navigator.isSafari)&&(we=1600,function e(){x.classList.add("bm-style-flag--macfix"),setTimeout(function(){x.classList.remove("bm-style-flag--macfix")},20),0<we&&(setTimeout(e,500),we-=500)}())):"options"===E&&x.classList.add("bm-style-flag--options")),u.documentElement.dir=t&&o.i18n.getMessage("@@bidi_dir")||"ltr",u.documentElement.lang=e,"popup"===E||"options"===E?"complete"===u.readyState?setTimeout(je,100):l.addEventListener("load",function(){setTimeout(je,100)}):je()})();