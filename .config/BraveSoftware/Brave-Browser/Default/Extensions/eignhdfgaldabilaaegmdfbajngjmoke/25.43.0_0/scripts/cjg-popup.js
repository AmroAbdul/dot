"use strict";(()=>{var a=window,s=a.location,i=document,o="undefined"!=typeof chrome&&chrome||{},c=o.runtime.getURL("PATH/").replace("/PATH/",""),r=c.startsWith("safari-web-extension://"),e=(r||c.startsWith("moz-extension://"),!0);try{var t=o.i18n.getMessage("@@ui_locale");"string"==typeof t&&"und"!==t&&(n=t.replace("_","-"))}catch(t){e=!1}var u,n,g=n;if(!g)try{var l=o.runtime.getManifest().default_locale;"string"==typeof l&&(g=l.replace("_","-"))}catch(t){}function h(){u||o.runtime.sendMessage({method:"closeAuthPopup"})}function p(){o.runtime.sendMessage({method:"reloadAllInstances"},h)}function m(t){cjgApis.session.changeAccount(t,!0).then(p,p),setTimeout(p,1e3)}function f(e){cjgApis.account.list({listPages:!1}).then(function(t){Array.isArray(t)?0!==t.length&&t[0].validSession?m(((t,e)=>{for(var n=t[0],a=0;a<t.length;a++){var s=t[a];if(s.validSession){if(s.authuser===e)return s;s.authuser>n.authuser&&(n=s)}}return n})(t,e)):m(cjgApis.account.noAccountData):m(cjgApis.account.missingAccountData)})}function d(t,e){Promise.all([cjgApis.account.list({targetAuthuser:e}),cjgApis.auth.getTokenInfo(t)]).then(function(t){t=((t,e)=>{for(var n=0;n<t.length;n++){var a=t[n];if(a.obfuscatedId===e)return a}return null})(t[0],t[1].sub);t?m(t):p()},p)}function A(){var t=i.documentElement;t.dir=e&&o.i18n.getMessage("@@bidi_dir")||"ltr",t.lang=g,(i.body||t).textContent=""}function v(){var t=s.href,e=(t.match(/authuser=(\d)/)||[])[1]||null,t=(t.split("access_token=")[1]||"").split("&")[0],n=(s.hash||"").split("--macpopup"),n=(u=n[1]&&cjBasics.navigator.isMac&&!cjBasics.navigator.isOpera,n[0].replace("#","")),a=s.pathname.split("/")[3];"signin"===a||"signin"===n?f(e):("signout"!==a&&"signout"!==n||m(cjgApis.account.noAccountData),t?d(t,e):(u?p:h)())}function j(){var t,e,n=s.href;o.runtime.sendMessage({data:n,method:"cjgAuthUrl"}),r&&(t="cjgAuthUrl",a.parent.postMessage({bm_method:t,bm_request:e,bm_value:n},c))}A(),t=s.origin,n=s.pathname,(l=a.top===a.self)&&t===c&&"/views/cjg-popup.html"===n?v():"https://www.google.com"===t&&(t=n.match(/^\/(?:images\/)?cjg-(auth|apis)\/(.+)/))&&(n=t[1])&&(r||t[2]===(()=>{var t;try{t=o.i18n.getMessage("@@extension_id")}catch(t){}return t||c.split("://")[1]})())&&(l?v():"auth"===n&&(t=>{var e,n;return!(a.top===a.self||i.documentElement instanceof SVGSVGElement)&&("object"!=typeof(e=s.ancestorOrigins)?1:(n=r?c.toLowerCase():c,1===e.length?e[0]===n:t&&2===e.length&&e[1]===n&&!e[0].endsWith(".google.com")))})()&&j())})();