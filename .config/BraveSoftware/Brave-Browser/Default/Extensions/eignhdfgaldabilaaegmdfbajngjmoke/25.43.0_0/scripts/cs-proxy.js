"use strict";(()=>{var s=window,r=s.location,o=document,n="undefined"!=typeof chrome&&chrome||{},a=n.runtime.getURL("PATH/").replace("/PATH/",""),i=a.startsWith("safari-web-extension://"),c=!i&&a.startsWith("moz-extension://");function u(e,t,n){s.parent.postMessage({bm_method:e,bm_request:n,bm_value:t},a)}var e,t,d,m,h=null;function l(e,t,n){u("cjgOriginRequest",{success:n,response:t},e)}e=function(e){var t;return("https://www.google.com"===e||"https://ogs.google.com"===e||"https://news.google.com"===e)&&(e=r.pathname,i?e.startsWith("/images/cjg-proxy/"):(t=(()=>{var e;try{e=n.i18n.getMessage("@@extension_id")}catch(e){}return e||a.split("://")[1]})(),e.startsWith("/images/cjg-proxy/"+t)))},t=function(){var n;n=function(e,t,n){var o,a,i,c;"cjgOriginRequest"===e&&(e=JSON.parse(s.atob(t)),o=e.url,i=(a=e.parameters||{}).fetchAs||"text",c=a.method||"GET",("undefined"==typeof XMLHttpRequest?fetch(o,{method:c,body:a.body}).then(function(e){var t=e.status;return t<200||299<t?e.text().then(function(e){throw{status:t,body:e}}):"json"===i?e.json():e.text()}):new Promise(function(n,s){var r=new XMLHttpRequest;return r.open(c,o),r.addEventListener("load",function(){var e=r.status,t=r.responseText;if(e<200||299<e)s({status:e,body:t});else if("json"===i)try{n(JSON.parse(t))}catch(e){s(e)}else"xml"===i||"html"===i?(h=h||new DOMParser,n(h.parseFromString(t,"xml"===i?"text/xml":"text/html"))):n(t)}),r.addEventListener("error",function(){var e=r.status,t=r.responseText;s({status:e,body:t})}),a.credentials&&"include"===a.credentials&&(r.withCredentials=!0),a.headers&&Object.keys(a.headers).forEach(function(e){var t=a.headers[e];null!=t&&r.setRequestHeader(e,t)}),"json"===i&&r.overrideMimeType("application/json"),r.send(a.body),r})).then(function(e){l(n,e,!0)},function(e){l(n,e,!1)}))},s.addEventListener("message",function(e){var t;if(i){if(!e.origin.toLowerCase().startsWith("safari-web-extension://"))return}else if(!(e.origin===a))return;(e.isTrusted||c)&&e.source===s.parent&&(t=(e=e.data||{}).bm_method)&&n(t,e.bm_value,e.bm_request)}),u("cjgProxyReady")},(e=>{var t,n;return!(s.top===s.self||o.documentElement instanceof SVGSVGElement)&&("object"!=typeof(t=r.ancestorOrigins)?1:(n=i?a.toLowerCase():a,1===t.length?t[0]===n:e&&2===t.length&&t[1]===n&&!t[0].endsWith(".google.com")))})(d)&&(m=(m=(d=r.search).match(/[&?]bm_cid=([\da-z-]{2,25})(?:&|$)/))&&m[1],e(origin,m,d))&&(m&&(o.documentElement.dataset.bmCid=m),t())})();