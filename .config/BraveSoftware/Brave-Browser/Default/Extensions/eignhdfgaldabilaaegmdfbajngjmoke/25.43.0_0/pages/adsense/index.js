"use strict";(()=>{var D=document;cjce.registerTemplate("bm-p-adsense",function(e,s){var a,n,t,c,i,r,l,_={},o=(new Date).getDate(),d=["https://www.googleapis.com/auth/adsense.readonly"],m="https://adsense.googleapis.com/v2/",u=window.atob("QUl6YVN5QXBVTVBOVFlnbW55UVUwcGdSSXdEcm42OHdGbXZ2bVp3");function p(e,a){e=e,a=a,n="https://www.google.com/adsense/new/",t=s.account.authuser,r?n+="u/"+t+"/"+r+"/":"0"!==t&&((a=a||{}).authuser=t),n+=e||"home";var n,t=a?cjBasics.urlParams.attach(n,a):n;s.openTab(t)}function g(e){var a=new Date;return a.setDate(o-e),{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()}}function j(e){if(e&&e.body&&e.body.indexOf("noAdSenseAccount"))return v();var a;"not_authorized"===e.cjg_error&&(a=e,f({message:cjBasics.lang.i18n("cj_i18n_00235","Before you can use this page, you need to give access to load your Google AdSense data"),actionLabel:cjBasics.lang.i18n("cj_i18n_01916","Continue with Google"),actionG:!0,action:function(){cjgApis.auth.requestPermissions(s.account,a.cjg_missing_scopes)}}))}function h(e,a){a=a||{},a.prettyPrint="false",e=cjBasics.urlParams.attach(m+e,a);return cjgApis.request(e,{fetchAs:"json"},{account:s.account,pa:"optional",key:u,requiredScopes:d}).catch(j)}var b,y=[{label:cjBasics.lang.i18n("cj_i18n_00225","Today so far"),reportId:"today",range:"TODAY",start:"today",end:"today"},{label:cjBasics.lang.i18n("cj_i18n_00226","Yesterday"),reportId:"yesterday",range:"YESTERDAY",start:"today-1d",end:"today-1d",previous:{label:cjBasics.lang.i18n("cj_i18n_00227","vs same day last week"),start:"today-8d",end:"today-8d",startDate:g(8),endDate:g(8)}},{label:cjBasics.lang.i18n("cj_i18n_01181","Last 28 days").replace("28","7"),range:"LAST_7_DAYS",start:"today-7d",end:"today-1d",reportId:"last7days",previous:{label:cjBasics.lang.i18n("cj_i18n_01180","vs previous 28 days").replace("28","7"),start:"today-14d",end:"today-8d",startDate:g(14),endDate:g(8)}},{label:cjBasics.lang.i18n("cj_i18n_00228","This month so far"),reportId:"thismonth",range:"MONTH_TO_DATE",start:"startOfMonth",end:"today",previous:{label:cjBasics.lang.i18n("cj_i18n_01179","vs same period last year"),start:"startOfMonth-1y",end:"today-1y",startDate:g(365+o),endDate:g(365)}}];function f(e){c.cjceSetLoading(!1),i||(i=!0,t&&(t.hidden=!0),a.textContent="",e=cjce.createElement("bm-fulldialog",{inline:!0,bmApis:s,onNewTab:function(){p("home")},lockup:{label:cjBasics.lang.i18n("cj_i18n_00179","AdSense")},iconName:"ad_sense",message:e.message,actionLabel:e.actionLabel,actionG:e.actionG,action:e.action}),a.appendChild(e))}function v(){f({message:cjBasics.lang.i18n("cj_i18n_00233","There is no AdSense account attached to this Google account"),actionLabel:cjBasics.lang.i18n("cj_i18n_01543","Switch account"),action:function(){s.pageManager.navigate("accountchooser")}})}function w(e){var a,n,t;if(r)return a="accounts/"+r+"/reports:generate",n=cjBasics.lang.getCurrent().replace("-","_"),n={dateRange:e.range,languageCode:n,fields:"*",metrics:"ESTIMATED_EARNINGS"},(t=e.range)?n.dateRange=t:(n["startDate.year"]=e.startDate.year,n["startDate.month"]=e.startDate.month,n["startDate.day"]=e.startDate.day,n["endDate.year"]=e.endDate.year,n["endDate.month"]=e.endDate.month,n["endDate.day"]=e.endDate.day),h(a,n).then(function(e){var a=e.headers[0];return{revenue:(e=(e=e.totals)||[],Array.isArray(e)?e[0]||0:(e=e.cells,Array.isArray(e)&&0!==e.length&&(e=e[0])&&e.value||0)),currency:a.currencyCode||a.currency}});throw v(),new Error("No AdSense Account")}function A(){var a="bm_cache_v33__adsense__mainaccount",n=h("accounts",{fields:"accounts/name"}).then(function(e){var e=e.accounts||e.items;return Array.isArray(e)?((e=e[0]||{}).name||e.id||"").replace("accounts/",""):null}).then(function(e){return(r=e)?cjgApis.cache.setItem(s.account,a,e):v(),e});return cjgApis.cache.getItem(s.account,a).then(function(e){if(!r&&e&&"string"==typeof e)return r=e}).then(function(e){if(!e)return n})}function B(r,o,d){return c=r,i=function(e){var a,n,t,c,i=e[0].revenue,s=e[0].currency;o.textContent=i+" "+s,r.previous&&e[1]&&(t=e[1].revenue,e[1].currency===s)&&(a=0<(a=e=i-t)?"up":a<0?"down":"neutral",n=D.createDocumentFragment(),(c=cjce.createElement("cjmd-icon",{name:"down"==a?"__mdi:trending_down":"__mdi:trending_up"})).classList.add("bm-p-adsense-card__changeicon"),n.appendChild(c),c=i,i=(0<(c=Math.round(1e3*(c/t-1))/10)?"+":"")+c+"%",t=e,c=s,(e=(t=(Math.round(100*Math.abs(t))/100).toString()).split(".")[1])?e.length<2&&(t+="0"):t+=".00",s=t+" "+c+" ("+i+")",(e=D.createElement("span")).className="bm-p-adsense-card__changetext",e.textContent=s,n.appendChild(e),d.textContent="",d.dataset.type=a,d.appendChild(n))},new Promise(function(a,e){var n="bm_cache_v33__adsense__reports__"+c.start+"__"+c.end,t=!1;cjgApis.cache.getItem(s.account,n).then(function(e){!t&&e&&i(e)}),l.then(function(){_[n]=!0;var e=[w(c)];return c.previous&&e.push(w(c.previous)),Promise.all(e)}).then(function(e){t=!0,i(e),cjgApis.cache.setItem(s.account,n,e),a()},function(){})});var c,i}function C(){var s,r;i||(s=D.createDocumentFragment(),r=[],y.forEach(function(e){a=e,(e=cjce.createElement("cjmd-card",{interactive:!0,withPadding:!0,onClick:function(){p("reporting",{rt:"d",uim:"d",d:a.reportId,ct:a.reportCt||null})}})).classList.add("bm-p-adsense-card"),(i=D.createElement("div")).className="bm-p-adsense-card__date",i.textContent=a.label,e.appendChild(i),(c=D.createElement("div")).className="bm-p-adsense-card__amount",c.textContent=cjBasics.lang.i18n("cj_i18n_00325","Loading…"),e.appendChild(c),a.previous&&((t=D.createElement("div")).className="cjmd-secondarytext bm-p-adsense-card__comparison",t.textContent=a.previous.label,i.appendChild(t),(n=D.createElement("div")).className="bm-p-adsense-card__change",n.textContent="⁣",e.appendChild(n)),e.cjceAdsenseLoadContent=function(){return B(a,c,n)};var a,n,t,c,i=e;r.push(i.cjceAdsenseLoadContent()),s.appendChild(i)}),Promise.all(r).then(function(){c.cjceSetLoading(!1)}),a.textContent="",a.appendChild(s))}c=cjce.createElement("bm-ogb",{drawer:!0,loading:!0,serviceIcon:"ad_sense",serviceLabel:cjBasics.lang.i18n("cj_i18n_00179","AdSense"),pageLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),bmApis:s,onNewTab:function(){p("home")}}),e.appendChild(c),n=c.cjceDrawerEl,t=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:refresh",label:cjBasics.lang.i18n("cj_i18n_01182","Refresh reports"),onClick:function(){c.cjceSetLoading(!0),cjgApis.cache.remove(s.account,Object.keys(_)).then(C)}}),c.cjceAppendChild(t),b=cjce.createElement("bm-navlist",{compact:!0,items:[{id:"home",iconName:"__mdi:home",label:cjBasics.lang.i18n("cj_i18n_00291","Home"),newTabUrl:"home"},{iconName:"__mdi:picture_in_picture",label:cjBasics.lang.i18n("cj_i18n_01530","Ads"),newTabUrl:"myads/sites",adsenseParams:{product:"SELF_SERVICE_CONTENT_ADS"},external:!0},{iconName:"__mdi:admob",label:cjBasics.lang.i18n("cj_i18n_00580","AdMob"),newTabUrl:"main/adMob",adsenseParams:{product:"SELF_SERVICE_G_MOB_DISPLAY_APP"},external:!0},{iconName:"__mdi:video_youtube",label:cjBasics.lang.i18n("cj_i18n_07506","AdSense for YouTube"),newTabUrl:"youtube",external:!0},{iconName:"__mdi:web",label:cjBasics.lang.i18n("cj_i18n_01150","Sites"),newTabUrl:"sites/list",external:!0,divider:!0},{iconName:"__mdi:admin_panel_settings",label:cjBasics.lang.i18n("cj_i18n_07006","Privacy & messaging"),newTabUrl:"privacymessaging",external:!0},{iconName:"__mdi:block",label:cjBasics.lang.i18n("cj_i18n_07507","Brand safety"),newTabUrl:"brand-safety",external:!0},{iconName:"__mdi:assessment",label:cjBasics.lang.i18n("cj_i18n_01152","Reports"),newTabUrl:"reporting",adsenseParams:{rt:"d",uim:"d"},external:!0},{iconName:"__mdi:trending_up",label:cjBasics.lang.i18n("cj_i18n_01153","Optimalization"),newTabUrl:"opt/opportunities",external:!0},{iconName:"__mdi:policy",label:cjBasics.lang.i18n("cj_i18n_07005","Policy centre"),newTabUrl:"policy-center",external:!0,divider:!0},{iconName:"__mdi:payments",label:cjBasics.lang.i18n("cj_i18n_01154","Payments"),newTabUrl:"payments",external:!0},{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),newTabUrl:"settings",external:!0}],selectedId:"home",bmApis:s,onNewTab:function(e,a){p(a.newTabUrl,a.adsenseParams)}}),n.appendChild(b),a=cjce.createElement("cjmd-container",{scrollable:"noScroll",shadow:"transparentOnScroll"}),e.appendChild(a),l=A(),C()})})();