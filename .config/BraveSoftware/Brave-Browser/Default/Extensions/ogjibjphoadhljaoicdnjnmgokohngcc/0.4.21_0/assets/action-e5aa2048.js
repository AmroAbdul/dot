var hu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _c(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function wc(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var o=Function.bind.apply(e,a);return new o}return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}),r}var Sc=function(){function t(e,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Rc=Pc(["",""],["",""]);function Pc(t,e){return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function Ac(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var ye=function(){function t(){for(var e=this,r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];return Ac(this,t),this.tag=function(o){for(var i=arguments.length,s=Array(i>1?i-1:0),u=1;u<i;u++)s[u-1]=arguments[u];return typeof o=="function"?e.interimTag.bind(e,o):typeof o=="string"?e.transformEndResult(o):(o=o.map(e.transformString.bind(e)),e.transformEndResult(o.reduce(e.processSubstitutions.bind(e,s))))},n.length>0&&Array.isArray(n[0])&&(n=n[0]),this.transformers=n.map(function(o){return typeof o=="function"?o():o}),this.tag}return Sc(t,[{key:"interimTag",value:function(r,n){for(var a=arguments.length,o=Array(a>2?a-2:0),i=2;i<a;i++)o[i-2]=arguments[i];return this.tag(Rc,r.apply(void 0,[n].concat(o)))}},{key:"processSubstitutions",value:function(r,n,a){var o=this.transformSubstitution(r.shift(),n);return"".concat(n,o,a)}},{key:"transformString",value:function(r){var n=function(o,i){return i.onString?i.onString(o):o};return this.transformers.reduce(n,r)}},{key:"transformSubstitution",value:function(r,n){var a=function(i,s){return s.onSubstitution?s.onSubstitution(i,n):i};return this.transformers.reduce(a,r)}},{key:"transformEndResult",value:function(r){var n=function(o,i){return i.onEndResult?i.onEndResult(o):o};return this.transformers.reduce(n,r)}}]),t}(),me=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return{onEndResult:function(n){if(e==="")return n.trim();if(e=e.toLowerCase(),e==="start"||e==="left")return n.replace(/^\s*/,"");if(e==="end"||e==="right")return n.replace(/\s*$/,"");throw new Error("Side not supported: "+e)}}};function Ec(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}else return Array.from(t)}var it=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"initial";return{onEndResult:function(n){if(e==="initial"){var a=n.match(/^[^\S\n]*(?=\S)/gm),o=a&&Math.min.apply(Math,Ec(a.map(function(s){return s.length})));if(o){var i=new RegExp("^.{"+o+"}","gm");return n.replace(i,"")}return n}if(e==="all")return n.replace(/^[^\S\n]+/gm,"");throw new Error("Unknown type: "+e)}}},Yt=function(e,r){return{onEndResult:function(a){if(e==null||r==null)throw new Error("replaceResultTransformer requires at least 2 arguments.");return a.replace(e,r)}}},Ot=function(e,r){return{onSubstitution:function(a,o){if(e==null||r==null)throw new Error("replaceSubstitutionTransformer requires at least 2 arguments.");return a==null?a:a.toString().replace(e,r)}}},Cc={separator:"",conjunction:"",serial:!1},Fe=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Cc;return{onSubstitution:function(n,a){if(Array.isArray(n)){var o=n.length,i=e.separator,s=e.conjunction,u=e.serial,c=a.match(/(\n?[^\S\n]+)$/);if(c?n=n.join(i+c[1]):n=n.join(i+" "),s&&o>1){var h=n.lastIndexOf(i);n=n.slice(0,h)+(u?i:"")+" "+s+n.slice(h+1)}}return n}}},pu=function(e){return{onSubstitution:function(n,a){if(e!=null&&typeof e=="string")typeof n=="string"&&n.includes(e)&&(n=n.split(e));else throw new Error("You need to specify a string character to split by.");return n}}},ls=function(e){return e!=null&&!Number.isNaN(e)&&typeof e!="boolean"},Tc=function(){return{onSubstitution:function(r){return Array.isArray(r)?r.filter(ls):ls(r)?r:""}}};new ye(Fe({separator:","}),it,me);new ye(Fe({separator:",",conjunction:"and"}),it,me);new ye(Fe({separator:",",conjunction:"or"}),it,me);var Oc=new ye(pu(`
`),Tc,Fe,it,me);new ye(pu(`
`),Fe,it,me,Ot(/&/g,"&amp;"),Ot(/</g,"&lt;"),Ot(/>/g,"&gt;"),Ot(/"/g,"&quot;"),Ot(/'/g,"&#x27;"),Ot(/`/g,"&#x60;"));var lm=new ye(Yt(/(?:\n(?:\s*))+/g," "),me),cm=new ye(Yt(/(?:\n\s*)/g,""),me);new ye(Fe({separator:","}),Yt(/(?:\s+)/g," "),me);new ye(Fe({separator:",",conjunction:"or"}),Yt(/(?:\s+)/g," "),me);new ye(Fe({separator:",",conjunction:"and"}),Yt(/(?:\s+)/g," "),me);new ye(Fe,it,me);new ye(Fe,Yt(/(?:\s+)/g," "),me);new ye(it,me);new ye(it("all"),me);function kc(t){let e,r,n,a,o,i,s;return u(),{feed:c,reset:u};function u(){e=!0,r="",n=0,a=-1,o=void 0,i=void 0,s=""}function c(y){r=r?r+y:y,e&&xc(r)&&(r=r.slice(yu.length)),e=!1;const d=r.length;let m=0,v=!1;for(;m<d;){v&&(r[m]===`
`&&++m,v=!1);let f=-1,b=a,p;for(let g=n;f<0&&g<d;++g)p=r[g],p===":"&&b<0?b=g-m:p==="\r"?(v=!0,f=g-m):p===`
`&&(f=g-m);if(f<0){n=d-m,a=b;break}else n=0,a=-1;h(r,m,b,f),m+=f+1}m===d?r="":m>0&&(r=r.slice(m))}function h(y,d,m,v){if(v===0){s.length>0&&(t({type:"event",id:o,event:i||void 0,data:s.slice(0,-1)}),s="",o=void 0),i=void 0;return}const f=m<0,b=y.slice(d,d+(f?v:m));let p=0;f?p=v:y[d+m+1]===" "?p=m+2:p=m+1;const g=d+p,_=v-p,A=y.slice(g,g+_).toString();if(b==="data")s+=A?"".concat(A,`
`):`
`;else if(b==="event")i=A;else if(b==="id"&&!A.includes("\0"))o=A;else if(b==="retry"){const R=parseInt(A,10);Number.isNaN(R)||t({type:"reconnect-interval",value:R})}}}const yu=[239,187,191];function xc(t){return yu.every((e,r)=>t.charCodeAt(r)===e)}let Ln;const Ic=new Uint8Array(16);function Fc(){if(!Ln&&(Ln=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ln))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ln(Ic)}const ae=[];for(let t=0;t<256;++t)ae.push((t+256).toString(16).slice(1));function Bc(t,e=0){return(ae[t[e+0]]+ae[t[e+1]]+ae[t[e+2]]+ae[t[e+3]]+"-"+ae[t[e+4]]+ae[t[e+5]]+"-"+ae[t[e+6]]+ae[t[e+7]]+"-"+ae[t[e+8]]+ae[t[e+9]]+"-"+ae[t[e+10]]+ae[t[e+11]]+ae[t[e+12]]+ae[t[e+13]]+ae[t[e+14]]+ae[t[e+15]]).toLowerCase()}const Mc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),cs={randomUUID:Mc};function Oo(t,e,r){if(cs.randomUUID&&!e&&!t)return cs.randomUUID();t=t||{};const n=t.random||(t.rng||Fc)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let a=0;a<16;++a)e[r+a]=n[a];return e}return Bc(n)}function jc(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function Wc(t,e,r,n,a){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?a.call(t,r):a?a.value=r:e.set(t,r),r}var oa;function Dc(t,e=!1){return window.__TAURI_INTERNALS__.transformCallback(t,e)}async function Q(t,e={},r){return window.__TAURI_INTERNALS__.invoke(t,e,r)}class fm{get rid(){return jc(this,oa,"f")}constructor(e){oa.set(this,void 0),Wc(this,oa,e,"f")}async close(){return Q("plugin:resources|close",{rid:this.rid})}}oa=new WeakMap;var fs;(function(t){t.WINDOW_RESIZED="tauri://resize",t.WINDOW_MOVED="tauri://move",t.WINDOW_CLOSE_REQUESTED="tauri://close-requested",t.WINDOW_DESTROYED="tauri://destroyed",t.WINDOW_FOCUS="tauri://focus",t.WINDOW_BLUR="tauri://blur",t.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",t.WINDOW_THEME_CHANGED="tauri://theme-changed",t.WINDOW_CREATED="tauri://window-created",t.WEBVIEW_CREATED="tauri://webview-created",t.DRAG="tauri://drag",t.DROP="tauri://drop",t.DROP_OVER="tauri://drop-over",t.DROP_CANCELLED="tauri://drag-cancelled"})(fs||(fs={}));async function mu(t,e){await Q("plugin:event|unlisten",{event:t,eventId:e})}async function _a(t,e,r){var n;const a=typeof r?.target=="string"?{kind:"AnyLabel",label:r.target}:(n=r?.target)!==null&&n!==void 0?n:{kind:"Any"};return Q("plugin:event|listen",{event:t,target:a,handler:Dc(e)}).then(o=>async()=>mu(t,o))}async function Nc(t,e,r){return _a(t,n=>{e(n),mu(t,n.id).catch(()=>{})},r)}async function bu(t,e){await Q("plugin:event|emit",{event:t,payload:e})}async function dm(t,e,r){await Q("plugin:event|emit_to",{target:typeof t=="string"?{kind:"AnyLabel",label:t}:t,event:e,payload:r})}var gu={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;function e(f){try{return JSON.parse(f)}catch(b){const[p,g]=r(f,b);return e.lastParseReminding=g,e.onExtraToken&&g.length>0&&e.onExtraToken(f,p,g),p}}t.parse=e,function(f){f.onExtraToken=(b,p,g)=>{console.error("parsed json with extra tokens:",{text:b,data:p,reminding:g})}}(e=t.parse||(t.parse={}));function r(f,b){const p=n[f[0]];if(!p)throw console.error(`no parser registered for ${JSON.stringify(f[0])}:`,{s:f}),b;return p(f,b)}const n={};function a(f){return f.trimLeft()}n[" "]=o,n["\r"]=o,n[`
`]=o,n["	"]=o;function o(f,b){return f=a(f),r(f,b)}n["["]=i;function i(f,b){f=f.substr(1);const p=[];for(f=a(f);f.length>0;){if(f[0]==="]"){f=f.substr(1);break}const g=r(f,b);p.push(g[0]),f=g[1],f=a(f),f[0]===","&&(f=f.substring(1),f=a(f))}return[p,f]}for(const f of"0123456789.-".slice())n[f]=s;function s(f){for(let b=0;b<f.length;b++){const p=f[b];if(n[p]===s)continue;const g=f.substring(0,b);return f=f.substring(b),[u(g),f]}return[u(f),""]}function u(f){if(f==="-")return-0;const b=+f;return Number.isNaN(b)?f:b}n['"']=c;function c(f){for(let b=1;b<f.length;b++){const p=f[b];if(p==="\\"){b++;continue}if(p==='"'){const g=f.substring(0,b+1);return f=f.substring(b+1),[JSON.parse(g),f]}}return[JSON.parse(f+'"'),""]}n["{"]=h;function h(f,b){f=f.substr(1);const p={};for(f=a(f);f.length>0;){if(f[0]==="}"){f=f.substr(1);break}const g=r(f,b),_=g[0];if(f=g[1],f=a(f),f[0]!==":"){p[_]=void 0;break}if(f=f.substr(1),f=a(f),f.length===0){p[_]=void 0;break}const A=r(f,b);p[_]=A[0],f=A[1],f=a(f),f[0]===","&&(f=f.substr(1),f=a(f))}return[p,f]}n.t=y;function y(f,b){return v(f,"true",!0,b)}n.f=d;function d(f,b){return v(f,"false",!1,b)}n.n=m;function m(f,b){return v(f,"null",null,b)}function v(f,b,p,g){for(let _=b.length;_>=1;_--)if(f.startsWith(b.slice(0,_)))return[p,f.slice(_)];{const _=JSON.stringify(f.slice(0,b.length));throw console.error(`unknown token starting with ${_}:`,{s:f}),g}}})(gu);const fi={async getConfigContent(){return await Q("get_config_content")},async getUpdateResult(){return await Q("get_update_result")},async clearConfigCache(){await Q("clear_config_cache")},async showTranslatorWindowCommand(){await Q("show_translator_window_command")},async showTranslatorWindowWithSelectedTextCommand(){await Q("show_translator_window_with_selected_text_command")},async showActionManagerWindow(){await Q("show_action_manager_window")},async getTranslatorWindowAlwaysOnTop(){return await Q("get_translator_window_always_on_top")},async fetchStream(t,e,r){try{return{status:"ok",data:await Q("fetch_stream",{id:t,url:e,optionsStr:r})}}catch(n){if(n instanceof Error)throw n;return{status:"error",error:n}}},async writingCommand(){await Q("writing_command")},async writeToInput(t){await Q("write_to_input",{text:t})},async finishWriting(){await Q("finish_writing")},async detectLang(t){return await Q("detect_lang",{text:t})},async screenshot(t,e){await Q("screenshot",{x:t,y:e})},async hideTranslatorWindow(){await Q("hide_translator_window")},async startOcr(){await Q("start_ocr")},async finishOcr(){await Q("finish_ocr")},async cutImage(t,e,r,n){await Q("cut_image",{left:t,top:e,width:r,height:n})}};Lc({checkUpdateEvent:"check-update-event",checkUpdateResultEvent:"check-update-result-event",pinnedFromWindowEvent:"pinned-from-window-event",pinnedFromTrayEvent:"pinned-from-tray-event",configUpdatedEvent:"config-updated-event"});function Lc(t){return new Proxy({},{get:(e,r)=>{const n=t[r];return new Proxy(()=>{},{apply:(a,o,[i])=>({listen:s=>i.listen(n,s),once:s=>i.once(n,s),emit:s=>i.emit(n,s)}),get:(a,o)=>{switch(o){case"listen":return i=>_a(n,i);case"once":return i=>Nc(n,i);case"emit":return i=>bu(n,i)}}})}})}const hm=Object.freeze(Object.defineProperty({__proto__:null,commands:fi},Symbol.toStringTag,{value:"Module"})),vu="https://api.openai.com",qc="/v1/chat/completions",_u="OpenAI",zc="gpt-3.5-turbo",ds="https://chat.openai.com/api/auth/session",hs="https://chat.openai.com/backend-api",Uc="https://generativelanguage.googleapis.com",$c=!1,Kc="zh-Hans",Gc="en",Hc=!0,Vc=!1,Jc="en",Yc={automaticCheckForUpdates:1,apiKeys:1,apiURL:1,apiURLPath:1,apiModel:1,provider:1,chatgptModel:1,azureAPIKeys:1,azureAPIURL:1,azureAPIURLPath:1,azureAPIModel:1,azMaxWords:1,enableMica:1,enableBackgroundBlur:1,miniMaxGroupID:1,miniMaxAPIKey:1,miniMaxAPIModel:1,moonshotAPIKey:1,moonshotAPIModel:1,geminiAPIURL:1,geminiAPIKey:1,geminiAPIModel:1,autoTranslate:1,defaultTranslateMode:1,defaultTargetLanguage:1,alwaysShowIcons:1,hotkey:1,displayWindowHotkey:1,ocrHotkey:1,writingTargetLanguage:1,writingHotkey:1,writingNewlineHotkey:1,themeType:1,i18n:1,tts:1,restorePreviousPosition:1,runAtStartup:1,selectInputElementsText:1,readSelectedWordsFromInputElementsText:1,disableCollectingStatistics:1,allowUsingClipboardWhenSelectedTextNotAvailable:1,pinned:1,autoCollect:1,hideTheIconInTheDock:1,languageDetectionEngine:1,autoHideWindowWhenOutOfFocus:1,proxy:1,customModelName:1,ollamaAPIURL:1,ollamaAPIModel:1,ollamaCustomModelName:1,ollamaModelLifetimeInMemory:1,groqAPIURL:1,groqAPIURLPath:1,groqAPIModel:1,groqAPIKey:1,groqCustomModelName:1,claudeAPIURL:1,claudeAPIURLPath:1,claudeAPIModel:1,claudeAPIKey:1,claudeCustomModelName:1,kimiRefreshToken:1,kimiAccessToken:1,chatglmAccessToken:1,chatglmRefreshToken:1,cohereAPIKey:1,cohereAPIModel:1,deepSeekAPIKey:1,deepSeekAPIModel:1,fontSize:1,uiFontSize:1,iconSize:1};async function xe(){const r=await(await Su()).storage.sync.get(Object.keys(Yc));return r.apiKeys||(r.apiKeys=""),r.apiURL||(r.apiURL=vu),r.apiURLPath||(r.apiURLPath=qc),r.apiModel||(r.apiModel=zc),r.provider||(r.provider=_u),(r.autoTranslate===void 0||r.autoTranslate===null)&&(r.autoTranslate=$c),r.defaultTranslateMode||(r.defaultTranslateMode="translate"),r.defaultTargetLanguage||(r.defaultTargetLanguage=Kc),r.writingTargetLanguage||(r.writingTargetLanguage=Gc),(r.alwaysShowIcons===void 0||r.alwaysShowIcons===null)&&(r.alwaysShowIcons=!za()),r.i18n||(r.i18n=Jc),r.disableCollectingStatistics||(r.disableCollectingStatistics=!1),(r.selectInputElementsText===void 0||r.selectInputElementsText===null)&&(r.selectInputElementsText=Hc),(r.readSelectedWordsFromInputElementsText===void 0||r.readSelectedWordsFromInputElementsText===null)&&(r.readSelectedWordsFromInputElementsText=Vc),r.themeType||(r.themeType="followTheSystem"),r.provider==="Azure"&&(r.azureAPIKeys||(r.azureAPIKeys=r.apiKeys),r.azureAPIURL||(r.azureAPIURL=r.apiURL),r.azureAPIURLPath||(r.azureAPIURLPath=r.apiURLPath),r.azureAPIModel||(r.azureAPIModel=r.apiModel)),r.provider==="ChatGPT"&&(r.chatgptModel||(r.chatgptModel=r.apiModel)),(r.automaticCheckForUpdates===void 0||r.automaticCheckForUpdates===null)&&(r.automaticCheckForUpdates=!0),(r.enableBackgroundBlur===void 0||r.enableBackgroundBlur===null)&&(r.enableMica!==void 0&&r.enableMica!==null?r.enableBackgroundBlur=r.enableMica:r.enableBackgroundBlur=!1),r.languageDetectionEngine||(r.languageDetectionEngine="baidu"),r.proxy||(r.proxy={enabled:!1,protocol:"HTTP",server:"127.0.0.1",port:"1080",basicAuth:{username:"",password:""},noProxy:"localhost,127.0.0.1"}),r.ollamaAPIURL||(r.ollamaAPIURL="http://127.0.0.1:11434"),r.miniMaxAPIModel||(r.miniMaxAPIModel="abab5.5-chat"),r.groqAPIURL||(r.groqAPIURL="https://api.groq.com"),r.groqAPIURLPath||(r.groqAPIURLPath="/openai/v1/chat/completions"),r.claudeAPIURL||(r.claudeAPIURL="https://api.anthropic.com"),r.claudeAPIURLPath||(r.claudeAPIURLPath="/v1/messages"),(r.geminiAPIURL===void 0||r.geminiAPIURL===null)&&(r.geminiAPIURL=Uc),(r.fontSize===void 0||r.fontSize===null)&&(r.fontSize=15),(r.uiFontSize===void 0||r.uiFontSize===null)&&(r.uiFontSize=12),(r.iconSize===void 0||r.iconSize===null)&&(r.iconSize=15),(r.azMaxWords===void 0||r.azMaxWords===null)&&(r.azMaxWords=1024),(r.hideTheIconInTheDock===void 0||r.hideTheIconInTheDock===null)&&(r.hideTheIconInTheDock=!0),(r.ollamaModelLifetimeInMemory===void 0||r.ollamaModelLifetimeInMemory===null)&&(r.ollamaModelLifetimeInMemory="5m"),r}async function wu(t){await(await Su()).storage.sync.set(t)}async function Su(){return Ru()?(await import("./electron-917d39d0.js")).electronBrowser:za()?(await Promise.resolve().then(()=>jd)).tauriBrowser:di()?(await Promise.resolve().then(()=>$d)).userscriptBrowser:(await import("./browser-polyfill-83de79d0.js").then(t=>t.b)).default}const Ru=()=>navigator.userAgent.indexOf("Electron")>=0,za=()=>typeof window>"u"?!1:window.__TAURI__!==void 0,pm=()=>typeof window>"u"?!1:window.__IS_OT_BROWSER_EXTENSION_OPTIONS__!==void 0,ym=()=>typeof window>"u"?!1:window.__IS_OT_BROWSER_EXTENSION_CONTENT_SCRIPT__!==void 0,gr=()=>Ru()||za(),di=()=>typeof GM_info<"u",mm=async()=>{const t=await xe();return t.themeType==="followTheSystem"?window.matchMedia("(prefers-color-scheme: dark)").matches:t.themeType==="dark"},Qc=()=>/firefox/i.test(navigator.userAgent),Xc=async()=>{const t=await xe();return t.provider===_u&&t.apiURL===vu},bm=async()=>(await xe()).provider==="ChatGPT"||await Xc();async function gm(t,e){if(!e.length)return;t+=".csv";const r=Object.keys(e[0]);let n="";for(const o of r)n+=o+",";n+=`\r
`;const a=function(o){let i="";for(const s of r)s==="updatedAt"?i+=`	${o[s]},`:i+=`"${o[s]}",`;return i+`\r
`};for(let o=0;o<e.length;o++)n+=a(e[o]);if(gr()){const{BaseDirectory:o,writeTextFile:i}=await Promise.resolve().then(()=>Cd);try{return await i(t,n,{baseDir:o.Desktop})}catch(s){console.error(s)}}else{const o=document.createElement("a");o.download!==void 0&&(o.setAttribute("href","data:text/csv;charset=utf-8,ufeff"+encodeURIComponent(n)),o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o))}}async function wa(t,e){const{onMessage:r,onError:n,onStatusCode:a,usePartialArrayJSONParser:o=!1,isJSONStream:i=!1,fetcher:s=Ke(),...u}=e;let c="",h=0;const y=async({value:p,done:g})=>{if(!(g&&!p))try{const _=gu.parse(c+p);c+=p,_.slice(h).forEach(A=>{r(JSON.stringify(A))}),h=_.length}catch(_){console.error("streaming json parser error",_),console.error("streaming json parser value",p);return}};let d="";const m=async({value:p,done:g})=>{if(!(g&&!p))try{const _=JSON.parse(d+p);d="",r(JSON.stringify(_))}catch{d+=p;return}},v=kc(async p=>{p.type==="event"&&await r(p.data)});if(za()){const p=Oo(),g=[],_=()=>{g.forEach(A=>A())};return await new Promise((A,R)=>{let w=!1;e.signal?.addEventListener("abort",()=>{w=!0,_?.(),R(),bu("abort-fetch-stream",{id:p})}),_a("fetch-stream-status-code",S=>{w||S.payload.id===p&&a?.(S.payload.status)}).then(S=>g.push(S)).catch(S=>R(S)),_a("fetch-stream-chunk",S=>{if(w)return;const C=S.payload;if(C.id===p&&!C.done){if(C.status!==200){try{const T=JSON.parse(C.data);n(T)}catch{n(C.data)}return}if(i){m({value:C.data,done:C.done});return}o?y({value:C.data,done:C.done}):v.feed(C.data)}}).then(S=>{g.push(S)}).catch(S=>{R(S)}),fi.fetchStream(p,t,JSON.stringify(u)).catch(S=>{R(S)}).finally(()=>{w||(_?.(),A())})})}const f=await s(t,u);if(a?.(f.status),f.status!==200){n(await f.json());return}const b=f.body.getReader();try{for(;;){const{done:p,value:g}=await b.read();if(p)break;const _=new TextDecoder().decode(g);i?m({value:_,done:p}):o?y({value:_,done:p}):v.feed(_)}}finally{b.releaseLock()}}function vm(t){return di()?t:new URL(t,import.meta.url).href}const _m=navigator.userAgent.includes("Mac OS X");navigator.userAgent.includes("Windows");const Zc={fetch:"fetch",vocabularyService:"vocabularyService",actionService:"actionService",getItem:"getItem",setItem:"setItem",removeItem:"removeItem"};var K=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol:function(t){return"Symbol("+t+")"};function hi(){}function ef(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}var ps=ef();function Pe(t){return typeof t=="object"&&t!==null||typeof t=="function"}var Pu=hi,pi=Promise,tf=Promise.prototype.then,rf=Promise.resolve.bind(pi),nf=Promise.reject.bind(pi);function de(t){return new pi(t)}function H(t){return rf(t)}function j(t){return nf(t)}function Ne(t,e,r){return tf.call(t,e,r)}function Ae(t,e,r){Ne(Ne(t,e,r),void 0,Pu)}function no(t,e){Ae(t,e)}function yi(t,e){Ae(t,void 0,e)}function ia(t,e,r){return Ne(t,e,r)}function Tr(t){Ne(t,void 0,Pu)}var Sa=function(){var t=ps&&ps.queueMicrotask;if(typeof t=="function")return t;var e=H(void 0);return function(r){return Ne(e,r)}}();function mi(t,e,r){if(typeof t!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(t,e,r)}function Or(t,e,r){try{return H(mi(t,e,r))}catch(n){return j(n)}}var ys=16384,Re=function(){function t(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}return Object.defineProperty(t.prototype,"length",{get:function(){return this._size},enumerable:!1,configurable:!0}),t.prototype.push=function(e){var r=this._back,n=r;r._elements.length===ys-1&&(n={_elements:[],_next:void 0}),r._elements.push(e),n!==r&&(this._back=n,r._next=n),++this._size},t.prototype.shift=function(){var e=this._front,r=e,n=this._cursor,a=n+1,o=e._elements,i=o[n];return a===ys&&(r=e._next,a=0),--this._size,this._cursor=a,e!==r&&(this._front=r),o[n]=void 0,i},t.prototype.forEach=function(e){for(var r=this._cursor,n=this._front,a=n._elements;(r!==a.length||n._next!==void 0)&&!(r===a.length&&(n=n._next,a=n._elements,r=0,a.length===0));)e(a[r]),++r},t.prototype.peek=function(){var e=this._front,r=this._cursor;return e._elements[r]},t}();function Au(t,e){t._ownerReadableStream=e,e._reader=t,e._state==="readable"?gi(t):e._state==="closed"?af(t):Eu(t,e._storedError)}function bi(t,e){var r=t._ownerReadableStream;return we(r,e)}function Le(t){t._ownerReadableStream._state==="readable"?vi(t,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):of(t,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),t._ownerReadableStream._reader=void 0,t._ownerReadableStream=void 0}function Ut(t){return new TypeError("Cannot "+t+" a stream using a released reader")}function gi(t){t._closedPromise=de(function(e,r){t._closedPromise_resolve=e,t._closedPromise_reject=r})}function Eu(t,e){gi(t),vi(t,e)}function af(t){gi(t),Cu(t)}function vi(t,e){t._closedPromise_reject!==void 0&&(Tr(t._closedPromise),t._closedPromise_reject(e),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0)}function of(t,e){Eu(t,e)}function Cu(t){t._closedPromise_resolve!==void 0&&(t._closedPromise_resolve(void 0),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0)}var Tu=K("[[AbortSteps]]"),Ou=K("[[ErrorSteps]]"),_i=K("[[CancelSteps]]"),wi=K("[[PullSteps]]"),ms=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)},sf=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};function uf(t){return typeof t=="object"||typeof t=="function"}function At(t,e){if(t!==void 0&&!uf(t))throw new TypeError(e+" is not an object.")}function st(t,e){if(typeof t!="function")throw new TypeError(e+" is not a function.")}function lf(t){return typeof t=="object"&&t!==null||typeof t=="function"}function ku(t,e){if(!lf(t))throw new TypeError(e+" is not an object.")}function St(t,e,r){if(t===void 0)throw new TypeError("Parameter "+e+" is required in '"+r+"'.")}function bs(t,e,r){if(t===void 0)throw new TypeError(e+" is required in '"+r+"'.")}function xu(t){return Number(t)}function Iu(t){return t===0?0:t}function cf(t){return Iu(sf(t))}function Fu(t,e){var r=0,n=Number.MAX_SAFE_INTEGER,a=Number(t);if(a=Iu(a),!ms(a))throw new TypeError(e+" is not a finite number");if(a=cf(a),a<r||a>n)throw new TypeError(e+" is outside the accepted range of "+r+" to "+n+", inclusive");return!ms(a)||a===0?0:a}function Si(t,e){if(!Ve(t))throw new TypeError(e+" is not a ReadableStream.")}function $t(t){return new $a(t)}function Bu(t,e){t._reader._readRequests.push(e)}function Ri(t,e,r){var n=t._reader,a=n._readRequests.shift();r?a._closeSteps():a._chunkSteps(e)}function Ua(t){return t._reader._readRequests.length}function Mu(t){var e=t._reader;return!(e===void 0||!Xe(e))}var $a=function(){function t(e){if(St(e,1,"ReadableStreamDefaultReader"),Si(e,"First parameter"),Ze(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Au(this,e),this._readRequests=new Re}return Object.defineProperty(t.prototype,"closed",{get:function(){return Xe(this)?this._closedPromise:j(qn("closed"))},enumerable:!1,configurable:!0}),t.prototype.cancel=function(e){return e===void 0&&(e=void 0),Xe(this)?this._ownerReadableStream===void 0?j(Ut("cancel")):bi(this,e):j(qn("cancel"))},t.prototype.read=function(){if(!Xe(this))return j(qn("read"));if(this._ownerReadableStream===void 0)return j(Ut("read from"));var e,r,n=de(function(o,i){e=o,r=i}),a={_chunkSteps:function(o){return e({value:o,done:!1})},_closeSteps:function(){return e({value:void 0,done:!0})},_errorSteps:function(o){return r(o)}};return kr(this,a),n},t.prototype.releaseLock=function(){if(!Xe(this))throw qn("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");Le(this)}},t}();Object.defineProperties($a.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}});typeof K.toStringTag=="symbol"&&Object.defineProperty($a.prototype,K.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Xe(t){return!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_readRequests")?!1:t instanceof $a}function kr(t,e){var r=t._ownerReadableStream;r._disturbed=!0,r._state==="closed"?e._closeSteps():r._state==="errored"?e._errorSteps(r._storedError):r._readableStreamController[wi](e)}function qn(t){return new TypeError("ReadableStreamDefaultReader.prototype."+t+" can only be used on a ReadableStreamDefaultReader")}var ao,Ra;typeof K.asyncIterator=="symbol"&&(Ra=(ao={},ao[K.asyncIterator]=function(){return this},ao),Object.defineProperty(Ra,K.asyncIterator,{enumerable:!1}));var ju=function(){function t(e,r){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=e,this._preventCancel=r}return t.prototype.next=function(){var e=this,r=function(){return e._nextSteps()};return this._ongoingPromise=this._ongoingPromise?ia(this._ongoingPromise,r,r):r(),this._ongoingPromise},t.prototype.return=function(e){var r=this,n=function(){return r._returnSteps(e)};return this._ongoingPromise?ia(this._ongoingPromise,n,n):n()},t.prototype._nextSteps=function(){var e=this;if(this._isFinished)return Promise.resolve({value:void 0,done:!0});var r=this._reader;if(r._ownerReadableStream===void 0)return j(Ut("iterate"));var n,a,o=de(function(s,u){n=s,a=u}),i={_chunkSteps:function(s){e._ongoingPromise=void 0,Sa(function(){return n({value:s,done:!1})})},_closeSteps:function(){e._ongoingPromise=void 0,e._isFinished=!0,Le(r),n({value:void 0,done:!0})},_errorSteps:function(s){e._ongoingPromise=void 0,e._isFinished=!0,Le(r),a(s)}};return kr(r,i),o},t.prototype._returnSteps=function(e){if(this._isFinished)return Promise.resolve({value:e,done:!0});this._isFinished=!0;var r=this._reader;if(r._ownerReadableStream===void 0)return j(Ut("finish iterating"));if(!this._preventCancel){var n=bi(r,e);return Le(r),ia(n,function(){return{value:e,done:!0}})}return Le(r),H({value:e,done:!0})},t}(),Wu={next:function(){return gs(this)?this._asyncIteratorImpl.next():j(vs("next"))},return:function(t){return gs(this)?this._asyncIteratorImpl.return(t):j(vs("return"))}};Ra!==void 0&&Object.setPrototypeOf(Wu,Ra);function ff(t,e){var r=$t(t),n=new ju(r,e),a=Object.create(Wu);return a._asyncIteratorImpl=n,a}function gs(t){if(!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_asyncIteratorImpl"))return!1;try{return t._asyncIteratorImpl instanceof ju}catch{return!1}}function vs(t){return new TypeError("ReadableStreamAsyncIterator."+t+" can only be used on a ReadableSteamAsyncIterator")}var Du=Number.isNaN||function(t){return t!==t};function vr(t){return t.slice()}function Nu(t,e,r,n,a){new Uint8Array(t).set(new Uint8Array(r,n,a),e)}function Pa(t){return!1}function Lu(t,e,r){if(t.slice)return t.slice(e,r);var n=r-e,a=new ArrayBuffer(n);return Nu(a,0,t,e,n),a}function df(t){return!(typeof t!="number"||Du(t)||t<0)}function _s(t){var e=Lu(t.buffer,t.byteOffset,t.byteOffset+t.byteLength);return new Uint8Array(e)}function Pi(t){var e=t._queue.shift();return t._queueTotalSize-=e.size,t._queueTotalSize<0&&(t._queueTotalSize=0),e.value}function Ai(t,e,r){if(!df(r)||r===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");t._queue.push({value:e,size:r}),t._queueTotalSize+=r}function hf(t){var e=t._queue.peek();return e.value}function ut(t){t._queue=new Re,t._queueTotalSize=0}var Ka=function(){function t(){throw new TypeError("Illegal constructor")}return Object.defineProperty(t.prototype,"view",{get:function(){if(!oo(this))throw io("view");return this._view},enumerable:!1,configurable:!0}),t.prototype.respond=function(e){if(!oo(this))throw io("respond");if(St(e,1,"respond"),e=Fu(e,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");Pa(this._view.buffer),la(this._associatedReadableByteStreamController,e)},t.prototype.respondWithNewView=function(e){if(!oo(this))throw io("respondWithNewView");if(St(e,1,"respondWithNewView"),!ArrayBuffer.isView(e))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");Pa(e.buffer),ca(this._associatedReadableByteStreamController,e)},t}();Object.defineProperties(Ka.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}});typeof K.toStringTag=="symbol"&&Object.defineProperty(Ka.prototype,K.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});var xr=function(){function t(){throw new TypeError("Illegal constructor")}return Object.defineProperty(t.prototype,"byobRequest",{get:function(){if(!pt(this))throw nr("byobRequest");return ko(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"desiredSize",{get:function(){if(!pt(this))throw nr("desiredSize");return Vu(this)},enumerable:!1,configurable:!0}),t.prototype.close=function(){if(!pt(this))throw nr("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");var e=this._controlledReadableByteStream._state;if(e!=="readable")throw new TypeError("The stream (in "+e+" state) is not in the readable state and cannot be closed");ir(this)},t.prototype.enqueue=function(e){if(!pt(this))throw nr("enqueue");if(St(e,1,"enqueue"),!ArrayBuffer.isView(e))throw new TypeError("chunk must be an array buffer view");if(e.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(e.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");var r=this._controlledReadableByteStream._state;if(r!=="readable")throw new TypeError("The stream (in "+r+" state) is not in the readable state and cannot be enqueued to");ua(this,e)},t.prototype.error=function(e){if(e===void 0&&(e=void 0),!pt(this))throw nr("error");_e(this,e)},t.prototype[_i]=function(e){qu(this),ut(this);var r=this._cancelAlgorithm(e);return Ha(this),r},t.prototype[wi]=function(e){var r=this._controlledReadableByteStream;if(this._queueTotalSize>0){var n=this._queue.shift();this._queueTotalSize-=n.byteLength,Ku(this);var a=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);e._chunkSteps(a);return}var o=this._autoAllocateChunkSize;if(o!==void 0){var i=void 0;try{i=new ArrayBuffer(o)}catch(u){e._errorSteps(u);return}var s={buffer:i,bufferByteLength:o,byteOffset:0,byteLength:o,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(s)}Bu(r,e),Et(this)},t}();Object.defineProperties(xr.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}});typeof K.toStringTag=="symbol"&&Object.defineProperty(xr.prototype,K.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function pt(t){return!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_controlledReadableByteStream")?!1:t instanceof xr}function oo(t){return!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_associatedReadableByteStreamController")?!1:t instanceof Ka}function Et(t){var e=bf(t);if(e){if(t._pulling){t._pullAgain=!0;return}t._pulling=!0;var r=t._pullAlgorithm();Ae(r,function(){t._pulling=!1,t._pullAgain&&(t._pullAgain=!1,Et(t))},function(n){_e(t,n)})}}function qu(t){Ci(t),t._pendingPullIntos=new Re}function Ei(t,e){var r=!1;t._state==="closed"&&(r=!0);var n=zu(e);e.readerType==="default"?Ri(t,n,r):_f(t,n,r)}function zu(t){var e=t.bytesFilled,r=t.elementSize;return new t.viewConstructor(t.buffer,t.byteOffset,e/r)}function sa(t,e,r,n){t._queue.push({buffer:e,byteOffset:r,byteLength:n}),t._queueTotalSize+=n}function Uu(t,e){var r=e.elementSize,n=e.bytesFilled-e.bytesFilled%r,a=Math.min(t._queueTotalSize,e.byteLength-e.bytesFilled),o=e.bytesFilled+a,i=o-o%r,s=a,u=!1;i>n&&(s=i-e.bytesFilled,u=!0);for(var c=t._queue;s>0;){var h=c.peek(),y=Math.min(s,h.byteLength),d=e.byteOffset+e.bytesFilled;Nu(e.buffer,d,h.buffer,h.byteOffset,y),h.byteLength===y?c.shift():(h.byteOffset+=y,h.byteLength-=y),t._queueTotalSize-=y,$u(t,y,e),s-=y}return u}function $u(t,e,r){r.bytesFilled+=e}function Ku(t){t._queueTotalSize===0&&t._closeRequested?(Ha(t),Fr(t._controlledReadableByteStream)):Et(t)}function Ci(t){t._byobRequest!==null&&(t._byobRequest._associatedReadableByteStreamController=void 0,t._byobRequest._view=null,t._byobRequest=null)}function Gu(t){for(;t._pendingPullIntos.length>0;){if(t._queueTotalSize===0)return;var e=t._pendingPullIntos.peek();Uu(t,e)&&(Ga(t),Ei(t._controlledReadableByteStream,e))}}function pf(t,e,r){var n=t._controlledReadableByteStream,a=1;e.constructor!==DataView&&(a=e.constructor.BYTES_PER_ELEMENT);var o=e.constructor,i=e.buffer,s={buffer:i,bufferByteLength:i.byteLength,byteOffset:e.byteOffset,byteLength:e.byteLength,bytesFilled:0,elementSize:a,viewConstructor:o,readerType:"byob"};if(t._pendingPullIntos.length>0){t._pendingPullIntos.push(s),ws(n,r);return}if(n._state==="closed"){var u=new o(s.buffer,s.byteOffset,0);r._closeSteps(u);return}if(t._queueTotalSize>0){if(Uu(t,s)){var c=zu(s);Ku(t),r._chunkSteps(c);return}if(t._closeRequested){var h=new TypeError("Insufficient bytes to fill elements in the given buffer");_e(t,h),r._errorSteps(h);return}}t._pendingPullIntos.push(s),ws(n,r),Et(t)}function yf(t,e){var r=t._controlledReadableByteStream;if(Ti(r))for(;Qu(r)>0;){var n=Ga(t);Ei(r,n)}}function mf(t,e,r){if($u(t,e,r),!(r.bytesFilled<r.elementSize)){Ga(t);var n=r.bytesFilled%r.elementSize;if(n>0){var a=r.byteOffset+r.bytesFilled,o=Lu(r.buffer,a-n,a);sa(t,o,0,o.byteLength)}r.bytesFilled-=n,Ei(t._controlledReadableByteStream,r),Gu(t)}}function Hu(t,e){var r=t._pendingPullIntos.peek();Ci(t);var n=t._controlledReadableByteStream._state;n==="closed"?yf(t):mf(t,e,r),Et(t)}function Ga(t){var e=t._pendingPullIntos.shift();return e}function bf(t){var e=t._controlledReadableByteStream;if(e._state!=="readable"||t._closeRequested||!t._started)return!1;if(Mu(e)&&Ua(e)>0||Ti(e)&&Qu(e)>0)return!0;var r=Vu(t);return r>0}function Ha(t){t._pullAlgorithm=void 0,t._cancelAlgorithm=void 0}function ir(t){var e=t._controlledReadableByteStream;if(!(t._closeRequested||e._state!=="readable")){if(t._queueTotalSize>0){t._closeRequested=!0;return}if(t._pendingPullIntos.length>0){var r=t._pendingPullIntos.peek();if(r.bytesFilled>0){var n=new TypeError("Insufficient bytes to fill elements in the given buffer");throw _e(t,n),n}}Ha(t),Fr(e)}}function ua(t,e){var r=t._controlledReadableByteStream;if(!(t._closeRequested||r._state!=="readable")){var n=e.buffer,a=e.byteOffset,o=e.byteLength,i=n;if(t._pendingPullIntos.length>0){var s=t._pendingPullIntos.peek();Pa(s.buffer),s.buffer=s.buffer}if(Ci(t),Mu(r))if(Ua(r)===0)sa(t,i,a,o);else{t._pendingPullIntos.length>0&&Ga(t);var u=new Uint8Array(i,a,o);Ri(r,u,!1)}else Ti(r)?(sa(t,i,a,o),Gu(t)):sa(t,i,a,o);Et(t)}}function _e(t,e){var r=t._controlledReadableByteStream;r._state==="readable"&&(qu(t),ut(t),Ha(t),ml(r,e))}function ko(t){if(t._byobRequest===null&&t._pendingPullIntos.length>0){var e=t._pendingPullIntos.peek(),r=new Uint8Array(e.buffer,e.byteOffset+e.bytesFilled,e.byteLength-e.bytesFilled),n=Object.create(Ka.prototype);vf(n,t,r),t._byobRequest=n}return t._byobRequest}function Vu(t){var e=t._controlledReadableByteStream._state;return e==="errored"?null:e==="closed"?0:t._strategyHWM-t._queueTotalSize}function la(t,e){var r=t._pendingPullIntos.peek(),n=t._controlledReadableByteStream._state;if(n==="closed"){if(e!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(e===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(r.bytesFilled+e>r.byteLength)throw new RangeError("bytesWritten out of range")}r.buffer=r.buffer,Hu(t,e)}function ca(t,e){var r=t._pendingPullIntos.peek(),n=t._controlledReadableByteStream._state;if(n==="closed"){if(e.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(e.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(r.byteOffset+r.bytesFilled!==e.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(r.bufferByteLength!==e.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(r.bytesFilled+e.byteLength>r.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");var a=e.byteLength;r.buffer=e.buffer,Hu(t,a)}function Ju(t,e,r,n,a,o,i){e._controlledReadableByteStream=t,e._pullAgain=!1,e._pulling=!1,e._byobRequest=null,e._queue=e._queueTotalSize=void 0,ut(e),e._closeRequested=!1,e._started=!1,e._strategyHWM=o,e._pullAlgorithm=n,e._cancelAlgorithm=a,e._autoAllocateChunkSize=i,e._pendingPullIntos=new Re,t._readableStreamController=e;var s=r();Ae(H(s),function(){e._started=!0,Et(e)},function(u){_e(e,u)})}function gf(t,e,r){var n=Object.create(xr.prototype),a=function(){},o=function(){return H(void 0)},i=function(){return H(void 0)};e.start!==void 0&&(a=function(){return e.start(n)}),e.pull!==void 0&&(o=function(){return e.pull(n)}),e.cancel!==void 0&&(i=function(u){return e.cancel(u)});var s=e.autoAllocateChunkSize;if(s===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Ju(t,n,a,o,i,r,s)}function vf(t,e,r){t._associatedReadableByteStreamController=e,t._view=r}function io(t){return new TypeError("ReadableStreamBYOBRequest.prototype."+t+" can only be used on a ReadableStreamBYOBRequest")}function nr(t){return new TypeError("ReadableByteStreamController.prototype."+t+" can only be used on a ReadableByteStreamController")}function Yu(t){return new Va(t)}function ws(t,e){t._reader._readIntoRequests.push(e)}function _f(t,e,r){var n=t._reader,a=n._readIntoRequests.shift();r?a._closeSteps(e):a._chunkSteps(e)}function Qu(t){return t._reader._readIntoRequests.length}function Ti(t){var e=t._reader;return!(e===void 0||!mt(e))}var Va=function(){function t(e){if(St(e,1,"ReadableStreamBYOBReader"),Si(e,"First parameter"),Ze(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!pt(e._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Au(this,e),this._readIntoRequests=new Re}return Object.defineProperty(t.prototype,"closed",{get:function(){return mt(this)?this._closedPromise:j(zn("closed"))},enumerable:!1,configurable:!0}),t.prototype.cancel=function(e){return e===void 0&&(e=void 0),mt(this)?this._ownerReadableStream===void 0?j(Ut("cancel")):bi(this,e):j(zn("cancel"))},t.prototype.read=function(e){if(!mt(this))return j(zn("read"));if(!ArrayBuffer.isView(e))return j(new TypeError("view must be an array buffer view"));if(e.byteLength===0)return j(new TypeError("view must have non-zero byteLength"));if(e.buffer.byteLength===0)return j(new TypeError("view's buffer must have non-zero byteLength"));if(Pa(e.buffer),this._ownerReadableStream===void 0)return j(Ut("read from"));var r,n,a=de(function(i,s){r=i,n=s}),o={_chunkSteps:function(i){return r({value:i,done:!1})},_closeSteps:function(i){return r({value:i,done:!0})},_errorSteps:function(i){return n(i)}};return Xu(this,e,o),a},t.prototype.releaseLock=function(){if(!mt(this))throw zn("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");Le(this)}},t}();Object.defineProperties(Va.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}});typeof K.toStringTag=="symbol"&&Object.defineProperty(Va.prototype,K.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function mt(t){return!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_readIntoRequests")?!1:t instanceof Va}function Xu(t,e,r){var n=t._ownerReadableStream;n._disturbed=!0,n._state==="errored"?r._errorSteps(n._storedError):pf(n._readableStreamController,e,r)}function zn(t){return new TypeError("ReadableStreamBYOBReader.prototype."+t+" can only be used on a ReadableStreamBYOBReader")}function xo(t,e){var r=t.highWaterMark;if(r===void 0)return e;if(Du(r)||r<0)throw new RangeError("Invalid highWaterMark");return r}function Zu(t){var e=t.size;return e||function(){return 1}}function el(t,e){At(t,e);var r=t?.highWaterMark,n=t?.size;return{highWaterMark:r===void 0?void 0:xu(r),size:n===void 0?void 0:wf(n,e+" has member 'size' that")}}function wf(t,e){return st(t,e),function(r){return xu(t(r))}}function Sf(t,e){At(t,e);var r=t?.abort,n=t?.close,a=t?.start,o=t?.type,i=t?.write;return{abort:r===void 0?void 0:Rf(r,t,e+" has member 'abort' that"),close:n===void 0?void 0:Pf(n,t,e+" has member 'close' that"),start:a===void 0?void 0:Af(a,t,e+" has member 'start' that"),write:i===void 0?void 0:Ef(i,t,e+" has member 'write' that"),type:o}}function Rf(t,e,r){return st(t,r),function(n){return Or(t,e,[n])}}function Pf(t,e,r){return st(t,r),function(){return Or(t,e,[])}}function Af(t,e,r){return st(t,r),function(n){return mi(t,e,[n])}}function Ef(t,e,r){return st(t,r),function(n,a){return Or(t,e,[n,a])}}function tl(t,e){if(!jt(t))throw new TypeError(e+" is not a WritableStream.")}function Cf(t){if(typeof t!="object"||t===null)return!1;try{return typeof t.aborted=="boolean"}catch{return!1}}var Tf=typeof AbortController=="function";function Of(){if(Tf)return new AbortController}var Oi=function(){function t(e,r){e===void 0&&(e={}),r===void 0&&(r={}),e===void 0?e=null:ku(e,"First parameter");var n=el(r,"Second parameter"),a=Sf(e,"First parameter");kf(this);var o=a.type;if(o!==void 0)throw new RangeError("Invalid type is specified");var i=Zu(n),s=xo(n,1);$f(this,a,s,i)}return Object.defineProperty(t.prototype,"locked",{get:function(){if(!jt(this))throw $n("locked");return Dt(this)},enumerable:!1,configurable:!0}),t.prototype.abort=function(e){return e===void 0&&(e=void 0),jt(this)?Dt(this)?j(new TypeError("Cannot abort a stream that already has a writer")):Aa(this,e):j($n("abort"))},t.prototype.close=function(){return jt(this)?Dt(this)?j(new TypeError("Cannot close a stream that already has a writer")):Ie(this)?j(new TypeError("Cannot close an already-closing stream")):nl(this):j($n("close"))},t.prototype.getWriter=function(){if(!jt(this))throw $n("getWriter");return rl(this)},t}();Object.defineProperties(Oi.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}});typeof K.toStringTag=="symbol"&&Object.defineProperty(Oi.prototype,K.toStringTag,{value:"WritableStream",configurable:!0});function rl(t){return new Ja(t)}function kf(t){t._state="writable",t._storedError=void 0,t._writer=void 0,t._writableStreamController=void 0,t._writeRequests=new Re,t._inFlightWriteRequest=void 0,t._closeRequest=void 0,t._inFlightCloseRequest=void 0,t._pendingAbortRequest=void 0,t._backpressure=!1}function jt(t){return!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_writableStreamController")?!1:t instanceof Oi}function Dt(t){return t._writer!==void 0}function Aa(t,e){var r;if(t._state==="closed"||t._state==="errored")return H(void 0);t._writableStreamController._abortReason=e,(r=t._writableStreamController._abortController)===null||r===void 0||r.abort();var n=t._state;if(n==="closed"||n==="errored")return H(void 0);if(t._pendingAbortRequest!==void 0)return t._pendingAbortRequest._promise;var a=!1;n==="erroring"&&(a=!0,e=void 0);var o=de(function(i,s){t._pendingAbortRequest={_promise:void 0,_resolve:i,_reject:s,_reason:e,_wasAlreadyErroring:a}});return t._pendingAbortRequest._promise=o,a||xi(t,e),o}function nl(t){var e=t._state;if(e==="closed"||e==="errored")return j(new TypeError("The stream (in "+e+" state) is not in the writable state and cannot be closed"));var r=de(function(a,o){var i={_resolve:a,_reject:o};t._closeRequest=i}),n=t._writer;return n!==void 0&&t._backpressure&&e==="writable"&&Wi(n),Kf(t._writableStreamController),r}function xf(t){var e=de(function(r,n){var a={_resolve:r,_reject:n};t._writeRequests.push(a)});return e}function ki(t,e){var r=t._state;if(r==="writable"){xi(t,e);return}Ii(t)}function xi(t,e){var r=t._writableStreamController;t._state="erroring",t._storedError=e;var n=t._writer;n!==void 0&&ol(n,e),!jf(t)&&r._started&&Ii(t)}function Ii(t){t._state="errored",t._writableStreamController[Ou]();var e=t._storedError;if(t._writeRequests.forEach(function(a){a._reject(e)}),t._writeRequests=new Re,t._pendingAbortRequest===void 0){Un(t);return}var r=t._pendingAbortRequest;if(t._pendingAbortRequest=void 0,r._wasAlreadyErroring){r._reject(e),Un(t);return}var n=t._writableStreamController[Tu](r._reason);Ae(n,function(){r._resolve(),Un(t)},function(a){r._reject(a),Un(t)})}function If(t){t._inFlightWriteRequest._resolve(void 0),t._inFlightWriteRequest=void 0}function Ff(t,e){t._inFlightWriteRequest._reject(e),t._inFlightWriteRequest=void 0,ki(t,e)}function Bf(t){t._inFlightCloseRequest._resolve(void 0),t._inFlightCloseRequest=void 0;var e=t._state;e==="erroring"&&(t._storedError=void 0,t._pendingAbortRequest!==void 0&&(t._pendingAbortRequest._resolve(),t._pendingAbortRequest=void 0)),t._state="closed";var r=t._writer;r!==void 0&&dl(r)}function Mf(t,e){t._inFlightCloseRequest._reject(e),t._inFlightCloseRequest=void 0,t._pendingAbortRequest!==void 0&&(t._pendingAbortRequest._reject(e),t._pendingAbortRequest=void 0),ki(t,e)}function Ie(t){return!(t._closeRequest===void 0&&t._inFlightCloseRequest===void 0)}function jf(t){return!(t._inFlightWriteRequest===void 0&&t._inFlightCloseRequest===void 0)}function Wf(t){t._inFlightCloseRequest=t._closeRequest,t._closeRequest=void 0}function Df(t){t._inFlightWriteRequest=t._writeRequests.shift()}function Un(t){t._closeRequest!==void 0&&(t._closeRequest._reject(t._storedError),t._closeRequest=void 0);var e=t._writer;e!==void 0&&ji(e,t._storedError)}function Fi(t,e){var r=t._writer;r!==void 0&&e!==t._backpressure&&(e?Xf(r):Wi(r)),t._backpressure=e}var Ja=function(){function t(e){if(St(e,1,"WritableStreamDefaultWriter"),tl(e,"First parameter"),Dt(e))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=e,e._writer=this;var r=e._state;if(r==="writable")!Ie(e)&&e._backpressure?Za(this):Ss(this),Ea(this);else if(r==="erroring")Io(this,e._storedError),Ea(this);else if(r==="closed")Ss(this),Yf(this);else{var n=e._storedError;Io(this,n),fl(this,n)}}return Object.defineProperty(t.prototype,"closed",{get:function(){return ct(this)?this._closedPromise:j(ft("closed"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"desiredSize",{get:function(){if(!ct(this))throw ft("desiredSize");if(this._ownerWritableStream===void 0)throw sr("desiredSize");return zf(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return ct(this)?this._readyPromise:j(ft("ready"))},enumerable:!1,configurable:!0}),t.prototype.abort=function(e){return e===void 0&&(e=void 0),ct(this)?this._ownerWritableStream===void 0?j(sr("abort")):Nf(this,e):j(ft("abort"))},t.prototype.close=function(){if(!ct(this))return j(ft("close"));var e=this._ownerWritableStream;return e===void 0?j(sr("close")):Ie(e)?j(new TypeError("Cannot close an already-closing stream")):al(this)},t.prototype.releaseLock=function(){if(!ct(this))throw ft("releaseLock");var e=this._ownerWritableStream;e!==void 0&&il(this)},t.prototype.write=function(e){return e===void 0&&(e=void 0),ct(this)?this._ownerWritableStream===void 0?j(sr("write to")):sl(this,e):j(ft("write"))},t}();Object.defineProperties(Ja.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}});typeof K.toStringTag=="symbol"&&Object.defineProperty(Ja.prototype,K.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function ct(t){return!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_ownerWritableStream")?!1:t instanceof Ja}function Nf(t,e){var r=t._ownerWritableStream;return Aa(r,e)}function al(t){var e=t._ownerWritableStream;return nl(e)}function Lf(t){var e=t._ownerWritableStream,r=e._state;return Ie(e)||r==="closed"?H(void 0):r==="errored"?j(e._storedError):al(t)}function qf(t,e){t._closedPromiseState==="pending"?ji(t,e):Qf(t,e)}function ol(t,e){t._readyPromiseState==="pending"?hl(t,e):Zf(t,e)}function zf(t){var e=t._ownerWritableStream,r=e._state;return r==="errored"||r==="erroring"?null:r==="closed"?0:ll(e._writableStreamController)}function il(t){var e=t._ownerWritableStream,r=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");ol(t,r),qf(t,r),e._writer=void 0,t._ownerWritableStream=void 0}function sl(t,e){var r=t._ownerWritableStream,n=r._writableStreamController,a=Gf(n,e);if(r!==t._ownerWritableStream)return j(sr("write to"));var o=r._state;if(o==="errored")return j(r._storedError);if(Ie(r)||o==="closed")return j(new TypeError("The stream is closing or closed and cannot be written to"));if(o==="erroring")return j(r._storedError);var i=xf(r);return Hf(n,e,a),i}var ul={},Ya=function(){function t(){throw new TypeError("Illegal constructor")}return Object.defineProperty(t.prototype,"abortReason",{get:function(){if(!so(this))throw uo("abortReason");return this._abortReason},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"signal",{get:function(){if(!so(this))throw uo("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal},enumerable:!1,configurable:!0}),t.prototype.error=function(e){if(e===void 0&&(e=void 0),!so(this))throw uo("error");var r=this._controlledWritableStream._state;r==="writable"&&cl(this,e)},t.prototype[Tu]=function(e){var r=this._abortAlgorithm(e);return Qa(this),r},t.prototype[Ou]=function(){ut(this)},t}();Object.defineProperties(Ya.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}});typeof K.toStringTag=="symbol"&&Object.defineProperty(Ya.prototype,K.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function so(t){return!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_controlledWritableStream")?!1:t instanceof Ya}function Uf(t,e,r,n,a,o,i,s){e._controlledWritableStream=t,t._writableStreamController=e,e._queue=void 0,e._queueTotalSize=void 0,ut(e),e._abortReason=void 0,e._abortController=Of(),e._started=!1,e._strategySizeAlgorithm=s,e._strategyHWM=i,e._writeAlgorithm=n,e._closeAlgorithm=a,e._abortAlgorithm=o;var u=Mi(e);Fi(t,u);var c=r(),h=H(c);Ae(h,function(){e._started=!0,Xa(e)},function(y){e._started=!0,ki(t,y)})}function $f(t,e,r,n){var a=Object.create(Ya.prototype),o=function(){},i=function(){return H(void 0)},s=function(){return H(void 0)},u=function(){return H(void 0)};e.start!==void 0&&(o=function(){return e.start(a)}),e.write!==void 0&&(i=function(c){return e.write(c,a)}),e.close!==void 0&&(s=function(){return e.close()}),e.abort!==void 0&&(u=function(c){return e.abort(c)}),Uf(t,a,o,i,s,u,r,n)}function Qa(t){t._writeAlgorithm=void 0,t._closeAlgorithm=void 0,t._abortAlgorithm=void 0,t._strategySizeAlgorithm=void 0}function Kf(t){Ai(t,ul,0),Xa(t)}function Gf(t,e){try{return t._strategySizeAlgorithm(e)}catch(r){return Bi(t,r),1}}function ll(t){return t._strategyHWM-t._queueTotalSize}function Hf(t,e,r){try{Ai(t,e,r)}catch(o){Bi(t,o);return}var n=t._controlledWritableStream;if(!Ie(n)&&n._state==="writable"){var a=Mi(t);Fi(n,a)}Xa(t)}function Xa(t){var e=t._controlledWritableStream;if(t._started&&e._inFlightWriteRequest===void 0){var r=e._state;if(r==="erroring"){Ii(e);return}if(t._queue.length!==0){var n=hf(t);n===ul?Vf(t):Jf(t,n)}}}function Bi(t,e){t._controlledWritableStream._state==="writable"&&cl(t,e)}function Vf(t){var e=t._controlledWritableStream;Wf(e),Pi(t);var r=t._closeAlgorithm();Qa(t),Ae(r,function(){Bf(e)},function(n){Mf(e,n)})}function Jf(t,e){var r=t._controlledWritableStream;Df(r);var n=t._writeAlgorithm(e);Ae(n,function(){If(r);var a=r._state;if(Pi(t),!Ie(r)&&a==="writable"){var o=Mi(t);Fi(r,o)}Xa(t)},function(a){r._state==="writable"&&Qa(t),Ff(r,a)})}function Mi(t){var e=ll(t);return e<=0}function cl(t,e){var r=t._controlledWritableStream;Qa(t),xi(r,e)}function $n(t){return new TypeError("WritableStream.prototype."+t+" can only be used on a WritableStream")}function uo(t){return new TypeError("WritableStreamDefaultController.prototype."+t+" can only be used on a WritableStreamDefaultController")}function ft(t){return new TypeError("WritableStreamDefaultWriter.prototype."+t+" can only be used on a WritableStreamDefaultWriter")}function sr(t){return new TypeError("Cannot "+t+" a stream using a released writer")}function Ea(t){t._closedPromise=de(function(e,r){t._closedPromise_resolve=e,t._closedPromise_reject=r,t._closedPromiseState="pending"})}function fl(t,e){Ea(t),ji(t,e)}function Yf(t){Ea(t),dl(t)}function ji(t,e){t._closedPromise_reject!==void 0&&(Tr(t._closedPromise),t._closedPromise_reject(e),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0,t._closedPromiseState="rejected")}function Qf(t,e){fl(t,e)}function dl(t){t._closedPromise_resolve!==void 0&&(t._closedPromise_resolve(void 0),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0,t._closedPromiseState="resolved")}function Za(t){t._readyPromise=de(function(e,r){t._readyPromise_resolve=e,t._readyPromise_reject=r}),t._readyPromiseState="pending"}function Io(t,e){Za(t),hl(t,e)}function Ss(t){Za(t),Wi(t)}function hl(t,e){t._readyPromise_reject!==void 0&&(Tr(t._readyPromise),t._readyPromise_reject(e),t._readyPromise_resolve=void 0,t._readyPromise_reject=void 0,t._readyPromiseState="rejected")}function Xf(t){Za(t)}function Zf(t,e){Io(t,e)}function Wi(t){t._readyPromise_resolve!==void 0&&(t._readyPromise_resolve(void 0),t._readyPromise_resolve=void 0,t._readyPromise_reject=void 0,t._readyPromiseState="fulfilled")}var Rs=typeof DOMException<"u"?DOMException:void 0;function ed(t){if(!(typeof t=="function"||typeof t=="object"))return!1;try{return new t,!0}catch{return!1}}function td(){var t=function(r,n){this.message=r||"",this.name=n||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return t.prototype=Object.create(Error.prototype),Object.defineProperty(t.prototype,"constructor",{value:t,writable:!0,configurable:!0}),t}var rd=ed(Rs)?Rs:td();function Ps(t,e,r,n,a,o){var i=$t(t),s=rl(e);t._disturbed=!0;var u=!1,c=H(void 0);return de(function(h,y){var d;if(o!==void 0){if(d=function(){var w=new rd("Aborted","AbortError"),S=[];n||S.push(function(){return e._state==="writable"?Aa(e,w):H(void 0)}),a||S.push(function(){return t._state==="readable"?we(t,w):H(void 0)}),_(function(){return Promise.all(S.map(function(C){return C()}))},!0,w)},o.aborted){d();return}o.addEventListener("abort",d)}function m(){return de(function(w,S){function C(T){T?w():Ne(v(),C,S)}C(!1)})}function v(){return u?H(!0):Ne(s._readyPromise,function(){return de(function(w,S){kr(i,{_chunkSteps:function(C){c=Ne(sl(s,C),void 0,hi),w(!1)},_closeSteps:function(){return w(!0)},_errorSteps:S})})})}if(p(t,i._closedPromise,function(w){n?A(!0,w):_(function(){return Aa(e,w)},!0,w)}),p(e,s._closedPromise,function(w){a?A(!0,w):_(function(){return we(t,w)},!0,w)}),g(t,i._closedPromise,function(){r?A():_(function(){return Lf(s)})}),Ie(e)||e._state==="closed"){var f=new TypeError("the destination writable stream closed before all data could be piped to it");a?A(!0,f):_(function(){return we(t,f)},!0,f)}Tr(m());function b(){var w=c;return Ne(c,function(){return w!==c?b():void 0})}function p(w,S,C){w._state==="errored"?C(w._storedError):yi(S,C)}function g(w,S,C){w._state==="closed"?C():no(S,C)}function _(w,S,C){if(u)return;u=!0,e._state==="writable"&&!Ie(e)?no(b(),T):T();function T(){Ae(w(),function(){return R(S,C)},function(D){return R(!0,D)})}}function A(w,S){u||(u=!0,e._state==="writable"&&!Ie(e)?no(b(),function(){return R(w,S)}):R(w,S))}function R(w,S){il(s),Le(i),o!==void 0&&o.removeEventListener("abort",d),w?y(S):h(void 0)}})}var Ir=function(){function t(){throw new TypeError("Illegal constructor")}return Object.defineProperty(t.prototype,"desiredSize",{get:function(){if(!Kn(this))throw Gn("desiredSize");return Di(this)},enumerable:!1,configurable:!0}),t.prototype.close=function(){if(!Kn(this))throw Gn("close");if(!Kt(this))throw new TypeError("The stream is not in a state that permits close");Ta(this)},t.prototype.enqueue=function(e){if(e===void 0&&(e=void 0),!Kn(this))throw Gn("enqueue");if(!Kt(this))throw new TypeError("The stream is not in a state that permits enqueue");return Oa(this,e)},t.prototype.error=function(e){if(e===void 0&&(e=void 0),!Kn(this))throw Gn("error");tt(this,e)},t.prototype[_i]=function(e){ut(this);var r=this._cancelAlgorithm(e);return Ca(this),r},t.prototype[wi]=function(e){var r=this._controlledReadableStream;if(this._queue.length>0){var n=Pi(this);this._closeRequested&&this._queue.length===0?(Ca(this),Fr(r)):_r(this),e._chunkSteps(n)}else Bu(r,e),_r(this)},t}();Object.defineProperties(Ir.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}});typeof K.toStringTag=="symbol"&&Object.defineProperty(Ir.prototype,K.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Kn(t){return!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_controlledReadableStream")?!1:t instanceof Ir}function _r(t){var e=pl(t);if(e){if(t._pulling){t._pullAgain=!0;return}t._pulling=!0;var r=t._pullAlgorithm();Ae(r,function(){t._pulling=!1,t._pullAgain&&(t._pullAgain=!1,_r(t))},function(n){tt(t,n)})}}function pl(t){var e=t._controlledReadableStream;if(!Kt(t)||!t._started)return!1;if(Ze(e)&&Ua(e)>0)return!0;var r=Di(t);return r>0}function Ca(t){t._pullAlgorithm=void 0,t._cancelAlgorithm=void 0,t._strategySizeAlgorithm=void 0}function Ta(t){if(Kt(t)){var e=t._controlledReadableStream;t._closeRequested=!0,t._queue.length===0&&(Ca(t),Fr(e))}}function Oa(t,e){if(Kt(t)){var r=t._controlledReadableStream;if(Ze(r)&&Ua(r)>0)Ri(r,e,!1);else{var n=void 0;try{n=t._strategySizeAlgorithm(e)}catch(a){throw tt(t,a),a}try{Ai(t,e,n)}catch(a){throw tt(t,a),a}}_r(t)}}function tt(t,e){var r=t._controlledReadableStream;r._state==="readable"&&(ut(t),Ca(t),ml(r,e))}function Di(t){var e=t._controlledReadableStream._state;return e==="errored"?null:e==="closed"?0:t._strategyHWM-t._queueTotalSize}function nd(t){return!pl(t)}function Kt(t){var e=t._controlledReadableStream._state;return!t._closeRequested&&e==="readable"}function yl(t,e,r,n,a,o,i){e._controlledReadableStream=t,e._queue=void 0,e._queueTotalSize=void 0,ut(e),e._started=!1,e._closeRequested=!1,e._pullAgain=!1,e._pulling=!1,e._strategySizeAlgorithm=i,e._strategyHWM=o,e._pullAlgorithm=n,e._cancelAlgorithm=a,t._readableStreamController=e;var s=r();Ae(H(s),function(){e._started=!0,_r(e)},function(u){tt(e,u)})}function ad(t,e,r,n){var a=Object.create(Ir.prototype),o=function(){},i=function(){return H(void 0)},s=function(){return H(void 0)};e.start!==void 0&&(o=function(){return e.start(a)}),e.pull!==void 0&&(i=function(){return e.pull(a)}),e.cancel!==void 0&&(s=function(u){return e.cancel(u)}),yl(t,a,o,i,s,r,n)}function Gn(t){return new TypeError("ReadableStreamDefaultController.prototype."+t+" can only be used on a ReadableStreamDefaultController")}function od(t,e){return pt(t._readableStreamController)?sd(t):id(t)}function id(t,e){var r=$t(t),n=!1,a=!1,o=!1,i=!1,s,u,c,h,y,d=de(function(p){y=p});function m(){if(n)return a=!0,H(void 0);n=!0;var p={_chunkSteps:function(g){Sa(function(){a=!1;var _=g,A=g;o||Oa(c._readableStreamController,_),i||Oa(h._readableStreamController,A),n=!1,a&&m()})},_closeSteps:function(){n=!1,o||Ta(c._readableStreamController),i||Ta(h._readableStreamController),(!o||!i)&&y(void 0)},_errorSteps:function(){n=!1}};return kr(r,p),H(void 0)}function v(p){if(o=!0,s=p,i){var g=vr([s,u]),_=we(t,g);y(_)}return d}function f(p){if(i=!0,u=p,o){var g=vr([s,u]),_=we(t,g);y(_)}return d}function b(){}return c=Es(b,m,v),h=Es(b,m,f),yi(r._closedPromise,function(p){tt(c._readableStreamController,p),tt(h._readableStreamController,p),(!o||!i)&&y(void 0)}),[c,h]}function sd(t){var e=$t(t),r=!1,n=!1,a=!1,o=!1,i=!1,s,u,c,h,y,d=de(function(R){y=R});function m(R){yi(R._closedPromise,function(w){R===e&&(_e(c._readableStreamController,w),_e(h._readableStreamController,w),(!o||!i)&&y(void 0))})}function v(){mt(e)&&(Le(e),e=$t(t),m(e));var R={_chunkSteps:function(w){Sa(function(){n=!1,a=!1;var S=w,C=w;if(!o&&!i)try{C=_s(w)}catch(T){_e(c._readableStreamController,T),_e(h._readableStreamController,T),y(we(t,T));return}o||ua(c._readableStreamController,S),i||ua(h._readableStreamController,C),r=!1,n?b():a&&p()})},_closeSteps:function(){r=!1,o||ir(c._readableStreamController),i||ir(h._readableStreamController),c._readableStreamController._pendingPullIntos.length>0&&la(c._readableStreamController,0),h._readableStreamController._pendingPullIntos.length>0&&la(h._readableStreamController,0),(!o||!i)&&y(void 0)},_errorSteps:function(){r=!1}};kr(e,R)}function f(R,w){Xe(e)&&(Le(e),e=Yu(t),m(e));var S=w?h:c,C=w?c:h,T={_chunkSteps:function(D){Sa(function(){n=!1,a=!1;var L=w?i:o,q=w?o:i;if(q)L||ca(S._readableStreamController,D);else{var $=void 0;try{$=_s(D)}catch(z){_e(S._readableStreamController,z),_e(C._readableStreamController,z),y(we(t,z));return}L||ca(S._readableStreamController,D),ua(C._readableStreamController,$)}r=!1,n?b():a&&p()})},_closeSteps:function(D){r=!1;var L=w?i:o,q=w?o:i;L||ir(S._readableStreamController),q||ir(C._readableStreamController),D!==void 0&&(L||ca(S._readableStreamController,D),!q&&C._readableStreamController._pendingPullIntos.length>0&&la(C._readableStreamController,0)),(!L||!q)&&y(void 0)},_errorSteps:function(){r=!1}};Xu(e,R,T)}function b(){if(r)return n=!0,H(void 0);r=!0;var R=ko(c._readableStreamController);return R===null?v():f(R._view,!1),H(void 0)}function p(){if(r)return a=!0,H(void 0);r=!0;var R=ko(h._readableStreamController);return R===null?v():f(R._view,!0),H(void 0)}function g(R){if(o=!0,s=R,i){var w=vr([s,u]),S=we(t,w);y(S)}return d}function _(R){if(i=!0,u=R,o){var w=vr([s,u]),S=we(t,w);y(S)}return d}function A(){}return c=Cs(A,b,g),h=Cs(A,p,_),m(e),[c,h]}function ud(t,e){At(t,e);var r=t,n=r?.autoAllocateChunkSize,a=r?.cancel,o=r?.pull,i=r?.start,s=r?.type;return{autoAllocateChunkSize:n===void 0?void 0:Fu(n,e+" has member 'autoAllocateChunkSize' that"),cancel:a===void 0?void 0:ld(a,r,e+" has member 'cancel' that"),pull:o===void 0?void 0:cd(o,r,e+" has member 'pull' that"),start:i===void 0?void 0:fd(i,r,e+" has member 'start' that"),type:s===void 0?void 0:dd(s,e+" has member 'type' that")}}function ld(t,e,r){return st(t,r),function(n){return Or(t,e,[n])}}function cd(t,e,r){return st(t,r),function(n){return Or(t,e,[n])}}function fd(t,e,r){return st(t,r),function(n){return mi(t,e,[n])}}function dd(t,e){if(t=""+t,t!=="bytes")throw new TypeError(e+" '"+t+"' is not a valid enumeration value for ReadableStreamType");return t}function hd(t,e){At(t,e);var r=t?.mode;return{mode:r===void 0?void 0:pd(r,e+" has member 'mode' that")}}function pd(t,e){if(t=""+t,t!=="byob")throw new TypeError(e+" '"+t+"' is not a valid enumeration value for ReadableStreamReaderMode");return t}function yd(t,e){At(t,e);var r=t?.preventCancel;return{preventCancel:!!r}}function As(t,e){At(t,e);var r=t?.preventAbort,n=t?.preventCancel,a=t?.preventClose,o=t?.signal;return o!==void 0&&md(o,e+" has member 'signal' that"),{preventAbort:!!r,preventCancel:!!n,preventClose:!!a,signal:o}}function md(t,e){if(!Cf(t))throw new TypeError(e+" is not an AbortSignal.")}function bd(t,e){At(t,e);var r=t?.readable;bs(r,"readable","ReadableWritablePair"),Si(r,e+" has member 'readable' that");var n=t?.writable;return bs(n,"writable","ReadableWritablePair"),tl(n,e+" has member 'writable' that"),{readable:r,writable:n}}var rt=function(){function t(e,r){e===void 0&&(e={}),r===void 0&&(r={}),e===void 0?e=null:ku(e,"First parameter");var n=el(r,"Second parameter"),a=ud(e,"First parameter");if(Ni(this),a.type==="bytes"){if(n.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");var o=xo(n,0);gf(this,a,o)}else{var i=Zu(n),o=xo(n,1);ad(this,a,o,i)}}return Object.defineProperty(t.prototype,"locked",{get:function(){if(!Ve(this))throw dt("locked");return Ze(this)},enumerable:!1,configurable:!0}),t.prototype.cancel=function(e){return e===void 0&&(e=void 0),Ve(this)?Ze(this)?j(new TypeError("Cannot cancel a stream that already has a reader")):we(this,e):j(dt("cancel"))},t.prototype.getReader=function(e){if(e===void 0&&(e=void 0),!Ve(this))throw dt("getReader");var r=hd(e,"First parameter");return r.mode===void 0?$t(this):Yu(this)},t.prototype.pipeThrough=function(e,r){if(r===void 0&&(r={}),!Ve(this))throw dt("pipeThrough");St(e,1,"pipeThrough");var n=bd(e,"First parameter"),a=As(r,"Second parameter");if(Ze(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Dt(n.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");var o=Ps(this,n.writable,a.preventClose,a.preventAbort,a.preventCancel,a.signal);return Tr(o),n.readable},t.prototype.pipeTo=function(e,r){if(r===void 0&&(r={}),!Ve(this))return j(dt("pipeTo"));if(e===void 0)return j("Parameter 1 is required in 'pipeTo'.");if(!jt(e))return j(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));var n;try{n=As(r,"Second parameter")}catch(a){return j(a)}return Ze(this)?j(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Dt(e)?j(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Ps(this,e,n.preventClose,n.preventAbort,n.preventCancel,n.signal)},t.prototype.tee=function(){if(!Ve(this))throw dt("tee");var e=od(this);return vr(e)},t.prototype.values=function(e){if(e===void 0&&(e=void 0),!Ve(this))throw dt("values");var r=yd(e,"First parameter");return ff(this,r.preventCancel)},t}();Object.defineProperties(rt.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}});typeof K.toStringTag=="symbol"&&Object.defineProperty(rt.prototype,K.toStringTag,{value:"ReadableStream",configurable:!0});typeof K.asyncIterator=="symbol"&&Object.defineProperty(rt.prototype,K.asyncIterator,{value:rt.prototype.values,writable:!0,configurable:!0});function Es(t,e,r,n,a){n===void 0&&(n=1),a===void 0&&(a=function(){return 1});var o=Object.create(rt.prototype);Ni(o);var i=Object.create(Ir.prototype);return yl(o,i,t,e,r,n,a),o}function Cs(t,e,r){var n=Object.create(rt.prototype);Ni(n);var a=Object.create(xr.prototype);return Ju(n,a,t,e,r,0,void 0),n}function Ni(t){t._state="readable",t._reader=void 0,t._storedError=void 0,t._disturbed=!1}function Ve(t){return!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_readableStreamController")?!1:t instanceof rt}function Ze(t){return t._reader!==void 0}function we(t,e){if(t._disturbed=!0,t._state==="closed")return H(void 0);if(t._state==="errored")return j(t._storedError);Fr(t);var r=t._reader;r!==void 0&&mt(r)&&(r._readIntoRequests.forEach(function(a){a._closeSteps(void 0)}),r._readIntoRequests=new Re);var n=t._readableStreamController[_i](e);return ia(n,hi)}function Fr(t){t._state="closed";var e=t._reader;e!==void 0&&(Cu(e),Xe(e)&&(e._readRequests.forEach(function(r){r._closeSteps()}),e._readRequests=new Re))}function ml(t,e){t._state="errored",t._storedError=e;var r=t._reader;r!==void 0&&(vi(r,e),Xe(r)?(r._readRequests.forEach(function(n){n._errorSteps(e)}),r._readRequests=new Re):(r._readIntoRequests.forEach(function(n){n._errorSteps(e)}),r._readIntoRequests=new Re))}function dt(t){return new TypeError("ReadableStream.prototype."+t+" can only be used on a ReadableStream")}var gd=function(t){return t.byteLength};try{Object.defineProperty(gd,"name",{value:"size",configurable:!0})}catch{}var vd=function(){return 1};try{Object.defineProperty(vd,"name",{value:"size",configurable:!0})}catch{}function _d(t,e){tt(t._readable._readableStreamController,e),Li(t,e)}function Li(t,e){wd(t._transformStreamController),Bi(t._writable._writableStreamController,e),t._backpressure&&bl(t,!1)}function bl(t,e){t._backpressureChangePromise!==void 0&&t._backpressureChangePromise_resolve(),t._backpressureChangePromise=de(function(r){t._backpressureChangePromise_resolve=r}),t._backpressure=e}var qi=function(){function t(){throw new TypeError("Illegal constructor")}return Object.defineProperty(t.prototype,"desiredSize",{get:function(){if(!Hn(this))throw Vn("desiredSize");var e=this._controlledTransformStream._readable._readableStreamController;return Di(e)},enumerable:!1,configurable:!0}),t.prototype.enqueue=function(e){if(e===void 0&&(e=void 0),!Hn(this))throw Vn("enqueue");Sd(this,e)},t.prototype.error=function(e){if(e===void 0&&(e=void 0),!Hn(this))throw Vn("error");Rd(this,e)},t.prototype.terminate=function(){if(!Hn(this))throw Vn("terminate");Pd(this)},t}();Object.defineProperties(qi.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}});typeof K.toStringTag=="symbol"&&Object.defineProperty(qi.prototype,K.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Hn(t){return!Pe(t)||!Object.prototype.hasOwnProperty.call(t,"_controlledTransformStream")?!1:t instanceof qi}function wd(t){t._transformAlgorithm=void 0,t._flushAlgorithm=void 0}function Sd(t,e){var r=t._controlledTransformStream,n=r._readable._readableStreamController;if(!Kt(n))throw new TypeError("Readable side is not in a state that permits enqueue");try{Oa(n,e)}catch(o){throw Li(r,o),r._readable._storedError}var a=nd(n);a!==r._backpressure&&bl(r,!0)}function Rd(t,e){_d(t._controlledTransformStream,e)}function Pd(t){var e=t._controlledTransformStream,r=e._readable._readableStreamController;Ta(r);var n=new TypeError("TransformStream terminated");Li(e,n)}function Vn(t){return new TypeError("TransformStreamDefaultController.prototype."+t+" can only be used on a TransformStreamDefaultController")}async function Ts(t){const e=t.getReader();let r="";for(;;){const{done:n,value:a}=await e.read();if(n)break;const o=new TextDecoder().decode(a);r+=o}return r}async function Ad(t,e){return new Promise((r,n)=>{(async()=>{const{signal:a,...o}=e;if(a?.aborted){n(new DOMException("Aborted","AbortError"));return}const i=Qc()?rt:window.ReadableStream,s=new TextEncoder;let u=!1;const h=(await import("./browser-polyfill-83de79d0.js").then(v=>v.b)).default.runtime.connect({name:Zc.fetch}),y={type:"open",details:{url:t,options:o}},d=new i({start(v){h.onMessage.addListener(f=>{const{data:b,error:p,...g}=f;if(p){const _=new Error;_.message=p.message,_.name=p.name,v.error(_);return}v.enqueue(s.encode(b)),u||(r({...g,body:d,text:()=>Ts(d),json:async()=>{const _=await Ts(d);return JSON.parse(_)}}),u=!0)}),h.onDisconnect.addListener(()=>{a?.removeEventListener("abort",m);try{v.close()}catch{}}),h.postMessage(y)}});function m(){h.postMessage({type:"abort"})}a?.addEventListener("abort",m)})()})}async function Wt(t,e={},r){return window.__TAURI_INTERNALS__.invoke(t,e,r)}var ka;(function(t){t[t.Audio=1]="Audio",t[t.Cache=2]="Cache",t[t.Config=3]="Config",t[t.Data=4]="Data",t[t.LocalData=5]="LocalData",t[t.Document=6]="Document",t[t.Download=7]="Download",t[t.Picture=8]="Picture",t[t.Public=9]="Public",t[t.Video=10]="Video",t[t.Resource=11]="Resource",t[t.Temp=12]="Temp",t[t.AppConfig=13]="AppConfig",t[t.AppData=14]="AppData",t[t.AppLocalData=15]="AppLocalData",t[t.AppCache=16]="AppCache",t[t.AppLog=17]="AppLog",t[t.Desktop=18]="Desktop",t[t.Executable=19]="Executable",t[t.Font=20]="Font",t[t.Home=21]="Home",t[t.Runtime=22]="Runtime",t[t.Template=23]="Template"})(ka||(ka={}));var Fo;(function(t){t[t.Start=0]="Start",t[t.Current=1]="Current",t[t.End=2]="End"})(Fo||(Fo={}));async function Ed(t,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");const r=await Wt("plugin:fs|read_file",{path:t instanceof URL?t.toString():t,options:e});return r instanceof ArrayBuffer?new Uint8Array(r):Uint8Array.from(r)}async function gl(t,e,r){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");await Wt("plugin:fs|write_text_file",{path:t instanceof URL?t.toString():t,data:e,options:r})}const Cd=Object.freeze(Object.defineProperty({__proto__:null,get BaseDirectory(){return ka},get SeekMode(){return Fo},readFile:Ed,writeTextFile:gl},Symbol.toStringTag,{value:"Module"}));async function Td(t,e){const r=e?.maxRedirections,n=e?.connectTimeout,a=e?.proxy;e&&(delete e.maxRedirections,delete e.connectTimeout,delete e.proxy);const o=e?.signal,i=e?.headers?e.headers instanceof Headers?e.headers:new Headers(e.headers):new Headers,s=new Request(t,e),u=await s.arrayBuffer(),c=u.byteLength!==0?Array.from(new Uint8Array(u)):null;for(const[A,R]of s.headers)i.get(A)||i.set(A,R);const y=(i instanceof Headers?Array.from(i.entries()):Array.isArray(i)?i:Object.entries(i)).map(([A,R])=>[A,typeof R=="string"?R:R.toString()]),d=await Wt("plugin:http|fetch",{clientConfig:{method:s.method,url:s.url,headers:y,data:c,maxRedirections:r,connectTimeout:n,proxy:a}});o?.addEventListener("abort",()=>{Wt("plugin:http|fetch_cancel",{rid:d})});const{status:m,statusText:v,url:f,headers:b,rid:p}=await Wt("plugin:http|fetch_send",{rid:d}),g=await Wt("plugin:http|fetch_read_body",{rid:p}),_=new Response(g instanceof ArrayBuffer&&g.byteLength!==0?g:g instanceof Array&&g.length>0?new Uint8Array(g):null,{headers:b,status:m,statusText:v});return Object.defineProperty(_,"url",{value:f}),_}async function Os(){const t=await fi.getConfigContent();return JSON.parse(t)}let Od=class{async get(e){const r=await Os();return e.reduce((n,a)=>({...n,[a]:r[a]}),{})}async set(e){const r=Object.entries(e).reduce((o,[i,s])=>s===void 0?o:{...o,[i]:s},{}),a={...await Os(),...r};await gl("config.json",JSON.stringify(a),{baseDir:ka.AppConfig})}},kd=class{sync;constructor(){this.sync=new Od}},xd=class{addListener(e){}removeListener(e){}},Id=class{onMessage;constructor(){this.onMessage=new xd}sendMessage(e){}getURL(e){return e}},Fd=class{detectLanguage(e){return new Promise(r=>{r({languages:[]})})}},Bd=class{storage;runtime;i18n;constructor(){this.storage=new kd,this.runtime=new Id,this.i18n=new Fd}};const Md=new Bd,vl=(t,e)=>{const r=_l(t,e);if(r)return{all:r,http:r,https:r}},_l=(t,e)=>{if(!t||!e&&!t.enabled||!t.protocol||!t.server||!t.port)return;const n={url:`${t.protocol?.toLowerCase()}://${t.server}:${t.port}`,noProxy:t.noProxy};return t.basicAuth?.username&&(n.basicAuth={username:t.basicAuth?.username||"",password:t.basicAuth?.password||""}),n},wl=async(t,e)=>{const r=await xe(),n=vl(r.proxy,!1),a={...e,proxy:n};return await Td(t,a)},jd=Object.freeze(Object.defineProperty({__proto__:null,getFetchProxy:vl,getFetchProxyConfig:_l,tauriBrowser:Md,tauriFetch:wl},Symbol.toStringTag,{value:"Module"}));class Wd{async get(e){const r={};for(const n of e)r[n]=await GM.getValue(n,null);return r}async set(e){Object.entries(e).forEach(async([r,n])=>{n&&await GM.setValue(r,n)})}}class Dd{sync;constructor(){this.sync=new Wd}}class Nd{addListener(e){}removeListener(e){}}class Ld{onMessage;constructor(){this.onMessage=new Nd}sendMessage(e){}getURL(e){return GM_getResourceURL(e)}}class qd{detectLanguage(e){return new Promise(r=>{r({languages:[]})})}}class zd{storage;runtime;i18n;constructor(){this.storage=new Dd,this.runtime=new Ld,this.i18n=new qd}}const Ud=new zd;async function ks(t){const e=t.getReader(),{value:r}=await e.read(),n=new TextDecoder().decode(r);return e.releaseLock(),n}async function Sl(t,{body:e,headers:r,method:n,signal:a}){const o=GM_xmlhttpRequest?.RESPONSE_TYPE_STREAM==="stream";return new Promise(i=>{const s=GM_xmlhttpRequest({url:t,data:e,headers:r,method:n,responseType:o?"stream":"text",onreadystatechange:async u=>{Object.assign(u,{status:u.status}),o?u.readyState===XMLHttpRequest.HEADERS_RECEIVED&&i({...u,body:u.response,json:async()=>JSON.parse(await ks(u.response)),text:async()=>await ks(u.response)}):u.readyState===XMLHttpRequest.DONE&&i({...u,body:new ReadableStream({start(c){const h=new TextEncoder().encode(u.response);c.enqueue(h)}}),text:()=>u.response,json:()=>JSON.parse(u.response)})}});a?.addEventListener("abort",()=>{s.abort()})})}const $d=Object.freeze(Object.defineProperty({__proto__:null,userscriptBrowser:Ud,userscriptFetch:Sl},Symbol.toStringTag,{value:"Module"}));function Ke(){return di()?Sl:gr()?wl:Ad}var Kd=Error,Gd=EvalError,Hd=RangeError,Vd=ReferenceError,Rl=SyntaxError,Br=TypeError,Jd=URIError,Yd=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var a=42;e[r]=a;for(r in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var i=Object.getOwnPropertyDescriptor(e,r);if(i.value!==a||i.enumerable!==!0)return!1}return!0},xs=typeof Symbol<"u"&&Symbol,Qd=Yd,Xd=function(){return typeof xs!="function"||typeof Symbol!="function"||typeof xs("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:Qd()},lo={__proto__:null,foo:{}},Zd=Object,eh=function(){return{__proto__:lo}.foo===lo.foo&&!(lo instanceof Zd)},th="Function.prototype.bind called on incompatible ",rh=Object.prototype.toString,nh=Math.max,ah="[object Function]",Is=function(e,r){for(var n=[],a=0;a<e.length;a+=1)n[a]=e[a];for(var o=0;o<r.length;o+=1)n[o+e.length]=r[o];return n},oh=function(e,r){for(var n=[],a=r||0,o=0;a<e.length;a+=1,o+=1)n[o]=e[a];return n},ih=function(t,e){for(var r="",n=0;n<t.length;n+=1)r+=t[n],n+1<t.length&&(r+=e);return r},sh=function(e){var r=this;if(typeof r!="function"||rh.apply(r)!==ah)throw new TypeError(th+r);for(var n=oh(arguments,1),a,o=function(){if(this instanceof a){var h=r.apply(this,Is(n,arguments));return Object(h)===h?h:this}return r.apply(e,Is(n,arguments))},i=nh(0,r.length-n.length),s=[],u=0;u<i;u++)s[u]="$"+u;if(a=Function("binder","return function ("+ih(s,",")+"){ return binder.apply(this,arguments); }")(o),r.prototype){var c=function(){};c.prototype=r.prototype,a.prototype=new c,c.prototype=null}return a},uh=sh,zi=Function.prototype.bind||uh,lh=Function.prototype.call,ch=Object.prototype.hasOwnProperty,fh=zi,dh=fh.call(lh,ch),U,hh=Kd,ph=Gd,yh=Hd,mh=Vd,Gt=Rl,Nt=Br,bh=Jd,Pl=Function,co=function(t){try{return Pl('"use strict"; return ('+t+").constructor;")()}catch{}},gt=Object.getOwnPropertyDescriptor;if(gt)try{gt({},"")}catch{gt=null}var fo=function(){throw new Nt},gh=gt?function(){try{return arguments.callee,fo}catch{try{return gt(arguments,"callee").get}catch{return fo}}}():fo,kt=Xd(),vh=eh(),ne=Object.getPrototypeOf||(vh?function(t){return t.__proto__}:null),Bt={},_h=typeof Uint8Array>"u"||!ne?U:ne(Uint8Array),vt={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?U:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?U:ArrayBuffer,"%ArrayIteratorPrototype%":kt&&ne?ne([][Symbol.iterator]()):U,"%AsyncFromSyncIteratorPrototype%":U,"%AsyncFunction%":Bt,"%AsyncGenerator%":Bt,"%AsyncGeneratorFunction%":Bt,"%AsyncIteratorPrototype%":Bt,"%Atomics%":typeof Atomics>"u"?U:Atomics,"%BigInt%":typeof BigInt>"u"?U:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?U:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?U:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?U:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":hh,"%eval%":eval,"%EvalError%":ph,"%Float32Array%":typeof Float32Array>"u"?U:Float32Array,"%Float64Array%":typeof Float64Array>"u"?U:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?U:FinalizationRegistry,"%Function%":Pl,"%GeneratorFunction%":Bt,"%Int8Array%":typeof Int8Array>"u"?U:Int8Array,"%Int16Array%":typeof Int16Array>"u"?U:Int16Array,"%Int32Array%":typeof Int32Array>"u"?U:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":kt&&ne?ne(ne([][Symbol.iterator]())):U,"%JSON%":typeof JSON=="object"?JSON:U,"%Map%":typeof Map>"u"?U:Map,"%MapIteratorPrototype%":typeof Map>"u"||!kt||!ne?U:ne(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?U:Promise,"%Proxy%":typeof Proxy>"u"?U:Proxy,"%RangeError%":yh,"%ReferenceError%":mh,"%Reflect%":typeof Reflect>"u"?U:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?U:Set,"%SetIteratorPrototype%":typeof Set>"u"||!kt||!ne?U:ne(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?U:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":kt&&ne?ne(""[Symbol.iterator]()):U,"%Symbol%":kt?Symbol:U,"%SyntaxError%":Gt,"%ThrowTypeError%":gh,"%TypedArray%":_h,"%TypeError%":Nt,"%Uint8Array%":typeof Uint8Array>"u"?U:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?U:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?U:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?U:Uint32Array,"%URIError%":bh,"%WeakMap%":typeof WeakMap>"u"?U:WeakMap,"%WeakRef%":typeof WeakRef>"u"?U:WeakRef,"%WeakSet%":typeof WeakSet>"u"?U:WeakSet};if(ne)try{null.error}catch(t){var wh=ne(ne(t));vt["%Error.prototype%"]=wh}var Sh=function t(e){var r;if(e==="%AsyncFunction%")r=co("async function () {}");else if(e==="%GeneratorFunction%")r=co("function* () {}");else if(e==="%AsyncGeneratorFunction%")r=co("async function* () {}");else if(e==="%AsyncGenerator%"){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var a=t("%AsyncGenerator%");a&&ne&&(r=ne(a.prototype))}return vt[e]=r,r},Fs={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Mr=zi,xa=dh,Rh=Mr.call(Function.call,Array.prototype.concat),Ph=Mr.call(Function.apply,Array.prototype.splice),Bs=Mr.call(Function.call,String.prototype.replace),Ia=Mr.call(Function.call,String.prototype.slice),Ah=Mr.call(Function.call,RegExp.prototype.exec),Eh=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ch=/\\(\\)?/g,Th=function(e){var r=Ia(e,0,1),n=Ia(e,-1);if(r==="%"&&n!=="%")throw new Gt("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Gt("invalid intrinsic syntax, expected opening `%`");var a=[];return Bs(e,Eh,function(o,i,s,u){a[a.length]=s?Bs(u,Ch,"$1"):i||o}),a},Oh=function(e,r){var n=e,a;if(xa(Fs,n)&&(a=Fs[n],n="%"+a[0]+"%"),xa(vt,n)){var o=vt[n];if(o===Bt&&(o=Sh(n)),typeof o>"u"&&!r)throw new Nt("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:a,name:n,value:o}}throw new Gt("intrinsic "+e+" does not exist!")},Qt=function(e,r){if(typeof e!="string"||e.length===0)throw new Nt("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new Nt('"allowMissing" argument must be a boolean');if(Ah(/^%?[^%]*%?$/,e)===null)throw new Gt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=Th(e),a=n.length>0?n[0]:"",o=Oh("%"+a+"%",r),i=o.name,s=o.value,u=!1,c=o.alias;c&&(a=c[0],Ph(n,Rh([0,1],c)));for(var h=1,y=!0;h<n.length;h+=1){var d=n[h],m=Ia(d,0,1),v=Ia(d,-1);if((m==='"'||m==="'"||m==="`"||v==='"'||v==="'"||v==="`")&&m!==v)throw new Gt("property names with quotes must have matching quotes");if((d==="constructor"||!y)&&(u=!0),a+="."+d,i="%"+a+"%",xa(vt,i))s=vt[i];else if(s!=null){if(!(d in s)){if(!r)throw new Nt("base intrinsic for "+e+" exists, but the property is not available.");return}if(gt&&h+1>=n.length){var f=gt(s,d);y=!!f,y&&"get"in f&&!("originalValue"in f.get)?s=f.get:s=s[d]}else y=xa(s,d),s=s[d];y&&!u&&(vt[i]=s)}}return s},Al={exports:{}},ho,Ms;function Ui(){if(Ms)return ho;Ms=1;var t=Qt,e=t("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return ho=e,ho}var kh=Qt,fa=kh("%Object.getOwnPropertyDescriptor%",!0);if(fa)try{fa([],"length")}catch{fa=null}var El=fa,js=Ui(),xh=Rl,xt=Br,Ws=El,Ih=function(e,r,n){if(!e||typeof e!="object"&&typeof e!="function")throw new xt("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new xt("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new xt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new xt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new xt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new xt("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,i=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,u=!!Ws&&Ws(e,r);if(js)js(e,r,{configurable:i===null&&u?u.configurable:!i,enumerable:a===null&&u?u.enumerable:!a,value:n,writable:o===null&&u?u.writable:!o});else if(s||!a&&!o&&!i)e[r]=n;else throw new xh("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Bo=Ui(),Cl=function(){return!!Bo};Cl.hasArrayLengthDefineBug=function(){if(!Bo)return null;try{return Bo([],"length",{value:1}).length!==1}catch{return!0}};var Fh=Cl,Bh=Qt,Ds=Ih,Mh=Fh(),Ns=El,Ls=Br,jh=Bh("%Math.floor%"),Wh=function(e,r){if(typeof e!="function")throw new Ls("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||jh(r)!==r)throw new Ls("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],a=!0,o=!0;if("length"in e&&Ns){var i=Ns(e,"length");i&&!i.configurable&&(a=!1),i&&!i.writable&&(o=!1)}return(a||o||!n)&&(Mh?Ds(e,"length",r,!0,!0):Ds(e,"length",r)),e};(function(t){var e=zi,r=Qt,n=Wh,a=Br,o=r("%Function.prototype.apply%"),i=r("%Function.prototype.call%"),s=r("%Reflect.apply%",!0)||e.call(i,o),u=Ui(),c=r("%Math.max%");t.exports=function(d){if(typeof d!="function")throw new a("a function is required");var m=s(e,i,arguments);return n(m,1+c(0,d.length-(arguments.length-1)),!0)};var h=function(){return s(e,o,arguments)};u?u(t.exports,"apply",{value:h}):t.exports.apply=h})(Al);var Dh=Al.exports,Tl=Qt,Ol=Dh,Nh=Ol(Tl("String.prototype.indexOf")),Lh=function(e,r){var n=Tl(e,!!r);return typeof n=="function"&&Nh(e,".prototype.")>-1?Ol(n):n};const qh={},zh=Object.freeze(Object.defineProperty({__proto__:null,default:qh},Symbol.toStringTag,{value:"Module"})),Uh=wc(zh);var $i=typeof Map=="function"&&Map.prototype,po=Object.getOwnPropertyDescriptor&&$i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Fa=$i&&po&&typeof po.get=="function"?po.get:null,qs=$i&&Map.prototype.forEach,Ki=typeof Set=="function"&&Set.prototype,yo=Object.getOwnPropertyDescriptor&&Ki?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Ba=Ki&&yo&&typeof yo.get=="function"?yo.get:null,zs=Ki&&Set.prototype.forEach,$h=typeof WeakMap=="function"&&WeakMap.prototype,cr=$h?WeakMap.prototype.has:null,Kh=typeof WeakSet=="function"&&WeakSet.prototype,fr=Kh?WeakSet.prototype.has:null,Gh=typeof WeakRef=="function"&&WeakRef.prototype,Us=Gh?WeakRef.prototype.deref:null,Hh=Boolean.prototype.valueOf,Vh=Object.prototype.toString,Jh=Function.prototype.toString,Yh=String.prototype.match,Gi=String.prototype.slice,et=String.prototype.replace,Qh=String.prototype.toUpperCase,$s=String.prototype.toLowerCase,kl=RegExp.prototype.test,Ks=Array.prototype.concat,Oe=Array.prototype.join,Xh=Array.prototype.slice,Gs=Math.floor,Mo=typeof BigInt=="function"?BigInt.prototype.valueOf:null,mo=Object.getOwnPropertySymbols,jo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ht=typeof Symbol=="function"&&typeof Symbol.iterator=="object",le=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ht||"symbol")?Symbol.toStringTag:null,xl=Object.prototype.propertyIsEnumerable,Hs=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function Vs(t,e){if(t===1/0||t===-1/0||t!==t||t&&t>-1e3&&t<1e3||kl.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof t=="number"){var n=t<0?-Gs(-t):Gs(t);if(n!==t){var a=String(n),o=Gi.call(e,a.length+1);return et.call(a,r,"$&_")+"."+et.call(et.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return et.call(e,r,"$&_")}var Wo=Uh,Js=Wo.custom,Ys=Fl(Js)?Js:null,Zh=function t(e,r,n,a){var o=r||{};if(Ye(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ye(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var i=Ye(o,"customInspect")?o.customInspect:!0;if(typeof i!="boolean"&&i!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ye(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ye(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var s=o.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Ml(e,o);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var u=String(e);return s?Vs(e,u):u}if(typeof e=="bigint"){var c=String(e)+"n";return s?Vs(e,c):c}var h=typeof o.depth>"u"?5:o.depth;if(typeof n>"u"&&(n=0),n>=h&&h>0&&typeof e=="object")return Do(e)?"[Array]":"[Object]";var y=bp(o,n);if(typeof a>"u")a=[];else if(Bl(a,e)>=0)return"[Circular]";function d($,z,be){if(z&&(a=Xh.call(a),a.push(z)),be){var ce={depth:o.depth};return Ye(o,"quoteStyle")&&(ce.quoteStyle=o.quoteStyle),t($,ce,n+1,a)}return t($,o,n+1,a)}if(typeof e=="function"&&!Qs(e)){var m=up(e),v=Jn(e,d);return"[Function"+(m?": "+m:" (anonymous)")+"]"+(v.length>0?" { "+Oe.call(v,", ")+" }":"")}if(Fl(e)){var f=Ht?et.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):jo.call(e);return typeof e=="object"&&!Ht?ar(f):f}if(pp(e)){for(var b="<"+$s.call(String(e.nodeName)),p=e.attributes||[],g=0;g<p.length;g++)b+=" "+p[g].name+"="+Il(ep(p[g].value),"double",o);return b+=">",e.childNodes&&e.childNodes.length&&(b+="..."),b+="</"+$s.call(String(e.nodeName))+">",b}if(Do(e)){if(e.length===0)return"[]";var _=Jn(e,d);return y&&!mp(_)?"["+No(_,y)+"]":"[ "+Oe.call(_,", ")+" ]"}if(rp(e)){var A=Jn(e,d);return!("cause"in Error.prototype)&&"cause"in e&&!xl.call(e,"cause")?"{ ["+String(e)+"] "+Oe.call(Ks.call("[cause]: "+d(e.cause),A),", ")+" }":A.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+Oe.call(A,", ")+" }"}if(typeof e=="object"&&i){if(Ys&&typeof e[Ys]=="function"&&Wo)return Wo(e,{depth:h-n});if(i!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(lp(e)){var R=[];return qs&&qs.call(e,function($,z){R.push(d(z,e,!0)+" => "+d($,e))}),Xs("Map",Fa.call(e),R,y)}if(dp(e)){var w=[];return zs&&zs.call(e,function($){w.push(d($,e))}),Xs("Set",Ba.call(e),w,y)}if(cp(e))return bo("WeakMap");if(hp(e))return bo("WeakSet");if(fp(e))return bo("WeakRef");if(ap(e))return ar(d(Number(e)));if(ip(e))return ar(d(Mo.call(e)));if(op(e))return ar(Hh.call(e));if(np(e))return ar(d(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(e===hu)return"{ [object globalThis] }";if(!tp(e)&&!Qs(e)){var S=Jn(e,d),C=Hs?Hs(e)===Object.prototype:e instanceof Object||e.constructor===Object,T=e instanceof Object?"":"null prototype",D=!C&&le&&Object(e)===e&&le in e?Gi.call(lt(e),8,-1):T?"Object":"",L=C||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",q=L+(D||T?"["+Oe.call(Ks.call([],D||[],T||[]),": ")+"] ":"");return S.length===0?q+"{}":y?q+"{"+No(S,y)+"}":q+"{ "+Oe.call(S,", ")+" }"}return String(e)};function Il(t,e,r){var n=(r.quoteStyle||e)==="double"?'"':"'";return n+t+n}function ep(t){return et.call(String(t),/"/g,"&quot;")}function Do(t){return lt(t)==="[object Array]"&&(!le||!(typeof t=="object"&&le in t))}function tp(t){return lt(t)==="[object Date]"&&(!le||!(typeof t=="object"&&le in t))}function Qs(t){return lt(t)==="[object RegExp]"&&(!le||!(typeof t=="object"&&le in t))}function rp(t){return lt(t)==="[object Error]"&&(!le||!(typeof t=="object"&&le in t))}function np(t){return lt(t)==="[object String]"&&(!le||!(typeof t=="object"&&le in t))}function ap(t){return lt(t)==="[object Number]"&&(!le||!(typeof t=="object"&&le in t))}function op(t){return lt(t)==="[object Boolean]"&&(!le||!(typeof t=="object"&&le in t))}function Fl(t){if(Ht)return t&&typeof t=="object"&&t instanceof Symbol;if(typeof t=="symbol")return!0;if(!t||typeof t!="object"||!jo)return!1;try{return jo.call(t),!0}catch{}return!1}function ip(t){if(!t||typeof t!="object"||!Mo)return!1;try{return Mo.call(t),!0}catch{}return!1}var sp=Object.prototype.hasOwnProperty||function(t){return t in this};function Ye(t,e){return sp.call(t,e)}function lt(t){return Vh.call(t)}function up(t){if(t.name)return t.name;var e=Yh.call(Jh.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}function Bl(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function lp(t){if(!Fa||!t||typeof t!="object")return!1;try{Fa.call(t);try{Ba.call(t)}catch{return!0}return t instanceof Map}catch{}return!1}function cp(t){if(!cr||!t||typeof t!="object")return!1;try{cr.call(t,cr);try{fr.call(t,fr)}catch{return!0}return t instanceof WeakMap}catch{}return!1}function fp(t){if(!Us||!t||typeof t!="object")return!1;try{return Us.call(t),!0}catch{}return!1}function dp(t){if(!Ba||!t||typeof t!="object")return!1;try{Ba.call(t);try{Fa.call(t)}catch{return!0}return t instanceof Set}catch{}return!1}function hp(t){if(!fr||!t||typeof t!="object")return!1;try{fr.call(t,fr);try{cr.call(t,cr)}catch{return!0}return t instanceof WeakSet}catch{}return!1}function pp(t){return!t||typeof t!="object"?!1:typeof HTMLElement<"u"&&t instanceof HTMLElement?!0:typeof t.nodeName=="string"&&typeof t.getAttribute=="function"}function Ml(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return Ml(Gi.call(t,0,e.maxStringLength),e)+n}var a=et.call(et.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,yp);return Il(a,"single",e)}function yp(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+Qh.call(e.toString(16))}function ar(t){return"Object("+t+")"}function bo(t){return t+" { ? }"}function Xs(t,e,r,n){var a=n?No(r,n):Oe.call(r,", ");return t+" ("+e+") {"+a+"}"}function mp(t){for(var e=0;e<t.length;e++)if(Bl(t[e],`
`)>=0)return!1;return!0}function bp(t,e){var r;if(t.indent==="	")r="	";else if(typeof t.indent=="number"&&t.indent>0)r=Oe.call(Array(t.indent+1)," ");else return null;return{base:r,prev:Oe.call(Array(e+1),r)}}function No(t,e){if(t.length===0)return"";var r=`
`+e.prev+e.base;return r+Oe.call(t,","+r)+`
`+e.prev}function Jn(t,e){var r=Do(t),n=[];if(r){n.length=t.length;for(var a=0;a<t.length;a++)n[a]=Ye(t,a)?e(t[a],t):""}var o=typeof mo=="function"?mo(t):[],i;if(Ht){i={};for(var s=0;s<o.length;s++)i["$"+o[s]]=o[s]}for(var u in t)Ye(t,u)&&(r&&String(Number(u))===u&&u<t.length||Ht&&i["$"+u]instanceof Symbol||(kl.call(/[^\w$]/,u)?n.push(e(u,t)+": "+e(t[u],t)):n.push(u+": "+e(t[u],t))));if(typeof mo=="function")for(var c=0;c<o.length;c++)xl.call(t,o[c])&&n.push("["+e(o[c])+"]: "+e(t[o[c]],t));return n}var jl=Qt,Xt=Lh,gp=Zh,vp=Br,Yn=jl("%WeakMap%",!0),Qn=jl("%Map%",!0),_p=Xt("WeakMap.prototype.get",!0),wp=Xt("WeakMap.prototype.set",!0),Sp=Xt("WeakMap.prototype.has",!0),Rp=Xt("Map.prototype.get",!0),Pp=Xt("Map.prototype.set",!0),Ap=Xt("Map.prototype.has",!0),Hi=function(t,e){for(var r=t,n;(n=r.next)!==null;r=n)if(n.key===e)return r.next=n.next,n.next=t.next,t.next=n,n},Ep=function(t,e){var r=Hi(t,e);return r&&r.value},Cp=function(t,e,r){var n=Hi(t,e);n?n.value=r:t.next={key:e,next:t.next,value:r}},Tp=function(t,e){return!!Hi(t,e)},Op=function(){var e,r,n,a={assert:function(o){if(!a.has(o))throw new vp("Side channel does not contain "+gp(o))},get:function(o){if(Yn&&o&&(typeof o=="object"||typeof o=="function")){if(e)return _p(e,o)}else if(Qn){if(r)return Rp(r,o)}else if(n)return Ep(n,o)},has:function(o){if(Yn&&o&&(typeof o=="object"||typeof o=="function")){if(e)return Sp(e,o)}else if(Qn){if(r)return Ap(r,o)}else if(n)return Tp(n,o);return!1},set:function(o,i){Yn&&o&&(typeof o=="object"||typeof o=="function")?(e||(e=new Yn),wp(e,o,i)):Qn?(r||(r=new Qn),Pp(r,o,i)):(n||(n={key:{},next:null}),Cp(n,o,i))}};return a},kp=String.prototype.replace,xp=/%20/g,go={RFC1738:"RFC1738",RFC3986:"RFC3986"},Vi={default:go.RFC3986,formatters:{RFC1738:function(t){return kp.call(t,xp,"+")},RFC3986:function(t){return String(t)}},RFC1738:go.RFC1738,RFC3986:go.RFC3986},Ip=Vi,vo=Object.prototype.hasOwnProperty,yt=Array.isArray,Ce=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),Fp=function(e){for(;e.length>1;){var r=e.pop(),n=r.obj[r.prop];if(yt(n)){for(var a=[],o=0;o<n.length;++o)typeof n[o]<"u"&&a.push(n[o]);r.obj[r.prop]=a}}},Wl=function(e,r){for(var n=r&&r.plainObjects?Object.create(null):{},a=0;a<e.length;++a)typeof e[a]<"u"&&(n[a]=e[a]);return n},Bp=function t(e,r,n){if(!r)return e;if(typeof r!="object"){if(yt(e))e.push(r);else if(e&&typeof e=="object")(n&&(n.plainObjects||n.allowPrototypes)||!vo.call(Object.prototype,r))&&(e[r]=!0);else return[e,r];return e}if(!e||typeof e!="object")return[e].concat(r);var a=e;return yt(e)&&!yt(r)&&(a=Wl(e,n)),yt(e)&&yt(r)?(r.forEach(function(o,i){if(vo.call(e,i)){var s=e[i];s&&typeof s=="object"&&o&&typeof o=="object"?e[i]=t(s,o,n):e.push(o)}else e[i]=o}),e):Object.keys(r).reduce(function(o,i){var s=r[i];return vo.call(o,i)?o[i]=t(o[i],s,n):o[i]=s,o},a)},Mp=function(e,r){return Object.keys(r).reduce(function(n,a){return n[a]=r[a],n},e)},jp=function(t,e,r){var n=t.replace(/\+/g," ");if(r==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},Wp=function(e,r,n,a,o){if(e.length===0)return e;var i=e;if(typeof e=="symbol"?i=Symbol.prototype.toString.call(e):typeof e!="string"&&(i=String(e)),n==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(h){return"%26%23"+parseInt(h.slice(2),16)+"%3B"});for(var s="",u=0;u<i.length;++u){var c=i.charCodeAt(u);if(c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||o===Ip.RFC1738&&(c===40||c===41)){s+=i.charAt(u);continue}if(c<128){s=s+Ce[c];continue}if(c<2048){s=s+(Ce[192|c>>6]+Ce[128|c&63]);continue}if(c<55296||c>=57344){s=s+(Ce[224|c>>12]+Ce[128|c>>6&63]+Ce[128|c&63]);continue}u+=1,c=65536+((c&1023)<<10|i.charCodeAt(u)&1023),s+=Ce[240|c>>18]+Ce[128|c>>12&63]+Ce[128|c>>6&63]+Ce[128|c&63]}return s},Dp=function(e){for(var r=[{obj:{o:e},prop:"o"}],n=[],a=0;a<r.length;++a)for(var o=r[a],i=o.obj[o.prop],s=Object.keys(i),u=0;u<s.length;++u){var c=s[u],h=i[c];typeof h=="object"&&h!==null&&n.indexOf(h)===-1&&(r.push({obj:i,prop:c}),n.push(h))}return Fp(r),e},Np=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},Lp=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},qp=function(e,r){return[].concat(e,r)},zp=function(e,r){if(yt(e)){for(var n=[],a=0;a<e.length;a+=1)n.push(r(e[a]));return n}return r(e)},Dl={arrayToObject:Wl,assign:Mp,combine:qp,compact:Dp,decode:jp,encode:Wp,isBuffer:Lp,isRegExp:Np,maybeMap:zp,merge:Bp},Nl=Op,da=Dl,dr=Vi,Up=Object.prototype.hasOwnProperty,Zs={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,r){return e+"["+r+"]"},repeat:function(e){return e}},We=Array.isArray,$p=Array.prototype.push,Ll=function(t,e){$p.apply(t,We(e)?e:[e])},Kp=Date.prototype.toISOString,eu=dr.default,ie={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:da.encode,encodeValuesOnly:!1,format:eu,formatter:dr.formatters[eu],indices:!1,serializeDate:function(e){return Kp.call(e)},skipNulls:!1,strictNullHandling:!1},Gp=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},_o={},Hp=function t(e,r,n,a,o,i,s,u,c,h,y,d,m,v,f,b){for(var p=e,g=b,_=0,A=!1;(g=g.get(_o))!==void 0&&!A;){var R=g.get(e);if(_+=1,typeof R<"u"){if(R===_)throw new RangeError("Cyclic object value");A=!0}typeof g.get(_o)>"u"&&(_=0)}if(typeof u=="function"?p=u(r,p):p instanceof Date?p=y(p):n==="comma"&&We(p)&&(p=da.maybeMap(p,function(ce){return ce instanceof Date?y(ce):ce})),p===null){if(o)return s&&!v?s(r,ie.encoder,f,"key",d):r;p=""}if(Gp(p)||da.isBuffer(p)){if(s){var w=v?r:s(r,ie.encoder,f,"key",d);return[m(w)+"="+m(s(p,ie.encoder,f,"value",d))]}return[m(r)+"="+m(String(p))]}var S=[];if(typeof p>"u")return S;var C;if(n==="comma"&&We(p))v&&s&&(p=da.maybeMap(p,s)),C=[{value:p.length>0?p.join(",")||null:void 0}];else if(We(u))C=u;else{var T=Object.keys(p);C=c?T.sort(c):T}for(var D=a&&We(p)&&p.length===1?r+"[]":r,L=0;L<C.length;++L){var q=C[L],$=typeof q=="object"&&typeof q.value<"u"?q.value:p[q];if(!(i&&$===null)){var z=We(p)?typeof n=="function"?n(D,q):D:D+(h?"."+q:"["+q+"]");b.set(e,_);var be=Nl();be.set(_o,b),Ll(S,t($,z,n,a,o,i,n==="comma"&&v&&We(p)?null:s,u,c,h,y,d,m,v,f,be))}}return S},Vp=function(e){if(!e)return ie;if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var r=e.charset||ie.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=dr.default;if(typeof e.format<"u"){if(!Up.call(dr.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var a=dr.formatters[n],o=ie.filter;return(typeof e.filter=="function"||We(e.filter))&&(o=e.filter),{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:ie.addQueryPrefix,allowDots:typeof e.allowDots>"u"?ie.allowDots:!!e.allowDots,charset:r,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:ie.charsetSentinel,delimiter:typeof e.delimiter>"u"?ie.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:ie.encode,encoder:typeof e.encoder=="function"?e.encoder:ie.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:ie.encodeValuesOnly,filter:o,format:n,formatter:a,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:ie.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:ie.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:ie.strictNullHandling}},Jp=function(t,e){var r=t,n=Vp(e),a,o;typeof n.filter=="function"?(o=n.filter,r=o("",r)):We(n.filter)&&(o=n.filter,a=o);var i=[];if(typeof r!="object"||r===null)return"";var s;e&&e.arrayFormat in Zs?s=e.arrayFormat:e&&"indices"in e?s=e.indices?"indices":"repeat":s="indices";var u=Zs[s];if(e&&"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var c=u==="comma"&&e&&e.commaRoundTrip;a||(a=Object.keys(r)),n.sort&&a.sort(n.sort);for(var h=Nl(),y=0;y<a.length;++y){var d=a[y];n.skipNulls&&r[d]===null||Ll(i,Hp(r[d],d,u,c,n.strictNullHandling,n.skipNulls,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,h))}var m=i.join(n.delimiter),v=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),m.length>0?v+m:""},Vt=Dl,Lo=Object.prototype.hasOwnProperty,Yp=Array.isArray,re={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:Vt.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Qp=function(t){return t.replace(/&#(\d+);/g,function(e,r){return String.fromCharCode(parseInt(r,10))})},ql=function(t,e){return t&&typeof t=="string"&&e.comma&&t.indexOf(",")>-1?t.split(","):t},Xp="utf8=%26%2310003%3B",Zp="utf8=%E2%9C%93",ey=function(e,r){var n={__proto__:null},a=r.ignoreQueryPrefix?e.replace(/^\?/,""):e,o=r.parameterLimit===1/0?void 0:r.parameterLimit,i=a.split(r.delimiter,o),s=-1,u,c=r.charset;if(r.charsetSentinel)for(u=0;u<i.length;++u)i[u].indexOf("utf8=")===0&&(i[u]===Zp?c="utf-8":i[u]===Xp&&(c="iso-8859-1"),s=u,u=i.length);for(u=0;u<i.length;++u)if(u!==s){var h=i[u],y=h.indexOf("]="),d=y===-1?h.indexOf("="):y+1,m,v;d===-1?(m=r.decoder(h,re.decoder,c,"key"),v=r.strictNullHandling?null:""):(m=r.decoder(h.slice(0,d),re.decoder,c,"key"),v=Vt.maybeMap(ql(h.slice(d+1),r),function(f){return r.decoder(f,re.decoder,c,"value")})),v&&r.interpretNumericEntities&&c==="iso-8859-1"&&(v=Qp(v)),h.indexOf("[]=")>-1&&(v=Yp(v)?[v]:v),Lo.call(n,m)?n[m]=Vt.combine(n[m],v):n[m]=v}return n},ty=function(t,e,r,n){for(var a=n?e:ql(e,r),o=t.length-1;o>=0;--o){var i,s=t[o];if(s==="[]"&&r.parseArrays)i=[].concat(a);else{i=r.plainObjects?Object.create(null):{};var u=s.charAt(0)==="["&&s.charAt(s.length-1)==="]"?s.slice(1,-1):s,c=parseInt(u,10);!r.parseArrays&&u===""?i={0:a}:!isNaN(c)&&s!==u&&String(c)===u&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(i=[],i[c]=a):u!=="__proto__"&&(i[u]=a)}a=i}return a},ry=function(e,r,n,a){if(e){var o=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/,s=/(\[[^[\]]*])/g,u=n.depth>0&&i.exec(o),c=u?o.slice(0,u.index):o,h=[];if(c){if(!n.plainObjects&&Lo.call(Object.prototype,c)&&!n.allowPrototypes)return;h.push(c)}for(var y=0;n.depth>0&&(u=s.exec(o))!==null&&y<n.depth;){if(y+=1,!n.plainObjects&&Lo.call(Object.prototype,u[1].slice(1,-1))&&!n.allowPrototypes)return;h.push(u[1])}return u&&h.push("["+o.slice(u.index)+"]"),ty(h,r,n,a)}},ny=function(e){if(!e)return re;if(e.decoder!==null&&e.decoder!==void 0&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=typeof e.charset>"u"?re.charset:e.charset;return{allowDots:typeof e.allowDots>"u"?re.allowDots:!!e.allowDots,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:re.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:re.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:re.arrayLimit,charset:r,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:re.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:re.comma,decoder:typeof e.decoder=="function"?e.decoder:re.decoder,delimiter:typeof e.delimiter=="string"||Vt.isRegExp(e.delimiter)?e.delimiter:re.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:re.depth,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:re.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:re.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:re.plainObjects,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:re.strictNullHandling}},ay=function(t,e){var r=ny(e);if(t===""||t===null||typeof t>"u")return r.plainObjects?Object.create(null):{};for(var n=typeof t=="string"?ey(t,r):t,a=r.plainObjects?Object.create(null):{},o=Object.keys(n),i=0;i<o.length;++i){var s=o[i],u=ry(s,n[s],r,typeof t=="string");a=Vt.merge(a,u,r)}return r.allowSparse===!0?a:Vt.compact(a)},oy=Jp,iy=ay,sy=Vi,uy={formats:sy,parse:iy,stringify:oy};const ly=_c(uy);class Ji{async checkLogin(){return!0}isLocal(){return!1}supportCustomModel(){return!1}}const Cm="__custom__",Tm="__yetone-openai-translator",cy=[{name:"Translate",mode:"translate",icon:"MdOutlineGTranslate"},{name:"Polishing",mode:"polishing",icon:"MdPalette"},{name:"Summarize",mode:"summarize",icon:"MdOutlineSummarize"},{name:"Analyze",mode:"analyze",icon:"MdOutlineAnalytics"},{name:"Explain Code",mode:"explain-code",icon:"MdCode"}],fy="cgb=vhwi";var zl={exports:{}};/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.9.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2023
 * @license MIT
 */(function(t){(function(){var e="input is invalid type",r="finalize already called",n=typeof window=="object",a=n?window:{};a.JS_SHA3_NO_WINDOW&&(n=!1);var o=!n&&typeof self=="object",i=!a.JS_SHA3_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;i?a=hu:o&&(a=self);for(var s=!a.JS_SHA3_NO_COMMON_JS&&!0&&t.exports,u=!a.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",c="0123456789abcdef".split(""),h=[31,7936,2031616,520093696],y=[4,1024,262144,67108864],d=[1,256,65536,16777216],m=[6,1536,393216,100663296],v=[0,8,16,24],f=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],b=[224,256,384,512],p=[128,256],g=["hex","buffer","arrayBuffer","array","digest"],_={128:168,256:136},A=a.JS_SHA3_NO_NODE_JS||!Array.isArray?function(l){return Object.prototype.toString.call(l)==="[object Array]"}:Array.isArray,R=u&&(a.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)?function(l){return typeof l=="object"&&l.buffer&&l.buffer.constructor===ArrayBuffer}:ArrayBuffer.isView,w=function(l){var P=typeof l;if(P==="string")return[l,!0];if(P!=="object"||l===null)throw new Error(e);if(u&&l.constructor===ArrayBuffer)return[new Uint8Array(l),!1];if(!A(l)&&!R(l))throw new Error(e);return[l,!1]},S=function(l){return w(l)[0].length===0},C=function(l){for(var P=[],E=0;E<l.length;++E)P[E]=l[E];return P},T=function(l,P,E){return function(O){return new X(l,P,l).update(O)[E]()}},D=function(l,P,E){return function(O,x){return new X(l,P,x).update(O)[E]()}},L=function(l,P,E){return function(O,x,F,W){return pe["cshake"+l].update(O,x,F,W)[E]()}},q=function(l,P,E){return function(O,x,F,W){return pe["kmac"+l].update(O,x,F,W)[E]()}},$=function(l,P,E,O){for(var x=0;x<g.length;++x){var F=g[x];l[F]=P(E,O,F)}return l},z=function(l,P){var E=T(l,P,"hex");return E.create=function(){return new X(l,P,l)},E.update=function(O){return E.create().update(O)},$(E,T,l,P)},be=function(l,P){var E=D(l,P,"hex");return E.create=function(O){return new X(l,P,O)},E.update=function(O,x){return E.create(x).update(O)},$(E,D,l,P)},ce=function(l,P){var E=_[l],O=L(l,P,"hex");return O.create=function(x,F,W){return S(F)&&S(W)?pe["shake"+l].create(x):new X(l,P,x).bytepad([F,W],E)},O.update=function(x,F,W,B){return O.create(F,W,B).update(x)},$(O,L,l,P)},oe=function(l,P){var E=_[l],O=q(l,P,"hex");return O.create=function(x,F,W){return new ro(l,P,F).bytepad(["KMAC",W],E).bytepad([x],E)},O.update=function(x,F,W,B){return O.create(x,W,B).update(F)},$(O,q,l,P)},Ee=[{name:"keccak",padding:d,bits:b,createMethod:z},{name:"sha3",padding:m,bits:b,createMethod:z},{name:"shake",padding:h,bits:p,createMethod:be},{name:"cshake",padding:y,bits:p,createMethod:ce},{name:"kmac",padding:y,bits:p,createMethod:oe}],pe={},Me=[],He=0;He<Ee.length;++He)for(var Tt=Ee[He],Nr=Tt.bits,tr=0;tr<Nr.length;++tr){var to=Tt.name+"_"+Nr[tr];if(Me.push(to),pe[to]=Tt.createMethod(Nr[tr],Tt.padding),Tt.name!=="sha3"){var us=Tt.name+Nr[tr];Me.push(us),pe[us]=pe[to]}}function X(l,P,E){this.blocks=[],this.s=[],this.padding=P,this.outputBits=E,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(l<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=E>>5,this.extraBytes=(E&31)>>3;for(var O=0;O<50;++O)this.s[O]=0}X.prototype.update=function(l){if(this.finalized)throw new Error(r);var P=w(l);l=P[0];for(var E=P[1],O=this.blocks,x=this.byteCount,F=l.length,W=this.blockCount,B=0,Z=this.s,N,Y;B<F;){if(this.reset)for(this.reset=!1,O[0]=this.block,N=1;N<W+1;++N)O[N]=0;if(E)for(N=this.start;B<F&&N<x;++B)Y=l.charCodeAt(B),Y<128?O[N>>2]|=Y<<v[N++&3]:Y<2048?(O[N>>2]|=(192|Y>>6)<<v[N++&3],O[N>>2]|=(128|Y&63)<<v[N++&3]):Y<55296||Y>=57344?(O[N>>2]|=(224|Y>>12)<<v[N++&3],O[N>>2]|=(128|Y>>6&63)<<v[N++&3],O[N>>2]|=(128|Y&63)<<v[N++&3]):(Y=65536+((Y&1023)<<10|l.charCodeAt(++B)&1023),O[N>>2]|=(240|Y>>18)<<v[N++&3],O[N>>2]|=(128|Y>>12&63)<<v[N++&3],O[N>>2]|=(128|Y>>6&63)<<v[N++&3],O[N>>2]|=(128|Y&63)<<v[N++&3]);else for(N=this.start;B<F&&N<x;++B)O[N>>2]|=l[B]<<v[N++&3];if(this.lastByteIndex=N,N>=x){for(this.start=N-x,this.block=O[W],N=0;N<W;++N)Z[N]^=O[N];rr(Z),this.reset=!0}else this.start=N}return this},X.prototype.encode=function(l,P){var E=l&255,O=1,x=[E];for(l=l>>8,E=l&255;E>0;)x.unshift(E),l=l>>8,E=l&255,++O;return P?x.push(O):x.unshift(O),this.update(x),x.length},X.prototype.encodeString=function(l){var P=w(l);l=P[0];var E=P[1],O=0,x=l.length;if(E)for(var F=0;F<l.length;++F){var W=l.charCodeAt(F);W<128?O+=1:W<2048?O+=2:W<55296||W>=57344?O+=3:(W=65536+((W&1023)<<10|l.charCodeAt(++F)&1023),O+=4)}else O=x;return O+=this.encode(O*8),this.update(l),O},X.prototype.bytepad=function(l,P){for(var E=this.encode(P),O=0;O<l.length;++O)E+=this.encodeString(l[O]);var x=(P-E%P)%P,F=[];return F.length=x,this.update(F),this},X.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var l=this.blocks,P=this.lastByteIndex,E=this.blockCount,O=this.s;if(l[P>>2]|=this.padding[P&3],this.lastByteIndex===this.byteCount)for(l[0]=l[E],P=1;P<E+1;++P)l[P]=0;for(l[E-1]|=2147483648,P=0;P<E;++P)O[P]^=l[P];rr(O)}},X.prototype.toString=X.prototype.hex=function(){this.finalize();for(var l=this.blockCount,P=this.s,E=this.outputBlocks,O=this.extraBytes,x=0,F=0,W="",B;F<E;){for(x=0;x<l&&F<E;++x,++F)B=P[x],W+=c[B>>4&15]+c[B&15]+c[B>>12&15]+c[B>>8&15]+c[B>>20&15]+c[B>>16&15]+c[B>>28&15]+c[B>>24&15];F%l===0&&(P=C(P),rr(P),x=0)}return O&&(B=P[x],W+=c[B>>4&15]+c[B&15],O>1&&(W+=c[B>>12&15]+c[B>>8&15]),O>2&&(W+=c[B>>20&15]+c[B>>16&15])),W},X.prototype.arrayBuffer=function(){this.finalize();var l=this.blockCount,P=this.s,E=this.outputBlocks,O=this.extraBytes,x=0,F=0,W=this.outputBits>>3,B;O?B=new ArrayBuffer(E+1<<2):B=new ArrayBuffer(W);for(var Z=new Uint32Array(B);F<E;){for(x=0;x<l&&F<E;++x,++F)Z[F]=P[x];F%l===0&&(P=C(P),rr(P))}return O&&(Z[F]=P[x],B=B.slice(0,W)),B},X.prototype.buffer=X.prototype.arrayBuffer,X.prototype.digest=X.prototype.array=function(){this.finalize();for(var l=this.blockCount,P=this.s,E=this.outputBlocks,O=this.extraBytes,x=0,F=0,W=[],B,Z;F<E;){for(x=0;x<l&&F<E;++x,++F)B=F<<2,Z=P[x],W[B]=Z&255,W[B+1]=Z>>8&255,W[B+2]=Z>>16&255,W[B+3]=Z>>24&255;F%l===0&&(P=C(P),rr(P))}return O&&(B=F<<2,Z=P[x],W[B]=Z&255,O>1&&(W[B+1]=Z>>8&255),O>2&&(W[B+2]=Z>>16&255)),W};function ro(l,P,E){X.call(this,l,P,E)}ro.prototype=new X,ro.prototype.finalize=function(){return this.encode(this.outputBits,!0),X.prototype.finalize.call(this)};var rr=function(l){var P,E,O,x,F,W,B,Z,N,Y,Lr,qr,zr,Ur,$r,Kr,Gr,Hr,Vr,Jr,Yr,Qr,Xr,Zr,en,tn,rn,nn,an,on,sn,un,ln,cn,fn,dn,hn,pn,yn,mn,bn,gn,vn,_n,wn,Sn,Rn,Pn,An,En,Cn,Tn,On,kn,xn,In,Fn,Bn,Mn,jn,Wn,Dn,Nn;for(O=0;O<48;O+=2)x=l[0]^l[10]^l[20]^l[30]^l[40],F=l[1]^l[11]^l[21]^l[31]^l[41],W=l[2]^l[12]^l[22]^l[32]^l[42],B=l[3]^l[13]^l[23]^l[33]^l[43],Z=l[4]^l[14]^l[24]^l[34]^l[44],N=l[5]^l[15]^l[25]^l[35]^l[45],Y=l[6]^l[16]^l[26]^l[36]^l[46],Lr=l[7]^l[17]^l[27]^l[37]^l[47],qr=l[8]^l[18]^l[28]^l[38]^l[48],zr=l[9]^l[19]^l[29]^l[39]^l[49],P=qr^(W<<1|B>>>31),E=zr^(B<<1|W>>>31),l[0]^=P,l[1]^=E,l[10]^=P,l[11]^=E,l[20]^=P,l[21]^=E,l[30]^=P,l[31]^=E,l[40]^=P,l[41]^=E,P=x^(Z<<1|N>>>31),E=F^(N<<1|Z>>>31),l[2]^=P,l[3]^=E,l[12]^=P,l[13]^=E,l[22]^=P,l[23]^=E,l[32]^=P,l[33]^=E,l[42]^=P,l[43]^=E,P=W^(Y<<1|Lr>>>31),E=B^(Lr<<1|Y>>>31),l[4]^=P,l[5]^=E,l[14]^=P,l[15]^=E,l[24]^=P,l[25]^=E,l[34]^=P,l[35]^=E,l[44]^=P,l[45]^=E,P=Z^(qr<<1|zr>>>31),E=N^(zr<<1|qr>>>31),l[6]^=P,l[7]^=E,l[16]^=P,l[17]^=E,l[26]^=P,l[27]^=E,l[36]^=P,l[37]^=E,l[46]^=P,l[47]^=E,P=Y^(x<<1|F>>>31),E=Lr^(F<<1|x>>>31),l[8]^=P,l[9]^=E,l[18]^=P,l[19]^=E,l[28]^=P,l[29]^=E,l[38]^=P,l[39]^=E,l[48]^=P,l[49]^=E,Ur=l[0],$r=l[1],Sn=l[11]<<4|l[10]>>>28,Rn=l[10]<<4|l[11]>>>28,nn=l[20]<<3|l[21]>>>29,an=l[21]<<3|l[20]>>>29,jn=l[31]<<9|l[30]>>>23,Wn=l[30]<<9|l[31]>>>23,gn=l[40]<<18|l[41]>>>14,vn=l[41]<<18|l[40]>>>14,cn=l[2]<<1|l[3]>>>31,fn=l[3]<<1|l[2]>>>31,Kr=l[13]<<12|l[12]>>>20,Gr=l[12]<<12|l[13]>>>20,Pn=l[22]<<10|l[23]>>>22,An=l[23]<<10|l[22]>>>22,on=l[33]<<13|l[32]>>>19,sn=l[32]<<13|l[33]>>>19,Dn=l[42]<<2|l[43]>>>30,Nn=l[43]<<2|l[42]>>>30,kn=l[5]<<30|l[4]>>>2,xn=l[4]<<30|l[5]>>>2,dn=l[14]<<6|l[15]>>>26,hn=l[15]<<6|l[14]>>>26,Hr=l[25]<<11|l[24]>>>21,Vr=l[24]<<11|l[25]>>>21,En=l[34]<<15|l[35]>>>17,Cn=l[35]<<15|l[34]>>>17,un=l[45]<<29|l[44]>>>3,ln=l[44]<<29|l[45]>>>3,Zr=l[6]<<28|l[7]>>>4,en=l[7]<<28|l[6]>>>4,In=l[17]<<23|l[16]>>>9,Fn=l[16]<<23|l[17]>>>9,pn=l[26]<<25|l[27]>>>7,yn=l[27]<<25|l[26]>>>7,Jr=l[36]<<21|l[37]>>>11,Yr=l[37]<<21|l[36]>>>11,Tn=l[47]<<24|l[46]>>>8,On=l[46]<<24|l[47]>>>8,_n=l[8]<<27|l[9]>>>5,wn=l[9]<<27|l[8]>>>5,tn=l[18]<<20|l[19]>>>12,rn=l[19]<<20|l[18]>>>12,Bn=l[29]<<7|l[28]>>>25,Mn=l[28]<<7|l[29]>>>25,mn=l[38]<<8|l[39]>>>24,bn=l[39]<<8|l[38]>>>24,Qr=l[48]<<14|l[49]>>>18,Xr=l[49]<<14|l[48]>>>18,l[0]=Ur^~Kr&Hr,l[1]=$r^~Gr&Vr,l[10]=Zr^~tn&nn,l[11]=en^~rn&an,l[20]=cn^~dn&pn,l[21]=fn^~hn&yn,l[30]=_n^~Sn&Pn,l[31]=wn^~Rn&An,l[40]=kn^~In&Bn,l[41]=xn^~Fn&Mn,l[2]=Kr^~Hr&Jr,l[3]=Gr^~Vr&Yr,l[12]=tn^~nn&on,l[13]=rn^~an&sn,l[22]=dn^~pn&mn,l[23]=hn^~yn&bn,l[32]=Sn^~Pn&En,l[33]=Rn^~An&Cn,l[42]=In^~Bn&jn,l[43]=Fn^~Mn&Wn,l[4]=Hr^~Jr&Qr,l[5]=Vr^~Yr&Xr,l[14]=nn^~on&un,l[15]=an^~sn&ln,l[24]=pn^~mn&gn,l[25]=yn^~bn&vn,l[34]=Pn^~En&Tn,l[35]=An^~Cn&On,l[44]=Bn^~jn&Dn,l[45]=Mn^~Wn&Nn,l[6]=Jr^~Qr&Ur,l[7]=Yr^~Xr&$r,l[16]=on^~un&Zr,l[17]=sn^~ln&en,l[26]=mn^~gn&cn,l[27]=bn^~vn&fn,l[36]=En^~Tn&_n,l[37]=Cn^~On&wn,l[46]=jn^~Dn&kn,l[47]=Wn^~Nn&xn,l[8]=Qr^~Ur&Kr,l[9]=Xr^~$r&Gr,l[18]=un^~Zr&tn,l[19]=ln^~en&rn,l[28]=gn^~cn&dn,l[29]=vn^~fn&hn,l[38]=Tn^~_n&Sn,l[39]=On^~wn&Rn,l[48]=Dn^~kn&In,l[49]=Nn^~xn&Fn,l[0]^=f[O],l[1]^=f[O+1]};if(s)t.exports=pe;else for(He=0;He<Me.length;++He)a[Me[He]]=pe[Me[He]]})()})(zl);var dy=zl.exports;const wo="chatgptArkoseReqUrl",So="chatgptArkoseReqForm";async function hy(){const e=await(await import("./browser-polyfill-83de79d0.js").then(a=>a.b)).default.storage.local.get([wo,So]);if(!e[wo]||!e[So])throw new Error(`Failed to get arkose token.

Please keep https://chat.openai.com open and try again. If it still doesn't work, type some characters in the input box of chatgpt web page and try again.`);const n=await Ke()(e[wo]+"?"+fy,{method:"POST",body:e[So],headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Origin:"https://tcr9i.chat.openai.com",Referer:"https://tcr9i.chat.openai.com/v2/2.4.4/enforcement.f73f1debe050b423e0e5cd1845b2430a.html"}}).then(a=>a.json()).then(a=>a.token).catch(()=>null);if(!n)throw new Error(`Failed to get arkose token.

Please keep https://chat.openai.com open and try again. If it still doesn't work, type some characters in the input box of chatgpt web page and try again.`);return n}async function py(t,e,r,n){return Ke()(`https://chat.openai.com/backend-api${r}`,{method:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:n!==void 0?JSON.stringify(n):void 0})}async function yy(t){return(await py(t,"POST","/sentinel/chat-requirements",{conversation_mode_kind:"primary_assistant"})).json()}async function my(t,e,r){const n=[8,12,16,24],a=[3e3,4e3,6e3],o=(d,m)=>Math.floor(Math.random()*(m-d+1))+d,i=n[o(0,n.length)],s=a[o(0,a.length)],c=new Date(Date.now()-8*3600*1e3).toUTCString().replace("GMT","GMT-0500 (Eastern Time)"),h=[i+s,c,4294705152,0,r];if(typeof e=="string"){const d=Math.floor(e.length/2);for(let m=0;m<1e5;m++){h[3]=m;const v=JSON.stringify(h),f=btoa(unescape(encodeURIComponent(v)));if(dy.sha3_512(t+f).substring(0,d)<=e)return"gAAAAAB"+f}}return"gAAAAABwQ8Lk5FbGpA2NcR9dShT6gYjU7VxZ4D"+btoa(unescape(encodeURIComponent(`"${t}"`)))}class Om extends Ji{async listModels(e){const r=Ke(),n=await r(ds,{cache:"no-cache",headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) chatall/1.29.40 Chrome/114.0.5735.134 Safari/537.36"}});if(n.status!==200)try{const c=await n.json();throw c&&c.error?new Error(c.error):c&&c.detail?new Error(`Failed to fetch ChatGPT Web accessToken: ${c.detail}`):new Error(`Failed to fetch ChatGPT Web accessToken: ${n.statusText}`)}catch{throw new Error(`Failed to fetch ChatGPT Web accessToken: ${n.statusText}`)}const o={Authorization:`Bearer ${(await n.json()).accessToken}`},i=await r(`${hs}/models`,{cache:"no-cache",headers:o}),s=await i.json();if(!s)return[];if(i.status!==200){if(i.status===401)throw new Error("ChatGPT is not login");return[]}const{models:u}=s;return u?u.map(c=>({name:`${c.title} (${c.tags.join(", ")})`,description:c.description,id:c.slug})):[]}async getModel(){return(await xe()).chatgptModel}async sendMessage(e){const r=await this.getModel(),n=Ke();e.onStatusCode?.(200);let a=null;if(a=await n(ds,{signal:e.signal}),e.onStatusCode?.(a.status),a.status!==200){try{const b=await a.json();b&&b.detail?e.onError(`Failed to fetch ChatGPT Web accessToken: ${b.detail}`):e.onError(`Failed to fetch ChatGPT Web accessToken: ${a.statusText}`)}catch{e.onError("Failed to fetch ChatGPT Web accessToken.")}return}const i=(await a?.json()).accessToken,s=await hy(),u=await yy(i),c=u.token,h={}.USER_AGENT||"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36",y=await my(u.proofofwork.seed,u.proofofwork.difficulty,h),d={"Content-Type":"application/json",Authorization:`Bearer ${i}`,"Openai-Sentinel-Arkose-Token":s,"Openai-Sentinel-Chat-Requirements-Token":c,"openai-sentinel-proof-token":y},m={action:"next",messages:[{id:Oo(),role:"user",content:{content_type:"text",parts:[Oc`
                        ${e.rolePrompt}

                        ${e.commandPrompt}
                        `]}}],model:r,parent_message_id:Oo(),conversation_mode:{kind:"primary_assistant"},history_and_training_disabled:!1,force_paragen:!1,force_paragen_model_slug:"",force_rate_limit:!1,suggestions:[]};let v=!1,f=0;await wa(`${hs}/conversation`,{method:"POST",headers:d,body:JSON.stringify(m),signal:e.signal,onStatusCode:b=>{e.onStatusCode?.(b)},onMessage:async b=>{if(v)return;let p;try{p=JSON.parse(b)}catch{e.onFinished("stop"),v=!0;return}if(p.is_completion){e.onFinished("stop"),v=!0;return}if(!p.message){p.error&&e.onError(`ChatGPT Web error: ${p.error}`);return}const{content:g,author:_}=p.message;if(_.role==="assistant"){const A=g.parts.join(""),R=A.slice(f);f=A.length,await e.onMessage({content:R,role:""})}},onError:b=>{if(b instanceof Error){e.onError(b.message);return}if(typeof b=="string"){e.onError(b);return}if(typeof b=="object"){const{detail:g}=b;if(g){const{message:_}=g;if(_){e.onError(`ChatGPT Web: ${_}`);return}}e.onError(`ChatGPT Web: ${JSON.stringify(b)}`);return}const{error:p}=b;if(p instanceof Error){e.onError(p.message);return}if(typeof p=="object"){const{message:g}=p;if(g){typeof g=="string"?e.onError(g):e.onError(JSON.stringify(g));return}}e.onError("Unknown error")}})}}const tu="kimi-access-token";class km extends Ji{async checkLogin(){const e=Ke(),r=await this.getHeaders();return(await e("https://kimi.moonshot.cn/api/user",{method:"GET",headers:r})).status===200}async getModel(){return""}async listModels(e){return[]}async getHeaders(){let r=(await xe()).kimiAccessToken;gr()||(r=(await(await import("./browser-polyfill-83de79d0.js").then(i=>i.b)).default.storage.local.get([tu]))[tu]);const n=Array.from({length:20},()=>Math.floor(Math.random()*36).toString(36)).join("");return{"Content-Type":"application/json",Authorization:`Bearer ${r}`,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.77 Safari/537.36 Edg/91.0.864.41",Origin:"https://kimi.moonshot.cn",Referer:"https://kimi.moonshot.cn/","X-Traffic-Id":n}}async sendMessage(e){const r=await xe(),n=Ke();e.onStatusCode?.(200);const a=await this.getHeaders();let o=await n("https://kimi.moonshot.cn/api/chat",{method:"POST",headers:a,body:JSON.stringify({name:"Kimi",is_example:!1})});if(o.status===401)if(gr()&&r.kimiRefreshToken){a.Authorization=`Bearer ${r.kimiRefreshToken}`;const y=await n("https://kimi.moonshot.cn/api/auth/token/refresh",{method:"GET",headers:a});if(e.onStatusCode?.(y.status),y.status===200){const d=await y.json();a.Authorization=`Bearer ${d.access_token}`,await wu({...r,kimiRefreshToken:d.refresh_token,kimiAccessToken:d.access_token}),o=await n("https://kimi.moonshot.cn/api/chat",{method:"POST",headers:a,body:JSON.stringify({name:"Kimi",is_example:!1})}),e.onStatusCode?.(o.status)}else{const d=await o.json();e.onError("Kimi: "+d.message);return}}else{e.onStatusCode?.(o.status);const y=await o.json();e.onError("Kimi: "+y.message);return}const s=(await o.json()).id,u=[{role:"user",content:e.rolePrompt+`
`+e.commandPrompt}];let c=!1,h=!1;await wa(`https://kimi.moonshot.cn/api/chat/${s}/completion/stream`,{method:"POST",headers:a,body:JSON.stringify({messages:u,refs:[],user_search:!0}),signal:e.signal,onMessage:async y=>{if(h)return;let d;try{d=JSON.parse(y)}catch(m){c=!0,h=!0,e.onError(JSON.stringify(m));return}if(d.event!=="cmpl"){if(d.event==="all_done"){h=!0,e.onFinished("stop");return}return}await e.onMessage({content:d.text,role:""})},onError:y=>{if(c=!0,y instanceof Error){e.onError(y.message);return}if(typeof y=="string"){e.onError(y);return}if(typeof y=="object"){const m=y[0];if(m&&m.error&&m.error.message){e.onError(m.error.message);return}}const{error:d}=y;if(d instanceof Error){e.onError(d.message);return}if(typeof d=="object"){const{message:m}=d;if(m){typeof m=="string"?e.onError(m):e.onError(JSON.stringify(m));return}}e.onError("Unknown error")}}),!h&&!c&&e.onFinished("stop")}}const ru="chatglm-access-token";class xm extends Ji{async getModel(){return""}async listModels(e){return[]}async getHeaders(){let r=(await xe()).chatglmAccessToken;return gr()||(r=(await(await import("./browser-polyfill-83de79d0.js").then(o=>o.b)).default.storage.local.get([ru]))[ru]),{"Content-Type":"application/json",Authorization:`Bearer ${r}`,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.77 Safari/537.36 Edg/91.0.864.41",Origin:"https://chatglm.cn",Referer:"https://chatglm.cn/main/alltoolsdetail"}}async refreshAccessToken(e){const r=await xe(),n=await this.getHeaders(),a=Ke();n.Authorization=`Bearer ${r.chatglmRefreshToken}`;const o=await a("https://chatglm.cn/chatglm/backend-api/v1/user/refresh",{method:"POST",headers:n,body:JSON.stringify({})});if(e?.(o.status),o.status===200){const i=await o.json();if(i.message!=="success")throw new Error("Failed to refresh ChatGLM access token: "+i.message);await wu({...r,chatglmAccessToken:i.result.accessToken})}else throw new Error("Failed to refresh ChatGLM access token: "+o.statusText)}async sendMessage(e){const n=(await xe()).chatglmRefreshToken,a=Ke(),o="65940acff94777010aa6b796",i="OpenAI Translator";e.onStatusCode?.(200);const s=await this.getHeaders(),u=await a(`https://chatglm.cn/chatglm/backend-api/assistant/conversation/list?${ly.stringify({assistant_id:o,page:1,page_size:25})}`,{method:"GET",headers:s});if(e.onStatusCode?.(u.status),(u.status===401||u.status===422)&&n)return await this.refreshAccessToken(e.onStatusCode),await this.sendMessage(e);if(!u.ok){const f=await u.json();e.onError?.(f.message??f.msg??"unknown error");return}let y=(await u.json()).result.conversation_list.find(f=>f.title===i)?.id;if(!y)try{const f=new AbortController;await wa("https://chatglm.cn/chatglm/backend-api/assistant/stream",{method:"POST",headers:s,body:JSON.stringify({assistant_id:o,conversation_id:"",messages:[{role:"user",content:[{type:"text",text:i}]}],meta_data:{mention_conversation_id:"",is_test:!1,input_question_type:"xxxx",channel:"",draft_id:""}}),signal:f.signal,onError:()=>{},onMessage:async b=>{y=JSON.parse(b).conversation_id,f.abort()}}),y&&await new Promise(b=>setTimeout(b,2e3))}catch(f){console.error("err",f)}finally{}if(!y){e.onError?.("Failed to create conversation");return}let d=!1,m=!1,v=0;await wa("https://chatglm.cn/chatglm/backend-api/assistant/stream",{method:"POST",headers:s,body:JSON.stringify({assistant_id:o,conversation_id:y,messages:[{role:"user",content:[{type:"text",text:e.rolePrompt+`
`+e.commandPrompt}]}],meta_data:{mention_conversation_id:"",is_test:!1,input_question_type:"xxxx",channel:"",draft_id:""}}),signal:e.signal,onMessage:async f=>{if(m)return;let b;try{b=JSON.parse(f)}catch(p){d=!0,m=!0,e.onError(JSON.stringify(p));return}if(b.status!=="init"){if(b.event==="finish"){m=!0,e.onFinished("stop");return}return}b.parts.forEach(p=>{if(p.status==="intervene"){d=!0,m=!0,e.onError("ChatGLM: "+p.error?.intervene_text);return}p.content.forEach(async g=>{const _=g.text.slice(v);v=g.text.length,await e.onMessage({content:_,role:""})})})},onError:f=>{if(console.error("err",f),d=!0,f instanceof Error){e.onError(f.message);return}if(typeof f=="string"){e.onError(f);return}if(typeof f=="object"){const p=f[0];if(p&&p.error&&p.error.message){e.onError(p.error.message);return}}if(typeof f=="object"){const{message:p}=f;if(p){typeof p=="string"?e.onError(p):e.onError(JSON.stringify(p));return}}const{error:b}=f;if(b instanceof Error){e.onError(b.message);return}if(typeof b=="object"){const{message:p}=b;if(p){typeof p=="string"?e.onError(p):e.onError(JSON.stringify(p));return}}e.onError("Unknown error")}}),!m&&!d&&e.onFinished("stop")}}const V=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ee=Object.keys,ue=Array.isArray;function he(t,e){return typeof e!="object"||ee(e).forEach(function(r){t[r]=e[r]}),t}typeof Promise>"u"||V.Promise||(V.Promise=Promise);const wr=Object.getPrototypeOf,by={}.hasOwnProperty;function ve(t,e){return by.call(t,e)}function Jt(t,e){typeof e=="function"&&(e=e(wr(t))),(typeof Reflect>"u"?ee:Reflect.ownKeys)(e).forEach(r=>{ze(t,r,e[r])})}const Ul=Object.defineProperty;function ze(t,e,r,n){Ul(t,e,he(r&&ve(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function Lt(t){return{from:function(e){return t.prototype=Object.create(e.prototype),ze(t.prototype,"constructor",t),{extend:Jt.bind(null,t.prototype)}}}}const gy=Object.getOwnPropertyDescriptor;function Yi(t,e){let r;return gy(t,e)||(r=wr(t))&&Yi(r,e)}const vy=[].slice;function Ma(t,e,r){return vy.call(t,e,r)}function $l(t,e){return e(t)}function ur(t){if(!t)throw new Error("Assertion Failed")}function Kl(t){V.setImmediate?setImmediate(t):setTimeout(t,0)}function Gl(t,e){return t.reduce((r,n,a)=>{var o=e(n,a);return o&&(r[o[0]]=o[1]),r},{})}function Ue(t,e){if(ve(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],n=0,a=e.length;n<a;++n){var o=Ue(t,e[n]);r.push(o)}return r}var i=e.indexOf(".");if(i!==-1){var s=t[e.substr(0,i)];return s===void 0?void 0:Ue(s,e.substr(i+1))}}function Se(t,e,r){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){ur(typeof r!="string"&&"length"in r);for(var n=0,a=e.length;n<a;++n)Se(t,e[n],r[n])}else{var o=e.indexOf(".");if(o!==-1){var i=e.substr(0,o),s=e.substr(o+1);if(s==="")r===void 0?ue(t)&&!isNaN(parseInt(i))?t.splice(i,1):delete t[i]:t[i]=r;else{var u=t[i];u&&ve(t,i)||(u=t[i]={}),Se(u,s,r)}}else r===void 0?ue(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function Hl(t){var e={};for(var r in t)ve(t,r)&&(e[r]=t[r]);return e}const _y=[].concat;function Vl(t){return _y.apply([],t)}const Jl="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Vl([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>V[t]),wy=Jl.map(t=>V[t]);Gl(Jl,t=>[t,!0]);let Qe=null;function jr(t){Qe=typeof WeakMap<"u"&&new WeakMap;const e=qo(t);return Qe=null,e}function qo(t){if(!t||typeof t!="object")return t;let e=Qe&&Qe.get(t);if(e)return e;if(ue(t)){e=[],Qe&&Qe.set(t,e);for(var r=0,n=t.length;r<n;++r)e.push(qo(t[r]))}else if(wy.indexOf(t.constructor)>=0)e=t;else{const o=wr(t);for(var a in e=o===Object.prototype?{}:Object.create(o),Qe&&Qe.set(t,e),t)ve(t,a)&&(e[a]=qo(t[a]))}return e}const{toString:Sy}={};function zo(t){return Sy.call(t).slice(8,-1)}const Uo=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Ry=typeof Uo=="symbol"?function(t){var e;return t!=null&&(e=t[Uo])&&e.apply(t)}:function(){return null},Mt={};function De(t){var e,r,n,a;if(arguments.length===1){if(ue(t))return t.slice();if(this===Mt&&typeof t=="string")return[t];if(a=Ry(t)){for(r=[];!(n=a.next()).done;)r.push(n.value);return r}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(r=new Array(e);e--;)r[e]=t[e];return r}return[t]}for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}const Qi=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Be=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Yl(t,e){Be=t,Ql=e}var Ql=()=>!0;const Py=!new Error("").stack;function Ct(){if(Py)try{throw Ct.arguments,new Error}catch(t){return t}return new Error}function $o(t,e){var r=t.stack;return r?(e=e||0,r.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),r.split(`
`).slice(e).filter(Ql).map(n=>`
`+n).join("")):""}var Xl=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Xi=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Xl),Ay={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function qt(t,e){this._e=Ct(),this.name=t,this.message=e}function Zl(t,e){return t+". Errors: "+Object.keys(e).map(r=>e[r].toString()).filter((r,n,a)=>a.indexOf(r)===n).join(`
`)}function ja(t,e,r,n){this._e=Ct(),this.failures=e,this.failedKeys=n,this.successCount=r,this.message=Zl(t,e)}function hr(t,e){this._e=Ct(),this.name="BulkError",this.failures=Object.keys(e).map(r=>e[r]),this.failuresByPos=e,this.message=Zl(t,e)}Lt(qt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+$o(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Lt(ja).from(qt),Lt(hr).from(qt);var Zi=Xi.reduce((t,e)=>(t[e]=e+"Error",t),{});const Ey=qt;var M=Xi.reduce((t,e)=>{var r=e+"Error";function n(a,o){this._e=Ct(),this.name=r,a?typeof a=="string"?(this.message=`${a}${o?`
 `+o:""}`,this.inner=o||null):typeof a=="object"&&(this.message=`${a.name} ${a.message}`,this.inner=a):(this.message=Ay[e]||r,this.inner=null)}return Lt(n).from(Ey),t[e]=n,t},{});M.Syntax=SyntaxError,M.Type=TypeError,M.Range=RangeError;var nu=Xl.reduce((t,e)=>(t[e+"Error"]=M[e],t),{}),ha=Xi.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=M[e]),t),{});function G(){}function Sr(t){return t}function Cy(t,e){return t==null||t===Sr?e:function(r){return e(t(r))}}function Rt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Ty(t,e){return t===G?e:function(){var r=t.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?Rt(n,this.onsuccess):n),a&&(this.onerror=this.onerror?Rt(a,this.onerror):a),o!==void 0?o:r}}function Oy(t,e){return t===G?e:function(){t.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Rt(r,this.onsuccess):r),n&&(this.onerror=this.onerror?Rt(n,this.onerror):n)}}function ky(t,e){return t===G?e:function(r){var n=t.apply(this,arguments);he(r,n);var a=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=e.apply(this,arguments);return a&&(this.onsuccess=this.onsuccess?Rt(a,this.onsuccess):a),o&&(this.onerror=this.onerror?Rt(o,this.onerror):o),n===void 0?i===void 0?void 0:i:he(n,i)}}function xy(t,e){return t===G?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function es(t,e){return t===G?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,a=arguments.length,o=new Array(a);a--;)o[a]=arguments[a];return r.then(function(){return e.apply(n,o)})}return e.apply(this,arguments)}}ha.ModifyError=ja,ha.DexieError=qt,ha.BulkError=hr;var Rr={};const[Ko,Wa,Go]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,wr(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,wr(e),t]})(),ec=Wa&&Wa.then,pa=Ko&&Ko.constructor,ts=!!Go;var Ho=!1,Iy=Go?()=>{Go.then(Xn)}:V.setImmediate?setImmediate.bind(null,Xn):V.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{Xn(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Xn,0)},pr=function(t,e){lr.push([t,e]),Da&&(Iy(),Da=!1)},Vo=!0,Da=!0,_t=[],ya=[],Jo=null,Yo=Sr,zt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ou,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{ou(t[0],t[1])}catch{}})}},I=zt,lr=[],wt=0,ma=[];function k(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=G,this._lib=!1;var e=this._PSD=I;if(Be&&(this._stackHolder=Ct(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Rr)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Xo(this,this._value))}this._state=null,this._value=null,++e.ref,rc(this,t)}const Qo={get:function(){var t=I,e=Na;function r(n,a){var o=!t.global&&(t!==I||e!==Na);const i=o&&!Ge();var s=new k((u,c)=>{rs(this,new tc(La(n,t,o,i),La(a,t,o,i),u,c,t))});return Be&&oc(s,this),s}return r.prototype=Rr,r},set:function(t){ze(this,"then",t&&t.prototype===Rr?Qo:{get:function(){return t},set:Qo.set})}};function tc(t,e,r,n,a){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=n,this.psd=a}function rc(t,e){try{e(r=>{if(t._state===null){if(r===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&Wr();r&&typeof r.then=="function"?rc(t,(a,o)=>{r instanceof k?r._then(a,o):r.then(a,o)}):(t._state=!0,t._value=r,nc(t)),n&&Dr()}},Xo.bind(null,t))}catch(r){Xo(t,r)}}function Xo(t,e){if(ya.push(e),t._state===null){var r=t._lib&&Wr();e=Yo(e),t._state=!1,t._value=e,Be&&e!==null&&typeof e=="object"&&!e._promise&&function(n,a,o){try{n.apply(null,o)}catch(i){a&&a(i)}}(()=>{var n=Yi(e,"stack");e._promise=t,ze(e,"stack",{get:()=>Ho?n&&(n.get?n.get.apply(e):n.value):t.stack})}),function(n){_t.some(a=>a._value===n._value)||_t.push(n)}(t),nc(t),r&&Dr()}}function nc(t){var e=t._listeners;t._listeners=[];for(var r=0,n=e.length;r<n;++r)rs(t,e[r]);var a=t._PSD;--a.ref||a.finalize(),wt===0&&(++wt,pr(()=>{--wt==0&&ns()},[]))}function rs(t,e){if(t._state!==null){var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++wt,pr(Fy,[r,t,e])}else t._listeners.push(e)}function Fy(t,e,r){try{Jo=e;var n,a=e._value;e._state?n=t(a):(ya.length&&(ya=[]),n=t(a),ya.indexOf(a)===-1&&function(o){for(var i=_t.length;i;)if(_t[--i]._value===o._value)return void _t.splice(i,1)}(e)),r.resolve(n)}catch(o){r.reject(o)}finally{Jo=null,--wt==0&&ns(),--r.psd.ref||r.psd.finalize()}}function ac(t,e,r){if(e.length===r)return e;var n="";if(t._state===!1){var a,o,i=t._value;i!=null?(a=i.name||"Error",o=i.message||i,n=$o(i,0)):(a=i,o=""),e.push(a+(o?": "+o:"")+n)}return Be&&((n=$o(t._stackHolder,2))&&e.indexOf(n)===-1&&e.push(n),t._prev&&ac(t._prev,e,r)),e}function oc(t,e){var r=e?e._numPrev+1:0;r<100&&(t._prev=e,t._numPrev=r)}function Xn(){Wr()&&Dr()}function Wr(){var t=Vo;return Vo=!1,Da=!1,t}function Dr(){var t,e,r;do for(;lr.length>0;)for(t=lr,lr=[],r=t.length,e=0;e<r;++e){var n=t[e];n[0].apply(null,n[1])}while(lr.length>0);Vo=!0,Da=!0}function ns(){var t=_t;_t=[],t.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=ma.slice(0),r=e.length;r;)e[--r]()}function Zn(t){return new k(Rr,!1,t)}function J(t,e){var r=I;return function(){var n=Wr(),a=I;try{return at(r,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{at(a,!1),n&&Dr()}}}Jt(k.prototype,{then:Qo,_then:function(t,e){rs(this,new tc(null,null,t,e,I))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],r=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?r(n):Zn(n)):this.then(null,n=>n&&n.name===e?r(n):Zn(n))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),Zn(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Ho=!0;var t=ac(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Ho=!1}}},timeout:function(t,e){return t<1/0?new k((r,n)=>{var a=setTimeout(()=>n(new M.Timeout(e)),t);this.then(r,n).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ze(k.prototype,Symbol.toStringTag,"Dexie.Promise"),zt.env=ic(),Jt(k,{all:function(){var t=De.apply(null,arguments).map(ea);return new k(function(e,r){t.length===0&&e([]);var n=t.length;t.forEach((a,o)=>k.resolve(a).then(i=>{t[o]=i,--n||e(t)},r))})},resolve:t=>{if(t instanceof k)return t;if(t&&typeof t.then=="function")return new k((r,n)=>{t.then(r,n)});var e=new k(Rr,!0,t);return oc(e,Jo),e},reject:Zn,race:function(){var t=De.apply(null,arguments).map(ea);return new k((e,r)=>{t.map(n=>k.resolve(n).then(e,r))})},PSD:{get:()=>I,set:t=>I=t},totalEchoes:{get:()=>Na},newPSD:nt,usePSD:er,scheduler:{get:()=>pr,set:t=>{pr=t}},rejectionMapper:{get:()=>Yo,set:t=>{Yo=t}},follow:(t,e)=>new k((r,n)=>nt((a,o)=>{var i=I;i.unhandleds=[],i.onunhandled=o,i.finalize=Rt(function(){(function(s){function u(){s(),ma.splice(ma.indexOf(u),1)}ma.push(u),++wt,pr(()=>{--wt==0&&ns()},[])})(()=>{this.unhandleds.length===0?a():o(this.unhandleds[0])})},i.finalize),t()},e,r,n))}),pa&&(pa.allSettled&&ze(k,"allSettled",function(){const t=De.apply(null,arguments).map(ea);return new k(e=>{t.length===0&&e([]);let r=t.length;const n=new Array(r);t.forEach((a,o)=>k.resolve(a).then(i=>n[o]={status:"fulfilled",value:i},i=>n[o]={status:"rejected",reason:i}).then(()=>--r||e(n)))})}),pa.any&&typeof AggregateError<"u"&&ze(k,"any",function(){const t=De.apply(null,arguments).map(ea);return new k((e,r)=>{t.length===0&&r(new AggregateError([]));let n=t.length;const a=new Array(n);t.forEach((o,i)=>k.resolve(o).then(s=>e(s),s=>{a[i]=s,--n||r(new AggregateError(a))}))})}));const se={awaits:0,echoes:0,id:0};var By=0,ba=[],Ro=0,Na=0,My=0;function nt(t,e,r,n){var a=I,o=Object.create(a);o.parent=a,o.ref=0,o.global=!1,o.id=++My;var i=zt.env;o.env=ts?{Promise:k,PromiseProp:{value:k,configurable:!0,writable:!0},all:k.all,race:k.race,allSettled:k.allSettled,any:k.any,resolve:k.resolve,reject:k.reject,nthen:au(i.nthen,o),gthen:au(i.gthen,o)}:{},e&&he(o,e),++a.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=er(o,t,r,n);return o.ref===0&&o.finalize(),s}function Zt(){return se.id||(se.id=++By),++se.awaits,se.echoes+=100,se.id}function Ge(){return!!se.awaits&&(--se.awaits==0&&(se.id=0),se.echoes=100*se.awaits,!0)}function ea(t){return se.echoes&&t&&t.constructor===pa?(Zt(),t.then(e=>(Ge(),e),e=>(Ge(),te(e)))):t}function jy(t){++Na,se.echoes&&--se.echoes!=0||(se.echoes=se.id=0),ba.push(I),at(t,!0)}function Wy(){var t=ba[ba.length-1];ba.pop(),at(t,!1)}function at(t,e){var r=I;if((e?!se.echoes||Ro++&&t===I:!Ro||--Ro&&t===I)||sc(e?jy.bind(null,t):Wy),t!==I&&(I=t,r===zt&&(zt.env=ic()),ts)){var n=zt.env.Promise,a=t.env;Wa.then=a.nthen,n.prototype.then=a.gthen,(r.global||t.global)&&(Object.defineProperty(V,"Promise",a.PromiseProp),n.all=a.all,n.race=a.race,n.resolve=a.resolve,n.reject=a.reject,a.allSettled&&(n.allSettled=a.allSettled),a.any&&(n.any=a.any))}}function ic(){var t=V.Promise;return ts?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(V,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Wa.then,gthen:t.prototype.then}:{}}function er(t,e,r,n,a){var o=I;try{return at(t,!0),e(r,n,a)}finally{at(o,!1)}}function sc(t){ec.call(Ko,t)}function La(t,e,r,n){return typeof t!="function"?t:function(){var a=I;r&&Zt(),at(e,!0);try{return t.apply(this,arguments)}finally{at(a,!1),n&&sc(Ge)}}}function au(t,e){return function(r,n){return t.call(this,La(r,e),La(n,e))}}(""+ec).indexOf("[native code]")===-1&&(Zt=Ge=G);function ou(t,e){var r;try{r=e.onuncatched(t)}catch{}if(r!==!1)try{var n,a={promise:e,reason:t};if(V.document&&document.createEvent?((n=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),he(n,a)):V.CustomEvent&&he(n=new CustomEvent("unhandledrejection",{detail:a}),a),n&&V.dispatchEvent&&(dispatchEvent(n),!V.PromiseRejectionEvent&&V.onunhandledrejection))try{V.onunhandledrejection(n)}catch{}Be&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var te=k.reject;function Zo(t,e,r,n){if(t.idbdb&&(t._state.openComplete||I.letThrough||t._vip)){var a=t._createTransaction(e,r,t._dbSchema);try{a.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===Zi.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Zo(t,e,r,n))):te(o)}return a._promise(e,(o,i)=>nt(()=>(I.trans=a,n(o,i,a)))).then(o=>a._completion.then(()=>o))}if(t._state.openComplete)return te(new M.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return te(new M.DatabaseClosed);t.open().catch(G)}return t._state.dbReadyPromise.then(()=>Zo(t,e,r,n))}const bt=String.fromCharCode(65535),je="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",yr=[],eo=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Dy=eo,Ny=eo,uc=t=>!/(dexie\.js|dexie\.min\.js)/.test(t);function Pt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const lc={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ta(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=jr(e))[t],e)}class Ly{_trans(e,r,n){const a=this._tx||I.trans,o=this.name;function i(u,c,h){if(!h.schema[o])throw new M.NotFound("Table "+o+" not part of transaction");return r(h.idbtrans,h)}const s=Wr();try{return a&&a.db===this.db?a===I.trans?a._promise(e,i,n):nt(()=>a._promise(e,i,n),{trans:a,transless:I.transless||I}):Zo(this.db,e,[this.name],i)}finally{s&&Dr()}}get(e,r){return e&&e.constructor===Object?this.where(e).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(a=>this.hook.reading.fire(a))).then(r)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ue(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const r=ee(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&r.every(h=>c.keyPath.indexOf(h)>=0)&&c.keyPath.every(h=>r.indexOf(h)>=0))[0];if(n&&this.db._maxKey!==bt)return this.where(n.name).equals(n.keyPath.map(c=>e[c]));!n&&Be&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);const{idxByName:a}=this.schema,o=this.db._deps.indexedDB;function i(c,h){try{return o.cmp(c,h)===0}catch{return!1}}const[s,u]=r.reduce(([c,h],y)=>{const d=a[y],m=e[y];return[c||d,c||!d?Pt(h,d&&d.multi?v=>{const f=Ue(v,y);return ue(f)&&f.some(b=>i(m,b))}:v=>i(m,Ue(v,y))):h]},[null,null]);return s?this.where(s.name).equals(e[s.keyPath]).filter(u):n?this.filter(u):this.where(r).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,ue(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const r=n=>{if(!n)return n;const a=Object.create(e.prototype);for(var o in n)if(ve(n,o))try{a[o]=n[o]}catch{}return a};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e}defineClass(){return this.mapToClass(function(e){he(this,e)})}add(e,r){const{auto:n,keyPath:a}=this.schema.primKey;let o=e;return a&&n&&(o=ta(a)(e)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"add",keys:r!=null?[r]:null,values:[o]})).then(i=>i.numFailures?k.reject(i.failures[0]):i.lastResult).then(i=>{if(a)try{Se(e,a,i)}catch{}return i})}update(e,r){if(typeof e!="object"||ue(e))return this.where(":id").equals(e).modify(r);{const n=Ue(e,this.schema.primKey.keyPath);if(n===void 0)return te(new M.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?ee(r).forEach(a=>{Se(e,a,r[a])}):r(e,{value:e,primKey:n})}catch{}return this.where(":id").equals(n).modify(r)}}put(e,r){const{auto:n,keyPath:a}=this.schema.primKey;let o=e;return a&&n&&(o=ta(a)(e)),this._trans("readwrite",i=>this.core.mutate({trans:i,type:"put",values:[o],keys:r!=null?[r]:null})).then(i=>i.numFailures?k.reject(i.failures[0]):i.lastResult).then(i=>{if(a)try{Se(e,a,i)}catch{}return i})}delete(e){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[e]})).then(r=>r.numFailures?k.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:lc})).then(e=>e.numFailures?k.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",r=>this.core.getMany({keys:e,trans:r}).then(n=>n.map(a=>this.hook.reading.fire(a))))}bulkAdd(e,r,n){const a=Array.isArray(r)?r:void 0,o=(n=n||(a?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:s,keyPath:u}=this.schema.primKey;if(u&&a)throw new M.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new M.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let h=u&&s?e.map(ta(u)):e;return this.core.mutate({trans:i,type:"add",keys:a,values:h,wantResults:o}).then(({numFailures:y,results:d,lastResult:m,failures:v})=>{if(y===0)return o?d:m;throw new hr(`${this.name}.bulkAdd(): ${y} of ${c} operations failed`,v)})})}bulkPut(e,r,n){const a=Array.isArray(r)?r:void 0,o=(n=n||(a?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",i=>{const{auto:s,keyPath:u}=this.schema.primKey;if(u&&a)throw new M.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new M.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let h=u&&s?e.map(ta(u)):e;return this.core.mutate({trans:i,type:"put",keys:a,values:h,wantResults:o}).then(({numFailures:y,results:d,lastResult:m,failures:v})=>{if(y===0)return o?d:m;throw new hr(`${this.name}.bulkPut(): ${y} of ${c} operations failed`,v)})})}bulkDelete(e){const r=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:a,failures:o})=>{if(n===0)return a;throw new hr(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,o)})}}function mr(t){var e={},r=function(s,u){if(u){for(var c=arguments.length,h=new Array(c-1);--c;)h[c-1]=arguments[c];return e[s].subscribe.apply(null,h),t}if(typeof s=="string")return e[s]};r.addEventType=o;for(var n=1,a=arguments.length;n<a;++n)o(arguments[n]);return r;function o(s,u,c){if(typeof s=="object")return i(s);u||(u=xy),c||(c=G);var h={subscribers:[],fire:c,subscribe:function(y){h.subscribers.indexOf(y)===-1&&(h.subscribers.push(y),h.fire=u(h.fire,y))},unsubscribe:function(y){h.subscribers=h.subscribers.filter(function(d){return d!==y}),h.fire=h.subscribers.reduce(u,c)}};return e[s]=r[s]=h,h}function i(s){ee(s).forEach(function(u){var c=s[u];if(ue(c))o(u,s[u][0],s[u][1]);else{if(c!=="asap")throw new M.InvalidArgument("Invalid event config");var h=o(u,Sr,function(){for(var y=arguments.length,d=new Array(y);y--;)d[y]=arguments[y];h.subscribers.forEach(function(m){Kl(function(){m.apply(null,d)})})})}})}}function or(t,e){return Lt(e).from({prototype:t}),e}function It(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Po(t,e){t.filter=Pt(t.filter,e)}function Ao(t,e,r){var n=t.replayFilter;t.replayFilter=n?()=>Pt(n(),e()):e,t.justLimit=r&&!n}function ga(t,e){if(t.isPrimKey)return e.primaryKey;const r=e.getIndexByKeyPath(t.index);if(!r)throw new M.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return r}function iu(t,e,r){const n=ga(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:n,range:t.range}})}function ra(t,e,r,n){const a=t.replayFilter?Pt(t.filter,t.replayFilter()):t.filter;if(t.or){const o={},i=(s,u,c)=>{if(!a||a(u,c,d=>u.stop(d),d=>u.fail(d))){var h=u.primaryKey,y=""+h;y==="[object ArrayBuffer]"&&(y=""+new Uint8Array(h)),ve(o,y)||(o[y]=!0,e(s,u,c))}};return Promise.all([t.or._iterate(i,r),su(iu(t,n,r),t.algorithm,i,!t.keysOnly&&t.valueMapper)])}return su(iu(t,n,r),Pt(t.algorithm,a),e,!t.keysOnly&&t.valueMapper)}function su(t,e,r,n){var a=J(n?(o,i,s)=>r(n(o),i,s):r);return t.then(o=>{if(o)return o.start(()=>{var i=()=>o.continue();e&&!e(o,s=>i=s,s=>{o.stop(s),i=G},s=>{o.fail(s),i=G})||a(o.value,o,s=>i=s),i()})})}function fe(t,e){try{const r=uu(t),n=uu(e);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(a,o){const i=a.length,s=o.length,u=i<s?i:s;for(let c=0;c<u;++c)if(a[c]!==o[c])return a[c]<o[c]?-1:1;return i===s?0:i<s?-1:1}(lu(t),lu(e));case"Array":return function(a,o){const i=a.length,s=o.length,u=i<s?i:s;for(let c=0;c<u;++c){const h=fe(a[c],o[c]);if(h!==0)return h}return i===s?0:i<s?-1:1}(t,e)}}catch{}return NaN}function uu(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const r=zo(t);return r==="ArrayBuffer"?"binary":r}function lu(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class qy{_read(e,r){var n=this._ctx;return n.error?n.table._trans(null,te.bind(null,n.error)):n.table._trans("readonly",e).then(r)}_write(e){var r=this._ctx;return r.error?r.table._trans(null,te.bind(null,r.error)):r.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var r=this._ctx;r.algorithm=Pt(r.algorithm,e)}_iterate(e,r){return ra(this._ctx,e,r,this._ctx.table.core)}clone(e){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&he(n,e),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(e){var r=this._ctx;return this._read(n=>ra(r,e,n,r.table.core))}count(e){return this._read(r=>{const n=this._ctx,a=n.table.core;if(It(n,!0))return a.count({trans:r,query:{index:ga(n,a.schema),range:n.range}}).then(i=>Math.min(i,n.limit));var o=0;return ra(n,()=>(++o,!1),r,a).then(()=>o)}).then(e)}sortBy(e,r){const n=e.split(".").reverse(),a=n[0],o=n.length-1;function i(c,h){return h?i(c[n[h]],h-1):c[a]}var s=this._ctx.dir==="next"?1:-1;function u(c,h){var y=i(c,o),d=i(h,o);return y<d?-s:y>d?s:0}return this.toArray(function(c){return c.sort(u)}).then(r)}toArray(e){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&It(n,!0)&&n.limit>0){const{valueMapper:a}=n,o=ga(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:o,range:n.range}}).then(({result:i})=>a?i.map(a):i)}{const a=[];return ra(n,o=>a.push(o),r,n.table.core).then(()=>a)}},e)}offset(e){var r=this._ctx;return e<=0||(r.offset+=e,It(r)?Ao(r,()=>{var n=e;return(a,o)=>n===0||(n===1?(--n,!1):(o(()=>{a.advance(n),n=0}),!1))}):Ao(r,()=>{var n=e;return()=>--n<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Ao(this._ctx,()=>{var r=e;return function(n,a,o){return--r<=0&&a(o),r>=0}},!0),this}until(e,r){return Po(this._ctx,function(n,a,o){return!e(n.value)||(a(o),r)}),this}first(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var r,n;return Po(this._ctx,function(a){return e(a.value)}),r=this._ctx,n=e,r.isMatch=Pt(r.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,a){e(a.key,a)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,a){e(a.primaryKey,a)})}keys(e){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(a,o){n.push(o.key)}).then(function(){return n}).then(e)}primaryKeys(e){var r=this._ctx;if(r.dir==="next"&&It(r,!0)&&r.limit>0)return this._read(a=>{var o=ga(r,r.table.core.schema);return r.table.core.query({trans:a,values:!1,limit:r.limit,query:{index:o,range:r.range}})}).then(({result:a})=>a).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(a,o){n.push(o.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(r){return r[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,r=e.index&&e.table.schema.idxByName[e.index];if(!r||!r.multi)return this;var n={};return Po(this._ctx,function(a){var o=a.primaryKey.toString(),i=ve(n,o);return n[o]=!0,!i}),this}modify(e){var r=this._ctx;return this._write(n=>{var a;if(typeof e=="function")a=e;else{var o=ee(e),i=o.length;a=function(f){for(var b=!1,p=0;p<i;++p){var g=o[p],_=e[g];Ue(f,g)!==_&&(Se(f,g,_),b=!0)}return b}}const s=r.table.core,{outbound:u,extractKey:c}=s.schema.primaryKey,h=this.db._options.modifyChunkSize||200,y=[];let d=0;const m=[],v=(f,b)=>{const{failures:p,numFailures:g}=b;d+=f-g;for(let _ of ee(p))y.push(p[_])};return this.clone().primaryKeys().then(f=>{const b=p=>{const g=Math.min(h,f.length-p);return s.getMany({trans:n,keys:f.slice(p,p+g),cache:"immutable"}).then(_=>{const A=[],R=[],w=u?[]:null,S=[];for(let T=0;T<g;++T){const D=_[T],L={value:jr(D),primKey:f[p+T]};a.call(L,L.value,L)!==!1&&(L.value==null?S.push(f[p+T]):u||fe(c(D),c(L.value))===0?(R.push(L.value),u&&w.push(f[p+T])):(S.push(f[p+T]),A.push(L.value)))}const C=It(r)&&r.limit===1/0&&(typeof e!="function"||e===Eo)&&{index:r.index,range:r.range};return Promise.resolve(A.length>0&&s.mutate({trans:n,type:"add",values:A}).then(T=>{for(let D in T.failures)S.splice(parseInt(D),1);v(A.length,T)})).then(()=>(R.length>0||C&&typeof e=="object")&&s.mutate({trans:n,type:"put",keys:w,values:R,criteria:C,changeSpec:typeof e!="function"&&e}).then(T=>v(R.length,T))).then(()=>(S.length>0||C&&e===Eo)&&s.mutate({trans:n,type:"delete",keys:S,criteria:C}).then(T=>v(S.length,T))).then(()=>f.length>p+g&&b(p+h))})};return b(0).then(()=>{if(y.length>0)throw new ja("Error modifying one or more objects",y,d,m);return f.length})})})}delete(){var e=this._ctx,r=e.range;return It(e)&&(e.isPrimKey&&!Ny||r.type===3)?this._write(n=>{const{primaryKey:a}=e.table.core.schema,o=r;return e.table.core.count({trans:n,query:{index:a,range:o}}).then(i=>e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(({failures:s,lastResult:u,results:c,numFailures:h})=>{if(h)throw new ja("Could not delete some values",Object.keys(s).map(y=>s[y]),i-h);return i-h}))}):this.modify(Eo)}}const Eo=(t,e)=>e.value=null;function zy(t,e){return t<e?-1:t===e?0:1}function Uy(t,e){return t>e?-1:t===e?0:1}function ge(t,e,r){var n=t instanceof fc?new t.Collection(t):t;return n._ctx.error=r?new r(e):new TypeError(e),n}function Ft(t){return new t.Collection(t,()=>cc("")).limit(0)}function $y(t,e,r,n,a,o){for(var i=Math.min(t.length,n.length),s=-1,u=0;u<i;++u){var c=e[u];if(c!==n[u])return a(t[u],r[u])<0?t.substr(0,u)+r[u]+r.substr(u+1):a(t[u],n[u])<0?t.substr(0,u)+n[u]+r.substr(u+1):s>=0?t.substr(0,s)+e[s]+r.substr(s+1):null;a(t[u],c)<0&&(s=u)}return i<n.length&&o==="next"?t+r.substr(t.length):i<t.length&&o==="prev"?t.substr(0,r.length):s<0?null:t.substr(0,s)+n[s]+r.substr(s+1)}function na(t,e,r,n){var a,o,i,s,u,c,h,y=r.length;if(!r.every(f=>typeof f=="string"))return ge(t,"String expected.");function d(f){a=function(p){return p==="next"?g=>g.toUpperCase():g=>g.toLowerCase()}(f),o=function(p){return p==="next"?g=>g.toLowerCase():g=>g.toUpperCase()}(f),i=f==="next"?zy:Uy;var b=r.map(function(p){return{lower:o(p),upper:a(p)}}).sort(function(p,g){return i(p.lower,g.lower)});s=b.map(function(p){return p.upper}),u=b.map(function(p){return p.lower}),c=f,h=f==="next"?"":n}d("next");var m=new t.Collection(t,()=>Je(s[0],u[y-1]+n));m._ondirectionchange=function(f){d(f)};var v=0;return m._addAlgorithm(function(f,b,p){var g=f.key;if(typeof g!="string")return!1;var _=o(g);if(e(_,u,v))return!0;for(var A=null,R=v;R<y;++R){var w=$y(g,_,s[R],u[R],i,c);w===null&&A===null?v=R+1:(A===null||i(A,w)>0)&&(A=w)}return b(A!==null?function(){f.continue(A+h)}:p),!1}),m}function Je(t,e,r,n){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:n}}function cc(t){return{type:1,lower:t,upper:t}}class fc{get Collection(){return this._ctx.table.db.Collection}between(e,r,n,a){n=n!==!1,a=a===!0;try{return this._cmp(e,r)>0||this._cmp(e,r)===0&&(n||a)&&(!n||!a)?Ft(this):new this.Collection(this,()=>Je(e,r,!n,!a))}catch{return ge(this,je)}}equals(e){return e==null?ge(this,je):new this.Collection(this,()=>cc(e))}above(e){return e==null?ge(this,je):new this.Collection(this,()=>Je(e,void 0,!0))}aboveOrEqual(e){return e==null?ge(this,je):new this.Collection(this,()=>Je(e,void 0,!1))}below(e){return e==null?ge(this,je):new this.Collection(this,()=>Je(void 0,e,!1,!0))}belowOrEqual(e){return e==null?ge(this,je):new this.Collection(this,()=>Je(void 0,e))}startsWith(e){return typeof e!="string"?ge(this,"String expected."):this.between(e,e+bt,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):na(this,(r,n)=>r.indexOf(n[0])===0,[e],bt)}equalsIgnoreCase(e){return na(this,(r,n)=>r===n[0],[e],"")}anyOfIgnoreCase(){var e=De.apply(Mt,arguments);return e.length===0?Ft(this):na(this,(r,n)=>n.indexOf(r)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=De.apply(Mt,arguments);return e.length===0?Ft(this):na(this,(r,n)=>n.some(a=>r.indexOf(a)===0),e,bt)}anyOf(){const e=De.apply(Mt,arguments);let r=this._cmp;try{e.sort(r)}catch{return ge(this,je)}if(e.length===0)return Ft(this);const n=new this.Collection(this,()=>Je(e[0],e[e.length-1]));n._ondirectionchange=o=>{r=o==="next"?this._ascending:this._descending,e.sort(r)};let a=0;return n._addAlgorithm((o,i,s)=>{const u=o.key;for(;r(u,e[a])>0;)if(++a,a===e.length)return i(s),!1;return r(u,e[a])===0||(i(()=>{o.continue(e[a])}),!1)}),n}notEqual(e){return this.inAnyRange([[-(1/0),e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=De.apply(Mt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ge(this,je)}const r=e.reduce((n,a)=>n?n.concat([[n[n.length-1][1],a]]):[[-(1/0),a]],null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,r){const n=this._cmp,a=this._ascending,o=this._descending,i=this._min,s=this._max;if(e.length===0)return Ft(this);if(!e.every(g=>g[0]!==void 0&&g[1]!==void 0&&a(g[0],g[1])<=0))return ge(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",M.InvalidArgument);const u=!r||r.includeLowers!==!1,c=r&&r.includeUppers===!0;let h,y=a;function d(g,_){return y(g[0],_[0])}try{h=e.reduce(function(g,_){let A=0,R=g.length;for(;A<R;++A){const w=g[A];if(n(_[0],w[1])<0&&n(_[1],w[0])>0){w[0]=i(w[0],_[0]),w[1]=s(w[1],_[1]);break}}return A===R&&g.push(_),g},[]),h.sort(d)}catch{return ge(this,je)}let m=0;const v=c?g=>a(g,h[m][1])>0:g=>a(g,h[m][1])>=0,f=u?g=>o(g,h[m][0])>0:g=>o(g,h[m][0])>=0;let b=v;const p=new this.Collection(this,()=>Je(h[0][0],h[h.length-1][1],!u,!c));return p._ondirectionchange=g=>{g==="next"?(b=v,y=a):(b=f,y=o),h.sort(d)},p._addAlgorithm((g,_,A)=>{for(var R=g.key;b(R);)if(++m,m===h.length)return _(A),!1;return!!function(w){return!v(w)&&!f(w)}(R)||(this._cmp(R,h[m][1])===0||this._cmp(R,h[m][0])===0||_(()=>{y===a?g.continue(h[m][0]):g.continue(h[m][1])}),!1)}),p}startsWithAnyOf(){const e=De.apply(Mt,arguments);return e.every(r=>typeof r=="string")?e.length===0?Ft(this):this.inAnyRange(e.map(r=>[r,r+bt])):ge(this,"startsWithAnyOf() only works with strings")}}function Te(t){return J(function(e){return Pr(e),t(e.target.error),!1})}function Pr(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const ot=mr(null,"storagemutated");class Ky{_lock(){return ur(!I.global),++this._reculock,this._reculock!==1||I.global||(I.lockOwnerFor=this),this}_unlock(){if(ur(!I.global),--this._reculock==0)for(I.global||(I.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{er(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&I.lockOwnerFor!==this}create(e){if(!this.mode)return this;const r=this.db.idbdb,n=this.db._state.dbOpenError;if(ur(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new M.DatabaseClosed(n);case"MissingAPIError":throw new M.MissingAPI(n.message,n);default:throw new M.OpenFailed(n)}if(!this.active)throw new M.TransactionInactive;return ur(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=J(a=>{Pr(a),this._reject(e.error)}),e.onabort=J(a=>{Pr(a),this.active&&this._reject(new M.Abort(e.error)),this.active=!1,this.on("abort").fire(a)}),e.oncomplete=J(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&ot.storagemutated.fire(e.mutatedParts)}),this}_promise(e,r,n){if(e==="readwrite"&&this.mode!=="readwrite")return te(new M.ReadOnly("Transaction is readonly"));if(!this.active)return te(new M.TransactionInactive);if(this._locked())return new k((o,i)=>{this._blockedFuncs.push([()=>{this._promise(e,r,n).then(o,i)},I])});if(n)return nt(()=>{var o=new k((i,s)=>{this._lock();const u=r(i,s,this);u&&u.then&&u.then(i,s)});return o.finally(()=>this._unlock()),o._lib=!0,o});var a=new k((o,i)=>{var s=r(o,i,this);s&&s.then&&s.then(o,i)});return a._lib=!0,a}_root(){return this.parent?this.parent._root():this}waitFor(e){var r=this._root();const n=k.resolve(e);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var a=r.idbtrans.objectStore(r.storeNames[0]);(function i(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(a.get(-1/0).onsuccess=i)})()}var o=r._waitingFor;return new k((i,s)=>{n.then(u=>r._waitingQueue.push(J(i.bind(null,u))),u=>r._waitingQueue.push(J(s.bind(null,u)))).finally(()=>{r._waitingFor===o&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new M.Abort))}table(e){const r=this._memoizedTables||(this._memoizedTables={});if(ve(r,e))return r[e];const n=this.schema[e];if(!n)throw new M.NotFound("Table "+e+" not part of transaction");const a=new this.db.Table(e,n,this);return a.core=this.db.core.table(e),r[e]=a,a}}function ei(t,e,r,n,a,o,i){return{name:t,keyPath:e,unique:r,multi:n,auto:a,compound:o,src:(r&&!i?"&":"")+(n?"*":"")+(a?"++":"")+dc(e)}}function dc(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function hc(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:Gl(r,n=>[n.name,n])}}let Ar=t=>{try{return t.only([[]]),Ar=()=>[[]],[[]]}catch{return Ar=()=>bt,bt}};function ti(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?r=>r[e]:r=>Ue(r,e)}(t):e=>Ue(e,t)}function cu(t){return[].slice.call(t)}let Gy=0;function br(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Hy(t,e,r){function n(u){if(u.type===3)return null;if(u.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:h,lowerOpen:y,upperOpen:d}=u;return c===void 0?h===void 0?null:e.upperBound(h,!!d):h===void 0?e.lowerBound(c,!!y):e.bound(c,h,!!y,!!d)}const{schema:a,hasGetAll:o}=function(u,c){const h=cu(u.objectStoreNames);return{schema:{name:u.name,tables:h.map(y=>c.objectStore(y)).map(y=>{const{keyPath:d,autoIncrement:m}=y,v=ue(d),f=d==null,b={},p={name:y.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:f,compound:v,keyPath:d,autoIncrement:m,unique:!0,extractKey:ti(d)},indexes:cu(y.indexNames).map(g=>y.index(g)).map(g=>{const{name:_,unique:A,multiEntry:R,keyPath:w}=g,S={name:_,compound:ue(w),keyPath:w,unique:A,multiEntry:R,extractKey:ti(w)};return b[br(w)]=S,S}),getIndexByKeyPath:g=>b[br(g)]};return b[":id"]=p.primaryKey,d!=null&&(b[br(d)]=p.primaryKey),p})},hasGetAll:h.length>0&&"getAll"in c.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,r),i=a.tables.map(u=>function(c){const h=c.name;return{name:h,schema:c,mutate:function({trans:y,type:d,keys:m,values:v,range:f}){return new Promise((b,p)=>{b=J(b);const g=y.objectStore(h),_=g.keyPath==null,A=d==="put"||d==="add";if(!A&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);const{length:R}=m||v||{length:1};if(m&&v&&m.length!==v.length)throw new Error("Given keys array must have same length as given values array.");if(R===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});let w;const S=[],C=[];let T=0;const D=q=>{++T,Pr(q)};if(d==="deleteRange"){if(f.type===4)return b({numFailures:T,failures:C,results:[],lastResult:void 0});f.type===3?S.push(w=g.clear()):S.push(w=g.delete(n(f)))}else{const[q,$]=A?_?[v,m]:[v,null]:[m,null];if(A)for(let z=0;z<R;++z)S.push(w=$&&$[z]!==void 0?g[d](q[z],$[z]):g[d](q[z])),w.onerror=D;else for(let z=0;z<R;++z)S.push(w=g[d](q[z])),w.onerror=D}const L=q=>{const $=q.target.result;S.forEach((z,be)=>z.error!=null&&(C[be]=z.error)),b({numFailures:T,failures:C,results:d==="delete"?m:S.map(z=>z.result),lastResult:$})};w.onerror=q=>{D(q),L(q)},w.onsuccess=L})},getMany:({trans:y,keys:d})=>new Promise((m,v)=>{m=J(m);const f=y.objectStore(h),b=d.length,p=new Array(b);let g,_=0,A=0;const R=S=>{const C=S.target;p[C._pos]=C.result,++A===_&&m(p)},w=Te(v);for(let S=0;S<b;++S)d[S]!=null&&(g=f.get(d[S]),g._pos=S,g.onsuccess=R,g.onerror=w,++_);_===0&&m(p)}),get:({trans:y,key:d})=>new Promise((m,v)=>{m=J(m);const f=y.objectStore(h).get(d);f.onsuccess=b=>m(b.target.result),f.onerror=Te(v)}),query:function(y){return d=>new Promise((m,v)=>{m=J(m);const{trans:f,values:b,limit:p,query:g}=d,_=p===1/0?void 0:p,{index:A,range:R}=g,w=f.objectStore(h),S=A.isPrimaryKey?w:w.index(A.name),C=n(R);if(p===0)return m({result:[]});if(y){const T=b?S.getAll(C,_):S.getAllKeys(C,_);T.onsuccess=D=>m({result:D.target.result}),T.onerror=Te(v)}else{let T=0;const D=b||!("openKeyCursor"in S)?S.openCursor(C):S.openKeyCursor(C),L=[];D.onsuccess=q=>{const $=D.result;return $?(L.push(b?$.value:$.primaryKey),++T===p?m({result:L}):void $.continue()):m({result:L})},D.onerror=Te(v)}})}(o),openCursor:function({trans:y,values:d,query:m,reverse:v,unique:f}){return new Promise((b,p)=>{b=J(b);const{index:g,range:_}=m,A=y.objectStore(h),R=g.isPrimaryKey?A:A.index(g.name),w=v?f?"prevunique":"prev":f?"nextunique":"next",S=d||!("openKeyCursor"in R)?R.openCursor(n(_),w):R.openKeyCursor(n(_),w);S.onerror=Te(p),S.onsuccess=J(C=>{const T=S.result;if(!T)return void b(null);T.___id=++Gy,T.done=!1;const D=T.continue.bind(T);let L=T.continuePrimaryKey;L&&(L=L.bind(T));const q=T.advance.bind(T),$=()=>{throw new Error("Cursor not stopped")};T.trans=y,T.stop=T.continue=T.continuePrimaryKey=T.advance=()=>{throw new Error("Cursor not started")},T.fail=J(p),T.next=function(){let z=1;return this.start(()=>z--?this.continue():this.stop()).then(()=>this)},T.start=z=>{const be=new Promise((oe,Ee)=>{oe=J(oe),S.onerror=Te(Ee),T.fail=Ee,T.stop=pe=>{T.stop=T.continue=T.continuePrimaryKey=T.advance=$,oe(pe)}}),ce=()=>{if(S.result)try{z()}catch(oe){T.fail(oe)}else T.done=!0,T.start=()=>{throw new Error("Cursor behind last entry")},T.stop()};return S.onsuccess=J(oe=>{S.onsuccess=ce,ce()}),T.continue=D,T.continuePrimaryKey=L,T.advance=q,ce(),be},b(T)},p)})},count({query:y,trans:d}){const{index:m,range:v}=y;return new Promise((f,b)=>{const p=d.objectStore(h),g=m.isPrimaryKey?p:p.index(m.name),_=n(v),A=_?g.count(_):g.count();A.onsuccess=J(R=>f(R.target.result)),A.onerror=Te(b)})}}}(u)),s={};return i.forEach(u=>s[u.name]=u),{stack:"dbcore",transaction:t.transaction.bind(t),table(u){if(!s[u])throw new Error(`Table '${u}' not found`);return s[u]},MIN_KEY:-1/0,MAX_KEY:Ar(e),schema:a}}function ri({_novip:t},e){const r=e.db,n=function(a,o,{IDBKeyRange:i,indexedDB:s},u){return{dbcore:function(h,y){return y.reduce((d,{create:m})=>({...d,...m(d)}),h)}(Hy(o,i,u),a.dbcore)}}(t._middlewares,r,t._deps,e);t.core=n.dbcore,t.tables.forEach(a=>{const o=a.name;t.core.schema.tables.some(i=>i.name===o)&&(a.core=t.core.table(o),t[o]instanceof t.Table&&(t[o].core=a.core))})}function qa({_novip:t},e,r,n){r.forEach(a=>{const o=n[a];e.forEach(i=>{const s=Yi(i,a);(!s||"value"in s&&s.value===void 0)&&(i===t.Transaction.prototype||i instanceof t.Transaction?ze(i,a,{get(){return this.table(a)},set(u){Ul(this,a,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):i[a]=new t.Table(a,o))})})}function ni({_novip:t},e){e.forEach(r=>{for(let n in r)r[n]instanceof t.Table&&delete r[n]})}function Vy(t,e){return t._cfg.version-e._cfg.version}function Jy(t,e,r,n){const a=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,a);o.create(r),o._completion.catch(n);const i=o._reject.bind(o),s=I.transless||I;nt(()=>{I.trans=o,I.transless=s,e===0?(ee(a).forEach(u=>{Co(r,u,a[u].primKey,a[u].indexes)}),ri(t,r),k.follow(()=>t.on.populate.fire(o)).catch(i)):function({_novip:u},c,h,y){const d=[],m=u._versions;let v=u._dbSchema=oi(u,u.idbdb,y),f=!1;function b(){return d.length?k.resolve(d.shift()(h.idbtrans)).then(b):k.resolve()}return m.filter(p=>p._cfg.version>=c).forEach(p=>{d.push(()=>{const g=v,_=p._cfg.dbschema;ii(u,g,y),ii(u,_,y),v=u._dbSchema=_;const A=pc(g,_);A.add.forEach(w=>{Co(y,w[0],w[1].primKey,w[1].indexes)}),A.change.forEach(w=>{if(w.recreate)throw new M.Upgrade("Not yet support for changing primary key");{const S=y.objectStore(w.name);w.add.forEach(C=>ai(S,C)),w.change.forEach(C=>{S.deleteIndex(C.name),ai(S,C)}),w.del.forEach(C=>S.deleteIndex(C))}});const R=p._cfg.contentUpgrade;if(R&&p._cfg.version>c){ri(u,y),h._memoizedTables={},f=!0;let w=Hl(_);A.del.forEach(D=>{w[D]=g[D]}),ni(u,[u.Transaction.prototype]),qa(u,[u.Transaction.prototype],ee(w),w),h.schema=w;const S=Qi(R);let C;S&&Zt();const T=k.follow(()=>{if(C=R(h),C&&S){var D=Ge.bind(null,null);C.then(D,D)}});return C&&typeof C.then=="function"?k.resolve(C):T.then(()=>C)}}),d.push(g=>{(!f||!Dy)&&function(_,A){[].slice.call(A.db.objectStoreNames).forEach(R=>_[R]==null&&A.db.deleteObjectStore(R))}(p._cfg.dbschema,g),ni(u,[u.Transaction.prototype]),qa(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),h.schema=u._dbSchema})}),b().then(()=>{var p,g;g=y,ee(p=v).forEach(_=>{g.db.objectStoreNames.contains(_)||Co(g,_,p[_].primKey,p[_].indexes)})})}(t,e,o,r).catch(i)})}function pc(t,e){const r={del:[],add:[],change:[]};let n;for(n in t)e[n]||r.del.push(n);for(n in e){const a=t[n],o=e[n];if(a){const i={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||a.primKey.auto!==o.primKey.auto&&!eo)i.recreate=!0,r.change.push(i);else{const s=a.idxByName,u=o.idxByName;let c;for(c in s)u[c]||i.del.push(c);for(c in u){const h=s[c],y=u[c];h?h.src!==y.src&&i.change.push(y):i.add.push(y)}(i.del.length>0||i.add.length>0||i.change.length>0)&&r.change.push(i)}}else r.add.push([n,o])}return r}function Co(t,e,r,n){const a=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(o=>ai(a,o)),a}function ai(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function oi(t,e,r){const n={};return Ma(e.objectStoreNames,0).forEach(a=>{const o=r.objectStore(a);let i=o.keyPath;const s=ei(dc(i),i||"",!1,!1,!!o.autoIncrement,i&&typeof i!="string",!0),u=[];for(let h=0;h<o.indexNames.length;++h){const y=o.index(o.indexNames[h]);i=y.keyPath;var c=ei(y.name,i,!!y.unique,!!y.multiEntry,!1,i&&typeof i!="string",!1);u.push(c)}n[a]=hc(a,s,u)}),n}function ii({_novip:t},e,r){const n=r.db.objectStoreNames;for(let a=0;a<n.length;++a){const o=n[a],i=r.objectStore(o);t._hasGetAll="getAll"in i;for(let s=0;s<i.indexNames.length;++s){const u=i.indexNames[s],c=i.index(u).keyPath,h=typeof c=="string"?c:"["+Ma(c).join("+")+"]";if(e[o]){const y=e[o].idxByName[h];y&&(y.name=u,delete e[o].idxByName[h],e[o].idxByName[u]=y)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&V.WorkerGlobalScope&&V instanceof V.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class Yy{_parseStoresSpec(e,r){ee(e).forEach(n=>{if(e[n]!==null){var a=e[n].split(",").map((i,s)=>{const u=(i=i.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return ei(u,c||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),ue(c),s===0)}),o=a.shift();if(o.multi)throw new M.Schema("Primary key cannot be multi-valued");a.forEach(i=>{if(i.auto)throw new M.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new M.Schema("Index must have a name and cannot be an empty string")}),r[n]=hc(n,o,a)}})}stores(e){const r=this.db;this._cfg.storesSource=this._cfg.storesSource?he(this._cfg.storesSource,e):e;const n=r._versions,a={};let o={};return n.forEach(i=>{he(a,i._cfg.storesSource),o=i._cfg.dbschema={},i._parseStoresSpec(a,o)}),r._dbSchema=o,ni(r,[r._allTables,r,r.Transaction.prototype]),qa(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],ee(o),o),r._storeNames=ee(o),this}upgrade(e){return this._cfg.contentUpgrade=es(this._cfg.contentUpgrade||G,e),this}}function as(t,e){let r=t._dbNamesDB;return r||(r=t._dbNamesDB=new $e("__dbnames",{addons:[],indexedDB:t,IDBKeyRange:e}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function os(t){return t&&typeof t.databases=="function"}function si(t){return nt(function(){return I.letThrough=!0,t()})}function Qy(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var r=function(){return indexedDB.databases().finally(e)};t=setInterval(r,100),r()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function Xy(t){const e=t._state,{indexedDB:r}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?te(e.dbOpenError):t);Be&&(e.openCanceller._stackHolder=Ct()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const n=e.openCanceller;function a(){if(e.openCanceller!==n)throw new M.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,i=null,s=!1;return k.race([n,(typeof navigator>"u"?k.resolve():Qy()).then(()=>new k((u,c)=>{if(a(),!r)throw new M.MissingAPI;const h=t.name,y=e.autoSchema?r.open(h):r.open(h,Math.round(10*t.verno));if(!y)throw new M.MissingAPI;y.onerror=Te(c),y.onblocked=J(t._fireOnBlocked),y.onupgradeneeded=J(d=>{if(i=y.transaction,e.autoSchema&&!t._options.allowEmptyDB){y.onerror=Pr,i.abort(),y.result.close();const v=r.deleteDatabase(h);v.onsuccess=v.onerror=J(()=>{c(new M.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{i.onerror=Te(c);var m=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;s=m<1,t._novip.idbdb=y.result,Jy(t,m/10,i,c)}},c),y.onsuccess=J(()=>{i=null;const d=t._novip.idbdb=y.result,m=Ma(d.objectStoreNames);if(m.length>0)try{const f=d.transaction((v=m).length===1?v[0]:v,"readonly");e.autoSchema?function({_novip:b},p,g){b.verno=p.version/10;const _=b._dbSchema=oi(0,p,g);b._storeNames=Ma(p.objectStoreNames,0),qa(b,[b._allTables],ee(_),_)}(t,d,f):(ii(t,t._dbSchema,f),function(b,p){const g=pc(oi(0,b.idbdb,p),b._dbSchema);return!(g.add.length||g.change.some(_=>_.add.length||_.change.length))}(t,f)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),ri(t,f)}catch{}var v;yr.push(t),d.onversionchange=J(f=>{e.vcFired=!0,t.on("versionchange").fire(f)}),d.onclose=J(f=>{t.on("close").fire(f)}),s&&function({indexedDB:f,IDBKeyRange:b},p){!os(f)&&p!=="__dbnames"&&as(f,b).put({name:p}).catch(G)}(t._deps,h),u()},c)}))]).then(()=>(a(),e.onReadyBeingFired=[],k.resolve(si(()=>t.on.ready.fire(t.vip))).then(function u(){if(e.onReadyBeingFired.length>0){let c=e.onReadyBeingFired.reduce(es,G);return e.onReadyBeingFired=[],k.resolve(si(()=>c(t.vip))).then(u)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(u=>{e.dbOpenError=u;try{i&&i.abort()}catch{}return n===e.openCanceller&&t._close(),te(u)}).finally(()=>{e.openComplete=!0,o()})}function ui(t){var e=o=>t.next(o),r=a(e),n=a(o=>t.throw(o));function a(o){return i=>{var s=o(i),u=s.value;return s.done?u:u&&typeof u.then=="function"?u.then(r,n):ue(u)?Promise.all(u).then(r,n):r(u)}}return a(e)()}function Zy(t,e,r){var n=arguments.length;if(n<2)throw new M.InvalidArgument("Too few arguments");for(var a=new Array(n-1);--n;)a[n-1]=arguments[n];r=a.pop();var o=Vl(a);return[t,o,r]}function yc(t,e,r,n,a){return k.resolve().then(()=>{const o=I.transless||I,i=t._createTransaction(e,r,t._dbSchema,n),s={trans:i,transless:o};if(n)i.idbtrans=n.idbtrans;else try{i.create(),t._state.PR1398_maxLoop=3}catch(y){return y.name===Zi.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>yc(t,e,r,null,a))):te(y)}const u=Qi(a);let c;u&&Zt();const h=k.follow(()=>{if(c=a.call(i,i),c)if(u){var y=Ge.bind(null,null);c.then(y,y)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=ui(c))},s);return(c&&typeof c.then=="function"?k.resolve(c).then(y=>i.active?y:te(new M.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>c)).then(y=>(n&&i._resolve(),i._completion.then(()=>y))).catch(y=>(i._reject(y),te(y)))})}function aa(t,e,r){const n=ue(t)?t.slice():[t];for(let a=0;a<r;++a)n.push(e);return n}const em={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const r=t.table(e),{schema:n}=r,a={},o=[];function i(h,y,d){const m=br(h),v=a[m]=a[m]||[],f=h==null?0:typeof h=="string"?1:h.length,b=y>0,p={...d,isVirtual:b,keyTail:y,keyLength:f,extractKey:ti(h),unique:!b&&d.unique};return v.push(p),p.isPrimaryKey||o.push(p),f>1&&i(f===2?h[0]:h.slice(0,f-1),y+1,d),v.sort((g,_)=>g.keyTail-_.keyTail),p}const s=i(n.primaryKey.keyPath,0,n.primaryKey);a[":id"]=[s];for(const h of n.indexes)i(h.keyPath,0,h);function u(h){const y=h.query.index;return y.isVirtual?{...h,query:{index:y,range:(d=h.query.range,m=y.keyTail,{type:d.type===1?2:d.type,lower:aa(d.lower,d.lowerOpen?t.MAX_KEY:t.MIN_KEY,m),lowerOpen:!0,upper:aa(d.upper,d.upperOpen?t.MIN_KEY:t.MAX_KEY,m),upperOpen:!0})}}:h;var d,m}return{...r,schema:{...n,primaryKey:s,indexes:o,getIndexByKeyPath:function(h){const y=a[br(h)];return y&&y[0]}},count:h=>r.count(u(h)),query:h=>r.query(u(h)),openCursor(h){const{keyTail:y,isVirtual:d,keyLength:m}=h.query.index;return d?r.openCursor(u(h)).then(v=>v&&function(f){return Object.create(f,{continue:{value:function(p){p!=null?f.continue(aa(p,h.reverse?t.MAX_KEY:t.MIN_KEY,y)):h.unique?f.continue(f.key.slice(0,m).concat(h.reverse?t.MIN_KEY:t.MAX_KEY,y)):f.continue()}},continuePrimaryKey:{value(p,g){f.continuePrimaryKey(aa(p,t.MAX_KEY,y),g)}},primaryKey:{get:()=>f.primaryKey},key:{get(){const p=f.key;return m===1?p[0]:p.slice(0,m)}},value:{get:()=>f.value}})}(v)):r.openCursor(h)}}}}}};function is(t,e,r,n){return r=r||{},n=n||"",ee(t).forEach(a=>{if(ve(e,a)){var o=t[a],i=e[a];if(typeof o=="object"&&typeof i=="object"&&o&&i){const s=zo(o);s!==zo(i)?r[n+a]=e[a]:s==="Object"?is(o,i,r,n+a+"."):o!==i&&(r[n+a]=e[a])}else o!==i&&(r[n+a]=e[a])}else r[n+a]=void 0}),ee(e).forEach(a=>{ve(t,a)||(r[n+a]=e[a])}),r}const tm={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const r=t.table(e),{primaryKey:n}=r.schema;return{...r,mutate(o){const i=I.trans,{deleting:s,creating:u,updating:c}=i.table(e).hook;switch(o.type){case"add":if(u.fire===G)break;return i._promise("readwrite",()=>h(o),!0);case"put":if(u.fire===G&&c.fire===G)break;return i._promise("readwrite",()=>h(o),!0);case"delete":if(s.fire===G)break;return i._promise("readwrite",()=>h(o),!0);case"deleteRange":if(s.fire===G)break;return i._promise("readwrite",()=>function(d){return y(d.trans,d.range,1e4)}(o),!0)}return r.mutate(o);function h(d){const m=I.trans,v=d.keys||function(f,b){return b.type==="delete"?b.keys:b.keys||b.values.map(f.extractKey)}(n,d);if(!v)throw new Error("Keys missing");return(d=d.type==="add"||d.type==="put"?{...d,keys:v}:{...d}).type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),function(f,b,p){return b.type==="add"?Promise.resolve([]):f.getMany({trans:b.trans,keys:p,cache:"immutable"})}(r,d,v).then(f=>{const b=v.map((p,g)=>{const _=f[g],A={onerror:null,onsuccess:null};if(d.type==="delete")s.fire.call(A,p,_,m);else if(d.type==="add"||_===void 0){const R=u.fire.call(A,p,d.values[g],m);p==null&&R!=null&&(p=R,d.keys[g]=p,n.outbound||Se(d.values[g],n.keyPath,p))}else{const R=is(_,d.values[g]),w=c.fire.call(A,R,p,_,m);if(w){const S=d.values[g];Object.keys(w).forEach(C=>{ve(S,C)?S[C]=w[C]:Se(S,C,w[C])})}}return A});return r.mutate(d).then(({failures:p,results:g,numFailures:_,lastResult:A})=>{for(let R=0;R<v.length;++R){const w=g?g[R]:v[R],S=b[R];w==null?S.onerror&&S.onerror(p[R]):S.onsuccess&&S.onsuccess(d.type==="put"&&f[R]?d.values[R]:w)}return{failures:p,results:g,numFailures:_,lastResult:A}}).catch(p=>(b.forEach(g=>g.onerror&&g.onerror(p)),Promise.reject(p)))})}function y(d,m,v){return r.query({trans:d,values:!1,query:{index:n,range:m},limit:v}).then(({result:f})=>h({type:"delete",keys:f,trans:d}).then(b=>b.numFailures>0?Promise.reject(b.failures[0]):f.length<v?{failures:[],numFailures:0,lastResult:void 0}:y(d,{...m,lower:f[f.length-1],lowerOpen:!0},v)))}}}}})};function mc(t,e,r){try{if(!e||e.keys.length<t.length)return null;const n=[];for(let a=0,o=0;a<e.keys.length&&o<t.length;++a)fe(e.keys[a],t[o])===0&&(n.push(r?jr(e.values[a]):e.values[a]),++o);return n.length===t.length?n:null}catch{return null}}const rm={stack:"dbcore",level:-1,create:t=>({table:e=>{const r=t.table(e);return{...r,getMany:n=>{if(!n.cache)return r.getMany(n);const a=mc(n.keys,n.trans._cache,n.cache==="clone");return a?k.resolve(a):r.getMany(n).then(o=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?jr(o):o},o))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))}}})};function ss(t){return!("from"in t)}const ke=function(t,e){if(!this){const r=new ke;return t&&"d"in t&&he(r,t),r}he(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function Er(t,e,r){const n=fe(e,r);if(isNaN(n))return;if(n>0)throw RangeError();if(ss(t))return he(t,{from:e,to:r,d:1});const a=t.l,o=t.r;if(fe(r,t.from)<0)return a?Er(a,e,r):t.l={from:e,to:r,d:1,l:null,r:null},fu(t);if(fe(e,t.to)>0)return o?Er(o,e,r):t.r={from:e,to:r,d:1,l:null,r:null},fu(t);fe(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),fe(r,t.to)>0&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1);const i=!t.r;a&&!t.l&&Cr(t,a),o&&i&&Cr(t,o)}function Cr(t,e){ss(e)||function r(n,{from:a,to:o,l:i,r:s}){Er(n,a,o),i&&r(n,i),s&&r(n,s)}(t,e)}function bc(t,e){const r=li(e);let n=r.next();if(n.done)return!1;let a=n.value;const o=li(t);let i=o.next(a.from),s=i.value;for(;!n.done&&!i.done;){if(fe(s.from,a.to)<=0&&fe(s.to,a.from)>=0)return!0;fe(a.from,s.from)<0?a=(n=r.next(s.from)).value:s=(i=o.next(a.from)).value}return!1}function li(t){let e=ss(t)?null:{s:0,n:t};return{next(r){const n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&fe(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||fe(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function fu(t){var e,r;const n=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((r=t.l)===null||r===void 0?void 0:r.d)||0),a=n>1?"r":n<-1?"l":"";if(a){const o=a==="r"?"l":"r",i={...t},s=t[a];t.from=s.from,t.to=s.to,t[a]=s[a],i[a]=s[o],t[o]=i,i.d=du(i)}t.d=du(t)}function du({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}Jt(ke.prototype,{add(t){return Cr(this,t),this},addKey(t){return Er(this,t,t),this},addKeys(t){return t.forEach(e=>Er(this,e,e)),this},[Uo](){return li(this)}});const nm={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,r=new ke(t.MIN_KEY,t.MAX_KEY);return{...t,table:n=>{const a=t.table(n),{schema:o}=a,{primaryKey:i}=o,{extractKey:s,outbound:u}=i,c={...a,mutate:d=>{const m=d.trans,v=m.mutatedParts||(m.mutatedParts={}),f=w=>{const S=`idb://${e}/${n}/${w}`;return v[S]||(v[S]=new ke)},b=f(""),p=f(":dels"),{type:g}=d;let[_,A]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[];const R=d.trans._cache;return a.mutate(d).then(w=>{if(ue(_)){g!=="delete"&&(_=w.results),b.addKeys(_);const S=mc(_,R);S||g==="add"||p.addKeys(_),(S||A)&&function(C,T,D,L){function q($){const z=C($.name||"");function be(oe){return oe!=null?$.extractKey(oe):null}const ce=oe=>$.multiEntry&&ue(oe)?oe.forEach(Ee=>z.addKey(Ee)):z.addKey(oe);(D||L).forEach((oe,Ee)=>{const pe=D&&be(D[Ee]),Me=L&&be(L[Ee]);fe(pe,Me)!==0&&(pe!=null&&ce(pe),Me!=null&&ce(Me))})}T.indexes.forEach(q)}(f,o,S,A)}else if(_){const S={from:_.lower,to:_.upper};p.add(S),b.add(S)}else b.add(r),p.add(r),o.indexes.forEach(S=>f(S.name).add(r));return w})}},h=({query:{index:d,range:m}})=>{var v,f;return[d,new ke((v=m.lower)!==null&&v!==void 0?v:t.MIN_KEY,(f=m.upper)!==null&&f!==void 0?f:t.MAX_KEY)]},y={get:d=>[i,new ke(d.key)],getMany:d=>[i,new ke().addKeys(d.keys)],count:h,query:h,openCursor:h};return ee(y).forEach(d=>{c[d]=function(m){const{subscr:v}=I;if(v){const f=A=>{const R=`idb://${e}/${n}/${A}`;return v[R]||(v[R]=new ke)},b=f(""),p=f(":dels"),[g,_]=y[d](m);if(f(g.name||"").add(_),!g.isPrimaryKey){if(d!=="count"){const A=d==="query"&&u&&m.values&&a.query({...m,values:!1});return a[d].apply(this,arguments).then(R=>{if(d==="query"){if(u&&m.values)return A.then(({result:S})=>(b.addKeys(S),R));const w=m.values?R.result.map(s):R.result;m.values?b.addKeys(w):p.addKeys(w)}else if(d==="openCursor"){const w=R,S=m.values;return w&&Object.create(w,{key:{get:()=>(p.addKey(w.primaryKey),w.key)},primaryKey:{get(){const C=w.primaryKey;return p.addKey(C),C}},value:{get:()=>(S&&b.addKey(w.primaryKey),w.value)}})}return R})}p.add(r)}}return a[d].apply(this,arguments)}}),c}}}};class $e{constructor(e,r){this._middlewares={},this.verno=0;const n=$e.dependencies;this._options=r={addons:$e.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...r},this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};const{addons:a}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:G,dbReadyPromise:null,cancelOpen:G,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var i;o.dbReadyPromise=new k(s=>{o.dbReadyResolve=s}),o.openCanceller=new k((s,u)=>{o.cancelOpen=u}),this._state=o,this.name=e,this.on=mr(this,"populate","blocked","versionchange","close",{ready:[es,G]}),this.on.ready.subscribe=$l(this.on.ready.subscribe,s=>(u,c)=>{$e.vip(()=>{const h=this._state;if(h.openComplete)h.dbOpenError||k.resolve().then(u),c&&s(u);else if(h.onReadyBeingFired)h.onReadyBeingFired.push(u),c&&s(u);else{s(u);const y=this;c||s(function d(){y.on.ready.unsubscribe(u),y.on.ready.unsubscribe(d)})}})}),this.Collection=(i=this,or(qy.prototype,function(s,u){this.db=i;let c=lc,h=null;if(u)try{c=u()}catch(v){h=v}const y=s._ctx,d=y.table,m=d.hook.reading.fire;this._ctx={table:d,index:y.index,isPrimKey:!y.index||d.schema.primKey.keyPath&&y.index===d.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:h,or:y.or,valueMapper:m!==Sr?m:null}})),this.Table=function(s){return or(Ly.prototype,function(u,c,h){this.db=s,this._tx=h,this.name=u,this.schema=c,this.hook=s._allTables[u]?s._allTables[u].hook:mr(null,{creating:[Ty,G],reading:[Cy,Sr],updating:[ky,G],deleting:[Oy,G]})})}(this),this.Transaction=function(s){return or(Ky.prototype,function(u,c,h,y,d){this.db=s,this.mode=u,this.storeNames=c,this.schema=h,this.chromeTransactionDurability=y,this.idbtrans=null,this.on=mr(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new k((m,v)=>{this._resolve=m,this._reject=v}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},m=>{var v=this.active;return this.active=!1,this.on.error.fire(m),this.parent?this.parent._reject(m):v&&this.idbtrans&&this.idbtrans.abort(),te(m)})})}(this),this.Version=function(s){return or(Yy.prototype,function(u){this.db=s,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(s){return or(fc.prototype,function(u,c,h){this.db=s,this._ctx={table:u,index:c===":id"?null:c,or:h};const y=s._deps.indexedDB;if(!y)throw new M.MissingAPI;this._cmp=this._ascending=y.cmp.bind(y),this._descending=(d,m)=>y.cmp(m,d),this._max=(d,m)=>y.cmp(d,m)>0?d:m,this._min=(d,m)=>y.cmp(d,m)<0?d:m,this._IDBKeyRange=s._deps.IDBKeyRange})}(this),this.on("versionchange",s=>{s.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",s=>{!s.newVersion||s.newVersion<s.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${s.oldVersion/10}`)}),this._maxKey=Ar(r.IDBKeyRange),this._createTransaction=(s,u,c,h)=>new this.Transaction(s,u,c,this._options.chromeTransactionDurability,h),this._fireOnBlocked=s=>{this.on("blocked").fire(s),yr.filter(u=>u.name===this.name&&u!==this&&!u._state.vcFired).map(u=>u.on("versionchange").fire(s))},this.use(em),this.use(tm),this.use(nm),this.use(rm),this.vip=Object.create(this,{_vip:{value:!0}}),a.forEach(s=>s(this))}version(e){if(isNaN(e)||e<.1)throw new M.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new M.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const r=this._versions;var n=r.filter(a=>a._cfg.version===e)[0];return n||(n=new this.Version(e),r.push(n),r.sort(Vy),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||I.letThrough||this._vip)?e():new k((r,n)=>{if(this._state.openComplete)return n(new M.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void n(new M.DatabaseClosed);this.open().catch(G)}this._state.dbReadyPromise.then(r,n)}).then(e)}use({stack:e,create:r,level:n,name:a}){a&&this.unuse({stack:e,name:a});const o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:r,level:n??10,name:a}),o.sort((i,s)=>i.level-s.level),this}unuse({stack:e,name:r,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(a=>n?a.create!==n:!!r&&a.name!==r)),this}open(){return Xy(this)}_close(){const e=this._state,r=yr.indexOf(this);if(r>=0&&yr.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new k(n=>{e.dbReadyResolve=n}),e.openCanceller=new k((n,a)=>{e.cancelOpen=a})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new M.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,r=this._state;return new k((n,a)=>{const o=()=>{this.close();var i=this._deps.indexedDB.deleteDatabase(this.name);i.onsuccess=J(()=>{(function({indexedDB:s,IDBKeyRange:u},c){!os(s)&&c!=="__dbnames"&&as(s,u).delete(c).catch(G)})(this._deps,this.name),n()}),i.onerror=Te(a),i.onblocked=this._fireOnBlocked};if(e)throw new M.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return ee(this._allTables).map(e=>this._allTables[e])}transaction(){const e=Zy.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,r,n){let a=I.trans;a&&a.db===this&&e.indexOf("!")===-1||(a=null);const o=e.indexOf("?")!==-1;let i,s;e=e.replace("!","").replace("?","");try{if(s=r.map(c=>{var h=c instanceof this.Table?c.name:c;if(typeof h!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),e=="r"||e==="readonly")i="readonly";else{if(e!="rw"&&e!="readwrite")throw new M.InvalidArgument("Invalid transaction mode: "+e);i="readwrite"}if(a){if(a.mode==="readonly"&&i==="readwrite"){if(!o)throw new M.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a=null}a&&s.forEach(c=>{if(a&&a.storeNames.indexOf(c)===-1){if(!o)throw new M.SubTransaction("Table "+c+" not included in parent transaction.");a=null}}),o&&a&&!a.active&&(a=null)}}catch(c){return a?a._promise(null,(h,y)=>{y(c)}):te(c)}const u=yc.bind(null,this,i,s,a,n);return a?a._promise(i,u,"lock"):I.trans?er(I.transless,()=>this._whenReady(u)):this._whenReady(u)}table(e){if(!ve(this._allTables,e))throw new M.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const am=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class om{constructor(e){this._subscribe=e}subscribe(e,r,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:r,complete:n})}[am](){return this}}function gc(t,e){return ee(e).forEach(r=>{Cr(t[r]||(t[r]=new ke),e[r])}),t}function vc(t){return new om(e=>{const r=Qi(t);let n=!1,a={},o={};const i={get closed(){return n},unsubscribe:()=>{n=!0,ot.storagemutated.unsubscribe(h)}};e.start&&e.start(i);let s=!1,u=!1;function c(){return ee(o).some(d=>a[d]&&bc(a[d],o[d]))}const h=d=>{gc(a,d),c()&&y()},y=()=>{if(s||n)return;a={};const d={},m=function(v){r&&Zt();const f=()=>nt(t,{subscr:v,trans:null}),b=I.trans?er(I.transless,f):f();return r&&b.then(Ge,Ge),b}(d);u||(ot("storagemutated",h),u=!0),s=!0,Promise.resolve(m).then(v=>{s=!1,n||(c()?y():(a={},o=d,e.next&&e.next(v)))},v=>{s=!1,e.error&&e.error(v),i.unsubscribe()})};return y(),i})}let ci;try{ci={indexedDB:V.indexedDB||V.mozIndexedDB||V.webkitIndexedDB||V.msIndexedDB,IDBKeyRange:V.IDBKeyRange||V.webkitIDBKeyRange}}catch{ci={indexedDB:null,IDBKeyRange:null}}const ht=$e;function va(t){let e=qe;try{qe=!0,ot.storagemutated.fire(t)}finally{qe=e}}Jt(ht,{...ha,delete:t=>new ht(t,{addons:[]}).delete(),exists:t=>new ht(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:r}){return os(e)?Promise.resolve(e.databases()).then(n=>n.map(a=>a.name).filter(a=>a!=="__dbnames")):as(e,r).toCollection().primaryKeys()}(ht.dependencies).then(t)}catch{return te(new M.MissingAPI)}},defineClass:()=>function(t){he(this,t)},ignoreTransaction:t=>I.trans?er(I.transless,t):t(),vip:si,async:function(t){return function(){try{var e=ui(t.apply(this,arguments));return e&&typeof e.then=="function"?e:k.resolve(e)}catch(r){return te(r)}}},spawn:function(t,e,r){try{var n=ui(t.apply(r,e||[]));return n&&typeof n.then=="function"?n:k.resolve(n)}catch(a){return te(a)}},currentTransaction:{get:()=>I.trans||null},waitFor:function(t,e){const r=k.resolve(typeof t=="function"?ht.ignoreTransaction(t):t).timeout(e||6e4);return I.trans?I.trans.waitFor(r):r},Promise:k,debug:{get:()=>Be,set:t=>{Yl(t,t==="dexie"?()=>!0:uc)}},derive:Lt,extend:he,props:Jt,override:$l,Events:mr,on:ot,liveQuery:vc,extendObservabilitySet:gc,getByKeyPath:Ue,setByKeyPath:Se,delByKeyPath:function(t,e){typeof e=="string"?Se(t,e,void 0):"length"in e&&[].map.call(e,function(r){Se(t,r,void 0)})},shallowClone:Hl,deepClone:jr,getObjectDiff:is,cmp:fe,asap:Kl,minKey:-(1/0),addons:[],connections:yr,errnames:Zi,dependencies:ci,semVer:"3.2.3",version:"3.2.3".split(".").map(t=>parseInt(t)).reduce((t,e,r)=>t+e/Math.pow(10,2*r))}),ht.maxKey=Ar(ht.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ot("storagemutated",t=>{if(!qe){let e;eo?(e=document.createEvent("CustomEvent"),e.initCustomEvent("x-storagemutated-1",!0,!0,t)):e=new CustomEvent("x-storagemutated-1",{detail:t}),qe=!0,dispatchEvent(e),qe=!1}}),addEventListener("x-storagemutated-1",({detail:t})=>{qe||va(t)}));let qe=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel("x-storagemutated-1");typeof t.unref=="function"&&t.unref(),ot("storagemutated",e=>{qe||t.postMessage(e)}),t.onmessage=e=>{e.data&&va(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){ot("storagemutated",e=>{try{qe||(typeof localStorage<"u"&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:"x-storagemutated-1",changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key==="x-storagemutated-1"){const r=JSON.parse(e.newValue);r&&va(r.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type==="x-storagemutated-1"&&va(e.changedParts)})}k.rejectionMapper=function(t,e){if(!t||t instanceof qt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!nu[t.name])return t;var r=new nu[t.name](e||t.message,t);return"stack"in t&&ze(r,"stack",{get:function(){return this.inner.stack}}),r},Yl(Be,uc);const Im=Object.freeze(Object.defineProperty({__proto__:null,Dexie:$e,RangeSet:ke,default:$e,liveQuery:vc,mergeRanges:Cr,rangesOverlap:bc},Symbol.toStringTag,{value:"Module"}));class im extends $e{vocabulary;action;constructor(){super("openai-translator"),this.version(4).stores({vocabulary:"word, reviewCount, description, updatedAt, createdAt",action:"++id, idx, mode, name, icon, rolePrompt, commandPrompt, outputRenderingFormat, updatedAt, createdAt"})}}let To;const sm=()=>(To||(To=new im),To);class um{get db(){return sm()}async create(e){if(!e.name)throw new Error("name is required");return this.db.transaction("rw",this.db.action,async()=>{const r=new Date().valueOf().toString(),n={idx:await this.db.action.count(),name:e.name,mode:e.mode,icon:e.icon,rolePrompt:e.rolePrompt,commandPrompt:e.commandPrompt,outputRenderingFormat:e.outputRenderingFormat,createdAt:r,updatedAt:r},a=await this.db.action.add(n);return n.id=a,n})}async update(e,r){return this.db.transaction("rw",this.db.action,async()=>{if(r.idx!==void 0){let o;e.idx<r.idx?(o=await this.db.action.where("idx").between(e.idx,r.idx).toArray(),o.forEach(i=>i.idx--)):(o=await this.db.action.where("idx").between(r.idx,e.idx).toArray(),o.forEach(i=>i.idx++)),await this.db.action.bulkPut(o)}const n=new Date().valueOf().toString(),a={...e,...r,updatedAt:n};return await this.db.action.update(e.id,a),a})}async bulkPut(e){await this.db.action.bulkPut(e)}async get(e){return await this.db.action.get(e)}async getByMode(e){return await this.db.action.where("mode").equals(e).first()}async delete(e){return this.db.transaction("rw",this.db.action,async()=>{const r=await this.db.action.get(e);if(!r||r.mode)return;const n=await this.db.action.where("idx").above(r.idx).toArray();return n.forEach(a=>a.idx--),await this.db.action.bulkPut(n),await this.db.action.delete(e)})}async list(){return this.db.transaction("rw",this.db.action,async()=>{let e=await this.db.action.count();const r=await this.db.action.orderBy("idx").desc().toArray();return cy.forEach(async n=>{const a=new Date().valueOf().toString();r.find(i=>i.mode===n.mode)||await this.db.action.add({idx:e++,name:n.name,mode:n.mode,icon:n.icon,createdAt:a,updatedAt:a})}),await this.db.action.orderBy("idx").toArray()})}async count(){return await this.db.action.count()}}const Fm=new um;export{Ji as A,Om as B,Cm as C,xm as D,Oo as E,Im as F,Zc as G,Fm as H,Wt as I,Q as J,km as K,Nc as L,dm as M,vl as N,Td as O,Tm as P,pm as Q,fm as R,fy as S,fs as T,wo as U,So as V,tu as W,ru as X,sm as Y,hm as Z,_c as a,Su as b,xe as c,di as d,mm as e,vm as f,wc as g,Oc as h,Qc as i,cm as j,hu as k,Ke as l,bm as m,gr as n,lm as o,za as p,bu as q,_m as r,wu as s,_a as t,Ed as u,vu as v,ym as w,gm as x,ly as y,wa as z};
