import{r as v,j as e,R as se,a as J,c as Y}from"./client-64cc3330.js";import{c as Z,a as Re,i as Se,g as Ye}from"./index-6400eb41.js";import{u as Ge}from"./usePopper-5581625c.js";import{C as je}from"./index-8e3fd625.js";import{F as ae}from"./foyerLogo-c0f0d78f.js";import{B as M}from"./button-5c866ab2.js";import{a as we,A as Ne,b as Ke}from"./index-5fbb8478.js";import{S as re,C as Fe}from"./Combination-734d114c.js";import{M as $e}from"./messageContext-b7a474d6.js";import{T as Ce}from"./themeContext-73b6440c.js";import{q as Ie,a as qe,b as Ve,s as Je}from"./backend-8962bc7f.js";import{u as ne}from"./useUserSettings-eb91a32a.js";import{g as Oe,e as Xe,E as Ze,c as et,b as Le,d as tt,f as oe}from"./index-1a12ff06.js";import{L as De}from"./hook-90290a85.js";import{S as H,I as st,T as Ae,a as Me,f as rt,l as at}from"./textarea-2abbddfa.js";import{c as nt,B as be,A as ot,a as it}from"./avatar-2c1c2e36.js";import{C as z,a as ee,b as We,c as lt,d as te}from"./card-f3fcd9ce.js";import{I as Ue}from"./input-9a173b93.js";import{u as ct,a as mt}from"./useSharedUserSettings-15caf5a1.js";import{f as P}from"./analytics-4a9d4e40.js";import{S as F,o as ut,s as he,e as V,u as dt,t as pt,F as ht,a as ge,b as xe,c as fe,d as _e,f as Pe,g as gt}from"./form-7781f1ca.js";import{u as xt}from"./useSSE-a5deda20.js";import{C as ft}from"./index-9f256355.js";import{F as yt}from"./index-876a044c.js";import{u as ie}from"./useTranslation-b0b08d2e.js";import{I as bt}from"./IconChevronUp-d94b2648.js";import{I as vt}from"./IconChevronDown-306a8eca.js";import{I as St}from"./IconCheck-c9ab9461.js";import{I as jt}from"./IconCopy-40883e9b.js";import{I as wt}from"./IconRefresh-36ad111f.js";import{a as Nt,I as ve}from"./IconSend-7465868f.js";import{I as Ct}from"./IconChevronRight-3a7ad62a.js";import{S as It,a as qt,b as At,c as Tt,d as Be}from"./select-31f6dec3.js";import{I as ye}from"./IconX-f6f2534f.js";import{c as Et}from"./createReactComponent-3abc0bad.js";import{A as ze}from"./index-82863451.js";import{m as X}from"./motion-064cf623.js";import{v as Q}from"./v4-4a60fe23.js";import{P as Te,u as Rt,a as Lt}from"./PersistQueryClientProvider-dcb1f9d7.js";import{c as ke}from"./utils-01642ffa.js";import{c as U}from"./index-75aa899c.js";/* empty css             */import"./index-6e1689d3.js";import"./index-3e5c8eb0.js";import"./useMedia-691d1918.js";import"./useAsyncWithPromise-a02bc426.js";import"./index-a295f481.js";import"./createLucideIcon-cc1e4b70.js";import"./index-0e452f41.js";var Mt=Et("square","IconSquare",[["path",{d:"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}]]);const O=nt(s=>({quickPromptAIReply:"",setQuickPromptAIReply:n=>s({quickPromptAIReply:n}),toggleUsingAIComposeBtn:()=>s(n=>({usingAIComposeBtn:!n.usingAIComposeBtn})),usingAIComposeBtn:!1}));function _t({chat:s,handleInsert:n,handleRegenerateLastMessage:i,handleSSE:m,idx:d,isLastMessage:a,isSSESuccessOrIdle:r,mountOn:p,msg:u,requestIdHeader:j}){const{t:w}=ie(),[t,g]=v.useState(!1),{...h}=v.useContext(we);function q(E){navigator.clipboard.writeText(E),g(!0),setTimeout(()=>g(!1),1200)}const[x,N]=v.useState(!1);if(u.role=="user")return e.jsxs("div",{style:{zIndex:10+d},className:`${d===s.activeThread.length-2?"sticky top-0":""} bg-background mr-3`,id:"user-msg-container",children:[e.jsxs("div",{className:"flex items-start justify-between space-x-2 pl-2",id:`${d===s.activeThread.length-2?"user-msg-body":""}`,children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(be,{className:"relative -left-1",variant:"secondary",children:w("super_gmail.prompt")}),e.jsx("span",{className:`text-foreground max-w-80 my-auto text-sm font-light transition-all duration-500 ease-in-out ${x?"":"line-clamp-1"}`,children:u.content})]}),u.content.length>52&&e.jsx("span",{onClick:()=>N(!x),className:"text-ds-icon-info w-24 cursor-pointer text-sm underline",children:x?e.jsx(bt,{size:18,color:"#9e9e9e",className:"ml-auto mr-4"}):e.jsx(vt,{size:18,color:"#9e9e9e",className:"ml-auto mr-4"})})]},u.id),e.jsx(H,{className:"my-2"})]});if(u.role==="assistant")return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex min-h-[262px] flex-grow flex-col justify-between px-2",children:[e.jsx(ft,{className:"!text-sm",content:u.content.trim()}),r&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 bg-white py-1 text-sm",children:[e.jsx(M,{className:"text-xs",onClick:()=>{P({eventName:"Insert",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/GMailMessage"}),n(s.activeThread[d].content)},children:w("super_gmail.insert")}),e.jsx("button",{type:"button",className:"bg-transparent p-1 only:rounded-md",onClick:()=>{q(u.content)},disabled:t,children:t?e.jsx(St,{className:"plain-icon-color h-4 w-4 stroke-[1.5]"}):e.jsx(jt,{className:"plain-icon-color h-4 w-4 stroke-[1.5]"})}),a&&e.jsx(wt,{className:"plain-icon-color h-4 w-4 cursor-pointer stroke-[1.5]",onClick:()=>{P({eventName:"Regenerate",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),i()}}),u.totSiblings>0&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{type:"button",className:" group/btn bg-transparent",onClick:()=>s.switchLeft(u),disabled:u.idx===0,children:e.jsx(Nt,{className:"plain-icon-color h-4 w-4 stroke-[1.5] group-disabled/btn:opacity-50"})}),e.jsxs("span",{className:"mx-0.5 flex items-end",children:[u.idx+1,e.jsx("span",{className:"relative -top-[1px]",children:"/"}),u.totSiblings]}),e.jsx("button",{type:"button",className:" group/btn bg-transparent",onClick:()=>s.switchRight(u),disabled:u.idx===u.totSiblings-1,children:e.jsx(Ct,{className:"plain-icon-color h-4 w-4 stroke-[1.5] group-disabled/btn:opacity-50"})})]}),a&&e.jsx("div",{className:"mr-auto",children:e.jsx(yt,{hideText:!0,queryTerms:JSON.stringify({feature:p,mountOn:p,query:s.activeThread[s.activeThread.length-2].content}),promptResult:s.activeThread[s.activeThread.length-1].content,callingSite:window.location.href,email:!h.email||h.email===""?"EMAIL_NOT_FOUND":h.email,requestId:j})})]})]}),e.jsx(H,{className:"my-2"})]});if(u.role==="system")return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex h-[262px] flex-col justify-between px-2",children:e.jsxs("div",{className:"",children:[e.jsx(F,{className:"mb-4 h-2 w-16"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(F,{className:"h-2 w-72"}),e.jsx(F,{className:"h-2 w-32"}),e.jsx(F,{className:"h-2 w-10"}),e.jsx(F,{className:"h-2 w-16"}),e.jsx(F,{className:"h-2 w-96"}),e.jsx(F,{className:"h-2 w-72"}),e.jsx(F,{className:"h-2 w-32"}),e.jsx(F,{className:"h-2 w-10"}),e.jsx(F,{className:"h-2 w-16"}),e.jsx(F,{className:"h-2 w-96"})]}),e.jsx(F,{className:"my-1 mt-4 h-2 w-16"}),e.jsx(F,{className:"h-2 w-20"})]})}),e.jsx(H,{className:"my-2"})]})}const Pt=ut({bio:he(),model:V(["GPT 3","GPT 4"]),name:he(),occupation:he(),outputLang:V(["english","hindi"]),outputLength:V(["short","medium","long"]),tone:V(["empathetic","optimistic","sincere","enthusiastic"]),writingStyle:V(["professional","casual","neutral"])});function Bt({setCurrentMode:s}){var p,u,j,w;const{t:n}=ie(),{...i}=v.useContext(we),[m,d]=De({instance:new Oe({area:"local"}),key:"gmailPersona"},t=>t===void 0?{bio:"",model:`${i.usageDetails.type=="PAID"?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"}:t),a=dt({defaultValues:{bio:"",model:`${i.usageDetails.type=="PAID"?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"},resolver:pt(Pt)});v.useEffect(()=>{a.reset(m)},[a,m]);function r(t){d(t),s("CHAT")}return e.jsx(z,{className:"relative mx-auto w-[502px] p-0 shadow-lg",children:e.jsxs(ee,{className:"flex p-0",children:[e.jsxs("div",{className:" -left-1 bottom-0 top-0 flex w-12 flex-col items-end justify-between gap-2 border-r p-1 py-2",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>{s("CHAT")},children:e.jsx(st,{})})}),e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>Z(Xe),children:e.jsx(ot,{className:"h-6 w-6",children:e.jsx(it,{children:((j=(u=(p=i.name)==null?void 0:p.split(" "))==null?void 0:u.map(t=>t[0]))==null?void 0:j.join(""))??((w=i==null?void 0:i.email[0])==null?void 0:w.toUpperCase())??"U"})})})]}),e.jsxs("div",{className:"mt-3 w-full",children:[e.jsxs(re,{className:"h-[320px]",children:[e.jsx(We,{className:"p-3",children:e.jsx(lt,{className:"text-lg",children:n("super_gmail.config")})}),e.jsx(ht,{...a,children:e.jsx("form",{onSubmit:a.handleSubmit(r),children:e.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[e.jsx("div",{className:"",children:e.jsx(ge,{control:a.control,name:"model",render:({field:t})=>e.jsxs(xe,{children:[e.jsx(fe,{children:n("super_gmail.ai_model")}),e.jsxs(It,{onValueChange:t.onChange,value:t.value,children:[e.jsx(qt,{className:"w-96",children:e.jsx(At,{})}),e.jsxs(Tt,{children:[e.jsx(Be,{value:"GPT 3",children:"GPT 3"}),e.jsx(Be,{value:"GPT 4",children:"GPT 4"})]})]})]})})}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h3",{className:"text-md font-semibold",children:n("super_gmail.persona")})}),e.jsx("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:e.jsx(ge,{control:a.control,name:"name",render:({field:t})=>e.jsxs(xe,{children:[e.jsx(fe,{children:n("super_gmail.name")}),e.jsx(_e,{children:e.jsx(Ue,{placeholder:"Ashutosh Kumar",...t})}),e.jsx(Pe,{})]})})}),e.jsx("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:e.jsx(ge,{control:a.control,name:"bio",render:({field:t})=>e.jsxs(xe,{children:[e.jsx(fe,{children:n("super_gmail.bio")}),e.jsx(_e,{children:e.jsx(Ae,{placeholder:n("super_gmail.bio_placeholder"),className:"resize-none",...t})}),e.jsx(Pe,{})]})})})]})})})]}),e.jsx(te,{className:"flex justify-end  gap-2 p-2 ",children:e.jsx(M,{onClick:a.handleSubmit(r),children:n("super_gmail.save")})})]})]})})}const kt=()=>{const{shadowRoot:s}=document.getElementById("merlin-gmail-uicomponentportal"),n=s.querySelector("[data-radix-scroll-area-viewport]");n&&setTimeout(()=>n.scrollTo({behavior:"smooth",left:0,top:n.scrollHeight}),100)};function Ee({handleInsert:s,id:n,mailThread:i=[],mountOn:m,setIsVisible:d}){var y;const{t:a}=ie(),{...r}=v.useContext(we),[p,u]=v.useState("CHAT"),[j,w]=v.useState(null),t=gt(),g=O(o=>o.quickPromptAIReply),h=O(o=>o.setQuickPromptAIReply),{sharedUserSettingsQuery:q}=ct(),[x,N]=v.useState(""),[E]=De({instance:new Oe({area:"local"}),key:"gmailPersona"},o=>o===void 0?{bio:"",model:`${r.usageDetails.type=="PAID"?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"}:o),[R,B]=v.useState(null),{handleGMailSSE:C}=xt(`${et.DOMAIN}/generative/gmail?&customJWT=true`,"handleGMailSSE",{method:"POST",onClose:()=>{t.editMessageNodeById(t.getLastMessage().id,o=>{var c;return o.status="SUCCESS",o.attachments=(c=o.attachments)==null?void 0:c.filter(I=>I.type==="IMAGE"&&I.url||I.type!=="IMAGE"),o}),t.setIsPromptingAvailable(!0)},onError:o=>{t.setIsPromptingAvailable(!0),console.error(o),t.deleteLastMessage(),(o==null?void 0:o.name)==="CUSTOM_ERROR"?o.type===Ze.RATE_LIMITED?t.setError(r.usageDetails.type==="PAID"?a("request_context.queries_exhausted"):a("request_context.queries_exhausted_for_today")):t.setError(o.message||a("request_context.something_wrong")):t.setError(a("request_context.something_wrong"))},onMessage:o=>{var A,T,_,L,G,k;const c=JSON.parse(o.data),I=c.data.content;((A=c==null?void 0:c.data)==null?void 0:A.eventType)==="SYSTEM"&&(c!=null&&c.data.hasOwnProperty("settings")&&(t.setChatId((_=(T=c==null?void 0:c.data)==null?void 0:T.settings)==null?void 0:_.chatId),t.editMessageNodeById(t.getLastMessage().parentId,S=>(S={...S,id:c.data.settings.userMessage.id},S)),t.editMessageNodeById(t.getLastMessage().id,S=>(S={...S,id:c.data.settings.assistantMessage.id,parentId:c.data.settings.userMessage.id},S))),c!=null&&c.data.hasOwnProperty("questions")&&t.setQuestions((L=c==null?void 0:c.data)==null?void 0:L.questions),(G=c==null?void 0:c.data)!=null&&G.metadata&&t.editMessageNodeById(t.getLastMessage().id,S=>(S={...S,metadata:{...S.metadata,...c.data.metadata}},S)),(k=c==null?void 0:c.data)!=null&&k.attachments&&t.editMessageNodeById(t.getLastMessage().id,S=>(S={...S,attachments:[...c.data.attachments]},S))),t.editMessageNodeById(t.getLastMessage().id,S=>(S.status==="LOADING"?(S.content=I,S.role="assistant",S.status="STREAMING"):S.status==="STREAMING"&&(S.content=`${S.content}${I}`),S))},onOpen:async o=>{o.ok&&o.headers.get("X-Request-Id")&&w(o.headers.get("X-Request-Id"))}}),l=(C==null?void 0:C.status)==="success"||(C==null?void 0:C.status)==="idle",f=async o=>{var A,T,_,L;t.setIsPromptingAvailable(!1),C.reset(),t.setError(null),t.setQuestions([]);const c=q.data.language;t.appendMessageThread([{content:o,id:Q(),parentId:((A=t.activeThread[t.activeThread.length-1])==null?void 0:A.id)??"root",role:"user",status:"SUCCESS"},{content:"",id:Q(),parentId:"",role:"system",status:"LOADING"}]);const I={context:{forwarding:!1,messages:i,signature:"",thread:t.activeThread,user:(L=(_=(T=document==null?void 0:document.querySelector("div.gb_b a"))==null?void 0:T.getAttribute("aria-label"))==null?void 0:_.replace("Google Account: ",""))==null?void 0:L.replace(`
`,"")},gmailPersona:E,language:c,modelId:E.model??`${r.usageDetails.type=="PAID"?"GPT 4":"GPT 3"}`,mountOn:m,query:o};t.setContext(""),C.execute(I),t.setContext(""),kt()},b=async()=>{t.setIsPromptingAvailable(!1);const o=q.data.language;t.setError(null),t.insertMessageNode(t.activeThread[t.activeThread.length-2].id,{content:"",id:Q(),parentId:t.activeThread[t.activeThread.length-2].id,role:"system",status:"LOADING"});const c={context:{forwarding:!1,messages:i,signature:"",thread:t.activeThread.splice(0,t.activeThread.length-2),user:document.querySelector("div.gb_b a").getAttribute("aria-label").replace("Google Account: ","").replace(`
`,"")},gmailPersona:E,language:o,modelId:(E==null?void 0:E.model)??`${r.usageDetails.type=="PAID"?"GPT 4":"GPT 3"}`,mountOn:m,query:t.activeThread[t.activeThread.length-2].content};C.execute(c)};return v.useEffect(()=>{g&&r.isAuthenticated&&(f(g),h(""))},[]),v.useEffect(()=>{var c,I,A,T,_,L,G,k;R&&R.disconnect();const o=new IntersectionObserver(function(S){var D,W,$;S[0].isIntersecting?(D=document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))==null||D.querySelector(`.${n}`).querySelector("#user-msg-body").classList.add("line-clamp-1"):($=(W=document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))==null?void 0:W.querySelector(`.${n}`))==null||$.querySelector("#user-msg-body").classList.remove("line-clamp-1")},{root:(c=document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))==null?void 0:c.querySelector(`.intersection-observer-root.${n}`),rootMargin:"0% 0% -95% 0%",threshold:[0,1]});(_=(T=(A=(I=document==null?void 0:document.getElementById("merlin-gmail-uicomponentportal"))==null?void 0:I.shadowRoot)==null?void 0:A.getElementById("reactAppRoot"))==null?void 0:T.querySelector(`.${n}`))!=null&&_.querySelector("#user-msg-body")&&(o.observe((k=(G=(L=document==null?void 0:document.getElementById("merlin-gmail-uicomponentportal"))==null?void 0:L.shadowRoot.getElementById("reactAppRoot"))==null?void 0:G.querySelector(`.${n}`))==null?void 0:k.querySelector("#user-msg-body")),B(o))},[t.activeThread.length]),r.isAuthenticated?p==="SETTINGS"?e.jsx(Bt,{setCurrentMode:u}):t.activeThread.length===0?e.jsxs(z,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[e.jsx("div",{className:"bg-secondary absolute -right-3 -top-3 cursor-pointer rounded-full p-1 shadow-lg ",onClick:()=>d(!1),children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx(ee,{className:"p-0",children:e.jsx(Ae,{placeholder:a("super_gmail.draft_nice"),onChange:o=>N(o.target.value),value:x,className:"h-48 resize-none border-transparent focus-visible:border-transparent focus-visible:ring-0",onKeyUp:o=>{o.key==="Enter"&&x.trim()&&!o.shiftKey&&(f(x.trim()),N(""))}})}),e.jsxs(te,{className:"mt-2 flex justify-between gap-2 p-0 ",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{variant:"secondary",className:"cursor-pointer py-2",onClick:()=>{P({eventName:"IntroduceMyselfQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),f("Write an email introducing myself.")},children:a("super_gmail.introduce")}),e.jsx(be,{variant:"secondary",className:"cursor-pointer py-2",onClick:()=>{P({eventName:"ColdEmailQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),f("Write a cold email")},children:a("super_gmail.cold_email")})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(M,{variant:"ghost",size:"icon",className:"rounded-none border-r px-1 hover:bg-transparent",onClick:()=>{x.trim()&&f(x.trim()),N("")},children:e.jsx(ve,{className:"text-primary cursor-pointer "})}),e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>u("SETTINGS"),children:e.jsx(Me,{className:"cursor-pointer"})})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs(z,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[e.jsx("div",{className:"bg-secondary absolute -right-3 -top-3 cursor-pointer rounded-full p-1 shadow-lg ",onClick:()=>d(!1),children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx(ee,{className:"p-0",children:e.jsx(re,{className:`intersection-observer-root h-[320px] ${n}`,children:e.jsxs("div",{className:"flex min-h-[320px] flex-col",children:[(y=t.activeThread)==null?void 0:y.map((o,c)=>e.jsx(_t,{msg:o,handleRegenerateLastMessage:b,chat:t,idx:c,handleInsert:s,handleSSE:C,isSSESuccessOrIdle:l,isLastMessage:t.activeThread.length-1===c&&o.role==="assistant",requestIdHeader:j,mountOn:m},o.id)),t.error&&!t.error.includes("Your queries have exhausted")&&e.jsxs("div",{className:"flex min-h-[280px] flex-grow flex-col justify-between px-2 text-red-500",children:[e.jsx("div",{className:"p-0 text-sm",children:t.error}),e.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:e.jsx(M,{onClick:()=>f(t.activeThread[t.activeThread.length-1].content),children:a("super_gmail.retry")})})]}),t.error&&t.error.includes("Your queries have exhausted")&&e.jsxs("div",{className:"flex min-h-[280px] flex-grow flex-col justify-between px-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex",children:[e.jsx("img",{className:"h-8 w-8",src:Re(rt),alt:"face-in-cloud"}),e.jsx("img",{className:"h-8 w-8",src:Re(at),alt:"lightning"})]}),e.jsx("div",{className:"p-0 text-sm",children:a("super_gmail.out_of_queries")})]}),e.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:e.jsx(M,{onClick:()=>Z(tt),children:a("super_gmail.go_pro")})})]})]})})}),e.jsxs(te,{className:"flex justify-between gap-2 p-0 pt-1 ",children:[e.jsxs("div",{className:"relative flex w-full items-center",children:[e.jsx(Ue,{onChange:o=>N(o.target.value),value:x,id:"promptInput",className:"pr-8",placeholder:a("super_gmail.follow_up_prompt"),autoComplete:"off",onKeyUp:o=>{o.key==="Enter"&&l&&x.trim()&&(f(x.trim()),N(""))}}),l?e.jsx(ve,{onClick:()=>{x.trim()&&l&&(f(x.trim()),N(""))},className:"text-primary bg-background absolute right-2 cursor-pointer"}):e.jsx(M,{size:"icon",variant:"ghost",className:"absolute right-2 h-5 w-5 text-xs",onClick:()=>{P({eventName:"StopGenerating",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),t.getLastMessage().content==""&&t.deleteLastMessage(),C.close()},children:e.jsx(Mt,{className:"plain-icon-color h-5 w-5 animate-pulse fill-red-600 stroke-[1.5]"})}),e.jsx(ze,{children:l&&(a("super_gmail.shorten").toLowerCase().includes(x.toLowerCase())||a("super_gmail.lengthen").toLowerCase().includes(x.toLowerCase())||a("super_gmail.improve").toLowerCase().includes(x.toLowerCase())||a("super_gmail.simplify").toLowerCase().includes(x.toLowerCase())||a("super_gmail.fix_spelling").toLowerCase().includes(x.toLowerCase()))&&e.jsx(X.div,{initial:{opacity:0,originY:0,scaleY:0},animate:{opacity:1,scaleY:1},exit:{opacity:0,originY:0,scaleY:0},className:"absolute top-10  w-4/5 ",children:e.jsx(z,{className:"rounded-md py-2",children:e.jsx(re,{className:"max-h-28 overflow-y-scroll",children:e.jsxs("div",{className:"flex w-full flex-col gap-1 text-sm",children:[a("super_gmail.shorten").toLowerCase().includes(x.toLowerCase())&&e.jsx("div",{onClick:()=>{P({eventName:"ShortenQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),f("Shorten it to 50 words")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:a("super_gmail.shorten")}),a("super_gmail.improv").toLowerCase().includes(x.toLowerCase())&&e.jsx("span",{onClick:()=>{P({eventName:"ImproveWritingQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),f("Improve writing")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:a("super_gmail.improve")}),a("super_gmail.simplify").toLowerCase().includes(x.toLowerCase())&&e.jsx("span",{onClick:()=>{P({eventName:"SimplifyQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),f("Simplify the language")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:a("super_gmail.simplify")}),a("super_gmail.lengthen").toLowerCase().includes(x.toLowerCase())&&e.jsx("span",{onClick:()=>{P({eventName:"LengthenQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),f("Make it longer and verbose")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:a("super_gmail.lengthen")}),a("super_gmail.fix_spelling").toLowerCase().includes(x.toLowerCase())&&e.jsx("span",{onClick:()=>{P({eventName:"FixSpellingGrammarQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),f("Fix spelling & grammar")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:a("super_gmail.fix_spelling")})]})})})})})]}),e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>{P({eventName:"SettingsBtn",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),u("SETTINGS")},children:e.jsx(Me,{className:"cursor-pointer"})})]})]})}):e.jsxs(z,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[e.jsx("div",{className:"bg-secondary absolute -right-3 -top-3 cursor-pointer rounded-full p-1 shadow-lg ",onClick:()=>d(!1),children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx(We,{className:"mb-2 p-0",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-5 w-5",children:e.jsx(ae,{})}),e.jsx("span",{className:"text-lg",children:a("merlin")})]})}),e.jsx(H,{}),e.jsx(ee,{className:"px-2 py-3 text-sm",children:a("super_gmail.login")}),e.jsx(te,{className:"flex justify-between gap-2 px-2 py-0 ",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{onClick:()=>Z(Le),children:a("super_gmail.login2")}),e.jsx(M,{variant:"ghost",onClick:()=>Z(Le),children:a("super_gmail.signup")})]})})]})}const Gt=({attributes:s,handleInsert:n,id:i,setIsVisible:m,setPopperElement:d,styles:a,update:r})=>{const[p,u]=v.useState(!0),[j,w]=v.useState(!0);return v.useEffect(()=>{const t=new MutationObserver(Se(()=>{if(r&&r(),!document.querySelector(`.${i}`)){u(!1),t.disconnect();return}},100));return t.observe(document.body,{childList:!0,subtree:!0}),()=>t.disconnect()},[i,r]),v.useEffect(()=>{const t=new MutationObserver(()=>{try{document.querySelector(`.${i}`).closest(".nH").style.display==="none"?w(!1):w(!0)}catch{}});return t.observe(document.querySelector(`.${i}`).closest(".nH"),{attributeFilter:["style"],attributes:!0}),()=>t.disconnect()},[i]),p?e.jsx("div",{ref:d,style:a.popper,...s.popper,className:`mb-48 ${j?"":"hidden"}`,children:e.jsx(X.div,{initial:{opacity:0,scale:0,y:150},animate:{opacity:1,scale:1,y:0},children:e.jsx(Ee,{handleInsert:n,setIsVisible:m,mountOn:"GMAIL_COMPOSE",id:i})})}):null};function Ft({id:s}){const[n,i]=se.useState(null),[m,d]=se.useState(null),{attributes:a,forceUpdate:r,styles:p}=Ge(n,m,{placement:"top"}),[u,j]=v.useState(!1),w=O(q=>q.usingAIComposeBtn),t=O(q=>q.toggleUsingAIComposeBtn),[g]=ne(),h=q=>{try{const x=/^Subject: .*(\r?\n|\r)/,R=q.trim().replace(x,"").split(`
`).map(C=>C===""?"<div></div><br/>":`<div>${C}</div>`);document.querySelector(`.fab-writer.${s}`).closest(".nH.Hd").querySelector("[contenteditable=true]").innerHTML=R.join(`
`)+`
`+document.querySelector(`.fab-writer.${s}`).closest(".nH.Hd").querySelector("[contenteditable=true]").innerHTML;const B=q.trim().match(x);B&&(document.querySelector(`.fab-writer.${s}`).closest(".nH.Hd").querySelector("[name='subjectbox']").value=B[0]),j(!1)}catch{}};if(v.useEffect(()=>{w&&(j(!0),t())},[]),g.merlinOnGmail.visible)return e.jsx(je,{children:e.jsx(Te,{client:Ie,persistOptions:{dehydrateOptions:{shouldDehydrateQuery:q=>{const{queryKey:x}=q;return!(x.includes("paginatedPublicChatbots")||x.includes("searchedChatbots"))}},persister:qe},children:e.jsx(Fe,{children:e.jsx(Ne,{children:e.jsx($e,{children:e.jsx(Ce,{websiteOverride:!0,children:e.jsxs("div",{className:"flex w-full justify-center",children:[e.jsx("div",{ref:i,className:`${s}`}),u&&J.createPortal(e.jsx(Gt,{setPopperElement:d,styles:p,attributes:a,setIsVisible:j,id:s,handleInsert:h,update:r}),document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot")),J.createPortal(e.jsxs(M,{type:"button",onClick:()=>j(q=>!q),className:"px-2",children:[e.jsx("div",{className:"mr-1 h-5 w-5",children:e.jsx(ae,{})}),e.jsx("span",{children:"AI"})]}),document.querySelector(`.merlin.fab-btn.${s}`).shadowRoot.getElementById("reactAppRootBtn"))]})})})})})})})}const $t=({attributes:s,handleInsert:n,id:i,mailThread:m,setIsVisible:d,setPopperElement:a,styles:r,update:p})=>{const[u,j]=v.useState(!0),[w,t]=v.useState(!0);return v.useEffect(()=>{const g=new MutationObserver(Se(()=>{if(p&&p(),!document.querySelector(`.${i}`)){j(!1),g.disconnect();return}},100));return g.observe(document.body,{childList:!0,subtree:!0}),()=>g.disconnect()},[i,p]),v.useEffect(()=>{const g=new MutationObserver(()=>{try{document.querySelector(`.${i}`).closest(".nH").style.display==="none"?t(!1):t(!0)}catch{}});return g.observe(document.querySelector(`.${i}`).closest(".nH"),{attributeFilter:["style"],attributes:!0}),()=>g.disconnect()},[i]),u?e.jsx("div",{ref:a,style:r.popper,...s.popper,className:`mb-48 ${w?"":"hidden"}`,children:e.jsx(X.div,{initial:{opacity:0,scale:0,y:150},animate:{opacity:1,scale:1,y:0},children:e.jsx(Ee,{handleInsert:n,setIsVisible:d,mountOn:"GMAIL_REPLY",id:i,mailThread:m})})}):null};function Ot({id:s}){const[n,i]=se.useState(null),[m,d]=se.useState(null),{attributes:a,forceUpdate:r,styles:p}=Ge(n,m,{placement:"top"}),[u]=ne(),[j,w]=v.useState([]),[t,g]=v.useState(!1),h=O(N=>N.usingAIComposeBtn),q=O(N=>N.toggleUsingAIComposeBtn);v.useEffect(()=>{const N=(R,B)=>{var C,l,f,b,y,o,c,I,A,T,_,L,G;if(R!=null&&R.querySelector("blockquote.gmail_quote")){const k=R.querySelector("blockquote.gmail_quote"),S=((l=(C=k.parentNode)==null?void 0:C.querySelector(".gmail_attr"))==null?void 0:l.textContent)??((f=k.parentNode)==null?void 0:f.textContent)??"",D=new RegExp("(?<=<)(.*?)(?=>)"),W=/(\d{1,2} \w{3} \d{4} at \d{2}:\d{2})/,$=new RegExp("(?<=\\s)([\\w\\s]+)(?=\\s<)"),le=new RegExp("(?<=<)(.*?)(?=>)"),ce=/\w{3}, \w{3} \d{1,2}, \d{4} at \d{1,2}:\d{2}\s(?:AM|PM)/,me=((y=(b=S.match($))==null?void 0:b[0])==null?void 0:y.replace(/\b(?:AM|PM)\b/g,""))??"",ue=((o=S.match(D))==null?void 0:o[0])??((c=S.match(le))==null?void 0:c[0]),de=((I=S.match(W))==null?void 0:I[0])??((A=S.match(ce))==null?void 0:A[0]),K=(G=(_=k.textContent)==null?void 0:_.replace((T=k.querySelector("blockquote.gmail_quote"))==null?void 0:T.textContent,""))==null?void 0:G.replace((L=k.querySelector(".gmail_attr"))==null?void 0:L.textContent,"");B.push({content:K==null?void 0:K.replace(/\s\s+/gm," "),email:ue,name:me,timestamp:de}),N(R.querySelector("blockquote.gmail_quote"),B)}};(async()=>{var B,C,l,f,b,y;const R=[];(f=(l=(C=(B=document.querySelector(`.merlin.fab-btn.${s}`))==null?void 0:B.closest(".ip.adB"))==null?void 0:C.querySelector("img.ajT"))==null?void 0:l.parentElement)==null||f.click(),N((y=(b=document.querySelector(`.merlin.fab-btn.${s}`))==null?void 0:b.closest(".ip.adB"))==null?void 0:y.querySelector(".gmail_quote"),R),w(R.reverse())})()},[s]);const x=N=>{try{const E=/^Subject: .*(\r?\n|\r)/;N=N.trim().replace(E,"");const B=N.split(`
`).map(C=>C===""?"<div></div><br/>":`<div>${C}</div>`);document.querySelector(`.fab-writer.${s}`).closest(".ip.adB").querySelector("[contenteditable=true]").innerHTML=B.join(`
`)+`
`+document.querySelector(`.fab-writer.${s}`).closest(".ip.adB").querySelector("[contenteditable=true]").innerHTML,g(!1)}catch{}};if(v.useEffect(()=>{h&&(g(!0),q())},[]),u.merlinOnGmail.visible)return e.jsx(je,{children:e.jsx(Te,{client:Ie,persistOptions:{dehydrateOptions:{shouldDehydrateQuery:N=>{const{queryKey:E}=N;return!(E.includes("paginatedPublicChatbots")||E.includes("searchedChatbots"))}},persister:qe},children:e.jsx(Fe,{children:e.jsx(Ne,{children:e.jsx($e,{children:e.jsx(Ce,{websiteOverride:!0,children:e.jsxs("div",{className:"flex w-full justify-center",children:[t&&J.createPortal(e.jsx($t,{setPopperElement:d,styles:p,attributes:a,setIsVisible:g,id:s,handleInsert:x,update:r,mailThread:j}),document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot")),J.createPortal(e.jsxs(M,{type:"button",onClick:()=>g(N=>!N),className:`z-50 px-2 ${s}`,ref:i,children:[e.jsx("div",{className:"mr-1 h-5 w-5",children:e.jsx(ae,{})}),e.jsx("span",{children:"AI"})]}),document.querySelector(`.merlin.fab-btn.${s}`).shadowRoot.getElementById("reactAppRootBtn"))]})})})})})})})}const Dt=()=>{const{...s}=v.useContext(Ke);return{getUserPrompts:mt({queryFn:async()=>s.isLoading||!s.isAuthenticated?null:await Ve(),queryKey:["userPrompts"]})}},Wt=()=>{const s=Rt();return Lt({mutationFn:async i=>await Je(i),onSuccess:i=>{s.setQueryData(["userPrompts"],i)}})},Ut=[{promptName:"Friendly",promptTag:"GmailReply",promptText:"Write a friendly reply in an informal tone"},{promptName:"Funny",promptTag:"GmailReply",promptText:"Write a funny reply"},{promptName:"Professional",promptTag:"GmailReply",promptText:"Write a professional reply"}],zt=({handleInsert:s,id:n,mailThread:i,setIsVisible:m})=>e.jsx("div",{className:"absolute translate-x-[60vw] translate-y-1/4 ",children:e.jsx(X.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},children:e.jsx(Ee,{setIsVisible:m,mailThread:i,handleInsert:s,mountOn:"GMAIL_REPLY",id:n})})}),Ht=({id:s})=>{var E,R,B,C;const{t:n}=ie(),[i,m]=v.useState(!1),[d,a]=v.useState([]),[r,p]=v.useState(""),u=O(l=>l.setQuickPromptAIReply),j=v.useRef(null),{getUserPrompts:w}=Dt();Wt();const t=v.useMemo(()=>{var l,f,b;return(b=(f=(l=w==null?void 0:w.data)==null?void 0:l.userPrompts)==null?void 0:f.userMade)==null?void 0:b.filter(y=>{var o,c,I,A,T;return((o=y==null?void 0:y.promptTag)==null?void 0:o.includes("GmailReply"))&&(((I=(c=y==null?void 0:y.promptName)==null?void 0:c.toLocaleLowerCase())==null?void 0:I.includes(r==null?void 0:r.toLocaleLowerCase()))||((T=(A=y==null?void 0:y.promptText)==null?void 0:A.toLocaleLowerCase())==null?void 0:T.includes(r==null?void 0:r.toLocaleLowerCase())))})},[r,(R=(E=w==null?void 0:w.data)==null?void 0:E.userPrompts)==null?void 0:R.userMade]),g=v.useMemo(()=>{var l,f,b;return(b=(f=(l=w==null?void 0:w.data)==null?void 0:l.userPrompts)==null?void 0:f.userMade)==null?void 0:b.filter(y=>{var o,c,I,A,T;return!((o=y==null?void 0:y.promptTag)!=null&&o.includes("GmailReply"))&&(((I=(c=y==null?void 0:y.promptName)==null?void 0:c.toLocaleLowerCase())==null?void 0:I.includes(r==null?void 0:r.toLocaleLowerCase()))||((T=(A=y==null?void 0:y.promptText)==null?void 0:A.toLocaleLowerCase())==null?void 0:T.includes(r==null?void 0:r.toLocaleLowerCase())))})},[r,(C=(B=w==null?void 0:w.data)==null?void 0:B.userPrompts)==null?void 0:C.userMade]),h=Ut.filter(l=>{var f,b,y,o,c;return((f=l==null?void 0:l.promptTag)==null?void 0:f.includes("GmailReply"))&&(((y=(b=l==null?void 0:l.promptName)==null?void 0:b.toLocaleLowerCase())==null?void 0:y.includes(r==null?void 0:r.toLocaleLowerCase()))||((c=(o=l==null?void 0:l.promptText)==null?void 0:o.toLocaleLowerCase())==null?void 0:c.includes(r==null?void 0:r.toLocaleLowerCase())))}),q=(l,f)=>{var b,y,o,c,I,A,T,_,L,G,k,S,D,W;if(l!=null&&l.querySelector("blockquote.gmail_quote")){const $=((y=(b=l.querySelector("blockquote.gmail_quote").parentNode)==null?void 0:b.querySelector(".gmail_attr"))==null?void 0:y.textContent)??((o=l.querySelector("blockquote.gmail_quote").parentNode)==null?void 0:o.textContent)??"",le=new RegExp("(?<=<)(.*?)(?=>)"),ce=/(\d{1,2} \w{3} \d{4} at \d{2}:\d{2})/,me=new RegExp("(?<=\\s)([\\w\\s]+)(?=\\s<)"),ue=new RegExp("(?<=<)(.*?)(?=>)"),de=/\w{3}, \w{3} \d{1,2}, \d{4} at \d{1,2}:\d{2}\s(?:AM|PM)/,K=((I=(c=$.match(me))==null?void 0:c[0])==null?void 0:I.replace(/\b(?:AM|PM)\b/g,""))??"",He=((A=$.match(le))==null?void 0:A[0])??((T=$.match(ue))==null?void 0:T[0]),Qe=((_=$.match(ce))==null?void 0:_[0])??((L=$.match(de))==null?void 0:L[0]),pe=(W=(S=(G=l.querySelector("blockquote.gmail_quote"))==null?void 0:G.textContent)==null?void 0:S.replace((k=l.querySelector("blockquote.gmail_quote").querySelector("blockquote.gmail_quote"))==null?void 0:k.textContent,""))==null?void 0:W.replace((D=l.querySelector("blockquote.gmail_quote").querySelector(".gmail_attr"))==null?void 0:D.textContent,"");f.push({content:pe==null?void 0:pe.replace(/\s\s+/gm," "),email:He,name:K,timestamp:Qe}),q(l.querySelector("blockquote.gmail_quote"),f)}},x=async({prompt:l})=>{var y,o,c,I,A,T,_;const f=[],b=(y=document==null?void 0:document.querySelector(`.merlin-external.${s}`))==null?void 0:y.closest('[role="listitem"]');f.push({content:(A=(I=(o=b==null?void 0:b.querySelector(".a3s.aiL"))==null?void 0:o.textContent)==null?void 0:I.replace((c=b.querySelector("blockquote.gmail_quote"))==null?void 0:c.textContent,""))==null?void 0:A.replace(/\s\s+/gm," "),email:b==null?void 0:b.querySelector("[name][email]").getAttribute("email"),name:b==null?void 0:b.querySelector("[name][email]").getAttribute("name"),timestamp:(T=b==null?void 0:b.querySelector("[alt][title]"))==null?void 0:T.getAttribute("title")}),q((_=b==null?void 0:b.querySelector(".a3s.aiL"))==null?void 0:_.querySelector(".gmail_quote"),f),a(f.reverse()),u(l),await new Promise(L=>{m(G=>!G),setTimeout(()=>L(!0),50)}),await new Promise(L=>{m(!0),setTimeout(()=>L(!0),50)})},N=l=>{try{const f=/^Subject: .*(\r?\n|\r)/;l=l.trim().replace(f,"");const y=l.split(`
`).map(o=>o===""?"<div></div><br/>":`<div>${o}</div>`);try{document.querySelector(`.merlin-external.${s}`).closest(".gA.gt").querySelector(".ams.bkI").click()}catch{try{document.querySelector(`.merlin-external.${s}`).closest(".gA.gt").querySelector(".ams.bkH").click()}catch{}}setTimeout(()=>document.querySelector(`.merlin-external.${s}`).closest(".gA.gt").querySelector("[contenteditable=true]").innerHTML=y.join(`
`)+`

`+document.querySelector(`.merlin-external.${s}`).closest(".gA.gt").querySelector("[contenteditable=true]").innerHTML,50),m(!1)}catch{}};return v.useEffect(()=>{j.current&&(j.current.style.height="auto",j.current.style.height=j.current.scrollHeight+"px")},[r]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-2.5 ml-24 flex items-end gap-3 py-1",id:"ai-reply",children:[e.jsx("div",{className:"absolute -left-10 top-1.5 h-7 w-7",children:e.jsx(ae,{})}),e.jsx(Ae,{onChange:l=>p(String(l.target.value)),rows:1,value:r,ref:j,placeholder:"Write your reply to generate with AI",className:ke("peer min-h-1 w-80 transition-all duration-200 ease-in-out focus:w-[26.68rem]",r.length&&"w-[26.68rem]")}),e.jsxs(M,{onClick:()=>{P({eventName:"GenerateAIReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),x({prompt:r}),p("")},variant:"default",className:ke("items-center justify-center peer-focus:flex",!r.length&&"hidden"),children:[n("Generate"),e.jsx(ve,{className:"ml-2 h-5 w-5"})]}),!r.length&&e.jsxs(e.Fragment,{children:[e.jsx(M,{onClick:()=>{P({eventName:"YesQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),x({prompt:"Respond to these matters affirmatively, expressing your interest."})},variant:"outline",className:"peer-focus:hidden",children:n("yes")}),e.jsx(M,{onClick:()=>{P({eventName:"NoQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),x({prompt:"Respond to these matters saying no, expressing your rejection or dis-interest."})},variant:"outline",className:"peer-focus:hidden",children:n("no")}),e.jsx(M,{onClick:()=>{P({eventName:"FollowUpQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),x({prompt:"Follow up."})},variant:"outline",className:"peer-focus:hidden",children:n("super_gmail.follow_up")})]}),e.jsx(ze,{children:(r==null?void 0:r.length)&&((h==null?void 0:h.length)||t&&(t==null?void 0:t.length)||g&&(g==null?void 0:g.length))&&e.jsx(X.div,{initial:{opacity:0,originY:0,scaleY:0},animate:{opacity:1,scaleY:1},exit:{opacity:0,originY:0,scaleY:0},className:"left-26 absolute top-12 z-10 ml-0 w-[26.68rem]",children:e.jsx(z,{className:"rounded-md py-2",children:e.jsx(re,{className:"max-h-28 overflow-scroll",children:e.jsxs("div",{className:"flex w-full flex-col gap-1 text-sm",children:[e.jsxs(e.Fragment,{children:[t&&(t==null?void 0:t.length)!==0&&e.jsx("p",{className:"text-muted-foreground ml-2 text-xs",children:"Gmail Prompts"}),t&&(t==null?void 0:t.map(l=>e.jsx("div",{onClick:()=>{x({prompt:l.promptText}),p("")},className:"hover:bg-secondary cursor-pointer px-3 py-1",children:n(l.promptName)},l.id)))]}),t&&(t==null?void 0:t.length)!==0&&(h==null?void 0:h.length)!==0&&e.jsx(H,{}),e.jsxs(e.Fragment,{children:[(h==null?void 0:h.length)!==0&&e.jsx("p",{className:"text-muted-foreground ml-2 mt-1 text-xs",children:"Recommended Prompts"}),h==null?void 0:h.map((l,f)=>e.jsx("div",{onClick:()=>{P({eventName:`${l.promptName}QuickReply`,eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),x({prompt:l.promptText}),p("")},className:"hover:bg-secondary cursor-pointer px-3 py-1",children:n(`${l.promptName} Reply`)},f))]}),(h==null?void 0:h.length)!==0&&g&&(g==null?void 0:g.length)!==0&&e.jsx(H,{}),e.jsxs(e.Fragment,{children:[g&&(g==null?void 0:g.length)!==0&&e.jsx("p",{className:"text-muted-foreground ml-2 mt-1 text-xs",children:"Other Prompts"}),g&&(g==null?void 0:g.map(l=>e.jsx("div",{onClick:()=>{x({prompt:l.promptText}),p("")},className:"hover:bg-secondary cursor-pointer px-3 py-1",children:n(l.promptName)},l.id)))]})]})})})})})]}),i&&J.createPortal(e.jsx(zt,{setIsVisible:m,mailThread:d,handleInsert:N,id:s}),document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))]})};function Qt({id:s}){const[n]=ne();return n.merlinOnGmail.visible?e.jsx(je,{children:e.jsx(Ne,{children:e.jsx(Te,{client:Ie,persistOptions:{persister:qe},children:e.jsx(Ce,{websiteOverride:!0,children:e.jsx(Ht,{id:s})})})})}):null}function Yt(){const s=O(d=>d.toggleUsingAIComposeBtn),[n]=ne(),[i,m]=v.useState(!0);return v.useEffect(()=>{var r;const d=(r=document.querySelector(".T-I-KE"))==null?void 0:r.closest("[role='navigation']"),a=document.querySelector("[aria-label='Main menu']");if(d){m(!1);const p=new MutationObserver(()=>{d.classList.contains("bym")||a.getAttribute("aria-expanded")==="true"?m(!0):m(!1)});p.observe(d,{attributeFilter:["class"],attributes:!0}),p.observe(a,{attributeFilter:["class"],attributes:!0}),a.getAttribute("aria-expanded")==="true"&&!d.classList.contains("bhz")&&m(!0)}},[]),v.useEffect(()=>{document.querySelector(".T-I-KE").style.zIndex="1",document.querySelector(".T-I-KE").parentNode.style.position="relative"},[]),n.merlinOnGmail.visible&&n.Aibtn.visible?e.jsx("button",{type:"button",onClick:()=>{P({eventName:"GlobalAiComposeBtn",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/AIComposeBtn"}),s(),document.querySelector(".T-I-KE").click()},className:`animate-border absolute bottom-0 left-32 top-0 items-stretch rounded-r-2xl bg-gradient-to-t from-fuchsia-200 via-purple-300 to-indigo-100 p-0.5 shadow-lg active:shadow-sm ${i?"":"hidden"}`,children:e.jsx("div",{className:"text-primary bg-background flex h-full items-center rounded-r-2xl px-5 pl-7 transition-all hover:pl-8",children:"✨AI"})}):null}const Kt=()=>new Promise(s=>{if(window.location.origin.includes("mail.google.com")){const n=new MutationObserver(()=>{const i=document.getElementById("loading");i.style.display==="none"&&(s(i),n.disconnect())});n.observe(document.body,{childList:!0,subtree:!1})}}),Vt=async s=>{const n=`u${Q()}`,i=document.createElement("merlin-component"),m=document.createElement("merlin-button-component");i.className=`merlin fab-writer ${n}`,m.className=`merlin fab-btn ${n}`;const d=i.attachShadow({mode:"open"}),a=m.attachShadow({mode:"open"}),r=document.createElement("style"),p=document.createElement("style");r.textContent=`${U}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: absolute;
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `,p.textContent=`${U}
      .fab-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const u=document.createElement("div");u.id="reactAppRoot",u.className="reactAppRoot fabStrip";const j=document.createElement("div");j.id="reactAppRootBtn",j.className="reactAppRootBtn fabBtn center-with-flex",d.appendChild(r),d.appendChild(u),s.querySelector("#sbddm").insertAdjacentElement("afterend",i),a.appendChild(p),a.appendChild(j);try{const h=s.querySelector(".gU.aYL");h.style.cssText="display: flex; gap: 0.5em; justify-content: center; align-items: center;",h.append(m)}catch{}const w={fowarding:!1,messages:[],signature:"",user:""};let t=null;try{t=document.querySelector("div.gb_b a").getAttribute("aria-label").replace("Google Account: ","").replace(`
`,""),w.user=t}catch{}oe.forEach(h=>{u.addEventListener(h,q=>{q.stopPropagation()})});const g=Y(u);Y(j),g.render(e.jsx(Ft,{id:n}))},Jt=async s=>{const n=`u${Q()}`,i=document.createElement("merlin-component"),m=document.createElement("merlin-button-component");i.className=`merlin fab-writer ${n}`,m.className=`merlin fab-btn ${n}`;const d=i.attachShadow({mode:"open"}),a=m.attachShadow({mode:"open"}),r=document.createElement("style"),p=document.createElement("style");r.textContent=`${U}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: absolute;
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `,p.textContent=`${U}
      .fab-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const u=document.createElement("div");u.id="reactAppRoot",u.className="reactAppRoot fabStrip";const j=document.createElement("div");j.id="reactAppRootBtn",j.className="reactAppRootBtn fabBtn center-with-flex",d.appendChild(r),d.appendChild(u),s.querySelector("#sbddm").insertAdjacentElement("afterend",i),a.appendChild(p),a.appendChild(j);try{const h=s.querySelector(".gU.aYL");h.style.cssText="display: flex; gap: 0.5em; justify-content: center; align-items: center;",h.append(m)}catch{}const w={fowarding:!1,messages:[],signature:"",user:""};let t=null;try{t=document.querySelector("div.gb_b a").getAttribute("aria-label").replace("Google Account: ","").replace(`
`,""),w.user=t}catch{}oe.forEach(h=>{u.addEventListener(h,q=>{q.stopPropagation()})});const g=Y(u);Y(j),g.render(e.jsx(Ot,{id:n}))},Xt=async s=>{const n=`u${Q()}`,i=document.createElement("merlin-component");i.className=`merlin fab-writer merlin-external ${n}`;const m=i.attachShadow({mode:"open"}),d=document.createElement("style");d.textContent=`${U}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `;const a=document.createElement("div");a.id="reactAppRoot",a.className="reactAppRoot fabStrip",oe.forEach(p=>{a.addEventListener(p,u=>{u.stopPropagation()})}),m.appendChild(d),m.appendChild(a),s.prepend(i),Y(a).render(e.jsx(Qt,{id:n}))},Zt=async()=>{var d;const s=document.createElement("merlin-component");s.className="merlin ai-compose-btn";const n=s.attachShadow({mode:"open"}),i=document.createElement("style");i.textContent=`${U}
      .ai-compose-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const m=document.createElement("div");m.id="reactAppRootBtn",m.className="reactAppRootBtn",n.appendChild(i),n.appendChild(m),(d=document.querySelector(".T-I-KE"))!=null&&d.parentNode?document.querySelector(".T-I-KE").parentNode.append(s):document.querySelector(".z0")&&document.querySelector(".z0").append(s),Y(m).render(e.jsx(Yt,{}))},es=async()=>{if(document.getElementById("merlin-gmail-uicomponentportal"))return;const s=document.createElement("merlin-component");s.id="merlin-gmail-uicomponentportal",s.className="merlin merlin-gmail-uicomponentportal";const n=s.attachShadow({mode:"open"}),i=document.createElement("style");i.textContent=`${U}
    :host(#merlin-gmail-uicomponentportal) {
    }   
    .reactAppRoot {
      all: initial; /* 1st rule so subsequent properties are reset. */
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 2147483640;
    }
    `.replaceAll(":root",":host");const m=document.createElement("div");m.id="reactAppRoot",m.className="reactAppRoot",oe.forEach(d=>{m.addEventListener(d,a=>{a.stopPropagation()})}),n.appendChild(i),n.appendChild(m),document.documentElement.append(s)},ts=async()=>{es();const s=await Ye();if(s&&!s.fabStrip.gmail.visible)return;await Kt();const n=new MutationObserver(Se(()=>{const m=document.querySelectorAll(".nH.Hd");if(m.length>0)for(let r=0;r<m.length;r+=1){const p=m[r].querySelector("merlin-component"),u=m[r].querySelector("merlin-button-component");!p&&!u&&Vt(m[r])}const d=document.querySelectorAll(".ip.adB");if(d.length>0)for(let r=0;r<d.length;r+=1){const p=d[r].querySelector("merlin-component"),u=d[r].querySelector("merlin-button-component");!p&&!u&&Jt(d[r])}const a=document.querySelectorAll(".gA.gt");if(a.length>0){const r=a[a.length-1];let p=document.querySelector(".merlin.fab-writer.merlin-external");!r.querySelector(".merlin.fab-writer.merlin-external")&&p&&(p.remove(),p=null),p||Xt(r)}},300)),i={attributes:!0,childList:!0,subtree:!1};n.observe(document.body,i),Zt()};ts();
