import{p as qe}from"./purify.es-8e338605.js";import{w as ve}from"./backend-8962bc7f.js";import{g as xe}from"./index-6400eb41.js";import{e as se}from"./utils-f7fcf05a.js";import{A as ne}from"./index-1a12ff06.js";class P extends Error{constructor(t,r){super(t+" at position "+r),this.position=r}}const H=92,ee=47,Le=42,ae=123,W=125,ie=91,z=93,De=40,Oe=41,Ue=32,ce=10,ye=9,be=13,Te=8,_e=12,Y=34,le=43,ue=45,Se=39,Ce=48,Ae=57,V=44,Fe=46,Me=58,Ne=59,Ie=65,Pe=97,Re=69,$e=101,Ge=70,Qe=102,Be=160,He=8192,We=8202,ze=8239,Ve=8287,Je=12288,Ke=8220,Ze=8221,Xe=8216,Ye=8217,je=96,et=180;function tt(e){return e>=Ce&&e<=Ae||e>=Ie&&e<=Ge||e>=Pe&&e<=Qe}function J(e){return e>=Ce&&e<=Ae}function rt(e){return e>=32&&e<=1114111}function K(e){return nt.test(e)}const nt=/^[,:[\]/{}()\n+]$/;function he(e){return ct.test(e)||e&&Z(e.charCodeAt(0))}const ct=/^[[{\w-]$/;function ot(e){return e===ce||e===be||e===ye||e===Te||e===_e}function B(e){return e===Ue||e===ce||e===ye||e===be}function st(e){return e===Be||e>=He&&e<=We||e===ze||e===Ve||e===Je}function Z(e){return Ee(e)||re(e)}function Ee(e){return e===Y||e===Ke||e===Ze}function fe(e){return e===Y}function re(e){return e===Se||e===Xe||e===Ye||e===je||e===et}function de(e){return e===Se}function Q(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const o=e.lastIndexOf(t);return o!==-1?e.substring(0,o)+(r?"":e.substring(o+1)):e}function _(e,t){let r=e.length;if(!B(e.charCodeAt(r-1)))return e+t;for(;B(e.charCodeAt(r-1));)r--;return e.substring(0,r)+t+e.substring(r)}function at(e,t,r){return e.substring(0,t)+e.substring(t+r)}function it(e){return/[,\n][ \t\r]*$/.test(e)}const lt={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},ut={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function ht(e){let t=0,r="";m()||v();const c=a(V);for(c&&n(),he(e[t])&&it(r)?(c||(r=_(r,",")),g()):c&&(r=Q(r,","));e.charCodeAt(t)===W||e.charCodeAt(t)===z;)t++,n();if(t>=e.length)return r;A();function m(){n();const l=b()||C()||u()||f()||S()||E();return n(),l}function n(){const l=t;let w=i();do w=s(),w&&(w=i());while(w);return t>l}function i(){let l="",w;for(;(w=B(e.charCodeAt(t)))||st(e.charCodeAt(t));)w?l+=e[t]:l+=" ",t++;return l.length>0?(r+=l,!0):!1}function s(){if(e.charCodeAt(t)===ee&&e.charCodeAt(t+1)===Le){for(;t<e.length&&!ft(e,t);)t++;return t+=2,!0}if(e.charCodeAt(t)===ee&&e.charCodeAt(t+1)===ee){for(;t<e.length&&e.charCodeAt(t)!==ce;)t++;return!0}return!1}function a(l){return e.charCodeAt(t)===l?(r+=e[t],t++,!0):!1}function d(l){return e.charCodeAt(t)===l?(t++,!0):!1}function p(){return d(H)}function b(){if(e.charCodeAt(t)===ae){r+="{",t++,n();let l=!0;for(;t<e.length&&e.charCodeAt(t)!==W;){let w;if(l?(w=!0,l=!1):(w=a(V),w||(r=_(r,",")),n()),!(u()||E())){e.charCodeAt(t)===W||e.charCodeAt(t)===ae||e.charCodeAt(t)===z||e.charCodeAt(t)===ie||e[t]===void 0?r=Q(r,","):x();break}n();const $=a(Me),R=t>=e.length;$||(he(e[t])||R?r=_(r,":"):F()),m()||($||R?r+="null":F())}return e.charCodeAt(t)===W?(r+="}",t++):r=_(r,"}"),!0}return!1}function C(){if(e.charCodeAt(t)===ie){r+="[",t++,n();let l=!0;for(;t<e.length&&e.charCodeAt(t)!==z;)if(l?l=!1:a(V)||(r=_(r,",")),!m()){r=Q(r,",");break}return e.charCodeAt(t)===z?(r+="]",t++):r=_(r,"]"),!0}return!1}function g(){let l=!0,w=!0;for(;w;)l?l=!1:a(V)||(r=_(r,",")),w=m();w||(r=Q(r,",")),r=`[
`.concat(r,`
]`)}function u(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,w=e.charCodeAt(t)===H;if(w&&(t++,w=!0),Z(e.charCodeAt(t))){const N=fe(e.charCodeAt(t))?fe:de(e.charCodeAt(t))?de:re(e.charCodeAt(t))?re:Ee,$=t,R=r.length;let q='"';for(t++;;){if(t>=e.length)return l?(q=_(q,'"'),r+=q,!0):(t=$,r=r.substring(0,R),u(!0));if(N(e.charCodeAt(t))){const U=t,I=q.length;if(q+='"',t++,r+=q,n(),l||t>=e.length||K(e.charAt(t))||Z(e.charCodeAt(t)))return h(),!0;if(K(e.charAt(L(U-1))))return t=$,r=r.substring(0,R),u(!0);r=r.substring(0,R),t=U+1,q=q.substring(0,I)+"\\"+q.substring(I)}else{if(l&&K(e[t]))return q=_(q,'"'),r+=q,h(),!0;if(e.charCodeAt(t)===H){const U=e.charAt(t+1);if(ut[U]!==void 0)q+=e.slice(t,t+2),t+=2;else if(U==="u"){let G=2;for(;G<6&&tt(e.charCodeAt(t+G));)G++;G===6?(q+=e.slice(t,t+6),t+=6):t+G>=e.length?t=e.length:j()}else q+=U,t+=2}else{const U=e.charAt(t),I=e.charCodeAt(t);I===Y&&e.charCodeAt(t-1)!==H?(q+="\\"+U,t++):ot(I)?(q+=lt[U],t++):(rt(I)||k(U),q+=U,t++)}}w&&p()}}return!1}function h(){let l=!1;for(n();e.charCodeAt(t)===le;){l=!0,t++,n(),r=Q(r,'"',!0);const w=r.length;u()?r=at(r,w,1):r=_(r,'"')}return l}function f(){const l=t;if(e.charCodeAt(t)===ue&&(t++,D(l)))return!0;for(;J(e.charCodeAt(t));)t++;if(e.charCodeAt(t)===Fe){if(t++,D(l))return!0;for(;J(e.charCodeAt(t));)t++}if(e.charCodeAt(t)===$e||e.charCodeAt(t)===Re){if(t++,(e.charCodeAt(t)===ue||e.charCodeAt(t)===le)&&t++,D(l))return!0;for(;J(e.charCodeAt(t));)t++}if(t>l){const w=e.slice(l,t),N=/^0\d/.test(w);return r+=N?'"'.concat(w,'"'):w,!0}return!1}function S(){return y("true","true")||y("false","false")||y("null","null")||y("True","true")||y("False","false")||y("None","null")}function y(l,w){return e.slice(t,t+l.length)===l?(r+=w,t+=l.length,!0):!1}function E(){const l=t;for(;t<e.length&&!K(e[t])&&!Z(e.charCodeAt(t));)t++;if(t>l){if(e.charCodeAt(t)===De)return t++,m(),e.charCodeAt(t)===Oe&&(t++,e.charCodeAt(t)===Ne&&t++),!0;{for(;B(e.charCodeAt(t-1))&&t>0;)t--;const w=e.slice(l,t);return r+=w==="undefined"?"null":JSON.stringify(w),e.charCodeAt(t)===Y&&t++,!0}}}function L(l){let w=l;for(;w>0&&B(e.charCodeAt(w));)w--;return w}function O(l){if(!J(e.charCodeAt(t))){const w=e.slice(l,t);throw new P("Invalid number '".concat(w,"', expecting a digit ").concat(T()),t)}}function D(l){return t>=e.length?(r+=e.slice(l,t)+"0",!0):(O(l),!1)}function k(l){throw new P("Invalid character "+JSON.stringify(l),t)}function A(){throw new P("Unexpected character "+JSON.stringify(e[t]),t)}function v(){throw new P("Unexpected end of json string",e.length)}function x(){throw new P("Object key expected",t)}function F(){throw new P("Colon expected",t)}function j(){const l=e.slice(t,t+6);throw new P('Invalid unicode character "'.concat(l,'"'),t)}function T(){return e[t]?"but got '".concat(e[t],"'"):"but reached end of input"}}function ft(e,t){return e[t]==="*"&&e[t+1]==="/"}const oe=7;function dt(e,t,r){switch(e){case"google":return"https://www.google.com/search";case"bing":return"https://www.bing.com/search";case"baidu":return t?"https://www.baidu.com/s":r?"https://image.baidu.com/search/acjson":"https://www.baidu.com/s";case"duckduckgo":return"https://duckduckgo.com/";case"yahoo":return t?"https://news.search.yahoo.com/search":r?"https://images.search.yahoo.com/search/images":"https://search.yahoo.com/search";case"naver":return"https://search.naver.com/search.naver";case"yandex":return"https://yandex.com/search/";case"sogou":return"https://www.sogou.com/web";case"brave":return"https://search.brave.com/search";case"reddit":return"https://www.reddit.com/search";case"twitter":return"https://twitter.com/search";case"youtube":return"https://www.youtube.com/results";case"amazon":return"https://www.amazon.com/s";default:return"https://www.google.com/search"}}function mt(e,t=!1,r=!1,o){const c={...o};delete c.limit,c.region&&c.region!=="wt-wt"&&(e==="google"?c.query=`location:${c.region} ${c.query}`:c.query=`${c.query}`,delete c.region),e!=="google"&&delete c.region;let m=c.query;switch(delete c.query,c.site&&(m=`site:${c.site} ${m}`),delete c.site,e){case"yahoo":{c.p=m;break}case"baidu":{if(t){c.word=m;break}c.wd=m;break}case"naver":case"sogou":{c.query=m;break}case"yandex":{c.text=m;break}case"bing":case"duckduckgo":case"brave":case"google":default:c.q=m}if(r)switch(e){case"google":{c.tbm="isch",c.udm="2";break}case"baidu":{c.tn="resultjson_com",c.word=m;break}}if(t)switch(e){case"google":{c.tbm="nws";break}case"baidu":{c.tn="news";break}}return new URLSearchParams({...c})}function ke(e,t){const r=dt(e,t.shouldSearchNews,t.shouldSearchImage),o=mt(e,t.shouldSearchNews,t.shouldSearchImage,{limit:t.limit,query:t.query,region:t.region,site:t.site});return`${r}?${o.toString()}`}function gt(e){const t=e.cloneNode(!0);return t.querySelectorAll('*[style*="display: none"]').forEach(o=>{o.parentNode.removeChild(o)}),t}function pt(e){try{const t=new DOMParser().parseFromString(e,"text/html"),r=gt(t.body),o={FORBID_TAGS:["style","noscript","script","svg","img","iframe","video"],USE_PROFILES:{html:!0}};let c=qe.sanitize(r,{...o});return wt(c)>me&&(c=c.slice(0,me)),c}catch{return e||""}}const me=1e6,wt=e=>new Blob([e]).size,yt=e=>{if(!e)return"";try{const t=/^(?:https?:\/\/)?(?:www\.)?((?:(?!www\.|\.).)+\.[-a-zA-Z0-9.]+)/gm,r=e.match(t);return(r?r[0]:"").toLowerCase()}catch{return e}},bt=e=>{try{return e?(e.search(/^http[s]?:\/\//)==-1&&(e="https://"+e),e):""}catch{return e||""}},M=(e,t=64)=>{try{const r=yt(e)||`${e==null?void 0:e.toLowerCase()}.com`;return`https://www.google.com/s2/favicons?sz=${t}&domain_url=${r}`}catch{return""}};function te(e){try{return e.trim().replaceAll(`
  `,"")||""}catch{return e||""}}function ge(e){try{const t=bt(e.trim().replaceAll("...","")),r=new URL(t).host.split(".");return r.length>=3?r[1]:r[0]}catch{return e}}function St(e){try{const t=e.match(/RU=([^/]+)/);return t&&t[1]?decodeURIComponent(t[1]):e}catch{return e||""}}const Lt=async(e,t=0,r=1500)=>{if(t>oe)return{html:"",status:301,success:!1,url:e};try{const o=await fetch(e,{credentials:"omit",redirect:"follow",signal:AbortSignal.timeout(r)});if(!o.ok){const m=o.type==="opaqueredirect"?301:o.status;throw{status:m,statusText:`Failed to fetch: ${m} ${o.statusText}`}}const c=await o.text();if(!c)throw{status:301,statusText:"Failed to fetch: 301"};return{html:c,status:o.status,success:!0,url:e}}catch(o){return o.status===301||o.status===429?{html:"",status:301,success:!1,url:e}:{html:`Could not fetch the page: ${o.message}. Make sure the URL is correct.`,status:404,success:!1,url:e}}};async function Ct(e,t){let r=0;const o=t.map(async m=>{try{const n=await e(ne.WEB_ACCESS.GET_HTML_FROM_URL,"GET_DTATA_FROM_URLS",{successfulGet:r,url:m.url});if(n.success&&n.status===200){r++;const i=pt(n.html);return{...m,html:i}}}catch{}return null});return(await Promise.all(o)).filter(m=>m!==null)}const At=(e,t,r=!1)=>{try{const o=new DOMParser().parseFromString(e,"text/html"),c=[];switch(t){case"google":{if(r){const n=o.querySelectorAll("#search #rso > div a[data-ved]");n&&n.forEach(i=>{try{const s=i.querySelectorAll("div[role=heading]");s&&s.forEach(a=>{var d,p;try{const b=a.textContent,C=((d=a.nextElementSibling)==null?void 0:d.textContent)||"";let g="";const u=i.querySelector("g-img");let h="";if(u){const S=u.querySelector("img");S&&(h=S.getAttribute("src")||"");const y=(p=u.parentElement)==null?void 0:p.querySelector("span");y&&(g=y.textContent||"")}if(!h){const S=i.querySelector("img");S&&(h=S.getAttribute("src")||"")}const f=i.getAttribute("href")??"";h&&h.includes("////")&&(h=M(f)),c.push({body:(C.includes("ago")?b:C)||b,from:g,imgLink:h,title:b,url:f})}catch{}})}catch{}})}else{const n=o.querySelectorAll("#search #rso > div");if(n.length===1){const i=o.querySelectorAll("#rso #kp-wp-tab-overview:not([style])");i&&i.forEach(a=>{try{const d=a.querySelectorAll('div[class*="K7khPe"]');d.length>0&&d.forEach(p=>{var b,C,g,u,h;try{const f=p.querySelector("a > h3");let S="",y="",E="",L="",O="";if(S=((b=p.querySelector("div.MUxGbd"))==null?void 0:b.textContent)||"",!S){const A=p.querySelector('div[jscontroller="SC7lYd"'),v=A==null?void 0:A.querySelector("div.ieodic");if(v){const x=v.querySelector("span");x&&(S=x.textContent||"")}if(!S){const x=(C=A==null?void 0:A.firstChild)==null?void 0:C.children[1];x&&(S=x.textContent||"")}}if(!S)try{const A=p.querySelector('div[style*="-webkit-line-clamp"]');S=A?(g=A.textContent)==null?void 0:g.trim():null}catch{}const D=f&&f.closest("a");O=(D==null?void 0:D.getAttribute("href"))??"",L=f==null?void 0:f.textContent;const k=f==null?void 0:f.nextElementSibling;y=k&&(k!=null&&k.lastElementChild)?(h=(u=k==null?void 0:k.lastElementChild)==null?void 0:u.firstElementChild)==null?void 0:h.textContent:"",E=M(O),c.push({body:S,from:y,imgLink:E,title:L,url:O})}catch{}})}catch{}});const s=o.querySelectorAll("#search #rso > div a[data-ved]");s&&s.forEach(a=>{try{const d=a.querySelectorAll("div[role=heading]");d&&d.forEach(p=>{var b,C;try{const g=p.textContent,u=((b=p.nextElementSibling)==null?void 0:b.textContent)||"";let h="";const f=a.querySelector("g-img");let S="";if(f){const E=f.querySelector("img");E&&(S=E.getAttribute("src")||"");const L=(C=f.parentElement)==null?void 0:C.querySelector("span");L&&(h=L.textContent||"")}if(!S){const E=a.querySelector("img");E&&(S=E.getAttribute("src")||"")}const y=a.getAttribute("href")??"";S&&S.includes("////")&&(S=M(y)),c.push({body:(u.includes("ago")?g:u)||g,from:h,imgLink:S,title:g,url:y})}catch{}})}catch{}})}else n.forEach(s=>{var a,d,p,b,C,g,u,h,f,S,y,E,L,O,D;try{const k=s.querySelector("a > h3");if(!k)return;const A=k.closest("a");let v=((d=(a=s.querySelector("div.MUxGbd"))==null?void 0:a.textContent)==null?void 0:d.trim())||"";if(v||(v=((u=(g=(C=(b=(p=A==null?void 0:A.parentElement)==null?void 0:p.parentElement)==null?void 0:b.parentElement)==null?void 0:C.nextSibling)==null?void 0:g.textContent)==null?void 0:u.trim())||""),v||(v=((L=(E=(y=(S=(f=(h=A==null?void 0:A.parentElement)==null?void 0:h.parentElement)==null?void 0:f.parentElement)==null?void 0:S.nextSibling)==null?void 0:y.nextSibling)==null?void 0:E.textContent)==null?void 0:L.trim())||""),!v){const T=s.querySelector('div[style*="-webkit-line-clamp"]');v=((O=T==null?void 0:T.textContent)==null?void 0:O.trim())||""}let x="";const F=k.nextSibling;if(F){const T=F.children;T&&T.length&&(x=T[T.length-1].textContent||"")}const j=A?A.getAttribute("href"):"";c.push({body:v||(k==null?void 0:k.textContent),from:x,imgLink:(D=F==null?void 0:F.querySelector("img"))==null?void 0:D.getAttribute("src"),title:k==null?void 0:k.textContent,url:j})}catch{}}),(o.querySelectorAll('div[jscontroller="SC7lYd"')||[]).forEach(s=>{var a,d,p;try{const b=s.querySelector("a");if(!b)return;const C=(b==null?void 0:b.getAttribute("href"))??"";if(c.find(y=>y.url===C))return;const g=s.querySelector("a > h3, h3, a");if(!g)return;let u=((a=s.querySelector("img"))==null?void 0:a.getAttribute("src"))||"";if(!u){const y=s.querySelector("g-img img");y&&(u=y.getAttribute("src")||"")}u&&u.includes("////")&&(u=M(C));let h=s.querySelector(".VuuXrf");if(!h){const y=s.querySelector("cite"),E=(d=y==null?void 0:y.parentElement)==null?void 0:d.parentElement;h=E==null?void 0:E.querySelector("span")}let f=null;const S=s.querySelector("div.ieodic");if(S&&(f=S.querySelector("span")),!f){const y=(p=s==null?void 0:s.firstChild)==null?void 0:p.children[1];y&&(f=y)}f||(f=s.querySelector('div[style*="-webkit-line-clamp"]')),c.push({body:(f==null?void 0:f.textContent)||"",from:(h==null?void 0:h.textContent)||"",imgLink:u,title:(g==null?void 0:g.textContent)||"",url:C})}catch{}})}break}case"bing":{const n=o.querySelector("ol#b_results");n&&Array.from(n.querySelectorAll("li.b_algo")).forEach(i=>{const s=i.querySelector("h2 > a"),a=i.querySelector(".b_algoSlug"),d=i.querySelector(".b_wikiRichcard .tab-content"),p=i.querySelector("a .tptt"),b=i.querySelector("img.rms_img");let C="";a?C=a.textContent:d&&(C=d.textContent.trim());let g=null;b&&(g=b.getAttribute("src"));let u="";s&&(u=s.getAttribute("href"));let h="";p&&(h=p.textContent),c.push({body:C,from:h,imgLink:g,title:s?s.textContent:"",url:u})});break}case"baidu":{const n=o.querySelector("div#content_left");if(!n)break;n.querySelectorAll("div[class^=result]").forEach(s=>{var a,d,p,b,C;try{const g=s.querySelector("h3"),u=g?g.querySelector("a"):null;if(!u)return;let h=(a=s.querySelector("div[class*='description_']"))==null?void 0:a.textContent;h=h||((d=s.querySelector(".op_dict_content"))==null?void 0:d.textContent),h=h||((p=s.querySelector("div[class*='basis-info_']"))==null?void 0:p.textContent),h=h||((b=s.querySelector(".c-color-text"))==null?void 0:b.textContent),h=h||(g?g.nextElementSibling.nextElementSibling.textContent:null);const f=s.querySelector("a[class^='siteLink']");c.push({body:h??"",from:(f==null?void 0:f.textContent)||"",imgLink:((C=f==null?void 0:f.querySelector("img"))==null?void 0:C.getAttribute("src"))||M((u==null?void 0:u.getAttribute("href"))??"")||"",title:g?g==null?void 0:g.textContent:"",url:u?u.getAttribute("href")??"":""})}catch{}});break}case"yahoo":{r?new DOMParser().parseFromString(e,"text/html").querySelector("#main ol.searchCenterMiddle").querySelectorAll("li ul li").forEach(s=>{var S,y,E;const a=s.querySelector("h4.s-title a"),d=a.querySelector("img"),p=(d==null?void 0:d.getAttribute("src"))??"",b=s.querySelector(".s-source"),C=((S=b==null?void 0:b.textContent)==null?void 0:S.trim())??"",g=((y=a==null?void 0:a.textContent)==null?void 0:y.trim())??"",u=St((a==null?void 0:a.getAttribute("href"))??""),h=s.querySelector("p.s-desc"),f=((E=h==null?void 0:h.textContent)==null?void 0:E.trim())??"";c.push({body:f,from:C,imgLink:p,title:g,url:u})}):o.querySelectorAll('.algo:not([class*="ad"])').forEach(i=>{const s=i.querySelector("h3.title a");if(s){const a=s.getAttribute("href")||"",d=s.querySelector("span");let p=[];d&&(p=d.textContent.split(" › "));const b=i.querySelector(".compText"),C=b?b.textContent:"";c.push({body:C,from:ge(a)||p&&p[0]||"",imgLink:M(a)||"",title:s.getAttribute("aria-label")||"",url:a})}});break}}const m=[];for(let n=0;n<c.length;n++)try{const i={...c[n]};i.from||(i.from=ge(i.url)||""),i.from&&(i.from=i.from.replace(/\.[^.]*$/,""),i.from=te(i.from)||""),!i.imgLink&&i.url&&(i.imgLink=M(i.url)||""),i.body=te(i.body)||"",i.title=te(i.title)||"",m.push(i)}catch{}return m}catch{return[]}};async function X({engine:e,getFromBackground:t,query:r,shouldSearchImage:o=!1,shouldSearchNews:c=!1,timerange:m=null}){try{const n=ke(e,{btf:m,csp:"1",ei:"UTF-8",limit:oe,nojs:"1",query:r,region:"wt-wt",shouldSearchImage:o,shouldSearchNews:c,site:null});return await t(ne.WEB_ACCESS.GET_HTML_FROM_URL,"GET_SEARCH_ENGINE_DOM",{signal:null,timeout:4e3,url:n})}catch{}return{html:"",status:404,success:!1,url:""}}const Dt=async(e,t,r,o,c=!1,m)=>{var f,S,y,E,L,O,D,k;let n={response:(((S=(f=r.action.message)==null?void 0:f.metadata)==null?void 0:S.context)??"")+" "+((y=r.action.message)==null?void 0:y.content),shouldGoogle:!0,shouldSearchNews:!1,timerange:null},i=!0;(!m||!(((L=(E=r.action.message)==null?void 0:E.content)==null?void 0:L.length)+(((k=(D=(O=r.action.message)==null?void 0:O.metadata)==null?void 0:D.context)==null?void 0:k.length)??0)<=60))&&i&&(n=await ve(t,r)),n.shouldGoogle||(c=!0);let{html:s,success:a,url:d}=await X({engine:o,getFromBackground:e,query:(n==null?void 0:n.response)??r.action.message.content,shouldSearchNews:n==null?void 0:n.shouldSearchNews,timerange:n==null?void 0:n.timerange});if(a||(o=o==="google"?"yahoo":"google",{html:s,success:a,url:d}=await X({engine:o,getFromBackground:e,query:(n==null?void 0:n.response)??r.action.message.content,shouldSearchNews:n==null?void 0:n.shouldSearchNews,timerange:n==null?void 0:n.timerange})),a||(o="baidu",{html:s,success:a,url:d}=await X({engine:o,getFromBackground:e,query:(n==null?void 0:n.response)??r.action.message.content,shouldSearchNews:n==null?void 0:n.shouldSearchNews,timerange:n==null?void 0:n.timerange})),!a)return{data:[],decisionResponse:n};const p=new DOMParser().parseFromString(s,"text/html").querySelector("body"),b=(p==null?void 0:p.innerHTML)??"",C=At(s,o,n==null?void 0:n.shouldSearchNews);if(c){const A=C.map(v=>({...v,html:""}));try{A.push({body:se(p)||"Search results",from:o,html:"",imgLink:M("https://www.google.com/"),title:"Search Results",url:d})}catch{}return{data:A,decisionResponse:n}}const g=await Ct(e,C);g.push({body:"Search results",from:o,html:b,imgLink:M("https://www.google.com/"),title:"Search Results",url:d});const u=await xe();return((u==null?void 0:u.useNewDomClean)===void 0||(u==null?void 0:u.useNewDomClean)===null?!0:u==null?void 0:u.useNewDomClean)&&g.forEach(A=>{try{const v=new DOMParser().parseFromString(A.html,"text/html").querySelector("body");A.html="";let x;try{x=se(v)}catch{x=""}A.body=x??A.body}catch{}}),{data:g,decisionResponse:n}};async function Ot(e){const t=new AbortController,r=t.signal,o=setTimeout(()=>{t.abort()},5e3);try{const m=await fetch(e,{headers:{"Content-Type":"text/html","User-Agent":"Chrome/90.0.4430.212"},method:"GET",signal:r});if(!m.ok&&m.status!==200)return"";const n=await m.text();return clearTimeout(o),n}catch{return clearTimeout(o),""}}async function pe(e,t){const r=new DOMParser().parseFromString(e,"text/html").querySelectorAll(t),o=[];return r==null||r.forEach(c=>{var m,n,i;try{const s=c==null?void 0:c.getAttribute("data-id"),a=(n=(m=c==null?void 0:c.children[1])==null?void 0:m.children[0])==null?void 0:n.children[0].getAttribute("data-src");a&&o.push({id:s,link:a})}catch{const a=(i=c==null?void 0:c.children[0])==null?void 0:i.children[0].getAttribute("data-src");a&&o.push({link:a})}}),o}async function we(e,t,r){return await X({engine:e,getFromBackground:t,query:r,shouldSearchImage:!0,shouldSearchNews:!1,timerange:"m"})}async function Ut(e,t){let r=[],{html:o,success:c,url:m}=await we("google",e,t);if(c)r=await pe(o,'div[jsname="N9Xkfe"][role="listitem"]');else if({html:o,success:c,url:m}=await we("yahoo",e,t),c)r=await pe(o,'li[data-bns="API"]');else{const n=ke("baidu",{btf:"m",csp:"1",ei:"UTF-8",limit:oe,nojs:"1",query:t,region:"wt-wt",shouldSearchImage:!0,shouldSearchNews:!1,site:null}),i=await e(ne.FETCH_TEXT,"FETCH_IMAGES",{options:{headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Encoding":"gzip, deflate, br","Accept-Language":"en-US,en;q=0.5",Connection:"keep-alive",Host:"image.baidu.com"},method:"GET"},url:n});if(!i)return r;try{JSON.parse(i).data.forEach(a=>{const d=a.middleURL;d&&r.push(d)})}catch{JSON.parse(ht(i)).data.forEach(d=>{const p=d.middleURL;p&&r.push(p)})}}return r.slice(0,11),r.slice(0,11)}export{M as a,X as b,At as c,Lt as d,Ot as e,Ut as f,Dt as g};
