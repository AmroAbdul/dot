var R=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var i=(t,e,s)=>(R(t,e,"read from private field"),s?s.call(t):e.get(t)),p=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},C=(t,e,s,r)=>(R(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);var g=(t,e,s)=>(R(t,e,"access private method"),s);import{r as c,j as D}from"./client-64cc3330.js";import{S as L,x as G,H as q,I as N,G as T}from"./backend-8962bc7f.js";var v,b,l,m,M,S,O,P,U,_=(U=class extends L{constructor(e,s){super();p(this,M);p(this,O);p(this,v,void 0);p(this,b,void 0);p(this,l,void 0);p(this,m,void 0);C(this,v,e),this.setOptions(s),this.bindMethods(),g(this,M,S).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var r;const s=this.options;this.options=i(this,v).defaultMutationOptions(e),G(this.options,s)||i(this,v).getMutationCache().notify({type:"observerOptionsUpdated",mutation:i(this,l),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&q(s.mutationKey)!==q(this.options.mutationKey)?this.reset():((r=i(this,l))==null?void 0:r.state.status)==="pending"&&i(this,l).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=i(this,l))==null||e.removeObserver(this)}onMutationUpdate(e){g(this,M,S).call(this),g(this,O,P).call(this,e)}getCurrentResult(){return i(this,b)}reset(){var e;(e=i(this,l))==null||e.removeObserver(this),C(this,l,void 0),g(this,M,S).call(this),g(this,O,P).call(this)}mutate(e,s){var r;return C(this,m,s),(r=i(this,l))==null||r.removeObserver(this),C(this,l,i(this,v).getMutationCache().build(i(this,v),this.options)),i(this,l).addObserver(this),i(this,l).execute(e)}},v=new WeakMap,b=new WeakMap,l=new WeakMap,m=new WeakMap,M=new WeakSet,S=function(){var s;const e=((s=i(this,l))==null?void 0:s.state)??N();C(this,b,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},O=new WeakSet,P=function(e){T.batch(()=>{var s,r,n,u,h,a,o,f;if(i(this,m)&&this.hasListeners()){const d=i(this,b).variables,y=i(this,b).context;(e==null?void 0:e.type)==="success"?((r=(s=i(this,m)).onSuccess)==null||r.call(s,e.data,d,y),(u=(n=i(this,m)).onSettled)==null||u.call(n,e.data,null,d,y)):(e==null?void 0:e.type)==="error"&&((a=(h=i(this,m)).onError)==null||a.call(h,e.error,d,y),(f=(o=i(this,m)).onSettled)==null||f.call(o,void 0,e.error,d,y))}this.listeners.forEach(d=>{d(i(this,b))})})},U);function z(t){return{mutationKey:t.options.mutationKey,state:t.state,...t.options.scope&&{scope:t.options.scope},...t.meta&&{meta:t.meta}}}function B(t){var e;return{state:t.state,queryKey:t.queryKey,queryHash:t.queryHash,...t.state.status==="pending"&&{promise:(e=t.promise)==null?void 0:e.catch(s=>Promise.reject(new Error("redacted")))},...t.meta&&{meta:t.meta}}}function F(t){return t.state.isPaused}function J(t){return t.state.status==="success"}function V(t,e={}){var h,a;const s=e.shouldDehydrateMutation??((h=t.getDefaultOptions().dehydrate)==null?void 0:h.shouldDehydrateMutation)??F,r=t.getMutationCache().getAll().flatMap(o=>s(o)?[z(o)]:[]),n=e.shouldDehydrateQuery??((a=t.getDefaultOptions().dehydrate)==null?void 0:a.shouldDehydrateQuery)??J,u=t.getQueryCache().getAll().flatMap(o=>n(o)?[B(o)]:[]);return{mutations:r,queries:u}}function W(t,e,s){if(typeof e!="object"||e===null)return;const r=t.getMutationCache(),n=t.getQueryCache(),u=e.mutations||[],h=e.queries||[];u.forEach(({state:a,...o})=>{var f,d;r.build(t,{...(f=t.getDefaultOptions().hydrate)==null?void 0:f.mutations,...(d=s==null?void 0:s.defaultOptions)==null?void 0:d.mutations,...o},a)}),h.forEach(({queryKey:a,state:o,queryHash:f,meta:d,promise:y})=>{var w,K,j;let x=n.get(f);if(x){if(x.state.dataUpdatedAt<o.dataUpdatedAt){const{fetchStatus:Q,...E}=o;x.setState(E)}}else x=n.build(t,{...(w=t.getDefaultOptions().hydrate)==null?void 0:w.queries,...(K=s==null?void 0:s.defaultOptions)==null?void 0:K.queries,queryKey:a,queryHash:f,meta:d},{...o,fetchStatus:"idle"});if(y){const Q=(j=t.getDefaultOptions().hydrate)==null?void 0:j.transformPromise,E=(Q==null?void 0:Q(Promise.resolve(y)))??y;x.fetch(void 0,{initialPromise:E})}})}var k=c.createContext(void 0),X=t=>{const e=c.useContext(k);if(t)return t;if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},Y=({client:t,children:e})=>(c.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),D.jsx(k.Provider,{value:t,children:e})),H=c.createContext(!1),at=()=>c.useContext(H),Z=H.Provider;function $(t,e){return typeof t=="function"?t(...e):!!t}function tt(){}function ot(t,e){const s=X(e),[r]=c.useState(()=>new _(s,t));c.useEffect(()=>{r.setOptions(t)},[r,t]);const n=c.useSyncExternalStore(c.useCallback(h=>r.subscribe(T.batchCalls(h)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),u=c.useCallback((h,a)=>{r.mutate(h,a).catch(tt)},[r]);if(n.error&&$(r.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:u,mutateAsync:n.mutate}}var et=["added","removed","updated"];function I(t){return et.includes(t)}async function st({queryClient:t,persister:e,maxAge:s=1e3*60*60*24,buster:r="",hydrateOptions:n}){try{const u=await e.restoreClient();if(u)if(u.timestamp){const h=Date.now()-u.timestamp>s,a=u.buster!==r;h||a?e.removeClient():W(t,u.clientState,n)}else e.removeClient()}catch{e.removeClient()}}async function A({queryClient:t,persister:e,buster:s="",dehydrateOptions:r}){const n={buster:s,timestamp:Date.now(),clientState:V(t,r)};await e.persistClient(n)}function rt(t){const e=t.queryClient.getQueryCache().subscribe(r=>{I(r.type)&&A(t)}),s=t.queryClient.getMutationCache().subscribe(r=>{I(r.type)&&A(t)});return()=>{e(),s()}}var ht=({client:t,children:e,persistOptions:s,onSuccess:r,...n})=>{const[u,h]=c.useState(!0),a=c.useRef({persistOptions:s,onSuccess:r}),o=c.useRef(!1);return c.useEffect(()=>{a.current={persistOptions:s,onSuccess:r}}),c.useEffect(()=>{const f={...a.current.persistOptions,queryClient:t};return o.current||(o.current=!0,h(!0),st(f).then(async()=>{var d,y;try{await((y=(d=a.current).onSuccess)==null?void 0:y.call(d))}finally{h(!1)}})),u?void 0:rt(f)},[t,u]),D.jsx(Y,{client:t,...n,children:D.jsx(Z,{value:u,children:e})})};export{ht as P,ot as a,at as b,$ as s,X as u};
