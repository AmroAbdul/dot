"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3190],{59827:(e,t,o)=>{o.d(t,{Q:()=>a});o(67294);var r=o(82990),i=o(65183),n=o(85893);const s={...r.Z.textOverflowStyle,position:"absolute",left:0,right:0,top:0,bottom:0},l={marginLeft:4,fontWeight:r.Z.fontWeight.semibold};function a(e){const{prefix:t,viewName:o,viewType:r}=e;return(0,n.jsxs)("div",{style:{position:"relative",width:"100%"},children:["Â ",(0,n.jsxs)("div",{style:s,children:[t,r&&i.aW[r]({marginLeft:8,marginRight:2,width:"1em",display:"inline",verticalAlign:"bottom"}),(0,n.jsx)("span",{style:l,children:o})]})]})}},10912:(e,t,o)=>{o.d(t,{Z:()=>_});o(57658),o(67294);var r=o(83355),i=o(27531),n=o(86628),s=o(24405),l=o(41432),a=o(80951),c=o(95538),d=o(21202),u=o(97880),p=o(10906),h=o(12457),m=o(17311),S=o(35328),g=o(79797),C=o(74480),f=o(12981),v=o(43568),y=o(81865),x=o(35541),b=o(85893);function w(e){return"number"==typeof e}class k extends r.Z{constructor(){super(...arguments),this.renderContentBlock=e=>{const{store:t,renderAdditionalBlocks:o,rendererBlockStyle:r}=this.props,n=g.G.createChildStore(t,{table:d.iU,id:e}),s=n.getType(),l=o&&void 0!==s?(0,x.u)(n):(0,C.h)(n);if(l)return(0,b.jsx)(i.D,{value:this.restrictedContentStore,children:(0,b.jsx)(l,{store:n,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,hideContent:(0,S.BX)(n),style:{fontSize:12,opacity:.8,pointerEvents:"none",...r},isQuickFind:!0,numberedListCounterStore:this.createComputedStore((()=>({depth:0,numberedListBlockIdsWithFormat:this.createNumberedListCounterStore(e)})))})},e)},this.coverStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,{ThemeStore:o}=this.environment,r=(0,p.NU)({rootStore:e,renderAdditionalBlocks:t,theme:o.state.mode});return r.image?r.image:!(this.props.showLoadingShimmer&&0===r.blockIds.length&&!r.isDefined)&&r.blockIds})),this.restrictedContentStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,o=(0,p.wK)(e,t);return o.image?void 0:o.blockIds})),this.numberedLists=this.createComputedStore((()=>{const{store:e}=this.props,t=this.coverStore.state,o=[];if(Array.isArray(t)){let r=0;for(;r<t.length;){let i=t[r],n=g.G.createChildStore(e,{table:d.iU,id:i});if(n.getType()===l.Ti.numberedList){const s=[{blockId:i,idx:1}],a=[{id:i,format:void 0,depth:s.length-1,index:s[0].idx}];for(r+=1;r<t.length&&(i=t[r],n=g.G.createChildStore(e,{table:d.iU,id:i}),n.getType()===l.Ti.numberedList);){{const e=n.getParentId();if(n.getParentId()===s[s.length-1].blockId)s.push({blockId:i,idx:1});else{let t=s[s.length-1].idx;for(;s.length>0&&s[s.length-1].blockId!==e;)t=s[s.length-1].idx,s.pop();s.push({blockId:i,idx:t+1})}a.push({id:i,format:void 0,depth:s.length-1,index:s[s.length-1].idx})}r+=1}o.push(a)}else r+=1}}return o}))}didUpdate(e){this.props.coverFormat.type!==e.coverFormat.type&&this.props.onLoadProxiedImage()}renderComponent(){const{coverFormat:e}=this.props;return"page_cover"===e.type?(0,b.jsx)(E,{store:this.props.store,coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,imageCoverWrapStyle:this.props.imageCoverWrapStyle,coverWidth:this.props.coverWidth,onLoadProxiedImage:this.props.onLoadProxiedImage,style:this.props.style,variant:this.props.variant,coverAspectFormat:this.props.coverAspectFormat,coverPosition:this.props.coverPosition,showEmptyGalleryCover:this.props.showEmptyGalleryCover,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle}):"page_content"===e.type?this.renderPageContent():"property"===e.type?(0,b.jsx)(Z,{store:this.props.store,coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,imageCoverWrapStyle:this.props.imageCoverWrapStyle,onLoadProxiedImage:this.props.onLoadProxiedImage,coverWidth:this.props.coverWidth,style:this.props.style,variant:this.props.variant,coverAspectFormat:this.props.coverAspectFormat,coverPosition:this.props.coverPosition,showEmptyGalleryCover:this.props.showEmptyGalleryCover,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle,property:e.property}):void 0}renderPageContent(){const e=this.coverStore.state,t=this.restrictedContentStore.state,o=this.props.renderAdditionalBlocks&&this.props.store.isCollectionView();if(!1===e)return(0,b.jsx)(I,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,loadingShimmerStyle:this.props.loadingShimmerStyle});if(e){if(!Array.isArray(e))return o?(0,b.jsxs)("div",{style:L(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle),children:[(0,b.jsx)(y.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:P(),render:(e,t)=>{if(t)return(0,b.jsx)(f.Z,{style:{...V(),...H({renderCollectionImage:!0},this.props.variant,this.theme,this.props.coverHeight,this.props.coverSizeFormat),...R(),objectPosition:`center ${100*(1-T(this.props.store,this.props.coverPosition))}%`},placeholderLoadedStyle:{display:"flex",justifyContent:"center",alignItems:"end"},src:t})}}),(0,b.jsx)(D,{variant:this.props.variant}),(0,b.jsx)("div",{style:B(this.theme,this.props.coverContentFadedOverlayStyle)})]}):(0,b.jsxs)("div",{style:M(this.props.coverHeight,this.props.coverSizeFormat,this.props.imageCoverWrapStyle),children:[(0,b.jsx)(y.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:P(this.props.coverWidth,this.props.coverSizeFormat),render:(e,t)=>{if(t)return(0,b.jsx)(f.Z,{style:{...V(this.props.style),...H({renderCollectionImage:!1},this.props.variant,this.theme,this.props.coverHeight,this.props.coverSizeFormat),...R(this.props.coverAspectFormat),objectPosition:`center ${100*(1-T(this.props.store,this.props.coverPosition))}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(D,{variant:this.props.variant})]});if(e.length>0)return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{style:L(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle),children:[t?e.filter((e=>t.indexOf(e)>=0)).map(this.renderContentBlock):e.map(this.renderContentBlock),this.props.coverContentFadedOverlay&&(0,b.jsx)("div",{style:B(this.theme,this.props.coverContentFadedOverlayStyle)})]})});if(this.props.showEmptyGalleryCover)return(0,b.jsx)(j,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}else if(this.props.showEmptyGalleryCover)return(0,b.jsx)(j,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}createNumberedListCounterStore(e){const t=this.numberedLists.state;for(const o of t)if(o.find((t=>t.id===e)))return o;return[]}}k.displayName="CollectionItemCover";const _=k;function T(e,t){if(w(t))return t;if(e.getFormatStore().isDefined()){const{page_cover_position:t,card_cover_position:o}=e.getFormat();if(w(o))return o;if(w(t))return t}return.5}function V(e){return e||{}}function O(e,t){if(e)return e;switch(t){case"large":return m.Z.card.desktop.large.height;case"small":return m.Z.card.desktop.small.height;default:return m.Z.card.desktop.medium.height}}function P(e,t){return e||(0,p.rD)(t)}function R(e){return{objectFit:void 0===e?"cover":e}}function M(e,t,o){return{height:O(e,t),position:"relative",pointerEvents:"none",overflow:"hidden",...o}}function j(e){let{coverHeight:t,coverSizeFormat:o,emptyGalleryCoverStyle:r}=e;return(0,b.jsx)("div",{style:{height:O(t,o),...r}})}function I(e){let{coverHeight:t,coverSizeFormat:o,loadingShimmerStyle:r}=e;return(0,b.jsx)("div",{style:{height:O(t,o),...r},children:(0,b.jsx)(h.Z,{show:!0,showDelay:100,showHold:0,render:e=>e?(0,b.jsx)(v.Z,{paragraphs:[{lineHeight:12,lineMargin:6,sectionWidths:[100,100,50],repeat:1,sectionMargin:0}]}):void 0})})}function F(e,t,o,r){const{ThemeStore:i}=t,n="dark"===i.state.mode;switch(e){case"default":return{};case"gallery":return{background:o.collectionGalleryPreviewCardCover,padding:"8px 8px 0",boxShadow:n?"transparent":`inset 0 -1px 0 0 ${o.regularDividerColor}`,...r};default:(0,u.t1)(e)}}function B(e,t){return{width:"100%",height:40,position:"absolute",bottom:0,left:0,background:`linear-gradient(to bottom, transparent, ${e.accentColors.gray[30]} 100%)`,...t}}function N(e,t){switch(e){case"default":return{border:`1px solid ${t.stroke.regular}`,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomRightRadius:4,borderBottomLeftRadius:4};case"gallery":return{borderRadius:0,borderTopLeftRadius:1,borderTopRightRadius:1};default:(0,u.t1)(e)}}function D(e){let{variant:t}=e;window.__c={n:"ImageBorderComponent"};const o=(0,s.Fg)();switch(t){case"default":return null;case"gallery":return(0,b.jsx)("div",{style:{position:"absolute",left:0,right:0,bottom:0,borderBottom:`1px solid ${o.regularDividerColor}`}});default:(0,u.t1)(t)}return null}function L(e,t,o,r,i,n,s){return{height:O(r,i),pointerEvents:"none",overflow:"hidden",position:n?"relative":"static",...F(e,t,o,s),...s}}function A(e,t,o,r){return{width:"100%",height:O(o,r),...N(e,t),objectPosition:"center"}}function E(e){let{store:t,coverHeight:o,coverSizeFormat:r,imageCoverWrapStyle:i,coverWidth:l,onLoadProxiedImage:a,style:c,variant:d,coverAspectFormat:u,coverPosition:p,showEmptyGalleryCover:h,emptyGalleryCoverStyle:m}=e;window.__c={n:"PageCoverComponent"};const S=(0,s.Fg)(),g=(0,n.VK)((()=>{var e;return null===(e=t.getCover())||void 0===e?void 0:e.cover}),[t]),C=(0,n.VK)((()=>t.pointer),[t]),v=(0,n.VK)((()=>T(t,p)),[p,t]);return g?(0,b.jsxs)("div",{style:M(o,r,i),children:[(0,b.jsx)(y.Z,{url:g,isAuthenticated:!0,permissionRecord:C,width:P(l,r),onFinishedLoadingProxyUrl:e=>a(e),render:(e,t)=>{if(t)return(0,b.jsx)(f.Z,{style:{...V(c),...A(d,S,o,r),...R(u),objectPosition:`center ${100*(1-v)}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(D,{variant:d})]}):h?(0,b.jsx)(j,{coverHeight:o,coverSizeFormat:r,emptyGalleryCoverStyle:m}):null}function Z(e){let{property:t,store:o,coverHeight:r,coverSizeFormat:i,imageCoverWrapStyle:l,onLoadProxiedImage:d,coverWidth:u,style:p,variant:h,coverAspectFormat:m,coverPosition:S,showEmptyGalleryCover:g,emptyGalleryCoverStyle:C}=e;window.__c={n:"PropertyComponent"};const v=(0,s.Fg)(),x=(0,n.VK)((()=>(0,a.g)(o.getPropertyValue(t)).find((e=>(0,c.SR)({url:e.url})))),[t,o]),w=(0,n.VK)((()=>o.pointer),[o]),k=(0,n.VK)((()=>T(o,S)),[S,o]);return x?(0,b.jsxs)("div",{style:M(r,i,l),children:[(0,b.jsx)(y.Z,{onFinishedLoadingProxyUrl:e=>d(e),url:x.url,isAuthenticated:!0,permissionRecord:w,width:P(u,i),render:(e,t)=>{if(t)return(0,b.jsx)(f.Z,{style:{...V(p),...A(h,v,r,i),...R(m),objectPosition:`center ${100*(1-k)}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(D,{variant:h})]}):g?(0,b.jsx)(j,{coverHeight:r,coverSizeFormat:i,emptyGalleryCoverStyle:C}):null}function H(e,t,o,r,i){const{renderCollectionImage:n}=e;return{...A(t,o,r,i),objectPosition:"center center",...n&&{height:void 0,border:`1px solid ${o.lightDividerColor}`,borderBottom:"none",borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},81870:(e,t,o)=>{o.d(t,{Z:()=>d});o(67294);var r=o(480),i=o(24405),n=o(84169),s=o(25888),l=o(73063),a=o(16354),c=o(85893);const d=function(e){window.__c={n:"CollectionMenuHelpButton"};const t=(0,r.O7)(),o=(0,i.Fg)();return(0,c.jsx)(a.Z,{href:e.href,external:!0,onClick:()=>s.Fs(t,{from:e.helpButtonContext}),children:(0,c.jsx)(l.Z,{icon:n.m,style:{height:24,width:24,marginRight:-6,fill:o.mediumIconColor}})})}},57260:(e,t,o)=>{o.d(t,{Z:()=>W});var r=o(67294),i=o(83355),n=o(480),s=o(86628),l=o(24405),a=o(15145),c=o(58573),d=o(47453),u=o(35840),p=o(72126),h=o(9291),m=o(81193),S=o(98834),g=o(8055),C=o(82530),f=o(59827),v=o(66890),y=o(66213),x=o(27105),b=o(92658),w=o(14976),k=o(75079),_=o(84210),T=o(33929),V=o(87279),O=o(18514),P=o(80444),R=o(29798),M=o(79797),j=o(34583),I=o(13401),F=o(81870),B=o(40071),N=o(79131),D=o(68894),L=o(78140),A=o(28992),E=o(32163),Z=o(40721),H=o(72495),z=o(34574),G=o(85893);const K=(0,h.defineMessages)({filterPlaceholder:{id:"collectionPicker.searchBarFilter.text",defaultMessage:"Filterâ¦"}});class U extends i.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:R.Z,templateInputStore:b.Z},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTemplateFilterChange=e=>function(e,t){t.setState({...t.state,inputValue:e.currentTarget.value})}(e,this.stores.templateInputStore),this.renderMenuList=(e,t,o)=>{var i;const{device:n}=this.environment,{canConfigureCollection:s,isOverlay:l}=this.props,{templateInputStore:a}=this.stores,c={key:"create-template",render:(e,t)=>(0,G.jsx)(q,{isOverlay:this.props.isOverlay,locked:this.props.locked,props:e}),action:this.handleNewCollectionTemplateClick},d=null===(i=this.context.collectionContextStore)||void 0===i?void 0:i.defaultPageTemplateStore.state,u={key:"empty",render:(t,o)=>{if(0!==e.length&&""===a.state.inputValue)return(0,G.jsx)(B.Z,{...this.props,templateStore:void 0,isMobile:this.environment.device.isMobile,locked:this.props.locked||!s,draggable:!0,isDefault:void 0===(null==d?void 0:d.id),onCancelClick:this.props.onCancelClick,...t})},action:this.handleEmptyPageContinueClick};return(0,G.jsx)(E.Z,{type:E.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:this.handleEmptyEnter,sections:p.oA([0!==e.length&&{key:"templates",render:t=>{const i=t.children.slice(0,t.children.length-1),s=t.children[t.children.length-1];return(0,G.jsx)(H.Z,{...t,disableDesktopPadding:!this.props.isOverlay,disableMobileBorders:!0,children:(0,G.jsxs)(r.Fragment,{children:[n.isMobile||this.props.locked||!this.props.canConfigureCollection?i.map(((e,t)=>i[t])):(0,G.jsx)(N.ZP,{direction:"vertical",keys:e,disabled:!o,renderKey:(t,o)=>i[e.indexOf(t)],onDrop:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCollectionTemplatesReorder}),s]})})},items:[...t.map((e=>this.renderCollectionTemplatePageMenuItem(e,o))),u]},s?{key:"create-template",render:e=>(0,G.jsx)(H.Z,{topBorder:l,disableDesktopPadding:!l,disableMobileBorders:!0,...e}),items:[c]}:void 0])})},this.renderCollectionTemplatePageMenuItem=(e,t)=>{var o;const{device:i}=this.environment,{collectionStore:n,canConfigureCollection:s,locked:l}=this.props,a=null===(o=this.context.collectionContextStore)||void 0===o?void 0:o.defaultPageTemplateStore.state,c=M.Mz.fromBlockStore(e),d=null!=c&&c.isActive()?c.getRecurrence():void 0;return{key:e.id,render:o=>(0,r.createElement)(B.Z,{...o,key:e.id,isOverlay:this.props.isOverlay,collectionStore:n,canConfigureCollection:s,templateStore:e,isMobile:i.isMobile,locked:l,onCancelClick:this.props.onCancelClick,draggable:t,isDefault:(null==a?void 0:a.id)===e.id,recurrence:d}),action:t=>{j.M_(this.environment)&&this.props.onTemplateClick({templateStore:e,isKeyboard:"keydown"===t.event.type,useCrdt:(0,x.SL)({event:t.event,source:"collection_instantiate_template",contextualDefault:e.useCrdt()})})}}},this.handleEmptyPageContinueClick=e=>{const{collectionContextStore:t}=this.context;j.M_(this.environment)&&(this.props.onEmptyPageClick(),m.rN(this.environment,{template_name:"empty",is_keyboard:"keydown"===e.event.type,...t&&(0,k.Pn)(t)}))},this.handleEmptyEnter=()=>{const{collectionStore:e}=this.props;var t;j.M_(this.environment)&&(this.props.onEmptyEnter(),m.rN(this.environment,{template_name:"empty",is_keyboard:!0,collection_id:e.id,collection_view_id:null===(t=this.context.collectionContextStore)||void 0===t||null===(t=t.collectionViewStore())||void 0===t?void 0:t.id}))},this.handleNewCollectionTemplateClick=e=>{var t,o;const{collectionStore:r}=this.props,{templateInputStore:i}=this.stores;if(j.M_(this.environment)){var n;const{performResult:t}=C.createAndCommit({userAction:"CollectionTemplatePicker.newPage",environment:this.environment,perform:t=>S.nx({environment:this.environment,collectionStore:r,transaction:t,title:i?i.state.inputValue:void 0,useCrdt:(0,x.SL)({event:e.event,source:"collection_instantiate_template"})})});t&&this.navigateToBlock(t),m.dZ(this.environment,{collection_id:r.id,collection_view_id:null===(n=this.context.collectionContextStore)||void 0===n||null===(n=n.collectionViewStore())||void 0===n?void 0:n.id})}null===(t=(o=this.props).onCancelClick)||void 0===t||t.call(o)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCollectionTemplatesReorder=e=>function(e,t,o,r){r.unsetFocus(),C.createAndCommit({userAction:"CollectionTemplatePicker.handleCollectionTemplatesReorder",environment:t,perform:t=>S.$p({collectionStore:o,newTemplateIds:e,transaction:t})})}(e,this.environment,this.props.collectionStore,this.stores.menuListStore)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):g.c4({environment:this.environment,url:e})}renderComponent(){const{device:e}=this.environment,{collectionStore:t,isOverlay:o}=this.props;let r=t.getTemplatePageStores();const{templateInputStore:i}=this.stores;if(!r.every((e=>e.isReady())))return;r=r.filter((e=>e.getAlive()));const n=r.map((e=>e.id));let s=this.renderMenuList(n,r,!0);const l=this.renderInputHeader();if(o){let t;t=e.isMobile?{menuType:V.og.Modal,title:(0,G.jsx)(h.FormattedMessage,{defaultMessage:"Database templates",id:"database.mobileTemplatesMenu.title"}),left:(0,G.jsx)(Z.CancelMenuText,{}),onClickLeft:this.props.onCancelClick}:{menuType:V.og.Popup,width:360};let o=r,a=n;return n.length>6&&i.state.inputValue&&(o=(0,c.ZP)(i.state.inputValue,r,(e=>String(e.getProperties().title)??"")),a=o.map((e=>e.id)),s=this.renderMenuList(a,o,!1)),(0,G.jsxs)(L.Z,{...t,header:(0,G.jsx)($,{collectionStore:this.props.collectionStore}),children:[0===n.length&&(0,G.jsx)(H.Z,{children:(0,G.jsx)("div",{style:{fontSize:14,padding:e.isMobile?"12px 16px":"0 14px 3px 14px",color:this.theme.lightTextColor,wordBreak:"keep-all",...e.isMobile&&{background:this.theme.contentBackground,boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,marginBottom:1}},children:(0,G.jsx)(h.FormattedMessage,{defaultMessage:"Replicate page formats inside this database with templates.",id:"database.emptyTemplatesList.info"})})}),n.length>6?l:void 0,s]})}return s}renderInputHeader(){const{device:e}=this.environment,t=!e.isMobile||void 0;return(0,G.jsx)("div",{style:{margin:e.isMobile?0:"10px 0"},children:(0,G.jsx)(D.ZP,{value:this.stores.templateInputStore.state.inputValue,focusInitial:t,placeholder:T.default.formatMessage(K.filterPlaceholder),showClearButton:!0,inputLeft:(0,G.jsx)(D.f_,{icon:u.R}),onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTemplateFilterChange,style:{...e.isAndroid&&{borderBottom:"none"}}})})}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=P.default.state,o=t?(0,_.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:a.tY.Create}):(0,_.ZP)({store:e,fullyQualified:!1,pageVisitSource:a.tY.Create});this.navigate(o)}}U.displayName="CollectionTemplatePicker",U.contextTypes={...y.wK,...i.w,...v.xm};const W=U;function $(e){let{collectionStore:t}=e;window.__c={n:"Title"};const o=(0,n.O7)(),r=(0,s.VK)((()=>t.getNameStore().getValue()),[t]);if(o.device.isMobile)return null;const i=r?(0,G.jsx)(G.Fragment,{children:(0,w.Xh)(r,t)}):(0,G.jsx)(h.FormattedMessage,{defaultMessage:"Untitled",id:"database.templateList.UntitledDatabaseTitle"});return(0,G.jsx)(A.Z,{style:{marginTop:6},title:(0,G.jsx)(f.Q,{prefix:(0,G.jsx)(h.FormattedMessage,{id:"database.templatesList.templatesFor",defaultMessage:"Templates for"}),viewName:i}),right:(0,G.jsx)(F.Z,{helpButtonContext:"collection_templates_menu",href:(0,O.UY)("guides.databaseTemplates")})})}function q(e){let{props:t,isOverlay:o,locked:r}=e;window.__c={n:"NewButtonMenuItemComponent"};const i=(0,l.Fg)(),s=(0,n.O7)(),a=(0,G.jsx)(h.FormattedMessage,{defaultMessage:"New template",id:"database.templateView.newTemplateButton"});return o?(0,G.jsx)(I.Z,{isBlue:s.device.isDesktop,title:a,...t}):(0,G.jsx)(z.Z,{title:a,icon:(0,d.R)({width:18,fill:i.lightIconColor,marginLeft:1,marginRight:11}),type:"new_template",format:o?"collection-overlay":"page-menu-item",locked:r,...t})}},75387:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>bg,FULL_SCREEN_PADDING_BOTTOM:()=>fg,default:()=>wg});o(21703);var r=o(30120),i=o(67294),n=o(73935),s=o(83355),l=o(1302),a=o(6740),c=o(86628),d=o(49085),u=o(15145),p=o(92996),h=o(3865),m=o(42509),S=o(65422),g=o(49019),C=o(21197),f=o(45238),v=o(85893);const y=(0,f.I)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,v.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})});var x=o(58810),b=o(75071),w=o(94110),k=o(15157),_=o(72126),T=o(44615),V=o(21202),O=o(13493),P=o(12139),R=o(82990),M=o(51454),j=o(9291),I=o(36610),F=o(8406),B=o(32441),N=o(54642),D=o(26797),L=o(54569),A=o(5149),E=o(98834),Z=o(32603),H=o(99553),z=o(52989),G=o(8055),K=o(61045),U=o(87531),W=o(24677),$=o(36821),q=o(98104),Q=o(82530),Y=o(91851),X=o(40663),J=o(7801),ee=o(34464),te=o(97372),oe=o(480),re=o(24405),ie=o(14714),ne=o(75754),se=o(26999),le=o(10906),ae=o(37989),ce=o(56666),de=o(47453),ue=o(952),pe=o(75330),he=o(75079),me=o(12534),Se=o(77546),ge=o(79797),Ce=o(34583),fe=(o(57658),o(99036)),ve=o(8848),ye=o(45453),xe=o(9056),be=o(37612),we=o(47307),ke=o(92918),_e=o(87279),Te=o(93405),Ve=o(78140),Oe=o(32163),Pe=o(40721),Re=o(72495),Me=o(9050);const je="color";const Ie=function(e){let{parent:t,groupFormat:o,collectionContextStore:r,groupsFormatKey:n,currentGroups:s,groupsLimitStore:l,schema:a}=e;window.__c={n:"CollectionGroupActionMenu"};const d=(0,oe.O7)(),u=(0,j.useIntl)(),{device:p}=d,h=(0,c.VK)((()=>_.oA([De(d,o,r,n,s,l,u),Be(d,a,o,r)])),[d,o,r,n,s,l,u,a]),m=(0,i.useCallback)((e=>{"string"==typeof e.key&&e.key.includes(je)||t.close()}),[t]);let S;return S=p.isMobile?{menuType:_e.og.Modal,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,v.jsx)(Pe.DoneMenuText,{}),onClickRight:t.close}:{menuType:_e.og.Popup},(0,v.jsx)(Ve.Z,{...S,children:(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:h,onAccept:m})})};function Fe(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function Be(e,t,o,r){const i=o.value;if(void 0===i.value)return;const n=t[o.property];if(!n)return;if("select"!==n.type&&"multi_select"!==n.type)return;if(i.type!==n.type)return;const s=(n.options||[]).find((e=>e.value===i.value));if(!s)return;const l=ve.AP.map((i=>{const n={key:`${je}_${i}`,render:e=>(0,v.jsx)(Me.Z,{...e,color:i,checkState:s.color===i}),action:()=>{!function(e,t,o,r,i){const n=r[o.property];if(!n)return;if(!fe.cu(n))return;const s=i.collectionStore();if(!s)return;const l=o.value;if(l.type!==n.type)return;const a=(n.options||[]).map((t=>t.value===l.value?{...t,color:e}:t)),c={...n,options:a},d={...r,[o.property]:c};Q.createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,perform:e=>{pe.Rm({environment:t,collectionStore:s,update:{schema:d},transaction:e})}}),I.wd(t,{view_type:Fe(i),action:"group_change_color"})}(i,e,o,t,r)}};return n}));return{key:"collection color section",render:e=>(0,v.jsx)(Re.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:l}}function Ne(e,t,o,r,i,n){we.showDialog({message:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>async function(e,t,o,r,i,n){const s=t.collectionStore();if(!s)return;const l=r.value;if("relation"===l.type&&(0,ie.RA)(l.value)){const e=ge.G.createChildStore(s,{id:l.value.id,table:V.iU});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}Q.createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,perform:l=>{L.iE({environment:e,collectionStore:s,property:r.property,groupFormat:r,currentGroups:o,groupsFormatKey:i,collectionContextStore:t,transaction:l,intl:n})}}),I.wd(e,{view_type:Fe(t),action:"delete_group"})}(e,t,o,r,i,n)}]})}function De(e,t,o,r,i,n,s){const l=[],a=t.value,c=o.permissionScopes.state;(0,ie.eF)(t)?l.push({key:"show",render:e=>(0,v.jsx)(Te.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Show",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:xe.g}),action:()=>function(e,t,o,r,i,n){const s={...t,hidden:!1},l=(0,ke.nr)(i,s,n.state);Q.createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,perform:e=>{L.A6({collectionContextStore:o,newGroups:l,groupsFormatKey:r,transaction:e})}}),I.wd(e,{view_type:Fe(o),action:"show_group"})}(e,t,o,r,i,n)}):l.push({key:"hide",render:e=>(0,v.jsx)(Te.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Hide",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:ye.p}),action:()=>function(e,t,o,r,i){const n={...t,hidden:!0},s=(0,ke.ar)(i,n);Q.createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,perform:e=>{L.A6({collectionContextStore:o,newGroups:s,groupsFormatKey:r,transaction:e})}}),I.wd(e,{view_type:Fe(o),action:"hide_group"})}(e,t,o,r,i)}),void 0!==a.value&&c.canEditContent&&!c.isSyncedCollection&&"collectionTypedView"!==o.contextType&&l.push({key:"delete",render:e=>(0,v.jsx)(Te.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:be.y}),action:()=>Ne(e,o,i,t,r,s)});return{key:"collection group",render:e=>(0,v.jsx)(Re.Z,{...e}),items:l}}var Le=o(2032),Ae=o(14248),Ee=o(42875),Ze=o(47853),He=o(16187),ze=o(33929),Ge=o(98742),Ke=o(75498),Ue=o(68785);function We(e,t){const{calculating:o,aggregation:r}=e.asyncAggregationStatus.state;return r?o&&(0,_.Xy)(t,r):o}function $e(e){let{collectionContextStore:t,aggregation:o,children:r}=e;window.__c={n:"AggregationCalculatingIndicator"};const{isCalculating:n,changingType:s}=(0,c.VK)((()=>({isCalculating:We(t,o),changingType:t.asyncAggregationStatus.state.changingType})),[t,o]),l=function(e,t){const o=(0,i.useRef)(e);return(0,i.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(r,n);return n?s?(0,v.jsx)(Ue.Z,{}):(0,v.jsx)("span",{style:{opacity:.5},children:l??r}):(0,v.jsx)(v.Fragment,{children:r})}const qe=(0,j.defineMessages)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculatingâ¦)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculatingâ¦)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculatingâ¦"}});var Qe=o(52275),Ye=o(31945),Xe=o(89728),Je=o(53437),et=o(26388),tt=o(42782);class ot extends s.Z{constructor(){super(...arguments),this.aggregationStore=this.createComputedStore((()=>{const{format:e,groupAggregationKey:t}=this.props;return e[t]||{aggregator:"count"}}),!0),this.reducerStore=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.aggregationStore.state;return{type:"aggregation",filter:(0,Ae.zk)({schema:e,group:t,propertyMapping:void 0,timeZone:(0,Ee.r)()}),aggregation:o}}))}renderComponent(){const{device:e}=this.environment;return(0,v.jsx)(et.ZP,{renderTooltip:()=>this.renderTooltipText(),render:t=>(0,v.jsx)(Ye.ZP,{popupType:e.isMobile?Ye.Z4.SlideUp:Ye.Z4.Popup,renderOrigin:e=>(0,v.jsx)(Xe.Z,{disabled:this.props.disabled,style:{fontWeight:R.Z.fontWeight.medium,color:this.theme.lightTextColor,height:24},...(0,Ge.Z)((0,Ge.Z)(t,e),{onClick:me.Wi}),children:this.renderValue()}),disabled:this.props.disabled,render:e=>(0,v.jsx)(ct,{parent:e,collectionContextStore:this.props.collectionContextStore,format:this.props.format,groupAggregationKey:this.props.groupAggregationKey,schema:this.props.schema})})})}renderValue(){const{schema:e,collectionContextStore:t,groupFormat:o}=this.props,r=this.aggregationStore.state,i=this.reducerStore.state;if(i)return(0,v.jsx)(Ke.Z,{id:`group_aggregation:${(0,ie.mD)(o)}`,collectionContextStore:t,reducer:i,groupsPointer:[o],render:o=>{const i=o.state;let n;if((0,Le.pK)(r)){const t=e[r.property];!t||"formula"!==t.type&&"number"!==t.type||(n=t.number_format)}return(0,v.jsx)($e,{aggregation:r,collectionContextStore:t,children:i?(0,He.Ol)({numberFormat:n,dateFormat:void 0,aggregationType:r.aggregator,userTimeZone:(0,Ee.r)(),value:i.aggregationResult,roundDecimal:5}):"-"})}})}renderTooltipText(){const{schema:e,collectionContextStore:t}=this.props,o=this.aggregationStore.state,r=He.VN[(0,Le.OV)(o)],i=We(t,o);if((0,Le.pK)(o)){const t=e[o.property];if(t){const e=t.name;return ze.default.formatMessage(qe.propertyAggregation,{aggregationType:r,propertyName:e,calculating:i})}}return ze.default.formatMessage(qe.aggregationType,{aggregationType:r,calculating:i})}}function rt(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function it(e){let{aggregationType:t,label:o,props:r}=e;const i=He.Sn[t];return(0,v.jsx)(et.ZP,{placement:Je.GI.Placement.Right,delayThreshold:0,render:e=>(0,v.jsx)(Qe.Z,{title:o,...(0,Ge.Z)(e,r)}),renderTooltip:()=>(0,v.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,v.jsx)("img",{src:(0,Ze.D)(i),style:{borderRadius:4,width:140,marginTop:4}}),He.BG[t]]})},r.key)}function nt(e,t,o,r,i){const n=o.collectionViewStore();n&&(o.isLoading.state||o.loadingDetails.setState({type:"load_aggregation"}),o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:e,changingType:!0}),Q.createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,perform:t=>{pe.iG({collectionViewStore:n,update:{format:{...r,[i]:e}},transaction:t})}})),I.wd(t,{view_type:rt(o),action:"change_aggregation"})}function st(e,t,o,r,i){const n=He.VN[e];return{key:e,render:t=>(0,v.jsx)(it,{aggregationType:e,label:n,props:t}),action:()=>{nt({aggregator:e},t,o,r,i)}}}function lt(e,t,o,r,i,n,s){const{device:l}=o,a=He.VN[e],c=_.oA(t.map((t=>function(e,t,o,r,i,n,s){const l=r[e];if(!l)return;const a=l.name;return{key:`${e} ${t}`,render:e=>(0,v.jsx)(it,{aggregationType:t,label:a,props:e}),action:()=>{nt({aggregator:t,property:e},o,i,n,s)}}}(t,e,o,r,i,n,s))));return{key:e+a,render:(e,t)=>(0,v.jsx)(tt.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,v.jsx)(Qe.Z,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let r;return r=l.isMobile?{menuType:_e.og.Modal,title:a,right:l.isPhone?(0,v.jsx)(Pe.DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:_e.og.Popup,width:200,...e},(0,v.jsx)(Ve.Z,{...r,children:(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,v.jsx)(Re.Z,{...e}),items:c}],onAccept:t.onAccept})})}}),action:()=>null}}function at(e,t,o,r,i){const n=[];for(const d of Le.o5)n.push(st(d,e,t,o,r));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(s.length>0)for(const d of Le.Sy)"show_unique"!==d&&n.push(lt(d,s,e,i,t,o,r));const l=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.O4)(o)}))}(i);if(l.length>0)for(const d of Le.k$)n.push(lt(d,l,e,i,t,o,r));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.dN)(o)}))}(i);if(a.length>0)for(const d of Le.f8)n.push(lt(d,a,e,i,t,o,r));const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.Mv)(o)}))}(i);if(c.length>0)for(const d of Le.gC)n.push(lt(d,c,e,i,t,o,r));return n}function ct(e){let{parent:t,collectionContextStore:o,format:r,groupAggregationKey:i,schema:n}=e;window.__c={n:"MenuComponent"};const s=(0,oe.O7)(),{device:l}=s;let a;return a=l.isMobile?{menuType:_e.og.Modal,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,v.jsx)(Pe.DoneMenuText,{}),onClickRight:t.close}:{menuType:_e.og.Popup,width:200},(0,v.jsx)(Ve.Z,{...a,children:(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,v.jsx)(Re.Z,{...e}),items:at(s,o,r,i,n)}],onAccept:t.close})})}ot.displayName="CollectionGroupAggregation";var dt=o(26055),ut=o(97880),pt=o(61931),ht=function(e){return e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.IGNORE=2]="IGNORE",e}(ht||{});const mt=ht;var St=o(34859),gt=o(45589),Ct=o(53336);const ft=function(e){return e?mt.IGNORE:mt.Top};function vt(e){window.__c={n:"CollectionCompactViewScroller"};const{style:t,children:o}=e,r=(0,c.qz)(void 0,gt.Z),i=(0,c.VK)((()=>0===r.state.scrollTop),[r]),n=(0,re.yK)((()=>({scroller:{height:"100%",...i?{}:{maskImage:pt.Wx,WebkitMaskImage:pt.Wx},...t}})),[i,t]);return(0,v.jsx)(Ct.Z,{store:r,type:St.Z.Y,style:n.scroller,children:o})}var yt=o(45697),xt=o.n(yt),bt=o(55010),wt=o(4926);function kt(e){const{element:t,container:o}=e,r=function(e){for(;;){const t=Ot(e);if(!t)return e;e=t}}(o),{store:i}=r.stores,{containerMap:n}=i.state,s=n.get(o);s?s.add(t):n.set(o,new Set([t])),i.emit()}function _t(e,t,o,r){return e<-r||e>t?0:e>=t-o-1?t-o+r-1:e+r}function Tt(e,t,o,r){return e-r<0||e>t?0:e<o?o-t:e-t}function Vt(e){const t=[];for(;;){const o=Ot(e);if(!o)break;e=o,t.push(e)}return t}function Ot(e){if(e.context.computedStickyContainer&&!e.props.ignoreAncestorContainer)return e.context.computedStickyContainer}function Pt(e,t){for(const o in t)e.style[o]=t[o]||""}o(95477);class Rt extends s.Z{constructor(){super(...arguments),this.element=void 0}didMount(){const{computedStickyContainer:e}=this.context;e&&kt({element:this,container:e});const t=n.findDOMNode(this);if(t){this.element=t;const e=this.props.getComputedStyle?this.props.getComputedStyle(!1):void 0;e&&Pt(t,e)}}willUnmount(){const{computedStickyContainer:e}=this.context;e&&function(e){const{element:t,container:o}=e,{store:r}=o.stores,{containerMap:i}=r.state,n=i.get(o);n&&n.delete(t),r.emit()}({element:this,container:e}),this.element=void 0}renderComponent(){if(this.props.children)return i.Children.only(this.props.children)}}Rt.displayName="ComputedStickyElement",Rt.contextTypes={computedStickyContainer:xt().any,...s.w};const Mt=Rt;var jt=o(73063),It=o(79954),Ft=o(5210);class Bt extends s.Z{constructor(){super(...arguments),this.handleToggleButtonClick=()=>{const{groupFormat:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);if(!o)return;W.ZH(this.environment);const r=!o.toggleStateStore.state;if(L.uo({environment:this.environment,groupFormat:e,toggleStateStore:o.toggleStateStore,newValue:r,collectionContextStore:t}),!r){const e=n.findDOMNode(this),o=null==e?void 0:e.parentElement;o&&l.default.afterNextFlush((()=>{(0,Se.Oc)({el:o,windowHeight:this.environment.WindowSizeStore.state.height,minEdgeDist:50}),t.renderEmitter.emit()}))}},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:r,groupFormat:i}=this.props,s=n.findDOMNode(this);s&&s instanceof Element&&Q.createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:this.environment,perform:e=>L.BO({environment:this.environment,collectionContextStore:r,groupsPointer:[i],droppedStores:t,duplicate:o,transaction:e})})}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new ge.G(this.environment,{table:V.iU,id:t.id}))}didMount(){var e,t;null===(e=(t=this.props).onMount)||void 0===e||e.call(t)}renderComponent(){var e;const{disabled:t,getComputedStickyStyle:o,groupFormat:r,collectionContextStore:i}=this.props,n=i.groupsStore.getGroupState(r);if(!n)return;const s=n.toggleStateStore.state,l=i.permissionScopes.state,a=i.shouldAllowNewItemCreation(),c=i.isCompactView.state,d=c?"transparent":(null===(e=i.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||void 0;return(0,v.jsx)(Mt,{position:ft(c),getComputedStyle:o,children:(0,v.jsxs)("div",{style:Ht(this.props.isInPeekRenderer,this.theme,d,this.props.style),children:[(0,v.jsx)("div",{style:At(s,this.props.isFullScreen,this.props.isRootChild,this.props.paddingLeft,this.props.paddingTop,this.props.toggleClosedMarginBottom,this.props.height,this.props.stickyLeft),children:(0,v.jsx)("div",{style:{display:"flex",alignItems:"center",position:this.props.stickyLeft?"sticky":void 0,left:this.props.paddingLeft,overflow:"hidden"},children:(0,v.jsxs)(It.Z,{store:this.selectableBlockStore,canDropOnto:!t&&!s,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[r],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},children:[this.renderToggleButton(n.toggleStateStore),(0,v.jsx)(zt,{collectionGroupHeaderProps:this.props}),(0,v.jsx)(Et,{disabled:this.props.disabled,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupFormat:this.props.groupFormat,groupAggregationKey:this.props.groupAggregationKey}),!t&&l.canConfigureBlock&&(0,v.jsx)(Zt,{groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupsFormatKey:this.props.groupsFormatKey,isGroupHoveredStore:this.props.isGroupHoveredStore}),a&&(0,v.jsx)(Gt,{collectionGroupHeaderProps:this.props,isGroupHoveredStore:this.props.isGroupHoveredStore})]})})}),this.props.children]})})}renderToggleButton(e){const t=e.state;return(0,v.jsx)(Ft.Z,{isSidebar:!1,open:t,fill:!0,onClick:this.handleToggleButtonClick,onMouseDown:me.$0,style:{flexShrink:0}})}}Bt.displayName="CollectionGroupHeader";const Nt=Bt;function Dt(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function Lt(e){return e||33}function At(e,t,o,r,i,n,s,l){return{display:"flex",alignItems:"center",height:Lt(s),paddingTop:i,...l&&{position:"sticky",left:t||o?r:0},...!e&&{marginBottom:n}}}function Et(e){let{disabled:t,format:o,schema:r,collectionContextStore:i,groupFormat:n,groupAggregationKey:s}=e;window.__c={n:"Aggregation"};const l=(0,c.VK)((()=>i.permissionScopes.state.canConfigureBlock),[i]);return(0,v.jsx)(ot,{groupFormat:n,disabled:t||!l,groupAggregationKey:s,format:o,schema:r,collectionContextStore:i})}function Zt(e){let{groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:s,isGroupHoveredStore:l}=e;window.__c={n:"ActionButtonComponent"};const a=(0,oe.Fy)(),d=(0,c.VK)((()=>n.groupsLimit),[n]),u=(0,c.VK)((()=>l.state),[l]),[p,h]=(0,ae.Z)(),m=(0,re.yK)((()=>({button:{transition:a.isMobile?void 0:"opacity 100ms ease-in-out",opacity:a.isMobile?void 0:u||h?1:0}})),[a.isMobile,h,u]);return(0,v.jsx)(Ye.ZP,{popupType:a.isMobile?Ye.Z4.SlideUp:Ye.Z4.Popup,renderOrigin:e=>(0,v.jsx)(jt.Z,{ref:p,icon:ce.o,style:m.button,...e}),onClick:me.Wi,render:e=>(0,v.jsx)(Ie,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:s,groupsLimitStore:d})})}function Ht(e,t,o,r){const i=e?t.cardContentBackground:t.contentBackground;return{position:"relative",zIndex:M.sL+2,width:"100%",background:void 0===o?i:o,fontSize:14,...r}}function zt(e){let{collectionGroupHeaderProps:t}=e;window.__c={n:"ValueComponent"};const o=(0,oe.O7)(),{groupFormat:r,schema:i,disabled:n,currentGroups:s,groupBy:l,collectionContextStore:a}=t,d=(0,c.VK)((()=>a.permissionScopes.state),[a]);return(0,v.jsx)(dt.Z,{groupBy:l,groupFormat:r,currentGroups:s,schema:i,disabled:n||!d.canConfigureCollection||d.isSyncedCollection,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:r}=o,i=r.collectionStore();i&&(L.w$({...e,environment:t,collectionStore:i,...o}),I.wd(t,{view_type:Dt(r),action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:a})}function Gt(e){let{collectionGroupHeaderProps:t,isGroupHoveredStore:o}=e;window.__c={n:"AddButtonComponent"};const r=(0,oe.Fy)(),i=(0,oe.O7)(),n=(0,c.VK)((()=>o.state),[o]),[s,l]=(0,ae.Z)(),a=(0,re.yK)((()=>({button:{transition:r.isMobile?void 0:"opacity 100ms ease-in-out",opacity:r.isMobile?void 0:n||l?1:0}})),[r.isMobile,l,n]);return(0,v.jsx)(et.ZP,{renderTooltip:()=>(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,v.jsx)(jt.Z,{ref:s,icon:de.R,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:r,isFullScreen:i,onGroupHeaderAddItem:n}=t;r.groupsStore.getGroupState(o)&&Ce.M_(e)&&(r.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:i}),Q.createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,perform:i=>{const s=L.IW({environment:e,collectionContextStore:r,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"group_header"});s&&(n(s.newStore,s.coercionSucceeded,t),ue.W(e,{from:"group_add_item_top",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,he.Pn)(r)}))}}))}(i,t),style:a.button,...e})})}var Kt=o(80951),Ut=o(97004);function Wt(e){const{collectionContextStore:t,groupsPointer:o,hasPartialResults:r}=e,i=t.shouldShowSpinner.state,n="load_general"===t.loadingDetails.state.type&&!r||"load_more_blocks"===t.loadingDetails.state.type&&_.Xy(t.loadingDetails.state.group,o);return i&&n}function $t(e){const{collectionContextStore:t,displayState:o}=e;return t.shouldShowSpinner.state&&0===o.visibleGroups.length}function qt(e){const{collectionContextStore:t,isForColumnGroups:o}=e,r=o?"load_more_columns":"load_more_groups";return t.isLoading.state&&t.loadingDetails.state.type===r}function Qt(e){const{collectionContextStore:t,groupsPointer:o}=e;return t.shouldShowSpinner.state&&"load_more_blocks"===t.loadingDetails.state.type&&_.Xy(t.loadingDetails.state.group,o)}var Yt=o(77080),Xt=o(4615),Jt=o(62965),eo=o(61766),to=o(70203);function oo(e){var t;const{transaction:o,environment:r,collectionContextStore:i,isFullScreen:n,groupsPointer:s,insertAtIndex:l,from:a,transient:c,useCrdt:d}=e,p=null===(t=i.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore;if(!p)return;i.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:i,isFullScreen:n});const h=L.IW({environment:r,collectionContextStore:i,groupsPointer:s,insertAtIndex:l,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:a,useCrdt:d});if(!h)return;const m=h.coercionSucceeded,S=h.newStore;if(r.device.isMobile)ne._({environment:r,store:S,pageVisitSource:u.tY.Create});else if(m){const e=S.getBlockTitleStore();W.eP({environment:r,store:S}),q.NX({store:e}),pe.Z5({store:S,transient:c})}else se.CH({environment:r,store:S,peekMode:(0,le.kr)(i.collectionViewStore()),resultsStore:p,collectionContextStore:i,pageVisitSource:u.tY.Create});ue.W(r,{from:a,type:"page",new_page_id:S.id,creating_block_id:S.id,...(0,he.Pn)(i)})}var ro=o(43250),io=o(65183),no=o(77556),so=o(27105);const lo=function(e){let{shouldShowSpinner:t,color:o,collectionContextStore:r,isFullScreen:i,groupsPointer:n}=e;window.__c={n:"BoardGroupAddItemButton"};const s=(0,re.Fg)(),l=(0,oe.O7)(),a=s.lightTextColor;return(0,v.jsxs)(Xe.Z,{icon:e=>(0,de.R)({...e,fill:o||a}),isLightGray:!0,isLarge:!0,style:{width:"100%",color:o||a},onClick:e=>function(e,t,o,r,i){if("collectionTypedView"===e.contextType)return;if(!Ce.M_(r)||!e.collectionStore())return;Q.createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:r,perform:n=>{oo({transaction:n,environment:r,collectionContextStore:e,isFullScreen:t,groupsPointer:o,from:"board_group_add_item_bottom",transient:!1,useCrdt:i})}})}(r,i,n,l,(0,so.SL)({event:e,source:"collection_non_table_view"})),onMouseDown:me.$0,children:[(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.boardView.addItemButtonTitle"}),t&&(0,v.jsx)("div",{style:{margin:"0 0 0 auto"},children:(0,v.jsx)(Ue.Z,{style:{width:12,height:12}})})]})};var ao=o(6695),co=o(25651),uo=o(95855),po=o(54497),ho=o(6404),mo=o(51365),So=o(96802),go=o(9953),Co=o(87636),fo=o(10912),vo=o(97039),yo=o(78030),xo=o(65089),bo=o(44831),wo=o(41137),ko=o(64921),_o=o(3386),To=o(84076),Vo=o(31278),Oo=o(33742),Po=o(65187),Ro=o(56282),Mo=o(95645),jo=o(28651),Io=o(49616),Fo=o(77181),Bo=o(84210),No=o(68056),Do=o(65598),Lo=o(80444),Ao=o(19511),Eo=o(96049),Zo=o(22294),Ho=o(88923),zo=o(27724),Go=o(24666);const Ko=(0,j.defineMessages)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a nameâ¦",id:"collectionViewCardItem.itemName.placeholder"}});class Uo extends Mo.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={mouseStore:jo.Z,editModeStore:d.default},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:r,handleRepositionClick:i,handleSavePositionClick:n}=e;const{store:s,coverFormat:l,coverAspectFormat:a,collectionContextStore:c}=this.props,{device:d}=this.environment,{isMobile:u}=d,p=this.lastProxiedUrl&&l&&"contain"!==a,h=c.permissionScopes.state,m=s.canEdit()&&("collectionTypedView"===c.contextType||h.canEditContent);if(t&&!this.shouldShowActionButton.state)return;const S=Ho.default.state.open&&Ho.default.state.target.id===s.id,g=le.kr(null==c?void 0:c.collectionViewStore()),C=(0,Io.X9)(g,!1);return(0,v.jsxs)(Co.Z,{isVisible:t,position:"top",children:[p&&!o&&!u&&(0,v.jsx)(ko.Z,{style:Oo.ar,onClick:e=>i(e,this.lastProxiedUrl),children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),p&&o&&!u&&(0,v.jsx)(ko.Z,{style:Oo.ar,onClick:n,children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),p&&o&&!u&&(0,v.jsx)(ko.Z,{style:Oo.ar,onClick:r,children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),this.shouldShowEditButton.state&&m&&!this.normalizedCardSelectionStore.state&&!h.isSyncedCollection&&(0,v.jsx)(et.ZP,{renderTooltip:()=>(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:e=>(0,v.jsx)(ko.Z,{style:Oo.ar,onClick:()=>{cr(this.environment,this.props.store,this.props.collectionContextStore,this.stores.editModeStore,"click")},...e,children:(0,co.R)({width:16,height:16})})}),this.normalizedCardSelectionStore.state&&!S&&(0,v.jsx)(et.ZP,{renderTooltip:()=>C.tooltip,render:e=>(0,v.jsx)(ko.Z,{style:Oo.ar,onClick:()=>{this.peekUrl.state&&(G.c4({environment:this.environment,url:this.peekUrl.state}),ur(this.stores.editModeStore))},...e,children:C.icon({width:14,height:14})})}),!o&&(0,v.jsx)(et.ZP,{renderTooltip:()=>(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Rename, delete, move to and moreâ¦",id:"collectionViewCardItem.repositionAction.tooltip"}),render:e=>(0,v.jsx)(ko.Z,{style:Oo.ar,onClick:e=>function(e,t,o,r){W.Ys({environment:t,store:r}),ho.Qn({environment:t,stores:zo.default.state.stores,left:e.clientX,top:e.clientY,showInput:!0,actionSectionGroupKey:"default",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:o}})}(e,this.environment,this.props.collectionContextStore,this.props.store),...e,children:(0,ce.o)({width:14,height:14})})})]})},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:r,collectionContextStore:i}=this.props,n=t.getAssociatedCollectionStore();if(!n)return;const s=this.normalizedCardSelectionStore.state,l="gallery"===er(this.props.collectionContextStore)?yo.C.GalleryView:yo.C.Board,a=Boolean(i.normalizedFormatStore.state.table_wrap);return(0,v.jsx)(vo.Z,{store:t,property:e.property,disabled:o||!t.canEdit(),locked:i.permissionScopes.state.isLocked,format:l,tableWrap:a||Boolean(e.wrap),blockPropertyValueOverlayStore:r,collectionStore:n,showIfEmpty:s,onEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyEsc,onEsc:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyEsc,onBgClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyEsc,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e.property)},this.renderFooterIcons=()=>{const{store:e}=this.props,t=Do.Xp(e,{recursivelyLoadAllDiscussions:!1}),o=function(e,t){return(0,Fo.wI)({collectionContextStore:e,blockStore:t})}(this.props.collectionContextStore,this.props.store),r=t>0;var i;if(r||o)return(0,v.jsxs)("div",{style:this.getFooterIconsContainerStyle(),children:[r&&(0,v.jsxs)("div",{style:(i=this.theme,{display:"flex",alignItems:"center",color:i.lightTextColor,fill:i.lightTextColor,fontWeight:R.Z.fontWeight.medium,fontSize:12,paddingRight:10}),children:[(0,uo.z)({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t]}),o&&(0,v.jsx)("div",{style:ar(this.theme),children:(0,v.jsx)(wo.B,{blockStore:e,collectionContextStore:this.props.collectionContextStore})})]})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockSpace=()=>{return e=this.environment,t=this.props.store,o=this.props.collectionContextStore,r=this.stores.editModeStore,void cr(e,t,o,r,"space");var e,t,o,r},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEditButtonClick=e=>cr(this.environment,this.props.store,this.props.collectionContextStore,this.stores.editModeStore,e),this.handleClick=e=>{this.normalizedCardSelectionStore.state?e.preventDefault():(this.props.handleOpenPeekPage(),ur(this.stores.editModeStore))},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextEnter=()=>function(e,t,o,r,i,n){pe.MO(),q.ZH(e);if(!t.canEdit()||!i.permissionScopes.state.canEditContent)return;"new_empty"===n.state?r(t):"new"===n.state?o(t):W.Ys({environment:e,store:t});ur(n)}(this.environment,this.props.store,this.props.onTextEnter,this.props.onTextEsc,this.props.collectionContextStore,this.stores.editModeStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextEsc=()=>function(e,t,o,r,i){pe.MO();if(!t.canEdit()||!r.permissionScopes.state.canEditContent)return;"new_empty"===i.state?o(t):W.Ys({environment:e,store:t});ur(i)}(this.environment,this.props.store,this.props.onTextEsc,this.props.collectionContextStore,this.stores.editModeStore),this.handleTextTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=this.getShowProperties().map((e=>e.property));o.length>0&&mo.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:o[0],format:yo.C.Page,collectionContextStore:this.props.collectionContextStore}),ur(this.stores.editModeStore)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTrackTitlePropertyEdit=()=>function(e,t,o,r){const i=er(t);if(!i)return;F.rv({environment:e,collectionContextStore:t,block_id:o.id,property:"title",property_type:"text",from:i}),ur(r)}(this.environment,this.props.collectionContextStore,this.props.store,this.stores.editModeStore),this.handleTextUntab=()=>{const e=this.getShowProperties().map((e=>e.property)),t=_.dF(e,((e,t)=>Xo(e,this.props.schema)));t&&mo.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:t,format:yo.C.Page,collectionContextStore:this.props.collectionContextStore}),ur(this.stores.editModeStore)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyEsc=()=>{return e=this.environment,t=this.props.blockPropertyValueOverlayStore,o=this.props.store,r=this.stores.editModeStore,mo.xv({environment:e,blockPropertyValueOverlayStore:t}),W.Ys({environment:e,store:o}),void ur(r);var e,t,o,r},this.handleBlockPropertyTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state,r=this.getShowProperties().map((e=>e.property)),i=o.isOpen?r.findIndex((e=>e===o.property)):-1,n=r.find(((e,t)=>t>i&&Xo(e,this.props.schema)))||r.find(((e,t)=>!this.normalizedCardSelectionStore.state&&Xo(e,this.props.schema)));n?l.default.afterNextFlush((()=>{mo.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:n,format:yo.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&l.default.afterNextFlush((()=>{cr(this.environment,this.props.store,this.props.collectionContextStore,this.stores.editModeStore)})),mo.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),ur(this.stores.editModeStore)},this.handleBlockPropertyUntab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state;if(!o.isOpen)return;const r=this.getShowProperties().map((e=>e.property)),i=r.findIndex((e=>e===o.property)),n=_.dF(r,((e,t)=>t<i&&Xo(e,this.props.schema)))||_.dF(r,((e,t)=>!this.normalizedCardSelectionStore.state&&Xo(e,this.props.schema)));n?l.default.afterNextFlush((()=>{mo.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:n,format:yo.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&l.default.afterNextFlush((()=>{cr(this.environment,this.props.store,this.props.collectionContextStore,this.stores.editModeStore)})),mo.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),ur(this.stores.editModeStore)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=()=>{return e=this.stores.mouseStore,void(Eo.Z.state||e.setState({...e.state,mouseEntered:!0}));var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave=()=>{var e;(e=this.stores.mouseStore).setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=_.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,100),this.handleMouseLeaveDebounced=_.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave,100),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRecordIconChange=e=>async function(e,t,o,r){const i=o.getIconStore();if(i){const{serverCommitResult:o}=Q.createAndCommit({userAction:"PageViewBlock.handleRecordIconChange",environment:t,perform:t=>{go.sO({store:i,value:e,transaction:t})}});await o}ur(r)}(e,this.environment,this.props.store,this.stores.editModeStore),this.tryDeleteEmptyOnBlur=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;"new_empty"!==r.state||this.normalizedCardSelectionStore.state||o.defaultPageTemplateStore.state||(t(e),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur))},this.normalizedCardSelectionStore=this.createComputedStore((()=>{const e=Ao.Z.state;return e.isActive&&e.store===this.props.store})),this.isItemSelectedStore=this.createComputedStore((()=>zo.default.state.stores.includes(this.props.store))),this.shouldShowEditButton=this.createComputedStore((()=>{const e=this.isEditingTitle.state,t=tr(this.props.format,this.props.collectionContextStore),o=this.getShowProperties();return!e&&(this.props.shouldShowTitle||t.length>0&&t.length!==o.length)})),this.isEditingTitle=this.createComputedStore((()=>{var e;const{blockPropertyValueOverlayStore:t}=this.props,o=Go.default.state;return"editing"===o.mode&&(null===(e=(0,No.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,io.JI)(this.props.store)&&!t.state.isOpen})),this.peekUrl=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=Lo.default.state;return le.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.pageUrl=this.createComputedStore((()=>{const{store:e}=this.props;return(0,Bo.ZP)({store:e,fullyQualified:!1,pageVisitSource:u.tY.LinkInPage})})),this.shouldShowActionButton=this.createComputedStore((()=>{const{device:e}=this.environment,{isKeyboardMode:t}=Zo.Z.state;return!e.isMobile&&this.canEdit()&&!t})),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered&&!Eo.Z.state))}activate(){const e=this.peekUrl.state;e&&(this.props.handleOpenPeekPage(),G.c4({environment:this.environment,url:e}))}UNSAFE_willMount(){var e;const{editModeStore:t}=this.stores,o=Go.default.state,r="editing"===o.mode&&(null===(e=(0,No.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,io.JI)(this.props.store),i=Ao.Z.state,n=i.isActive&&i.transient;r&&n?t.setState("new_empty"):r?t.setState("new"):t.setState("existing")}didMount(){const{editModeStore:e}=this.stores;super.didMount(),this.normalizedCardSelectionStore.state&&"new_empty"===e.state&&this.normalizedCardSelectionStore.addListener(this.tryDeleteEmptyOnBlur)}willUnmount(){super.willUnmount(),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur)}renderComponent(){const{device:e}=this.environment,{collectionContextStore:t,store:o,coverFormat:r,coverAspectFormat:n,coverWidth:s,coverHeight:l,coverSizeFormat:a,shouldShowTitle:c,colorStyle:d,onShiftEnter:u}=this.props,p=this.pageUrl.state,h=this.peekUrl.state,m=this.mouseIsEntered.state,S=this.normalizedCardSelectionStore.state,g=er(this.props.collectionContextStore),C=(0,i.createRef)(),f=(0,v.jsxs)(To.Z,{ref:C,style:{...rr(d,t,this.theme),position:m?"relative":"static",..."gallery"===g&&{height:"100%"}},innerStyle:{userSelect:S?void 0:"none",WebkitUserSelect:S?void 0:"none",height:"100%",..."board"===g&&{minHeight:40},..."gallery"===g&&{display:"flex",flexDirection:"column"}},hoveredStyle:S?{background:or(d,t,this.theme)}:ir(d,t,this.theme),pressedStyle:S?{background:or(d,t,this.theme)}:nr(d,t,this.theme),href:p,metaHref:e.isMobile?p:h,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,onClick:this.handleClick,children:[(0,v.jsx)(Ro.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:e=>function(e,t,o){const{imagePosition:r,reset:i}=e;Q.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:t,perform:e=>{So.bf({store:o,coverPosition:r,transaction:e}),i()}})}(e,this.environment,this.props.store),source:g,small:"small"===a,store:this.props.store,renderControl:this.renderControl,render:e=>{let{imagePosition:t}=e;return r&&(0,v.jsx)(fo.Z,{variant:"gallery",store:o,coverWidth:s,coverHeight:l,coverFormat:r,coverAspectFormat:n,coverSizeFormat:a,coverPosition:t,showEmptyGalleryCover:"gallery"===g,onLoadProxiedImage:e=>{this.lastProxiedUrl=e}})}}),dr(this.props.collectionContextStore,this.props.store)&&(0,v.jsx)("div",{style:{paddingRight:4,paddingLeft:8,paddingTop:8,paddingBottom:0,maxWidth:"100%"},children:(0,v.jsx)(bo.O,{blockStore:o,collectionContextStore:this.props.collectionContextStore})}),c&&this.renderTitle(),this.renderProperties(),this.renderFooterIcons()]}),y=this.isItemSelectedStore.state;return(0,v.jsx)(_o.Z,{debugName:"CollectionViewCardItem",capture:S,onEsc:()=>{pe.MO(),ur(this.stores.editModeStore)},onEnter:()=>function(e,t){t&&t(e)}(this.props.store,this.props.onTextEnter),onSpace:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockSpace,onTab:this.handleBlockPropertyTab,onUntab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEditButtonClick,children:(0,v.jsxs)(_o.Z,{debugName:"CollectionViewCardItem",capture:y,onShiftEnter:()=>{Q.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{u({blocks:zo.default.state.stores,transaction:e})}})},children:[f,Jo(this.props.store,this.props.collectionContextStore)&&(0,v.jsx)(xo.bZ,{origin:C})]})})}renderTitle(){const{device:e}=this.environment,{store:t,collectionContextStore:o}=this.props,r=(0,io.JI)(t),i=(t.hasIcon()||!t.isEmptyPage())&&o.shouldShowPageIcon(),n=t.hasError(),s=t.canEdit()&&o.permissionScopes.state.canEditContent,l=this.normalizedCardSelectionStore.state,a=er(this.props.collectionContextStore),c=s?(0,v.jsx)(Vo.Z,{disabled:!1,bucket:"secure",style:{...sr(this.props.collectionContextStore),...e.isMobile?qo:$o,..."board"===a&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:t.getIcon(),store:t,onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRecordIconChange,size:e.isMobile?24:20,isEmptyPage:t.isEmptyPage()}):(0,v.jsx)(Vo.Z,{disabled:!0,bucket:"secure",style:{...sr(this.props.collectionContextStore),...e.isMobile?qo:$o},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:t.getIcon(),store:t,size:e.isMobile?24:s?20:18,isEmptyPage:t.isEmptyPage()}),d=(0,v.jsx)(Po.Z,{store:r,disabled:!l,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextEnter,onEsc:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextEsc,onTab:this.handleTextTab,onUntab:this.handleTextUntab,onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTrackTitlePropertyEdit,placeholder:l?ze.default.formatMessage(Ko.typeAName):ze.default.formatMessage(Ko.untitledBlock),style:{...e.isMobile?Yo:Qo,..."board"===a&&{flexGrow:1,padding:2},pointerEvents:l?void 0:"none",cursor:l?"text":void 0,..."gallery"===a&&{whiteSpace:"pre-wrap"}},disableSelectAllBlocks:!0,pasteBehavior:"inline"});return(0,v.jsxs)("div",{style:this.getTitleWrapStyle(),children:[(i||l)&&!n&&c,n&&(0,po.t)({fill:this.theme.accentColors.orange[500],width:e.isMobile?20:16,marginLeft:e.isMobile?2:4,marginRight:e.isMobile?4:6,paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom"}),d]})}renderProperties(){const e=this.getShowProperties();if(0!==e.length)return(0,v.jsx)("div",{style:lr(this.props.shouldShowTitle,this.props.collectionContextStore),children:e.map(this.renderProperty)})}getShowProperties(){const{store:e,schema:t}=this.props,o=tr(this.props.format,this.props.collectionContextStore);if(!e.isDefined())return[];return o.filter((o=>{const r=this.normalizedCardSelectionStore.state&&"title"!==o.property;return ao.XU({block:e.getModel(),property:o.property,schema:t,getRecordModel:this.props.store.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,Ee.r)(),intl:ze.default.getIntl()})||r}))}hasNoProperties(){return 0===this.getShowProperties().length}getTitleWrapStyle(){const e=er(this.props.collectionContextStore);return{..."gallery"===e&&{width:"100%"},display:"flex",paddingTop:dr(this.props.collectionContextStore,this.props.store)?4:8,paddingLeft:"board"===e?6:10,paddingRight:10,paddingBottom:"gallery"===e&&this.hasNoProperties()?10:6,position:"relative"}}getFooterIconsContainerStyle(){return{display:"flex",alignItems:"center",paddingLeft:10,paddingRight:10,paddingBottom:8,..."gallery"===er(this.props.collectionContextStore)&&{paddingTop:this.hasNoProperties()&&!this.props.shouldShowTitle?8:0}}}}Uo.displayName="CollectionViewCardItem";const Wo=Uo,$o={float:"left",marginTop:2,marginRight:4,marginLeft:-2},qo={float:"left",marginTop:0,marginRight:4,marginLeft:-2},Qo={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:R.Z.fontWeight.medium,width:"auto"},Yo={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:R.Z.fontWeight.medium,width:"auto"};function Xo(e,t){const o=t[e];return Boolean(o&&!fe.uk.includes(o.type))}function Jo(e,t){var o,r,i;return!(e.getSpaceId()!==(null===(o=Lo.default.state.currentSpaceStore)||void 0===o?void 0:o.id))&&((null===(r=t.collectionViewStore())||void 0===r?void 0:r.getFormat().app_config_uri)===p.g3&&e.getFormat().app_config_uri===p.z3&&"sprint_board"===(null===(i=Lo.default.state.mainEditorCurrentBlockStore)||void 0===i?void 0:i.getFormat().special_page_for_pm_launch))}function er(e){const t=e.collectionViewStore();return null==t?void 0:t.getType()}function tr(e,t){return(("board"===er(t)?e.board_properties:e.gallery_properties)||[]).filter((e=>e.visible))}function or(e,t,o){return"board"===er(t)?(null==e?void 0:e.cardBackgroundColor)||o.boardItemDefaultBackground:o.collectionGalleryPreviewCardBackground}function rr(e,t,o){const r=er(t),i=t.isCompactView.state;return{...i?{boxShadow:o.homeShadow.card.base}:{boxShadow:e?o.selectTypeBoardBoxShadow:o.lightBoxShadow},borderRadius:"board"===r?4:i?6:3,background:or(e,t,o),overflow:"hidden",transition:"background 100ms ease-out",..."board"===r&&{marginBottom:xn}}}function ir(e,t,o){return t.isCompactView.state?{background:or(e,t,o),boxShadow:o.homeShadow.card.hovered}:{background:(null==e?void 0:e.cardHoveredBackgroundColor)||o.cardHoveredBackground}}function nr(e,t,o){return t.isCompactView.state?{background:or(e,t,o),boxShadow:o.homeShadow.card.hovered}:{background:(null==e?void 0:e.cardPressedBackgroundColor)||o.cardPressedBackground}}function sr(e){return{..."board"===er(e)&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}}}function lr(e,t){const o=er(t),r=t.isCompactView.state;return{paddingTop:e?0:8,paddingBottom:10,..."board"===o&&{lineHeight:1.5,paddingBottom:4,display:"flex",flexDirection:"column"},..."gallery"===o&&r&&{display:"flex",flexWrap:"wrap"}}}function ar(e){return{display:"flex",alignItems:"center",color:e.lightTextColor,fontWeight:R.Z.fontWeight.medium}}function cr(e,t,o,r,i){const n=(0,io.JI)(t);W.eP({environment:e,store:t}),q.NX({store:n}),pe.Z5({store:t}),i&&I.sd(e,"board_item_edit_mode_enter",{...(0,he.Pn)(o),block_id:t.id,from:i,view_type:er(o)}),r.setState("existing")}function dr(e,t){return(0,Fo.Cr)({collectionContextStore:e,blockId:t.id,blockStore:t})}function ur(e){"new_empty"===e.state&&(e.setState("new"),Ao.Z.state.isActive&&Ao.Z.setState({...Ao.Z.state,transient:!1}))}const pr=function(e){let{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:C,coverSizeFormat:f,shouldShowTitle:y,colorStyle:x,onTextEnter:b,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:_,isLast:T,handleOpenPeekPage:V,collectionContextStore:O}=e;return(0,v.jsx)(Wo,{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:C,coverSizeFormat:f,coverHeight:void 0,coverWidth:void 0,shouldShowTitle:y,colorStyle:x,onTextEnter:b,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:_,isLast:T,handleOpenPeekPage:V,collectionContextStore:O})};var hr=o(34232),mr=o(66213),Sr=o(73744),gr=o(17504);class Cr extends d.default{getInitialState(){return{}}}const fr=Cr;const vr=function(e){let{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:C,coverSizeFormat:f,coverHeight:y,coverWidth:x,shouldShowTitle:b,onTextEnter:w,onTextEsc:k,onShiftEnter:_,blockPropertyValueOverlayStore:T,isLast:V,handleOpenPeekPage:O,collectionContextStore:P}=e;return(0,v.jsx)(Wo,{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:C,coverSizeFormat:f,coverHeight:y,coverWidth:x,shouldShowTitle:b,colorStyle:void 0,onTextEnter:w,onTextEsc:k,onShiftEnter:_,blockPropertyValueOverlayStore:T,isLast:V,handleOpenPeekPage:O,collectionContextStore:P})};var yr=o(18245),xr=o(76205),br=o(59054),wr=o(40745),kr=o(95371),_r=o(37524),Tr=o(73807),Vr=o(20144),Or=o(92973),Pr=o(28020),Rr=o(48543),Mr=o(55367);function jr(e){window.__c={n:"CollectionGroupResultsItem"};const{store:t,resultProps:o,resultComponent:r,collectionContextStore:n,canDrag:s,canDrop:a,getItemSelectableStyle:d,belowDropZoneMargin:u,analyticsName:p,disabled:h,direction:m,onSelectableEnter:S,disableScrollToRevealHorizontal:g,touchDragOnly:C,isLast:f,groupsPointer:y,toggleButton:x,subitemPath:b,disableSelectable:w,itemSelectableHaloStyle:k,passesFilter:_,onSelectableInsertRow:T,blockPropertyValueOverlayStore:V,dropzoneGap:O}=e,P=(0,oe.O7)(),R=(0,c.VK)((()=>t.canEdit()),[t]),M=(0,c.VK)((()=>t.getAssociatedCollectionStore()),[t]),I=(0,c.VK)((()=>"collectionTypedView"===n.contextType),[n]),F=(0,c.VK)((()=>{const e=n.groupsStore.getGroupState(y);return null==e?void 0:e.resultsStore}),[n,y]),B=(0,c.VK)((()=>le.Sc(t)),[t]),N=(0,c.VK)((()=>{const e=Ao.Z.state;return e.isActive&&e.store===t}),[t]),D=(0,c.VK)((()=>!h&&R&&!(0,Pr.YO)(n.isInPeekRenderer.state)),[h,R,n]),A=(0,c.VK)((()=>e.shouldShowHoverMenu&&D),[e.shouldShowHoverMenu,D]),E=m!==Dr.Vertical&&a,Z=m!==Dr.Vertical&&a,z=m===Dr.Vertical&&a,G=(0,c.VK)((()=>n.isCompactView.state),[n]),K=(0,re.yK)((e=>({haloStyle:{...le.pB(B,e),...k}})),[k,B]),U=(0,i.useCallback)((e=>{const{insertStores:o,transaction:r}=e;return M?L.$T({environment:P,collectionStore:M,collectionContextStore:n,groupsPointer:y,insertStores:o,store:t,before:!1,transaction:r}):[]}),[M,n,P,y,t]),W=(0,i.useCallback)((e=>{const{insertStores:o,transaction:r}=e;return M?L.$T({environment:P,collectionStore:M,collectionContextStore:n,groupsPointer:y,insertStores:o,store:t,before:!0,transaction:r}):[]}),[M,n,P,y,t]),$=(0,i.useCallback)((e=>{const{droppedDirection:o,duplicate:r}=e;if(!M)return[];const i=yr.default.mark("collections.drop_item_lag");yr.default.measureAfterNextFlush(i,{environment:P,getData:()=>he.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const s=o!==Mr.vh.Onto?(0,ke.F6)({stores:e.droppedStores,collectionContextStore:n}):e.droppedStores;0===s.length&&I?we.showErrorMessage((0,v.jsx)(j.FormattedMessage,{...ke.nX.unsupportedGroupAction})):Q.createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:P,perform:e=>{!L.by({environment:P,collectionStore:I?void 0:M,targetStore:t,droppedDirection:o,collectionContextStore:n,groupsPointer:y,droppedStores:s,duplicate:r,transaction:e,subitemPath:b})&&I&&we.showErrorMessage((0,v.jsx)(j.FormattedMessage,{...ke.nX.unsupportedGroupAction}))}})}),[M,n,P,y,I,t,b]),q=(0,i.useCallback)((e=>{const{files:o,droppedDirection:r}=e;if(!M)return[];const i=yr.default.mark("collections.drop_item_lag");yr.default.measureAfterNextFlush(i,{environment:P,getData:()=>he.yr({collectionContextStore:n,is_native_drop:!0,is_empty:!1})}),Q.createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:P,perform:e=>{L.tQ({environment:P,collectionStore:M,targetStore:t,droppedDirection:r,collectionContextStore:n,groupsPointer:y,files:o,transaction:e})}})}),[M,n,P,y,t]),Y=(0,i.useCallback)((e=>o=>{let{transaction:r}=o;if(!M)return[];const i=L.yk({environment:P,collectionContextStore:n,groupsPointer:y,store:t,before:"above"===e,collectionStore:M,transaction:r,subitemPath:b,subitemInsertDirection:"below"});ue.W(P,{...he.Pn(n),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==i?void 0:i.id,creating_block_id:null==i?void 0:i.id}),i&&T&&T(t,i),i&&V&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{mo.bA({isNewBlock:!0,environment:P,blockPropertyValueOverlayStore:V,store:i,property:"title",format:yo.C.Table,collectionContextStore:n})}))}))}),[M,V,n,P,y,T,t,b]),X=(0,i.useCallback)((()=>{const t=n.collectionViewStore();yr.default.mark("collections.open_item_page_lag"),e.handleOpenPeekPage&&e.handleOpenPeekPage(),H.Xd({collectionContextStore:n,resultsStore:F});const o=null==t?void 0:t.getType();if(o){const e=null==t?void 0:t.getFormat().collection_peek_mode,r=e||Rr.Ls[o];Or.hy(P,{is_peek:!0,from:o,peek_mode:r})}}),[n,P,e,F]),J=(0,c.VK)((()=>d?d(f):void 0),[d,f]);(0,i.useEffect)((()=>{n.onItemMount()}),[n]);const ee=i.createElement(r,{handleOpenPeekPage:X,collectionContextStore:n,...o,store:t,key:t.id,isLast:f,toggleButton:x,subitemPath:b,passesFilter:_});return w?ee:(0,v.jsx)(It.Z,{style:J,store:t,canSelect:D,shouldShowHalo:!N&&!G,shouldForceRenderSelectionHalo:B,haloStyle:K.haloStyle,canDrag:s,canDropBelow:z,canDropLeft:E,canDropRight:Z,canNativeDropBelow:z&&!I,canNativeDropLeft:E&&!I,canNativeDropRight:Z&&!I,canDropOnto:a,canTriggerContextMenu:D,showBlockMenuInput:!0,shouldShowHoverMenu:A,shouldShowCommentMenu:!1,onSelectableDrop:$,onNativeDrop:q,onInsertBelow:U,onInsertAbove:W,onRemove:e=>function(e,t,o,r,i){const{transaction:n}=e;i.length>0&&L.BN({store:o,transaction:n,groupsPointer:i,collectionContextStore:r,environment:t});L.Od({store:o,transaction:n})}(e,P,t,n,y),canInsertAbove:a,canInsertBelow:a,onInsertRowBelow:Y("below"),onInsertRowAbove:Y("above"),belowDropZoneMargin:u,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:p,shouldShowDropZone:a,dropzoneGap:O,onEnter:S,className:ro.K4T,disableScrollToRevealHorizontal:g,touchDragOnly:C,groupsPointer:y,children:ee})}const Ir=i.memo(jr,Jt.Z),Fr=function e(t){window.__c={n:"CollectionGroupResultsNestedItem"};const{store:o,collectionContextStore:r,subitemPath:n,titleColumnIndex:s,nestedCreateSubitemButton:l,getItemSelectableStyle:a}=t,{currentSubitemFormatStoreForUiDisplay:d,subitemExpandedStore:u,subitemTreeStore:p}=r,h=(0,c.VK)((()=>le.Bm({store:o,collectionContextStore:r})),[r,o]),m=(0,c.VK)((()=>n&&n.length>0?n:(0,kr.DY)(p.state.children,(e=>e.value.store===o))),[n,p,o],{useDeepEqual:!0}),S=m?(0,Fo.Af)(m.map((e=>e.value.store))):"",g=(0,c.VK)((()=>u.state.get(S)),[u,S]),C=Boolean(null==g?void 0:g.isExpanded),f=(0,oe.O7)(),y=(0,c.VK)((()=>{const e=d.state;if(!e||!h)return;const t=h.getSchema()[e.property];return void 0!==t&&(0,fe.p_)(t)?t:void 0}),[d,h]),x=(0,c.VK)((()=>{var e;return y&&"relation"===y.type&&(0,fe.F0)(y)===(null===(e=r.collectionStore())||void 0===e?void 0:e.id)&&y.property}),[r,y]),b=(0,c.VK)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),w=(0,c.VK)((()=>{const e=!x||b&&(0,Fo.Av)(b)?void 0:{property:x,filter:{operator:"is_empty"}};return!(!d.state||!h)&&(0,Fo.kC)({store:o,collectionStore:h,subitemFormat:d.state,subitemPathKey:S,collectionContextStore:r,propertyFilters:[...e&&x?[{id:x,filter:e}]:[],...r.currentPropertyFiltersStore.state],combinatorFilter:r.currentCombinatorFilterStore.state,currentUserId:f.currentUser.id}).length>0}),[r,b,d,f.currentUser.id,x,h,S,o]),k=(0,c.VK)((()=>{var e;if(!d.state||!h)return!1;const t=null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType();return w||C||f.device.isMobile||"timeline"===t}),[d,f.device.isMobile,h,w,C,r]),_=(0,c.VK)((()=>Vr.Z.getState().hoveredStore===o),[o]),T=(0,c.VK)((()=>{const e=(0,Ut.m1)({collectionContextStore:r,collectionStore:h,environment:f});if(e)return(0,xr.q)(e)}),[r,h,f]),V=(0,i.useCallback)((()=>{const e=u.state;if(C)e.delete(S),I.a_(f,{...(0,he.Pn)(r),depth:(null==m?void 0:m.length)||0}),u.emit();else{e.set(S,{isExpanded:!0,limit:20}),I._k(f,{...(0,he.Pn)(r),depth:(null==m?void 0:m.length)||0});const t=d.state;T&&e&&y&&t?(0,Fo.fd)({blockStore:o,subitemExpandedStore:u,subitemFormat:t,propertySchema:y,compiledFilter:T,pathKey:S,forceStoresToLoad:!1,visitedIds:new Set}).then((()=>{u.emit()})):u.emit()}}),[T,u,C,S,r,d,f,m,o,y]),O=(0,c.VK)((()=>{const e=p.state;return e&&m?(0,Fo.Ns)(e).value.store===o:t.isLast}),[p,t.isLast,o,m]),P=(0,Tr._)(),R=(0,c.VK)((()=>{var e;const t=o.getModel(),r=o.getRecordModel;if(!T||!t)return!0;const i=null===(e=o.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return T({block:t,getRecordModel:r,propertyMapping:i,formulaTimeoutTimestampMs:Date.now()+P,resultCache:new Map})}),[o,T,P]),M=(0,c.VK)((()=>a&&!R?()=>({...a?a(O):{},...R?{}:{opacity:.5}}):a),[a,R,O]);(0,br.r5)((async()=>{const e=o.getModel();await o.load();const t=o.getRecordModel,r=d.state;if(!k||!e||!T||!y||!t||!r||R)return;(0,Fo.xb)({store:o,subitemFormat:r,propertySchema:y}).length>0||(await(0,Fo.fd)({blockStore:o,subitemExpandedStore:u,subitemFormat:r,propertySchema:y,compiledFilter:T,pathKey:S,forceStoresToLoad:!0,visitedIds:new Set}),u.emit())}),[k,T,d,R,S,o,u,y]);const j=(0,re.Fg)(),F=(0,v.jsx)(Ir,{...t,passesFilter:R,isLast:O,getItemSelectableStyle:M,subitemPath:m,toggleButton:(k||_)&&(0,v.jsx)(Ft.Z,{isSidebar:!1,open:C,fill:!0,onClick:V,color:w||C?j.regularIconColor:j.mediumIconColor,disabled:m&&m.length>=Fo.F0})});if(!C||!m||0===m.length||m.length>=Fo.F0)return F;const B=m[m.length-1].children;return(0,v.jsxs)(v.Fragment,{children:[F,B.map((o=>{const r=o.value.store;return(0,i.createElement)(e,{...t,key:r.id,store:r,subitemPath:[...m,o]})})),h&&l&&l({store:o,parentStore:h,subitemPath:m,indentLevel:m.length,titleColumnIndex:s}),g&&B.length>0&&B.length===g.limit&&(0,v.jsx)(Br,{collectionContextStore:t.collectionContextStore,pathKey:S,titleColumnIndex:s,limit:g.limit,indentLevel:m.length})]})},Br=i.memo((function(e){window.__c={n:"NestedTableLoadMoreButton"};const{collectionContextStore:t,pathKey:o,titleColumnIndex:r,limit:n,indentLevel:s}=e,l=(0,i.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:n+20}),e.emit()}),[t,n,o]),a=(0,oe.O7)(),d=(0,c.VK)((()=>le.fk({environment:a,collectionContextStore:t})),[t,a]),u=(0,c.VK)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),p=(0,re.yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:8+(0,_r.f2)({columnIndex:0,titleColumnIndex:r,shouldShowBulkActionsToolbar:d,indentLevel:s+1,isSubitemToggleOnTitleColumn:u}),fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[s,d,r,u]);return(0,v.jsxs)(ko.Z,{onClick:l,onMouseDown:me.$0,style:p.button,children:[(0,wr.M)(p.icon),(0,v.jsx)("span",{style:p.label,children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})})]})})),Nr=i.memo(Fr);let Dr=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});class Lr extends s.Z{constructor(){super(...arguments),this.instanceCollectionViewBlockStore=void 0,this.handleEmptyDroppableDrop=e=>{const{droppedDirection:t,duplicate:o}=e,{collectionContextStore:r,groupsPointer:i}=this.props,n=this.emptyDroppableIntoStore.state,s=r.collectionViewBlockStore();if(!s)return;const l=yr.default.mark("collections.drop_item_lag");yr.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>he.yr({collectionContextStore:r,is_native_drop:!1,is_empty:!0})});const a="collectionTypedView"===r.contextType,c=(0,ke.F6)({stores:e.droppedStores,collectionContextStore:r});0===c.length&&a?we.showErrorMessage(ze.default.formatMessage(ke.nX.unsupportedGroupAction)):Q.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:this.environment,perform:e=>{!L.by({environment:this.environment,collectionStore:n,targetStore:s,droppedDirection:t,collectionContextStore:r,groupsPointer:i,droppedStores:c,duplicate:o,transaction:e})&&a&&we.showErrorMessage(ze.default.formatMessage(ke.nX.unsupportedGroupAction))}})},this.handleEmptyDroppableNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:r,groupsPointer:i}=this.props,n=this.emptyDroppableIntoStore.state;if(!n)return;const s=r.collectionViewBlockStore();if(!s)return;const l=yr.default.mark("collections.drop_item_lag");yr.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>he.yr({collectionContextStore:r,is_native_drop:!0,is_empty:!0})}),Q.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:this.environment,perform:e=>{L.tQ({environment:this.environment,collectionStore:n,targetStore:s,droppedDirection:o,collectionContextStore:r,groupsPointer:i,files:t,transaction:e})}})},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t,loadContentCover:o}=this.props,r=e.groupsStore.getGroupState(t);if(!r)return;const i=r.currentLimit.state,n=e.normalizedSchemaStore.state,s=_.oA(t.map((e=>(0,Ae.Ko)({schema:n,propertyMapping:void 0,group:e,timeZone:(0,Ee.r)()}))));return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:i,loadContentCover:o}})),this.resultStores=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return(null==o?void 0:o.resultsStore.state)??[]})),this.emptyDroppableIntoStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return"collectionTypedView"===e.contextType?void 0:e.collectionStore()}))}getNode(){return super.getNode()}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.instanceCollectionViewBlockStore=new ge.G(this.environment,t.pointer))}didMountOrUpdate(){this.props.collectionContextStore.renderEmitter.emit()}renderComponent(){const{emptyDroppableStyle:e,direction:t}=this.props,o=this.props.emptyDroppableSize||"none",r=t===Dr.Vertical;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:{...r?{height:o}:{width:o},...e},children:this.renderEmptyDroppable()}),this.resultStores.state.map(((e,t,o)=>(0,v.jsx)(Zr,{store:e,isLast:t===o.length-1,...this.props},e.id))),this.renderReducerRequest()]})}renderReducerRequest(){const{collectionContextStore:e,groupsPointer:t,disableRequest:o}=this.props;if(o)return;const r=this.resultsReducerStore.state;if(!r)return;const i=e.groupsStore.getGroupState(t);return i?(0,v.jsx)(Ke.Z,{id:t.length>0?`results:${(0,ie.KW)(t)}`:"collection_group_results",reducer:r,groupsPointer:t,collectionContextStore:e,resultStore:i.reducerResultStore}):void 0}renderEmptyDroppable(){const{collectionContextStore:e,disabled:t,analyticsName:o,direction:r,onSelectableEnter:i,canDrop:n,groupsPointer:s}=this.props;if(this.instanceCollectionViewBlockStore){const l=r!==Dr.Vertical&&(!t&&0===this.resultStores.state.length),a=r===Dr.Vertical&&!t,c="collectionTypedView"===e.contextType,d=e.isCompactView.state;return(0,v.jsx)(It.Z,{store:this.instanceCollectionViewBlockStore,canSelect:!1,canEditText:!1,shouldShowHalo:!d,canDrag:!1,canDropLeft:n&&l,canNativeDropLeft:n&&l&&!c,canDropBelow:n&&a,canNativeDropBelow:n&&a&&!c,canTriggerContextMenu:!1,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.handleEmptyDroppableDrop,onNativeDrop:this.handleEmptyDroppableNativeDrop,analyticsName:o,shouldShowDropZone:n,onEnter:i,groupsPointer:s,style:r===Dr.Vertical?void 0:{width:"100%",height:"100%"}})}}}Lr.displayName="CollectionGroupResults";const Ar=Lr;function Er(e){window.__c={n:"ResultComponent"};const{isLast:t,collectionContextStore:o,dropzoneGap:r,resultProps:n,resultComponent:s,groupsPointer:l,shouldShowHoverMenu:a,canDrag:d,disabled:u,format:p,getItemSelectableStyle:h,handleOpenPeekPage:m,belowDropZoneMargin:S,analyticsName:g,direction:C,onSelectableEnter:f,canDrop:y,disableScrollToRevealHorizontal:x,touchDragOnly:b,blockPropertyValueOverlayStore:w,onSelectableInsertRow:k,disableSelectable:_,titleColumnIndex:T,nestedCreateSubitemButton:V,itemSelectableHaloStyle:O}=e,P=(0,c.VK)((()=>le.Bm({store:e.store,collectionContextStore:o})),[o,e.store]),R=(0,i.useMemo)((()=>[]),[]);return P?(0,v.jsx)(Nr,{getItemSelectableStyle:h,itemSelectableHaloStyle:O,store:e.store,canDrag:d,resultProps:n,resultComponent:s,collectionContextStore:o,groupsPointer:l,shouldShowHoverMenu:a,canDrop:y&&!u,format:p,handleOpenPeekPage:m,belowDropZoneMargin:S,analyticsName:g,disabled:u,direction:C,dropzoneGap:r,onSelectableEnter:f,disableScrollToRevealHorizontal:x,touchDragOnly:b,isLast:t,subitemPath:R,titleColumnIndex:T,blockPropertyValueOverlayStore:w,onSelectableInsertRow:k,disableSelectable:_,nestedCreateSubitemButton:V}):null}const Zr=i.memo(Er),Hr=i.memo((function(e){let{collectionContextStore:t,groupFormat:o,format:r,schema:n,disabled:s,store:l,blockPropertyValueOverlayStore:a,collectionGalleryViewStore:d,isSingleColumn:u}=e;const p=(0,oe.O7)(),h=(0,i.useMemo)((()=>o?[o]:[]),[o]),m=(0,c.VK)((()=>t.permissionScopes.state),[t.permissionScopes]),S=(0,c.VK)((()=>l.canEdit()&&("collectionTypedView"===t.contextType||m.canEditContent)),[t,m.canEditContent,l]),g=(0,i.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();W.eP({environment:p,store:e}),q.NX({store:o}),pe.Z5({store:e})}}),[p]),C=(0,i.useCallback)((e=>{const o=t.collectionStore(),r=e.getTitleStore();if(!r)return;to.QaF(r.getValue())?W.Ys({environment:p,store:e}):o&&Q.createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:p,perform:t=>{L.Od({store:e,transaction:t})}})}),[t,p]),f=(0,i.useMemo)((()=>u?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[u]),{gallery_cover:y,gallery_cover_aspect:x,gallery_cover_size:b}=r,w=!s&&S&&!m.isSyncedCollection,{coverHeight:k,coverWidth:_}=(0,c.VK)((()=>d.state),[d]),T=(0,i.useMemo)((()=>({format:r,schema:n,onTextEnter:C,onTextEsc:C,onShiftEnter:g,disabled:s,coverFormat:y,coverAspectFormat:x,coverSizeFormat:b,coverHeight:k,coverWidth:_,shouldShowTitle:io.K8(r,"gallery"),blockPropertyValueOverlayStore:a,collectionContextStore:t})),[a,t,k,_,x,y,b,s,r,g,C,n]);return(0,v.jsx)(Ar,{collectionContextStore:t,groupsPointer:h,format:r,canDrag:w,onSelectableEnter:g,resultProps:T,resultComponent:vr,canDrop:!0,disabled:s,shouldShowHoverMenu:!1,direction:u?Dr.Vertical:Dr.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:f,loadContentCover:y&&"page_content"===y.type})}));var zr=o(49902);const Gr=(0,j.injectIntl)((function(e){const{limit:t}=e;return(0,v.jsx)(j.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}));const Kr=(0,j.injectIntl)((function(e){window.__c={n:"FirstLoadLimitSelectMenu"};const t=(0,oe.O7)(),{device:o}=t,{currentLimit:r,onAccept:i,onClose:n,showTitle:s}=e,l=[{key:0,render:e=>(0,v.jsx)(Re.Z,{enableActionSheetTitle:!0,title:s&&(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:_.oA(ao.jk.map(((e,t)=>{const o={key:t,render:t=>(0,v.jsx)(Qe.Z,{...t,disabled:!1,title:(0,v.jsx)(Gr,{limit:e}),checkState:_.Xy(r,e)}),action:()=>i(e)};return o})))}];let a;return a=o.isMobile?{menuType:_e.og.ActionSheet}:{menuType:_e.og.Popup,width:200},(0,v.jsx)(Ve.Z,{...a,children:(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,sections:l,onAccept:n,initialFocus:void 0})})}));const Ur=function(e){let{format:t,collectionContextStore:o}=e;window.__c={n:"FirstLoadLimitActionButton"};const r=(0,oe.O7)(),{device:i}=r;return(0,v.jsx)(Ye.ZP,{popupType:i.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,renderOrigin:e=>(0,v.jsx)(jt.Z,{icon:ce.o,style:{marginLeft:4,marginRight:4},...e}),alignmentToOrigin:Ye.vR.End,placementToOrigin:Ye.pO.Bottom,originGap:8,render:e=>(0,v.jsx)($r,{parent:e,format:t,collectionContextStore:o})})};function Wr(e){return(0,ao.rx)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}function $r(e){let{parent:t,format:o,collectionContextStore:r}=e;window.__c={n:"PopupComponent"};const i=(0,oe.O7)();return(0,v.jsx)(Kr,{currentLimit:Wr(o),onAccept:e=>function(e,t,o){const r=t.collectionViewStore();if(!r)return;const i=r.getType();i&&(Q.createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,perform:t=>{So.FH({stores:[r],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),I.wd(o,{view_type:i,action:"set_first_load_limit"}))}(e,r,i),onClose:t.close,showTitle:!0})}const qr=function(e){let{style:t,store:o,format:r,collectionContextStore:i,groupsPointer:n,incrementLimitsInRelatedGroups:s,isFullScreen:l}=e;window.__c={n:"CollectionGroupLoadMoreButton"};const a=(0,re.Fg)(),d=(0,oe.O7)(),p=(0,c.VK)((()=>i.groupsStore.getGroupState(n)),[i,n]),h=(0,c.VK)((()=>Qt({collectionContextStore:i,groupsPointer:n})),[i,n]),m=(0,c.VK)((()=>i.isCompactView.state),[i]),S=(0,c.VK)((()=>o.canEdit()),[o]);return p?m?(0,v.jsx)(ko.Z,{onClick:e=>function(e,t,o){const r=e.metaKey||e.ctrlKey;r?ne._({environment:t,store:o,pageVisitSource:u.tY.PersonalHomeTileTasks,openInNew:"tab"}):ne._({environment:t,store:o,pageVisitSource:u.tY.PersonalHomeTileTasks})}(e,d,o),onMouseDown:me.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,paddingLeft:8,marginBottom:8,...t},children:(0,v.jsx)("div",{style:{color:a.lightTextColor},children:(0,v.jsx)(j.FormattedMessage,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})}):(0,v.jsxs)(ko.Z,{onClick:e=>function(e,t,o,r,i,n){const s=o.groupsStore.getGroupState(r);if(!s)return;const l=s.reducerResultStore.state;(0,me.Wi)(e),W.ZH(t),l&&L.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:s.groupsPointer,incrementLimitsInRelatedGroups:i}});zr.j({name:"collection_load_more"}),I.uD(t)}(e,d,i,n,s,l),onMouseDown:me.$0,disabled:h,hoveredStyle:h?{background:a.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,...t},children:[(0,wr.M)(Qr(a)),(0,v.jsx)("div",{style:{color:a.lightTextColor},children:(0,v.jsx)(j.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),h?(0,v.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,v.jsx)(Ue.Z,{style:{width:12,height:12}})}):S&&(0,v.jsx)(Ur,{collectionContextStore:i,format:r})]}):null};function Qr(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}class Yr extends d.default{getInitialState(){return!1}}const Xr=Yr;class Jr extends d.default{getInitialState(){}}const ei=Jr;class ti extends d.default{getInitialState(){return{containerMap:new Map}}}const oi=ti;class ri extends s.Z{constructor(){super(...arguments),this.element=void 0,this.scrollableAncestor=void 0,this.resizingAncestor=void 0,this.callbackQueued=!1,this.resizeObserver=new ResizeObserver((()=>{this.handleScroll()})),this.storeTypes={store:oi},this.handleScroll=()=>{this.callbackQueued||(this.callbackQueued=!0,window.requestAnimationFrame((()=>{this.callbackQueued=!1,this.mutateDOM((()=>{!function(e){const{environment:t,container:o}=e,{device:r}=t,{store:i}=o.stores,{containerMap:n}=i.state,s=Array.from(n.keys()).sort(((e,t)=>{if(e.element&&t.element)return(0,bt.Z)(e.element,t.element);throw new Error("Element not found")})),l=new Map;for(const a of s){const{element:e,scrollableAncestor:t}=a,o=n.get(a);if(!e||!t||!o)continue;const i=Vt(a).reduce(((e,t)=>e+(l.get(t)||0)),0),s=t.getBoundingClientRect(),c=e.getBoundingClientRect(),d=s.height,u=Math.floor(s.top-c.top),p=Math.floor(s.top+d-c.top),h=Math.floor(c.height)+(a.props.isFullScreen&&!r.isSafari?wt.Z.state:0),m=Array.from(o.values()).sort(((e,t)=>{if(e.element&&t.element)return(0,bt.Z)(e.element,t.element);throw new Error("Element not found")}));let S=i,g=0;for(const r of m){if(!r.element)continue;const e=r.element.getBoundingClientRect(),t=S+e.height;r.props.position===mt.Top&&(g+=e.height);const o=_t(u,h,t,i),n=Tt(p,h,t,g);if(r.props.position===mt.Top){const e=0!==o,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;e?(r.element.style.transform=`translate3d(0, ${o}px, 0)`,r.element.style.bottom=""):(r.element.style.transform="",r.element.style.bottom=""),t&&Pt(r.element,t)}else if(r.props.position===mt.Bottom){const e=0!==n,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;if(e?(r.element.style.transform=`translate3d(0, ${n}px, 0)`,r.element.style.top=""):(r.element.style.transform="",r.element.style.top=""),t)for(const o in t)r.element.style[o]=t[o]||""}S=t}l.set(a,S)}}({environment:this.environment,container:this})}))})))},this.handleResizeThrottled=_.P2(this.handleScroll,100)}didMount(){!function(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.has(t)||r.state.containerMap.set(t,new Set),r.emit()}({container:this,parentContainer:Ot(this)}),(0,Se.Gf)(this.environment)&&this.attachEvents()}willUnmount(){!function(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.delete(t),r.emit()}({container:this,parentContainer:Ot(this)}),(0,Se.Gf)(this.environment)&&this.removeEvents(),this.element=void 0,this.scrollableAncestor=void 0}getChildContext(){return{...this.context,computedStickyContainer:this}}renderComponent(){if(this.props.children)return this.props.children}attachEvents(){const e=Ot(this),t=n.findDOMNode(this);if(t){this.element=t;const o=(0,Se.VW)(t);o&&(this.scrollableAncestor=o,e||((0,Sr.lj)(o,"scroll",this.handleScroll),(0,Sr.lj)(window,"resize",this.handleResizeThrottled),this.resizeObserver.observe(this.element)));const r=(0,Se.Ez)(this.element);r&&(this.resizingAncestor=r,this.resizeObserver.observe(this.resizingAncestor))}this.props.renderEmitter&&this.props.renderEmitter.addListener(this.handleScroll)}removeEvents(){this.scrollableAncestor&&((0,Sr.ZV)(this.scrollableAncestor,"scroll",this.handleScroll),(0,Sr.ZV)(window,"resize",this.handleResizeThrottled),this.element&&this.resizeObserver.unobserve(this.element)),this.resizingAncestor&&this.resizeObserver.unobserve(this.resizingAncestor),this.props.renderEmitter&&this.props.renderEmitter.removeListener(this.handleScroll)}}ri.displayName="ComputedStickyContainer",ri.contextTypes={computedStickyContainer:xt().any,...s.w},ri.childContextTypes={computedStickyContainer:xt().any,...s.w};const ii=ri,ni=d.default.createClass(!1);function si(e){let{renderGroup:t,groupFormat:o,groupsDisplayState:r,disabled:n,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:d,collectionContextStore:u,onGroupHeaderAddItem:p,renderHeader:h,getGroupStyle:m,stickyLeft:S,ignoreAncestorStickyContainer:g,paddingLeft:C,isFullScreen:f,index:y,isRootChild:x,isInPeekRenderer:b,groupBy:w,isLast:k}=e;window.__c={n:"CollectionGroup"};const _=(0,oe.O7)();(0,i.useEffect)((()=>{L.V$({environment:_,collectionContextStore:u,groupFormat:o})}),[]);const T=(0,c.qz)(void 0,ni),[V,O,P,R,M,j]=(0,c.VK)((()=>{const e=u.groupsStore.getGroupState(o),i=e?e.toggleStateStore:null,c=!!i&&i.state?t(o):null,g={groupFormat:o,currentGroups:r.currentGroups,disabled:n,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:d,collectionContextStore:u,isFullScreen:f,isInPeekRenderer:b,onGroupHeaderAddItem:p,stickyLeft:S,index:y,paddingLeft:C,isRootChild:x,groupBy:w,isGroupHoveredStore:T},_=h?h(g):(0,v.jsx)(Nt,{...g});return[e,i,u.renderEmitter,m&&i?m({groupFormat:o,...r,index:y,isLast:k,toggleStateStore:i}):void 0,c,_]}),[u,n,a,m,l,w,o,r,s,y,f,b,k,x,p,C,t,h,d,S,T]),I=(0,i.useCallback)((()=>{T.setState(!0)}),[T]),F=(0,i.useCallback)((()=>{T.setState(!1)}),[T]);return V&&O?(0,v.jsx)(ii,{ignoreAncestorContainer:g,renderEmitter:P,isFullScreen:f,children:(0,v.jsxs)("div",{style:{width:"100%",position:"relative",...R},onMouseEnter:I,onMouseLeave:F,children:[j,M]})}):null}si.displayName="CollectionGroup";const li=i.memo(si);var ai=o(51592);class ci extends s.Z{constructor(){super(...arguments),this.reducerStore=this.createComputedStore((()=>{const{aggregation:e,schema:t,groupFormat:o}=this.props;if(e){return{type:"aggregation",filter:(0,Ae.zk)({schema:t,group:o,propertyMapping:void 0,timeZone:(0,Ee.r)()}),aggregation:e}}}))}renderComponent(){const{device:e}=this.environment;return(0,v.jsx)(et.ZP,{renderTooltip:()=>(0,v.jsx)(ui,{aggregation:this.props.aggregation,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore}),render:t=>(0,v.jsx)(Ye.ZP,{popupType:e.isMobile?Ye.Z4.SlideUp:Ye.Z4.Popup,renderOrigin:e=>(0,v.jsx)(Xe.Z,{disabled:this.props.disabled,style:{fontWeight:R.Z.fontWeight.regular,color:this.props.color||this.theme.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0},...(0,Ge.Z)(t,e),children:this.renderValue()}),disabled:this.props.disabled,render:e=>(0,v.jsx)(Ci,{parent:e,onChange:this.props.onChange,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema})})})}renderValue(){const{schema:e,aggregation:t,collectionContextStore:o,groupFormat:r}=this.props,i=this.reducerStore.state;if(t&&i)return(0,v.jsx)(Ke.Z,{id:`board:${(0,ie.mD)(r)}`,collectionContextStore:o,reducer:i,groupsPointer:[r],render:o=>{const r=o.state;let i;if((0,Le.pK)(t)){const o=e[t.property];!o||"formula"!==o.type&&"number"!==o.type||(i=o.number_format)}return(0,v.jsx)($e,{aggregation:t,collectionContextStore:this.props.collectionContextStore,children:r?(0,He.Ol)({numberFormat:i,dateFormat:void 0,aggregationType:t.aggregator,userTimeZone:(0,Ee.r)(),value:r.aggregationResult,roundDecimal:5}):"-"})}})}}ci.displayName="BoardAggregation";const di=ci;function ui(e){let{aggregation:t,schema:o,collectionContextStore:r}=e;window.__c={n:"TooltipText"};const i=(0,c.VK)((()=>!!t&&We(r,t)),[r,t]);if(t){const e=He.VN[(0,Le.OV)(t)];if((0,Le.pK)(t)){const r=o[t.property];if(r){const t=r.name;return(0,v.jsx)(v.Fragment,{children:ze.default.formatMessage(qe.propertyAggregation,{aggregationType:e,propertyName:t,calculating:i})})}}return(0,v.jsx)(v.Fragment,{children:ze.default.formatMessage(qe.aggregationType,{aggregationType:e,calculating:i})})}return(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function pi(e){let{aggregationType:t,label:o,props:r}=e;const i=He.Sn[t];return(0,v.jsx)(et.ZP,{placement:Je.GI.Placement.Right,delayThreshold:0,render:e=>(0,v.jsx)(Qe.Z,{title:o,...(0,Ge.Z)(e,r)}),renderTooltip:()=>(0,v.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,v.jsx)("img",{src:(0,Ze.D)(i),style:{borderRadius:4,width:140,marginTop:4}}),He.BG[t]]})})}function hi(e,t,o,r){o.isLoading.state||o.loadingDetails.setState({type:"load_aggregation"}),o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),F.wd({environment:r,collectionContextStore:o,action:"board_change_aggregation"}),zr.j({name:"collection_change_aggregation"})}function mi(e,t,o,r){const i=He.VN[e];return{key:e,render:t=>(0,v.jsx)(pi,{aggregationType:e,label:i,props:t}),action:()=>{hi({aggregator:e},t,o,r)}}}function Si(e,t,o,r,i,n){const{device:s}=o,l=He.VN[e],a=_.oA(t.map((t=>function(e,t,o,r,i,n){const s=o[e];if(!s)return;const l=s.name;return{key:`${e} ${t}`,render:e=>(0,v.jsx)(pi,{aggregationType:t,label:l,props:e}),action:()=>{hi({aggregator:t,property:e},r,i,n)}}}(t,e,r,i,n,o))));return{key:e+l,render:(e,t)=>(0,v.jsx)(tt.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,v.jsx)(Qe.Z,{...e,ref:t,title:l}),renderExtension:(e,o)=>{let r;return r=s.isMobile?{menuType:_e.og.Modal,title:l,right:(0,v.jsx)(Pe.DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:_e.og.Popup,width:200,...e},(0,v.jsx)(Ve.Z,{...r,children:(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,v.jsx)(Re.Z,{...e}),items:a}],onAccept:t.onAccept})})}}),action:()=>null}}function gi(e,t,o,r){const i=[];for(const c of Le.o5)i.push(mi(c,t,o,e));const n=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(r);if(n.length>0)for(const c of Le.Sy)"show_unique"!==c&&i.push(Si(c,n,e,r,t,o));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.O4)(o)}))}(r);if(s.length>0)for(const c of Le.k$)i.push(Si(c,s,e,r,t,o));const l=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.dN)(o)}))}(r);if(l.length>0)for(const c of Le.f8)i.push(Si(c,l,e,r,t,o));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.Mv)(o)}))}(r);if(a.length>0)for(const c of Le.gC)i.push(Si(c,a,e,r,t,o));return i}function Ci(e){let{parent:t,onChange:o,collectionContextStore:r,schema:i}=e;window.__c={n:"MenuComponent"};const n=(0,oe.O7)(),{device:s}=n;let l;return l=s.isMobile?{menuType:_e.og.Modal,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,v.jsx)(Pe.DoneMenuText,{}),onClickRight:t.close}:{menuType:_e.og.Popup,width:200},(0,v.jsx)(Ve.Z,{...l,children:(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,v.jsx)(Re.Z,{...e}),items:gi(n,o,r,i)}],onAccept:t.close})})}class fi extends s.Z{constructor(){super(...arguments),this.handleAddItemClick=()=>{const{device:e}=this.environment;if(!Ce.M_(this.environment))return;const{format:t,groupFormat:o,onAddItem:r,collectionContextStore:i,isFullScreen:n}=this.props;if("collectionTypedView"===i.contextType)return;const s=Boolean(t.collection_group_by);i.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:i,isFullScreen:n});const l=i.collectionStore(),a=i.groupsStore.getGroupState(o);if(!l||!a)return;const c=a.resultsStore;Q.createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:this.environment,perform:t=>{const n=L.IW({environment:this.environment,collectionContextStore:i,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"board_group_header"});if(!n)return;const l=n.coercionSucceeded,a=n.newStore;if(e.isMobile){const e=(0,Bo.ZP)({store:a,pageVisitSource:u.tY.Create});this.navigate(e)}else if(l&&!s){const e=a.getBlockTitleStore();W.eP({environment:this.environment,store:a}),q.NX({store:e}),pe.Z5({store:a})}else se.CH({environment:this.environment,store:a,peekMode:(0,le.kr)(i.collectionViewStore()),resultsStore:c,collectionContextStore:i,pageVisitSource:u.tY.Create});r&&r(a),ue.W(this.environment,{from:"board_group_add_item_top",type:"page",new_page_id:a.id,creating_block_id:a.id,...(0,he.Pn)(i)})}})},this.colorStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o,collectionContextStore:r}=this.props;return(0,ke.II)({environment:this.environment,groupFormat:e,schema:t,format:o,collectionContextStore:r,theme:this.theme})})),this.isHoveredStore=this.createComputedStore((()=>(0,ie.ZH)(this.props.hoveredGroupStore.state,this.props.groupFormat)))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):G.c4({environment:this.environment,url:e})}renderComponent(){const{disabled:e,collectionContextStore:t}=this.props,o=t.permissionScopes.state,r=t.shouldAllowNewItemCreation();return(0,v.jsxs)("div",{style:wi(this.environment,this.props.hidden,this.props.format,this.props.collectionContextStore,this.props.isPopup,this.props.isInPeekRenderer,this.colorStore),onMouseMove:()=>{return e=this.props.hoveredGroupStore,t=this.props.groupFormat,void(e.state!==t&&e.setState(t));var e,t},children:[(0,v.jsx)(bi,{boardGroupHeaderProps:this.props}),this.renderAggregation(),(0,v.jsx)("div",{style:{flexGrow:1}}),!e&&o.canConfigureBlock&&this.renderActionButton(),r&&this.renderAddButton()]})}renderAggregation(){const{disabled:e,query:t,schema:o,collectionContextStore:r,groupFormat:i}=this.props,n=t.aggregations?t.aggregations[0]:void 0,s=r.permissionScopes.state;return(0,v.jsx)(di,{groupFormat:i,disabled:e||!s.canConfigureBlock,aggregation:n,schema:o,collectionContextStore:r,color:ki(this.theme,this.props.hidden,this.colorStore),onChange:e=>function(e,t,o,r){const i=t.collectionViewStore(),n=e?[e]:[],s={...o,aggregations:n};i&&Q.createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:r,perform:e=>{pe.iG({collectionViewStore:i,update:{query2:s},transaction:e})}})}(e,this.props.collectionContextStore,this.props.query,this.environment)})}renderActionButton(){const{device:e}=this.environment;return(0,v.jsx)(Ye.ZP,{popupType:e.isMobile?Ye.Z4.SlideUp:Ye.Z4.Popup,renderOrigin:e=>(0,v.jsx)(jt.Z,{icon:ce.o,iconStyle:{fill:ki(this.theme,this.props.hidden,this.colorStore)},style:_i(this.props.hidden,this.isHoveredStore),...e}),render:e=>(0,v.jsx)(xi,{parent:e,groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore})})}renderAddButton(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri,r=(0,ai.sN)(o);return(0,v.jsx)(et.ZP,{renderTooltip:()=>(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Create new {newItemName}",values:{newItemName:r},id:"database.boardView.actions.addNewItem.tooltip"}),render:e=>(0,v.jsx)(jt.Z,{icon:de.R,onClick:this.handleAddItemClick,style:_i(this.props.hidden,this.isHoveredStore),iconStyle:{fill:ki(this.theme,this.props.hidden,this.colorStore)},...e})})}}function vi(e){return(0,le.rD)(e.board_cover_size)}fi.displayName="BoardGroupHeader",fi.contextTypes={...mr.wK,...s.w};const yi=fi;function xi(e){let{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,collectionContextStore:s}=e;const l=s.boardColumnsLimitStore;return(0,v.jsx)(Ie,{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:l})}function bi(e){let{boardGroupHeaderProps:t}=e;window.__c={n:"ValueComponent"};const{groupFormat:o,schema:r,disabled:i,currentGroups:n,format:s,groupBy:l,collectionContextStore:a}=t,d=(0,oe.O7)(),u=vi(s),p=(0,c.VK)((()=>a.permissionScopes.state),[a]);return(0,c.VK)((()=>a.groupsStore.getGroupState(o)),[a,o])?(0,v.jsx)(dt.Z,{groupBy:l,groupFormat:o,currentGroups:n,schema:r,disabled:i||!p.canConfigureBlock,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:r}=o,i=r.collectionStore();i&&(L.w$({...e,environment:t,groupsFormatKey:"board_columns",collectionStore:i,...o}),F.wd({environment:t,collectionContextStore:r,action:"rename_group"}))}(e,d,t),style:{maxWidth:u-70},collectionContextStore:a}):null}function wi(e,t,o,r,i,n,s){const{device:l}=e,a=vi(o),c=s.state,d=Boolean(o.collection_group_by),u=r.isCompactView.state,p=u?kn:xn,h=u?_n:bn;return{display:"flex",alignItems:"center",fontSize:14,width:a,paddingLeft:p,paddingRight:p,marginRight:2*wn,marginBottom:t?4:0,boxSizing:"content-box",flexShrink:0,cursor:"pointer",...i&&{padding:l.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:a},...c&&!t&&{backgroundColor:n?c.peekBackgroundColor:c.backgroundColor,...d?{borderRadius:h}:{borderTopLeftRadius:h,borderTopRightRadius:h}}}}function ki(e,t,o){const r=o.state;return!t&&r?r.textColor:e.lightTextColor}function _i(e,t){if(!e)return{transition:"opacity 100ms ease-in-out",opacity:t.state?1:0}}var Ti=o(42853);const Vi=30,Oi=4;function Pi(e){window.__c={n:"CollectionHiddenGroupsButton"};const t=(0,c.VK)((()=>e.hiddenGroupsVisible.state),[e.hiddenGroupsVisible]);return(0,v.jsx)(Xe.Z,{onClick:function(){e.hiddenGroupsVisible.setState(!e.hiddenGroupsVisible.state)},onMouseDown:me.$0,style:{height:Vi,marginBottom:Oi,...e.style},icon:e=>(0,Ti.i)({...e,...t&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,v.jsx)(j.FormattedMessage,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}function Ri(e){window.__c={n:"CollectionGroupsBoardHiddenGroupsButton"};const t=(0,c.VK)((()=>e.columnsDisplayState.visibleGroups.length*(vi(e.format)+2*xn+2*wn)),[e.columnsDisplayState.visibleGroups,e.format]);return(0,v.jsx)("div",{style:{display:"flex",minWidth:t},children:(0,v.jsx)(Pi,{...e})})}const Mi=30,ji=4;function Ii(e){let{type:t,visibleGroups:o,hiddenGroups:r,total:i,groupsLimitStore:n,schema:s,collectionContextStore:l,style:a}=e;window.__c={n:"CollectionGroupsLoadMoreButton"};const d=(0,oe.O7)(),u=(0,re.Fg)(),p=(0,c.VK)((()=>l.normalizedFormatStore.state),[l]),h=(0,c.VK)((()=>qt({collectionContextStore:l,isForColumnGroups:"board"===t})),[l,t]),m=(0,c.VK)((()=>"board"===t?(0,ke.II)({environment:d,groupFormat:void 0,schema:s,format:p,collectionContextStore:l,theme:u}):void 0),[l,d,p,s,u,t]),S=(0,re.yK)((e=>({hovered:{background:e.whiteButtonBackground},dots:{width:14,fill:e.mediumTextColor,marginLeft:4,marginTop:1,..."default"===t?{marginRight:8}:{}},..."board"===t?{button:{background:null==m?void 0:m.backgroundColor,color:e.mediumTextColor,fontWeight:R.Z.fontWeight.medium,paddingLeft:8,paddingRight:8,height:33,marginRight:2*wn,borderRadius:bn,width:90,...a}}:{}})),[m,a,t]),g=Math.min(ke.kW,i-r.length-o.length);return"default"===t?(0,v.jsxs)(Xe.Z,{onClick:()=>function(e,t,o){o.setState(o.state+ke.kW),t.loadingDetails.setState({type:"load_more_groups"}),F.tf(e)}(d,l,n),onMouseDown:me.$0,disabled:h,hoveredStyle:h?S.hovered:{},style:{display:"flex",alignItems:"center",fontSize:14,borderRadius:4,height:Mi,marginTop:ji,marginBottom:ji,paddingLeft:2,paddingTop:2,paddingBottom:2,paddingRight:8,...a},children:[(0,ce.o)(S.dots),(0,v.jsx)(j.FormattedMessage,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:g}}),h&&(0,v.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,v.jsx)(Ue.Z,{style:{width:12,height:12}})})]}):(0,v.jsxs)(Xe.Z,{onClick:()=>function(e,t,o){o.setState(o.state+ke.kW),t.loadingDetails.setState({type:"load_more_columns"}),F.tf(e)}(d,l,n),onMouseDown:me.$0,disabled:h,hoveredStyle:h?S.hovered:{},style:S.button,children:[(0,v.jsx)("span",{style:{flexGrow:1},children:(0,v.jsx)(j.FormattedMessage,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:g}})}),h?(0,v.jsx)("div",{style:{marginLeft:4},children:(0,v.jsx)(Ue.Z,{style:{width:12,height:12}})}):(0,ce.o)(S.dots)]})}const Fi=i.memo(Ii,Jt.Z);var Bi=o(65742);function Ni(e){window.__c={n:"CollectionGroupsTimelineItemAddGroupButton"};const{format:t,isFullScreen:o,paddingLeft:r,isRootChild:i}=e,n=(0,oe.O7)(),s=(0,c.VK)((()=>(0,Bi.C1)({environment:n,format:t,isFullScreen:o,isRootChild:i})),[n,t,o,i]),l=(0,c.VK)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),a=(0,c.VK)((()=>(0,Bi.fj)({environment:n,isRootChild:i,isFullScreen:o,format:t})?Bi.Qw:r),[n,t,o,i,r]);return s||l?null:(0,v.jsx)("div",{style:{width:"100%",height:Ln+An,display:"flex"},children:(0,v.jsx)(Hn,{type:"default",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",left:e.isFullScreen?a:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Di(e){window.__c={n:"CollectionGroupsTimelineItemHiddenGroupsButton"};const{format:t,isFullScreen:o,isRootChild:r,paddingLeft:i}=e,n=(0,oe.O7)(),s=(0,c.VK)((()=>(0,Bi.C1)({environment:n,format:t,isFullScreen:o,isRootChild:r})),[n,t,o,r]),l=(0,c.VK)((()=>(0,Bi.fj)({environment:n,isRootChild:r,isFullScreen:o,format:t})?Bi.Qw:i),[n,t,o,r,i]);return s?null:(0,v.jsx)("div",{style:{width:"100%",height:Vi+Oi,display:"flex"},children:(0,v.jsx)(Pi,{...e,style:{position:"sticky",left:o?l:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Li(e){window.__c={n:"CollectionGroupsTimelineItemLoadMoreButton"};const{format:t,isFullScreen:o,isRootChild:r}=e,i=(0,oe.O7)(),n=(0,c.VK)((()=>(0,Bi.C1)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),s=(0,c.VK)((()=>(0,Bi.fj)({environment:i,isRootChild:r,isFullScreen:o,format:t})?Bi.Qw:e.paddingLeft),[i,t,o,r,e.paddingLeft]);return n?null:(0,v.jsx)("div",{style:{width:"100%",height:Mi+2*ji,display:"flex"},children:(0,v.jsx)(Fi,{type:"default",visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:e.groupsLimitStore,schema:e.schema,collectionContextStore:e.collectionContextStore,style:{position:"sticky",left:o?s:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}const Ai=(0,f.I)("collectionGroupAccordion",{svg:(0,v.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});var Ei=o(36596);function Zi(){window.__c={n:"TableGroupShimmer"};const e=(0,re.yK)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,v.jsxs)("div",{style:e.container,children:[(0,v.jsxs)("div",{style:e.groupContainer,children:[(0,v.jsx)("div",{style:e.iconContainer,children:Ai(e.icon)}),(0,v.jsx)(Ei.Z,{style:e.groupShimmer})]}),(0,v.jsxs)("div",{style:e.rowsContainer,children:[(0,v.jsxs)("div",{style:e.rowContainer,children:[(0,v.jsxs)("div",{style:e.firstColumn,children:[(0,v.jsx)(Ei.Z,{style:e.circleShimmer}),(0,v.jsx)(Ei.Z,{style:e.rowShimmerShort})]}),(0,v.jsx)("div",{style:e.column,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmerShort})}),(0,v.jsx)("div",{style:e.column,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmerShort})}),(0,v.jsx)("div",{style:e.column,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmerShort})})]}),(0,v.jsxs)("div",{style:e.rowContainer,children:[(0,v.jsxs)("div",{style:e.firstColumn,children:[(0,v.jsx)(Ei.Z,{style:e.circleShimmer}),(0,v.jsx)(Ei.Z,{style:e.rowShimmerLong})]}),(0,v.jsx)("div",{style:e.column,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmer})}),(0,v.jsx)("div",{style:e.column,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmer})}),(0,v.jsx)("div",{style:e.column,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmer})})]}),(0,v.jsxs)("div",{style:e.lastRowContainer,children:[(0,v.jsxs)("div",{style:e.firstColumn,children:[(0,v.jsx)(Ei.Z,{style:e.circleShimmer}),(0,v.jsx)(Ei.Z,{style:e.rowShimmerLong})]}),(0,v.jsx)("div",{style:e.column,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmer})}),(0,v.jsx)("div",{style:e.column,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmer})}),(0,v.jsx)("div",{style:e.column,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmer})})]})]})]})}function Hi(e){const{isFullScreen:t}=e,o=t?2:1,r=_.DZ(o,(e=>(0,v.jsx)(Zi,{},e)));return(0,v.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:r})}function zi(e){window.__c={n:"GalleryItemShimmer"};const t=e.minHeight||pn,o=(0,re.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,v.jsx)(Ei.Z,{style:o.card})}function Gi(e){window.__c={n:"GalleryGroupShimmer"};const{width:t}=e,o=(0,oe.O7)(),r=(0,c.VK)((()=>o.WindowSizeStore.state.width<=un),[o]),i=(0,re.yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${r?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,r]);return(0,v.jsxs)("div",{style:i.container,children:[(0,v.jsxs)("div",{style:i.groupContainer,children:[(0,v.jsx)("div",{style:i.iconContainer,children:Ai(i.icon)}),(0,v.jsx)(Ei.Z,{style:i.groupShimmer})]}),(0,v.jsxs)("div",{style:i.itemsContainer,children:[(0,v.jsx)(zi,{}),(0,v.jsx)(zi,{}),(0,v.jsx)(zi,{})]})]})}function Ki(e){const{isFullScreen:t,galleryCoverSize:o}=e,r=t?2:1,i=(0,le.rD)(o),n=_.DZ(r,(e=>(0,v.jsx)(Gi,{width:i},e)));return(0,v.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:n})}var Ui=o(66890);function Wi(e){window.__c={n:"ListItemShimmer"};const{widthPercentage:t}=e,o=(0,Ui.DK)(),r=(0,c.VK)((()=>null==o?void 0:o.isCompactView.state),[o]),i=(0,re.yK)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:r?12:16,height:r?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,r]);return(0,v.jsx)("div",{style:i.rowContainer,children:(0,v.jsxs)("div",{style:i.column,children:[(0,v.jsx)(Ei.Z,{style:i.circleShimmer}),(0,v.jsx)(Ei.Z,{style:i.rowShimmer})]})})}function $i(){window.__c={n:"ListGroupShimmer"};const e=(0,re.yK)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=["50%","30%","40%"].map(((e,t)=>(0,v.jsx)(Wi,{widthPercentage:e},t)));return(0,v.jsxs)("div",{style:e.container,children:[(0,v.jsxs)("div",{style:e.groupContainer,children:[(0,v.jsx)("div",{style:e.iconContainer,children:Ai(e.icon)}),(0,v.jsx)(Ei.Z,{style:e.groupShimmer})]}),(0,v.jsx)("div",{style:e.rowsContainer,children:t})]})}function qi(e){const{isFullScreen:t}=e,o=t?2:1,r=_.DZ(o,(e=>(0,v.jsx)($i,{},e)));return(0,v.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:r})}function Qi(){window.__c={n:"TimelineTableGroupsShimmer"};const e=(0,re.yK)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,v.jsxs)("div",{style:e.rowsContainer,children:[(0,v.jsx)("div",{style:e.rowContainer,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmerShort})}),(0,v.jsx)("div",{style:e.rowContainer,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmer})})]})}function Yi(e){window.__c={n:"GroupsShimmer"};const{viewType:t,isFullScreen:o,galleryCoverSize:r}=e;if(!(0,hr.Z)(!0,0,100))return null;switch(t){case"table":return(0,v.jsx)(Hi,{isFullScreen:o});case"list":return(0,v.jsx)(qi,{isFullScreen:o});case"gallery":return(0,v.jsx)(Ki,{isFullScreen:o,galleryCoverSize:r});case"timeline":return(0,v.jsx)(Qi,{});default:return null}}const Xi=new Set(["dropzone","table"]),Ji=new Set(["item","table"]),en=new Set(["table"]);function tn(e){window.__c={n:"CollectionGroupsFunctional"};const{collectionContextStore:t,timelineProps:o}=e,r=(0,oe.O7)(),n=(0,c.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,c.VK)((()=>t.permissionScopes.state),[t.permissionScopes]),l=(0,c.VK)((()=>t.normalizedFormatStore.state),[t.normalizedFormatStore]),a=(0,c.VK)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t]),d=null==l?void 0:l.app_config_uri,u=null==l?void 0:l.collection_group_by,p=null==l?void 0:l.board_columns_by,h=(0,c.VK)((()=>t.groupsLimit.state),[t]),m=(0,c.VK)((()=>t.boardColumnsLimitStore.state),[t]),S=(0,c.VK)((()=>t.normalizedSchemaStore.state),[t.normalizedSchemaStore]),g=(0,c.VK)((()=>{if(u)return(0,ie.Qq)({schema:S,groupBy:u})}),[u,S]),C=(0,c.VK)((()=>t.relativeVariableStore.state),[t.relativeVariableStore]),f=(0,c.VK)((()=>t.remoteRequestStore.state),[t.remoteRequestStore]),y=(0,c.VK)((()=>{if(!u||!l)return;if(null!=o&&o.type&&Xi.has(null==o?void 0:o.type))return;const e=Yt.default.checkGate("use_collection_reducer_request_hook")?(0,Ut.ze)(t,!0):null==f?void 0:f.loader.filter;return(0,ke.ej)({groupBy:u,schema:S,format:l,filter:e,groupsFormatKey:ie.Uh,limit:h})}),[u,l,o,t,null==f?void 0:f.loader.filter,S,h]),x=(0,c.qz)(null==o?void 0:o.reducerResultStore,ei),b=(0,c.qz)(null==o?void 0:o.hiddenGroupsVisible,Xr),w=(0,c.VK)((()=>b.state),[b]),k=(0,c.SI)((()=>{if(!n)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const e=x.state,t=e?e.results:void 0,o=(0,ke.Cz)({groupBy:u,schema:S,schemaGroups:g,formatGroups:(null==l?void 0:l[ie.Uh])||[],reducerResults:t,getRecordModel:n.getRecordModel,relativeVariableResult:C,viewAppConfigUri:d}),r=o.filter((e=>!(0,ie.eF)(e))).slice(0,h),i=o.filter((e=>(0,ie.eF)(e))),s=e?e.total:0;return{currentGroups:[...r,...i],visibleGroups:r,hiddenGroups:i,total:s}}),[n,l,u,h,x,C,S,g,d],{useDeepEqual:!0}),_=(0,c.VK)((()=>k.state),[k]),T=(0,c.VK)((()=>{if(!n||!p)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const e=x.state,t=e?e.results:void 0,o=(0,ke.Cz)({groupBy:u,schema:S,schemaGroups:g,formatGroups:(null==l?void 0:l.board_columns)||[],reducerResults:t,getRecordModel:n.getRecordModel,relativeVariableResult:C,viewAppConfigUri:d}),r=o.filter((e=>!(0,ie.eF)(e))).slice(0,m),i=o.filter((e=>(0,ie.eF)(e))),s=e?e.total:0;return{currentGroups:[...r,...i],visibleGroups:r,hiddenGroups:i,total:s}}),[m,n,l,u,p,x,C,S,g,d],{useDeepEqual:!0}),V=i.useCallback((()=>{l&&L.$D({environment:r,format:l,groupsFormatKey:ie.Uh,collectionContextStore:t,currentGroups:k.state.currentGroups})}),[l,r,k,t]);i.useEffect((()=>{if(null==o||!o.type||!Xi.has(null==o?void 0:o.type))return k.addListener(V),()=>{k.removeListener(V)}}),[k,V,o]);const O=(0,c.VK)((()=>_.hiddenGroups.slice(0,ke.ew)),[_.hiddenGroups]),P=(0,c.VK)((()=>!(null!=o&&o.type&&Ji.has(null==o?void 0:o.type))&&$t({collectionContextStore:t,displayState:_})),[t,_,o]),R=(0,c.VK)((()=>{const{visibleGroups:e}=_;return 0===e.length&&!t.shouldShowSpinner.state||e.length>0}),[t,_]),M=(0,c.VK)((()=>{const{total:e,hiddenGroups:o}=k.state;return h<e-o.length&&R||qt({collectionContextStore:t,isForColumnGroups:!1})}),[R,t,k,h]),j=(0,c.VK)((()=>!e.disabled&&!s.isLocked&&s.canConfigureBlock&&!P&&u&&(0,ie.Wz)(u,s.canConfigureCollection)&&"collectionTypedView"!==t.contextType&&!(0,Kt.wl)(u.property)&&R),[R,t,s.canConfigureBlock,s.canConfigureCollection,s.isLocked,e.disabled,u,P]);if(!l)return null;const I=(0,v.jsxs)("div",{style:{position:"relative"},children:[(0,v.jsx)(rn,{groups:_.visibleGroups,groupBy:u,groupsDisplayState:_,format:l,schema:S,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:o}),P&&(0,v.jsx)(Yi,{viewType:a,isFullScreen:e.isFullScreen,galleryCoverSize:l.gallery_cover_size}),M&&(0,v.jsx)(nn,{timelineType:null==o?void 0:o.type,collectionContextStore:e.collectionContextStore,schema:S,format:l,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:_}),O.length>0&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ln,{reducerId:e.reducerId,timelineType:null==o?void 0:o.type,format:l,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,columnsDisplayState:T,hiddenGroups:O,hiddenGroupsVisible:b}),w&&(0,v.jsx)(rn,{groups:O,groupBy:u,groupsDisplayState:_,format:l,schema:S,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:o})]}),j&&(0,v.jsx)(sn,{timelineType:null==o?void 0:o.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:S,format:l,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:_,groupBy:u})]});return y?(0,v.jsx)(Ke.Z,{id:e.reducerId,reducer:y,collectionContextStore:e.collectionContextStore,resultStore:x,render:()=>I}):I}const on=i.memo(tn,Jt.Z);function rn(e){window.__c={n:"Groups"};const t=(0,c.VK)((()=>e.collectionContextStore.groupsStore.getGroupState),[e.collectionContextStore.groupsStore]),o=(0,c.VK)((()=>e.collectionContextStore.isInPeekRenderer.state),[e.collectionContextStore]);return(0,v.jsx)(v.Fragment,{children:e.groups.map(((r,i)=>{var n,s;return t&&e.groupBy?(0,v.jsx)(li,{collectionContextStore:e.collectionContextStore,groupsDisplayState:e.groupsDisplayState,groupFormat:r,groupBy:e.groupBy,disabled:e.disabled,groupsFormatKey:ie.Uh,groupAggregationKey:ie.dQ,format:e.format,schema:e.schema,isInPeekRenderer:o,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,getGroupStyle:e.getGroupStyle,ignoreAncestorStickyContainer:(null===(n=e.timelineProps)||void 0===n?void 0:n.type)&&en.has(null===(s=e.timelineProps)||void 0===s?void 0:s.type),index:i,isLast:i===e.groups.length-1},(0,ie.mD)(r)):null}))})}function nn(e){window.__c={n:"LoadMoreGroupsButton"};const t=(0,c.VK)((()=>e.collectionContextStore.groupsLimit),[e.collectionContextStore]);return"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,v.jsx)(Li,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:t,visibleGroups:e.groupsDisplayState.visibleGroups,hiddenGroups:e.groupsDisplayState.hiddenGroups,total:e.groupsDisplayState.total,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,v.jsx)("div",{style:{display:"flex"},children:(0,v.jsx)(Fi,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:t,visibleGroups:e.groupsDisplayState.visibleGroups,hiddenGroups:e.groupsDisplayState.hiddenGroups,total:e.groupsDisplayState.total,style:e.stickyLeft?{position:"sticky",left:e.paddingLeft}:void 0})})}function sn(e){window.__c={n:"AddGroupButton"};const t=(0,oe.O7)(),o=(0,c.VK)((()=>e.collectionContextStore.groupsLimit),[e.collectionContextStore]),r=i.useCallback(((e,t,o,r,i)=>{const n=o.collectionStore();n&&L.tH({update:e,collectionContextStore:o,groupsFormatKey:ie.Uh,collectionStore:n,environment:t,groupBy:r,schema:i})}),[]);return"dropzone"!==e.timelineType&&e.groupBy?"item"===e.timelineType?(0,v.jsx)(Ni,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):(0,v.jsx)(Hn,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,paddingLeft:e.paddingLeft,stickyLeft:!0,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):null}function ln(e){return"board_collection_groups"===e.reducerId?(0,v.jsx)(Ri,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisible:e.hiddenGroupsVisible,format:e.format,columnsDisplayState:e.columnsDisplayState}):"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,v.jsx)(Di,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisible:e.hiddenGroupsVisible,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,v.jsx)("div",{style:{display:"flex"},children:(0,v.jsx)(Pi,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisible:e.hiddenGroupsVisible,style:{marginTop:10,...e.stickyLeft?{position:"sticky",left:e.paddingLeft}:{}}})})}var an=o(43145),cn=o(17311);function dn(e){window.__c={n:"GalleryShimmer"};const{hasPartialResults:t}=e;if(!(0,hr.Z)(!0,0,100))return null;const o=e.coverHeight??cn.Z.card.desktop.medium.height,r=t?void 0:o+40,i=t?1:3,n=_.DZ(i,(e=>(0,v.jsx)(zi,{minHeight:r},e)));return(0,v.jsx)(v.Fragment,{children:n})}const un=480,pn=40;class hn extends s.Z{constructor(){super(...arguments),this.storeTypes={collectionGalleryViewStore:fr},this.selectableContainer=null,this.renderGroup=e=>{const{store:t,format:o,disabled:r,collectionContextStore:i,schema:n,blockPropertyValueOverlayStore:s,isFullScreen:l}=this.props,{collectionGalleryViewStore:a}=this.stores,c=this.isSingleColumnStore.state,d=this.isReady.state,u=e?[e]:[],p=i.groupsStore.getGroupState(u);if(!p)return;const h=p.reducerResultStore.state,m=void 0!==e,S=void 0!==h&&(null==h?void 0:h.blockIds.length)>0,g=Wt({collectionContextStore:i,groupsPointer:u,hasPartialResults:S}),C=le.VM({collectionContextStore:i,reducerResult:h,isFullScreen:l}),f=i.permissionScopes.state,y=f.isSyncedCollection,x=t.canEdit()&&("collectionTypedView"===i.contextType||f.canEditContent),b=d&&!r&&x&&!y&&(S||!g);return(0,v.jsxs)("div",{style:{paddingBottom:e?16:void 0},children:[(0,v.jsxs)("div",{style:this.getGroupWrapStyle(),children:[(0,v.jsx)(Hr,{collectionContextStore:i,groupFormat:e,format:o,schema:n,disabled:r,store:t,blockPropertyValueOverlayStore:s,collectionGalleryViewStore:a,isSingleColumn:c}),g&&(0,v.jsx)(dn,{hasGroups:m,hasPartialResults:S,coverHeight:a.state.coverHeight}),b&&this.renderAddItemButton(u)]}),C&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,v.jsx)(qr,{groupsPointer:u,store:t,collectionContextStore:i,format:o,isFullScreen:l,incrementLimitsInRelatedGroups:!1})]})]})},this.handleResize=()=>{const{collectionGalleryViewStore:e}=this.stores,t=this.getGalleryCardCoverHeight(),o=this.getGalleryCardActualWidth();e.state.coverHeight!==t&&this.setCardCoverHeight(t),e.state.coverWidth!==o&&fn(this.props.format,this.stores.collectionGalleryViewStore,o)},this.handleResizeDebounced=(0,_.Ds)(this.handleResize,1e3),this.handleResizeThrottled=(0,_.P2)(this.handleResize,100),this.handleAddItemClick=(e,t)=>{if(!Ce.M_(this.environment))return;const{collectionContextStore:o}=this.props,r=o.groupsStore.getGroupState(e);r&&Q.createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:this.environment,perform:i=>{const{mainEditorCurrentBlockStore:n}=Lo.default.state,s=L.IW({environment:this.environment,collectionContextStore:o,groupsPointer:e,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"gallery",useCrdt:t});if(!s)return;const l=le.mb({store:s.newStore,mainEditorCurrentBlockStore:n,collectionContextStore:o})??(0,Bo.ZP)({store:s.newStore,pageVisitSource:u.tY.Create});this.navigate(l),H.Xd({collectionContextStore:o,resultsStore:r.resultsStore}),ue.W(this.environment,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,he.Pn)(o)})}})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=e=>function(e,t,o){t.device.isMobile?ne._({environment:t,store:e,pageVisitSource:u.tY.Create}):se.CH({environment:t,store:e,peekMode:le.kr(o.collectionViewStore()),resultsStore:void 0,collectionContextStore:o,pageVisitSource:u.tY.Create})}(e,this.environment,this.props.collectionContextStore),this.isSingleColumnStore=this.createComputedStore((()=>this.environment.WindowSizeStore.state.width<=un)),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):G.c4({environment:this.environment,url:e})}didUpdate(e){(e.format||{}).gallery_cover_size!==(this.props.format||{}).gallery_cover_size&&(this.setCardCoverHeight(),fn(this.props.format,this.stores.collectionGalleryViewStore))}didMount(){fn(this.props.format,this.stores.collectionGalleryViewStore),this.setCardCoverHeight(),(0,Sr.lj)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,Sr.lj)(window,"orientationchange",this.handleResizeDebounced)}willUnmount(){(0,Sr.ZV)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,Sr.ZV)(window,"orientationchange",this.handleResizeDebounced)}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:i,isFullScreen:n,collectionContextStore:s}=this.props,l=le.az(s,n),a=t.collection_group_by,c=s.isCompactView.state;return(0,gr.Z)((t=>(0,v.jsxs)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth},className:ro.sbt,children:[(0,v.jsx)(It.Z,{store:e,shouldShowHalo:!n&&!c,canSelect:!n,analyticsName:"gallery",...t,ref:e=>this.selectableContainer=e,children:a?this.renderGroups(a):this.renderGroup(void 0)}),!l&&(0,v.jsx)(an.Z,{onChange:e=>function(e,t,o,r){var i;const n=o.isLoading.state,s=null===(i=function(e){var t;return null===(t=e.groupsStore.getGroupState([]))||void 0===t?void 0:t.reducerResultStore}(o))||void 0===i?void 0:i.state;e<no.Z.incrementScrollOffset&&s&&!n&&null!=s&&s.hasMore&&L.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,ke.hJ)()?(0,v.jsx)(on,{reducerId:"gallery_groups",store:t,collectionContextStore:r,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderGroup,getGroupStyle:e=>gn(e,this.theme),renderHeader:e=>(0,v.jsx)(Cn,{args:e}),onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem}):(0,v.jsx)(Gn,{store:t,id:"gallery_groups",groupBy:e,groupsFormatKey:ie.Uh,groupAggregationKey:ie.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderGroup,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,renderHeader:e=>(0,v.jsx)(Cn,{args:e}),getGroupStyle:e=>gn(e,this.theme),paddingLeft:l,isRootChild:a,isInPeekRenderer:c})}renderAddItemButton(e){return(0,v.jsx)(ko.Z,{onClick:t=>this.handleAddItemClick(e,(0,so.SL)({event:t,source:"collection_non_table_view"})),onMouseDown:me.$0,style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,borderRadius:4,boxShadow:"dark"===this.theme.mode?`${this.theme.darkDividerColor} 0px 0px 0px 1px inset`:`${this.theme.regularDividerColor} 0px 0px 0px 1px inset`,minHeight:pn},children:(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:-6},children:[(0,de.R)((t=this.theme,{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor})),(0,v.jsx)("div",{style:{color:this.theme.lightIconColor},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.galleryView.addItemButtonTitle"})})]})});var t}setCardCoverHeight(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverHeight:e||this.getGalleryCardCoverHeight()})}getGalleryCardActualWidth(){if(this.selectableContainer){const e=this.selectableContainer.getNode();if(e){const t=e.querySelector(`.${ro.K4T}`);if(t)return t.offsetWidth}}return Sn(this.props.format)}getGalleryCardCoverHeight(){return this.getGalleryCardActualWidth()*(9/16)}getGroupWrapStyle(){const e=this.props.format.collection_group_by,t=this.isSingleColumnStore.state,o=this.props.collectionContextStore.isCompactView.state;return{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${t?"100%":`${Sn(this.props.format)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:e?1:16,paddingBottom:4,...o?{paddingLeft:8,paddingRight:8}:{}}}}hn.displayName="CollectionGalleryView",hn.contextTypes={...mr.wK,...s.w};const mn=hn;function Sn(e){const t=e.gallery_cover_size;return le.rD(t)}function gn(e,t){return 0===e.index?{}:{borderTop:`1px solid ${t.tableDividerColor}`}}function Cn(e){let{args:t}=e;window.__c={n:"GroupHeaderComponent"};const o=(0,re.Fg)(),r=(0,c.VK)((()=>t.collectionContextStore.isCompactView.state),[t.collectionContextStore]);return(0,v.jsx)(Nt,{...t,height:r?io.yZ:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,o)})}function fn(e,t,o){t.setState({...t.state,coverWidth:o||Sn(e)})}function vn(e){window.__c={n:"BoardItemShimmer"};const t=e.minHeight||pn,o=(0,re.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,v.jsx)(Ei.Z,{style:o.card})}function yn(){window.__c={n:"BoardShimmer"};return(0,hr.Z)(!0,0,100)?(0,v.jsx)(vn,{}):null}const xn=5,bn=5,wn=5,kn=8,_n=8;function Tn(e,t){return t?0:e?8:12}class Vn extends s.Z{constructor(){super(...arguments),this.isReady=this.createComputedStore((()=>{const{groupsPointer:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);return Boolean(null==o?void 0:o.reducerResultStore.state)})),this.colorStore=this.createComputedStore((()=>{const{groupsPointer:e,schema:t,format:o,collectionContextStore:r}=this.props,i=_.Z$(e);return(0,ke.II)({environment:this.environment,groupFormat:i,schema:t,format:o,collectionContextStore:r,theme:this.theme})}))}renderComponent(){var e;const{store:t,groupsPointer:o,collectionContextStore:r,disabled:i,format:n,schema:s,blockPropertyValueOverlayStore:l,isFullScreen:a,anyGroupHasResults:c}=this.props,d=r.groupsStore.getGroupState(o);if(!d)return;const u=this.isReady.state,p=function(e){return e?e.board_cover:void 0}(this.props.format),h=(0,le.az)(r,a),m=d.reducerResultStore.state,S=r.permissionScopes.state,g=!i&&u&&r.shouldAllowNewItemCreation(),C=!i&&!S.isSyncedCollection,f=(0,le.VM)({reducerResult:m,collectionContextStore:r,isFullScreen:a}),y=Boolean(n.collection_group_by),x=!c&&y&&Wt({collectionContextStore:r,groupsPointer:o,hasPartialResults:c}),b=c&&r.shouldShowSpinner.state&&"load_general"===r.loadingDetails.state.type;return(0,v.jsxs)("div",{style:Nn(this.props.format,this.props.collectionContextStore,this.props.isInPeekRenderer,this.isReady,this.colorStore),onMouseDown:e=>function(e,t){const{device:o}=t,{target:r}=e;!o.isMobile&&r instanceof HTMLElement&&(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),z.AI({environment:t,target:r,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onClick:In,className:ro.GfL,onMouseMove:()=>function(e,t){const o=_.Z$(e);o&&t.state!==o&&t.setState(o)}(this.props.groupsPointer,this.props.hoveredGroupStore),children:[(0,v.jsx)(Ar,{collectionContextStore:r,groupsPointer:o,format:n,canDrag:C,onSelectableEnter:e=>Fn(e,this.props.groupsPointer,this.props.collectionContextStore,this.props.isFullScreen,this.environment),resultProps:{format:n,schema:s,onTextEnter:e=>function(e,t,o,r,i,n){if(!Ce.M_(n)||!o.collectionStore())return Bn(e,o,i,t,n);const s=jn(t,o);if(!s)return;const l=s.state.findIndex((t=>t===e))+1;Q.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:n,perform:e=>{oo({transaction:e,environment:n,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:l,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}})}(e,this.props.groupsPointer,this.props.collectionContextStore,this.props.isFullScreen,this.props.store,this.environment),onShiftEnter:e=>Fn(e,this.props.groupsPointer,this.props.collectionContextStore,this.props.isFullScreen,this.environment),coverFormat:p,coverAspectFormat:Pn(this.props.format),coverSizeFormat:Rn(this.props.format),shouldShowTitle:io.K8(this.props.format,"board"),colorStyle:this.colorStore.state,onTextEsc:e=>Bn(e,this.props.collectionContextStore,this.props.store,this.props.groupsPointer,this.environment),disabled:i,blockPropertyValueOverlayStore:l,collectionContextStore:r},canDrop:!0,resultComponent:pr,disabled:i,direction:Dr.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:y?xn:3,analyticsName:"board",loadContentCover:p&&"page_content"===p.type}),x&&(0,v.jsx)(yn,{}),f&&(0,v.jsx)(qr,{groupsPointer:o,store:t,collectionContextStore:r,format:n,isFullScreen:a,incrementLimitsInRelatedGroups:!0}),g&&(0,v.jsxs)(v.Fragment,{children:[f&&(0,v.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,v.jsx)(lo,{groupsPointer:o,collectionContextStore:r,isFullScreen:a,color:null===(e=this.colorStore.state)||void 0===e?void 0:e.textColor,shouldShowSpinner:b})]}),!h&&(0,v.jsx)(an.Z,{onChange:e=>function(e,t,o,r,i){const n=t.isLoading.state,s=t.groupsStore.getGroupState(r),l=null==s?void 0:s.reducerResultStore.state;e<no.Z.incrementScrollOffset&&!n&&l&&l.hasMore&&(L.ID({collectionContextStore:t,environment:i,incrementLimitArgs:{isFullScreen:o,currentResultCount:l.blockIds.length,groupsPointer:r,incrementLimitsInRelatedGroups:!1}}),t.loadingDetails.setState({type:"load_general"}))}(e,this.props.collectionContextStore,this.props.isFullScreen,this.props.groupsPointer,this.environment)})]})}}Vn.displayName="BoardGroupResults";const On=(0,j.injectIntl)(Vn);function Pn(e){return e?e.board_cover_aspect:void 0}function Rn(e){return e?e.board_cover_size:void 0}function Mn(e){const t=e.board_cover_size;return(0,le.rD)(t)}function jn(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function In(e){(0,me.ZP)({event:e,context:me.Af.EditorClick,callback:()=>{}})}function Fn(e,t,o,r,i){const{blocks:n,transaction:s}=e;if(0===n.length)return;const l=n[0];if(!Ce.M_(i)||!o.collectionStore()||!o.shouldAllowNewItemCreation())return;const a=jn(t,o);if(!a)return;oo({transaction:s,environment:i,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:a.state.findIndex((e=>e===l))+1,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}function Bn(e,t,o,r,i){const n=t.collectionStore(),s=e.getTitleStore();if(!s)return;if(to.QaF(s.getValue()))W.Ys({environment:i,store:e});else if(n){const n=jn(r,t);if(!n)return;const s=n.state.findIndex((t=>t===e))-1,l=t.collectionViewStore(),a=t.collectionViewBlockStore();if(l&&a&&I.sG(i,{...(0,he.Pn)(t),block_id:o.id}),Q.createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:i,perform:t=>{L.Od({store:e,transaction:t})}}),s>=0){const e=n.state[s];W.Ys({environment:i,store:e})}}}function Nn(e,t,o,r,i){const n=r.state,s=i.state,l=Boolean(e.collection_group_by),a=t.isCompactView.state,c=a?kn:xn,d=a?_n:bn;return{flex:"none",paddingLeft:c,paddingRight:c,paddingBottom:c,marginRight:2*wn,boxSizing:"content-box",width:Mn(e),height:l?void 0:"max-content",...s&&n&&{backgroundColor:o?s.peekBackgroundColor:s.backgroundColor,...l?{borderRadius:d}:{borderBottomLeftRadius:d,borderBottomRightRadius:d}}}}var Dn=o(68500);const Ln=28,An=4,En=(0,j.defineMessages)({iconAriaLabel:{defaultMessage:"Add a group",id:"database.collectionAddGroupButton.ariaLabel"}});function Zn(e){let{type:t,style:o,groupBy:r,currentGroups:n,schema:s,groupsLimitStore:l,collectionContextStore:a,parentStore:d,onAccept:u,paddingLeft:p,stickyLeft:h}=e;window.__c={n:"CollectionAddGroupButton"};const m=(0,oe.O7)(),S=(0,re.Fg)(),g=(0,c.qz)(void 0,eo.Z),C=s[r.property],f=(0,c.VK)((()=>(0,ke.II)({environment:m,groupFormat:void 0,schema:s,format:a.normalizedFormatStore.state,collectionContextStore:a,theme:S})),[a,m,s,S]),y=(0,re.yK)((e=>({plusIcon:{fill:e.mediumTextColor},iconButton:{width:35,background:null==f?void 0:f.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:xn,paddingBottom:xn,marginRight:wn,borderRadius:bn,height:33,...o}})),[f,o]),x=(0,i.useCallback)((e=>{!function(e){let{schema:t,groupBy:o,currentGroups:r,groupsLimitStore:i,collectionContextStore:n,onAccept:s,environment:l,buttonPopupStore:a,update:c}=e;const{newGroupValue:d}=c,u=t[o.property],p=i.state;if(!u||!(0,ie.LG)(u))return;if(F.wd({environment:l,collectionContextStore:n,action:"board_add_group"}),a.reset(),fe.cu(u)){if(u.type!==d.type)return;if(void 0===d.value)return;const e=u.options||[],i={id:(0,Xt.ZP)(),value:d.value,color:(0,fe.TL)(e)},n=[...e,i],l={...u,options:n},a={...t,[o.property]:l},c={property:o.property,value:d,hidden:!1};return void s({newGroups:(0,ke.nr)(r,c,p),newSchema:a})}if("person"===u.type||"relation"===u.type||(0,ie.HB)(u.type)){const e={property:o.property,value:d,hidden:!1};return void s({newGroups:(0,ke.nr)(r,e,p),newPage:c.newPage})}if((0,ie.A1)(u.type)||"status"===u.type||"number"===u.type||"created_by"===u.type||"last_edited_by"===u.type||"formula"===u.type||"checkbox"===u.type||"location"===u.type)return;(0,ut.t1)(u.type)}({schema:s,groupBy:r,currentGroups:n,groupsLimitStore:l,collectionContextStore:a,onAccept:u,environment:m,buttonPopupStore:g,update:e})}),[g,a,n,m,r,l,u,s]),b=(0,i.useCallback)((()=>{!function(e){e.reset()}(g)}),[g]),w=(0,i.useCallback)((()=>(0,v.jsx)(Dn.Z,{groupFormat:void 0,groupBy:r,currentGroups:n,schema:s,onChange:x,onClose:b,parentStore:d})),[n,r,x,b,d,s]);return C&&(0,ie.LG)(C)?(0,v.jsx)(Ye.ZP,{render:w,buttonPopupStore:g,popupType:m.device.isMobile?Ye.Z4.SlideUp:Ye.Z4.Popup,renderOrigin:e=>"default"===t?(0,v.jsx)(Xe.Z,{isLightGray:!0,icon:de.R,style:{display:"flex",height:Ln,marginTop:12,marginBottom:An,width:"max-content",position:h?"sticky":void 0,left:h&&p?p:0,...o},...e,children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"})}):(0,v.jsx)(jt.Z,{ariaLabel:ze.default.formatMessage(En.iconAriaLabel),icon:e=>(0,de.R)({...e,...y.plusIcon}),style:y.iconButton,...e})}):null}const Hn=i.memo(Zn,Jt.Z);class zn extends s.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:d.default.createClass(void 0),hiddenGroupsVisible:d.default.createClass(!1)},this.renderResult=e=>{var t,o,r;const{disabled:i,collectionContextStore:n,groupBy:s,isFullScreen:l,shouldSurpressShimmer:a,format:c}=this.props,d=n.groupsLimit.state,u=e.hiddenGroups.slice(0,ke.ew),p=n.permissionScopes.state,h=!a&&$t({collectionContextStore:n,displayState:e}),m=null===(t=n.collectionViewStore())||void 0===t?void 0:t.getType(),{visibleGroups:S,hiddenGroups:g,total:C}=e,f=0===S.length&&!n.shouldShowSpinner.state||S.length>0,y=d<C-g.length&&f||qt({collectionContextStore:n,isForColumnGroups:!1}),x=!i&&!p.isLocked&&p.canConfigureBlock&&!h&&(0,ie.Wz)(s,p.canConfigureCollection)&&"collectionTypedView"!==n.contextType&&!(0,Kt.wl)(s.property)&&f,b=null===(o=(r=this.props).renderGroupsLoadMoreButton)||void 0===o?void 0:o.call(r,{visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:this.props.collectionContextStore.groupsLimit,type:"default",schema:this.props.schema,collectionContextStore:n});return(0,v.jsxs)("div",{style:{position:"relative"},children:[this.renderGroups(e.visibleGroups),h&&(0,v.jsx)(Yi,{viewType:m,isFullScreen:l,galleryCoverSize:c.gallery_cover_size}),y&&(0,v.jsx)(Kn,{loadMoreButtonOverride:b,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,displayState:e,style:this.props.stickyLeft?{position:"sticky",left:this.props.paddingLeft}:void 0}),u.length>0&&(0,v.jsxs)(v.Fragment,{children:[this.renderHiddenGroupsButton(u),this.stores.hiddenGroupsVisible.state&&this.renderGroups(u)]}),x&&this.renderAddGroupButton()]})},this.renderGroup=(e,t,o)=>{const{renderGroup:r,disabled:i,groupsFormatKey:n,groupAggregationKey:s,format:l,schema:a,collectionContextStore:c,isFullScreen:d,onGroupHeaderAddItem:u,renderHeader:p,getGroupStyle:h,stickyLeft:m,ignoreAncestorStickyContainer:S,paddingLeft:g,isRootChild:C,groupBy:f,isInPeekRenderer:y}=this.props,x=t===o.length-1;if(c.groupsStore.getGroupState(e))return(0,v.jsx)(li,{groupBy:f,groupFormat:e,groupsDisplayState:this.groupsDisplayStateStore.state,disabled:i,groupsFormatKey:n,groupAggregationKey:s,format:l,schema:a,collectionContextStore:c,isFullScreen:d,isRootChild:C,renderGroup:r,onGroupHeaderAddItem:u,renderHeader:p,getGroupStyle:h,stickyLeft:m,ignoreAncestorStickyContainer:S,paddingLeft:g,index:t,isLast:x,isInPeekRenderer:y},(0,ie.mD)(e))},this.handleGroupsChange=()=>{const{format:e,groupsFormatKey:t,collectionContextStore:o}=this.props,r=this.groupsDisplayStateStore.state.currentGroups;L.$D({environment:this.environment,format:e,groupsFormatKey:t,collectionContextStore:o,currentGroups:r})},this.handleGroupsChangeDebounced=_.Ds(this.handleGroupsChange,5e3),this.reducerStore=this.createComputedStore((()=>{const{groupBy:e,disableReducerRequest:t,schema:o,format:r,groupsFormatKey:i,collectionContextStore:n}=this.props,s=n.remoteRequestStore.state;if(t)return;const l=Yt.default.checkGate("use_collection_reducer_request_hook")?(0,Ut.ze)(n,!0):null==s?void 0:s.loader.filter;return(0,ke.ej)({groupBy:e,schema:o,format:r,filter:l,groupsFormatKey:i,limit:n.groupsLimit.state})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{schema:e,groupBy:t}=this.props;return(0,ie.Qq)({schema:e,groupBy:t})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupBy:t,groupsFormatKey:o,format:r,schema:i,collectionContextStore:n}=this.props,s=n.groupsLimit.state,l=n.collectionViewBlockStore();if(!l)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const a=this.schemaGroupsStore.state,c=this.stores.reducerResultStore.state,d=c?c.results:void 0,u=c?c.total:0,p=(0,ke.Cz)({groupBy:t,schema:i,formatGroups:r[o]||[],schemaGroups:a,reducerResults:d,getRecordModel:l.getRecordModel,relativeVariableResult:n.relativeVariableStore.state,viewAppConfigUri:null===(e=n.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),h=p.filter((e=>!(0,ie.eF)(e))).slice(0,s),m=p.filter((e=>(0,ie.eF)(e)));return{currentGroups:[...h,...m],visibleGroups:h,hiddenGroups:m,total:u}}),!0)}UNSAFE_willMount(e){const{disableReducerRequest:t}=this.props;t||this.groupsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.groupsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}renderComponent(){const e=this.reducerStore.state,t=this.groupsDisplayStateStore.state;return e?(0,v.jsx)(Ke.Z,{id:this.props.id,reducer:e,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderResult(t)}):this.renderResult(t)}renderGroups(e){return e.map(this.renderGroup)}renderHiddenGroupsButton(e){const{renderHiddenGroupsButton:t}=this.props;return t?t({hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e}):(0,v.jsx)("div",{style:{display:"flex"},children:(0,v.jsx)(Pi,{style:{marginTop:10,...this.props.stickyLeft?{position:"sticky",left:this.props.paddingLeft}:{}},hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e})})}renderAddGroupButton(){const{schema:e,groupBy:t,renderAddGroupButton:o,collectionContextStore:r,paddingLeft:i}=this.props,n=this.groupsDisplayStateStore.state.currentGroups;return o?o({groupBy:t,schema:e,currentGroups:n,onAccept:e=>Un(e,this.environment,this.props.collectionContextStore,this.props.groupsFormatKey,this.props.groupBy,this.props.schema),groupsLimitStore:r.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:r}):(0,v.jsx)(Hn,{groupBy:t,schema:e,currentGroups:n,onAccept:e=>Un(e,this.environment,this.props.collectionContextStore,this.props.groupsFormatKey,this.props.groupBy,this.props.schema),groupsLimitStore:r.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:r,paddingLeft:i,stickyLeft:!0})}}zn.displayName="CollectionGroups";const Gn=zn;function Kn(e){let{displayState:t,loadMoreButtonOverride:o,collectionContextStore:r,schema:i,style:n}=e;const{groupsLimit:s}=r;return o?(0,v.jsx)(v.Fragment,{children:o}):(0,v.jsx)("div",{style:{display:"flex"},children:(0,v.jsx)(Fi,{visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:s,type:"default",schema:i,collectionContextStore:r,style:n})})}function Un(e,t,o,r,i,n){const s=o.collectionStore();s&&L.tH({update:e,collectionContextStore:o,groupsFormatKey:r,collectionStore:s,environment:t,groupBy:i,schema:n})}class Wn extends d.default{getInitialState(){return{}}}const $n=Wn;var qn=o(1742);function Qn(e){window.__c={n:"CollectionNestedCreateSubitemButton"};const t=(0,oe.O7)(),{store:o,collectionContextStore:r,disabled:n,groupsPointer:s,collectionStore:l,subitemPath:a,indentLevel:d,onSubitemCreate:u}=e,p=(0,c.VK)((()=>(0,le.fk)({environment:t,collectionContextStore:r})),[r,t]),h=(0,c.VK)((()=>{var e;return"timeline"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[r]),m=(0,c.VK)((()=>{var e;return"title"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[r]),S=(0,c.VK)((()=>(0,_r.f2)({columnIndex:0,titleColumnIndex:0,shouldShowBulkActionsToolbar:p,indentLevel:d+1,isSubitemToggleOnTitleColumn:m})),[d,m,p]),g=(0,re.yK)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:S,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...h&&{borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:S+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[S,h,e.styles]),C=(0,c.VK)((()=>{const e=r.permissionScopes.state,t=l.isSyncedCollection();return!n&&e.canEditContent&&!t}),[r,n,l]),f=(0,i.useCallback)((()=>{Q.createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,perform:e=>{const i=L.yk({environment:t,collectionContextStore:r,groupsPointer:s,store:o,before:!1,collectionStore:l,transaction:e,subitemPath:a,subitemInsertDirection:"into",from:"cvb_new_subitem"});i&&u(i)}}),I.JE(t,{...(0,he.Pn)(r)})}),[r,t,s,l,o,a,u]);return C?(0,v.jsx)(ko.Z,{onClick:f,onMouseDown:me.$0,style:g.newRowButton,children:(0,v.jsxs)("span",{style:g.newRowContainer,children:[(0,de.R)(g.newIcon),(0,v.jsx)("span",{style:g.newText,children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})}):null}var Yn=o(73959),Xn=o(73819),Jn=o(68709),es=o(50959),ts=o(23063),os=o(3072),rs=o(29376),is=o(4023);function ns(e){window.__c={n:"TableAggregation"};const{disabled:t,property:o,schema:r,collectionContextStore:n,groupFormat:s,isHovered:l,aggregation:a,onChange:d}=e,u=(0,oe.O7)(),p=(0,j.useIntl)(),{isMobile:h}=(0,oe.Fy)(),[m,S]=(0,i.useState)(void 0),g=(0,c.VK)((()=>{if(!a)return;return{type:"aggregation",filter:s?(0,Ae.zk)({schema:r,propertyMapping:void 0,group:s,timeZone:(0,Ee.r)()}):void 0,aggregation:a}}),[r,s,a]),C=(0,i.useCallback)((e=>{if(e){const t={aggregator:e,property:o};d(o,t),S(t),I.wd(u,{view_type:"table",action:"table_change_aggregation"}),zr.j({name:"collection_change_aggregation"})}else d(o,void 0),I.wd(u,{view_type:"table",action:"table_remove_aggregation"})}),[u,d,o]),f=(0,re.yK)((()=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto"}})),[]),y=(0,c.VK)((()=>We(n,a)),[n,a]);return(0,i.useEffect)((()=>{m&&!We(n,m)&&(0,_.Xy)(a,m)&&S(void 0)}),[y,m,n,a]),(0,v.jsx)(Ye.ZP,{popupType:h?Ye.Z4.SlideUp:Ye.Z4.Popup,disabled:t,renderOrigin:e=>g?(0,v.jsx)(Ke.Z,{id:`table:${(0,ie.mD)(s)}:${o}:${g.aggregation.aggregator}`,collectionContextStore:n,reducer:g,groupsPointer:s?[s]:void 0,render:i=>(0,v.jsx)(et.ZP,{alignment:is.v.End,disableTooltip:!y,renderTooltip:()=>p.formatMessage(qe.aggregationCalculating),render:n=>(0,v.jsx)(ko.Z,{disabled:t,style:f.buttonStyle,...(0,Ge.Z)(n,e),children:(0,v.jsx)(ss,{resultStore:i,aggregation:a,schema:r,property:o})})})}):(0,v.jsx)(ko.Z,{disabled:t,style:f.buttonStyle,...e,children:(0,v.jsx)(ls,{disabled:t,isHovered:l})}),render:e=>{let{close:t}=e;return(0,v.jsx)(os.Z,{property:o,schema:r,onChange:C,onClose:t,source:"tableAggregation"})}})}function ss(e){window.__c={n:"TableAggregationButtonContent"};const{aggregation:t,resultStore:o,schema:r,property:n}=e,s=(0,Ui.Y$)(),l=(0,re.yK)((e=>({valueStyle:{display:"flex",alignItems:"center",height:"100%",fontSize:14},aggregationTypeNameStyle:{fontSize:10,textTransform:"uppercase",letterSpacing:1,color:e.mediumTextColor,marginTop:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}})),[]),a=(0,c.VK)((()=>o.state),[o]),d=(0,i.useMemo)((()=>{if(!t)return;let e=He.v6[(0,Le.OV)(t)];return(0,Le.en)(t.aggregator)&&(e=t.aggregator.groupName in es.ZA?es.ZA[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),u=r[n],p=(0,c.VK)((()=>{if(u&&("formula"===u.type||"number"===u.type))return u.number_format;if("rollup"===(null==u?void 0:u.type)&&u.relation_property&&u.target_property&&"number"===u.target_property_type){if(r[u.relation_property]){var e;const t=(0,rs.ny)(s,r[u.relation_property]),o=null==t||null===(e=t.getModel())||void 0===e?void 0:e.getNormalizedSchema(),i=null==o?void 0:o[u.target_property];if("number"===(null==i?void 0:i.type))return i.number_format}}}),[u,r,s]);return d?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{style:l.aggregationTypeNameStyle,children:d},"type"),(0,v.jsx)("span",{style:l.valueStyle,children:t&&(0,v.jsx)($e,{aggregation:t,collectionContextStore:s,children:a?(0,He.Ol)({numberFormat:p,dateFormat:void 0,aggregationType:t.aggregator,value:null==a?void 0:a.aggregationResult,userTimeZone:(0,Ee.r)(),roundDecimal:5}):void 0})},"value")]}):null}function ls(e){let{disabled:t,isHovered:o}=e;window.__c={n:"TableAggregationCalculatePlaceholder"};const r=(0,re.yK)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{marginBottom:2,color:e.lightTextColor},chevronIcon:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),{isMobile:i}=(0,oe.Fy)();return t||!o&&!i?null:(0,v.jsx)(ts.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>(0,v.jsxs)("div",{style:r.placeholderWrapper,children:[(0,v.jsx)("span",{style:r.placeholderText,children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),(0,Ti.i)(r.chevronIcon)]})})}const as=i.memo((function(e){let{collectionContextStore:t,disabled:o,groupFormat:r,isFullScreen:n,isInPeekRenderer:s,query:l,schema:a,showHoverActionsStore:d,showPropertyFormats:u,showRightActionsSpacer:p,style:h}=e;window.__c={n:"TableAggregationRow"};const m=(0,oe.O7)(),S=(0,re.Fg)(),[g,C]=(0,i.useState)(!1),f=(0,c.VK)((()=>t.frozoneStore.state.frozenIndex),[t.frozoneStore]),{unfrozenIndexAddendum:y,frozenPropertyFormats:x,unfrozenPropertyFormats:b}=(0,c.VK)((()=>{const e=u;let t=[],o=e;const r=(0,le.bW)(f);return void 0!==f&&(t=e.slice(0,r),o=e.slice(r)),{unfrozenIndexAddendum:r,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[f,u]),w=(0,c.VK)((()=>t.isCompactView.state),[t]),k=(0,c.VK)((()=>{var e;return{display:"flex",position:"absolute",background:w?void 0:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(s?S.cardContentBackground:S.contentBackground),zIndex:M.RJ,fontSize:14,height:Ba+(n?wt.Z.state:0)+1,minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,...h}}),[t,n,s,h,S,w]),_=(0,c.VK)((()=>void 0!==f&&(0,_r.oc)({environment:m,collectionContextStore:t,isPhone:m.device.isPhone,theme:S})),[f,m,t,S]),T=(0,i.useCallback)((()=>{C(!0)}),[C]),V=(0,i.useCallback)((()=>{C(!1)}),[C]),O=(0,i.useCallback)((e=>e?{borderTop:`1px solid ${S.tableDividerColor}`}:{borderTop:void 0}),[S]);function P(e,i){return(0,v.jsx)(cs,{propertyFormat:e,index:i,groupFormat:r,disabled:o,mouseEntered:g,showHoverActionsStore:d,collectionContextStore:t,schema:a,query:l},e.property)}return(0,v.jsx)(Mt,{position:w?mt.IGNORE:mt.Bottom,getComputedStyle:O,children:(0,v.jsx)(Jn.p,{allowSelectionWithin:!1,style:k,onMouseMove:T,onMouseLeave:V,onMouseDown:us,children:(0,v.jsx)("div",{style:{display:"flex",paddingRight:!o&&p?32:0},children:(0,v.jsxs)("div",{style:{display:"flex"},children:[void 0!==f&&(0,v.jsx)("div",{style:{..._,display:"flex"},children:x.map(P)}),b.map(((e,t)=>P(e,t+y)))]})})})})}),Jt.Z),cs=i.memo((function(e){var t;let{propertyFormat:o,index:r,groupFormat:n,disabled:s,mouseEntered:l,showHoverActionsStore:a,collectionContextStore:d,query:u,schema:p}=e;window.__c={n:"TableAggregationWrapper"};const h=(0,oe.O7)(),m=(0,c.VK)((()=>(0,le.fk)({environment:h,collectionContextStore:d})),[h,d]),S=(0,c.VK)((()=>a.state),[a]),g=(0,i.useCallback)(((e,t)=>{const o=d.collectionViewStore();if(!o)return;let r=u.aggregations?[...u.aggregations]:[];const i=(u.aggregations||[]).findIndex((t=>t.property===e));r=i<0?_.oA([...r,t]):_.oA(r.map(((e,o)=>i===o?t:e)));const n={...u,aggregations:r};!d.isClientModeEnabled.state&&t&&d.asyncAggregationStatus.setState({calculating:!0,aggregation:t,changingType:!0}),Q.createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:h,perform:e=>{pe.iG({collectionViewStore:o,update:{query2:n},transaction:e})}})}),[d,u,h]);return(0,v.jsx)("div",{style:{display:"flex",width:void 0!==o.width?o.width+(0===r&&m?_r.Xx:0):void 0},children:(0,v.jsx)(ns,{groupFormat:n,disabled:s,isHovered:(l||0===r&&!n&&S)&&!s,aggregation:null===(t=u.aggregations)||void 0===t?void 0:t.find((e=>e.property===o.property)),property:o.property,collectionContextStore:d,schema:p,onChange:g})})})),ds=as;function us(e){(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{}})}function ps(e){window.__c={n:"TableEmptyPlaceholder"};const{collectionContextStore:t,shouldShowAddRowButton:o,paddingLeft:r,handleAddRowClick:i}=e,n=(0,c.VK)((()=>Boolean(t.currentCombinatorFilterStore.state||t.currentPropertyFiltersStore.state.length>0)),[t]),s=(0,re.yK)((e=>({button:{display:"flex",alignItems:"center",height:Fa+1,width:"100%",paddingLeft:Na,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:e.contentBackground,left:0,right:0,textAlign:"center",borderBottom:`1px solid ${e.tableDividerColor}`},buttonInner:{color:e.lightTextColor,position:"sticky",left:r+Na}})),[r]);return(0,v.jsx)(ko.Z,{className:ro.Gcz,onClick:i,onMouseDown:me.$0,disabled:!o,style:s.button,children:o?(0,v.jsx)("span",{style:s.buttonInner,children:n?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,v.jsx)("span",{style:s.buttonInner,children:n?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})}var hs=o(46283),ms=o(87085),Ss=o(73060),gs=o(79131),Cs=o(25962),fs=o(84939);const vs=2,ys=3;function xs(e){window.__c={n:"FrozenColumnDivider"};const{passesFilter:t,isScrolled:o,isCheckbox:r,isShimmerRow:n}=e,s=(0,i.useCallback)((e=>"dark"===e.mode?"transparent":t?`linear-gradient(to right, ${(0,fs.Fq)(ve.se[e.mode].gray,.15)},\n\t\t\t\t${(0,fs.Fq)(ve.se[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,fs.Fq)(ve.se[e.mode].gray,.35)},\n\t\t\t\t${(0,fs.Fq)(ve.se[e.mode].gray,.2)},  transparent)`),[t]),l=(0,re.yK)((e=>({border:{position:"absolute",top:-1,right:0,width:vs,height:n?35:"calc(100% + 2px)",background:t?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-ys,width:ys,height:n?34:"100%",background:s(e)}})),[n,t,s]);return(0,v.jsxs)(v.Fragment,{children:[r&&!o?null:(0,v.jsx)("div",{style:l.border}),(0,v.jsx)(ts.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,v.jsx)("div",{style:l.shadow})})]})}function bs(e){window.__c={n:"MultiSelectCheckbox"};const{checkedState:t,onClick:o,checkboxType:r,collectionContextStore:n,passesFilter:s,disabled:l,frozoneProps:a}=e,d=(0,oe.O7)(),u=(0,c.qz)(void 0,jo.Z),p=(0,c.VK)((()=>u.state.mouseEntered),[u]),h=(0,i.useRef)(null);(0,i.useEffect)((()=>{h.current&&(h.current.indeterminate="indeterminate"===t)}),[t]);const m=(0,c.VK)((()=>Mr.ZP.state.isDragging),[]),S=(0,i.useCallback)((e=>{l||(o(e),F.Ac({environment:d,collectionContextStore:n,checkbox_type:r}))}),[l,r,n,d,o]),g=(0,c.VK)((()=>!1===t&&!p||m?null!=a&&a.shouldShowStickyMultiSelectColumn?.4:0:1),[t,m,p,null==a?void 0:a.shouldShowStickyMultiSelectColumn]),C=(0,re.yK)((e=>({multiSelectCheckbox:{background:null==a?void 0:a.frozenStyles.background,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=a&&a.isCollectionViewBlockSelected?ve.ZP.blueWithAlpha(.14):void 0,height:"100%"},checkBoxInput:{width:_r.tA,height:_r.tA,cursor:l?void 0:"pointer",accentColor:e.fill.uiBlue,position:"relative",right:2}})),[l,null==a?void 0:a.frozenStyles.background,null==a?void 0:a.isCollectionViewBlockSelected]);return(0,v.jsx)(ts.Z,{isVisible:!0,animationStyle:{opacity:g>0?1:0},render:()=>(0,v.jsxs)("div",{style:C.multiSelectCheckbox,onMouseEnter:()=>{u.enter()},onMouseLeave:()=>{u.exit()},children:[(0,v.jsx)("div",{style:C.multiSelectCheckboxInner,children:(0,v.jsx)(ts.Z,{isVisible:!0,animationStyle:{opacity:g},render:()=>(0,v.jsx)("label",{style:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:l?void 0:"pointer",zIndex:1},onClick:me.Wi,onMouseDown:me.$0,children:(0,v.jsx)("div",{style:{width:`${_r.bu}px`,height:_r.bu-1+"px",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,v.jsx)("input",{type:"checkbox",style:C.checkBoxInput,ref:h,checked:!0===t,onChange:S,disabled:l})})})})}),(null==a?void 0:a.shouldFreezeMultiSelectColumn)&&(0,v.jsx)(xs,{passesFilter:s,isCheckbox:!0,isScrolled:!0})]})})}var ws=o(18514),ks=o(81415),_s=o(84169);function Ts(e){window.__c={n:"LearnMoreLink"};const{href:t,style:o}=e,r=(0,re.yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return(0,v.jsxs)("a",{href:t,target:"_blank",style:{...r.default,...o},children:[(0,_s.m)({width:14,marginRight:4}),(0,v.jsx)(j.FormattedMessage,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}var Vs=o(71424);function Os(e){window.__c={n:"WikiPropertiesOnboardingTooltip"};const{origin:t,propertyType:o}=e,r=(0,oe.O7)();return(0,v.jsx)(ks.U,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,v.jsx)(j.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,v.jsx)(j.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,v.jsx)(j.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,ut.t1)(o)}}(),content:function(){switch(o){case"owner":return(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,v.jsx)("span",{style:{fontWeight:R.Z.fontWeight.semibold},children:e})}});case"verification":return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,v.jsx)(Ts,{href:(0,ws.UY)("guides.wikis"),style:{color:ve.ZP.uiLightGray}})]});case"tags":return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,v.jsx)(Ts,{href:(0,ws.UY)("guides.databaseProperties"),style:{color:ve.ZP.uiLightGray}})]});default:(0,ut.t1)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,ut.t1)(o)}}(),onCloseClick:()=>{Ss.nX(r)},onPrimaryButtonClick:()=>Ss.Rg(r),onBackButtonClick:()=>Ss.FO(r),shouldDismissUponOutsideClick:!0,pointerLength:Vs.EZ,pointerOffset:Vs.FD,style:{width:Vs.G5}})}class Ps extends d.default{getInitialState(){return{}}}const Rs=Ps;var Ms=o(33125),js=o(34078),Is=o(74817),Fs=o(97820),Bs=o(43224),Ns=o(19124),Ds=o(67695),Ls=o(12396),As=o(79362),Es=o(8597),Zs=o(88437),Hs=o(44643),zs=o(44495),Gs=o(16184),Ks=o(20669),Us=o(4635),Ws=o(23903),$s=o(79310),qs=o(59753),Qs=o(19889),Ys=o(34993),Xs=o(16956),Js=o(80402),el=o(44866),tl=o(34517),ol=o(47043),rl=o(30772),il=o(27871),nl=o(71214),sl=o(30905),ll=o(28992),al=o(74420),cl=o(86825),dl=o(42402),ul=o(83212);class pl extends s.Z{constructor(){super(...arguments),this.storeTypes={propertyTypeButtonPopupStore:eo.Z,inputStore:d.default.createClass(""),showPropertyDescriptionStore:d.default.createClass(!1)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyNameSubmit=e=>Cl(e,this.environment,this.props.property,this.props.schema,this.props.collectionContextStore,this.stores.inputStore),this.isRightmostFrozen=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.frozoneStore.state.frozenIndex;return Boolean(this.props.columnIndex===t)})),this.canFreezeThisColumn=this.createComputedStore((()=>{const{collectionContextStore:e,columnIndex:t}=this.props,{frozenIndex:o,scrollerWidth:r}=e.frozoneStore.state,i=this.props.collectionContextStore.collectionViewStore();if(void 0===o)return!1;return t>((null==i?void 0:i.getTableMaxFrozenColumnIndex(r,e.normalizedFormatStore.state))??-1)}))}UNSAFE_willMountOrUpdate(e){const{property:t,schema:o,collectionContextStore:r}=e,i=o[t];if(i&&"relation"===i.type){const e=rs.ny(r,i);null==e||e.load()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:_e.og.ActionSheet}:{menuType:_e.og.Popup,minWidth:220};const o=this.getMenuSections(this.props.parent);return(0,v.jsx)(Ve.Z,{...t,children:(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:void 0,sections:_.oA(o.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,v.jsx)(Re.Z,{...e,topBorder:0!==t}),items:e}})))})})}getMenuSections(e){var t;const{property:o,schema:r,collectionContextStore:i,formatKey:n,allowHidingTitle:s,format:l,intl:a}=this.props,{environment:c,theme:d}=this,{device:u}=c,p=r[o],h=i.permissionScopes.state,m=i.isCompactView.state,S=i.settingsStore,g=i.collectionViewStore(),f=i.collectionStore();if(!g||!p)return[];const y=(0,Kt.wl)(o),x=Boolean((null===(t=ml(this.props.format,this.props.formatKey,this.props.property))||void 0===t?void 0:t.wrap)||g.getFormat().table_wrap)&&"timeline"!==g.getType(),b=i.databaseType,w=Boolean(f&&b&&X.cR((0,tl.appConfigs)(),b,o,f)),k="title"===p.type,T=[];if(y&&"person"===p.type){const e=[];T.push(e),e.push({key:"synced_person",render:e=>(0,v.jsx)(ll.Z,{...e,title:p.name||"",icon:(0,zs.D)({width:14}),caption:(0,v.jsx)("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",minWidth:300,maxWidth:350},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"People synced from external sources may require additional set up. Visit <helpcenterlink>the help center</helpcenterlink> for more information.",id:"database.tableHeaderCell.syncedPersonPropertyCaption",values:{helpcenterlink:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,v.jsx)(dl.Z,{href:(0,ws.UY)("guides.syncedContent"),children:t})}}})})}),action:()=>{}})}const V=[];if(T.push(V),h.canConfigureCollection&&!y){const t=Boolean(this.stores.showPropertyDescriptionStore.state);V.push({key:"rename",render:o=>(0,v.jsxs)(Re.Z,{children:[(0,v.jsx)(nl.I,{...o,initialValue:p.name||"",placeholder:ze.default.formatMessage(Is.sY.inputPlaceholder),focusInitial:!0,inputStore:this.stores.inputStore,onBlur:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyNameSubmit,onSubmit:t=>{Cl(t,this.environment,this.props.property,this.props.schema,this.props.collectionContextStore,this.stores.inputStore),e.close()},iconButton:{icon:e=>(0,v.jsx)(Ls.ZP,{type:p.type,icon:p.icon,size:16,theme:d,style:e}),iconStyle:{fill:As.Lr[d.mode].gray},enforceIconColor:"gray",onSubmit:(e,t)=>function(e,t,o,r,i){const n=t.collectionStore();if(!n)return;Q.createAndCommit({userAction:"TableHeaderCell.handlePropertyIconSubmit",environment:o,perform:t=>{Xs.OK({collectionStore:n,property:e,icon:r,transaction:t})}}),F.$q({environment:o,collectionContextStore:t,property:e,icon:r,from:"table",action:"change_icon"})}(this.props.property,this.props.collectionContextStore,this.environment,e)},inputRightButton:(0,v.jsx)(rl.l,{description:p.description,showTooltip:!t,onClick:()=>this.stores.showPropertyDescriptionStore.setState(!t),addDescriptionText:a.formatMessage(Bs.aB.addPropertyDescriptionTooltip),editDescriptionText:a.formatMessage(Bs.aB.editPropertyDescriptionTooltip)})}),gl(this.props.property,this.props.schema,this.stores.inputStore)&&(0,v.jsx)(Is.mJ,{propertyName:this.stores.inputStore.state,styles:u.isMobile?{paddingBottom:5,paddingLeft:16,paddingRight:16,margin:0,boxShadow:`inset 0 -1px 0 ${d.regularDividerColor}`}:{}})]}),action:()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_rename"}),pe.n1({collectionContextStore:i}),e.close()}}),t&&V.push({key:"description",render:e=>(0,v.jsx)(Re.Z,{...e,desktopStyle:{paddingTop:0},title:u.isMobile?a.formatMessage(il.k.descriptionHeader):void 0,children:(0,v.jsx)(il.i,{initialDescription:p.description,handleSaveDescription:e=>function(e,t,o,r){var i;const n=o.collectionStore(),s=null==n||null===(i=n.getSchema())||void 0===i?void 0:i[r];if(!n||void 0===s||e===s.description)return;Q.createAndCommit({userAction:"CollectionSettingsProperty.handleDescriptionChange",environment:t,perform:o=>{pe.xO({environment:t,collectionStore:n,update:{[r]:{...s,description:e}},transaction:o})}}),F.$q({environment:t,collectionContextStore:o,property:r,from:"view_properties",action:"set_description"})}(e,this.environment,this.props.collectionContextStore,this.props.property),disableAutoSection:!0})}),action:_.ZT})}if(h.canConfigureBlock&&!y&&V.push({key:"edit_property",render:e=>(0,v.jsx)(et.ZP,{placement:et.ug.Left,render:t=>(0,v.jsx)(Qe.Z,{title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:(0,Us.W)({width:14}),...(0,Ge.Z)(e,t)}),style:{whiteSpace:"normal"},renderTooltip:()=>(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_edit"}),pe.n1({collectionContextStore:i}),e.close(),A.r$({collectionContextStore:i,collectionSettingsStore:S}),A.H4({collectionSettingsStore:S,item:{type:"properties",timelineViewTab:"table"}}),A.H4({collectionSettingsStore:S,item:{type:"property",formatKey:n,property:o}})}}),h.canConfigureCollection&&!y&&f&&(0,Ns.Zt)(this.environment)&&(0,fe.qQ)(p)&&("text"===p.type||(0,Ns.KZ)())){const t=(0,fe.q3)(p),r=ao.De(f.getFormat(),o),s=r.isRunning||!f||!(0,Ns.mX)(c,ul.Z.getMode(c,f),f);t?V.push({key:"fill_all_pages",render:e=>(0,v.jsx)(et.ZP,{placement:et.ug.Left,renderTooltip:()=>(0,v.jsx)(sl.qQ,{collectionStore:f,propertySchema:p}),render:t=>(0,v.jsx)(Qe.Z,{titleStyle:{color:s?d.lightTextColor:void 0},disabled:s,icon:(0,v.jsx)(sl.Xh,{updateAiInferencesTaskStatus:r,iconStyle:{marginLeft:-1,marginRight:-1},progressIconStyle:{marginTop:4,marginLeft:0,marginRight:-3}}),title:(0,v.jsx)(sl.ZP,{updateAiInferencesTaskStatus:r}),caption:void 0!==r.numPagesFilled&&void 0!==r.numPagesRequested&&(0,v.jsx)(sl.Y7,{updateAiInferencesTaskStatus:r}),...(0,Ge.Z)(e,t)})}),action:async()=>{await el.autofillPropertyForCollection({environment:c,collectionStore:f,propertySchema:p,property:o})}}):V.push({key:"autofill_with_ai",render:e=>(0,v.jsx)(Qe.Z,{disabled:void 0===f,title:(0,v.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Set up AI autofill",id:"database.tableHeaderCell.autofillWithAI"}),(0,v.jsx)(al.Z,{style:{display:"inline-block"}})]}),icon:(0,Ks.y)({width:14,fill:d.aiPurpleColor}),...e}),action:()=>{f&&(e.close(),A.r$({collectionContextStore:i,collectionSettingsStore:S}),A.H4({collectionSettingsStore:S,item:{type:"properties",timelineViewTab:"table"}}),A.H4({collectionSettingsStore:S,item:{type:"property",formatKey:n,property:o}}),"text"===p.type&&A.H4({collectionSettingsStore:S,item:{type:"propertyAiAutofill",propertySchema:p,property:o}}))}})}if(h.canConfigureBlock&&((0,Kt.bA)(p)||(0,Kt.Kf)(p))){const t=[];T.push(t),(0,Kt.bA)(p)&&(t.push({key:"sort_asc",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Sort ascending",id:"database.tableHeaderCell.sortAscending"}),icon:(0,Es.Z)({width:14})}),action:()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_sort_asc"}),e.close(),function(e,t,o,r){hl(!0,e,t,o,r)}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment)}}),t.push({key:"sort_desc",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Sort descending",id:"database.tableHeaderCell.sortDescending"}),icon:(0,wr.M)({width:14})}),action:()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_sort_desc"}),e.close(),function(e,t,o,r){hl(!1,e,t,o,r)}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment)}})),(0,Kt.Kf)(p)&&t.push({key:"filter",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Filter",id:"database.tableHeaderCell.filter"}),icon:(0,C.Q)({width:14})}),action:()=>{"collectionVirtualView"!==i.contextType&&(F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_filter"}),e.close(),function(e,t,o,r){const i=t.currentPropertyFiltersStore.state,n=t.collectionViewBlockStore(),s=(null==n?void 0:n.getRecordModel)??qs.om.constant(void 0);let l=i.find((t=>{let{filter:o}=t;return o.property===e}));if(!l){const n=(0,Ut.H_)({property:e,schema:o,getRecordModel:s});if(!n)return;const a={id:(0,Xt.ZP)(),filter:n};t.filtersBarOpen.setState(!0),Ys.iU({environment:r,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:[...i,a]}}}),l=a}if(!l)return;const a=t.getFilterBarItemSettingsStore(l);A.wl({collectionSettingsStore:a,item:{type:"filter"}}),pe.n1({collectionContextStore:t})}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment))}})}const O=[];if(T.push(O),(s||"title"!==p.type)&&h.canConfigureBlock&&O.push({key:"hide",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Hide in view",id:"database.tableHeaderCell.hideInView"}),icon:(0,Hs.L)({width:22,marginLeft:-4,marginRight:-4})}),action:()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_hide"}),e.close(),function(e,t,o,r,i,n){const s=e.collectionViewStore();if(!s)return;const l=o[r]||[],a=l.map((e=>e.property===t?{...e,visible:!1}:e)),c={...o,[r]:a};Q.createAndCommit({userAction:"TableHeaderCell.updatePropertyFormat",environment:n,perform:t=>{pe.iG({collectionViewStore:s,update:{format:c},transaction:t}),Js.oz({environment:n,collectionContextStore:e,currentIndex:i,entrypoint:"TableHeaderCell",transaction:t,propertyAction:"hide"})}})}(this.props.collectionContextStore,this.props.property,this.props.format,this.props.formatKey,this.props.columnIndex,this.environment)}}),h.canConfigureBlock&&!m&&!u.isPhone){const e=this.canFreezeThisColumn.state;O.push({key:"freeze_column",render:t=>(0,v.jsx)(et.ZP,{placement:et.ug.Left,disableTooltip:!e,renderTooltip:e=>(0,v.jsx)(j.FormattedMessage,{...e,defaultMessage:"Insufficient space to freeze columns",id:"database.tableHeaderCell.freezePropertyTooltip",description:"If the width of the frozen columns is wider than the screen, show the user this tooltip warning."}),render:o=>(0,v.jsx)(Qe.Z,{...t,...o,disabled:e,buttonStyle:{color:e?this.theme.text.quaternary:void 0},title:this.isRightmostFrozen.state?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"{numberFrozenColumns, plural, one {Unfreeze column} other {Unfreeze columns}}",values:{numberFrozenColumns:this.props.columnIndex+1},id:"database.tableHeaderCell.unfreezeColumns"}):(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Freeze up to column",id:"database.tableHeaderCell.freezeUpToColumn"}),icon:this.isRightmostFrozen.state?(0,$s.A)({width:14}):(0,Ws.P)({width:12,margin:"0px 1px"})})}),action:()=>{!function(e,t,o){Q.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:o,perform:r=>{Js.oz({environment:o,collectionContextStore:e,currentIndex:t,transaction:r,entrypoint:"TableHeaderCell",propertyAction:"toggle"})}})}(this.props.collectionContextStore,this.props.columnIndex,this.environment)}})}if(!io.Tr.includes(p.type)||(0,fe.dx)(p)||!h.canConfigureCollection||y||k||O.push({key:"duplicate",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.tableHeaderCell.duplicateProperty"}),icon:(0,Zs.a)({width:14})}),action:async()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_duplicate"}),e.close(),await async function(e,t,o,r,i,n){const s=ml(i,o,e),l=t.collectionStore(),a=t.collectionViewStore(),c=t.normalizedFormatStore.state[o]||[],d=null==l?void 0:l.getSpaceId();if(!(l&&a&&d&&s))return;const u=l.getSchema(),p=u[e];if(!p)return;const h=await(0,le.xy)({schema:u,property:e,properties:c,parentStore:l,spaceId:d});if(!h)return;const m=n.currentUser.id,S=m?{id:m,table:Qs.KJ}:void 0;Q.createAndCommit({userAction:"TableHeaderCell.handleDuplicate",environment:n,perform:e=>{pe.xO({environment:n,collectionStore:l,update:{[h.newProperty]:h.newPropertySchema},transaction:e}),Js.oz({environment:n,collectionContextStore:t,currentIndex:r,entrypoint:"TableHeaderCell",transaction:e,propertyAction:"duplicate"}),(0,ut.$K)(h.automationUpdate)&&ol.HF({actorPointer:S,environment:n,sourceAutomationStore:h.automationUpdate.sourceAutomationStore,targetAutomationId:h.automationUpdate.targetAutomationId,transaction:e}),o&&So.FH({stores:[a],update:{[o]:h.newProperties},transaction:e})}}),F.wd({environment:n,collectionContextStore:t,action:"duplicate_property",original_view_type:null==a?void 0:a.getType(),property_type:p.type})}(this.props.property,this.props.collectionContextStore,this.props.formatKey,this.props.columnIndex,this.props.format,this.environment)}}),io.Tr.includes(p.type)&&h.canConfigureCollection&&!y&&!k&&O.push({key:"delete",render:e=>(0,v.jsx)(et.ZP,{placement:et.ug.Left,disableTooltip:!w,renderTooltip:e=>(0,ai.A7)(b,e),render:t=>(0,v.jsx)(Qe.Z,{...e,...t,disabled:w,disabledFeedback:w,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),caption:this.environment.device.isMobile&&w?(0,ai.A7)(b):null,icon:w?(0,v.jsx)("div",{...t,children:(0,Gs.Q)({width:14})}):(0,be.y)({width:14})})}),action:async()=>{e.close(),await async function(e,t,o,r,i,n){await Xs.TI({environment:i,collectionContextStore:e,property:t,handleDeleteAccept:()=>function(e,t,o,r,i){const n=o.collectionStore();if(!n)return;const s=n.getSchema()[e];Q.createAndCommitAsync({environment:i,userAction:"TableHeaderCell.handleDeleteAccept",waitForServerCommit:!1,perform:async s=>{await Xs.yV({environment:i,collectionStore:n,schema:t,property:e,transaction:s}),Js.oz({environment:i,collectionContextStore:o,currentIndex:r,entrypoint:"TableHeaderCell",transaction:s,propertyAction:"delete"})}}),s&&F.y9({environment:i,collectionContextStore:o,property_type:s.type,from:"table_column",property:e})}(t,o,e,r,i),theme:n,from:"table_column"})}(this.props.collectionContextStore,this.props.property,this.props.schema,this.props.columnIndex,this.environment,this.theme)}}),h.canConfigureBlock&&"timeline"!==g.getType()){const e=[];T.push(e),e.push({key:"wrap_cell",render:e=>(0,v.jsx)(cl.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Wrap column",id:"database.tableHeaderCell.wrapColumn"}),on:x}),action:()=>{Js.K4({currentValue:x,environment:this.environment,property:o,collectionViewStore:g,format:l,formatKey:n}),F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_wrap_column"})}})}return T}}function hl(e,t,o,r,i){if(!r[t])return;const n=[{property:t,direction:e?"ascending":"descending"}];o.filtersBarOpen.setState(!0),Ys.iU({environment:i,collectionContextStore:o,temporaryState:{...o.temporaryState.state,sorts:{value:n}}}),pe.n1({collectionContextStore:o})}function ml(e,t,o){var r;return null===(r=e[t])||void 0===r?void 0:r.find((e=>e.property===o))}pl.displayName="TableHeaderCellMenu";const Sl=(0,j.injectIntl)(pl);function gl(e,t,o){const r=o.state,i=Object.keys(t).find((o=>{var i;return o!==e&&(null===(i=t[o])||void 0===i?void 0:i.name)===r}));return Boolean(i)}function Cl(e,t,o,r,i,n){if(gl(o,r,n))return;const s=i.collectionStore();if(!s)return;const l=s.getSchema()[o];(null==l?void 0:l.name)!==e&&(Q.createAndCommit({userAction:"TableHeaderCell.handlePropertyNameSubmit",environment:t,perform:t=>{Xs.Bv({collectionStore:s,property:o,name:e,transaction:t})}}),F.$q({environment:t,collectionContextStore:i,property:o,from:"view_settings",action:"rename"}))}const fl={fontSize:14},vl=i.memo((function(e){let{allowHidingTitle:t,collectionContextStore:o,columnIndex:r,disableCellRightBorder:n,disabled:s,format:l,formatKey:a,isLast:d,paddingTop:u,property:p,renderSpacer:h,schema:m,width:S}=e;const g=(0,i.useRef)(null);(0,Ms.c)(Ds.Z,(()=>({collectionContextStore:o,property:p,getNode:()=>g.current})),[o,p]);const C=(0,oe.O7)(),f=(0,oe.Fy)(),[y,x]=(0,i.useState)(!1),b=(0,c.VK)((()=>o.permissionScopes.state),[o.permissionScopes]),w=(0,c.qz)(void 0,eo.Z),{isRightMostFrozenColumn:k,isScrolled:_}=(0,c.VK)((()=>{const{frozenIndex:e,isScrolled:t}=o.frozoneStore.state;return{isRightMostFrozenColumn:e===r,isScrolled:t}}),[o.frozoneStore,r]),T=(0,re.yK)((e=>({div:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:S,borderRight:n?void 0:`1px solid ${e.tableDividerColor}`},description:{color:e.mediumInvertedTextColor},aiUpdate:{color:e.mediumInvertedTextColor}})),[S,n]),V=(0,i.useCallback)((()=>{q.ZH(C),W.ZH(C),pe.wG()}),[C]),O=(0,i.useCallback)((e=>{f.isMobile||(e.preventDefault(),(0,me.ZP)({event:e,context:me.Af.EditorContextMenu,callback:()=>{V(),w.setState({open:!0})}}))}),[f,w,V]),P=(0,i.useCallback)((e=>{x(e)}),[x]),R=m[p];return R?(0,v.jsx)("div",{ref:g,style:T.div,className:ro.VMO,onContextMenu:O,children:(0,v.jsx)(Ye.ZP,{popupType:f.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,disabled:!b.canConfigureBlock,originGap:1,alignmentToOrigin:Ye.vR.Start,buttonPopupStore:w,renderOrigin:e=>(0,v.jsx)(et.ZP,{renderTooltip:e=>{const t=(0,fe.qQ)(R)&&("text"===R.type||(0,Ns.KZ)())&&(0,fe.q3)(R);return(0,v.jsxs)("div",{...e,style:Bs.F6,children:[(0,v.jsx)("div",{children:R.name}),void 0!==(null==R?void 0:R.description)&&R.description.length>0?(0,v.jsx)("div",{style:T.description,children:R.description}):null,t&&t.auto_update_on_edit&&(0,v.jsx)("div",{style:T.aiUpdate,children:(0,v.jsx)(j.FormattedMessage,{...Is.sY.keptUpToDateWithNotionAITooltip})})]})},delayThreshold:y?0:500,placement:et.ug.Right,render:t=>{var o;return(0,v.jsxs)(ko.Z,{style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:u},disabled:s,...(0,Ge.Z)(t,e),children:[h&&h(d),(0,v.jsx)(Fs.Z,{propertySchema:R,showIcon:!0,badge:(0,v.jsxs)(v.Fragment,{children:[!(null===(o=R.description)||void 0===o||!o.length)&&!f.isMobile&&(0,v.jsx)(js.Z,{setIsHovered:P}),(0,v.jsx)(Fs.o,{propertySchema:R})]}),style:fl,property:p}),k&&(0,v.jsx)(xs,{passesFilter:!0,isScrolled:Boolean(_)})]})}}),render:e=>(0,v.jsx)(Sl,{allowHidingTitle:t,collectionContextStore:o,columnIndex:r,format:l,formatKey:a,property:p,schema:m,parent:e}),onClick:V})}):null}));var yl=o(35011),xl=o(6685),bl=o(58299);const wl={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1};function kl(e){let{leftFormat:t,height:o,onTemporaryResize:r,onAccept:n,onCancel:s,propertySchema:l,resultStore:a}=e;window.__c={n:"TableHeaderResizer"};const c=(0,i.useRef)(void 0),d=c.current,u=(0,oe.Fy)(),[p,h]=(0,i.useState)(!1),[m,S]=(0,i.useState)(!1),g=(m||p)&&!u.isPhone,C=(0,i.useCallback)((e=>{if(d&&d.width){const o=Math.max(d.width+e.diffX,Tl(l,t));return{...d,width:o}}}),[t,l,d]),f=(0,i.useCallback)((e=>{e.preventDefault(),c.current=t,S(!0)}),[t]),y=(0,i.useCallback)((e=>{const t=C(e);t&&r(t)}),[C,r]),x=(0,i.useCallback)((()=>{const e=a.state?a.state.blockIds:[],o=_.oA(e.map((e=>{const o=bl.Z.findBlockPropertyValueByBlockId(e,t.property),r=null==o?void 0:o.getNode();if(r)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const r=getComputedStyle(e);for(let s=0;s<r.length;s++){const e=r[s],o=r.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const i=t.querySelectorAll("*");for(const s of i)s.style&&(s.style.pointerEvents="none",s.style.width="auto");document.body.appendChild(t);const n=t.getBoundingClientRect();return t.remove(),null!=n&&n.width?Math.ceil(n.width)+1:void 0}(r)})));if(t.width){const e={...t,width:Math.min(800,Math.max(Math.max(...o),Tl(l,t)))};n(e)}}),[t,n,l,a]);return(0,v.jsx)("div",{style:wl,onMouseMove:()=>h(!0),onMouseLeave:()=>h(!1),children:(0,v.jsx)(xl.Z,{onDraggableDragStart:f,onDraggableDragMove:y,onDraggableDragEnd:e=>{const t=C(e);t&&n(t),S(!1)},onDraggableDragCancel:()=>{s(),c.current=void 0,S(!1)},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>(0,v.jsx)("div",{style:g?Ol(o):Vl(o),onDoubleClick:x,...e})})})}const _l=i.memo(kl,Jt.Z);function Tl(e,t){if("checkbox"===(null==e?void 0:e.type)||"status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return 32;var o;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,yl.mm)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return 32;return"auto_increment_id"===(null==e?void 0:e.type)?64:100}function Vl(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:ve.ZP.blueWithAlpha(0),cursor:"col-resize"}}function Ol(e){return{...Vl(e),background:ve.ZP.blueWithAlpha(.8)}}const Pl=32,Rl={display:"flex",width:Pl,height:"100%",alignItems:"center",justifyContent:"center"};class Ml extends s.Z{constructor(){super(...arguments),this.storeTypes={tableHeaderRowStore:Rs,resultStore:d.default.createClass(void 0)},this.propertyRef=i.createRef(),this.renderHeaderRowCells=(e,t,o)=>{var r,i,n,s;const{device:l}=this.environment,{store:a,collectionContextStore:c,schema:d,query:u,disabled:h,formatKey:m,disableCellRightBorder:S,renderSpacer:g,allowHidingTitle:C,paddingTop:f,showRightActions:y}=this.props,{resultStore:x}=this.stores,b=Bl(this.props.format,this.props.tableStore),w=this.props.showPropertyFormats[t],k=t===o.length-1,_=Ss.B1(),T=(null===(r=c.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===p.GZ&&a.isCollectionViewPageWithContent()&&a.id===(null===(i=c.collectionViewBlockStore())||void 0===i?void 0:i.id),V=T&&e===hs.k.Owner&&"owner"===_,O=T&&"verification"===(null===(n=d[e])||void 0===n?void 0:n.type)&&"verification"===_,P=T&&"multi_select"===(null===(s=d[e])||void 0===s?void 0:s.type)&&"tags"===_,R=!l.isMobile&&(V||O||P),M=S||k&&!Fl(h,y),j=(0,_r.vf)({environment:this.environment,propertyFormat:w}),I=(0,v.jsxs)(v.Fragment,{children:[R&&(0,v.jsx)(Os,{origin:this.propertyRef,propertyType:_}),w&&j&&(0,v.jsx)(vl,{format:b,schema:d,query:u,property:e,width:j,collectionViewBlockStore:a,collectionContextStore:c,disabled:h,formatKey:m,isLast:k,disableCellRightBorder:M,allowHidingTitle:C,renderSpacer:g,paddingTop:f,columnIndex:t,groupsPointer:this.groupsPointerStore.state}),!h&&!l.isPhone&&(0,v.jsx)(_l,{leftFormat:w,onTemporaryResize:e=>function(e,t,o,r){t.setState({...t.state,temporaryFormat:Dl(e,o,r,t)})}(e,this.props.tableStore,this.props.formatKey,this.props.format),onAccept:e=>function(e,t,o,r,i,n){const s=t.collectionViewStore();if(!s)return;const l=Bl(r,i),a=Nl(o,r,i).map((t=>t.property===e.property?e:t)),c={...l,[o]:a};Q.createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:n,perform:e=>{pe.iG({collectionViewStore:s,update:{format:c},transaction:e})}}),i.setState({...i.state,temporaryFormat:void 0}),F.wd({environment:n,collectionContextStore:t,action:"table_resize_columns"})}(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),onCancel:()=>{var e;(e=this.props.tableStore).setState({...e.state,temporaryFormat:void 0})},height:this.props.height,propertySchema:d[e],resultStore:x})]});return(0,v.jsx)("div",{style:{display:"flex",position:"relative"},ref:R?this.propertyRef:void 0,children:I},e)},this.shouldShowMultiSelectCheckboxStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,le.fk)({environment:this.environment,collectionContextStore:e})})),this.groupsPointerStore=this.createComputedStore((()=>{const{groupFormat:e}=this.props;return e?[e]:[]}),!0),this.showPropertiesStore=this.createComputedStore((()=>this.props.showPropertyFormats.map((e=>e.property))),!0)}renderComponent(){const{disabled:e,showRightActions:t,disableHorizontalEdgeScroll:o,collectionContextStore:r,frozoneProps:i}=this.props,n=r.permissionScopes.state,s=null==i?void 0:i.frozenIndex,l=(0,le.bW)(s),a=null==i?void 0:i.frozenStyles.left,c={...this.shouldShowMultiSelectCheckboxStore.state?{...null==i?void 0:i.frozenStyles,left:_r.Xx+(a??0)}:null==i?void 0:i.frozenStyles},d=this.showPropertiesStore.state.slice(0,l),u=this.showPropertiesStore.state.slice(l),p=Fl(e,t)?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Zl,{collectionContextStore:this.props.collectionContextStore}),(0,v.jsx)(Hl,{collectionContextStore:this.props.collectionContextStore})]}):null,h=this.shouldShowMultiSelectCheckboxStore.state&&(0,v.jsx)(jl,{groupsPointer:this.groupsPointerStore.state,collectionContextStore:r,frozoneProps:i}),m=r.isCompactView.state,S=ft(m);return e||!n.canConfigureBlock?(0,v.jsx)(Mt,{position:S,children:(0,v.jsxs)("div",{className:ro.kUP,style:Al(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.disableTopBorder),children:[h,(0,v.jsxs)("div",{style:gs.l8,children:[(0,v.jsx)("div",{style:{display:"flex",...c},children:d.map(((e,t)=>this.renderHeaderRowCells(e,t,this.showPropertiesStore.state)))}),u.map(((e,t)=>this.renderHeaderRowCells(e,t+l,this.showPropertiesStore.state)))]}),p,this.props.children]})}):(0,le.Ql)(s)?(0,v.jsx)(Mt,{position:S,children:(0,v.jsxs)("div",{className:ro.kUP,style:Al(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.disableTopBorder),children:[h,(0,v.jsx)(Cs.Z,{style:{display:"flex"},direction:"horizontal",keys:this.showPropertiesStore.state,sectionedKeys:{frozen:d,unfrozen:u},sectionStyles:{frozen:{display:"flex",...c},unfrozen:{display:"flex"}},renderKey:this.renderHeaderRowCells,onDrop:e=>El(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),disableHorizontalEdgeScroll:o}),p,this.props.children]})}):(0,v.jsx)(Mt,{position:S,children:(0,v.jsxs)("div",{className:ro.kUP,style:{...Al(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.disableTopBorder)},children:[h,(0,v.jsx)(gs.ZP,{direction:"horizontal",keys:this.showPropertiesStore.state,renderKey:this.renderHeaderRowCells,onDrop:e=>El(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),disableHorizontalEdgeScroll:o}),p,this.props.children]})})}}function jl(e){window.__c={n:"GroupSelectCheckbox"};const{groupsPointer:t,collectionContextStore:o,frozoneProps:r}=e,n=(0,oe.O7)(),s=(0,i.useCallback)((()=>(0,Fo.A7)(t[0],o).filter((e=>e.canEdit()))),[o,t]),l=(0,c.VK)((()=>0===s().length),[s]),a=(0,c.VK)((()=>{const e=s(),t=e.length;if(0===t)return!1;const o=zo.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")}),[s]),d=(0,i.useCallback)((e=>{var t;const r=s(),i=zo.default.state.stores,l=(0,_r.vg)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:i;!1===a||"indeterminate"===a?W.Z5({environment:n,stores:_.G0(l,r)}):!0===a&&W.Z5({environment:n,stores:_.zu(l,...r)}),e.stopPropagation()}),[a,o,n,s]),u=(0,c.VK)((()=>({...null==r?void 0:r.frozenStyles,...-1===(null==r?void 0:r.frozenIndex)?{background:void 0}:{}})),[null==r?void 0:r.frozenIndex,null==r?void 0:r.frozenStyles]);return(0,v.jsx)("div",{style:u,children:(0,v.jsx)(bs,{passesFilter:!0,checkedState:a,onClick:d,checkboxType:"group",collectionContextStore:o,frozoneProps:r?{...r,isCollectionViewBlockSelected:!1}:void 0,disabled:l})})}Ml.displayName="TableHeaderRow";const Il=(0,j.injectIntl)(Ml);function Fl(e,t){return!e&&t}function Bl(e,t){const{temporaryFormat:o}=t.state;return o||e}function Nl(e,t,o){return Bl(t,o)[e]||[]}function Dl(e,t,o,r){const i=Bl(o,r),n=Nl(t,i,r).map((t=>t.property===e.property?e:t));return{...i,[t]:n}}function Ll(e){(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{}})}function Al(e,t,o,r,i,n){var s;const l=e.collectionViewStore();if(!l)return{};const a=e.isCompactView.state?void 0:(null===(s=e.inheritedBlockColorStore.state)||void 0===s?void 0:s.background)||(t?i.cardContentBackground:i.contentBackground);return{display:"flex",position:"absolute",background:a,zIndex:M.bF,height:o-1,color:i.mediumTextColor,borderTop:n?void 0:`1px solid ${i.tableDividerColor}`,boxShadow:`\n            -3px 0 0 ${a},\n            0 1px 0 ${i.tableDividerColor}\n        `,minWidth:r,left:"timeline"===l.getType()?void 0:0,right:"timeline"===l.getType()?void 0:0}}function El(e,t,o,r,i,n){const s=t.collectionViewStore();if(!s)return;const l={...Bl(r,i),[o]:_.MR(Nl(o,r,i),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0}))};Q.createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:n,perform:e=>{pe.iG({collectionViewStore:s,update:{format:l},transaction:e})}}),F.wd({environment:n,collectionContextStore:t,action:"table_reorder_columns"})}function Zl(e){let{collectionContextStore:t}=e;window.__c={n:"AddColumnButtonComponent"};const o=(0,re.Fg)(),r=(0,oe.O7)();return(0,v.jsx)(ko.Z,{style:{display:"flex",justifyContent:"flex-start",width:Pl},onMouseDown:Ll,onClick:()=>function(e,t){const o=e.collectionStore();o&&(q.ZH(t),W.ZH(t),pe.wG(),F.wd({environment:t,collectionContextStore:e,action:"click_new_property"}),A.wl({collectionSettingsStore:e.settingsStore,item:{type:"propertyType",propertyTypes:(0,io.TP)({isSyncedCollection:o.isSyncedCollection(),collectionContextStore:e,environment:t}),onAccept:(o,r,i,n)=>{ms.PW({environment:t,collectionContextStore:e,propertyType:o,isSuggestedProperty:r,propertyName:i,selectOptions:n,from:"table"})}}}))}(t,r),className:ro.V6y,children:(0,v.jsx)("div",{style:Rl,children:(0,de.R)({width:12,fill:o.mediumIconColor})})})}function Hl(e){let{collectionContextStore:t}=e;window.__c={n:"ConfigureColumnsButtonComponent"};const o=(0,re.Fg)(),r=(0,oe.O7)();return(0,v.jsx)(ko.Z,{style:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:Pl},onMouseDown:Ll,onClick:()=>function(e,t){A.r$({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),F.wd({environment:t,collectionContextStore:e,action:"click_table_header_dot_menu"}),A.H4({collectionSettingsStore:e.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})}(t,r),className:ro.V6y,children:(0,v.jsx)("div",{style:Rl,children:(0,ce.o)({width:12,fill:o.mediumIconColor})})})}function zl(e){const{children:t,isCollectionViewBlockSelected:o,shouldFreeze:r}=e;return r?(0,v.jsx)(ts.Z,{enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},isVisible:!0,render:()=>(0,v.jsx)("div",{style:{display:"flex",background:o?ve.ZP.blueWithAlpha(.14):void 0},children:t})},"halo"):(0,v.jsx)(v.Fragment,{children:t})}var Gl=o(86486),Kl=o(59183);function Ul(e,t){window.__c={n:"TableRow"};const{disabled:o,store:r,groupFormat:n,collectionContextStore:s,propertyFormats:l,showRightActionsSpacer:a,disableTableWrap:d,frozoneProps:u,passesFilter:p,shouldShowMultiSelectCheckbox:h,...m}=e,{handleOpenPeekPage:S}=e,g=(0,i.useRef)(null),C=(0,oe.O7)(),f=(0,c.VK)((()=>!o&&r.canEdit()),[o,r]),y=(0,c.VK)((()=>(0,Fo.A7)(n,s).findIndex((e=>e===r))),[s,n,r]),x=(0,c.VK)((()=>{const e=s.collectionViewBlockStore();return!(!e||s.isFullScreen.state)&&(0,Yn.sY)(e)}),[s]),b=null==u?void 0:u.frozenIndex,w=void 0!==b,k=(0,c.VK)((()=>{const{collectionContextStore:t,groupFormat:o}=e,r=Kl.Z.state,i=t.collectionViewBlockStore();if(!i)return!1;if(!r.isActive||!(0,Kl.N)(r.selectionKey,{collectionViewBlockStore:i,groupFormat:o}))return!1;const{selection:n}=r,{start:s}=n;return void 0!==b&&y===s.row&&s.col<=b}),[e,b,y]),_=(0,c.VK)((()=>le.bW(b)),[b]),T=(0,i.useMemo)((()=>w?{...null==u?void 0:u.frozenStyles,...k?{zIndex:M.mK}:{zIndex:M.IK},...-1===b?{background:void 0}:{}}:{}),[b,null==u?void 0:u.frozenStyles,w,k]),[V,O]=(0,i.useMemo)((()=>w?[l.slice(0,b+1),l.slice(b+1)]:[[],l]),[b,l,w]),P=(0,c.VK)((()=>{var e;return Boolean(!d&&(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue()))}),[s,d]),R=(0,c.VK)((()=>{var e;return Boolean("timeline"===(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getType())||!P&&!l.some((e=>e.wrap)))}),[s,l,P]),j=(0,c.VK)((()=>{const e=s.permissionScopes.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[s.permissionScopes]),I=(0,v.jsxs)(i.Fragment,{children:[(0,v.jsx)("div",{className:ro.zwY,style:{display:"flex"},ref:g,children:(0,v.jsxs)("div",{style:{display:"flex"},children:[(0,v.jsx)("div",{style:w?T:{},children:(0,v.jsx)(zl,{isCollectionViewBlockSelected:x,shouldFreeze:-1!==b,children:(0,v.jsxs)(v.Fragment,{children:[h&&(0,v.jsx)(Ql,{store:r,passesFilter:Boolean(p),frozoneProps:u,canEdit:f}),(0,v.jsx)(Wl,{store:r,canEdit:f,propertyFormats:V,shouldSetCellHeight:R,indexAddendum:0,rowIndex:y,disabled:o,groupFormat:n,disableTableWrap:d,isLocked:j,isCollectionViewBlockSelected:x,passesFilter:Boolean(p),shouldShowMultiSelectCheckbox:h,frozoneProps:u,...m})]})})}),(0,v.jsx)(Wl,{store:r,canEdit:f,propertyFormats:O,shouldSetCellHeight:R,indexAddendum:_,rowIndex:y,disabled:o,groupFormat:n,disableTableWrap:d,isLocked:j,isCollectionViewBlockSelected:x,passesFilter:!0,shouldShowMultiSelectCheckbox:h,frozoneProps:u,...m})]})}),a&&!j&&(0,v.jsx)(Yl,{})]});return(0,Xn.ez)(r,t,(0,i.useMemo)((()=>({renderedType:"table_row",getNode:()=>g.current,getBlockStore:()=>r,activate(){const{mainEditorCurrentBlockStore:e}=Lo.default.state,t=le.mb({store:r,mainEditorCurrentBlockStore:e,collectionContextStore:s,fullyQualified:!1});t&&(S(),G.c4({environment:C,url:t}))}})),[s,C,S,r]),I)}function Wl(e){window.__c={n:"TableRowValues"};const{blockPropertyValueOverlayStore:t,propertyFormats:o,store:r,disableTableWrap:i,shouldSetCellHeight:n,indexAddendum:s,frozoneProps:l,...a}=e,d=(0,Ui.Y$)(),u=(0,c.VK)((()=>d.collectionViewStore()),[d]),p=(0,c.VK)((()=>r.getAssociatedCollectionStore()),[r]),h=(0,c.VK)((()=>!!u&&Boolean(!i&&u.getFormatStore().getKeyStore("table_wrap").getValue())),[u,i]),m=(0,c.VK)((()=>{const e=Gl.default.state;return Boolean(e.isOpen&&e.currentStore===r)}),[r]),S=(0,c.VK)((()=>!t.state.isOpen&&zo.default.state.stores.length>0&&zo.default.state.stores[0].id===r.id),[r.id,t]),g=(0,c.VK)((()=>d.currentSubitemFormatStoreForUiDisplay.state),[d]),C=(0,c.VK)((()=>"title"===(null==u?void 0:u.getFormat().table_subitem_toggle_column)),[u]),f=(0,c.VK)((()=>d.frozoneStore.state.frozenIndex),[d]);return(0,v.jsx)(v.Fragment,{children:o.map(((e,i)=>(0,v.jsx)($l,{index:i+(s??0),store:r,propertyFormat:e,isLastColumn:i===o.length-1,isRightMostFrozenColumn:f===i+(s??0),collectionViewStore:u,collectionStore:p,tableWrap:h,shouldSetCellHeight:n,isShowingHoverMenu:m,shouldCaptureKeyboard:S,subitemFormat:g,isSubitemToggleOnTitleColumn:C,blockPropertyValueOverlayStore:t,isScrolled:(null==l?void 0:l.isScrolled)??!1,...a},e.property)))})}const $l=e=>{window.__c={n:"TableRowValue"};const{propertyFormat:t,index:o,canEdit:r,isLastColumn:n,isRightMostFrozenColumn:s,store:l,schema:a,disabled:d,disableCellBorderRight:u,disableLastCellBorderRight:p,subitemPath:h,onShiftEnter:m,tableWrap:S,subitemFormat:g,isShowingHoverMenu:C,shouldCaptureKeyboard:f,isLocked:y,toggleButton:x,onPropertyClick:b,titleColumnIndex:w,isSubitemToggleOnTitleColumn:k,onPropertyTab:T,onPropertyUntab:V,onPropertyEnter:O,onPropertyEsc:P,onPropertyBgClick:R,onPropertyContextMenu:M,collectionViewStore:j,collectionStore:I,blockPropertyValueOverlayStore:F,shouldSetCellHeight:B,onOpenProperty:N,disableHorizontalEdgeScroll:D,handleOpenPeekPage:L,groupFormat:A,rowIndex:E,isCollectionViewBlockSelected:Z,passesFilter:H,isScrolled:z,shouldShowMultiSelectCheckbox:G}=e,{property:K,wrap:U}=t,W=(0,oe.O7)(),$=(0,c.VK)((()=>(0,_r.vf)({environment:W,propertyFormat:t})),[W,t]),q=(0,Ui.Y$)(),Q=(null==h?void 0:h.length)??0,Y=g&&(0,_r.lO)({columnIndex:o,titleColumnIndex:w,isSubitemToggleOnTitleColumn:k}),X=(0,i.useMemo)((()=>{if(void 0!==$)return Y?$-(0,_r.lZ)({columnIndex:o,indentLevel:Q,titleColumnIndex:w,isSubitemToggleOnTitleColumn:k}):$}),[Q,o,k,Y,w,$]),J=(0,i.useMemo)((()=>Y&&(0,v.jsx)(ql,{subitemFormat:g,toggleButton:x,subitemPath:h,shouldShowMultiSelectCheckbox:G,propertyIndex:o})),[Y,g,h,x,G,o]),ee=(0,i.useCallback)((()=>b(l,K,a)),[b,K,a,l]),te=d||!r,ie=(0,c.VK)((()=>{const e=Kl.Z.state,t=q.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Kl.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:A}))return!1;const{selection:r}=e,{start:i,end:n}=r,s=E===i.row||E===n.row||_.Z2(E,i.row,n.row),l=o===i.col||o===n.col||_.Z2(o,i.col,n.col);return s&&l}),[q,A,o,E]),ne=(0,c.VK)((()=>{const e=Kl.Z.state,t=q.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Kl.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:A}))return!1;const{selection:r}=e,{start:i}=r;return E===i.row&&o===i.col}),[q,A,o,E]),se=(0,c.VK)((()=>{const e=q.frozoneStore.state.frozenIndex;return void 0!==e&&o<=e}),[q,o]),le=(0,re.yK)((e=>{const t=Z?e.tableFrozenSelectedDividerColor:e.tableDividerColor;return{tableCell:{display:"flex",width:$||void 0,position:"relative",borderRight:u||s||n&&p?"none":`1px solid ${t}`,boxShadow:se?`0 -1px 0 ${t}`:void 0},tableSelectionOverlay:{background:ie?ve.ZP.blueWithAlpha(.07):void 0,borderRadius:ne?3:void 0,boxShadow:ne?e.outlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,...0===o&&G?{width:"calc(100% + 8px)",left:-8}:{width:"100%",left:0}},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:$||void 0}}}),[Z,u,p,s,n,se,ie,ne,$,o,G]),ae=(0,v.jsxs)(_o.Z,{debugName:"TableRow",capture:f,onShiftEnter:m,children:[(0,v.jsx)(vo.Z,{collectionStore:I,store:l,property:K,disabled:te,locked:y,width:X,format:yo.C.Table,forceMouseEntered:"title"===K&&r?C:void 0,tableWrap:Boolean(S||U),isLast:n,indentLevel:0===o&&h?h.length:void 0,onTab:T,onUntab:V,onEnter:O,onClick:ee,onEsc:P,onBgClick:R,onContextMenu:M,collectionViewStore:j,shouldSetCellHeight:B,onOpenProperty:N,blockPropertyValueOverlayStore:F,disableHorizontalEdgeScroll:D,handleOpenPeekPage:L,propertyIndex:o,shouldShowMultiSelectCheckbox:G},K),s&&(0,v.jsx)(xs,{passesFilter:H,isScrolled:z})]});return(0,v.jsxs)("div",{className:ro.mWS,"data-row-index":E,"data-col-index":o,style:le.tableCell,children:[Y&&J,(0,v.jsx)("div",{style:le.propertyValueContainer,children:ae}),ie&&(0,v.jsx)("div",{style:le.tableSelectionOverlay})]})};function ql(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:r,propertyIndex:i}=e,n=(null==o?void 0:o.length)??0,s=Math.max((n-1)*Fo.Hw,0)+Fo.gY;return t?(0,v.jsxs)("div",{style:{paddingTop:4,display:"flex",...0===i&&r?{marginLeft:-8,marginRight:4}:{}},children:[(0,v.jsx)("div",{style:{width:s}}),t]}):(0,v.jsx)("div",{style:{minWidth:s+Fo.Hw,...0===i&&r?{marginLeft:-8,marginRight:4}:{}}})}const Ql=i.memo((e=>{window.__c={n:"RowSelectCheckbox"};const{store:t,passesFilter:o,canEdit:r,frozoneProps:n}=e,s=(0,Ui.Y$)(),l=(0,oe.O7)(),a=(0,c.VK)((()=>zo.default.state.stores.includes(t)),[t]),d=(0,i.useCallback)((e=>{var o;(0,_r.vg)({collectionViewBlockId:null===(o=s.collectionViewBlockStore())||void 0===o?void 0:o.id})?W.Z5({environment:l,stores:[t]}):W.Ys({environment:l,store:t,toggle:!0}),e.stopPropagation()}),[s,l,t]);return(0,v.jsx)(bs,{checkedState:a,onClick:d,checkboxType:"single_row",collectionContextStore:s,frozoneProps:n,passesFilter:o,disabled:!r})}));function Yl(){return(0,v.jsx)("div",{style:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}})}const Xl=i.memo(i.forwardRef(Ul),Jt.Z);var Jl=o(12137),ea=o(55061),ta=o(11302),oa=o(12714),ra=o(39865),ia=o(11368),na=o(24646);const sa=function(e){window.__c={n:"FrozenColumnRepositioner"};const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:r,xForFirstCellInRow:n,showPropertyFormats:s,frozenSectionWidth:l}=e,a=(0,oe.O7)(),d=(0,Ui.DK)(),u=(0,i.useRef)(null),p=(0,i.useRef)(null),[h,m]=i.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[S,g]=i.useState(0),[C,f]=i.useState(0),y=(0,c.VK)((()=>t.state.isRepositioning||h.isMouseDown),[t,h.isMouseDown]),x=(0,c.VK)((()=>t.state.newFrozenIndex),[t]),b=(0,c.VK)((()=>!!d&&(0,le.fk)({environment:a,collectionContextStore:d})),[a,d]),w=(0,c.VK)((()=>null==d?void 0:d.frozoneStore.state.isScrolled),[d]),k=(0,c.VK)((()=>!w&&-1===o&&b?-4:0),[o,w,b]),T=(0,c.VK)((()=>h.isEntered||y),[h.isEntered,y]),V=(0,c.VK)((()=>t.state.newFrozenColumnXPosition),[t]),O=(0,i.useContext)(ia.Ue),P=(0,c.VK)((()=>null==O?void 0:O.horizontalScroller),[O]),I=(0,i.useCallback)((()=>{var e,t,o;if(!P||!u.current)return 0;const r=(null===(e=u.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,i=null===(t=P.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(ro.kUP);return(i&&i.length>0?null===(o=i[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-r}),[P]),F=(0,i.useCallback)((()=>{var e,t,o,r,i;if(!P||!u.current)return 0;const n=(null===(e=u.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,s=null===(t=P.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(ro.zwY),l=s&&s.length>0?null===(o=s[s.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(r=P.scrollerEl())||void 0===r?void 0:r.getElementsByClassName(ro.Gcz),c=a&&a.length>0?null===(i=a[a.length-1].getBoundingClientRect())||void 0===i?void 0:i.bottom:0;return Math.max(l,c)-n}),[P]),B=(0,c.VK)((()=>{var e;const t=null===(e=u.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==l?new DOMRect(t.x+l+h.x+10,t.y+h.y+10,3,3):void 0}),[l,h]),N=(0,c.VK)((()=>{const e=(null==d?void 0:d.frozoneStore.state.scrollerLeftOffset)??0,t=(0,na.Wk)(a),o=Math.max(t-e,0);return d&&(0,_r.iZ)(a,d)?o:0}),[d,a]),D=(0,i.useCallback)((e=>{if(void 0===o||void 0===r||void 0===l||null===u.current||null===p.current)return;const i=u.current.getBoundingClientRect(),a=e.clientX-i.x;if(null==d||d.frozoneStore.setState({...null==d?void 0:d.frozoneStore.state,tryShowHiddenFrozenColumn:a<42}),!T)return;const c=I();g(c);const h=F();f(h);const S=2+l,C=Math.max(a-S,-S),v=e.clientY-i.y-14,x=i.bottom-i.top-14+h,b=y?c:-14,k=Math.max(Math.min(v,x),b);if(m((e=>({...e,x:y?C:0,y:k}))),y){const e=s,i=p.current.getBoundingClientRect();let c=a,d=n,u=-1,h=d,m=Math.abs(d-c);for(let t=0;t<e.length&&!(t>r);t++){const r=e[t];d+=(null==r?void 0:r.width)??0,w&&t===o+1&&(c-=i.x);const n=Math.abs(d-c);n<m&&(m=n,h=d,u=t)}t.setState({...t.state,newFrozenIndex:u,newFrozenColumnXPosition:h-l-1})}}),[o,r,l,null==d?void 0:d.frozoneStore,T,I,F,y,s,n,t,w]);(0,i.useEffect)((()=>{const e=_.P2((e=>{D(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[D]);const L=(0,i.useCallback)((e=>{y||(D(e.nativeEvent),m((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[y,D]),A=(0,i.useCallback)((e=>{y||m((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[y]),E=(0,i.useCallback)((e=>{m((e=>({...e,isMouseDown:!0})))}),[]),Z=(0,i.useCallback)((e=>{y&&m((e=>({...e,isEntered:!0})))}),[y]),H=(0,i.useCallback)((e=>{m((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),z=(0,i.useCallback)((e=>{y&&m((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[y]),G=void 0!==x&&void 0!==o&&x<=o,K=(0,re.yK)((e=>({repositionerContainer:{zIndex:M.hc,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:y?"grabbing":"grab",pointerEvents:y?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:N,height:"100%"},tooltipContainer:{position:"absolute",left:l??0,zIndex:M.xP,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:y?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:y?h.x-1:-1,top:y?S:0,width:2,height:y?`calc(100% + ${C-S}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:y?S:0,width:1,height:y?`calc(100% + ${C-S}px`:"100%",background:e.accentColors.blue[300]},frozenGhostColumn:{left:V,opacity:y&&G?1:0},unfrozenGhostColumn:{left:(l??0)+(V??0),opacity:T&&y&&!G?1:0},tooltipDraggable:{position:"absolute",left:y?h.x-2:-2,top:h.y,width:4,height:28,background:e.accentColors.blue[400],borderRadius:4},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...R.Z.textOverflowStyle}})),[y,N,l,h,S,C,T,V,G]);return(0,v.jsx)("div",{className:ro.wXs,style:K.repositionerContainer,onMouseEnter:Z,onMouseLeave:H,onMouseUp:z,children:(0,v.jsxs)("div",{style:K.repositionerOutsideStickyWrapper,ref:p,children:[(0,v.jsx)("div",{style:K.repositionerInsideStickyWrapper,ref:u,children:(0,v.jsx)(et.ZP,{renderTooltip:()=>y&&void 0!==x&&x!==o?(0,v.jsx)(j.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:x+1}}):(0,v.jsx)(j.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:y||void 0,placement:is.u.Right,originRect:B,render:e=>(0,v.jsx)(ts.Z,{isVisible:!0,animationStyle:{translateX:k,opacity:T?1:0},render:()=>(0,v.jsxs)("div",{...e,style:K.tooltipContainer,children:[(0,v.jsx)("div",{style:K.tooltipOrigin,onMouseEnter:L,onMouseLeave:A,onMouseDown:E}),(0,v.jsx)("div",{style:{...K.ghostColumnBase,...K.frozenGhostColumn}}),(0,v.jsx)("div",{style:K.tooltipColumn}),(0,v.jsx)("div",{style:K.tooltipDraggable})]})})})}),(0,v.jsx)("div",{style:{...K.ghostColumnBase,...K.unfrozenGhostColumn}})]})})};var la=o(4708),aa=o(39500),ca=o(77907),da=o(95802),ua=o(80796),pa=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}(pa||{});class ha extends s.Z{constructor(){super(...arguments),this.rowsWrapEl=null,this.observer=void 0,this.storeTypes={dragAndFillStore:d.default.createClass(void 0),frozenColumnRepositionStore:d.default.createClass({isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragStart=e=>function(e,t,o,r,i,n,s,l,a,c,d){if(e.preventDefault(),function(e){let t=e;for(;null!==t;){if(t.classList.contains(ro.wXs))return!0;t=t.parentElement}return!1}(e.target))l.setState({isRepositioning:!0,newFrozenIndex:a.state,newFrozenColumnXPosition:void 0}),function(e,t,o,r,i){var n;if(!t.frozoneStore.state.isScrolled)return;const s=i.state[0],l=o[0].property,a=bl.Z.findBlockPropertyValue(s,l),c=t.frozoneStore.state.scrollerLeftOffset??0,d=(0,na.Wk)(e),u=Math.max(d-c,0),p=(0,_r.iZ)(e,t)?u:0;null==a||null===(n=a.getContextHorizontalScroller())||void 0===n||n.scrollTo(void 0,r-p)}(t,o,r,i,c),ua.Z.setState({...ua.Z.state,disableHorizontalEdgeScroll:!0,disableVerticalEdgeScroll:!0});else{const t=d.state;if(t&&fa(n,o)&&function(e){let t=e;for(;null!==t;){if(t.classList.contains(ro.JR_))return!0;t=t.parentElement}return!1}(e.target))return void s.setState({...t})}pe.wG()}(e,this.environment,this.props.collectionContextStore,this.props.showPropertyFormats,this.props.paddingLeft,this.props.disabled,this.stores.dragAndFillStore,this.stores.frozenColumnRepositionStore,this.frozenIndex,this.allRowsStore,this.normalizedTableSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragMove=e=>function(e,t,o,r,i,n,s,l,a,c){if(s.state.isRepositioning);else if(aa.X9()){var d;const s=Ca(e.target);if(!s)return;const u=n.state,p=(null==u?void 0:u.start)??(null===(d=l.state)||void 0===d?void 0:d.start)??s;if(!p)return;const h=s;if(n.state&&p.col!==h.col)return;_a({selection:{start:p,end:h},shouldNormalize:!0},t,o,r,i,a,c)}}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.stores.dragAndFillStore,this.stores.frozenColumnRepositionStore,this.normalizedTableSelectionStore,this.allRowsStore,this.selectionStartRectStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragEnd=()=>{return e=this.environment,t=this.props.collectionContextStore,o=this.props.showPropertyFormats,r=this.props.schema,i=this.stores.dragAndFillStore,n=this.stores.frozenColumnRepositionStore,s=this.normalizedTableSelectionStore,l=this.allRowsStore,function(e,t,o){const r=o.state.isRepositioning;r&&Q.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:e,perform:r=>{Js.oz({environment:e,collectionContextStore:t,currentIndex:o.state.newFrozenIndex,transaction:r,entrypoint:"TableSelectionOverlay.FrozenColumnRepositioner"}),o.reset()}})}(e,t,n),void function(e,t,o,r,i,n,s){var l;const a=i.state;if(!a)return;const{start:c,end:d}=a;if(c.col!==d.col||c.row!==d.row)return;const u=t,p=u[c.col],h=null===(l=o[p.property])||void 0===l?void 0:l.type;if("verification"===h)return;const m=n.state;if(!m)return;Q.createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:e,perform:e=>{wa({transaction:e,selection:m,start:c},t,s)}});const S=Math.min(m.start.row,m.end.row),g=Math.max(m.start.row,m.end.row);h&&g!==S&&F.qm({environment:e,collectionContextStore:r,property_type:h,num_rows:g-S}),i.reset()}(e,o,r,t,i,s,l);var e,t,o,r,i,n,s,l},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragCancel=()=>{return e=this.stores.dragAndFillStore,t=this.stores.frozenColumnRepositionStore,e.reset(),t.reset(),void pe.wG();var e,t},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleLeft=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();Zo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Js.e2({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,shiftKey:"shiftKey"in e&&e.shiftKey||!1,columnCount:i.length}),ba(pa.Left,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRight=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();Zo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Js.FC({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,columnCount:i.length,rowCount:s.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),ba(pa.Right,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUp=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();Zo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Js.zJ({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),ba(pa.Up,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDown=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();Zo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Js.DI({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,rowCount:s.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),ba(pa.Down,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEnter=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();Zo.Z.setKeyboardMode(!0);const d=l.state;if(!d)return;const u=a.state,p=u[d.start.row],h=r[d.start.col].property,m=o[h];if(!m)return;if(!i)if(fe.uk.includes(m.type)){if("checkbox"===m.type){const e=p.getPropertyStore(h),o=Kt.Ml(e.getValue()),r=u.slice(d.start.row,d.end.row+1);Q.createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:t,perform:e=>{for(const t of r)go.sO({store:t.getPropertyStore(h),value:Kt._I(!o),transaction:e})}})}}else mo.bA({environment:t,blockPropertyValueOverlayStore:n,store:p,property:h,format:yo.C.Table,disableHorizontalEdgeScroll:c,collectionContextStore:s}),pe.wG()}(e,this.environment,this.props.schema,this.props.showPropertyFormats,this.props.disabled,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.normalizedTableSelectionStore,this.allRowsStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTab=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault(),Zo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Js.FC({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,columnCount:i.length,rowCount:s.state.length,shiftKey:!1}),ba(pa.Right,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUntab=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault(),Zo.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;Js.e2({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,shiftKey:!1,columnCount:i.length}),ba(pa.Left,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEsc=e=>function(e,t,o,r){const{device:i}=t;if(i.isMobile)return;e.preventDefault(),Zo.Z.setKeyboardMode(!0);const n=o.state;if(pe.wG(),n){const e=(0,_r.AV)(n),o=r.state.slice(e.minRow,e.maxRow+1);W.Z5({environment:t,stores:o})}}(e,this.environment,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMoveTo=e=>function(e,t,o,r){e.preventDefault&&e.preventDefault();Zo.Z.setKeyboardMode(!0);const i=o.state;if(pe.wG(),i){const e=(0,_r.AV)(i),o=r.state.slice(e.minRow,e.maxRow+1);if(0===o.length)return;W.Z5({environment:t,stores:o});const n=da.C.getRectFromStore(o[0]);ta.bA({environment:t,blocks:o,originRect:n,moveToContext:"action_menu"})}}(e,this.environment,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDelete=e=>function(e,t,o,r,i,n,s){const l=n.state,a=o.normalizedSchemaStore.state;l&&!r&&Q.createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:t,perform:e=>{Js.NE({selection:l,schema:a,currentPropertyFormats:i,currentRows:s.state,transaction:e})}})}(0,this.environment,this.props.collectionContextStore,this.props.disabled,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCut=e=>function(e,t,o,r,i,n,s,l){const a=s.state,c=o.normalizedSchemaStore.state,d=o.collectionViewBlockStore();if(!d)return;a&&!r&&Q.createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:t,perform:t=>{Js.nA({selectionKey:{collectionViewBlockStore:d,groupFormat:i},schema:c,selection:a,currentPropertyFormats:n,currentRows:l.state,event:e,transaction:t})}})}(e,this.environment,this.props.collectionContextStore,this.props.disabled,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCopy=e=>function(e,t,o,r,i,n){const s=i.state,l=t.normalizedSchemaStore.state,a=t.collectionViewBlockStore();if(!a)return;s&&Js.qn({selectionKey:{collectionViewBlockStore:a,groupFormat:o},schema:l,selection:s,currentPropertyFormats:r,currentRows:n.state,event:e})}(e,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePaste=e=>function(e,t,o,r,i,n,s,l,a,c,d){const u=c.state,p=o.collectionViewBlockStore();if(!p)return;u&&!a&&Q.createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:t,perform:a=>{Js.j0({environment:t,collectionContextStore:o,selectionKey:{collectionViewBlockStore:p,groupFormat:r},selection:u,currentPropertyFormats:n,currentRows:d.state,event:e,transaction:a,schema:i,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l})}})}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.schema,this.props.showPropertyFormats,this.props.markdownLinkifyIt,this.props.tinyMceMicrosoftWordPasteFilter,this.props.disabled,this.normalizedTableSelectionStore,this.allRowsStore),this.handleCommandEnter=e=>{const{device:t}=this.environment,o=this.normalizedTableSelectionStore.state;if(t.isMobile||!o)return;const{collectionContextStore:r}=this.props,i=this.allRowsStore.state[o.start.row],{mainEditorCurrentBlockStore:n}=Lo.default.state,s=le.mb({store:i,mainEditorCurrentBlockStore:n,collectionContextStore:r,fullyQualified:!1});s&&this.navigate(s)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleShiftEnter=()=>function(e,t,o,r,i,n,s,a,c,d,p){const{device:h}=e;if(h.isMobile)return;const m=n.state;if(!m)return;if(!Ce.M_(e))return;if(!t.shouldAllowNewItemCreation())return;const S=s.state,g=S[m.start.row],C=t.subitemTreeStore.state,f=(0,kr.DY)(C.children,(e=>e.value.store===g)),v="table_selection_overlay_shift_enter";if(f){const n=f?(0,Fo.Af)(f.map((e=>e.value.store))):"",c=t.subitemExpandedStore.state.get(n),d=Boolean(null==c?void 0:c.isExpanded),p=[...f].splice(0,f.length-1),h=p?(0,Fo.Af)(p.map((e=>e.value.store))):"",C=t.subitemExpandedStore.state.get(h),y=Boolean(null==C?void 0:C.isExpanded);if(d||y)Q.createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:e,perform:i=>{const n=t.collectionStore();if(!n)return;const s=L.yk({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],store:g,before:!1,collectionStore:n,transaction:i,subitemPath:f,subitemInsertDirection:y&&!d?"below":"into",from:v});s&&r&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{mo.bA({isNewBlock:!0,environment:e,blockPropertyValueOverlayStore:r,store:s,property:"title",format:yo.C.Table,collectionContextStore:t})}))}))}});else{const r={col:m.end.col,row:t.currentViewHasSort()?S.length:m.end.row+1};Q.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:e,perform:i=>{const n=L.IW({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],insertAtIndex:r.row,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:v});if(n&&!n.coercionSucceeded){const r=o?[o]:[],i=t.groupsStore.getGroupState(r);se.CH({environment:e,store:n.newStore,peekMode:le.kr(t.collectionViewStore()),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:u.tY.Create})}}}),l.default.afterNextFlush((()=>{_a({selection:{start:r,end:r},shouldNormalize:!1},e,t,o,i,s,a)}))}}else{const r={col:m.end.col,row:t.currentViewHasSort()?S.length:m.end.row+1};Q.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:e,perform:i=>{const n=L.IW({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],insertAtIndex:r.row,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:v});if(n&&!n.coercionSucceeded){const r=o?[o]:[],i=t.groupsStore.getGroupState(r);se.CH({environment:e,store:n.newStore,peekMode:le.kr(t.collectionViewStore()),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:u.tY.Create})}}}),l.default.afterNextFlush((()=>{_a({selection:{start:r,end:r},shouldNormalize:!1},e,t,o,i,s,a)}))}ba(pa.Down,i,n,s,c,d,p),mo.xv({environment:e,blockPropertyValueOverlayStore:r})}(this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.selectionStartRectStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDuplicate=e=>function(e,t,o,r,i,n){const{device:s}=t;if(s.isMobile)return;const l=i.state;if(!l||l.start.col!==l.end.col||o)return;if(!Ce.M_(t))return;e.preventDefault(),Q.createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:t,perform:e=>{wa({transaction:e,selection:l,start:l.start},r,n)}})}(e,this.environment,this.props.disabled,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCommandShiftEnter=e=>function(e,t,o,r){const{device:i}=t;if(i.isMobile)return;const n=o.state;if(n){const e=r.state[n.start.row],o=(0,Bo.ZP)({store:e,fullyQualified:!1,pageVisitSource:u.tY.LinkInPage});oa.D({environment:t,url:o})}}(0,this.environment,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeypress=e=>function(e,t,o,r,i,n,s,l,a,c){if(!e.key||e.metaKey||e.ctrlKey)return;e.preventDefault(),Zo.Z.setKeyboardMode(!0);const d=l.state;if(!d)return;const u=a.state[d.start.row],p=r[d.start.col].property,h=o[p];if(!h)return;!i&&fe.ub.includes(h.type)&&e.key&&1===e.key.length&&(mo.bA({environment:t,blockPropertyValueOverlayStore:n,store:u,property:p,format:yo.C.Table,disableHorizontalEdgeScroll:c,insertChar:e.key,collectionContextStore:s}),pe.wG())}(e,this.environment,this.props.schema,this.props.showPropertyFormats,this.props.disabled,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.normalizedTableSelectionStore,this.allRowsStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyTab=()=>function(e,t,o,r,i,n,s,l,a,c,d){const u=t.state;if(u.isOpen){const{store:p,property:h}=u,m=xa(p,h,o,n),S=o,g={col:Math.min(m.col+1,S.length-1),row:m.row};_a({selection:{start:g,end:g},shouldNormalize:!0},e,r,i,o,n,s),ba(pa.Right,o,l,n,a,c,d),mo.xv({environment:e,blockPropertyValueOverlayStore:t})}}(this.environment,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore,this.normalizedTableSelectionStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyUntab=()=>function(e,t,o,r,i,n,s,l,a,c,d){const u=t.state;if(u.isOpen){const{store:p,property:h}=u,m=xa(p,h,o,n),S={col:Math.max(m.col-1,0),row:m.row};_a({selection:{start:S,end:S},shouldNormalize:!0},e,r,i,o,n,s),ba(pa.Left,o,l,n,a,c,d),mo.xv({environment:e,blockPropertyValueOverlayStore:t})}}(this.environment,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore,this.normalizedTableSelectionStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEnter=()=>function(e,t,o,r,i,n,s,a,c,d,u){const p=t.state;if(!p.isOpen)return;const{store:h,property:m}=p,S=xa(h,m,o,n),g={col:S.col,row:S.row+1};l.default.afterNextFlush((()=>{va(t,e)&&_a({selection:{start:g,end:g},shouldNormalize:!0},e,r,i,o,n,s)})),ba(pa.Down,o,a,n,c,d,u),mo.xv({environment:e,blockPropertyValueOverlayStore:t})}(this.environment,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore,this.normalizedTableSelectionStore,this.frozenSectionWidthStore,this.frozenIndex,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyClick=(e,t,o)=>function(e,t,o,r,i,n,s,l,a){var c;const{device:d}=r;if("checkbox"!==(null===(c=o[t])||void 0===c?void 0:c.type)||d.isMobile)pe.wG();else{const o=xa(e,t,i,l);_a({selection:{start:o,end:o},shouldNormalize:!0},r,n,s,i,l,a)}}(e,t,o,this.environment,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyBgClick=()=>{return e=this.environment,t=this.props.blockPropertyValueOverlayStore,o=this.props.showPropertyFormats,r=this.props.collectionContextStore,i=this.props.groupFormat,n=this.allRowsStore,s=this.selectionStartRectStore,l=this.normalizedTableSelectionStore,a=this.frozenSectionWidthStore,c=this.frozenIndex,d=this.props.disableHorizontalEdgeScroll,void Ta(e,t,o,r,i,n,s,l,a,c,d);var e,t,o,r,i,n,s,l,a,c,d},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEsc=()=>{return e=this.environment,t=this.props.collectionContextStore,o=this.props.blockPropertyValueOverlayStore,r=this.props.showPropertyFormats,i=this.props.groupFormat,n=this.allRowsStore,s=this.selectionStartRectStore,l=this.normalizedTableSelectionStore,a=this.frozenSectionWidthStore,c=this.frozenIndex,d=this.props.disableHorizontalEdgeScroll,void Ta(e,o,r,t,i,n,s,l,a,c,d,(o=>{const{isNewBlock:r,store:i}=o;r&&i.isEmptyTitle()&&i.isEmptyPage()&&Q.createAndCommit({userAction:"TableSelectionOverlay.handlePropertyEsc",environment:e,perform:o=>{ra.y8({environment:e,blocks:[i],transaction:o}),o.postSubmitCallbacks.push((o=>{if(!o){const o=t.collectionStore(),r=t.collectionViewBlockStore();I.dh(e,{analyticsName:"delete",from:"collection_esc_shortcut",block_id:i.id,block_type:"page",collection_id:null==o?void 0:o.id,collection_view_id:null==r?void 0:r.id})}}))}})}));var e,t,o,r,i,n,s,l,a,c,d},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyOpenProperty=e=>{!function(e,t,o,r,i){const n=t.state;if(n.isOpen){const{store:s}=n;mo.bA({environment:i,blockPropertyValueOverlayStore:t,store:s,property:e,format:yo.C.Table,disableHorizontalEdgeScroll:o,collectionContextStore:r})}}(e,this.props.blockPropertyValueOverlayStore,Boolean(this.props.disableHorizontalEdgeScroll),this.props.collectionContextStore,this.environment)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyContextMenu=e=>function(e,t,o,r,i){e.preventDefault();const n=r.state,s=i.state,l=Ca(e.target);let a=!1;if(s&&l){const r=Math.min(s.start.row,s.end.row),i=Math.max(s.start.row,s.end.row);if(l.row>=r&&l.row<=i){const s=n.slice(r,i+1);s.length>0&&(W.Z5({environment:t,stores:s}),W.Ys({environment:t,store:s[0]}),ho.Qn({environment:t,stores:zo.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"default",showInput:!0,analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:o}}),a=!0)}}if(!a&&l){const r=n[l.row];r&&(W.Ys({environment:t,store:r}),ho.Qn({environment:t,stores:zo.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"default",showInput:!0,analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:o}}))}}(e,this.environment,this.props.collectionContextStore,this.allRowsStore,this.normalizedTableSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowSelectableEnter=e=>function(e,t,o,r,i,n,s){const l=n.state,a=e.blocks.map((e=>l.indexOf(e))),c=_.VV(a)||0,d=_.Fp(a)||0;c>=0&&d>=0&&_a({selection:{start:{col:0,row:c},end:{col:0,row:d}},shouldNormalize:!0},t,o,r,i,n,s)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.allRowsStore,this.selectionStartRectStore),this.handleRowsWrapMount=e=>{this.rowsWrapEl=e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowsObserverChange=()=>{this.selectionStartRectStore.recompute()},this.allRowsStore=this.createComputedStore((()=>{const{groupFormat:e,collectionContextStore:t}=this.props;return(0,Fo.A7)(e,t)})),this.normalizedTableSelectionStore=this.createComputedStore((()=>{const e=Kl.Z.state,t=this.props.collectionContextStore.collectionViewBlockStore();if(!t)return;const{groupFormat:o}=this.props;if(!e.isActive||!(0,Kl.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:o}))return;const{selection:r}=e;return ka(r,this.props.showPropertyFormats,this.allRowsStore)}),!0),this.selectionStartRectStore=this.createComputedStore((()=>{const e=this.normalizedTableSelectionStore.state;if(e)return this.getCellRect(e.start)}),!0),this.frozenIndex=this.createComputedStore((()=>this.props.collectionContextStore.frozoneStore.state.frozenIndex)),this.maxFrozenIndex=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=e.frozoneStore.state.scrollerWidth;return null==t?void 0:t.getTableMaxFrozenColumnIndex(o,e.normalizedFormatStore.state)})),this.frozenSectionWidthStore=this.createComputedStore((()=>{const e=this.frozenIndex.state;if(void 0!==e){let t=ya(this.props.collectionContextStore,this.environment);const{showPropertyFormats:o}=this.props,r=o;for(let i=0;i<=e&&!(i>=r.length);i++){const e=r[i];e.width&&(t+=e.width)}return t-1}}),!0),this.multiSelectCheckedStore=this.createComputedStore((()=>{const e=function(e,t){const o=t?[t]:[];return(0,Fo.A7)(o[0],e)}(this.props.collectionContextStore,this.props.groupFormat),t=e.length;if(0===t)return!1;const o=zo.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")})),this.shouldRenderFrozenColumnRepositioner=this.createComputedStore((()=>void 0!==this.frozenIndex.state&&!this.stores.dragAndFillStore.state&&!this.multiSelectCheckedStore.state&&!Kl.Z.state.isActive&&void 0===this.props.tableStore.state.temporaryFormat&&this.props.collectionContextStore.permissionScopes.state.canConfigureBlock)),this.renderArgs={onPropertyTab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyTab,onPropertyUntab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyUntab,onPropertyEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEnter,onPropertyClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyClick,onPropertyEsc:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEsc,onPropertyBgClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyBgClick,onPropertyContextMenu:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyContextMenu,onOpenProperty:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyOpenProperty,onSelectableEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowSelectableEnter}}willUnmount(){super.willUnmount(),this.observer&&this.observer.disconnect()}didMount(){super.didMount(),this.rowsWrapEl&&(this.observer=new MutationObserver(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowsObserverChange),this.observer.observe(this.rowsWrapEl,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):G.c4({environment:this.environment,url:e})}renderComponent(){const{store:e,schema:t,showPropertyFormats:o}=this.props,r=this.normalizedTableSelectionStore.state,i=fa(this.props.disabled,this.props.collectionContextStore)&&r&&(r.start.col===r.end.col&&r.start.row===r.end.row||this.stores.dragAndFillStore.state)?(0,v.jsx)(Sa,{store:e,schema:t,selection:r,dragAndFillStore:this.stores.dragAndFillStore,showPropertyFormats:o,selectionStartRectStore:this.selectionStartRectStore,rowsWrapRect:this.getRowsWrapRect(),frozenIndexStore:this.frozenIndex,currentRowsStore:this.allRowsStore}):null,n=this.shouldRenderFrozenColumnRepositioner.state?(0,v.jsx)(sa,{frozenColumnRepositionStore:this.stores.frozenColumnRepositionStore,frozenIndex:this.frozenIndex.state,maxFrozenIndex:this.maxFrozenIndex.state,xForFirstCellInRow:ya(this.props.collectionContextStore,this.environment),showPropertyFormats:o,frozenSectionWidth:this.frozenSectionWidthStore.state}):null,s=this.props.render(this.renderArgs);return(0,v.jsx)(_o.Z,{debugName:"TableSelectionOverlay",capture:void 0!==this.normalizedTableSelectionStore.state,onLeft:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleLeft,onRight:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRight,onUp:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUp,onDown:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDown,onEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEnter,onTab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTab,onUntab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUntab,onEsc:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEsc,onDelete:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDelete,onBackspace:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDelete,onCut:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCut,onCopy:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCopy,onPaste:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePaste,onCommandEnter:this.handleCommandEnter,onShiftEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleShiftEnter,onCommandShiftEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCommandShiftEnter,onDuplicate:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDuplicate,onKeypress:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeypress,onMoveTo:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMoveTo,children:(0,v.jsx)(xl.Z,{onDraggableDragStart:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragStart,onDraggableDragMove:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragMove,onDraggableDragEnd:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragEnd,onDraggableDragCancel:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragCancel,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,render:e=>(0,v.jsxs)("div",{style:{position:"relative",minWidth:this.props.minWidth},...e,ref:this.handleRowsWrapMount,children:[n,i,s]})})})}getRowsWrapRect(){return this.rowsWrapEl?this.rowsWrapEl.getBoundingClientRect():void 0}getCellRect(e){const{rowsWrapEl:t}=this;if(!t)return;const{showPropertyFormats:o}=this.props,r=o,i=function(e,t){if(!t)return;const o=da.C.findSelectablesFromStore(e),r=o.map((e=>e.getNode())).find((e=>t.contains(e)));if(!r)return;return r.getBoundingClientRect()}(this.allRowsStore.state[e.row],t);if(!i)return;const n=t.getBoundingClientRect(),s=i.height,l=i.top-n.top-1,a=r[e.col].width||0,c=s+1;let d=ya(this.props.collectionContextStore,this.environment);for(let u=0;u<e.col;u++){const e=r[u];e.width&&(d+=e.width)}return new DOMRect(d-1,l,a+1,c)}}ha.displayName="TableSelectionOverlay",ha.contextTypes={...mr.wK,...s.w};const ma=10;function Sa(e){var t;window.__c={n:"DragAndFillHandle"};const{store:o,schema:r,selection:i,dragAndFillStore:n,currentRowsStore:s,showPropertyFormats:l,selectionStartRectStore:a,rowsWrapRect:d,frozenIndexStore:u}=e,p=(0,c.VK)((()=>n.state),[n]),h=(0,c.VK)((()=>{const e=(null==p?void 0:p.start)||i.start;return l[e.col]}),[p,i,l]),m=(0,j.useIntl)(),S=(0,c.VK)((()=>{if(!p||!h)return[];const{start:e}=p,t=s.state[e.row].getModel();return t?(0,ea.v4)({property:h.property,schema:r,block:t,getRecordValue:o.getRecordValue,userTimeZone:(0,Ee.r)(),baseURL:void 0,intl:m}):""}),[s,p,m,h,r,o]),g=h?null===(t=r[h.property])||void 0===t?void 0:t.type:void 0,C=(0,c.VK)((()=>a.state),[a]),f=(0,c.VK)((()=>u.state),[u]),y=(0,c.VK)((()=>void 0!==f&&i.start.col<=f),[f,i]),x=(0,re.yK)((e=>({dragAndFillContainer:{zIndex:y?M.hc+4:void 0,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:y?"sticky":void 0,left:"0"},tooltipContainer:{position:"absolute",left:C?C.left+C.width-5:void 0,zIndex:M.IK},tooltipOrigin:{position:"absolute",left:0,top:C?C.bottom-7:void 0,width:ma,height:1.5*ma,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:C?C.bottom-5:void 0,width:9,height:9,border:`2px solid ${ve.ZP.blueWithAlpha(.57)}`,transform:p?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...R.Z.textOverflowStyle}})),[y,C,p]);if(!C)return null;if(!g||fe.ZY(g)||"rollup"===g||"formula"===g||"verification"===g)return null;let b;return d&&(b=new DOMRect(C.x+d.x+C.width-4,C.y+d.y+C.height-4,7,7)),(0,v.jsx)(et.ZP,{renderTooltip:()=>{const e=(0,v.jsx)(j.FormattedMessage,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"});return p?(0,v.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[e,(0,v.jsx)("div",{style:x.tooltipText,children:S})]}):e},delayThreshold:300,forceVisibleState:!!p||void 0,originRect:b,placement:is.u.Right,render:e=>(0,v.jsx)("div",{...e,className:ro.JR_,style:x.dragAndFillContainer,children:(0,v.jsx)("div",{style:x.dragAndFillOutsideStickyWrapper,children:(0,v.jsx)("div",{style:x.dragAndFillInsideStickyWrapper,children:(0,v.jsxs)("div",{style:x.tooltipContainer,children:[(0,v.jsx)("div",{style:x.tooltipOrigin}),(0,v.jsx)("div",{style:x.tooltipCircle})]})})})})})}function ga(e){window.__c={n:"TableSelectionOverlayWithDeps"};const{value:t}=(0,ca.useDependency)(ca.deps.markdownLinkifyIt),{value:o}=(0,ca.useDependency)(ca.deps.tinyMceMicrosoftWordPasteFilter);return(0,v.jsx)(ha,{...e,markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:o})}function Ca(e){let t=e;for(;null!==t&&!t.classList.contains(ro.mWS);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function fa(e,t){const o=t.permissionScopes.state;return!e&&o.canEditContent}function va(e,t){if(!(0,la.zq)(t))return!0;const o=e.state;return!o.isOpen||0===o.additionalStores.length}function ya(e,t){return(0,le.fk)({environment:t,collectionContextStore:e})?_r.Xx:0}function xa(e,t,o,r){const i=r.state;return{col:o.findIndex((e=>e.property===t)),row:i.findIndex((t=>e===t))}}function ba(e,t,o,r,i,n,s){const l=o.state;if(l){let o;o=e===pa.Down?l.start.row>l.end.row?l.start:l.end:e===pa.Up?l.start.row<l.end.row?l.start:l.end:e===pa.Right?l.start.col>l.end.row?l.start:l.end:l.start.col<l.end.row?l.start:l.end;const a=r.state[o.row],c=t[o.col].property,d=bl.Z.findBlockPropertyValue(a,c),u=(null==d?void 0:d.getNode())??null;if(u){const e=i.state??0,t=n.state,o=s||t&&l.start.col<=t&&l.end.col<=t;K.bx({element:u,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:o?void 0:{reveal:"closest",paddingToLeftEdge:e},scrollers:{verticalScroller:null==d?void 0:d.getContextVerticalScroller(),horizontalScroller:null==d?void 0:d.getContextHorizontalScroller()}})}}}function wa(e,t,o){const{transaction:r,selection:i,start:n}=e,s=o.state,l=t[n.col],a=s[n.row].getPropertyValue(l.property)||[],c=Math.min(i.start.row,i.end.row),d=Math.max(i.start.row,i.end.row);s.slice(c,d+1).forEach((e=>{e.pointer!==s[n.row].pointer&&go.sO({store:e.getPropertyStore(l.property),value:a,transaction:r})}))}function ka(e,t,o){const r=t.length,i=o.state.length;return{start:{col:(0,Jl.Z)(e.start.col,0,r-1),row:(0,Jl.Z)(e.start.row,0,i-1)},end:{col:(0,Jl.Z)(e.end.col,0,r-1),row:(0,Jl.Z)(e.end.row,0,i-1)}}}function _a(e,t,o,r,i,n,s){const{selection:l,shouldNormalize:a}=e,c=o.collectionViewBlockStore();c&&(Js.Z5({environment:t,selectionKey:{collectionViewBlockStore:c,groupFormat:r},selection:a?ka(l,i,n):l}),s.recompute())}function Ta(e,t,o,r,i,n,s,l,a,c,d,u){const{device:p}=e,h=t.state;if(h.isOpen){const{store:m,property:S}=h,g=xa(m,S,o,n);p.isMobile?pe.wG():va(t,e)&&_a({selection:{start:g,end:g},shouldNormalize:!0},e,r,i,o,n,s),ba(pa.Down,o,l,n,a,c,d),mo.xv({environment:e,blockPropertyValueOverlayStore:t}),null==u||u(h)}}function Va(e){window.__c={n:"TableShimmer"};const{isFullScreen:t,hasGroups:o,propertyWidths:r,hasPartialResults:i,hasSearchQuery:n,frozoneProps:s}=e,l=(0,oe.O7)(),a=(0,re.Fg)(),d=(0,oe.Fy)().isPhone,u=(0,Ui.DK)(),p=(0,hr.Z)(!0,0,100),h=(0,c.VK)((()=>Boolean(null==u?void 0:u.normalizedFormatStore.state.hide_table_vertical_lines)),[u]),m=(0,c.VK)((()=>!!u&&(0,le.fk)({environment:l,collectionContextStore:u})),[u,l]),S=s.isScrolled,g=s.frozenIndex,C=void 0!==g,f=(0,c.VK)((()=>{if(!u)return!1;const e=u.collectionViewBlockStore();return!!e&&(0,Yn.sY)(e)}),[u]),y=(0,c.VK)((()=>u?(0,_r.oc)({environment:l,collectionContextStore:u,isPhone:d,theme:a}):{}),[u,l,d,a]),x=(0,re.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...y,...-1===g?{background:void 0}:{}},multiselectCheckbox:{display:"flex",flexDirection:"row",pointerEvents:"none",cursor:"pointer",...y},rowContainer:{display:"flex",alignItems:"flex-start",padding:C?void 0:"0px 16px",borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:C?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:h?void 0:`1px solid ${e.tableDividerColor}`}})),[y,g,C,h]);if(!p||!u)return null;const b=r.map(((e,t)=>(0,v.jsx)("div",{style:{...x.column,width:e},children:(0,v.jsx)(Ei.Z,{style:{...x.rowShimmer,width:.6*(e-16)}})},t)));let w=null,k=[];if(C&&void 0!==g){const e=b.slice(0,g+1);w=(0,v.jsxs)("div",{style:x.frozenColumnsContainer,children:[(0,v.jsxs)(zl,{isCollectionViewBlockSelected:f,shouldFreeze:-1!==g,children:[m&&(0,v.jsx)("div",{style:{width:32,height:31}}),e]}),e.length>0?(0,v.jsx)(xs,{passesFilter:!0,isShimmerRow:!0,isScrolled:S}):null]}),k=b.slice(g+1,b.length)}else k=b;let _=1;o||i||n||(_=t?10:3);const T=[...Array(_)].map(((e,t)=>(0,v.jsxs)("div",{style:x.rowContainer,children:[w,k]},t)));return(0,v.jsx)("div",{style:x.container,children:(0,v.jsx)("div",{style:x.rowsContainer,children:T})})}const Oa=i.memo((function(e){window.__c={n:"TableGroupResults"};const{groupFormat:t,store:o,format:r,schema:n,query:s,collectionContextStore:a,showHoverActionsStore:d,isFullScreen:p,isInPeekRenderer:h,disabled:m,blockPropertyValueOverlayStore:S,minWidth:g,paddingBottom:C,paddingLeft:f,tableStore:y}=e,x=(0,oe.O7)(),b=(0,oe.Fy)(),w=(0,i.useContext)(mr.ZO),k=(0,c.VK)((()=>{const e=t?[t]:[];return a.groupsStore.getGroupState(e)}),[t,a]),_=(0,c.VK)((()=>{const e=function(e,t){const o=Ma(e,t);return o&&o.table_properties?o.table_properties:[]}(r,y).filter((e=>e.visible));return b.isMobile?e.slice(0,20):e}),[b.isMobile,r,y],{useDeepEqual:!0}),T=(0,c.VK)((()=>null==k?void 0:k.reducerResultStore.state),[k]),V=(0,c.VK)((()=>void 0!==T),[T]),O=(0,c.VK)((()=>a.permissionScopes.state),[a]),P=(0,Xn.PE)(e.store,e.disabled),M=(0,c.VK)((()=>!!P&&(!O.isSyncedCollection&&O.canEditContent)),[P,O]),F=(0,c.VK)((()=>Boolean(V&&M&&a.shouldAllowNewItemCreation())),[M,a,V]),B=(0,c.VK)((()=>_.reduce(((e,t)=>e+(t.width||0)),0)+(O.canEditContent?Pl:0)),[_,O]),N=(0,c.VK)((()=>_.map((e=>e.width||ao.Nx))),[_]),D=(0,c.VK)((()=>_.findIndex((e=>"title"===e.property))),[_]),A=(0,c.VK)((()=>{const e=t?[t]:[],o=(0,Fo.A7)(e[0],a);return zo.default.state.stores.filter((e=>o.includes(e))).length>0}),[t,a]),E=(0,c.VK)((()=>{const{device:e,ThemeModeStore:t}=x,{isScrolled:o,frozenIndex:r,tryShowHiddenFrozenColumn:i}=a.frozoneStore.state;if(void 0===r)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const n=(0,ve.gh)({theme:t.state}),s={...(0,_r.oc)({environment:x,collectionContextStore:a,isPhone:e.isPhone,theme:n}),display:"flex",...o&&-1===r&&{height:"calc(100% + 1px)",borderBottom:`1px solid ${n.tableDividerColor}`}},l=Boolean(o&&-1===r),c=Boolean(l&&(i||A)),d=a.collectionViewBlockStore(),u=!!d&&(0,Yn.sY)(d);return{isScrolled:Boolean(o),frozenIndex:r,frozenStyles:s,shouldFreezeMultiSelectColumn:l,shouldShowStickyMultiSelectColumn:c,isCollectionViewBlockSelected:u}}),[A,a,x],{useDeepEqual:!0}),Z=(0,c.VK)((()=>le.VM({collectionContextStore:a,reducerResult:T,isFullScreen:p})),[a,p,T]),H=(0,i.useMemo)((()=>t?[t]:[]),[t]),z=(0,i.useMemo)((()=>void 0!==T&&T.blockIds.length>0),[T]),K=(0,c.VK)((()=>""!==a.searchQuery.state),[a]),U=(0,c.VK)((()=>Wt({collectionContextStore:a,groupsPointer:H,hasPartialResults:z})),[a,H,z]),$=(0,c.VK)((()=>a.viewIsFlushToTopbar()),[a]),q=(0,c.VK)((()=>Boolean(a.normalizedFormatStore.state.hide_table_vertical_lines)),[a]),Y=(0,c.VK)((()=>{const e=a.collectionViewStore();return M&&b.isMobile&&!(null!=e&&e.isSyncedCollection())}),[M,a,b.isMobile]),X=(0,c.VK)((()=>Qt({collectionContextStore:a,groupsPointer:H})),[a,H]),J=(0,c.VK)((()=>Ma(r,y)),[r,y]),ee=(0,i.useCallback)((()=>{if(!k)return;const e=a.collectionStore();if(!e||!a.shouldAllowNewItemCreation())return;const t=zo.default.state.stores[0];if(!t)return;const o=a.subitemTreeStore.state,r=(0,kr.DY)(o.children,(e=>e.value.store===t));if(!r)return;const i=r?(0,Fo.Af)(r.map((e=>e.value.store))):"",n=a.subitemExpandedStore.state.get(i);Boolean(null==n?void 0:n.isExpanded)&&Q.createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:x,perform:o=>{const i=L.yk({environment:x,collectionContextStore:a,groupsPointer:k.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});i&&S&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{mo.bA({isNewBlock:!0,environment:x,blockPropertyValueOverlayStore:S,store:i,property:"title",format:yo.C.Table,collectionContextStore:a})}))}))}})}),[S,a,x,k]),te=(0,i.useCallback)((e=>{const o=new qn.sA(x,"handleAddRowClick"),r=t?[t]:[],i=a.groupsStore.getGroupState(r);Ce.M_(x)&&i?(a.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:a,isFullScreen:p}),Q.createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:x,perform:r=>{var n;const s=L.IW({environment:x,collectionContextStore:a,groupsPointer:t?[t]:[],shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:r,from:"table_group_results",tracker:o,useCrdt:(0,so.SL)({event:e,source:"collection_table_view",contextualDefault:null===(n=a.defaultPageTemplateStore.state)||void 0===n?void 0:n.useCrdt()})});if(!s)return;const c=s.newStore;if(b.isMobile){const e=(0,Bo.ZP)({store:c,fullyQualified:!1,pageVisitSource:u.tY.Create});w?w(e):G.c4({environment:x,url:e})}else{l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{s.coercionSucceeded?mo.bA({isNewBlock:!0,environment:x,blockPropertyValueOverlayStore:S,store:c,property:"title",format:yo.C.Table,collectionContextStore:a}):se.CH({environment:x,store:c,peekMode:le.kr(a.collectionViewStore()),resultsStore:i.resultsStore,collectionContextStore:a,pageVisitSource:u.tY.Create})}))}))}));const e=a.currentSubitemFormatStoreForCollection.state;ue.W(x,{from:e?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:c.id,creating_block_id:c.id,...(0,he.Pn)(a)})}}})):o.fail("invalid_state")}),[S,a,b.isMobile,x,t,p,w]),ie=(0,i.useCallback)((e=>{const o=a.groupsStore.getGroupState(t);if(!o)return;const r=o.reducerResultStore.state;(0,me.Wi)(e),W.ZH(x),r&&L.ID({collectionContextStore:a,environment:x,incrementLimitArgs:{isFullScreen:p,currentResultCount:r.blockIds.length,groupsPointer:o.groupsPointer,incrementLimitsInRelatedGroups:!1}}),zr.j({name:"collection_load_more"}),I.uD(x)}),[a,x,t,p]),ne=(0,c.VK)((()=>{var e;return null===(e=a.inheritedBlockColorStore.state)||void 0===e?void 0:e.background}),[a]),ae=(0,re.yK)((e=>({iconStyle:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},loadMoreButton:{display:"flex",alignItems:"center",height:Fa+1,width:"100%",paddingLeft:Na,paddingBottom:2,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${e.tableDividerColor}`,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...X?{background:e.whiteButtonBackground}:{}},loadMoreButtonInner:{display:"flex",alignItems:"center",color:e.lightTextColor,position:"sticky",left:Na},addRowButton:{borderBottom:`1px solid ${e.tableDividerColor}`,display:"flex",alignItems:"center",height:Fa,width:"100%",paddingLeft:8,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:ne||(h?e.cardContentBackground:e.contentBackground),left:0,right:0},addRowButtonInner:{display:"inline-flex",alignItems:"center",position:"sticky",left:8,color:e.lightTextColor},aggregationRow:{...!V&&{opacity:0,pointerEvents:"none",left:0,right:0}},aggregationRowPlaceholder:{height:Ba}})),[ne,h,X,V]);if(!k)return null;const ce=V&&!U&&0===(null==T?void 0:T.blockIds.length),Se=Boolean(t),ge=$&&!Se;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Il,{store:o,format:J,groupFormat:t,schema:n,query:s,collectionContextStore:a,isInPeekRenderer:h,minWidth:g,paddingBottom:C,blockPropertyValueOverlayStore:S,resultStore:k.reducerResultStore,showPropertyFormats:_,showRightActions:O.canConfigureCollection&&O.canConfigureBlock,allowHidingTitle:!1,tableStore:y,formatKey:"table_properties",disabled:m||!O.canConfigureCollection&&!O.canConfigureBlock,disableTopBorder:!ge,disableCellRightBorder:!ge||q,height:Ia,frozoneProps:E}),(0,v.jsx)("div",{style:{height:Ia}}),(0,v.jsx)(ga,{store:o,format:J,schema:n,query:s,collectionContextStore:a,minWidth:g,blockPropertyValueOverlayStore:S,showPropertyFormats:_,disabled:!M,groupFormat:t,tableStore:y,paddingLeft:f,render:e=>(0,v.jsx)(Ra,{args:e,store:o,collectionContextStore:a,collectionViewFormat:J,blockPropertyValueOverlayStore:S,groupFormat:t,propertyFormats:_,schema:n,canDrag:Y,disabled:m,titleColumnIndex:D,onShiftEnter:ee,frozoneProps:E})}),U&&(0,v.jsx)(Va,{isFullScreen:p,hasGroups:void 0!==t,propertyWidths:N,hasPartialResults:z,hasSearchQuery:K,frozoneProps:E}),ce&&(0,v.jsx)(ps,{collectionContextStore:a,shouldShowAddRowButton:F,handleAddRowClick:te,paddingLeft:f}),(0,v.jsx)("div",{style:{width:B}}),Z&&(0,v.jsx)(ko.Z,{onMouseDown:me.$0,onClick:ie,disabled:X,hoveredStyle:ae.loadMoreButtonHovered,style:ae.loadMoreButton,children:(0,v.jsxs)("span",{style:ae.loadMoreButtonInner,children:[(0,wr.M)(ae.iconStyle),(0,v.jsx)(j.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"}),X?(0,v.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,v.jsx)(Ue.Z,{style:{width:12,height:12}})}):M&&(0,v.jsx)(Ur,{collectionContextStore:a,format:r})]})}),F&&(0,v.jsx)(ko.Z,{onClick:te,onMouseDown:me.$0,style:ae.addRowButton,className:ro.tfM,children:(0,v.jsxs)("span",{style:ae.addRowButtonInner,children:[(0,de.R)(ae.iconStyle),(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.tableView.addRowButton"})]})}),(0,v.jsx)(ds,{groupFormat:t,disabled:m||!O.canConfigureBlock,schema:n,query:s,collectionContextStore:a,isInPeekRenderer:h,isFullScreen:p,showPropertyFormats:_,showRightActionsSpacer:O.canConfigureCollection,showHoverActionsStore:d,style:ae.aggregationRow}),(0,v.jsx)("div",{style:ae.aggregationRowPlaceholder})]})}),Jt.Z),Pa=Oa,Ra=i.memo((function(e){window.__c={n:"TableSelectionOverlayInner"};const t=(0,oe.O7)(),{args:o,store:r,collectionContextStore:n,collectionViewFormat:s,blockPropertyValueOverlayStore:a,groupFormat:d,propertyFormats:u,schema:p,canDrag:h,disabled:m,titleColumnIndex:S,onShiftEnter:g,frozoneProps:C}=e,f=(0,i.useMemo)((()=>d?[d]:[]),[d]),y=(0,c.VK)((()=>n.permissionScopes.state),[n.permissionScopes]),x=(0,c.VK)((()=>Boolean(n.normalizedFormatStore.state.hide_table_vertical_lines)),[n.normalizedFormatStore]),b=(0,c.VK)((()=>le.fk({environment:t,collectionContextStore:n})),[n,t]),w=(0,c.VK)((()=>r.isLocked()),[r]),k=(0,re.yK)((e=>({itemSelectableHalo:{borderRadius:0,zIndex:M.IK}})),[]),_=(0,re.Fg)(),T=(0,i.useCallback)((()=>({display:"flex",height:"calc(100% + 2px)",borderBottom:`1px solid ${_.tableDividerColor}`})),[_.tableDividerColor]),V=(0,i.useCallback)((e=>{const{store:o,parentStore:r,subitemPath:i,indentLevel:s}=e;if(r)return(0,v.jsx)(Qn,{store:o,collectionStore:r,subitemPath:i,indentLevel:s,collectionContextStore:n,disabled:m,groupsPointer:f,onSubitemCreate:e=>{a&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{mo.bA({isNewBlock:!0,environment:t,blockPropertyValueOverlayStore:a,store:e,property:"title",format:yo.C.Table,collectionContextStore:n})}))}))}})}),[a,n,m,t,f]),O=(0,i.useMemo)((()=>({schema:p,collectionContextStore:n,propertyFormats:u,onPropertyTab:o.onPropertyTab,onPropertyUntab:o.onPropertyUntab,onPropertyEnter:o.onPropertyEnter,onPropertyClick:o.onPropertyClick,onPropertyEsc:o.onPropertyEsc,onPropertyBgClick:o.onPropertyBgClick,onPropertyContextMenu:o.onPropertyContextMenu,onOpenProperty:o.onOpenProperty,disabled:m,blockPropertyValueOverlayStore:a,showRightActionsSpacer:y.canConfigureCollection,disableCellBorderRight:x,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:!y.canConfigureCollection||w,disableTableWrap:!1,onShiftEnter:g,titleColumnIndex:S,groupFormat:d,frozoneProps:C,shouldShowMultiSelectCheckbox:b})),[o.onOpenProperty,o.onPropertyBgClick,o.onPropertyClick,o.onPropertyContextMenu,o.onPropertyEnter,o.onPropertyEsc,o.onPropertyTab,o.onPropertyUntab,a,n,m,x,g,y.canConfigureCollection,u,p,S,d,C,b,w]);return(0,v.jsx)(Ar,{collectionContextStore:n,groupsPointer:f,format:s,canDrag:h,resultProps:O,canDrop:!0,resultComponent:Xl,disabled:m,direction:Dr.Vertical,getItemSelectableStyle:T,itemSelectableHaloStyle:k.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:o.onSelectableEnter,blockPropertyValueOverlayStore:a,titleColumnIndex:S,nestedCreateSubitemButton:V})}),Jt.Z);function Ma(e,t){const{temporaryFormat:o}=t.state;return o||e}const ja={position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums"},Ia=34,Fa=32,Ba=32,Na=8,Da=42;class La extends Mo.Z{constructor(){super(...arguments),this.storeTypes={tableStore:$n},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=(e,t,o)=>Ha(e,t,o,this.environment,this.props.collectionContextStore),this.viewSettingsSidebarOpen=this.createComputedStore((()=>{var e;return this.props.collectionContextStore.settingsStore.state.open&&"sidebar"===(null===(e=this.props.viewSettingsPlacementStore)||void 0===e?void 0:e.state)}))}renderPersisted(){const{store:e,paddingBottom:t,paddingLeft:o,paddingRight:r,isFullScreen:i,collectionContextStore:n,format:s}=this.props,l=le.az(n,i),a=s.collection_group_by,c=n.isCompactView.state;return(0,gr.Z)((s=>{const d=(0,v.jsx)(It.Z,{store:e,shouldShowHalo:!i&&!c,canSelect:!i,analyticsName:"table",style:{position:"relative"},...s,children:a?(0,v.jsx)(Ga,{collectionContextStore:this.props.collectionContextStore,store:this.props.store,format:this.props.format,schema:this.props.schema,disabled:this.props.disabled,isFullScreen:this.props.isFullScreen,paddingLeft:this.props.paddingLeft,isRootChild:this.props.isRootChild,isInPeekRenderer:this.props.isInPeekRenderer,query:this.props.query,showHoverActionsStore:this.props.showHoverActionsStore,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,minWidth:this.props.minWidth,paddingBottom:this.props.paddingBottom,tableStore:this.stores.tableStore,groupBy:a}):(0,v.jsx)(za,{store:this.props.store,format:this.props.format,schema:this.props.schema,query:this.props.query,collectionContextStore:this.props.collectionContextStore,showHoverActionsStore:this.props.showHoverActionsStore,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,disabled:this.props.disabled,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,minWidth:this.props.minWidth,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,tableStore:this.stores.tableStore,groupFormat:void 0})});return(0,v.jsxs)("div",{style:{...ja,paddingBottom:t,paddingLeft:o,paddingRight:r+(this.viewSettingsSidebarOpen.state?te.nJ+20:0)},className:ro._so,children:[a?d:(0,v.jsx)(ii,{renderEmitter:n.renderEmitter,isFullScreen:i,children:d}),!l&&(0,v.jsx)(an.Z,{onChange:e=>function(e,t,o,r){const i=t.isLoading.state,n=t.groupsStore.getGroupState([]),s=null==n?void 0:n.reducerResultStore.state;e<no.Z.incrementScrollOffset&&s&&!i&&s.hasMore&&(t.infiniteScrollLongTaskObserver.observe(),L.ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}(e,this.props.collectionContextStore,this.props.isFullScreen,this.environment)})]})}))}}La.displayName="Table";const Aa=(0,j.injectIntl)(La);function Ea(e,t,o){const r=t.viewIsFlushToTopbar();if(0===e.index&&!r)return{};return t.shouldShowSpinner.state&&e.index>0?{}:{borderTop:`1px solid ${o.tableDividerColor}`}}function Za(e){let{args:t,isInPeekRenderer:o}=e;window.__c={n:"GroupHeaderComponent"};const{collectionContextStore:r}=t,i=(0,re.Fg)(),n=(0,c.VK)((()=>r.isCompactView.state),[r]);return(0,v.jsx)(Nt,{...t,height:n?io.yZ:Da,paddingTop:8,toggleClosedMarginBottom:8,getComputedStickyStyle:e=>function(e,t,o){return{boxShadow:e?`0 -1px 0 ${t?o.cardContentBackground:o.contentBackground}`:void 0}}(e,o,i)})}function Ha(e,t,o,r,i){!function(e,t,o,r){if(r.device.isMobile)ne._({environment:r,store:e,pageVisitSource:u.tY.Create});else{const{groupFormat:i}=t,n=i?[i]:[],s=o.groupsStore.getGroupState(n);se.CH({environment:r,store:e,peekMode:le.kr(o.collectionViewStore()),resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:o,pageVisitSource:u.tY.Create})}}(e,o,i,r)}function za(e){let{groupFormat:t,store:o,format:r,schema:i,query:n,collectionContextStore:s,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:d,disabled:u,blockPropertyValueOverlayStore:p,minWidth:h,paddingBottom:m,paddingLeft:S,tableStore:g}=e;window.__c={n:"GroupResultsComponent"};const C=(0,c.qz)(g,$n);return(0,c.VK)((()=>s.groupsStore.getGroupState(t?[t]:[])),[s,t])?(0,v.jsx)(Pa,{tableStore:C,groupFormat:t,store:o,format:r,schema:i,query:n,collectionContextStore:s,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:d,disabled:u,blockPropertyValueOverlayStore:p,minWidth:h,paddingBottom:m,paddingLeft:S}):null}function Ga(e){let{groupBy:t,collectionContextStore:o,store:r,format:n,schema:s,disabled:l,isFullScreen:a,paddingLeft:d,isRootChild:u,isInPeekRenderer:p,query:h,showHoverActionsStore:m,blockPropertyValueOverlayStore:S,minWidth:g,paddingBottom:C,tableStore:f}=e;window.__c={n:"GroupsComponent"};const y=(0,re.Fg)(),x=(0,oe.O7)(),b=(0,i.useCallback)(((e,t,r)=>Ha(e,0,r,x,o)),[x,o]);return(0,c.VK)((()=>(0,ke.hJ)()),[])?(0,v.jsx)(on,{reducerId:"table_groups",store:r,collectionContextStore:o,disabled:l,isFullScreen:a,isRootChild:u,paddingLeft:d,stickyLeft:!0,renderGroup:e=>(0,v.jsx)(za,{store:r,format:n,schema:s,query:h,collectionContextStore:o,showHoverActionsStore:m,isFullScreen:a,isInPeekRenderer:p,disabled:l,blockPropertyValueOverlayStore:S,minWidth:g,paddingBottom:C,paddingLeft:d,tableStore:f,groupFormat:e}),getGroupStyle:e=>Ea(e,o,y),renderHeader:e=>(0,v.jsx)(Za,{args:e,isInPeekRenderer:p}),onGroupHeaderAddItem:b}):(0,v.jsx)(Gn,{store:r,id:"table_groups",groupBy:t,groupsFormatKey:ie.Uh,groupAggregationKey:ie.dQ,format:n,schema:s,collectionContextStore:o,disabled:l,isFullScreen:a,renderGroup:e=>(0,v.jsx)(za,{store:r,format:n,schema:s,query:h,collectionContextStore:o,showHoverActionsStore:m,isFullScreen:a,isInPeekRenderer:p,disabled:l,blockPropertyValueOverlayStore:S,minWidth:g,paddingBottom:C,paddingLeft:d,tableStore:f,groupFormat:e}),renderHeader:e=>(0,v.jsx)(Za,{args:e,isInPeekRenderer:p}),onGroupHeaderAddItem:b,paddingLeft:d,getGroupStyle:e=>Ea(e,o,y),isRootChild:u,isInPeekRenderer:p,stickyLeft:!0})}var Ka=o(9999),Ua=o(39567),Wa=o(76798),$a=o(44862);const qa=function(e){const{store:t,titleStyle:o,actionButton:r,collectionContextStore:i}=e;return(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{style:{display:"flex"},children:[(0,v.jsx)(Wa.Z,{store:t,style:o}),r]}),(0,v.jsx)($a.Z,{collectionStore:t,collectionContextStore:i})]})};var Qa=o(19987),Ya=o(50627),Xa=o(89086);const Ja=(0,j.defineMessages)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"}});const ec=function(e){let{store:t,collectionContextStore:o,isFullScreen:r,canEdit:i,showHoverActionsStore:n}=e;window.__c={n:"CollectionViewBlockSource"};const s=(0,oe.O7)(),l=(0,c.SI)((()=>{const e=Ho.default.state;return(0,le.Ks)(t)||!(0,le.en)(t)&&e.open&&e.isClosing}),[t]),a=(0,c.SI)((()=>{const e=o.collectionStore();if(!e)return!1;const t=e.getNameStore();return Boolean((0,Xa.J5)(t))}),[o]),d=(0,c.VK)((()=>o.collectionStore()),[o]),u=(0,c.VK)((()=>o.permissionScopes.state),[o]),p=(0,c.VK)((()=>o.collectionViewBlockStore()),[o]),h=(0,c.VK)((()=>{var e;return Boolean((null==d||null===(e=d.getParentBlockStore())||void 0===e?void 0:e.id)===(null==p?void 0:p.id))}),[d,p]),m=(0,c.VK)((()=>Boolean(null==d?void 0:d.isSyncedCollection())),[d]),S=(0,c.VK)((()=>a.state),[a]),g=(0,c.VK)((()=>l.state),[l]),{WindowSizeStore:C}=s,f=(0,c.VK)((()=>Math.min(Ya.zL,C.state.width)),[C]);if(!d||!p)return null;const y=(h||S)&&u.canConfigureCollection&&!m;return(0,v.jsxs)("div",{style:{...(r||g)&&(0,Se.eA)(s)&&{position:"sticky",left:0},paddingTop:8,boxSizing:g?"content-box":void 0,width:g?f:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[y?(0,v.jsx)(dc,{collectionContextStore:o,showHoverActionsStore:n}):(0,v.jsx)(cc,{collectionContextStore:o,showHoverActionsStore:n}),m&&(0,v.jsx)("div",{style:{display:"flex"},children:(0,v.jsx)(Qa.Z,{canEdit:i,store:p,buttonStyle:{margin:0}})})]})};function tc(){return{fontWeight:R.Z.fontWeight.bold,fontSize:22}}function oc(e){const t=e.collectionStore();if(!t)return;const o=t.getParentBlockStore();return o?(0,Bo.ZP)({store:o,fullyQualified:!1,pageVisitSource:u.tY.Breadcrumb}):void 0}function rc(e){const t=e.collectionStore();if(!t)return 22;return t.isSyncedCollection()?58:22}function ic(e,t){return{width:24,height:t?24:16,fill:e.regularIconColor}}function nc(e){let{parent:t,collectionContextStore:o}=e;window.__c={n:"ActionsPopupComponent"};const r=(0,re.Fg)(),i=(0,oe.O7)(),n=(0,c.VK)((()=>o.permissionScopes.state),[o]),s=(0,c.VK)((()=>o.collectionStore()),[o]),l=(0,c.VK)((()=>null==s?void 0:s.isSyncedCollection()),[s]);if(!s)return null;const a=_.oA([{key:"view",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,Ka.J)(ic(r))}),action:e=>{const r=oc(o);if(!r)return null;const n=Sr.DJ(e.event);G.c4({environment:i,url:r,openInNew:n}),n||t.close(),F.wd({environment:i,collectionContextStore:o,action:"click_source_view"})}},n.canConfigureCollection&&!l&&{key:"edit_name",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,co.R)(ic(r))}),action:()=>{q.mT({environment:i,store:s.getNameStore(),canSelectAllBlocks:!1}),t.close(),F.wd({environment:i,collectionContextStore:o,action:"click_source_edit_title"})}}]),d={key:"show_title",render:e=>(0,v.jsx)(Qe.Z,{...e,icon:(0,Hs.L)(ic(r,!0)),title:(0,v.jsx)(j.FormattedMessage,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{const e=o.collectionViewStore();if(!e)return null;Q.createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:i,perform:t=>{So.FH({stores:[e],update:{hide_linked_collection_name:!0},transaction:t})}}),t.close(),F.wd({environment:i,collectionContextStore:o,action:"click_source_hide_title"})}};return(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,sections:_.oA([{key:"actions",render:e=>(0,v.jsx)(Re.Z,{...e}),items:a},n.canConfigureBlock&&{key:"show_title",render:e=>(0,v.jsx)(Re.Z,{...e,topBorder:!0}),items:[d]}]),initialFocus:void 0})}function sc(e){let{showHoverActionsStore:t,collectionContextStore:o}=e;window.__c={n:"ActionButtonComponent"};const r=(0,oe.O7)(),i=(0,c.VK)((()=>t.state),[t]);return(0,v.jsx)(ts.Z,{isVisible:!0,animationStyle:{opacity:i?1:0},render:()=>(0,v.jsx)("div",{style:{display:"flex",alignItems:"center",marginLeft:4},children:(0,v.jsx)(Ye.ZP,{popupType:r.device.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,render:e=>(0,v.jsx)(nc,{parent:e,collectionContextStore:o}),renderOrigin:e=>(0,v.jsx)(jt.Z,{icon:ce.o,...e}),style:{width:240},originGap:4})})})}function lc(e){W.ZH(e)}function ac(e){let{disabled:t,collectionContextStore:o}=e;window.__c={n:"IconComponent"};const r=(0,re.Fg)(),i=(0,oe.O7)(),n=(0,c.VK)((()=>o.collectionStore()),[o]),s=(0,c.VK)((()=>o.collectionViewBlockStore()),[o]),l=(0,c.VK)((()=>null==n?void 0:n.getIcon()),[n]),a=(0,c.VK)((()=>{var e;return Boolean((null==n||null===(e=n.getParentBlockStore())||void 0===e?void 0:e.id)===(null==s?void 0:s.id))}),[n,s]),d=(0,c.VK)((()=>rc(o)),[o]),u=(0,c.VK)((()=>function(e){return{width:rc(e),height:rc(e),marginRight:4}}(o)),[o]),p=(0,c.VK)((()=>null==s?void 0:s.getType()),[s]);return n&&s?l?(0,v.jsxs)("div",{style:{position:"relative",width:d+2,height:d+2,marginRight:4},children:[t?(0,v.jsx)(Vo.Z,{disabled:!0,bucket:"secure",store:n,icon:l,isEmptyPage:!1,style:u,size:d}):(0,v.jsx)(Vo.Z,{disabled:!1,bucket:"secure",store:n,icon:l,isEmptyPage:!1,style:u,size:d,iconLoggingData:{recordTable:n.table,source:"inline_collection",block_type:p,collection_id:n.id},onChange:e=>function(e,t,o){const r=o.collectionStore();if(!r)return;const i=r&&r.getIconStore();i&&Q.createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:t,perform:t=>{go.sO({store:i,value:e,transaction:t})}})}(e,i,o)}),!a&&(0,Ua.Y)({position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===r.mode?r.regularTextColor:"#3E3C38",stroke:"dark"===r.mode?r.sidebarBackground:"white",strokeWidth:"dark"===r.mode?"1.85px":"1.5px"})]}):a?null:(0,v.jsx)("div",{style:{width:20,marginRight:4},children:(0,Ka.J)({width:20})}):null}function cc(e){let{collectionContextStore:t,showHoverActionsStore:o}=e;window.__c={n:"LinkButtonComponent"};const r=(0,oe.O7)(),i=(0,c.VK)((()=>t.collectionStore()),[t]),n=(0,c.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,c.VK)((()=>oc(t)),[t]);return i&&n?(0,v.jsxs)(To.Z,{style:{width:"max-content",maxWidth:"100%",marginRight:4,...R.Z.textOverflowStyle},innerStyle:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:4},href:s,onClick:()=>function(e,t){F.wd({environment:e,collectionContextStore:t,action:"click_collection_name_link_button"})}(r,t),children:[(0,v.jsx)(ac,{collectionContextStore:t,disabled:!0}),(0,v.jsx)(qa,{actionButton:(0,v.jsx)(sc,{showHoverActionsStore:o,collectionContextStore:t}),store:i,collectionContextStore:t,titleStyle:tc()})]}):null}function dc(e){let{collectionContextStore:t,showHoverActionsStore:o}=e;window.__c={n:"NameInputComponent"};const r=(0,oe.O7)(),i=(0,c.VK)((()=>t.collectionStore()),[t]),n=(0,c.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,c.VK)((()=>null==i?void 0:i.getNameStore()),[i]);return i&&n&&s?(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4},children:[(0,v.jsx)(ac,{collectionContextStore:t,disabled:!1}),(0,v.jsx)(Po.Z,{store:s,style:{...tc(),marginRight:4},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:ze.default.formatMessage(Ja.titlePlaceholder),onEnter:()=>lc(r),onEsc:()=>lc(r),onClick:()=>function(e,t){F.wd({environment:e,collectionContextStore:t,action:"click_collection_name_input"})}(r,t),disableShiftEnter:!0,pasteBehavior:"inline"}),(0,v.jsx)(sc,{showHoverActionsStore:o,collectionContextStore:t})]}):null}var uc=o(57820),pc=(o(52262),o(24506),o(38297)),hc=o(45953),mc=o(56518);const Sc=new(o(53809).D)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function gc(e,t){let{lastActionWasCut:o,valuePromise:r}=t;const i=(0,mc.tt)(e);Sc.setState({eventId:i,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const n=await r;if(!n)return void Sc.setState({});const{recordMaps:s,...l}=n;Sc.setState({eventId:i,waitingForCopy:!1,lastActionWasCut:o,value:{...l,recordMapsJson:vc(s)}})}function Cc(e){const t=Sc.getState(),o=(0,mc.tt)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:r,value:i,lastActionWasCut:n}=t;return r?new Promise((e=>{Sc.addListener(function(e,t){return function o(r){const i=r.getState();if(!i)return void r.removeListener(o);const{waitingForCopy:n,value:s,lastActionWasCut:l}=i;n||i.eventId!==e||(r.removeListener(o),t(s?{lastActionWasCut:l||!1,value:{...s,recordMaps:fc(s.recordMapsJson)}}:void 0))}}(o,e))})):i?Promise.resolve({lastActionWasCut:n||!1,value:{...i,recordMaps:fc(i.recordMapsJson)}}):Promise.resolve(void 0)}function fc(e){return new Map(e.map((e=>{let[t,o]=e;return[t,hc.Ak.create(o)]})))}function vc(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson({allowVersionDowngrade:!1})]}))}var yc=o(893),xc=o(30188),bc=o(54532),wc=o(79978),kc=o(42858),_c=o(58202);function Tc(){window.__c={n:"CollectionViewKeyboardArea"};const e=(0,oe.O7)(),t=(0,Ui.Y$)(),{value:o}=(0,ca.useDependency)(ca.deps.markdownLinkifyIt),{value:r}=(0,ca.useDependency)(ca.deps.tinyMceMicrosoftWordPasteFilter),n=(0,c.VK)((()=>{var e;const o=zo.default.state.stores.filter((e=>_c.R.findBlockFromStore(e))).at(0),r=null==o?void 0:o.getModel();if(!o||!r)return!1;const i=(0,pc.ky)({block:r,getRecordModel:o.getRecordModel});return!!i&&i.id===(null===(e=t.collectionStore())||void 0===e?void 0:e.id)}),[t]),s=i.useCallback((t=>{yc.JG({event:t,environment:e,markdownLinkifyIt:o});const r=zo.default.state.stores;gc(t,{lastActionWasCut:!1,valuePromise:Vc(e).then((t=>{for(const r of t)I.dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:r.id,block_type:r.getType(),isBulk:!0});const o=t.length>0;for(const i of r)I.dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:o});return Oc({environment:e,subitems:t})}))})}),[e,o]),a=i.useCallback((async t=>{yc.JG({event:t,environment:e,markdownLinkifyIt:o});const r=zo.default.state.stores,i=Vc(e),n=Vc(e).then((t=>{for(const r of t)I.dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:r.id,block_type:r.getType(),isBulk:!0});const o=t.length>0;for(const i of r)I.dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:o});return Oc({environment:e,subitems:t})}));await gc(t,{lastActionWasCut:!0,valuePromise:n});const s=zo.default.getState().stores,l=await i;await xc.VP({blocks:s,subitems:l,environment:e,canUndo:!0,skipConfirmation:!0})}),[e,o]),d=i.useCallback((async i=>{var n,s,a,c;const d=await Cc(i);if(Sc.setState({...Sc.getState(),lastActionWasCut:!1}),!d){const t=zo.default.state.stores[0];return Q.createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,perform:t=>{yc.v({environment:e,event:i,disableEmbedMenu:!0,transaction:t,onPasteFiles:yc.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:r})}}),void I.dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:!1})}const u=t.collectionViewBlockStore();if(!u)return;const p=t.collectionStore();if(!p)return;const{recordMaps:h,subitemFormat:m,childRelationSchema:S,parentRelationSchema:g}=d.value;if(!(h&&m&&S&&g))return;const C=[...h.entries()].map((e=>{let[t]=e;return ge.G.createChildStore(p,{table:V.iU,id:t})}));await Promise.all(C.map((e=>e.load())));const f=zo.default.getState().stores,v=!(d.lastActionWasCut&&function(e,t){const o=t.map((t=>ge.G.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(p,C));let y=[],x=Fo.JR(t),b=null===(n=x)||void 0===n?void 0:n.parentRelationProperty,w=null===(s=x)||void 0===s?void 0:s.childRelationSchema,k=null===(a=x)||void 0===a?void 0:a.parentRelationSchema,_=null===(c=x)||void 0===c?void 0:c.subitemFormat;const T=t.permissionScopes.state.canConfigureCollection;for(const t of C)I.dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:d.value.isBulk});if(Q.createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,perform:n=>{if(!_&&T){xc.Bb({transaction:n,collectionContextStore:t,environment:e})&&(x=Fo.JR(t),x&&(b=x.parentRelationProperty,w=x.childRelationSchema,k=x.parentRelationSchema,_=x.subitemFormat))}if(!(b&&w&&k&&_))return void yc.v({environment:e,event:i,disableEmbedMenu:!0,transaction:n,onPasteFiles:yc.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:r});const s=v?xc.R2({blocks:C,environment:e,transaction:n,recordMaps:h,migrateSubitemFormat:{from:m,to:_},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:S,parentRelationSchema:g},analyticsFrom:d.lastActionWasCut?"cut":"copy"}):xc.cI({blocks:C,transaction:n,from:m,to:_,environment:e,subitemRelationSchema:w,relationPropertyCollectionId:p.id,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:r,subitemFormat:i,collectionContextStore:n,transaction:s}=e,l=n.collectionStore();if(!l)return;const a=o.at(-1),c=Fo.qb(r,i);if(0===c.length)return;if(a){const e=Fo.nK(n,a),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof ge.G&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),a);c.forEach((e=>{xc.Cz({environment:t,block:e,collectionStore:l,subitemFormat:i,transaction:s}),o&&wc.hE({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:i.inverse,inverse:i.property},transaction:s,position:{type:"after"}})}))}else c.forEach((e=>{xc.Cz({environment:t,block:e,collectionStore:l,subitemFormat:i,transaction:s})}))}({environment:e,selectedBlocks:f,blocksToInsert:s,subitemFormat:_,collectionContextStore:t,transaction:n}),kc.is({environment:e,blocks:s,selection:f,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:!0}),y=s}}),!(b&&w&&k&&_))return;const O=Fo.T2({blocks:y,parentRelationProperty:b,parentRelationSchema:k,collectionViewBlockStore:u});l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{W.Z5({environment:e,stores:O})}))}))}),[t,e,o,r]);return(0,v.jsx)(_o.Z,{debugName:"CollectionViewKeyboardArea",capture:n,onCopy:s,onCut:a,onPaste:d})}function Vc(e){const t=zo.default.getState().stores;return xc.xr({environment:e,blocks:t})}function Oc(e){let{subitems:t,environment:o}=e;const r=zo.default.getState().stores,i=r.at(0);if(!i)return;const n=(0,Fo.g0)(i);if(!n)return;const s=[...r,...t],l=_.oA(s.map((e=>{const t=bc.K8(o,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0});return t&&[e.id,t]}))),a=new Map(l),{subitemFormat:c,childRelationSchema:d,parentRelationSchema:u}=n;return{recordMaps:a,subitemFormat:c,childRelationSchema:d,parentRelationSchema:u,isBulk:t.length>0}}var Pc=o(80503);var Rc=o(36488),Mc=o(68641),jc=o(60709);class Ic extends s.Z{constructor(){super(...arguments),this.storeTypes={placementStore:d.default.createClass(void 0),headerRectStore:d.default.createClass(void 0),shouldScrollIntoViewStore:d.default.createClass(!1)},this.lastPlacement=void 0,this.justOpened=!1,this.renderMenu=e=>{const{collectionContextStore:t}=this.props;if(!this.stores.shouldScrollIntoViewStore.state)return(0,v.jsx)(J.P,{context:Mc.HV.ViewSettings,collectionContextStore:t,collectionSettingsStore:t.settingsStore,fullHeight:e,hideDesktopHeader:t.isCompactView.state})},this.sidebarLayoutStore=this.createComputedStore((()=>{const e=this.props.headerSizeObserver.rect.state,t=this.environment.WindowSizeStore.state.height,o=e.height-40;return{maxHeight:t-(e.top+40),moveUp:o}}))}UNSAFE_willMountOrUpdate(e){const{collectionContextStore:t,overridePlacement:o}=e,r=Bc(this.props.collectionContextStore),i=this.stores.placementStore.state;r&&!i&&this.props.headerSizeObserver.recompute();const n=this.props.headerSizeObserver.rect.state;if(r&&!i&&n){const e=function(e,t,o,r){if(!Bc(t))return;if(r)return r;const i=(null==e?void 0:e.width)||0;return o.device.isMobile||Ho.default.isSidePeekOpen()||!(t.isFullScreen.state||i>600)||t.isCompactView.state?"popup":"sidebar"}(n,this.props.collectionContextStore,this.environment,o);this.stores.placementStore.setState(e),this.justOpened=!0,this.lastPlacement=e}else this.justOpened=!1;r||this.stores.placementStore.setState(void 0),this.justOpened&&(!t.isFullScreen.state&&"popup"!==this.stores.placementStore.state||Ho.default.isSidePeekOpen())&&this.stores.shouldScrollIntoViewStore.setState(!0)}didMountOrUpdate(){const{collectionContextStore:e}=this.props,{shouldScrollIntoViewStore:t}=this.stores;if(t.state){const o=e.collectionViewBlockStore();if(o){const t=_c.R.findCollectionViewBlockFromStore(o);if(t){const o=t.getNode();if(o){const t=o.getBoundingClientRect(),r=this.environment.WindowSizeStore.state.height-t.bottom,i=t.top;(r<te.j9||i<Pc.Aj||e.isInPeekRenderer.state)&&((0,Se.Wr)(o,{edgeDist:0,animate:!1}),this.props.headerSizeObserver.recompute())}}}t.setState(!1)}}renderComponent(){const{paddingRight:e,collectionContextStore:t}=this.props,o=Bc(this.props.collectionContextStore),r=this.lastPlacement,i=t.isFullScreen.state,n=t.viewIsFlushToTopbar(),s=function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(this.props.collectionContextStore),l=("timeline"===s||"table"===s)&&n;if(r){if("sidebar"===r){const t=this.sidebarLayoutStore.state;if(!t)return;const{maxHeight:r,moveUp:n}=t;return(0,v.jsx)(ts.Z,{isVisible:o,enterAnimationStyle:{opacity:0,translateX:12},animationStyle:{opacity:1,translateX:0},exitAnimationStyle:{opacity:0,translateX:12},render:()=>(0,v.jsx)(Rc.Z,{capture:o,allowMobileAutoScroll:!0,allowUndo:!0,render:t=>(0,v.jsx)("div",{style:{position:"absolute",top:(l?1:0)-n,right:-e,height:`calc(100% + ${n}px)`,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,borderLeft:`1px solid ${this.theme.tableDividerColor}`,paddingRight:e,zIndex:M.Nm,...i&&{height:r},...!i&&{maxHeight:r}},className:ro.Dkf,...(0,Ge.Z)({onMouseDown:e=>{return t=e,o=this.environment,void(0,me.ZP)({event:t,context:me.Af.EditorMouseDown,callback:()=>{q.ZH(o)}});var t,o}},t),children:(0,v.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,v.jsx)("div",{style:{boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`},children:this.renderMenu(!0)}),(0,v.jsx)("div",{style:{width:e}})]})})})})}return(0,v.jsx)(Je.ZP,{popupType:this.environment.device.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,open:o,placementToOrigin:jc.Iw.Bottom,alignmentToOrigin:jc.lU.End,style:{marginTop:-1},origin:(0,v.jsx)("div",{}),render:this.renderMenu,onDismiss:e=>function(e,t){(0,me.ZP)({event:e,context:me.Af.CollectionSettingsClick,callback:()=>{A.E3({collectionSettingsStore:t.settingsStore})}})}(e,this.props.collectionContextStore),originRect:this.props.headerSizeObserver.rect.state,keepFocus:!0,trapFocus:!0})}}}Ic.displayName="CollectionViewSettingsPopup";const Fc=(0,j.injectIntl)(Ic);function Bc(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}var Nc=o(78454);function Dc(e){window.__c={n:"WikiHomeOnboardingTooltip"};const{origin:t}=e,o=(0,oe.O7)();return(0,v.jsx)(ks.U,{origin:t,placementToOrigin:"bottom",header:(0,v.jsx)(j.FormattedMessage,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{Ss.Rg(o)},shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:Vs.EZ,pointerOffset:Vs.rK,style:{width:Vs.G5}})}function Lc(e){window.__c={n:"WikiViewsOnboardingTooltip"};const{origin:t}=e,o=(0,oe.O7)();return(0,v.jsx)(ks.U,{origin:t,placementToOrigin:"right",header:(0,v.jsx)(j.FormattedMessage,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,v.jsx)("span",{style:{fontWeight:R.Z.fontWeight.semibold},children:e})}}),onCloseClick:()=>{Ss.Rg(o)},pointerPosition:"50%",pointerLength:Vs.EZ,pointerOffset:Vs.FD,shouldDismissUponOutsideClick:!0,style:{width:Vs.G5}})}let Ac;class Ec{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;Ac||(Ac=document.createElement("div"),Ac.style.position="absolute",Ac.style.left="0",Ac.style.top="0",Ac.style.pointerEvents="none",Ac.style.opacity="0",document.body.appendChild(Ac)),_.M6(this.style,((e,t)=>{Ac&&(Ac.style[t]=e)})),Ac.textContent=e;const o=Ac.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}var Zc=o(77794),Hc=o(20616),zc=o(13401),Gc=o(73657),Kc=o(68894),Uc=o(29798),Wc=o(17215),$c=o(14976),qc=o(55964),Qc=o(27714),Yc=o(53470),Xc=o(94841);function Jc(e){let{collectionViewStore:t,collectionContextStore:o,onClose:r}=e;window.__c={n:"CollectionViewActionMenu"};const i=(0,oe.O7)(),n=(0,j.useIntl)(),s=(0,re.yK)((e=>({svgIcon:{width:24,height:16,fill:e.regularIconColor},svgIconPadded:{width:24,height:24,fill:e.regularIconColor}})),[]),l=(0,c.VK)((()=>{var e;const t=null===(e=o.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!t&&(0,Xc.Kj)(t)}),[o]),a=(0,c.VK)((()=>function(e){let{collectionViewStore:t,collectionContextStore:o,onClose:r,environment:i,intl:n,styles:s,isPersonalHomeStore:l}=e;const a=o.permissionScopes.state,c=o.collectionViewStore(),d=o.collectionViewBlockStore();if(!c||!d)return[];const u=c.id===t.id,p=t.getAppConfigUri(),h=p&&(0,X.xB)(p),m=!l&&!h,S=[];if(S.push([]),a.canConfigureBlock){if(S[0].push({key:"rename",render:e=>(0,v.jsx)(et.ZP,{placement:et.ug.Left,disableTooltip:m,render:t=>(0,v.jsx)(Qe.Z,{...e,disabled:!m,disabledFeedback:!0,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,Yc.H)(s.svgIcon),...t}),renderTooltip:()=>(0,v.jsx)(j.FormattedMessage,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view canât be renamed."})}),action:()=>{F.wd({environment:i,collectionContextStore:o,action:"view_action_menu_rename"}),null==r||r(!0),u||pe.f8({environment:i,collectionContextStore:o,collectionViewId:t.id,isFullScreen:o.isFullScreen.state,isRootChild:o.isRootChild.state,isInPeekRenderer:o.isInPeekRenderer.state}),A.r$({collectionContextStore:o,collectionSettingsStore:o.settingsStore,selectViewNameInitial:!0})}}),"page"===t.getType())return S;S[0].push({key:"edit",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,Us.W)(s.svgIcon)}),action:()=>{F.wd({environment:i,collectionContextStore:o,action:"view_action_menu_edit"}),null==r||r(!0),u||pe.f8({environment:i,collectionContextStore:o,collectionViewId:t.id,isFullScreen:o.isFullScreen.state,isRootChild:o.isRootChild.state,isInPeekRenderer:o.isInPeekRenderer.state}),A.r$({collectionContextStore:o,collectionSettingsStore:o.settingsStore})}})}S.push([]),S[1].push({key:"copyLink",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,Qc.N)(s.svgIcon)}),action:async()=>{F.wd({environment:i,collectionContextStore:o,action:"view_action_menu_copy_link"}),await A.Ol({environment:i,collectionContextStore:o,collectionViewStore:t}),null==r||r(!1)}});const g=t.getFormat().hide_linked_collection_name;g&&a.canConfigureBlock&&S[1].push({key:"showDatabaseTitle",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}),icon:(0,qc.N)(s.svgIconPadded)}),action:()=>{F.wd({environment:i,collectionContextStore:o,action:"click_source_show_title"}),Q.createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:i,perform:e=>{So.FH({stores:[t],update:{hide_linked_collection_name:!1},transaction:e})}}),null==r||r(!1)}});S.push([]),a.canConfigureBlock&&!l&&S[2].push({key:"duplicate",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,Zs.a)(s.svgIcon)}),action:()=>{F.wd({environment:i,collectionContextStore:o,action:"view_action_menu_duplicate"}),A.zt({environment:i,collectionContextStore:o,collectionViewStore:t,collectionSettingsStore:o.settingsStore,intl:n}),null==r||r(!0)}});a.canConfigureBlock&&!l&&S[2].push({key:"delete",render:e=>(0,v.jsx)(Qe.Z,{...e,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,be.y)(s.svgIcon)}),action:async()=>{F.wd({environment:i,collectionContextStore:o,action:"view_action_menu_delete"});await A.TT({environment:i,collectionContextStore:o,collectionViewStore:t,collectionSettingsStore:o.settingsStore,from:"view_action_menu"})&&(null==r||r(!1))}});return S}({collectionViewStore:t,collectionContextStore:o,onClose:r,environment:i,intl:n,styles:s,isPersonalHomeStore:l})),[o,t,i,n,l,r,s]);return(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:void 0,sections:_.oA(a.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,v.jsx)(Re.Z,{...e,topBorder:0!==t}),items:e}})))})}const ed=i.memo(Jc,Jt.Z);var td=o(68155);function od(e){window.__c={n:"CollectionViewSelectItem"};const{collectionContextStore:t,collectionViewStore:o,menuListItemProps:r,onClose:i}=e,{device:n}=(0,oe.O7)(),s=(0,re.yK)((e=>({tooltipMessage:{color:e.mediumInvertedTextColor}})),[]),l=(0,j.useIntl)(),a=(0,c.qz)(void 0,eo.Z),[d,u,p,h,m,S]=(0,c.VK)((()=>[o.getName(),o.getType(),o.getFormat().collection_view_icon,o.getFormat().description,t.collectionStore(),t.permissionScopes.state.canConfigureBlock]),[o,t]);if(void 0===u)return null;const g=e=>{a.setState({open:!1}),e&&i()},C=()=>{const t=n.isMobile?{menuType:_e.og.ActionSheet}:{menuType:_e.og.Popup,width:220};return(0,v.jsx)(Ve.Z,{...t,children:(0,v.jsx)(ed,{...e,onClose:g})})},f=()=>{if(S)return(0,v.jsx)(Ye.ZP,{popupType:n.isMobile?Ye.Z4.SlideUp:Ye.Z4.Popup,renderOrigin:e=>(0,v.jsx)(jt.Z,{icon:ce.o,ariaLabel:l.formatMessage({id:"collectionViewSelectItem.viewSettings.ariaLabel",defaultMessage:"Database view settings"}),...e}),render:C,buttonPopupStore:a})};return(0,v.jsx)(et.ZP,{renderTooltip:e=>(0,v.jsxs)("div",{...e,style:Bs.F6,children:[(0,v.jsx)("div",{children:(0,le.Cc)({collectionViewName:d,collectionViewType:u})}),void 0!==m&&(0,v.jsx)("div",{style:s.tooltipMessage,children:h||(0,v.jsx)(j.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:io.Bh[u],collection:(0,$c.Xh)(m.getName(),m)||(0,Wc.Q2)(l)}})})]}),placement:is.u.Left,render:e=>(0,v.jsx)(Qe.Z,{title:(0,v.jsx)(td.Z,{collectionViewType:u,collectionViewName:d}),icon:(0,v.jsx)(Hc.F,{color:"regular",viewIcon:p,viewType:u}),showDragHandle:!n.isMobile&&S,right:f(),rightStyle:{marginRight:8},...(0,Ge.Z)(e,r)})})}od.displayName="CollectionViewSelectItem";var rd=o(88833);const id=(0,j.defineMessages)({suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.collectionViewSuggestedViews.suggestedTitle"}});function nd(e,t){const o=(0,oe.O7)(),r=(0,c.VK)((()=>Lo.default.state.currentSpaceViewStore),[]),n=(0,c.VK)((()=>e.collectionViewBlockStore()),[e]),s=(0,c.VK)((()=>e.collectionStore()),[e]),l=(0,c.VK)((()=>{var e;if(!s)return;const t=null===(e=s.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,X.YB)((0,tl.appConfigs)(),t):void 0}),[s]),a=i.useCallback((i=>{if(!n||!l||!r)return;const s=n.getParentStore();if(!s||"block"!==s.table&&"space"!==s.table&&"team"!==s.table)return;if(1!==i.dependencies.length)return;const a=i.dependencies[0];Q.createAndCommit({userAction:"CollectionViewSuggestedViews.createView",environment:o,perform:c=>{var d;rd.applyFeatures({environment:o,spaceViewStore:r,appParentStore:s,appUri:l.uri,features:[{type:"simple",featureUri:i.uri}],appCollectionViewBlockStores:[n],createOrModify:"modify",transaction:c});const u=((null===(d=n.getFormat())||void 0===d?void 0:d.app_uri_map)??{})[a.uri];pe.f8({environment:o,collectionContextStore:e,collectionViewId:u,isFullScreen:e.isFullScreen.state,isRootChild:e.isRootChild.state,isInPeekRenderer:e.isInPeekRenderer.state}),t()}}),F.xb({environment:o,collectionContextStore:e,view_type:a.value.type,view_config_uri:i.uri})}),[n,l,r,o,e,t]);return{renderSuggestedView:i.useCallback((e=>({key:e.uri,render:t=>(0,v.jsx)(et.ZP,{placement:et.ug.Left,render:o=>((e,t)=>{var o;const r=e.dependencies[0],i=(0,v.jsx)(Hc.F,{color:"regular",viewIcon:null===(o=r.value.format)||void 0===o?void 0:o.collection_view_icon,viewType:r.value.type});return(0,v.jsx)(Qe.Z,{title:r.value.name?r.value.name:"New View",icon:i,...t})})(e,{...t,...o,onMouseEnter:e=>{var r,i;null===(r=o.onMouseEnter)||void 0===r||r.call(o,e),null===(i=t.onMouseEnter)||void 0===i||i.call(t,e)}}),renderTooltip:()=>e.description}),action:()=>{a(e)}})),[a])}}function sd(e){window.__c={n:"CollectionViewSuggestedViews"};const t=(0,oe.O7)().device,o=(0,re.yK)((e=>({showMoreLabel:{color:e.mediumTextColor}})),[]),r=e.suggestedViews,{renderSuggestedView:n}=nd(e.collectionContextStore,e.onClose),[s,l]=(0,i.useState)(!1),{collectionContextStore:a,onClose:d,onNewEmptyViewClick:u}=e,p=(0,c.VK)((()=>a.permissionScopes.state),[a]),h=(null==r?void 0:r.map((e=>n(e))))??[],m={key:"showMore",render:e=>(0,v.jsx)(Qe.Z,{...e,style:o.showMoreLabel,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Show more...",id:"collectionViewSuggestedViews.showMore.label"})}),action:()=>{l(!0)}},S=(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:0,sections:[{key:"suggested_views",render:e=>(0,v.jsx)(Re.Z,{...e}),items:s||h.length<=5?h:[...h.slice(0,5),m]}]}),g=p.canConfigureBlock&&(0,v.jsx)(Re.Z,{topBorder:!0,children:(0,v.jsx)(zc.Z,{title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New empty view",id:"database.collectionViewSuggestedViews.newEmptyViewTitle"}),onClick:()=>{u("CollectionViewSuggestedViews2.handleNewEmptyViewClick"),d()},focused:!1})});return(0,v.jsx)(Rc.Z,{capture:!0,allowEsc:!0,render:e=>{let o;return o=t.isMobile?{menuType:_e.og.Modal,title:ze.default.formatMessage(id.suggestedSectionTitle),right:(0,v.jsx)(Pe.DoneMenuText,{}),onClickRight:d,...e}:{menuType:_e.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e},(0,v.jsxs)(Ve.Z,{...o,children:[h.length&&(0,v.jsx)(Re.Z,{title:!t.isMobile&&ze.default.formatMessage(id.suggestedSectionTitle),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:2,marginBottom:2},style:{paddingBottom:0},children:S}),g]})}})}class ld extends s.Z{constructor(){super(...arguments),this.initialMenuListFocus=0,this.storeTypes={menuListStore:Uc.Z,viewFilterQueryStore:d.default.createClass("")},this.renderViewsSection=e=>{if(t=this.environment,o=this.props.collectionContextStore,r=this.stores.viewFilterQueryStore,function(e,t){const o=e.permissionScopes.state,{device:r}=t;return!r.isMobile&&o.canConfigureBlock}(o,t)&&""===r.state){const t=this.getFilteredViewStores().map((e=>e.id));return(0,v.jsx)(Re.Z,{...e,children:(0,v.jsx)(gs.ZP,{direction:"vertical",keys:t,renderKey:o=>e.children[t.indexOf(o)],onDrop:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleViewsDrop})})}return(0,v.jsx)(Re.Z,{...e});var t,o,r},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleViewsDrop=e=>function(e,t,o,r){const i=o.collectionViewBlockStore();if(!i)return;Q.createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:t,perform:t=>{pe.Wu({collectionViewBlockStore:i,newViewIds:e,transaction:t})}}),r.reset()}(e,this.environment,this.props.collectionContextStore,this.stores.menuListStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleViewFilterQueryChange=e=>function(e,t,o){o.setState(e.target.value),t.setState({...t.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}(e,this.stores.menuListStore,this.stores.viewFilterQueryStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_filterView=e=>function(e,t){return(0,le.D)(e,t.state)}(e,this.stores.viewFilterQueryStore)}UNSAFE_willMount(e){var t,o;const{collectionContextStore:r}=e,i=null===(t=r.collectionViewStore())||void 0===t?void 0:t.id,n=((null===(o=r.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===i));n>=0&&(this.initialMenuListFocus=n),this.stores.viewFilterQueryStore.setState("")}renderComponent(){var e;const{intl:t,collectionContextStore:o,onClose:r,onAddViewClick:i}=this.props,{device:n}=this.environment,s=o.permissionScopes.state,l=(0,Pr.qG)((null==o||null===(e=o.collectionViewBlockStore())||void 0===e?void 0:e.id)??""),a=(0,v.jsx)(zc.Z,{title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),onClick:()=>function(e,t){e("CollectionViewSelect2.handleCreateButtonClick"),t()}(this.props.onAddViewClick,this.props.onClose),focused:!1});return(0,v.jsx)(Rc.Z,{capture:!0,allowEsc:!0,render:e=>{var c,d;let u;u=n.isMobile?{menuType:_e.og.Modal,title:(0,v.jsx)(dd,{collectionContextStore:this.props.collectionContextStore}),right:(0,v.jsx)(Pe.DoneMenuText,{}),onClickRight:this.props.onClose,...e}:{menuType:_e.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e};const p=s.canConfigureBlock&&!l&&(0,v.jsx)(Re.Z,{topBorder:!0,children:this.props.suggestedViews&&this.props.suggestedViews.length?(0,v.jsx)(Ye.ZP,{popupType:this.environment.device.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,alignmentToOrigin:Ye.vR.Center,placementToOrigin:Ye.pO.Right,renderOrigin:e=>(0,v.jsx)(zc.Z,{title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),focused:!1,...e}),render:()=>(0,v.jsx)(sd,{collectionContextStore:o,suggestedViews:this.props.suggestedViews??[],onClose:r,onNewEmptyViewClick:i})}):a});return(0,v.jsxs)(Ve.Z,{...u,header:!n.isMobile&&!(null!==(c=o.collectionViewBlockStore())&&void 0!==c&&c.isCollectionViewPageWithContent())&&(0,v.jsx)(Kc.ZP,{value:this.stores.viewFilterQueryStore.state,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleViewFilterQueryChange,placeholder:t.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})}),footer:!n.isMobile&&p,children:[(0,v.jsx)(Re.Z,{title:!n.isMobile&&!(null!==(d=o.collectionViewBlockStore())&&void 0!==d&&d.isCollectionViewPageWithContent)&&(0,v.jsx)(dd,{collectionContextStore:this.props.collectionContextStore}),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:0,marginBottom:0},children:this.renderMenuList()}),this.stores.viewFilterQueryStore.state&&0===this.getFilteredViewStores().length&&(0,v.jsx)(Gc.Z,{caption:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),n.isMobile&&p]})}})}renderMenuList(){const e=this.getFilteredViewStores();if(e.length>0)return(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:this.initialMenuListFocus,sections:[{key:"views",render:this.renderViewsSection,items:e.map((e=>{const t={key:e.id,render:t=>(0,v.jsx)(ud,{collectionContextStore:this.props.collectionContextStore,onClose:this.props.onClose,collectionViewStore:e,props:t}),action:t=>{let{event:o}=t;!function(e,t,o,r,i,n,s,l,a){const c=o.collectionViewStore();c&&r({currentCollectionViewStore:c,newCollectionViewStore:e,openInNew:a});(function(e,t,o,r,i,n,s){pe.f8({environment:n,collectionContextStore:t,collectionViewId:e.id,openInNew:s,isFullScreen:o,isRootChild:r,isInPeekRenderer:i}),F.wd({environment:n,collectionContextStore:t,action:"click_view_in_dropdown",new_view_type:e.getType(),new_view_id:e.id})})(e,o,i,n,s,t,a),a||l()}(e,this.environment,this.props.collectionContextStore,this.props.onViewClick,this.props.isFullScreen,this.props.isRootChild,this.props.isInPeekRenderer,this.props.onClose,Sr.DJ(o))}};return t}))}],store:this.stores.menuListStore})}getFilteredViewStores(){return cd(this.props.collectionContextStore).filter(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_filterView)}}ld.displayName="CollectionViewSelect";const ad=(0,j.injectIntl)(ld);function cd(e){var t;return(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getCollectionViewStores())||[]}function dd(e){let{collectionContextStore:t}=e;window.__c={n:"MenuTitle"};const o=(0,c.VK)((()=>cd(t)),[t]);return(0,v.jsx)(j.FormattedMessage,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:o.length}})}function ud(e){let{collectionViewStore:t,props:o,collectionContextStore:r,onClose:i}=e;return(0,v.jsx)(od,{collectionContextStore:r,collectionViewStore:t,onClose:i,menuListItemProps:o})}var pd=o(60310),hd=o(16732),md=o(26991);const Sd=i.memo((function(e){let{collectionViewStore:t,collectionContextStore:o,onViewClick:r,disabled:n}=e;window.__c={n:"CollectionViewTab"};const s=(0,oe.O7)(),l=(0,re.Fg)(),[a,d]=(0,i.useState)(!1),u=(0,i.useCallback)((e=>{e.preventDefault(),(0,me.ZP)({event:e,context:me.Af.EditorContextMenu,callback:()=>{d(!0)}})}),[]),h=(0,i.useCallback)((e=>{const i=o.collectionViewStore();if(!i)return;const n=Sr.DJ(e);r({currentCollectionViewStore:i,newCollectionViewStore:t,openInNew:n}),i.id===t.id?d(!0):function(e,t,o,r){pe.f8({environment:o,collectionContextStore:t,collectionViewId:e,openInNew:r,isFullScreen:t.isFullScreen.state,isRootChild:t.isRootChild.state,isInPeekRenderer:t.isInPeekRenderer.state})}(t.id,o,s,n),F.wd({environment:s,collectionContextStore:o,action:"click_view_tab",new_view_type:t.getType(),new_view_id:t.id})}),[s,o,t,r]),m=(0,i.useCallback)((()=>{d(!1)}),[]),S=(0,i.useCallback)((()=>{let e;return e=s.device.isPhone?{menuType:_e.og.Modal,right:(0,v.jsx)(Pe.DoneMenuText,{}),onClickRight:m}:{menuType:_e.og.Popup,minWidth:220},(0,v.jsx)(Ve.Z,{...e,children:(0,v.jsx)(ed,{collectionContextStore:o,collectionViewStore:t,onClose:m})})}),[o,t,s,m]),g=(0,c.VK)((()=>o.collectionViewStore()),[o]),C=(0,c.VK)((()=>o.collectionViewBlockStore()),[o]),f=(0,c.VK)((()=>null==t?void 0:t.getFormat().collection_view_icon),[t]),y=(0,c.VK)((()=>null==t?void 0:t.getType()),[t]),x=(0,c.VK)((()=>t.isDefined()),[t]),b=(0,c.VK)((()=>{var e;return(null===(e=o.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||"none"}),[o.inheritedBlockColorStore]),w=(0,i.useRef)(null),k=(0,c.VK)((()=>{var e;return(null==C?void 0:C.getSpaceId())!==(null===(e=Lo.default.state.currentSpaceStore)||void 0===e?void 0:e.id)}),[C]),_=(0,c.VK)((()=>{var e;return t.getFormat().app_config_uri===p.g3&&"sprint_board"===(null===(e=Lo.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().special_page_for_pm_launch)&&!k}),[t,k]),T=(0,c.VK)((()=>!!C&&(0,Pr.YO)(o.isInPeekRenderer.state)),[o,C]);if(!x||!g||!C)return null;const V=g.id===t.id;return(0,v.jsx)(Je.ZP,{popupType:s.device.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,alignmentToOrigin:Je.ZP.Alignment.Start,open:a,render:S,onDismiss:m,origin:(0,v.jsxs)("div",{className:ro.rTm,style:{display:"flex",alignItems:"center",background:b,height:"100%",...V&&!T&&{borderBottom:`2px solid ${l.regularTextColor}`,paddingTop:2}},onContextMenu:u,children:[_&&(0,v.jsx)(xo.FF,{origin:w}),(0,v.jsx)(gd,{collectionViewStore:t,render:e=>(0,v.jsxs)(Xe.Z,{"aria-selected":V,role:"tab",ref:w,style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:R.Z.fontWeight.medium,color:V?l.regularTextColor:l.mediumTextColor,maxWidth:vd},hovered:a,onClick:h,disabled:n,...e,children:[(0,v.jsx)(Hc.F,{color:V?"regular":"light",viewIcon:f,viewType:y,style:{marginRight:6}}),(0,v.jsx)("span",{style:{...R.Z.textOverflowStyle,marginTop:1},children:(0,v.jsx)(fd,{collectionContextStore:o,collectionViewStore:t})})]},t.id)})]})})}));function gd(e){window.__c={n:"CollectionViewTabTooltip"};const t=(0,re.Fg)(),o=(0,j.useIntl)(),{collectionViewStore:r,render:i,disableTooltip:n}=e,s=(0,c.VK)((()=>r.getCollectionStore()),[r]),l=(0,c.VK)((()=>null==s?void 0:s.getModel()),[s]),a=(0,c.VK)((()=>r.getFormat().description),[r]),d=(0,c.VK)((()=>r.getModel()),[r]);return d?(0,v.jsx)(et.ZP,{placement:et.ug.Bottom,alignment:et.v2.Start,delayThreshold:500,render:i,disableTooltip:n,renderTooltip:e=>(0,v.jsxs)("div",{...e,style:Bs.F6,children:[(0,v.jsx)("div",{children:(0,le.Cc)({collectionViewName:d.getName(),collectionViewType:d.getType()})}),s&&l&&(0,v.jsx)("div",{style:{color:t.mediumInvertedTextColor},children:a||(0,v.jsx)(j.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:io.Bh[d.getType()],collection:(0,$c.Xh)(s.getName(),s)||l.getEmptyTitlePlaceholder({intl:o})}})})]})}):null}function Cd(e,t,o){var r;const i=e.collectionStore();if(!i)return t.getName();const n=i.getPropertyMapping(),s=t.getName(),l=null==n?void 0:n[p.Es.TaskToSprintRelation];if(!o||!l||s!==ze.default.formatMessage(hd.sY.tasksCurrentSprintV2ViewName))return t.getName();const a=o[l];if(!a||"relation"!==a.type||!a.collection_pointer)return t.getName();const c=null===(r=(0,md.As)(e,"current",a.collection_pointer,i))||void 0===r?void 0:r.getBlockTitleStore().getValue();return c?`${ze.default.formatMessage(hd.sY.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function fd(e){window.__c={n:"CollectionViewTabTitle"};const{collectionViewStore:t,collectionContextStore:o}=e,r=(0,j.useIntl)(),[i,n]=(0,c.VK)((()=>{const e=o.settingsStore.state;return[e.open,_.Z$(e.stack)]}),[o.settingsStore]),s=(0,c.VK)((()=>o.collectionViewBlockStore()),[o]),l=(0,c.VK)((()=>o.collectionViewStore()),[o]),a=(0,c.VK)((()=>t.getCollectionStore()),[t]),d=(0,c.VK)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===p.g3&&null!=a&&a.isDefined()?{name:Cd(o,t,a.getSchema()),type:t.getType()}:s&&(0,Pr.qG)(s.id)?{name:r.formatMessage(pd.CN.assignedToMeView),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,a,s,o,r]);return!d||l&&l.id===t.id&&i&&n&&("duplicateExistingView"===n.type||"createViewSource"===n.type||"createView"===n.type)?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,v.jsx)(td.Z,{collectionViewName:d.name,collectionViewType:d.type})}const vd=220,yd=i.memo((function(e){window.__c={n:"CollectionViewTabBar"};const{collectionContextStore:t,showHoverActionsStore:o,isPlaceholderExternalCollectionStore:r,onViewClick:n,disabled:s}=e,l=(0,i.useRef)(new Zc.E({throttleMs:200})),a=(0,i.useRef)(new Map),d=(0,i.useRef)(null),u=(0,i.useRef)(null),h=(0,c.VK)((()=>o.state),[o]),m=(0,c.VK)((()=>t.permissionScopes.state),[t]),S=(0,oe.O7)(),g=(0,re.Fg)();(0,i.useEffect)((()=>{const e=l.current;return()=>{e.destroy()}}),[l]);const C=(0,i.useCallback)((e=>{const t=e.getName(),o=e.getType();if(!o)return 0;let r=a.current.get(e.id);r||(r=new Ec({style:{fontSize:`${R.Z.fontSize.UIRegular.desktop}px`,fontWeight:R.Z.fontWeight.medium}}),a.current.set(e.id,r));const i=(0,le.Cc)({collectionViewName:t,collectionViewType:o}),n=r.measure(i);return Math.min(40+n.width,vd)}),[a]),f=(0,c.VK)((()=>{const e=bd(t),o=t.collectionViewStore();if(!o)return;const i=Math.max(100,xd(t,r)?105:0);let n=l.current.rect.state.width-i;const s=[],a=C(o);if(!(a<n))return s;s.push(o),n-=a;for(const t of e)if(t.id!==o.id){const e=C(t);if(!(e<n))break;s.push(t),n-=e}const c=s.filter((e=>e.id!==o.id)),d=e.findIndex((e=>e.id===o.id));return c.splice(d,0,o),c}),[t,r,C,l]),y=(0,c.VK)((()=>{var e;const{device:o}=S,i=bd(t),n=(null==f?void 0:f.length)||0,s=i.length-n,l=(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent())||o.isPhone||f&&(0===n||1===n&&i.length>1)||t.isCompactView.state?"dropdown":s>0?"someTabsNotVisible":"allTabsVisible",a=t.isFullScreen.state||h;return{showMoreViewsButton:"someTabsNotVisible"===l||"dropdown"===l,showAddViewButton:xd(t,r)&&"allTabsVisible"===l,addViewButtonAnimatedIn:a,viewSelectState:l,moreViewsCount:s}}),[t,S,r,h,f]),x=(0,i.useCallback)((e=>{e&&l.current.observe(e)}),[l]),b=(0,c.VK)((()=>{const e=t.collectionStore(),o=t.collectionViewBlockStore();if(!e||!o)return;const r=e.getFormat().app_config_uri,i=r?(0,X.YB)((0,tl.appConfigs)(),r):void 0;return i?(0,X.AG)(i,e,o):void 0}),[t]),w=(0,i.useCallback)((()=>{if(f&&"dropdown"!==y.viewSelectState)return m.canConfigureBlock?(0,v.jsx)(gs.ZP,{direction:"horizontal",keys:f.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>{const o=f.find((t=>t.id===e));if(o)return(0,v.jsx)(wd,{collectionContextStore:t,onViewClick:n,disabled:s,collectionViewStore:o})},onDrop:e=>function(e,t,o){const r=o.collectionViewBlockStore();if(!r)return;Q.createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:t,perform:t=>{pe.Wu({collectionViewBlockStore:r,newViewIds:e,transaction:t})}})}(e,S,t)}):f.map((e=>(0,v.jsx)(wd,{collectionContextStore:t,onViewClick:n,disabled:s,collectionViewStore:e},e.id)))}),[t,m.canConfigureBlock,s,S,n,y.viewSelectState,f]),k=(0,i.useCallback)((e=>{var o;const{device:r}=S,i=function(e){return e.collectionViewStore()}(t);if(!i)return;if(!i.isDefined())return;const n=(null===(o=t.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===p.GZ&&"page"===i.getType();if("dropdown"===y.viewSelectState){const o=i.getType(),l=i.getFormat().collection_view_icon,a=t.isCompactView.state;return(0,v.jsxs)(v.Fragment,{children:[!r.isMobile&&n&&"home"===Ss.B1()&&(0,v.jsx)(Dc,{origin:d}),(0,v.jsx)(gd,{collectionViewStore:i,disableTooltip:a,render:r=>(0,v.jsxs)(Xe.Z,{ref:d,style:{display:"flex",alignItems:"center",fontSize:s?R.Z.fontSize.UISmall.desktop:R.Z.fontSize.UIRegular.desktop,fontWeight:R.Z.fontWeight.semibold,color:s?g.mediumTextColor:g.regularTextColor,maxWidth:vd,paddingRight:s?0:void 0},disabled:s,...e,children:[(0,v.jsx)(Hc.F,{color:s?"lightGray":"regular",viewType:o,viewIcon:l,style:{marginRight:s?8:6},size:s?14:void 0}),(0,v.jsx)("span",{style:{...R.Z.textOverflowStyle,marginRight:6,marginTop:1},children:(0,v.jsx)(fd,{collectionContextStore:t,collectionViewStore:i})}),!s&&(0,Ti.i)({marginTop:2,width:10,height:10,fill:g.lightIconColor,marginRight:6})]})})]})}return"someTabsNotVisible"===y.viewSelectState?(0,v.jsx)(Xe.Z,{style:{display:"flex",alignItems:"center",fontSize:R.Z.fontSize.UIRegular.desktop,color:g.mediumTextColor},...e,children:(0,v.jsx)("span",{style:{marginTop:1},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"{moreViewsCount} moreâ¦",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:y.moreViewsCount}})})}):void 0}),[t,s,S,d,y,g]),_=(0,i.useCallback)(((e,o)=>{var r;const{device:i}=S,s=t.isFullScreen.state,l=t.isRootChild.state,a=t.isInPeekRenderer.state,c=(null===(r=t.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===p.GZ;return(0,v.jsxs)(v.Fragment,{children:[!i.isMobile&&"views"===Ss.B1()&&c&&(0,v.jsx)(Lc,{origin:u}),(0,v.jsx)("div",{ref:u,children:(0,v.jsx)(ad,{collectionContextStore:t,onAddViewClick:e=>kd(e,S,t),suggestedViews:o,onClose:e.close,isFullScreen:s,isRootChild:l,isInPeekRenderer:a,onViewClick:n})})]})}),[t,S,n,u]);return(0,v.jsxs)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",flexGrow:1},ref:x,children:[w(),y.showMoreViewsButton&&(0,v.jsx)(Ye.ZP,{popupType:S.device.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,render:e=>_(e,b),renderOrigin:e=>k(e),onClick:()=>function(e,t){F.wd({environment:e,collectionContextStore:t,action:"click_views_dropdown"})}(S,t)}),y.showAddViewButton&&(0,v.jsx)(ts.Z,{isVisible:!0,animationStyle:{opacity:y.addViewButtonAnimatedIn?1:0},render:()=>b&&b.length?(0,v.jsx)(Ye.ZP,{popupType:Ye.Z4.Popup,alignmentToOrigin:Nc.v2.Center,render:e=>(0,v.jsx)(_d,{collectionContextStore:t,parent:e,suggestedViews:b}),renderOrigin:e=>(0,v.jsx)(jt.Z,{className:ro.rVO,icon:de.R,...e})},"suggested-views"):(0,v.jsx)(jt.Z,{className:ro.rVO,icon:de.R,onClick:()=>kd("CollectionViewTabBar.handleAddViewClick",S,e.collectionContextStore)})})]})}));function xd(e,t){var o;const r=e.permissionScopes.state,i=null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.id,n=i&&(0,Pr.qG)(i);return r.canConfigureBlock&&!t.state&&!n}function bd(e){var t;return(null===(t=function(e){return e.collectionViewBlockStore()}(e))||void 0===t?void 0:t.getCollectionViewStores())||[]}function wd(e){let{collectionViewStore:t,collectionContextStore:o,onViewClick:r,disabled:i}=e;return(0,v.jsx)(Sd,{collectionContextStore:o,collectionViewStore:t,onViewClick:r,disabled:i},t.id)}function kd(e,t,o){Q.createAndCommit({userAction:e,environment:t,perform:e=>{pe.ME({environment:t,collectionContextStore:o,transaction:e})}}),F.xb({environment:t,collectionContextStore:o,view_type:"table"})}function _d(e){let{parent:t,suggestedViews:o,collectionContextStore:r}=e;window.__c={n:"SuggestedViewsPopupComponent"};const i=(0,oe.O7)();return(0,v.jsx)(sd,{collectionContextStore:r,suggestedViews:o,onClose:t.close,onNewEmptyViewClick:e=>kd(e,i,r)})}var Td=o(92650),Vd=o(12457),Od=o(97978),Pd=o(70764),Rd=o(54802),Md=o(2688),jd=o(58421),Id=o(88632),Fd=o(30874),Bd=o(77144),Nd=o(19671),Dd=o(85844),Ld=o(13023),Ad=o(29026),Ed=o(97058),Zd=o(71644);function Hd(e){window.__c={n:"BoardGroupsShimmer"};const{isFullScreen:t,boardCoverSize:o,showGroupHeader:r,areColumnsColored:i}=e,n=e.numBoardColumns||3,s=t?480:360,l=function(e){const t=xn+xn;return(0,le.rD)(e)+t}(o),a=(0,re.yK)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:10},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%"},group:{marginTop:i?20:8,marginRight:10,width:"100%",minWidth:l}})),[l,i]),c=_.DZ(n,(e=>(0,v.jsxs)("div",{style:a.group,children:[r&&(0,v.jsx)(Ei.Z,{style:a.groupHeader}),(0,v.jsx)(vn,{minHeight:s})]},e)));return(0,v.jsx)("div",{style:a.container,children:c})}var zd=o(24098);class Gd extends d.default{getInitialState(){return{searchQuery:"",limit:Gd.defaultLimit}}}Gd.defaultLimit=20,Gd.loadMoreScrollOffset=200,Gd.loadMoreIncrement=20;const Kd=Gd;var Ud=o(72087),Wd=o(43765),$d=o(3553);const qd={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:4},Qd=(0,j.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a pageâ¦",id:"boardHiddenGroup.searchPlaceholder"}});class Yd extends s.Z{constructor(){super(...arguments),this.createdStores=new Set,this.storeTypes={buttonPopupStore:eo.Z,boardHiddenGroupStore:Kd,requestStore:Ud.Z},this.renderPopup=()=>{const{device:e}=this.environment,{groupFormat:t,schema:o,currentGroups:r,collectionContextStore:i,groupBy:n}=this.props;let s;s=e.isMobile?{menuType:_e.og.Modal,title:(0,v.jsx)(dt.Z,{groupBy:n,groupFormat:t,currentGroups:r,schema:o,disabled:!0,isHiddenGroup:!0,collectionContextStore:i}),left:(0,v.jsx)(Ye.ZP,{popupType:Je.kQ.SlideUp,renderOrigin:e=>(0,v.jsx)("div",{...e,children:(0,ce.o)({width:18,height:18,color:this.theme.lightTextColor})}),render:e=>(0,v.jsx)(nu,{parent:e,groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore})}),right:(0,v.jsx)(Pe.DoneMenuText,{}),onClickRight:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePopupClose,header:this.renderHeader()}:{menuType:_e.og.Popup,header:this.renderHeader(),width:(0,le.rD)(tu(this.props.format))+20};const l=this.reducerStore.state;if(l)return(0,v.jsx)($d.Z,{store:this.selectableBlockStore,isDefaultContainer:!0,droppable:!0,render:e=>{let{selectableEvents:o}=e;return(0,v.jsxs)(Ve.Z,{...s,...o,children:[(0,v.jsx)(Ke.Z,{id:`board_hidden_group:${(0,ie.mD)(t)}`,reducer:l,groupsPointer:[t],collectionContextStore:i,resultStore:ou(this.props.collectionContextStore,this.props.groupFormat),render:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderResults}),(0,v.jsx)(an.Z,{onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleScrollOffsetChange})]})}})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderResults=()=>(0,v.jsx)(cu,{groupFormat:this.props.groupFormat,disabled:this.props.disabled,format:this.props.format,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isFullScreen:this.props.isFullScreen,buttonPopupStore:this.stores.buttonPopupStore}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePopupClose=()=>au(this.stores.buttonPopupStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchInputChange=e=>function(e,t,o){o.setState({searchQuery:e.target.value,limit:Kd.defaultLimit}),iu(t)}(e,this.environment,this.stores.boardHiddenGroupStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchClearButtonClick=()=>{return e=this.environment,this.stores.boardHiddenGroupStore.reset(),void iu(e);var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleButtonPopupClick=()=>{return e=this.environment,this.stores.boardHiddenGroupStore.reset(),void iu(e);var e},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:r,groupFormat:i}=this.props,s=n.findDOMNode(this);s&&s instanceof Element&&Q.createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:this.environment,perform:e=>L.BO({environment:this.environment,collectionContextStore:r,groupsPointer:[i],droppedStores:t,duplicate:o,transaction:e})})},this.handleBoardGroupHeaderAddItem=e=>{this.createdStores.add(e)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleScrollOffsetChange=e=>function(e,t,o,r){var i;const n=r.state,s=null===(i=ou(t,o))||void 0===i||null===(i=i.state)||void 0===i?void 0:i.blockIds,l=t.isLoading.state;e<Kd.loadMoreScrollOffset&&!l&&s&&n.limit<=s.length&&r.setState({...n,limit:n.limit+Kd.loadMoreIncrement})}(e,this.props.collectionContextStore,this.props.groupFormat,this.stores.boardHiddenGroupStore),this.reducerStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o}=this.props,{boardHiddenGroupStore:r}=this.stores,{searchQuery:i,limit:n}=r.state,s=(0,Ae.zk)({schema:t,group:e,propertyMapping:void 0,timeZone:(0,Ee.r)()});if(!s)return;return{type:"results",filter:s,limit:n,searchQuery:i,loadContentCover:Boolean(o&&o.board_cover&&"page_content"===o.board_cover.type)}}))}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new ge.G(this.environment,{table:V.iU,id:t.id}))}renderComponent(){const{device:e}=this.environment,{groupBy:t,groupFormat:o,disabled:r,query:i,schema:n,currentGroups:s,collectionContextStore:l}=this.props,a=i.aggregations?i.aggregations[0]:void 0;return(0,v.jsx)(It.Z,{store:this.selectableBlockStore,canDropOnto:!r,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,v.jsx)(Ye.ZP,{popupType:e.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,renderOrigin:e=>(0,v.jsxs)(ko.Z,{style:qd,...e,children:[(0,v.jsx)(dt.Z,{groupBy:t,groupFormat:o,currentGroups:s,schema:n,disabled:!0,isHiddenGroup:!0,collectionContextStore:l}),(0,v.jsx)(di,{groupFormat:o,aggregation:a,schema:n,collectionContextStore:l,disabled:!0,onChange:e=>function(e,t,o,r){const i=t.collectionViewStore(),n=e?[e]:[],s={...o,aggregations:n};i&&Q.createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:r,perform:e=>{pe.iG({collectionViewStore:i,update:{query2:s},transaction:e})}})}(e,this.props.collectionContextStore,this.props.query,this.environment)})]},(0,ie.mD)(o)),render:this.renderPopup,buttonPopupStore:this.stores.buttonPopupStore,onClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleButtonPopupClick})})}renderHeader(){const{device:e}=this.environment,{groupFormat:t,disabled:o,format:r,schema:n,query:s,currentGroups:l,collectionContextStore:a,isFullScreen:c,hoveredGroupStore:d,groupBy:u,isInPeekRenderer:p}=this.props,{searchQuery:h}=this.stores.boardHiddenGroupStore.state;return(0,v.jsxs)(i.Fragment,{children:[!e.isMobile&&(0,v.jsx)(yi,{groupBy:u,currentGroups:l,groupFormat:t,query:s,schema:n,format:r,collectionContextStore:a,disabled:o||Boolean(h),hidden:!0,isPopup:!0,onAddItem:this.handleBoardGroupHeaderAddItem,isFullScreen:c,hoveredGroupStore:d,isInPeekRenderer:p},(0,ie.mD)(t)),(0,v.jsx)("div",{style:{margin:e.isMobile?0:"6px 0"},children:(0,v.jsx)(zd.Z,{capture:!0,render:t=>(0,v.jsx)(Kc.ZP,{value:h,placeholder:ze.default.formatMessage(Qd.searchPlaceholder),autoFocus:!e.isMobile,showClearButton:!0,onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchInputChange,onClearButtonClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchClearButtonClick,...t})})})]})}}Yd.displayName="BoardHiddenGroup";const Xd=Yd;function Jd(e){return e?e.board_cover:void 0}function eu(e){return e?e.board_cover_aspect:void 0}function tu(e){return e?e.board_cover_size:void 0}function ou(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function ru(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function iu(e){zo.default.state.stores.length>0&&W.ZH(e)}function nu(e){let{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,collectionContextStore:s}=e;window.__c={n:"ActionButtonPopupComponent"};const l=(0,c.VK)((()=>s.collectionStore()),[s]),a=s.boardColumnsLimitStore;return l?(0,v.jsx)(Ie,{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:a}):null}function su(e,t,o,r,i){const{blocks:n,transaction:s}=e,l=o.groupsStore.getGroupState(t);if(!l)return;const a=l.resultsStore;if(n.length>0&&a.state.length>0){const e=n[0];if(!Ce.M_(i)||!o.collectionStore()||!o.shouldAllowNewItemCreation())return;oo({transaction:s,environment:i,collectionContextStore:o,isFullScreen:r,groupsPointer:[t],insertAtIndex:a.state.findIndex((t=>t===e))+1,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}}function lu(e,t,o,r){const i=t.collectionStore(),n=e.getTitleStore();if(to.QaF(null==n?void 0:n.getValue()))return void W.Ys({environment:r,store:e});if(!i)return;const s=ru(t,o);if(!s)return;const l=s.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),c=t.collectionViewBlockStore();if(a&&c&&I.sG(r,{...(0,he.Pn)(t),block_id:e.id}),Q.createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:r,perform:t=>{L.Od({store:e,transaction:t})}}),l>=0){const e=s.state[l];W.Ys({environment:r,store:e})}}function au(e){e.setState({open:!1})}function cu(e){let{groupFormat:t,disabled:o,format:r,collectionContextStore:n,schema:s,blockPropertyValueOverlayStore:l,isFullScreen:a,buttonPopupStore:d}=e;window.__c={n:"ResultsComponent"};const u=(0,oe.O7)(),p=(0,i.useCallback)((()=>au(d)),[d]),{device:h}=u,m=(0,c.VK)((()=>{var e;return null===(e=ou(n,t))||void 0===e?void 0:e.state}),[n,t]),S=(0,c.VK)((()=>{var e;return null===(e=ru(n,t))||void 0===e?void 0:e.state}),[n,t]),g=(0,c.VK)((()=>Ho.default.isSidePeekOpen()),[]);return m&&S?0===S.length?(0,v.jsx)(Re.Z,{children:(0,v.jsx)(Wd.Z,{title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,v.jsx)("div",{style:{padding:h.isMobile?"8px 16px":"6px 14px 8px"},children:(0,v.jsx)(Ar,{collectionContextStore:n,groupsPointer:[t],format:r,canDrag:!o,onSelectableEnter:e=>su(e,t,n,a,u),disableRequest:!0,resultProps:{format:r,schema:s,disabled:o,coverFormat:Jd(r),coverAspectFormat:eu(r),coverSizeFormat:tu(r),shouldShowTitle:io.K8(r,"board"),colorStyle:void 0,blockPropertyValueOverlayStore:l,onTextEnter:e=>function(e,t,o,r,i){const n=ru(t,r);if(!n)return;if(!Ce.M_(i)||!t.collectionStore())return lu(e,t,r,i);const s=n.state.findIndex((t=>t===e))+1;Q.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,perform:e=>{oo({transaction:e,environment:i,collectionContextStore:t,isFullScreen:o,groupsPointer:[r],insertAtIndex:s,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}})}(e,n,a,t,u),onTextEsc:e=>lu(e,n,t,u),onShiftEnter:e=>su(e,t,n,a,u),collectionContextStore:n},resultComponent:pr,handleOpenPeekPage:g?void 0:p,canDrop:!0,disabled:o,shouldShowHoverMenu:!1,direction:Dr.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,v.jsx)(Re.Z,{children:(0,v.jsx)(Wd.Z,{title:(0,v.jsx)(Ue.Z,{})})})}function du(e){window.__c={n:"CollectionViewErrorInlineButton"};const t=(0,re.yK)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,v.jsx)(ko.Z,{style:t.button,onClick:e.onClick,children:e.children})}const uu=function(e){window.__c={n:"CollectionViewError"};const{collectionContextStore:t,title:o,description:r,icon:i,style:n}=e,s=(0,c.VK)((()=>t.settingsStore.state.open),[t.settingsStore]),l=(0,re.yK)((e=>({wrapper:{paddingTop:8,minHeight:250,display:"flex",alignItems:"center",justifyContent:"center",...n},innerWrapper:{paddingLeft:16,paddingRight:s?te.nJ+16:16},title:{fontSize:17,fontWeight:R.Z.fontWeight.medium,color:e.lightTextColor,textAlign:"center",marginBottom:-2},description:{margin:"0 auto",fontSize:14,color:e.lightTextColor},button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[s,n]);return(0,v.jsx)("div",{style:l.wrapper,children:(0,v.jsxs)("div",{style:l.innerWrapper,children:[i,(0,v.jsx)("div",{style:l.title,children:o}),r?(0,v.jsx)("div",{style:l.description,children:r}):void 0]})})};class pu extends Mo.Z{constructor(e){super(e),this.storeTypes={groupsResultStore:d.default.createClass(void 0),hoveredGroupStore:d.default.createClass(void 0),subgroupsMountedStore:d.default.createClass(!1),lastColumnsBy:d.default.createClass(void 0),lastGroupBy:d.default.createClass(void 0)},this.hiddenGroupsContainerRef=void 0,this.hiddenGroupsHeaderRef=void 0,this.hiddenGroupsHeaderLastOffset=void 0,this.renderBoardHiddenGroupsButton=e=>(0,v.jsx)("div",{style:{display:"flex",minWidth:ku(this.props.format,this.columnsDisplayStateStore)},children:(0,v.jsx)(Pi,{...e})}),this.renderSubGroupHeader=e=>{const{collectionContextStore:t}=this.props,o=t.isCompactView.state;return(0,v.jsx)(Nt,{...e,height:o?io.yZ:36,getComputedStickyStyle:e=>o?{}:function(e,t,o){return{background:t?o.cardContentBackground:o.contentBackground,boxShadow:e?`0 1px 0 ${t?o.cardContentBackground:o.contentBackground}`:void 0}}(e,this.props.isInPeekRenderer,this.theme),style:{...e.style,minWidth:ku(this.props.format,this.columnsDisplayStateStore)},onMount:()=>this.stores.subgroupsMountedStore.setState(!0)})},this.renderHiddenGroup=e=>{const{collectionContextStore:t,query:o,schema:r,format:i,disabled:n,blockPropertyValueOverlayStore:s,isFullScreen:l,isInPeekRenderer:a}=this.props,c=this.columnsDisplayStateStore.state.currentGroups;if(!mu(e,this.props.collectionContextStore)||!i.board_columns_by)return;const d=t.permissionScopes.state;return(0,v.jsx)(Xd,{query:o,schema:r,format:i,groupFormat:e,groupBy:i.board_columns_by,currentGroups:c,collectionContextStore:t,disabled:n||!this.canEdit()||!d.canEditContent,blockPropertyValueOverlayStore:s,isFullScreen:l,hoveredGroupStore:this.stores.hoveredGroupStore,isInPeekRenderer:a},(0,ie.mD)(e))},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleGroupsChange=()=>function(e,t,o,r){const i=r.state.currentGroups;L.$D({environment:e,format:t,groupsFormatKey:"board_columns",collectionContextStore:o,currentGroups:i})}(this.environment,this.props.format,this.props.collectionContextStore,this.columnsDisplayStateStore),this.handleGroupsChangeDebounced=_.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleGroupsChange,5e3),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave=()=>{this.stores.hoveredGroupStore.setState(void 0)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=e=>function(e,t,o){!function(e,t,o){const{device:r}=o;r.isMobile?ne._({environment:o,store:e,pageVisitSource:u.tY.Create}):se.CH({environment:o,store:e,peekMode:le.kr(t.collectionViewStore()),resultsStore:void 0,collectionContextStore:t,pageVisitSource:u.tY.Create})}(e,o,t)}(e,this.environment,this.props.collectionContextStore),this.subgroupsOnChangeStore=this.createComputedStore((()=>{var e,t;const{collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=null==r||null===(e=r.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),n=null==r||null===(t=r.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue();_.Xy(i,this.stores.lastGroupBy.state)&&_.Xy(n,this.stores.lastColumnsBy.state)||this.stores.subgroupsMountedStore.setState(!1),this.stores.lastGroupBy.setState(i),this.stores.lastColumnsBy.setState(n)})),this.anyVisibleGroupHasResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t,format:o,schema:r}=this.props,i=this.columnsDisplayStateStore.state,{visibleGroups:n}=i,s=o.collection_group_by,l=t.collectionViewBlockStore(),a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=void 0!==l?(0,ke.Cz)({groupBy:s,schema:r,formatGroups:o.collection_groups||[],schemaGroups:this.schemaGroupsStore.state,reducerResults:c,getRecordModel:l.getRecordModel,relativeVariableResult:t.relativeVariableStore.state,viewAppConfigUri:null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}):[];if(0===d.length){if(void 0!==s)return!1;for(const e of n){const o=t.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}}else for(const u of d)for(const e of n){const o=[u,e],r=t.groupsStore.getGroupState(o);if(null!=r&&r.reducerResultStore.state)return!0}return!1})),this.schemaGroupsStore=this.createComputedStore((()=>{const{format:e,schema:t}=this.props,o=e.board_columns_by;if(o)return(0,ie.Qq)({schema:t,groupBy:o})}),!0),this.groupsReducerStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,r=o.remoteRequestStore.state,i=Yt.default.checkGate("use_collection_reducer_request_hook")?(0,Ut.ze)(o,!0):null==r?void 0:r.loader.filter,n=e.board_columns_by;if(n)return(0,ke.ej)({groupBy:n,schema:t,format:e,filter:i,groupsFormatKey:"board_columns",limit:o.boardColumnsLimitStore.state})})),this.columnsDisplayStateStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,r=e.board_columns_by;if(!r)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const i=o.collectionViewBlockStore();if(!i)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const n=o.collectionViewStore(),s=o.boardColumnsLimitStore.state,l=this.schemaGroupsStore.state,a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=a?a.total:0,u=(0,ke.Cz)({groupBy:r,schema:t,formatGroups:e.board_columns||[],schemaGroups:l,reducerResults:c,getRecordModel:i.getRecordModel,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null==n?void 0:n.getFormat().app_config_uri}),p=u.filter((e=>!(0,ie.eF)(e))).slice(0,s),h=u.filter((e=>(0,ie.eF)(e)));return{currentGroups:[...p,...h],visibleGroups:p,hiddenGroups:h,total:d}}),!0),this.disableBoardColorColumnsStore=this.createComputedStore((()=>{const{schema:e,format:t,collectionContextStore:o}=this.props;return!Boolean((0,ke.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t,collectionContextStore:o,theme:this.theme}))})),this.hiddenGroupsContainerRef=i.createRef(),this.hiddenGroupsHeaderRef=i.createRef(),this.hiddenGroupsHeaderLastOffset=0}UNSAFE_willMount(){this.columnsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}UNSAFE_willUnmount(){this.columnsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}UNSAFE_willMountOrUpdate(e){const{format:t,store:o,collectionContextStore:r}=e,i=r.collectionStore();i&&(!t.board_columns_by&&o.isDefined()&&i.isDefined()&&function(e,t,o){const{collectionContextStore:r,schema:i}=e,n=r.collectionStore(),s=r.permissionScopes.state;if(!n)return;const l=r.collectionViewStore();if(!l||!s.canConfigureBlock)return;Q.createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:o,perform:e=>{let a,c=le.Se(i);if(!c&&s.canConfigureCollection){c=(0,Zd.ZP)();a={[c]:{name:t.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}if(!c)return;const d=(a||i)[c];d&&(0,ie.LG)(d)&&(So.FH({stores:[l],update:{board_columns_by:(0,ie.fw)(c,d,"collectionTypedView"===r.contextType)},transaction:e}),go.sW({store:l,data:{type:"board"},transaction:e}),a&&pe.xO({environment:o,collectionStore:n,update:a,transaction:e}))}})}(e,this.props.intl,this.environment),l.default.afterNextFlush((()=>this.updateHiddenGroupsHeaderOffset())))}renderPersisted(){const{format:e,collectionContextStore:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:n}=this.props,s=t.permissionScopes.state,l=t.settingsStore;return e.board_columns_by?this.renderBoard():(0,v.jsx)(uu,{collectionContextStore:t,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:s.canConfigureBlock?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,v.jsx)(du,{onClick:()=>{A.r$({collectionContextStore:t,collectionSettingsStore:l}),A.H4({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:n}})}renderBoard(){const{store:e,format:t,isFullScreen:o,collectionContextStore:r}=this.props,i=this.columnsDisplayStateStore.state,{visibleGroups:n,hiddenGroups:s}=i,l=t.collection_group_by,a=this.anyVisibleGroupHasResultsStore.state,c=this.stores.subgroupsMountedStore.state;this.subgroupsOnChangeStore.state;const d=r.shouldShowSpinner.state&&!c&&!a,u=r.isCompactView.state;return this.renderBoardColumnsReducerRequest((()=>(0,gr.Z)((c=>{return(0,v.jsx)(ii,{isFullScreen:o,renderEmitter:r.renderEmitter,children:(0,v.jsx)("div",{style:(h=this.props.paddingLeft,m=this.props.paddingRight,{marginLeft:h,marginRight:m,float:"left",minWidth:"100%"}),className:ro.EGJ,...c,children:(0,v.jsxs)(It.Z,{style:(p=this.props.paddingBottom,{display:"flex",position:"relative",flexGrow:1,paddingBottom:p}),store:e,shouldShowHalo:!o&&!u,canSelect:!o,onMouseDown:e=>function(e,t){const{device:o}=t,{target:r}=e;!o.isMobile&&r instanceof HTMLElement&&(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),z.AI({environment:t,target:r,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),analyticsName:"board",onMouseLeave:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave,children:[this.renderHeader(i),d&&(0,v.jsx)(Hd,{isFullScreen:o,numBoardColumns:n.length,boardCoverSize:t.board_cover_size,areColumnsColored:!this.disableBoardColorColumnsStore.state,showGroupHeader:!0}),n.length>0&&(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{style:{height:34+Tn(this.disableBoardColorColumnsStore.state,u)}}),l?this.renderBoardColumnsForGroups(l,n,a):this.renderBoardColumnsForGroup(void 0,n,a)]}),Su(i,this.props.collectionContextStore)&&(0,v.jsx)("div",{style:{width:90,marginLeft:wn,marginRight:wn}}),gu(i,this.props.format,this.props.collectionContextStore)&&(0,v.jsx)("div",{style:{width:35,marginLeft:wn,marginRight:wn}}),s.length>0&&this.renderHiddenGroups(s)]})})});var p,h,m}))))}renderBoardColumnsReducerRequest(e){const{collectionContextStore:t}=this.props,o=this.groupsReducerStore.state;return o?(0,v.jsx)(Ke.Z,{id:"board_columns",reducer:o,collectionContextStore:t,resultStore:this.stores.groupsResultStore,render:e}):e()}renderHeader(e){const{format:t,isFullScreen:o,isRootChild:r,collectionContextStore:i}=this.props,{hiddenGroups:n,visibleGroups:s,currentGroups:l}=e;if(0===s.length&&0===n.length)return;const a=s.map((e=>(0,ie.mD)(e))),c=t.board_columns_by;if(!c)return;const d=(0,ie.mu)(c),u=i.permissionScopes.state,p="manual"===d.type&&u.canConfigureBlock,h=(0,ke.qW)({device:this.environment.device,isFullScreen:o,isRootChild:r}),m=i.isCompactView.state;return(0,v.jsx)(Mt,{position:ft(m),children:(0,v.jsxs)("div",{style:bu(this.theme,this.props.collectionContextStore,this.props.isInPeekRenderer,this.disableBoardColorColumnsStore),children:[h&&(0,v.jsx)("div",{style:yu(this.props.isInPeekRenderer,this.theme,m)}),p?(0,v.jsx)(gs.ZP,{direction:"horizontal",keys:a,renderKey:(e,t)=>(0,v.jsx)(xu,{schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,format:this.props.format,query:this.props.query,disabled:this.props.disabled,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,hoveredGroupStore:this.stores.hoveredGroupStore,groupFormat:s[t],currentGroups:l}),onDrop:e=>_u(e,!1,this.environment,this.props.collectionContextStore,this.columnsDisplayStateStore)}):a.map(((e,t)=>(0,v.jsx)(xu,{schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,format:this.props.format,query:this.props.query,disabled:this.props.disabled,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,hoveredGroupStore:this.stores.hoveredGroupStore,groupFormat:s[t],currentGroups:l},(0,ie.mD)(s[t])))),Su(e,this.props.collectionContextStore)&&(0,v.jsx)(Cu,{collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,displayState:e}),gu(e,this.props.format,this.props.collectionContextStore)&&this.renderAddGroupButton(),n.length>0&&(0,v.jsx)("div",{style:vu(this.props.isInPeekRenderer,this.theme,m),ref:this.hiddenGroupsHeaderRef,children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})})]})})}renderHiddenGroups(e){const{device:t}=this.environment,{collectionContextStore:o}=this.props,r=this.canEdit()&&!t.isMobile&&!o.permissionScopes.state.isLocked,i=e.slice(0,ke.ew),n=i.map((e=>(0,ie.mD)(e)));return(0,v.jsx)("div",{style:wu(this.props.collectionContextStore,this.disableBoardColorColumnsStore),ref:this.hiddenGroupsContainerRef,children:i.length>0&&(r?(0,v.jsx)(gs.ZP,{direction:"vertical",keys:n,renderKey:(e,t)=>this.renderHiddenGroup(i[t]),onDrop:e=>_u(e,!0,this.environment,this.props.collectionContextStore,this.columnsDisplayStateStore)}):(0,v.jsx)("div",{children:i.map(this.renderHiddenGroup)}))})}renderAddGroupButton(){const{format:e,schema:t,collectionContextStore:o}=this.props;if(!e.board_columns_by)return;if("collectionTypedView"===o.contextType)return;const r=this.columnsDisplayStateStore.state.currentGroups;return(0,v.jsx)(Hn,{groupBy:e.board_columns_by,schema:t,currentGroups:r,onAccept:e=>function(e,t,o,r,i){const n=t.collectionStore();if(!n)return;const s=r.board_columns_by;if(!s)return;L.tH({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:n,schema:o,groupBy:s,environment:i})}(e,this.props.collectionContextStore,this.props.schema,this.props.format,this.environment),groupsLimitStore:o.boardColumnsLimitStore,parentStore:this.props.store,type:"board",collectionContextStore:o})}renderBoardColumnsForGroups(e,t,o){const{store:r,format:i,collectionContextStore:n,schema:s,disabled:l,isFullScreen:a,paddingLeft:c,isRootChild:d,isInPeekRenderer:u}=this.props;return(0,ke.hJ)()?(0,v.jsx)(on,{reducerId:Ed.M9,store:r,collectionContextStore:n,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:c,stickyLeft:!this.environment.device.isMobile,renderGroup:e=>this.renderBoardColumnsForGroup(e,t,o),getGroupStyle:fu,renderHeader:this.renderSubGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem}):(0,v.jsx)(Gn,{store:r,id:Ed.M9,groupBy:e,groupsFormatKey:ie.Uh,groupAggregationKey:ie.dQ,format:i,schema:s,collectionContextStore:n,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:c,renderGroup:e=>this.renderBoardColumnsForGroup(e,t,o),renderHeader:this.renderSubGroupHeader,renderHiddenGroupsButton:this.renderBoardHiddenGroupsButton,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,stickyLeft:!this.environment.device.isMobile,getGroupStyle:fu,isInPeekRenderer:u})}renderBoardColumnsForGroup(e,t,o){return(0,v.jsx)("div",{style:gs.l8,children:t.map(((r,i)=>{const n=i===t.length-1;return this.renderGroupResults(e?[e,r]:[r],n,o)}))})}renderGroupResults(e,t,o){const{store:r,collectionContextStore:i,isFullScreen:n,query:s,schema:l,format:a,disabled:c,blockPropertyValueOverlayStore:d}=this.props,{hiddenGroups:u}=this.columnsDisplayStateStore.state,p=0!==u.length;if(!i.groupsStore.getGroupState(e))return;const h=i.permissionScopes.state,m=this.canEdit()&&("collectionTypedView"===i.contextType||h.canEditContent);return(0,v.jsx)(On,{store:r,hoveredGroupStore:this.stores.hoveredGroupStore,query:s,schema:l,format:a,groupsPointer:e,collectionContextStore:i,isFullScreen:n,isInPeekRenderer:this.props.isInPeekRenderer,disabled:c||!m,isLast:t&&!p,blockPropertyValueOverlayStore:d,anyGroupHasResults:o},(0,ie.KW)(e))}updateHiddenGroupsHeaderOffset(){var e;if("function"==typeof this.hiddenGroupsHeaderRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current)return;const t=(this.getHiddenGroupsHeaderOffset()||0)+this.hiddenGroupsHeaderLastOffset;this.hiddenGroupsHeaderLastOffset=t,this.hiddenGroupsHeaderRef.current.style.left=`${t}px`}getHiddenGroupsHeaderOffset(){var e,t;if("function"==typeof this.hiddenGroupsHeaderRef||"function"==typeof this.hiddenGroupsContainerRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current||null===(t=this.hiddenGroupsContainerRef)||void 0===t||!t.current)return;const o=this.hiddenGroupsHeaderRef.current.getBoundingClientRect().left;return this.hiddenGroupsContainerRef.current.getBoundingClientRect().left-o+8}}pu.displayName="Board";const hu=(0,j.injectIntl)(pu);function mu(e,t){return t.groupsStore.getGroupState([e])}function Su(e,t){const{visibleGroups:o,hiddenGroups:r,total:i}=e,n=0===o.length&&!t.shouldShowSpinner.state||o.length>0,s=qt({collectionContextStore:t,isForColumnGroups:!0}),l=t.boardColumnsLimitStore.state<i-r.length;return n&&l||s}function gu(e,t,o){const{visibleGroups:r}=e,i=t.board_columns_by,n=o.permissionScopes.state,s=0===r.length&&!o.shouldShowSpinner.state||r.length>0;return n.canConfigureBlock&&i&&(0,ie.Wz)(i,n.canConfigureCollection)&&!n.isSyncedCollection&&s}function Cu(e){let{displayState:t,collectionContextStore:o,schema:r}=e;const i=o.boardColumnsLimitStore;return(0,v.jsx)(Fi,{visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:i,type:"board",schema:r,collectionContextStore:o})}function fu(e){return{marginTop:4,...e.isLast&&{paddingBottom:12}}}function vu(e,t,o){return{position:"relative",width:220,flexShrink:0,display:"flex",alignItems:"center",fontSize:14,color:t.lightTextColor,...o?{}:{background:e?t.cardContentBackground:t.contentBackground},marginLeft:20}}function yu(e,t,o){return{height:"calc(100% + 17px)",...o?{}:{background:e?t.cardContentBackground:t.contentBackground},width:20,marginLeft:-20,marginTop:-17}}function xu(e){let{groupFormat:t,currentGroups:o,schema:r,collectionContextStore:i,format:n,query:s,disabled:l,isFullScreen:a,isInPeekRenderer:d,hoveredGroupStore:u}=e;window.__c={n:"GroupHeaderComponent"};return(0,c.VK)((()=>mu(t,i)),[i,t])&&n.board_columns_by?(0,v.jsx)(yi,{currentGroups:o,groupFormat:t,query:s,schema:r,format:n,groupBy:n.board_columns_by,collectionContextStore:i,hoveredGroupStore:u,disabled:l,hidden:!1,isPopup:!1,isInPeekRenderer:d,isFullScreen:a}):null}function bu(e,t,o,r){var i;const n=t.isCompactView.state,s=n?"transparent":(null===(i=t.inheritedBlockColorStore.state)||void 0===i?void 0:i.background)||(o?e.cardContentBackground:e.contentBackground),l=Tn(r.state,n);return{position:"absolute",background:s,height:34+l,paddingTop:l,zIndex:M.LN,display:"flex",boxShadow:`-3px 0 0 ${s}`,minWidth:"100%"}}function wu(e,t){const o=e.isCompactView.state;return{width:220,flexShrink:0,marginTop:34+Tn(t.state,o),marginLeft:12}}function ku(e,t){return t.state.visibleGroups.length*(vi(e)+2*xn+2*wn)}function _u(e,t,o,r,i){const n=i.state.currentGroups,s=n.filter((t=>e.indexOf((0,ie.mD)(t))<0)),l=n.filter((t=>e.indexOf((0,ie.mD)(t))>=0)),a=_.MR(l,(t=>{const o=e.indexOf((0,ie.mD)(t));return o>=0?o:1/0})),c=t?[...s,...a]:[...a,...s];Q.createAndCommit({userAction:"Board.handleGroupReorder",environment:o,perform:e=>{L.A6({collectionContextStore:r,newGroups:c,groupsFormatKey:"board_columns",transaction:e})}}),F.wd({environment:o,collectionContextStore:r,action:t?"board_reorder_hidden_groups":"board_reorder_groups"})}var Tu=o(13991),Vu=o(40506),Ou=o(7057),Pu=o(53877),Ru=o(2585),Mu=o(5257),ju=o(40863),Iu=o(71574),Fu=o(86615),Bu=o(28451),Nu=o(63296),Du=o(92083),Lu=o(84437),Au=o(35599);const Eu=(0,j.defineMessages)({defaultTitle:{id:"openInNotionCalendarOnboardingTooltip.header",defaultMessage:"Get Notion Calendar"},defaultContent:{id:"openInNotionCalendarOnboardingTooltip.content",defaultMessage:"View any Notion database with calendar and timeline views with your Google Calendar events"},connectCalendarTitle:{id:"openInNotionCalendarOnboardingTooltip.connectCalendarTitle",defaultMessage:"Connect Calendar"},successTitle:{id:"openInNotionCalendarOnboardingTooltip.success.header",defaultMessage:"Successfully connected"},successContent:{id:"openInNotionCalendarOnboardingTooltip.success.content",defaultMessage:"You can now view any database with calendar and timeline views in Notion Calendar"}});function Zu(e){let{variant:t,origin:o,onCloseClick:r,onConnectCalendarClick:i}=e;window.__c={n:"OpenInNotionCalendarTooltip"};const n=(0,re.yK)((e=>({tooltip:{width:233},content:{opacity:1},contentInner:{display:"flex",flexDirection:"column",gap:14},contentMessage:{opacity:.8,color:e.regularInvertedTextColor},footer:{display:"flex",alignItems:"center",gap:12},primaryButton:{display:"flex",alignItems:"center",height:24,padding:"0 12px",marginLeft:"auto",borderRadius:4,background:"#FFF",color:"#1D1B16",fontSize:12,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},primaryButtonHover:{background:"rgba(255,255,255,0.9)"},primaryButtonPressed:{background:"rgba(255,255,255,0.8)"}})),[]);return(0,v.jsx)(ks.U,{origin:o,placementToOrigin:"bottom",header:(0,v.jsx)(j.FormattedMessage,{..."success"===t?Eu.successTitle:Eu.defaultTitle}),content:(0,v.jsxs)("div",{style:n.contentInner,children:[(0,v.jsx)("div",{style:n.contentMessage,children:(0,v.jsx)(j.FormattedMessage,{..."success"===t?Eu.successContent:Eu.defaultContent})}),"default"===t&&(0,v.jsx)("div",{style:n.footer,children:(0,v.jsx)(ko.Z,{style:n.primaryButton,hoveredStyle:n.primaryButtonHover,pressedStyle:n.primaryButtonPressed,onClick:i,children:(0,v.jsx)(j.FormattedMessage,{...Eu.connectCalendarTitle})})})]}),contentStyle:n.content,onCloseClick:r,shouldDismissUponOutsideClick:!0,pointerPosition:"33%",style:{...n.tooltip}})}function Hu(e){let{collectionContextStore:t}=e;window.__c={n:"OpenInNotionCalendarButton"};const o=(0,i.useRef)(null),[r,n]=(0,i.useState)(!1),[s,l]=(0,i.useState)(!1),a=(0,oe.O7)(),d=(0,c.VK)((()=>Lo.default.state.currentSpaceStore),[]),u=(0,c.VK)((()=>Lo.default.state.currentUserSettingsStore),[]),p=(0,c.VK)((()=>(0,Iu.tE)()),[]),h=(0,c.VK)((()=>t.isFullScreen.state),[t]),m=(0,c.VK)((()=>{var e;if(!h)return!1;if(!Yt.default.checkGate("notion_calendar"))return!1;if(!u)return!1;if(!Fd.Z.state.loaded)return!1;return!Du.Z.state.open&&(!!Lo.default.state.inAppCalloutStore.canShow("open_in_calendar_tooltip")&&(!Ho.default.state.open&&(!s&&(!(null!==(e=u.getSettings())&&void 0!==e&&e.seen_open_in_calendar_tooltip)||r))))}),[h,u,r,s]),S=(0,i.useCallback)((()=>{const e=t.collectionViewStore(),o=t.collectionStore(),r=null==o?void 0:o.getParentBlockStore();e&&o&&r&&d&&(Fu.QK(a,{is_calendar_connected:p,collection_id:o.id,collection_view_id:e.id,collection_view_block_id:r.id}),Lu.sh({environment:a,collectionViewStore:e,spaceStore:d,from:"openInCalendarButton"}))}),[a,t,d,p]),g=(0,i.useCallback)((()=>{r?l(!0):u&&Lu.Bm({environment:a,userSettingsStore:u,transactionUserAction:"OpenInCalendarTooltip.dismiss"})}),[a,r,u]),C=(0,i.useCallback)((()=>{n(!0),u&&Lu.Bm({environment:a,userSettingsStore:u,transactionUserAction:"OpenInCalendarTooltip.connectCalendar"}),S(),requestAnimationFrame((()=>{l(!1)}))}),[a,u,S]),f=(0,re.yK)((e=>({button:{marginRight:8,paddingRight:12,fontSize:14,fontWeight:500,height:26},calendarIcon:{marginLeft:4},calendarIconSvg:{fill:e.timelineRed}})),[]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Nu.Z,{ref:o,style:f.button,iconStyle:f.calendarIconSvg,icon:e=>(0,v.jsx)(Au.Z,{style:{...e,...f.calendarIcon}}),onClick:S,children:(0,v.jsx)(j.FormattedMessage,{id:"openInNotionCalendarButton.label",defaultMessage:"Open in Calendar"})}),m&&(0,v.jsx)(Bu.P,{calloutId:"open_in_calendar_tooltip",children:(0,v.jsx)(Zu,{variant:r||p?"success":"default",origin:o,onCloseClick:g,onConnectCalendarClick:C})})]})}function zu(e){window.__c={n:"MaybeOpenInNotionCalendarButton"};const t=(0,oe.O7)();return(0,c.VK)((()=>(0,Iu.ZH)({environment:t})),[t])?(0,v.jsx)(Hu,{...e}):null}var Gu=o(15723),Ku=o(17746),Uu=o(50628),Wu=o(53876);class $u extends Mo.Z{activate(){const e=function(e,t){const{mainEditorCurrentBlockStore:o}=Lo.default.state;return le.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}(this.props.store,this.props.collectionContextStore);e&&(this.props.handleOpenPeekPage(),G.c4({environment:this.environment,url:e}))}didMount(){this.props.collectionContextStore.onItemMount()}renderComponent(){return(0,v.jsx)(Qu,{...this.props})}}$u.displayName="CalendarItem";const qu=$u;function Qu(e){window.__c={n:"CalendarItemFn"};const{store:t,row:o,schema:r,format:i,disabled:n,calendarBy:s,collectionContextStore:l,includeTime:a,resultsStore:d,handleOpenPeekPage:u,blockPropertyValueOverlayStore:p,calendarStore:h}=e,m=(0,oe.O7)(),S=r[s],g=(0,c.VK)((()=>!n&&"date"===(null==S?void 0:S.type)&&!l.permissionScopes.state.isSyncedCollection),[l.permissionScopes,n,null==S?void 0:S.type]),{start:C,end:f,startOfWeek:y,endOfWeek:x,startColumn:b,columnCount:w}=(0,ju.du)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),k=(0,c.VK)((()=>{const e=i.calendar_properties?i.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[],o=e.filter((e=>ao.XU({block:t.getModel(),property:e,schema:r,getRecordModel:t.getRecordModel,userId:m.currentUser.id,userTimeZone:(0,Ee.r)(),intl:ze.default.getIntl()})));return o.concat(_.e5(e,o))}),[m.currentUser.id,i.calendar_properties,r,t]),T=(0,c.VK)((()=>(0,Fo.ls)({collectionContextStore:l})),[l]);if(!S||!fe.Lt(S))return null;const V=k.length+1+(T?1:0),O=C<y,P=void 0!==f&&f>x;return(0,v.jsxs)(Yu,{store:t,row:o,numRows:V,columnCount:w,startIsBeforeStartOfWeek:O,endIsAfterEndOfWeek:P,startColumn:b,disabled:n,isEditableDate:g,calendarBy:s,resultsStore:d,handleOpenPeekPage:u,children:[T&&(0,v.jsx)("span",{style:{paddingRight:4,paddingLeft:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,v.jsx)(bo.O,{blockStore:t,collectionContextStore:l})}),(0,v.jsx)(Xu,{store:t,collectionContextStore:l,disabled:n,start:C,startOfWeek:y,end:f,endOfWeek:x,includeTime:a,columnCount:w,propertySchema:S}),(0,v.jsx)(ep,{store:t,sortedProperties:k,startIsBeforeStartOfWeek:O,disabled:n,blockPropertyValueOverlayStore:p}),g&&(0,v.jsx)(tp,{store:t,start:C,startOfWeek:y,end:f,endOfWeek:x,calendarBy:s,calendarStore:h})]})}function Yu(e){window.__c={n:"CalendarItemWrapper"};const{store:t,children:o,columnCount:r,row:n,numRows:s,startColumn:l,disabled:a,isEditableDate:d,calendarBy:p,resultsStore:h,handleOpenPeekPage:m,startIsBeforeStartOfWeek:S,endIsAfterEndOfWeek:g}=e,C=(0,oe.O7)(),f=(0,Ui.Y$)(),y=(0,c.VK)((()=>le.Sc(t)),[t]),x=s*Wu.ch+2*pp+2*hp,b=up+x*n,w=(0,c.VK)((()=>Vr.Z.state.hoveredStore===e.store),[e.store]),k=(0,re.yK)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:S?0:6,paddingRight:g?0:6,width:g?`calc(100% / 7 * ${r} - 1px)`:`calc(100% / 7 * ${r})`,left:`calc(100% / 7 * ${l})`,height:x,top:b},haloStyle:{...le.pB(y,e),borderRadius:5,marginTop:2,marginBottom:2,marginLeft:S?0:5,marginRight:g?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomLeftRadius:4,borderBottomRightRadius:4,boxShadow:e.lightBoxShadow,...g&&{borderTopRightRadius:0,borderBottomRightRadius:0},...S&&{borderTopLeftRadius:0,borderBottomLeftRadius:0}},linkBoxHoveredStyle:{opacity:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[r,g,x,y,l,S,b]),_=(0,i.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?D.QG({environment:C,collectionStore:o,collectionContextStore:f,store:t,insertStores:e.insertStores,calendarBy:p,transaction:e.transaction,results:h.state}):[]}),[p,f,C,h,t]),T=(0,i.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&L.Od({store:t,transaction:o})}),[t]),[V,O]=(0,c.VK)((()=>{const{mainEditorCurrentBlockStore:e}=Lo.default.state,o=le.mb({store:t,mainEditorCurrentBlockStore:e,collectionContextStore:f,fullyQualified:!1});return[(0,Bo.ZP)({store:t,fullyQualified:!1,pageVisitSource:u.tY.LinkInPage}),o]}),[f,t]),P=(0,c.VK)((()=>f.isCompactView.state),[f]);return(0,v.jsx)(It.Z,{store:t,style:k.selectable,canSelect:!a,shouldShowHalo:!P,shouldForceRenderSelectionHalo:y,haloStyle:k.haloStyle,canTriggerContextMenu:!a,showBlockMenuInput:!0,canDrag:d,onInsertAbove:_,onInsertBelow:_,onRemove:T,canInsertAbove:d,canInsertBelow:d,analyticsName:"calendar",shouldShowDropZone:!0,className:ro.K4T,children:(0,v.jsx)(To.Z,{style:k.linkBoxStyle,hoveredStyle:k.linkBoxHoveredStyle,pressedStyle:k.linkBoxHoveredStyle,innerStyle:k.linkBoxInnerStyle,onClick:m,href:V,metaHref:O,hovered:w,children:o})},t.id)}function Xu(e){window.__c={n:"CalendarItemTitleRow"};const{store:t,collectionContextStore:o,disabled:n,start:s,startOfWeek:l,end:a,endOfWeek:d,includeTime:u,columnCount:p,propertySchema:h}=e,m=(0,oe.O7)(),S=s<l,g=a&&a>d,C=(0,c.VK)((()=>(0,Fo.wI)({collectionContextStore:o,blockStore:t})),[o,t]),f="time_format"in h?h.time_format:Vu.c_,[y,x,b]=(0,c.VK)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),w=(0,i.useCallback)((e=>{const o=t.getIconStore();o&&Q.createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:m,perform:t=>{go.sO({store:o,value:e,transaction:t})}})}),[m,t]),k=(0,re.yK)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...S&&{paddingLeft:12},...g&&{paddingRight:11},width:u?100/p+"%":"100%"},titleInner:{display:"flex",alignItems:"center",height:24},titleTextStyle:{flexGrow:1,fontSize:14,fontWeight:R.Z.fontWeight.semibold},recordIconStyle:{flexShrink:0,marginRight:4,marginTop:2},iconWarningStyle:{marginLeft:1,marginRight:5,width:10,fill:e.accentColors.orange[500]},subitemCountIndicatorContainer:{paddingLeft:8,paddingRight:4,fontWeight:R.Z.fontWeight.medium,color:e.lightTextColor,display:"flex",alignItems:"center"},timeStyle:{color:e.mediumTextColor,flexShrink:0,fontSize:10,marginLeft:4,height:14},endTimeStyle:{marginLeft:"auto",paddingLeft:4,marginRight:4,color:e.mediumTextColor,fontSize:10,whiteSpace:"nowrap",marginTop:-1},endTimeAbsoluteStyle:{position:"absolute",right:4,top:6}})),[p,g,u,S]),_=u&&a&&r.Xp.fromDateTimes(l,d).contains(a)&&s.day!==a.day,T=(0,c.VK)((()=>o.shouldShowPageIcon()&&(void 0!==y||!x)&&!b),[o,y,x,b]);return(0,v.jsx)("div",{style:k.titleContainer,children:(0,v.jsxs)("div",{style:k.titleInner,children:[T&&(n?(0,v.jsx)(Vo.Z,{disabled:!0,icon:y,isEmptyPage:x,size:14,style:k.recordIconStyle}):(0,v.jsx)(Vo.Z,{disabled:!1,store:t,bucket:"secure",icon:y,isEmptyPage:x,size:14,style:k.recordIconStyle,onChange:w})),b&&(0,po.t)(k.iconWarningStyle),(0,v.jsx)(Wa.Z,{style:k.titleTextStyle,store:t,enableHover:!0}),(0,v.jsx)(Ju,{store:t}),C&&(0,v.jsx)("div",{style:k.subitemCountIndicatorContainer,children:(0,v.jsx)(wo.B,{blockStore:t,collectionContextStore:o})}),u&&r.Xp.fromDateTimes(l,d).contains(s)&&(0,v.jsx)("div",{style:k.timeStyle,children:(0,Ou.xE)({dateTime:s,humanReadable:!1,timeFormat:f})}),_&&(0,v.jsx)("div",{style:{...k.endTimeStyle,...p>1?k.endTimeAbsoluteStyle:void 0},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"ends {endTime}",id:"calendarItem.endsTime.message",values:{endTime:(0,Ou.xE)({dateTime:a,humanReadable:!1,timeFormat:f})}})})]})})}function Ju(e){window.__c={n:"DiscussionIndicator"};const{store:t}=e,o=(0,re.Fg)(),r=(0,c.VK)((()=>Do.Xp(t,{recursivelyLoadAllDiscussions:!1})),[t]);return 0===r?null:(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center",color:o.lightTextColor,fontSize:12,marginLeft:4,flexShrink:0},children:[(0,uo.z)({width:12,height:12,marginRight:4,fill:o.mediumIconColor}),r]})}function ep(e){window.__c={n:"CalendarItemPropertiesRows"};const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:r,disabled:i,blockPropertyValueOverlayStore:n}=e,s=(0,Ui.Y$)(),l=(0,c.VK)((()=>s.permissionScopes.state.isLocked),[s.permissionScopes]),[a,d]=(0,c.VK)((()=>[le.Bm({store:t,collectionContextStore:s}),s.collectionViewStore()]),[t,s]);return a?(0,v.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...r&&{paddingLeft:12}},children:o.map((e=>(0,v.jsx)(vo.Z,{store:t,property:e,disabled:i,locked:l,format:yo.C.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n,collectionStore:a,collectionViewStore:d},e)))}):null}function tp(e){window.__c={n:"CalendarItemDraggables"};const{store:t,calendarStore:o,start:r,startOfWeek:n,end:s,endOfWeek:l,calendarBy:a}=e,c=(0,oe.O7)(),d=(0,re.yK)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),u=(0,i.useCallback)((e=>{D.td({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:a})}),[o,a]),p=(0,i.useCallback)((()=>{Q.createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:c,perform:e=>{D.fX({environment:c,transaction:e,calendarStore:o,calendarBy:a})}})}),[a,o,c]),h=(0,i.useCallback)((()=>{D.cQ({calendarStore:o})}),[o]),m=r>n&&(0,v.jsx)(xl.Z,{render:e=>(0,v.jsx)("div",{style:d.leftDragHandle,...e}),onDraggableDragStart:()=>{D.f$({calendarStore:o,target:t,direction:Ku.t.Left})},onDraggableDragMove:u,onDraggableDragEnd:p,onDraggableDragCancel:h}),S=(!s||s&&s<l)&&(0,v.jsx)(xl.Z,{render:e=>(0,v.jsx)("div",{style:d.rightDragHandle,...e}),onDraggableDragStart:e=>{D.f$({calendarStore:o,target:t,direction:Ku.t.Right})},onDraggableDragMove:u,onDraggableDragEnd:p,onDraggableDragCancel:h});return(0,v.jsxs)(v.Fragment,{children:[m,S]})}const op={height:28,width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",color:ve.ZP.white,background:ve.ZP.red,marginLeft:"auto",marginRight:"auto"},rp={height:28,display:"flex",alignItems:"center",justifyContent:"center"},ip={width:"100%",height:44,borderRadius:4},np={position:"absolute",fontSize:14,top:4,right:10,height:24,lineHeight:"24px",textAlign:"right",transition:"color 100ms ease-out"},sp={position:"relative",display:"flex"},lp={},ap={height:74},cp={height:66},dp={position:"relative",paddingLeft:1,height:"100%"},up=30,pp=2,hp=3;class mp extends Mo.Z{constructor(){super(...arguments),this.headerEl=void 0,this.root=void 0,this.verticalScrollableAncestor=void 0,this.storeTypes={calendarStore:Ku.Z,resultStore:d.default.createClass(void 0)},this.handleHeaderMount=e=>{this.headerEl=e},this.handleScroll=()=>{if(!this.headerEl)return;if(!fp(this.props.collectionContextStore,this.props.isFullScreen,this.environment))return;const{calendarStore:e}=this.stores,t=e.state,o=this.headerEl.getBoundingClientRect();let r=[];t.dayStoreMap.forEach(((e,t)=>{r.push({store:e,timestamp:t})})),r=_.MR(r,(e=>{let{timestamp:t}=e;return t}));const i=r.find((e=>{let{store:t}=e;const r=da.C.getRectFromStore(t);return Boolean(r&&r.top<=o.top+o.height&&r.top+r.height>=o.top+o.height)}));if(i){const o=(0,Pu.kl)((0,Pu.Xz)({date:(0,Pu.V7)(i.timestamp,Pr.AK.state),daysToAdd:1}));o!==t.startingMonth&&e.setState({...e.state,startingMonth:o})}},this.handleScrollThrottled=_.P2(this.handleScroll,100),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=e=>function(e,t){const o=t.state;if(!o.isDragging&&!Eo.Z.state){const r=function(e,t,o){W.Ch();const{dayStoreMap:r}=o.state,{selectableRectMap:i}=Uu.Z.state,n=Array.from(r.keys()),s=Array.from(r.values());for(const[l,a]of i.entries())if(a&&Gu.uh(a,e,t)&&s.indexOf(l.props.store)>=0)return n.find((e=>r.get(e)===l.props.store))}(e.clientX,e.clientY,t);o.hoveredDay!==r&&t.setState({...o,hoveredDay:r})}}(e,this.stores.calendarStore),this.handleMouseMoveThrottled=_.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,50),this.handleTodayClick=()=>{const e=gp(this.props.collectionContextStore),t="month"===e?(0,Pu.IS)((0,Pu.kl)(Date.now()),Pr.AK.state):(0,Pu.IS)(Date.now(),Pr.AK.state);this.setNewCalendarStart(t,e)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleOpenPeekPage=()=>function(e,t,o){yr.default.mark("collections.open_item_page_lag");const r=t.collectionViewStore();H.Xd({collectionContextStore:t,resultsStore:o});const i=null==r?void 0:r.getFormat().collection_peek_mode,n=i||Rr.Ls.calendar;Or.hy(e,{is_peek:!0,from:"calendar",peek_mode:n})}(this.environment,this.props.collectionContextStore,this.sortedResultsStore),this.startOfWeekSettingStore=this.createComputedStore((()=>{const{currentUserSettingsStore:e}=Lo.default.state;if(!e)return 0;const t=e.getSettings();return null!=t&&t.start_day_of_week?t.start_day_of_week:0}),!0),this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,ju.Ft)({collectionContextStore:e})}),!0),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return[];const o=this.stores.resultStore.state;return o?o.blockIds.map((e=>ge.G.createChildStore(t,{id:e,table:V.iU}))):[]}),!0),this.weeksStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=ze.default.getIntl();return(0,ju.y$)({collectionContextStore:e,results:this.resultsStore.state,getRecordValue:this.getRecordValue,intl:t})}),!0),this.sortedResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return o&&(null===(e=this.weeksStore.state)||void 0===e?void 0:e.flatMap((e=>e.items.map((e=>ge.G.createChildStore(o,{table:V.iU,id:e.id}))))))||[]}),!0),this.isTypedMSVCollection=this.createComputedStore((()=>"collectionTypedView"===this.props.collectionContextStore.contextType)),this.getRecordValue=this.props.store.getRecordValue}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const{collectionContextStore:t}=e;this.handleMount(t),Pr.AK.addListener((()=>{this.handleMount(this.props.collectionContextStore)}))}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e),Eo.Z.state&&(this.stores.calendarStore.state.isDragging||this.stores.calendarStore.setState({...this.stores.calendarStore.state,hoveredDay:void 0}));const{query:t}=e;t.calendar_by||function(e,t,o){const{schema:r}=e,i=t.permissionScopes.state,n=ze.default.getIntl(),s=t.collectionStore();if(!s)return;const l=t.collectionViewStore();if(!l||!i.canConfigureBlock)return;Q.createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:o,perform:e=>{let t,a=le.PD(r);if(!a&&i.canConfigureCollection){a=(0,Zd.ZP)();t={[a]:{name:n.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}pe.Es({collectionViewStore:l,update:{calendar_by:a},transaction:e}),go.sW({store:l,data:{type:"calendar"},transaction:e}),t&&pe.xO({environment:o,collectionStore:s,update:t,transaction:e})}})}(e,this.props.collectionContextStore,this.environment)}didMountOrUpdate(){this.handleScrollThrottled(),this.root||(this.root=n.findDOMNode(this),this.root&&(this.verticalScrollableAncestor=(0,Se.VW)(this.root),this.verticalScrollableAncestor&&Sr.lj(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),Sr.lj(this.root,"mousemove",this.handleMouseMoveThrottled)))}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&Sr.ZV(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),this.root&&Sr.ZV(this.root,"mousemove",this.handleMouseMoveThrottled)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):G.c4({environment:this.environment,url:e})}renderPersisted(){const{device:e}=this.environment,{store:t,paddingBottom:o,paddingLeft:r,paddingRight:i,query:n,schema:s,collectionContextStore:l,isFullScreen:a}=this.props,{calendar_by:c}=n;if(!c)return(0,v.jsx)(Cp,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight});const d=s[c];if(!d||!fe.Lt(d))return(0,v.jsx)(Cp,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight});const u=this.reducerStore.state;if(!u)return;const p=gp(l),h=l.isCompactView.state;return(0,gr.Z)((n=>(0,v.jsx)(Ke.Z,{id:"calendar_results",resultStore:this.stores.resultStore,collectionContextStore:l,reducer:u,render:()=>(0,v.jsx)(ii,{isFullScreen:a,children:(0,v.jsx)(an.Z,{onChange:e=>function(e,t,o,r){const i=t.isLoading.state,n=fp(t,o,r);if(e<no.Z.incrementScrollOffset&&!i&&n){const e=t.dateRangeStart.state,o=t.dateRangeEnd.state,r=(0,Pu.V7)((0,Pu._)({date:o,monthsToAdd:2}),Pr.AK.state);pe.t5({dateRangeStart:e,dateRangeEnd:r,collectionContextStore:t})}}(e,this.props.collectionContextStore,this.props.isFullScreen,this.environment),children:(0,v.jsx)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth,height:"100%"},className:ro.c7X,children:(0,v.jsxs)(It.Z,{style:dp,store:t,shouldShowHalo:!a&&!h,canSelect:!a,onMouseDown:e=>function(e,t,o){const{device:r}=o,{target:i}=e;!r.isPhone&&i instanceof HTMLElement&&(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),z.AI({environment:o,target:i,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[t],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}(e,this.props.store,this.environment),analyticsName:"calendar",...n,children:[this.renderHeader(wp(this.environment,this.props.collectionContextStore,this.props.isFullScreen,this.stores.calendarStore),p),h?(0,v.jsx)(vt,{style:{height:"calc(100% - 66px)"},children:this.renderCalendarBody()}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:e.isPhone?ap:cp}),this.renderCalendarBody()]})]})})})})})))}renderHeader(e,t){const{device:o}=this.environment,{collectionContextStore:r}=this.props,i=ze.default.getIntl(),n=r.isCompactView.state;return(0,v.jsx)(Mt,{position:ft(n),children:(0,v.jsxs)("div",{style:o.isPhone?(s=this.theme,{position:"absolute",left:0,right:0,background:s.contentBackground,zIndex:M.VT}):vp(this.props.collectionContextStore,this.props.isInPeekRenderer,this.theme),ref:this.handleHeaderMount,children:[(0,v.jsxs)("div",{style:{display:"flex",height:42,alignItems:"center",marginBottom:2},children:[(0,v.jsx)("div",{style:{fontWeight:R.Z.fontWeight.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:o.isPhone?16:14},children:kp(t,e,Tu.SP,this.weeksStore)}),(0,v.jsx)("div",{style:{flexGrow:1}}),(0,v.jsx)(zu,{collectionContextStore:r}),(0,v.jsx)(jt.Z,{ariaLabel:i.formatMessage({id:"database.calendarView.previousMonthButton.label",defaultMessage:"Previous Month"}),mobileFeedback:o.isMobile,icon:Ru.f,onClick:()=>this.handleCalendarClick("left",r)}),(0,v.jsx)(Xe.Z,{isSmall:!0,onClick:this.handleTodayClick,children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Today",id:"database.calendarView.todayButton.label"})}),(0,v.jsx)(jt.Z,{ariaLabel:i.formatMessage({id:"database.calendarView.nextMonthButton.label",defaultMessage:"Next Month"}),mobileFeedback:o.isMobile,icon:Mu.o,onClick:()=>this.handleCalendarClick("right",r)})]}),(0,v.jsx)("div",{style:{display:"flex",marginTop:o.isPhone?8:0,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`},className:ro.GNl,children:(0,Ou.kv)(Pr.AK.state,Tu.SP).map((e=>{let[t,o]=e;return(0,v.jsx)("div",{style:yp(this.theme),children:o},t)}))})]})});var s}renderCalendarBody(){var e,t;const{device:o}=this.environment,{query:r,schema:i,collectionContextStore:n}=this.props,{calendar_by:s}=r;if(!s)return null;const l=i[s];if(!l)return null;const a=(void 0===(null===(e=this.stores.resultStore.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=this.stores.resultStore.getState())||void 0===t?void 0:t.blockIds.length))&&Wt({collectionContextStore:n,groupsPointer:[],hasPartialResults:!1}),c=gp(n),d=this.weeksStore.state;return(0,v.jsx)("div",{style:o.isPhone?lp:(u=this.theme,{boxShadow:`-1px 0 0 ${u.tableDividerColor}`,marginTop:1,overflow:"hidden"}),children:d&&d.map((e=>o.isPhone?this.renderMobileWeek(e.start,e.items,s,c,a):this.renderWeek(e.start,e.end,e.items,s,l,c,a)))});var u}renderWeek(e,t,o,r,i,n,s){const{collectionContextStore:l,format:a,schema:c,blockPropertyValueOverlayStore:d}=this.props,u=l.collectionViewStore();if(!u)return;const p=this.canEditCalendar(),{calendarStore:h}=this.stores,m=h.state,S=[...Array(7).keys()].map((t=>this.renderDay(t,(0,Pu.Xz)({date:e,daysToAdd:t}),r,i,n,s))),g=[];let C=0;for(const k of o){const o=ge.G.createChildStore(u,{table:V.iU,id:k.id});m.isDragging&&m.target===o&&m.temporaryValue||g.push((0,v.jsx)(qu,{collectionContextStore:l,store:o,startOfWeek:e,endOfWeek:t,start:k.start,end:k.end,row:k.row,includeTime:k.includeTime,format:a,schema:c,calendarBy:r,disabled:!p,calendarStore:h,blockPropertyValueOverlayStore:d,resultsStore:this.resultsStore,handleOpenPeekPage:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleOpenPeekPage},o.id)),k.row>C&&(C=k.row)}const f=m.isDragging&&m.temporaryValue&&(0,Pu.Y_)(m.temporaryValue,(0,Ee.r)());if(m.isDragging&&m.temporaryValue&&f&&(0,Vu.b8)(e,t,f.start,f.end)){const{target:i,temporaryValue:n}=m,s=o.find((e=>e.id===i.id));g.push((0,v.jsx)(qu,{collectionContextStore:l,store:i,startOfWeek:e,endOfWeek:t,start:f.start,end:f.end,row:s?s.row:0,includeTime:"datetime"===n.type||"datetimerange"===n.type,format:a,schema:c,calendarBy:r,disabled:!p,calendarStore:h,blockPropertyValueOverlayStore:d,resultsStore:this.resultsStore,handleOpenPeekPage:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleOpenPeekPage},i.id))}const y=(a.calendar_properties?a.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).length+1+((0,Fo.ls)({collectionContextStore:l})?1:0),x="week"===n?372:124,b=Wu.ch*y+2*pp+2*hp,w=Math.max((C+1)*b+up+4,x);return(0,v.jsxs)("div",{style:{...sp,height:w},children:[S,g]},e.toString())}renderDay(e,t,o,r,i,n){const{store:s,collectionContextStore:l}=this.props,{calendarStore:a}=this.stores,{dayStoreMap:c}=a.state,d=ze.default.getIntl(),u=a.state,p="date"===r.type,h=l.shouldAllowNewItemCreation();let m=c.get(t);m||(m=new ge.G(this.environment,s.pointer,{userId:s.userId,inMemoryRecordCache:s.inMemoryRecordCache}),c.set(t,m));const S=!u.isDragging&&u.hoveredDay===t,g=(0,Pu.Bn)({firstDate:t,secondDate:wp(this.environment,this.props.collectionContextStore,this.props.isFullScreen,this.stores.calendarStore)}),C=(0,Pu.Y3)(t),f=(0,Pu.LY)(t),y=!g&&!C&&"week"!==i,x=d.formatMessage({defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"});return(0,v.jsxs)(It.Z,{style:f?(b=this.props.isInPeekRenderer,w=this.theme,{...xp(w),background:b?w.cardSidebarBackground:w.sidebarBackground}):xp(this.theme),store:m,canDropOnto:this.canEditCalendar()&&p,onSelectableDrop:e=>{Q.createAndCommit({userAction:"Calendar.renderDay",environment:this.environment,perform:r=>{const i=l.collectionStore();if(!i&&"collectionTypedView"!==l.contextType)return;const n=yr.default.mark("collections.drop_item_lag");yr.default.measureAfterNextFlush(n,{environment:this.environment,getData:()=>he.yr({collectionContextStore:l,is_native_drop:!1,is_empty:!1})}),D.JN({...e,environment:this.environment,startOfDay:t,calendarBy:o,collectionStore:i,collectionContextStore:l,results:this.resultsStore.state,transaction:r})}})},onDoubleClick:()=>{if(this.canEditCalendar()&&Ce.M_(this.environment)&&h){const e=this.createBlockInDay(t,o);ue.W(this.environment,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,he.Pn)(l)})}},analyticsName:"calendar_day",shouldShowDropZone:!0,children:[S&&(p||C)&&h&&this.canEditCalendar()&&(0,v.jsx)(et.ZP,{renderTooltip:()=>x,render:e=>(0,v.jsx)(jt.Z,{ariaLabel:x,icon:de.R,showShadow:!0,hasBackground:!0,style:{position:"absolute",top:6,left:6,width:20,height:20},onClick:()=>{if(Ce.M_(this.environment)){const e=this.createBlockInDay(t,o);ue.W(this.environment,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,he.Pn)(l)})}},...(0,Ge.Z)(e,{onMouseDown:me.$0})})}),(0,v.jsx)("div",{style:{...C?bp(this.theme):np,...y&&{color:this.theme.lightTextColor}},className:n?`${ro.irE} notion-shimmer-text animation-delay-${e} notion-shimmer-calendar-transition`:`${ro.irE} notion-shimmer-calendar-transition`,children:1!==(0,Pu.TE)(t)||C?(0,Pu.TE)(t):`${new Intl.DateTimeFormat(d.locale,{month:"short",day:"numeric"}).format(new Date(t))} `})]},t.toString());var b,w}renderMobileWeek(e,t,o,r,i){const n=[...Array(7).keys()].map((n=>{const s=(0,Pu.Xz)({date:e,daysToAdd:n});return this.renderMobileDay(n,s,(0,Pu.us)(s),t,o,r,i)}));return(0,v.jsx)("div",{style:(s=this.theme,{display:"flex",boxShadow:`0 -1px 0 ${s.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}),children:n},e.toString());var s}renderMobileDay(e,t,o,r,i,n,s){const{collectionContextStore:l,query:a,format:c,schema:d,blockPropertyValueOverlayStore:u}=this.props,p=this.canEditCalendar(),h=r.find((e=>(0,Vu.b8)(t,o,e.start,e.end?e.end:void 0))),m=(0,Pu.TE)(t),S=(0,Pu.Bn)({firstDate:t,secondDate:wp(this.environment,this.props.collectionContextStore,this.props.isFullScreen,this.stores.calendarStore)}),g=(0,Pu.Y3)(t),C=!S&&!g&&"week"!==n;return(0,v.jsx)(Ye.ZP,{popupType:Ye.Z4.SlideUp,renderOrigin:t=>{return(0,v.jsxs)(ko.Z,{style:ip,...t,children:[(0,v.jsx)("div",{style:{...g?op:rp,...C&&{color:this.theme.lightTextColor}},className:s?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${e}`:"notion-shimmer-calendar-transition",children:m}),h&&(0,v.jsx)("div",{style:(o=this.theme,{width:8,height:8,background:o.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"})})]});var o},render:e=>(0,v.jsx)(ca.LazyMobileCalendarDayMenu,{collectionContextStore:l,initialStartOfDay:t,format:c,schema:d,query:a,calendarBy:i,disabled:!p,onDismiss:e.close,blockPropertyValueOverlayStore:u,resultsStore:this.resultsStore})},m.toString())}handleCalendarClick(e,t){const o=(0,Pu.V7)(t.dateRangeStart.state,Pr.AK.state),r=gp(this.props.collectionContextStore);if("month"===r){const t="left"===e?-1:1,i=(0,Pu.IS)((0,Pu.kl)((0,Pu._)({date:o,monthsToAdd:t})),Pr.AK.state);this.setNewCalendarStart(i,r)}else{const o="left"===e?-7:7,i=(0,Pu.IS)((0,Pu.Xz)({date:t.dateRangeStart.state,daysToAdd:o}),Pr.AK.state);this.setNewCalendarStart(i,r)}}handleMount(e){const t=e.collectionViewStore();if(!t)return;const o=this.startOfWeekSettingStore.state,r=gp(e),i=Ku.Z.getLocalDateRangeStart({collectionViewId:t.id,currentUserId:this.environment.currentUser.id}),n=(0,Pu.IS)(i,o),s=(0,Pu.IS)((0,Pu.kl)(i),o),l="month"===r?s:n;this.stores.calendarStore.setState({...this.stores.calendarStore.state,startingMonth:s.valueOf()}),this.setNewCalendarStart(l,r)}createBlockInDay(e,t){const{collectionContextStore:o}=this.props,{mainEditorCurrentBlockStore:r}=Lo.default.state,{performResult:i}=Q.createAndCommit({userAction:"Calendar.createBlockInDay",environment:this.environment,perform:i=>{const n=this.isTypedMSVCollection.state,s=L.IW({environment:this.environment,collectionContextStore:o,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"calendar"});if(!s)return;D.xD({type:"timestamp",environment:this.environment,store:s.newStore,propertyId:t,timestampMs:e,transaction:i});const l=le.mb({store:s.newStore,mainEditorCurrentBlockStore:r,collectionContextStore:o,showMoveTo:n})??(0,Bo.ZP)({store:s.newStore,pageVisitSource:u.tY.Create});return this.navigate(l),H.Xd({collectionContextStore:o,resultsStore:void 0}),s.newStore}});return i}setNewCalendarStart(e,t){const{collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=fp(this.props.collectionContextStore,this.props.isFullScreen,this.environment),n=Pr.AK.state,s=(0,Pu.V7)(e,n);let l;"month"===t?(l=i?(0,Pu.V7)((0,Pu._)({date:s,monthsToAdd:1}),n):(0,Pu.V7)((0,Pu.RN)(s),n),this.verticalScrollableAncestor&&i&&(this.verticalScrollableAncestor.scrollTop=0)):l=s,function(e,t,o,r){pe.t5({dateRangeStart:e,dateRangeEnd:t,collectionContextStore:o}),r.setState({...r.state,startingMonth:(0,Pu.kl)((0,Pu.V7)(e,Pr.AK.state))})}(e,l,this.props.collectionContextStore,this.stores.calendarStore),(0,Vu.nQ)(e,l,Date.now())?Ku.Z.clearLocalDateRangeStart({collectionViewId:r.id,currentUserId:this.environment.currentUser.id}):Ku.Z.setLocalDateRangeStart({collectionViewId:r.id,currentUserId:this.environment.currentUser.id,dateRangeStart:e})}canEditCalendar(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&(e.canEditContent||"collectionTypedView"===this.props.collectionContextStore.contextType)}}mp.displayName="Calendar",mp.contextTypes={...mr.wK,...s.w};const Sp=mp;function gp(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_view_range").getValue())??"month"}function Cp(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:r,paddingLeft:i,paddingRight:n}=e;window.__c={n:"MissingDateProperty"};const s=t.settingsStore,l=(0,c.VK)((()=>t.permissionScopes.state.canConfigureBlock),[t]);return(0,v.jsx)(uu,{collectionContextStore:t,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:l?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,v.jsx)(du,{onClick:()=>{A.r$({collectionContextStore:t,collectionSettingsStore:s}),A.H4({collectionSettingsStore:s,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"}),style:{paddingLeft:i,paddingRight:n,paddingBottom:o?void 0:r}})}function fp(e,t,o){const{device:r}=o,i="month"===gp(e);return t&&!r.isMobile&&i}function vp(e,t,o){var r;if(e.isCompactView.state)return{};return{position:"absolute",left:0,right:0,background:(null===(r=e.inheritedBlockColorStore.state)||void 0===r?void 0:r.background)||(t?o.cardContentBackground:o.contentBackground),zIndex:M.VT}}function yp(e){return{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,height:24,color:e.lightTextColor}}function xp(e){return{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default"}}function bp(e){return{position:"absolute",fontSize:14,top:4,right:4,height:24,width:24,lineHeight:"24px",borderRadius:"100%",textAlign:"center",color:ve.ZP.white,background:e.calendarTodayBackground}}function wp(e,t,o,r){const i=t.dateRangeStart.state;return fp(t,o,e)||!i?r.state.startingMonth:(0,Pu.kl)((0,Pu.V7)(i,Pr.AK.state))}function kp(e,t,o,r){var i;const n=(0,Ou.Yx)(t,"month_year_long",o);if("month"===e)return n;const s=null==r||null===(i=r.state)||void 0===i?void 0:i[0];if(void 0===s)return"";if((0,Pu.Bn)({firstDate:s.start,secondDate:s.end}))return n;return`${(0,Ou.Yx)(s.start,(0,Pu.Xh)({firstDate:s.start,secondDate:s.end})?"month_short":"month_year_short",o)} - ${(0,Ou.Yx)(s.end,"month_year_short",o)}`}var _p=o(6776);function Tp(e){const{environment:t,newStore:o,previousStore:r}=e;W.eP({environment:t,store:o}),pe.Z5({store:o}),_p.Z.setState({store:o,editMode:"new",previousStore:r})}class Vp extends Mo.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:jo.Z},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:r,collectionContextStore:i}=this.props,n=le.Bm({store:t,collectionContextStore:i});if(!n)return;const s="title"===e&&this.mouseIsEntered.state&&!(0,Pr.YO)(i.isInPeekRenderer.state);return(0,v.jsx)(vo.Z,{store:t,property:e,disabled:o||!t.canEdit(),locked:i.permissionScopes.state.isLocked,format:yo.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:n,collectionViewStore:i.collectionViewStore(),forceMouseEntered:s,showIfEmpty:this.isEditing.state||i.isCompactView.state,onBgClick:()=>Bp(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store),onEnter:()=>Bp(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store),onEsc:()=>Bp(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store),onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,onClick:()=>Ip(this.props.store)},e)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=()=>{return e=this.stores.mouseStore,void(Eo.Z.state||e.setState({...e.state,mouseEntered:!0}));var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave=()=>{var e;(e=this.stores.mouseStore).setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=_.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,100),this.handleMouseLeaveDebounced=_.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave,100),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered)),this.isEditing=this.createComputedStore((()=>{const e=Ao.Z.state;return Boolean(e.isActive&&e.store.id===this.props.store.id)})),this.newItemEditMode=this.createComputedStore((()=>{const e=_p.Z.state;return e.store&&e.store.id===this.props.store.id?e.editMode:void 0})),this.handleBlockPropertyTab=()=>{Fp(this.findNextOpenableProperty(),this.props.store,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.environment)},this.handleBlockPropertyUntab=()=>{Fp(this.findPreviousOpenableProperty(),this.props.store,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.environment)},this.shouldCaptureKeyboard=this.createComputedStore((()=>zo.default.state.stores.length>0&&zo.default.state.stores[0].id===this.props.store.id))}activate(){const e=Rp(this.props.store,this.props.collectionContextStore);e&&(this.props.handleOpenPeekPage(),G.c4({environment:this.environment,url:e}))}didMount(){super.didMount(),this.isEditing.state&&"new"===this.newItemEditMode.state&&q.NX({store:this.props.store.getBlockTitleStore()})}willUnmount(){super.willUnmount(),_p.Z.reset(),Ao.Z.reset()}renderComponent(){const{device:e}=this.environment,{showProperties:t}=this.props,o=e.isPhone&&this.props.showProperties.length>0,r=(0,v.jsx)(jp,{collectionContextStore:this.props.collectionContextStore,toggleButton:this.props.toggleButton,subitemPath:this.props.subitemPath});if(o){const e=t.indexOf("title"),[o,i]=[t.slice(0,e+1),t.slice(e+1)];return(0,v.jsxs)("div",{style:{display:"flex"},children:[r,(0,v.jsxs)(To.Z,{href:Mp(this.props.store),metaHref:Rp(this.props.store,this.props.collectionContextStore),external:!1,style:(n=this.theme,{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${n.tableDividerColor}`}),innerStyle:{paddingLeft:4,paddingRight:4,marginTop:10,marginBottom:10},children:[(0,v.jsx)("div",{style:{display:"flex",alignItems:"center"},children:o.map(this.renderProperty)}),(0,v.jsx)("div",{style:{display:"flex",alignItems:"center",paddingLeft:6,marginTop:4},children:i.map(this.renderProperty)})]})]})}return(0,v.jsx)(_o.Z,{debugName:"CollectionListViewItem",capture:this.shouldCaptureKeyboard.state,onShiftEnter:this.props.onShiftEnter,children:(0,v.jsxs)("div",{style:{display:"flex"},children:[r,(0,v.jsx)(To.Z,{href:Mp(this.props.store),metaHref:Rp(this.props.store,this.props.collectionContextStore),altHref:Rp(this.props.store,this.props.collectionContextStore),onClick:()=>function(e,t){Ip(e),t()}(this.props.store,this.props.handleOpenPeekPage),external:!1,style:(i=this.isEditing.state?"multi":"single",{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:4,..."single"===i?{height:30}:{minHeight:30}}),innerStyle:{display:"flex",alignItems:"center",paddingLeft:4,paddingRight:4,userSelect:this.isEditing.state?void 0:"none",WebkitUserSelect:this.isEditing.state?void 0:"none"},hoveredStyle:{background:this.isEditing.state?"transparent":this.theme.buttonHoveredBackground},pressedStyle:{background:this.isEditing.state?"transparent":this.theme.buttonPressedBackground},onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,children:t.map(this.renderProperty)})]})});var i,n}findPreviousOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=t.isOpen?t.property:"title",r=this.getNonEmptyProperties(),i=r.findIndex((e=>e===o)),n=_.dF(r,((e,t)=>t<i&&Pp(e,this.props.schema)));return n||(this.isEditing.state?"title":function(e,t){return _.dF(e,(e=>Pp(e,t)))}(r,this.props.schema))}findNextOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=t.isOpen?t.property:"title",r=this.getNonEmptyProperties(),i=r.findIndex((e=>e===o)),n=r.find(((e,t)=>t>i&&Pp(e,this.props.schema)));return n||(this.isEditing.state?"title":function(e,t){return e.find((e=>Pp(e,t)))}(r,this.props.schema))}getNonEmptyProperties(){const{store:e,schema:t,showProperties:o}=this.props;return e.isDefined()?o.filter((o=>{const r="title"!==o&&this.isEditing.state;return!Kt.wV({property:o,schema:t,block:e.getModel(),getRecordModel:e.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,Ee.r)(),intl:ze.default.getIntl()})||r})):[]}}Vp.displayName="CollectionListViewItem";const Op=Vp;function Pp(e,t){const o=t[e];return Boolean(o&&!fe.uk.includes(o.type))}function Rp(e,t){const{mainEditorCurrentBlockStore:o}=Lo.default.state;return le.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}function Mp(e){return(0,Bo.ZP)({store:e,fullyQualified:!1,pageVisitSource:u.tY.LinkInPage})}function jp(e){let{collectionContextStore:t,toggleButton:o,subitemPath:r}=e;window.__c={n:"ToggleButton"};const i=(0,c.VK)((()=>t.currentSubitemFormatStoreForUiDisplay.state),[t]),n=(null==r?void 0:r.length)??0;if(!i)return null;const s=Math.max((n-1)*Fo.Hw,0)+Fo.gY;return o?(0,v.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,v.jsx)("div",{style:{width:s}}),o]}):(0,v.jsx)("div",{style:{minWidth:s+Fo.Hw}})}function Ip(e){pe.IH({store:e})}function Fp(e,t,o,r,i){if("title"===e){mo.xv({environment:i,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();W.eP({environment:i,store:t}),pe.Z5({store:t}),q.NX({store:e})}else e?(mo.xv({environment:i,blockPropertyValueOverlayStore:o}),mo.bA({environment:i,blockPropertyValueOverlayStore:o,store:t,property:e,format:yo.C.ListView,collectionContextStore:r})):mo.xv({environment:i,blockPropertyValueOverlayStore:o});Ip(t)}function Bp(e,t,o){mo.xv({environment:e,blockPropertyValueOverlayStore:t}),W.Ys({environment:e,store:o}),Ip(o)}function Np(){return{marginTop:1,marginBottom:1,borderRadius:4}}const Dp=i.memo((function(e){let{groupFormat:t,store:o,format:r,disabled:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:a}=e;const d=(0,oe.O7)(),u=(0,i.useMemo)((()=>t?[t]:[]),[t]),p=(0,i.useMemo)((()=>(r.list_properties?r.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[r]),{permissionScopes:h}=(0,c.VK)((()=>({permissionScopes:s.permissionScopes.state})),[s]),m=(0,c.VK)((()=>s.groupsStore.getGroupState(u)),[u,s]),S=(0,c.VK)((()=>!n&&o.canEdit()&&h.canEditContent&&!h.isSyncedCollection),[n,o,h]),g=(0,i.useCallback)((()=>{if(!m)return;const e=s.collectionStore();if(!e||!s.shouldAllowNewItemCreation())return;const t=zo.default.state.stores[0];if(!t)return;const o=s.subitemTreeStore.state,r=(0,kr.DY)(o.children,(e=>e.value.store===t));if(!r)return;const i=r?(0,Fo.Af)(r.map((e=>e.value.store))):"",n=s.subitemExpandedStore.state.get(i),l=Boolean(null==n?void 0:n.isExpanded);Q.createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:d,perform:o=>{const i=L.yk({environment:d,collectionContextStore:s,groupsPointer:m.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:l?"into":"below",from:"list_selection_overlay_shift_enter"});i&&Tp({environment:d,newStore:i,previousStore:t})}}),I.sd(d,"list_item_edit_mode_enter",{...(0,he.Pn)(s),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[s,d,m]),C=(0,i.useCallback)(((e,t)=>{Tp({environment:d,newStore:t,previousStore:e})}),[d]),f=(0,i.useMemo)((()=>({schema:l,collectionViewBlockStore:o,showProperties:p,disabled:n,blockPropertyValueOverlayStore:a,collectionContextStore:s,onShiftEnter:g})),[a,s,n,g,l,p,o]),y=(0,i.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:r,indentLevel:i}=e;if(o)return(0,v.jsx)(Qn,{store:t,collectionStore:o,subitemPath:r,indentLevel:i,collectionContextStore:s,disabled:n,groupsPointer:u,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{pe.Z5({store:e,transient:!1}),_p.Z.setState({store:e,editMode:"new",previousStore:void 0})}})}),[s,n,u]);return m?(0,v.jsx)(Ar,{collectionContextStore:s,groupsPointer:u,format:r,canDrag:S,resultProps:f,canDrop:!0,resultComponent:Op,disabled:n,shouldShowHoverMenu:!0,direction:Dr.Vertical,analyticsName:"list",getItemSelectableStyle:Np,emptyDroppableSize:0,onSelectableInsertRow:C,nestedCreateSubitemButton:y}):null}));function Lp(e){window.__c={n:"ListShimmer"};const{isFullScreen:t,hasGroups:o,hasPartialResults:r,hasSearchQuery:i,overrideNumShimmerRows:n}=e,s=(0,Ui.DK)(),l=(0,c.VK)((()=>null==s?void 0:s.isCompactView.state),[s]);if(!(0,hr.Z)(!0,0,100))return null;let a=1;void 0!==n?a=n:o||r||i||(a=t?10:3);const d=a>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],u=_.DZ(a).map((e=>(0,v.jsx)(Wi,{widthPercentage:e<d.length?d[e]:void 0},e)));return(0,v.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:l?8:3},children:u})}const Ap=i.memo((function(e){window.__c={n:"CollectionListView"};const t=(0,oe.O7)(),o=(0,re.Fg)(),{store:r,schema:n,format:s,paddingBottom:l,paddingLeft:a,paddingRight:d,isFullScreen:p,isRootChild:h,isInPeekRenderer:m,minWidth:S,disabled:g,collectionContextStore:C}=e,f=(0,c.VK)((()=>le.az(C,p)),[C,p]),y=s.collection_group_by,x=(0,c.VK)((()=>null==C?void 0:C.isCompactView.state),[C]),b=(0,c.VK)((()=>"collectionVirtualView"===(null==C?void 0:C.contextType)),[C]),w=(0,c.VK)((()=>(0,ke.hJ)()),[]),k=(0,i.useCallback)(((e,o,r)=>{!function(e,t,o,r,i){if(r.device.isMobile)ne._({environment:r,store:e,pageVisitSource:u.tY.Create});else if(t)Tp({environment:r,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],s=i.groupsStore.getGroupState(n);se.CH({environment:r,store:e,peekMode:le.kr(i.collectionViewStore()),resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:i,pageVisitSource:u.tY.Create})}}(e,o,r,t,C)}),[t,C]),_=(0,i.useCallback)((t=>w?(0,v.jsx)(on,{reducerId:"list_groups",store:r,collectionContextStore:C,disabled:g,isFullScreen:p,isRootChild:h,paddingLeft:a,stickyLeft:!1,renderGroup:t=>(0,v.jsx)(Kp,{...e,groupFormat:t}),getGroupStyle:e=>Hp(e,o),renderHeader:e=>(0,v.jsx)(zp,{args:e}),onGroupHeaderAddItem:k}):(0,v.jsx)(Gn,{store:r,id:"list_groups",groupBy:t,groupsFormatKey:ie.Uh,groupAggregationKey:ie.dQ,format:s,schema:n,collectionContextStore:C,disabled:g,isFullScreen:p,renderGroup:t=>(0,v.jsx)(Kp,{...e,groupFormat:t}),renderHeader:e=>(0,v.jsx)(zp,{args:e}),getGroupStyle:e=>Hp(e,o),onGroupHeaderAddItem:k,paddingLeft:a,isRootChild:h,isInPeekRenderer:m})),[C,g,s,p,w,m,h,k,a,e,n,r,o]);return(0,gr.Z)((o=>(0,v.jsxs)("div",{style:{paddingBottom:l,paddingLeft:a,paddingRight:d,minWidth:S},className:ro.nM$,children:[(0,v.jsx)(It.Z,{store:r,shouldShowHalo:!p&&!x,canSelect:!p,analyticsName:"list",style:Ep(s,x,b),...o,children:y?_(y):(0,v.jsx)(Kp,{...e,groupFormat:y})}),!f&&(0,v.jsx)(an.Z,{onChange:e=>function(e,t,o,r){const i=o.isLoading.state,n=o.groupsStore.getGroupState([]);if(!n)return;if("collectionVirtualView"===o.contextType)return;const s=n.reducerResultStore.state;e<no.Z.incrementScrollOffset&&s&&!i&&s.hasMore&&L.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,t,C,p)})]})))}));function Ep(e,t,o){return{display:"flex",flexDirection:"column",paddingTop:e.collection_group_by||t||o?void 0:8,paddingBottom:4}}function Zp(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}function Hp(e,t){return 0===e.index?{}:{borderTop:`1px solid ${t.tableDividerColor}`}}function zp(e){let{args:t}=e;window.__c={n:"GroupHeaderComponent"};const{collectionContextStore:o}=t,r=(0,re.Fg)(),i=(0,c.VK)((()=>o.isCompactView.state),[o]);return(0,v.jsx)(Nt,{...t,height:i?io.yZ:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,r)})}function Gp(e,t,o,r,i){if(!Ce.M_(t))return;if(!o.collectionStore())return;const n=o.currentSubitemFormatStoreForUiDisplay.state;Q.createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:t,perform:s=>{o.collectionStore()&&function(e){var t;const{transaction:o,environment:r,results:i,collectionContextStore:n,isFullScreen:s,groupsPointer:l,insertAtIndex:a,from:c,useCrdt:d}=e;n.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:n,isFullScreen:s});const p=null===(t=n.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!p)return;let h;a>0&&(h=i[a]);const m=L.IW({environment:r,collectionContextStore:n,groupsPointer:l,insertAtIndex:a,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:c,useCrdt:d});if(!m)return;const S=m.coercionSucceeded,g=m.newStore;r.device.isMobile?ne._({environment:r,store:g,pageVisitSource:u.tY.Create}):S?Tp({environment:r,newStore:g,previousStore:h}):se.CH({environment:r,store:g,peekMode:(0,le.kr)(n.collectionViewStore()),resultsStore:p,collectionContextStore:n,pageVisitSource:u.tY.Create}),ue.W(r,{from:c,type:"page",new_page_id:g.id,creating_block_id:g.id,...(0,he.Pn)(n)})}({transaction:s,environment:t,results:e.resultsStore.state,collectionContextStore:o,isFullScreen:r,groupsPointer:e.groupsPointer,insertAtIndex:e.resultsStore.state.length,from:n?"list_view_add_parent_item_bottom":"list_view_add_item_bottom",useCrdt:i})}})}const Kp=i.memo((function(e){let{store:t,format:o,schema:r,disabled:n,groupFormat:s,isFullScreen:l,collectionContextStore:a,blockPropertyValueOverlayStore:d}=e;window.__c={n:"RenderGroup"};const u=(0,re.Fg)(),p=void 0!==s,h=(0,i.useMemo)((()=>s?[s]:[]),[s]),m=(0,c.VK)((()=>a.groupsStore.getGroupState(h)),[a,h]),S=(0,c.VK)((()=>null==m?void 0:m.reducerResultStore.state),[m]),g=(0,c.VK)((()=>a.groupsStore.anyGroupHasResults()),[a]),C=(0,c.VK)((()=>{const e=a.permissionScopes.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[a]),f=(0,c.VK)((()=>g&&!n&&t.canEdit()&&C.canEditContent&&!C.isSyncedCollection),[n,g,C.canEditContent,C.isSyncedCollection,t]),y=(0,c.VK)((()=>""!==a.searchQuery.state),[a]),x=(0,c.VK)((()=>a.isCompactView.state),[a]),b=(0,c.VK)((()=>void 0!==S&&(null==S?void 0:S.blockIds.length)>0),[S]),w=(0,c.VK)((()=>Wt({collectionContextStore:a,groupsPointer:h,hasPartialResults:b})),[a,h,b]),k=(0,c.VK)((()=>le.VM({collectionContextStore:a,reducerResult:S,isFullScreen:l})),[a,S,l]);return m?(0,v.jsxs)("div",{style:{paddingBottom:s?x?8:16:void 0},children:[(0,v.jsx)(Dp,{groupFormat:s,store:t,format:o,disabled:n,collectionContextStore:a,schema:r,blockPropertyValueOverlayStore:d}),w&&(0,v.jsx)(Lp,{isFullScreen:l,hasGroups:p,hasPartialResults:b,hasSearchQuery:y,overrideNumShimmerRows:x&&!b?6:void 0}),k&&(0,v.jsx)(qr,{groupsPointer:h,store:t,collectionContextStore:a,format:o,isFullScreen:l,incrementLimitsInRelatedGroups:!1}),f&&(0,v.jsxs)(v.Fragment,{children:[k&&(0,v.jsx)("div",{style:{width:"100%",borderTop:s?void 0:`1px solid ${u.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,v.jsx)(Up,{collectionContextStore:a,isFullScreen:l,groupState:m})]})]}):null}));function Up(e){let{groupState:t,collectionContextStore:o,isFullScreen:r}=e;window.__c={n:"AddItemButtonComponent"};const i=(0,re.Fg)(),n=(0,oe.O7)();return(0,v.jsxs)(ko.Z,{onClick:e=>Gp(t,n,o,r,(0,so.SL)({event:e,source:"collection_non_table_view"})),onMouseDown:me.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,fontSize:14},children:[(0,de.R)(Zp(i)),(0,v.jsx)("div",{style:{color:i.lightTextColor},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.listView.addItemButtonTitle"})})]})}var Wp=o(42239),$p=o(2005);class qp extends d.default{getInitialState(){return{query:"",limit:20}}}const Qp=qp;var Yp=o(11470);const Xp=(0,j.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a pageâ¦",id:"collectionNoDateMenu.searchPlaceholder"}}),Jp=d.default.createClass(void 0);function eh(e){let{collectionStore:t,collectionViewType:o,property:r,collectionContextStore:n,onClose:s,onAddPage:l}=e;window.__c={n:"CollectionNoDateMenu"};const a=(0,oe.O7)(),d=(0,oe.Fy)(),u=(0,c.qz)(void 0,Qp),p=(0,c.qz)(void 0,Jp),h=(0,c.VK)((()=>u.state.query),[u]),m=(0,c.VK)((()=>p.state),[p]),S=(0,c.VK)((()=>{const{query:e,limit:t}=u.state;return{type:"results",filter:{operator:"and",filters:[{property:r,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[r,u]),g=(0,i.useCallback)((e=>{u.setState({query:e.target.value,limit:rh})}),[u]),C=(0,i.useCallback)((e=>{const t=u.state.limit,o=n.isLoading.state;e<oh&&m&&m.hasMore&&!o&&u.setState({...u.state,limit:t+rh})}),[n,m,u]),f=(0,i.useCallback)((()=>{let e;return e="calendar"===o?d.isMobile?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Click to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt.basic"}):(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"}),m?m&&0===m.blockIds.length?(0,v.jsx)(Re.Z,{title:e,children:(0,v.jsx)(Wd.Z,{title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,sections:[{key:"results",render:t=>(0,v.jsx)(Re.Z,{...t,title:e}),items:sh(m.blockIds,t,n,r,l,a,o)}],initialFocus:h?0:void 0}):(0,v.jsx)(Re.Z,{children:(0,v.jsx)(nh,{})})}),[o,m,t,n,r,l,a,h,d.isMobile]);return(0,v.jsxs)($p.Tp,{title:void 0,onCancel:s,desktopWidth:320,children:[(0,v.jsx)(Re.Z,{isInput:!0,children:(0,v.jsx)(Kc.ZP,{placeholder:ze.default.formatMessage(Xp.searchPlaceholder),focus:!d.isMobile||void 0,focusAfterAnimation:!0,value:h,onChange:g})}),(0,v.jsx)(Ke.Z,{id:"no_date_results",reducer:S,collectionContextStore:n,render:f,resultStore:p}),(0,v.jsx)(an.Z,{onChange:C})]})}const th=i.memo(eh,Jt.Z),oh=200,rh=20;function ih(e){let{props:t,store:o,url:r,collectionViewType:n}=e;window.__c={n:"MenuListItemComponent"};const s=(0,oe.O7)(),l=(0,oe.Fy)(),a=i.useRef(null),c=(0,v.jsx)(Yp.Z,{...t,ref:a,store:o,hidePath:!0,right:void 0!==r?(0,v.jsx)(Xe.Z,{isSmall:!0,href:r,onClick:()=>{I.tM(s)},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Open",id:"collectionNoDateMenu.view.button.label"})},o.id):void 0,dontShrinkRight:!0});return"calendar"!==n||l.isMobile?c:(0,v.jsx)(It.Z,{canSelect:!1,canDrag:!0,canEditText:!1,store:o,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[Wp.eN(e.current)]}return[]}(a),analyticsName:"calendar_no_date_item",children:c})}function nh(){return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ei.Z,{style:{display:"flex",height:16,marginTop:4,marginLeft:12,marginRight:12,borderRadius:12,width:"50%"}}),(0,v.jsx)(Ei.Z,{style:{display:"flex",height:16,marginTop:6,marginLeft:12,marginRight:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function sh(e,t,o,r,i,n,s){const l=e.map((e=>ge.G.createChildStore(t,{table:V.iU,id:e}))).filter((e=>!Kt.Gl(e.getPropertyStore(r).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:t}=Lo.default.state;if(!t)return;const r=(0,le.mb)({store:e,mainEditorCurrentBlockStore:t,collectionContextStore:o,fullyQualified:!1});return{key:e.id,render:t=>(0,v.jsx)(ih,{props:t,store:e,url:r,collectionViewType:s}),action:()=>{i(e),I.ze(n)}}}));return _.oA(l)}var lh=o(65669),ah=o(63087),ch=o(29477),dh=o(36054);class uh{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.isServerQueryCollectionRequired=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabled.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const r=Boolean(e&&(0,dh.P9)(ah.y,e)&&e.hasMore);if(o&&!r)return!1;const i=this.collectionContextStore.remoteRequestStore.state;if(!i)return!0;return!!(0,ut.qP)(i.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,dh.P9)(ah.y,e)&&!e.hasMore)},this.throttledRefetch=(0,lh.Z)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;this.reset(),o?this.throttledRefetch({src:e}):F.bW(this.environment),t&&await pe.fI({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=Yt.default.getEligibleGroup({experimentId:"collection_client_refetch_throttle_time_ms",defaultGroup:"control"}),o="control"===t?1e3:parseInt(t);await Promise.all([pe.dj(this.environment,this.collectionContextStore,e),(0,ch.Vs)(o)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:r,isCollectionTypeChange:i}=e;if((0,dh.P9)(ah.y,o)&&null!=o&&o.blockIdToVersion&&(0,ut.qP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequired(o,i),!r)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}}var ph=o(91007),hh=o(70475),mh=o(62967),Sh=o(43664);class gh extends d.default{getInitialState(){return{textStoresBeingEdited:[],lastBlockPropertyValueOverlayCloseTime:void 0}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===to.QaF(o)}))}}const Ch=gh;var fh=o(13966);function vh(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const yh=(0,j.defineMessages)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function xh(e){window.__c={n:"CollectionsBulkActionsToolbar"};const t=(0,Ui.Y$)(),{marginLeft:o}=e,r=(0,oe.O7)(),n=(0,c.qz)(void 0,Ch),s=(0,i.useRef)(null),[l,a]=(0,i.useState)(!1),d=(0,c.VK)((()=>n.state.lastBlockPropertyValueOverlayCloseTime),[n]),u=(0,c.VK)((()=>zo.default.state.stores.filter((e=>_c.R.findBlockFromStore(e)))),[d]),p=u.length,h=(0,c.VK)((()=>n.getNumberOfTextStoresBeingEdited()),[n]),m=(0,c.VK)((()=>{var e;return!!(0,le.fk)({environment:r,collectionContextStore:t})&&(h>0||u.length>=1&&(0,le.v_)(u,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id))}),[t,r,h,u]),S=(0,re.yK)((e=>({inner:{position:"absolute",top:1,left:0+(o??0),display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.lightBoxShadow,height:32},outer:{position:"sticky",top:0,left:0,zIndex:M.mJ,visibility:l?"visible":"hidden"},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...vh(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[l,o]);return(0,v.jsx)(ts.Z,{isVisible:m,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},onAnimationEnd:e=>{e||a(!1)},render:()=>(0,v.jsx)(zd.Z,{capture:!0,render:e=>(0,v.jsx)("div",{ref:s,...e,style:S.outer,children:(0,v.jsx)(Jn.p,{allowSelectionWithin:!1,children:(0,v.jsxs)("div",{style:S.inner,children:[(0,v.jsx)(bh,{selectedItemCount:p,collectionsBulkActionsToolbarStore:n}),(0,v.jsx)(Ph,{collectionsBulkActionsToolbarStore:n,selectedItems:u,marginLeft:o,setIsReadyToRender:a,outerContainerRef:s}),(0,v.jsx)(et.ZP,{renderTooltip:()=>(0,v.jsx)("div",{children:ze.default.formatMessage(yh.delete)}),render:e=>(0,v.jsx)(jt.Z,{...e,ariaLabel:ze.default.formatMessage(yh.delete),icon:()=>(0,be.y)(S.trashButtonIcon),style:S.trashButton,hoveredStyle:S.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{I.dh(r,{analyticsName:mh.RE.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page"}),await kc.Qw({environment:r,blocks:u})}}),placement:et.ug.Top}),(0,v.jsx)(fh.Z,{store:u[0],fadeIn:!1,style:S.blockActionMenuButton,hoveredStyle:S.blockActionMenuButton,iconStyle:S.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0}})]})})})})})}function bh(e){window.__c={n:"SelectedItemCountWidget"};const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,r=(0,oe.O7)(),i=(0,c.VK)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),n=(0,c.VK)((()=>i>0?i:o),[i,o]),s=(0,re.yK)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...vh(e)}})),[]);return(0,v.jsx)(ko.Z,{style:s.button,onClick:()=>W.ZH(r),children:(0,v.jsx)(j.FormattedMessage,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:n}})})}const wh=6,kh=450,_h=2,Th=32,Vh=150,Oh=["title","rollup","formula","button"];function Ph(e){window.__c={n:"EditPropertyButtons"};const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:r,marginLeft:n,setIsReadyToRender:s}=e,l=(0,Ui.Y$)(),a=(0,c.VK)((()=>l.normalizedSchemaStore.state),[l]),d=(0,i.useRef)(null),u=(0,c.VK)((()=>l.databaseType===p.Fi&&r.some((e=>e.getPropertyValue(hh.C.MeetingNoteToCalendarEventRelation)))),[l,r]),h=(0,c.VK)((()=>{var e;const t=l.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=l.collectionStore();if((0,Kt.LC)(null==t?void 0:t.getModel(),e.property))return!u;const o=a[e.property];return e.visible&&o&&!Oh.includes(o.type)&&(0,io.Sb)({propertySchema:o,property:e.property,blockStores:r,collectionSchema:a})})))??[]}),[l,a,r,u]).slice(0,wh),m=(0,i.useRef)([]),[S,g]=(0,i.useState)(wh),[C,f]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{m.current.length>0&&m.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[m]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:r,marginLeft:n,setIsReadyToRender:s,setShowIconsOnly:l,setHiddenButtonsIndex:a}=e;(0,i.useEffect)((()=>{const e=_.Ds((()=>{var e,i,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,u=((null===(i=t.current)||void 0===i?void 0:i.getBoundingClientRect().width)??window.innerWidth)-(n??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,h=d-Vh;let m=r.current.findIndex((e=>e.rightEdge>h));m=-1!==m?m:wh;let S=r.current.findIndex(((e,t)=>p+t*Th>h));S=-1!==S?S:wh;const g=m<_h||u<=kh;l(g),a(g?S:m),s(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[n,t,r,o,a,s,l])}({propertyButtonsContainerRef:d,propertyButtonRefs:m,outerContainerRef:t,marginLeft:n,setIsReadyToRender:s,setHiddenButtonsIndex:g,setShowIconsOnly:f}),(0,v.jsx)("div",{ref:d,style:{display:"flex"},children:h.map(((e,t)=>{var r;let n=null===(r=m.current[t])||void 0===r?void 0:r.element;if(!n){const e=i.createRef();m.current[t]={element:e,rightEdge:0},n=e}const s=t>=S;return(0,v.jsx)("div",{ref:n,children:(0,v.jsx)(Rh,{collectionsBulkActionsToolbarStore:o,schema:a,property:e.property,isHidden:s,showIconsOnly:C},e.property)},e.property)}))})}function Rh(e){window.__c={n:"EditPropertyButton"};const{property:t,schema:o,collectionsBulkActionsToolbarStore:r,isHidden:n,showIconsOnly:s}=e,l=(0,Ui.Y$)(),a=o[t],d=(0,oe.O7)(),u=(0,c.VK)((()=>!(l.permissionScopes.state.canEditContent||"collectionTypedView"===l.contextType)),[l]),p=(0,re.yK)((e=>({button:{display:n?"none":"flex",padding:8,...vh(e)}})),[n]),h=(0,i.useRef)(null),m=(0,c.qz)(void 0,jo.Z),S=(0,i.useCallback)((async e=>{var o,i;if(!h.current)return;const n=zo.default.state.stores;e.stopPropagation(),e.preventDefault();const s=null===(o=h.current)||void 0===o?void 0:o.getBoundingClientRect(),a=n[0].getAssociatedCollectionStore();l&&s&&a&&await Sh.z({environment:d,store:n[0],additionalStores:n.slice(1),property:t,rect:s,format:yo.C.Table,collectionStore:a,blockPropertyValueOverlayStore:Pr._H(),collectionContextStore:l,statusSetCheckbox:"checkbox"===(null===(i=l.getPropertyFormat(t))||void 0===i?void 0:i.statusShowAs),mouseStore:m,preventClearSelection:!0,collectionsBulkActionsToolbarStore:r})}),[h,l,d,t,m,r]),g=(0,re.Fg)();return a?(0,v.jsx)(et.ZP,{renderTooltip:()=>a.name,render:e=>(0,v.jsx)(ko.Z,{...e,ariaLabel:a.name,ref:h,style:p.button,disabled:u,onClick:S,children:(0,v.jsx)(Fs.Z,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:a,hideName:s,showIcon:!0,property:t,iconStyle:{fill:g.regularTextColor}})}),disableTooltip:!s,placement:et.ug.Top}):null}const Mh=(0,f.I)("myTasksLarge",{viewBox:"0 0 48 48",svg:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("path",{d:"M21.6927 39.1705C21.4812 39.604 21.238 40.0164 20.9631 40.4076H39.5198C41.1693 40.4076 42.4117 39.9952 43.247 39.1705C44.0823 38.3457 44.5 37.1192 44.5 35.4909V19.2022C44.5 17.5739 44.0823 16.3473 43.247 15.5226C42.4117 14.6978 41.1693 14.2855 39.5198 14.2855H16.2526C14.5925 14.2855 13.3448 14.6978 12.5095 15.5226C11.6848 16.3367 11.2724 17.5633 11.2724 19.2022V24.4837C11.4839 24.4626 11.6953 24.4467 11.9068 24.4361C12.1183 24.415 12.3298 24.4044 12.5412 24.4044C12.7527 24.4044 12.9642 24.415 13.1757 24.4361C13.3977 24.4467 13.6145 24.4626 13.8259 24.4837V19.3449C13.8259 18.5202 14.0374 17.8964 14.4603 17.4734C14.8833 17.0505 15.4913 16.839 16.2843 16.839H39.4722C40.2547 16.839 40.8627 17.0505 41.2962 17.4734C41.7297 17.8964 41.9465 18.5202 41.9465 19.3449V35.3481C41.9465 36.1729 41.7297 36.7967 41.2962 37.2196C40.8627 37.6426 40.2547 37.8541 39.4722 37.8541H22.2478C22.0998 38.3087 21.9147 38.7475 21.6927 39.1705Z"}),(0,v.jsx)("path",{d:"M15.3644 10.0825C14.9837 10.4631 14.7353 11.0129 14.619 11.7319H41.1693C41.0424 11.0129 40.7887 10.4631 40.408 10.0825C40.0379 9.69123 39.4564 9.49562 38.6634 9.49562H17.1249C16.3319 9.49562 15.745 9.69123 15.3644 10.0825Z"}),(0,v.jsx)("path",{d:"M18.5206 5.816C18.14 6.15435 17.9285 6.66189 17.8862 7.3386H37.9021C37.8492 6.66189 37.6271 6.15435 37.2359 5.816C36.8553 5.46707 36.3002 5.2926 35.5706 5.2926H20.2018C19.4722 5.2926 18.9118 5.46707 18.5206 5.816Z"}),(0,v.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.44845 42.0729C10.4212 42.4959 11.4574 42.7074 12.5571 42.7074C13.6462 42.7074 14.6771 42.4959 15.6499 42.0729C16.6227 41.65 17.4791 41.0684 18.2193 40.3283C18.97 39.5881 19.5568 38.7317 19.9798 37.7589C20.4027 36.7861 20.6142 35.7499 20.6142 34.6503C20.6142 33.54 20.4027 32.4985 19.9798 31.5258C19.5674 30.553 18.9911 29.6965 18.251 28.9564C17.5108 28.2162 16.6544 27.6399 15.6816 27.2276C14.7088 26.8046 13.6673 26.5932 12.5571 26.5932C11.4574 26.5932 10.4212 26.8046 9.44845 27.2276C8.47568 27.6399 7.61922 28.2215 6.87906 28.9722C6.13891 29.7124 5.55736 30.5688 5.13442 31.5416C4.71147 32.5038 4.5 33.54 4.5 34.6503C4.5 35.7605 4.71147 36.802 5.13442 37.7748C5.55736 38.7475 6.13891 39.604 6.87906 40.3442C7.61922 41.0843 8.47568 41.6606 9.44845 42.0729ZM13.255 39.4242C13.0858 39.604 12.8532 39.6939 12.5571 39.6939C12.261 39.6939 12.0231 39.604 11.8434 39.4242C11.6742 39.2445 11.5896 39.0119 11.5896 38.7264V35.6177H8.48097C8.19548 35.6177 7.96286 35.5279 7.78311 35.3481C7.60336 35.1789 7.51348 34.9463 7.51348 34.6503C7.51348 34.3542 7.60336 34.1216 7.78311 33.9524C7.96286 33.7726 8.19548 33.6828 8.48097 33.6828H11.5896V30.5741C11.5896 30.2886 11.6742 30.056 11.8434 29.8763C12.0231 29.6965 12.261 29.6066 12.5571 29.6066C12.8532 29.6066 13.0858 29.6965 13.255 29.8763C13.4347 30.056 13.5246 30.2886 13.5246 30.5741V33.6828H16.6332C16.9187 33.6828 17.1513 33.7726 17.3311 33.9524C17.5108 34.1216 17.6007 34.3542 17.6007 34.6503C17.6007 34.9463 17.5108 35.1789 17.3311 35.3481C17.1513 35.5279 16.9187 35.6177 16.6332 35.6177H13.5246V38.7264C13.5246 39.0119 13.4347 39.2445 13.255 39.4242Z"}),(0,v.jsx)("path",{d:"M27.2289 32.3258C27.5208 32.6671 27.893 32.8378 28.3453 32.8378C28.8593 32.8378 29.2478 32.6404 29.511 32.2456L35.204 23.666C35.2986 23.5262 35.3685 23.3885 35.4137 23.2528C35.459 23.113 35.4816 22.9793 35.4816 22.8519C35.4816 22.4982 35.3582 22.2063 35.1115 21.976C34.8689 21.7416 34.5687 21.6244 34.211 21.6244C33.9643 21.6244 33.7546 21.6738 33.5819 21.7725C33.4133 21.867 33.2529 22.0315 33.1008 22.2659L28.3206 29.7723L25.9274 26.9042C25.6684 26.604 25.3435 26.4539 24.9529 26.4539C24.5869 26.4539 24.2847 26.5711 24.0462 26.8055C23.8077 27.0399 23.6885 27.3339 23.6885 27.6875C23.6885 27.8479 23.7131 28 23.7625 28.144C23.8159 28.2838 23.9126 28.4297 24.0524 28.5819L27.2289 32.3258Z"})]})});var jh=o(30806),Ih=o(5933),Fh=o(85740),Bh=o(32662);const Nh="noWritableDbs";function Dh(e){window.__c={n:"CollectionTasksEmptyState"};const t=(0,oe.O7)(),o=(0,c.VK)((()=>e.collectionContextStore.collectionStoresStore.state.length>0),[e.collectionContextStore.collectionStoresStore]),r=(0,c.VK)((()=>{const t=e.collectionContextStore.collectionStoresStore.state;return Boolean(t.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[e.collectionContextStore.collectionStoresStore]),n=(0,c.VK)((()=>(0,le.PI)(e.collectionContextStore)),[e]),s=(0,c.VK)((()=>e.collectionContextStore.isCompactView.state),[e.collectionContextStore]),l=(0,re.yK)((e=>({container:{width:"100%",height:s?pt.WB-4:void 0,paddingTop:s?void 0:120,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:14,color:e.lightTextColor},desktopInner:{width:800,minWidth:800,padding:32},icon:(0,pt.jO)(e)})),[s]),a=(0,i.useCallback)((()=>o?(0,v.jsx)(et.ZP,{disableTooltip:r,placement:et.ug.Bottom,renderTooltip:()=>(0,v.jsx)(j.FormattedMessage,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,v.jsx)("br",{})}}),render:o=>(0,v.jsx)(Fh.Z,{...o,isBlue:!0,disabled:!r,disabledFeedback:!r,onClick:o=>{(0,jh.Aq)({environment:t,from:e.from}),e.onAddTaskClick(o)},icon:e=>(0,de.R)(e),children:n})}):(0,v.jsx)(Fh.Z,{isBlue:!0,onClick:()=>{(0,jh.Aq)({environment:t,from:e.from}),Ih.Z.setState(!0)},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Don't see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[o,r,n,t,e]);return(0,v.jsxs)("div",{style:l.container,children:[(0,v.jsx)(ca.LazyCollectionTasksEmptyStateModal,{from:e.from}),Mh(l.icon),(0,v.jsx)(Bh.Z,{size:16}),(0,v.jsx)(j.FormattedMessage,{defaultMessage:"All tasks assigned to you will appear here.",id:"tasksEmptyState.noTasks.title"}),(0,v.jsx)(Bh.Z,{size:16}),a()]})}var Lh=o(57260),Ah=o(54281),Eh=o(64815),Zh=o(96310),Hh=o(35431),zh=o(92595);class Gh extends Hh.Z{findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}}const Kh=new Gh;(0,zh.exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",Kh);var Uh=o(20294),Wh=o(53465),$h=o(43350);const qh=15,Qh=33,Yh=12,Xh={position:"absolute",left:0,top:0,zIndex:M.Gt,width:"100%",height:"100%",pointerEvents:"none"};function Jh(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+Yh,o.top=o.top-qh)),o):o}function em(e){window.__c={n:"CollectionTimelineRelationArrow"};const{startItem:t,endItem:o,endRelationPointer:r,timelineState:n,disabled:s,isFullScreen:a,isRootChild:d,relationType:u,isUserDrawnTemp:p,isNewSubitemPlaceholder:h,renderEmitter:m}=e,S=(0,Ui.Y$)(),g=(0,oe.O7)(),C=(0,Uh.k)(),[f,y]=(0,i.useState)(!1),x=(0,re.Fg)(),[b,w]=(0,i.useState)(null),[k,_]=(0,i.useState)(null),T=(0,i.useCallback)((e=>{w(e.state)}),[]),V=(0,i.useCallback)((e=>{_(e.state)}),[]),O=(0,i.useCallback)((()=>{l.default.afterNextFlush((()=>{C()}))}),[C]);(0,i.useEffect)((()=>(w(t.stores.nodeStore.state),_(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(T),null==o||o.stores.nodeStore.addListener(V),null==m||m.addListener(O),S.filtersBarOpenStore.addListener(O),()=>{t.stores.nodeStore.removeListener(T),null==o||o.stores.nodeStore.removeListener(V),null==m||m.removeListener(O),S.filtersBarOpenStore.removeListener(O)})),[t,o,m,T,V,O,S.filtersBarOpenStore]);const P=(0,c.VK)((()=>Mr.ZP.state.isDragging&&Mr.ZP.state.draggedStores.includes(t.props.store)),[t]),R=(0,c.VK)((()=>o&&Mr.ZP.state.isDragging&&Mr.ZP.state.draggedStores.includes(o.props.store)),[o]),j=(0,c.VK)((()=>{const e=Mr.ZP.state;return e.isDragging?e.currentY-e.startY:0}),[]),I=b&&b.getBoundingClientRect().y+(P?j:0),F=(0,c.VK)((()=>{const e=t.itemPositionStore.state;return I&&e?{left:e.left,right:"subitem"===u?e.left+Yh:e.right,top:"subitem"===u?I+qh:I}:void 0}),[u,t.itemPositionStore,I]),B=k&&k.getBoundingClientRect().y+(R?j:0),N=(0,c.VK)((()=>{const e=B&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:B}:void 0;return"subitem"===u?Jh({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,B,u,t.itemPositionStore]),D=(0,c.VK)((()=>t.dateValueStore.state),[t]),L=(0,c.VK)((()=>null==o?void 0:o.dateValueStore.state),[o]),A=(0,c.VK)((()=>void 0!==n.dragState.state),[n]),E=(0,c.VK)((()=>void 0!==n.drawState.state),[n]),Z=(0,c.VK)((()=>n.hoveredItem.state),[n.hoveredItem]),H=f&&!A&&!E,z=(0,i.useCallback)((()=>{r&&!s&&Ah.IL({dependency:{store:t.props.store,relationPointer:r},collectionContextStore:S,environment:g,timelineState:n,isFullScreen:a,isRootChild:d})}),[t,s,r,S,g,n,a,d]),G=(0,i.useCallback)((()=>{y(!0)}),[y]),K=(0,i.useCallback)((()=>{y(!1)}),[y]),U=(0,i.useCallback)((e=>{if(N)return(0,v.jsx)(tm,{topOffset:e,endPosition:N,handleCloseButtonClick:z})}),[N,z]),W=Z===t.props.store,$=o&&Z===o.props.store,q=W||$||H||"subitem"===u?1:.7;let Q,Y=!0;"subitem"===u?(Q=x.collectionUnsetDependencyArrow,Y=!1):D&&L&&(Q=D<=L?x.collectionValidDependencyArrow:x.collectionInvalidDependencyArrow);const X=(0,re.yK)((()=>({svgStyle:{zIndex:"dependency"===u&&(H||$)?M.Gt:M.wx}})),[u,H,$]);return F?p?(0,v.jsx)(om,{startPosition:F,timelineState:n}):h?(0,v.jsx)(rm,{startPosition:F,timelineState:n}):t!==o&&N?(0,v.jsx)(im,{startPosition:F,endPosition:N,strokeOpacity:q,strokeColorOverride:Q,svgStyle:X.svgStyle,cornerRadiusOverride:"subitem"===u?8:void 0,relationType:u,handleMouseMove:G,handleMouseLeave:K,renderChildren:Y&&H?U:void 0}):null:null}function tm(e){window.__c={n:"RemoveDependencyButton"};const{topOffset:t,endPosition:o,handleCloseButtonClick:r}=e,i=(0,re.yK)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:r,children:(0,Wh.X)(i.icon)})})}function om(e){window.__c={n:"UserDrawnTempDependencyArrow"};const{startPosition:t,timelineState:o}=e,r=(0,c.VK)((()=>{const e=o.drawState.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawState]);return r?(0,v.jsx)(im,{startPosition:t,endPosition:r,strokeOpacity:1,relationType:"dependency"}):null}function rm(e){var t;window.__c={n:"NewSubitemPlaceholderArrow"};const{startPosition:o,timelineState:r}=e,i=(0,re.Fg)(),n=(0,c.VK)((()=>r.dateRangePlaceholder.state),[r.dateRangePlaceholder]),s=(0,c.VK)((()=>null!=n&&n.active?n.date:void 0),[n]),l=null!=n&&n.active?null===(t=n.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,a=l?l[l.length-1].children.length:0,d=o.top+a*Qh+qh+5,u=(0,c.VK)((()=>{const e=(0,Bi.HZ)({timelineState:r,dateValue:s,placeholderDate:s,subitemPlaceholderDate:void 0}),t=d&&e?{...e,top:d}:void 0;return Jh({startItemPosition:o,value:t})}),[s,d,o,r]);return u?(0,v.jsx)(im,{startPosition:o,endPosition:u,strokeOpacity:1,strokeColorOverride:i.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function im(e){window.__c={n:"RelationArrowBase"};const{startPosition:t,endPosition:o,strokeColorOverride:r,cornerRadiusOverride:n,strokeOpacity:s,relationType:l,svgStyle:a,handleMouseMove:d,handleMouseLeave:u}=e,p=(0,Ui.Y$)(),h=(0,re.Fg)(),[m,S]=(0,i.useState)(0),g=t.right,C=t.top+qh-m,f=o.left-3,y=o.top+qh-m,x=(0,c.VK)((()=>{if(r)return r;return(0,Bi.H5)(p)&&t.right&&o.left?t.right<o.left?h.collectionValidDependencyArrow:h.collectionInvalidDependencyArrow:h.collectionUnsetDependencyArrow}),[p,o.left,t.right,r,h]);return(0,v.jsx)("svg",{style:{...Xh,...a},ref:e=>{e&&S(e.getBoundingClientRect().top)},children:(0,v.jsx)($h.Z,{startPoint:{x:g,y:C},endPoint:{x:f,y},style:{stroke:x,strokeWidth:Bi.lf,strokeOpacity:s},useRightAngles:"subitem"===l,showArrowHead:"dependency"===l&&!e.renderChildren,cornerRadiusOverride:n,handleMouseMove:d,handleMouseLeave:u,children:e.renderChildren&&e.renderChildren(m)})})}function nm(e){window.__c={n:"CollectionTimelineDependenciesOverlay"};const{timelineState:t,disabled:o,isReady:r,isFullScreen:n,isRootChild:s,renderEmitter:l}=e,a=(0,Ui.Y$)(),d=(0,i.useCallback)((()=>{t.drawState.setState(void 0)}),[t.drawState]),u=(0,c.VK)((()=>a.collectionViewBlockStore()),[a]),p=(0,c.VK)((()=>a.settingsStore.state.open),[a]);if((0,i.useEffect)((()=>{var e;!p&&null!==(e=t.drawState.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&d()}),[p,t.drawState,d]),!r||!u)return null;const h=Kh.findCollectionTimelineViewItems(u);return(0,v.jsx)(v.Fragment,{children:h.map((e=>{const{store:r,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,ie.Hd)(c):"noGroup";return(0,v.jsxs)(i.Fragment,{children:[(0,v.jsx)(sm,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"dependency"},`${r.id}-${d}-${r.key}-dependency`),(0,v.jsx)(sm,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"subitem"},`${r.id}-${d}-${r.key}-subitem`)]},`${r.id}-${d}-${r.key}`)}))})}function sm(e){window.__c={n:"CollectionTimelineRelationAnnotationItem"};const{startItem:t,timelineState:o,disabled:r,isFullScreen:n,isRootChild:s,relationType:l,renderEmitter:a}=e,{store:d,schema:u}=t.props,p=(0,Ui.Y$)(),h=(0,c.VK)((()=>"dependency"===l?o.drawState.state:void 0),[o.drawState,l]),m=(0,c.VK)((()=>(null==h?void 0:h.startStore)===d),[d,h]),S=(0,c.VK)((()=>m&&!(null!=h&&h.tryToCompleteDrawnArrow)),[h,m]),g=(0,c.VK)((()=>{if("dependency"===l)return m&&h?h.temporaryDependencyRelationPointers:(0,Bi.YE)(p,d,u);if("subitem"===l){return Yt.default.checkGate("collection_level_subitems_setting")?(0,Bi.ph)(p,d,u):(0,Bi.WD)(p,d,u)}return[]}),[l,m,h,p,d,u]),C=(0,c.VK)((()=>p.collectionViewBlockStore()),[p]),f=(0,c.VK)((()=>{var e;const r=o.dateRangePlaceholder.state;if("subitem"!==l||null==r||!r.active||!r.newTimelineItemProps)return;const i=r.newTimelineItemProps.subitemPath;return(i?null===(e=i[i.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?r:void 0}),[l,t.props.store,o.dateRangePlaceholder]);if(!C)return null;const y=Kh.findCollectionTimelineViewItems(C);return(0,v.jsxs)(v.Fragment,{children:[g.map((e=>{if(d.id===e.id)return null;const c=y.filter((t=>t.props.store.id===e.id));return(0,v.jsx)(i.Fragment,{children:c.map((i=>{const c=i.props.store,d=i.props.groupFormat;return(0,v.jsx)(em,{startItem:t,endItem:i,endRelationPointer:e,timelineState:o,disabled:r,isFullScreen:n,isRootChild:s,renderEmitter:a,relationType:l},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===l&&S&&(0,v.jsx)(em,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"dependency"}),"subitem"===l&&f&&(0,v.jsx)(em,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"subitem"})]})}var lm=o(7525);const am=function(e){let{zoomLevel:t,onChange:o}=e;window.__c={n:"CollectionTimelineViewZoomLevelButtonPopup"};const r=(0,re.Fg)(),i=(0,oe.O7)(),{device:n}=i;return(0,v.jsx)(Ye.ZP,{popupType:n.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,renderOrigin:e=>(0,v.jsxs)(Xe.Z,{isSmall:!0,isGray:!0,...e,children:[(0,v.jsx)(cm,{zoomLevel:t}),(0,Ti.i)({width:10,marginLeft:4,fill:r.mediumIconColor})]}),originGap:8,render:e=>(0,v.jsx)(dm,{parent:e,zoomLevel:t,onChange:o})})};function cm(e){let{zoomLevel:t}=e;return"hours"===t?(0,v.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,v.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,v.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,v.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,v.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,v.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,v.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):void(0,ut.t1)(t)}function dm(e){let{parent:t,zoomLevel:o,onChange:r}=e;window.__c={n:"ZoomLevelMenuComponent"};const i=(0,oe.O7)(),{device:n}=i,s=[{key:"calendar by section",render:e=>(0,v.jsx)(Re.Z,{...e}),items:ao.H.map((e=>({key:e,render:t=>(0,v.jsx)(Qe.Z,{...t,title:(0,v.jsx)(cm,{zoomLevel:e})}),action:()=>{r(e),t.close()}})))}];return(0,v.jsx)(Rc.Z,{capture:!0,allowEsc:!0,render:e=>{let r;return r=n.isMobile?{menuType:_e.og.Modal,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,v.jsx)(Pe.DoneMenuText,{}),onClickRight:t.close,...e}:{menuType:_e.og.Popup,width:180,...e},(0,v.jsx)(Ve.Z,{...r,children:(0,v.jsx)(Oe.Z,{type:Oe.i.Vertical,sections:s,initialFocus:ao.H.indexOf(o)})})}})}const um=6;function pm(e){let{timelineState:t,scrollerLeftOffset:o,paddingLeft:i,showTable:n,isFullScreen:s,isRootChild:l,isReady:a,collectionContextStore:d,isInPeekRenderer:u,format:p,paddingRight:h}=e;window.__c={n:"CollectionTimelineViewControlBar"};const m=(0,re.Fg)(),S=(0,oe.O7)(),g=(0,c.SI)((()=>{const e=t.zoomLevel.state,{primaryDisplayUnit:l,secondaryDisplayUnit:a}=Bi.BJ[e],c=t.scrollLeft.state,{startTimestamp:d}=t.currentRange.state;if(void 0!==c){const t=d+(0,Bi.x2)(e,c+o+(!n&&s?i:0));return(0,Bi.DS)(r.ou.fromMillis(t),l).startOf(a).valueOf()}}),[t,o,i,n,s]),C=(0,oe.Fy)(),f=(0,c.VK)((()=>t.zoomLevel.state),[t]),y=(0,c.VK)((()=>t.outerSizeObserver.rect.state.width),[t]),{secondaryDisplayUnit:x}=Bi.BJ[f],b=(0,c.VK)((()=>g.state),[g]),w=(0,c.VK)((()=>(0,Bi.d$)({environment:S,isFullScreen:s,isRootChild:l})),[S,s,l]),k=(0,c.VK)((()=>d.permissionScopes.state),[d]),_=!n&&w&&k.canConfigureBlock,T=(0,c.VK)((()=>{var e;return(null===(e=d.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(u?m.cardContentBackground:m.contentBackground)}),[d,u,m]),V=u?m.cardContentBackgroundTransparent:m.contentBackgroundTransparent,O=(0,re.yK)((()=>({secondaryDisplayUnit:{position:"absolute",top:1,left:0,paddingLeft:s&&!n?o+i:o,display:"flex",alignItems:"center",height:32,paddingTop:um+(C.isMobile?2:0),background:T,fontSize:14,fontWeight:R.Z.fontWeight.medium},outerContainer:{position:"sticky",left:0,width:y,zIndex:M.Qm,height:0},controlBarRight:{position:"absolute",top:1,right:0,paddingRight:h,display:"flex",alignItems:"center",height:32,paddingTop:um+1,background:T},hideTableIcon:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:C.isIOS?0:1,height:22,fill:m.lightIconColor}})),[T,C.isIOS,C.isMobile,s,y,i,h,o,n,m.lightIconColor]);return(0,v.jsx)(Mt,{position:mt.Top,children:(0,v.jsxs)("div",{style:O.outerContainer,children:[b&&(0,v.jsxs)("div",{style:O.secondaryDisplayUnit,children:[_&&(0,v.jsx)(et.ZP,{render:e=>(0,v.jsx)(Xe.Z,{isSmall:!0,onClick:()=>function(e,t,o,r,i,n){const s=r.collectionViewStore();if(!s)return;Q.createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,perform:e=>{const o=(0,Bi.YP)(t,!0);So.FH({stores:[s],update:o,transaction:e})}}),I.CB(e,{...(0,Bi.Ii)({environment:e,collectionContextStore:r,timelineState:o,isFullScreen:i,isRootChild:n}),show:!0})}(S,p,t,d,s,l),style:O.hideTableIcon,...e,children:(0,lm.t)({width:14})}),renderTooltip:()=>(0,v.jsx)(j.FormattedMessage,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,v.jsx)("span",{style:{paddingLeft:_||C.isPhone?0:s||n?16:2},children:(0,Bi.qG)(b,x)}),!a&&!n&&(0,v.jsx)(mm,{}),(0,v.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${T} 20%, ${V} 100%)`}})]}),(0,v.jsxs)("div",{style:O.controlBarRight,children:[(0,v.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${T} 20%, ${V} 100%)`}}),(0,v.jsx)(zu,{collectionContextStore:d}),(0,v.jsx)(am,{zoomLevel:f,onChange:e=>function(e,t,o,r,i,n){Ah.Nf({timelineState:o,environment:t,zoomLevel:e,centerTimestamp:(0,Bi.al)(o)}),I.zI(t,(0,Bi.Ii)({environment:t,collectionContextStore:r,timelineState:o,isFullScreen:i,isRootChild:n}))}(e,S,t,d,s,l)}),(0,v.jsx)(Xe.Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,r,i,n,s){const l=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,Bi.xI)({environment:e,paddingLeft:o,format:r,isFullScreen:i,isRootChild:n}),d=(a-c)/2,u=(0,Bi.al)(t),p=u-(0,Bi.x2)(l,d);Ah.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:p}),I.Al(e,{...(0,Bi.Ii)({environment:e,collectionContextStore:s,timelineState:t,isFullScreen:i,isRootChild:n}),type:"left"})}(S,t,i,p,s,l,d),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,Ru.f)({width:12,fill:m.mediumIconColor})}),(0,v.jsx)(Xe.Z,{isSmall:!0,onClick:()=>function(e,t,o,r,i,n,s){const l=t.zoomLevel.state,a=(0,Bi.bK)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:r});Ah.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:a}),I.H6(e,(0,Bi.Ii)({environment:e,collectionContextStore:i,timelineState:t,isFullScreen:n,isRootChild:s}))}(S,t,i,p,d,s,l),children:(0,v.jsx)(j.FormattedMessage,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,v.jsx)(Xe.Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,r,i,n,s){const l=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,Bi.xI)({environment:e,paddingLeft:o,format:r,isFullScreen:i,isRootChild:n}),d=(a-c)/2,u=(0,Bi.al)(t),p=u+(0,Bi.x2)(l,d);Ah.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:p}),I.Al(e,{...(0,Bi.Ii)({environment:e,collectionContextStore:s,timelineState:t,isFullScreen:i,isRootChild:n}),type:"right"})}(S,t,i,p,s,l,d),style:{paddingLeft:4,paddingRight:4},children:(0,Mu.o)({width:12,fill:m.mediumIconColor})})]})]})})}const hm=i.memo(pm);function mm(){return(0,v.jsx)(Vd.Z,{show:!0,showDelay:400,showHold:0,render:e=>e?(0,v.jsx)(Ue.Z,{style:{marginLeft:8,marginTop:1}}):void 0})}var Sm=o(97439);const gm=function(e){let{isGrouped:t,format:o,collectionContextStore:r,isFullScreen:i,isRootChild:n,timelineState:s}=e;window.__c={n:"CollectionTimelineViewHideTableButton"};const l=(0,re.Fg)(),a=(0,oe.O7)(),{device:c}=a;return(0,v.jsx)(et.ZP,{render:e=>(0,v.jsx)(Xe.Z,{isSmall:!0,onClick:()=>function(e,t,o,r,i,n){const s=o.collectionViewStore();if(!s)return;Q.createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,perform:e=>{const o=(0,Bi.YP)(t,!1);So.FH({stores:[s],update:o,transaction:e})}}),I.CB(e,{...(0,Bi.Ii)({environment:e,collectionContextStore:o,timelineState:n,isFullScreen:r,isRootChild:i}),show:!1})}(a,o,r,i,n,s),style:{position:"absolute",top:t?c.isIOS?3:4:c.isIOS?7:8,right:t?6:8,zIndex:M.MC,fill:l.lightIconColor},...e,children:(0,Sm.D)({width:14})}),renderTooltip:()=>(0,v.jsx)(j.FormattedMessage,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};var Cm=o(24211);function fm(e){window.__c={n:"TimelineShimmerWrapper"};const{shouldShowShimmer:t,children:o}=e,r=(0,hr.Z)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,v.jsx)("div",{className:r,style:{height:"100%"},children:o})}const vm=22,ym=22,xm=12,bm=4,wm=32;class km extends s.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()},this.activeRangeStore=this.createComputedStore((()=>{const{collectionContextStore:e,timelineState:t,query:o,schema:r,intl:i}=this.props,n=e.collectionStore();if(!n)return;const s=t.dragState.state,l=t.zoomLevel.state,a=t.hoveredItem.state,c=t.dateRangePlaceholder.state,{activeRangeType:d}=Bi.BJ[l];if(!d)return;let u;if(s)u=s.temporaryValues.map((e=>(0,Bi.XO)(e,"day")));else if(c.active)u=[(0,Bi.XO)(c.date,"day")];else{const{stores:t}=zo.default.state,s=t.filter((e=>e.getAssociatedCollectionId()===n.id)),l=_.jj(_.oA([...s,a]));u=_.oA(l.map((t=>{const n=(0,Bi.bk)({store:t,query:o,schema:r,userId:e.getCurrentUserId(),intl:i});if(n)return(0,Bi.XO)(n,"day")})))}const p=_.F(u,(e=>{let{start:t}=e;return t.valueOf()})),h=_.UT(u,(e=>{let{end:t}=e;return t.valueOf()}));return p&&h?{start:p.start.valueOf(),end:h.end.valueOf()}:void 0}),!0)}UNSAFE_willMount(e){super.UNSAFE_willMount(e)}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){const{collectionContextStore:e,timelineState:t}=this.props,o=t.zoomLevel.state,i=Bi.BJ[o],{primaryDisplayUnit:n,activeRangeType:s}=i,l=(0,Bi.ST)(n),a=r.ou.now(),c=l?a.startOf("minute"):a.startOf("day"),d=a.startOf("minute"),{device:u}=this.environment,p=!e.groupsStore.anyGroupHasNonEmptyResults()&&Wt({collectionContextStore:e,groupsPointer:[],hasPartialResults:!1});return(0,v.jsx)(Mt,{position:mt.Top,children:(0,v.jsxs)("div",{style:Om(this.props.collectionContextStore,this.props.isInPeekRenderer,this.theme),children:[(0,v.jsx)("div",{style:{height:32,position:"relative",overflow:"hidden"},children:!u.isPhone&&(0,v.jsx)(Dm,{timelineState:this.props.timelineState})}),(0,v.jsxs)("div",{style:{height:wm,position:"relative",overflow:"hidden"},children:[(0,v.jsx)(fm,{shouldShowShimmer:p,children:(0,v.jsx)(Nm,{timelineState:this.props.timelineState,nowTimeStartOfPrimaryDisplayUnit:c})}),"highlight_days"===s&&this.renderActiveRange(),(0,v.jsx)(Lm,{timelineState:this.props.timelineState,time:c}),"display_range"===s&&this.renderActiveRange()]}),(0,v.jsx)(jm,{timelineState:this.props.timelineState,time:d})]})})}renderActiveRange(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:i}=e.currentRange.state,n=Bi.BJ[t],{activeRangeType:s}=n,l=this.activeRangeStore.state;if(l){const e=(0,Bi.DS)(r.ou.fromMillis(l.start),"day"),n=(0,Bi.e$)(t,e.valueOf()-o);if("highlight_days"===s){const s=[];let a=r.ou.fromMillis(Math.max(e.valueOf(),(0,Bi.DS)(r.ou.fromMillis(o),"day").valueOf()));for(;a.valueOf()<l.end&&a.valueOf()<i;){s.push(a);a=(0,Bi.Ip)(a,"day")}const c=(0,Bi.e$)(t,a.valueOf()-o)-n+8,d=s.map(((e,t)=>(0,v.jsx)(Mm,{timelineState:this.props.timelineState,time:e,accent:0===t||t===s.length-1},`${e.toString()}-${t}`)));return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:{position:"absolute",top:0,left:n-4,width:c,marginTop:(wm-vm)/2-2,height:vm,background:this.theme.timelineDarkerBackground,borderRadius:11}}),d]})}{const i=(0,Bi.DS)(r.ou.fromMillis(l.end),"day"),s=(0,Bi.cK)(r.ou.fromMillis(l.end),"day"),a=(0,Bi.e$)(t,i.valueOf()-o)-n+8;return(0,v.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:n-4,minWidth:a,marginTop:(wm-vm)/2-2,height:vm,background:this.theme.timelineDarkerBackground,borderRadius:11,paddingLeft:6,paddingRight:6},children:(0,v.jsx)(Fm,{start:e,end:e.valueOf()!==s.valueOf()?s:void 0,rangeWidth:a})})}}}}km.displayName="CollectionTimelineViewTimeBar";const _m=(0,j.injectIntl)(km);function Tm(e,t,o){const r=o.zoomLevel.state,{startTimestamp:i}=o.currentRange.state,{primaryDisplayUnit:n,primaryDisplayUnitAlignment:s}=Bi.BJ[r],l=(0,Bi.DS)(e,n),a=(0,Bi.Ip)(e,n),c=(0,Bi.e$)(r,l.valueOf()-i),d=(0,Bi.e$)(r,e.valueOf()-i),u=(0,Bi.e$)(r,a.valueOf()-i)-c,p=t?bm:0;return{left:("range_start"===s?d-u/2:d)-p,width:u+2*p}}function Vm(e,t,o,r,i){const n=e.setLocale(Tu.SP),s=(0,Bi.xJ)(),l=r?i.regularTextColor:i.lightTextColor,a=r?i.regularTextColor:i.mediumTextColor,c=r?i.mediumTextColor:i.lightTextColor,d=n.toFormat("t").startsWith(n.toFormat("a"));if("fifteen_minutes"===o){if(s)return(0,v.jsx)("span",{style:{color:l},children:n.toFormat("H:mm")});{const e=(0,v.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:n.toFormat("h:mm")}),t=(0,v.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:n.toFormat("a")});return d?(0,v.jsxs)(v.Fragment,{children:[t,e]}):(0,v.jsxs)(v.Fragment,{children:[e,t]})}}if("hour"===o){if(s)return(0,v.jsx)("span",{style:{color:l},children:n.toFormat("H:mm")});{const e=(0,v.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:n.toFormat("h")}),t=(0,v.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:n.toFormat("a")});return d?(0,v.jsxs)(v.Fragment,{children:[t,e]}):(0,v.jsxs)(v.Fragment,{children:[e,t]})}}if("day"===o||"week"===o)return"week"===t||"bi_week"===t?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{style:{color:c,paddingRight:3},children:n.toFormat("ccccc")}),(0,v.jsx)("span",{style:{color:a,padding:"2px 7px"},children:n.toFormat("d")})]}):(0,v.jsx)("span",{style:{color:l},children:n.toFormat("d")});(0,ut.t1)(o)}function Om(e,t,o){var r;return{position:"absolute",left:0,top:0,width:"100%",background:(null===(r=e.inheritedBlockColorStore.state)||void 0===r?void 0:r.background)||(t?o.cardContentBackground:o.contentBackground),borderTop:e.viewIsFlushToTopbar()?`1px solid ${o.tableDividerColor}`:"1px solid transparent",borderBottom:`1px solid ${o.tableDividerColor}`}}function Pm(e){return{color:e.regularTextColor,fontSize:xm}}function Rm(e){return{background:e.timelineRed,width:ym,height:ym,borderRadius:ym/2,position:"absolute",left:`calc(50% - ${ym/2}px)`,top:`calc(50% - ${ym/2}px)`}}function Mm(e){let{time:t,accent:o,timelineState:r}=e;window.__c={n:"PrimaryIndicatorComponent"};const i=(0,re.Fg)(),n=(0,c.VK)((()=>r.zoomLevel.state),[r]),{primaryDisplayUnit:s}=Bi.BJ[n],{left:l,width:a}=(0,c.VK)((()=>Tm(t,!1,r)),[t,r]);return(0,v.jsx)("div",{style:{position:"absolute",top:0,left:l,width:a,height:wm-4,display:"flex",alignItems:"start",lineHeight:wm-4+"px"},children:(0,v.jsx)("div",{style:{fontSize:xm,margin:"0 auto"},children:Vm(t,n,s,o,i)})})}function jm(e){let{time:t,timelineState:o}=e;window.__c={n:"NowCircleComponent"};const r=(0,re.Fg)(),i=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n}=(0,c.VK)((()=>o.currentRange.state),[o]),s=Math.floor((0,Bi.e$)(i,t.valueOf()-n));return(0,v.jsx)("div",{style:{position:"absolute",left:s-3.5+.5,top:Math.floor(wm+32-3.5+.5),width:7,height:7,background:r.timelineRed,borderRadius:"100%"}})}function Im(e){let{time:t,timelineState:o,intl:r}=e;window.__c={n:"SecondaryIndicatorComponent"};const i=(0,re.Fg)(),n=(0,oe.O7)(),s=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:l}=(0,c.VK)((()=>o.currentRange.state),[o]),{secondaryDisplayUnit:a}=Bi.BJ[s],d=(0,Bi.e$)(s,t.valueOf()-l);return(0,v.jsx)("div",{style:{position:"absolute",top:0,left:d,height:wm,color:i.regularTextColor,fontSize:14,fontWeight:R.Z.fontWeight.medium,verticalAlign:"middle",paddingTop:um+(n.device.isMobile?2:0),display:"flex",alignItems:"center"},children:(0,Bi.EW)((0,Cm.E2)(r),t.valueOf(),a)},d)}function Fm(e){let{start:t,end:o,rangeWidth:r}=e;window.__c={n:"ActiveDisplayRangeIndicatorComponent"};const i=(0,re.Fg)();return t&&o?r>=110?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:Pm(i),children:(0,Ou.Yx)(t.valueOf(),"month_day",Tu.SP)}),(0,v.jsx)("div",{style:{flexGrow:1}}),(0,v.jsx)("div",{style:Pm(i),children:(0,Ou.Yx)(o.valueOf(),"month_day",Tu.SP)})]}):(0,v.jsxs)("div",{style:Pm(i),children:[(0,Ou.Yx)(t.valueOf(),"month_day",Tu.SP)," â ",t.month===o.month?(0,Ou.Yx)(o.valueOf(),"day",Tu.SP):(0,Ou.Yx)(o.valueOf(),"month_day",Tu.SP)]}):(0,v.jsx)("div",{style:Pm(i),children:(0,Ou.Yx)(t.valueOf(),"month_day",Tu.SP)})}function Bm(e,t,o,r){const i=e.setLocale(Tu.SP),n=(0,Bi.ST)(o),s=(0,Bi.xJ)();return n?s?(0,v.jsx)("span",{style:{color:r.timelineRed},children:i.toFormat("H:mm")}):(0,v.jsx)("span",{style:{color:r.timelineRed,paddingRight:3},children:i.toFormat("t")}):"week"===t||"bi_week"===t?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{style:{color:r.lightTextColor,paddingRight:3},children:i.toFormat("ccccc")}),(0,v.jsxs)("div",{style:{position:"relative"},children:[(0,v.jsx)("div",{style:Rm(r)}),(0,v.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:i.toFormat("d")})]})]}):(0,v.jsxs)("div",{style:{position:"relative"},children:[(0,v.jsx)("div",{style:Rm(r)}),(0,v.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:i.toFormat("d")})]})}function Nm(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;window.__c={n:"PrimaryIndicatorsComponent"};const i=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n,endTimestamp:s}=(0,c.VK)((()=>o.currentRange.state),[o]),l=Bi.BJ[i],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:d}=l,u=d||0,p=(0,c.VK)((()=>Tm(t,!1,o)),[t,o]),h=p.left+u,m=p.left+p.width-u,S=[];let g=(0,Bi.DS)(r.ou.fromMillis(n),a);const C=(0,c.VK)((()=>Tm(g,!1,o)),[g,o]);for(;g.valueOf()<s;){const e=C.left+u,t=C.left+C.width-u;void 0!==d&&(h>=e&&h<=t||m>=e&&m<=t)||S.push((0,v.jsx)(Mm,{timelineState:o,time:g,accent:!1},g.valueOf()));const r=(0,Bi.Ip)(g,a);g=r}return(0,v.jsx)(v.Fragment,{children:S})}function Dm(e){let{timelineState:t}=e;window.__c={n:"SecondaryIndicatorsComponent"};const o=(0,j.useIntl)(),i=(0,c.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:n,endTimestamp:s}=(0,c.VK)((()=>t.currentRange.state),[t]),l=Bi.BJ[i],{primaryDisplayUnit:a,secondaryDisplayUnit:d}=l,u=[];let p=(0,Bi.DS)(r.ou.fromMillis(n),d);for(;p.valueOf()<s;){u.push((0,v.jsx)(Im,{timelineState:t,intl:o,time:p},p.valueOf()));const e=(0,Bi.Ip)(p,d);p=(0,Bi.xP)(e,a)}return(0,v.jsx)(v.Fragment,{children:u})}function Lm(e){let{time:t,timelineState:o}=e;window.__c={n:"NowIndicatorComponent"};const r=(0,re.Fg)(),i=(0,c.VK)((()=>o.zoomLevel.state),[o]),{primaryDisplayUnit:n}=Bi.BJ[i],{left:s,width:l}=(0,c.VK)((()=>Tm(t,!0,o)),[t,o]);return(0,v.jsx)("div",{style:{position:"absolute",top:0,left:s,width:l,height:wm-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,v.jsx)("div",{style:{fontSize:xm,margin:"0 auto",display:"flex"},children:Bm(t,i,n,r)})},s)}function Am(e){let{timelineState:t}=e;window.__c={n:"TimelineBackground"};const o=(0,Uh.k)(),r=(0,i.useCallback)((()=>{0===(new Date).getSeconds()&&o()}),[o]);(0,i.useEffect)((()=>{const e=setInterval(r,1e3);return()=>clearInterval(e)}),[r]);const n=(0,c.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:s,endTimestamp:l}=(0,c.VK)((()=>t.currentRange.state),[t]);return(0,v.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,v.jsx)(Gm,{zoomLevel:n,startTimestamp:s,endTimestamp:l}),(0,v.jsx)(Km,{zoomLevel:n,startTimestamp:s,endTimestamp:l}),(0,v.jsx)(zm,{zoomLevel:n,startTimestamp:s})]})}const Em=i.memo(Am,Jt.Z),Zm=i.memo((function(e){let{start:t,zoomLevel:o,startTimestamp:r}=e;window.__c={n:"WeekendIndicatorComponent"};const i=(0,re.yK)((e=>{const i=t.plus({day:2}).startOf("day"),n=(0,Bi.e$)(o,t.valueOf()-r);return{weekendIndicator:{position:"absolute",left:n,width:(0,Bi.e$)(o,i.valueOf()-r)-n,height:"100%",background:e.timelineDarkerBackground}}}),[t,r,o]);return(0,v.jsx)("div",{style:i.weekendIndicator},t.valueOf())}),Jt.Z),Hm=i.memo((function(e){let{time:t,zoomLevel:o,startTimestamp:r}=e;window.__c={n:"VerticalDividerComponent"};const i=(0,re.yK)((e=>({verticalDivider:{position:"absolute",left:(0,Bi.e$)(o,t-r),height:"100%",borderRight:`1px solid ${e.regularDividerColor}`}})),[r,t,o]);return(0,v.jsx)("div",{style:i.verticalDivider},t)}),Jt.Z),zm=i.memo((function(e){let{zoomLevel:t,startTimestamp:o}=e;window.__c={n:"NowVerticalDividerComponent"};const i=(0,re.yK)((e=>{const i=r.ou.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",left:Math.floor((0,Bi.e$)(t,i.valueOf()-o)),height:"100%",borderRight:`1px solid ${e.timelineRed}`}}}),[o,t]);return(0,v.jsx)("div",{style:i.nowVerticalDivider})}),Jt.Z),Gm=i.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:i}=e;const{showWeekendIndicators:n}=Bi.BJ[t];if(!n)return null;let s=(0,Bi.DS)(r.ou.fromMillis(o),"day");const l=[];for(;s.valueOf()<i;)6===s.weekday&&l.push((0,v.jsx)(Zm,{start:s,zoomLevel:t,startTimestamp:o},s.valueOf())),s=(0,Bi.Ip)(s,"day");return(0,v.jsx)(v.Fragment,{children:l})}),Jt.Z),Km=i.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:i}=e;const{verticalDividerUnit:n}=Bi.BJ[t];if(!n)return null;const s=[];let l=(0,Bi.DS)(r.ou.fromMillis(o),n);for(;l.valueOf()<i;)s.push((0,v.jsx)(Hm,{time:l.valueOf(),zoomLevel:t,startTimestamp:o},l.valueOf())),l=(0,Bi.Ip)(l,n);return(0,v.jsx)(v.Fragment,{children:s})}),Jt.Z);const Um=function(e){let{store:t,collectionContextStore:o,groupFormat:r}=e;window.__c={n:"CollectionTimelineViewDroppableRow"};const i=(0,oe.O7)(),n=(0,c.VK)((()=>Wm(t)),[t]);return(0,v.jsx)(It.Z,{store:t,style:{width:"100%",height:Zh.Z+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:n?$m(n,i,t,o,r):void 0,onInsertAbove:n?qm(n,i,t,o,r):void 0,onSelectableDrop:e=>function(e,t,o,r,i){const{droppedDirection:n,droppedStores:s,duplicate:l}=e,a=Wm(o);if(!a)return;const c=r.subitemTreeStore.state,d=(0,kr.DY)(c.children,(e=>e.value.store===o)),u=yr.default.mark("collections.drop_item_lag");yr.default.measureAfterNextFlush(u,{environment:t,getData:()=>he.yr({collectionContextStore:r,is_native_drop:!1,is_empty:!1})}),Q.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,perform:e=>{L.by({environment:t,collectionStore:a,targetStore:o,droppedDirection:n,collectionContextStore:r,groupsPointer:i?[i]:[],droppedStores:s,duplicate:l,transaction:e,subitemPath:d})}})}(e,i,t,o,r),onNativeDrop:e=>function(e,t,o,r,i){const{files:n,droppedDirection:s}=e,l=Wm(i);if(!l)return;const a=o.collectionViewBlockStore(),c=yr.default.mark("collections.drop_item_lag");yr.default.measureAfterNextFlush(c,{environment:t,getData:()=>he.yr({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),a&&Q.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,perform:e=>{L.tQ({environment:t,collectionStore:l,targetStore:a,droppedDirection:s,collectionContextStore:o,groupsPointer:r?[r]:[],files:n,transaction:e})}})}(e,i,o,r,t),onRemove:e=>function(e,t){const{transaction:o}=e,r=Wm(t);if(!r)return;L.Od({store:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function Wm(e){return e.getAssociatedCollectionStore()}function $m(e,t,o,r,i){return n=>{const{insertStores:s,transaction:l}=n;return L.$T({environment:t,collectionStore:e,collectionContextStore:r,groupsPointer:i?[i]:[],insertStores:s,store:o,before:!1,transaction:l})}}function qm(e,t,o,r,i){return n=>{const{insertStores:s,transaction:l}=n;return L.$T({environment:t,collectionStore:e,collectionContextStore:r,groupsPointer:i?[i]:[],insertStores:s,store:o,before:!0,transaction:l})}}function Qm(e){let{store:t,groupFormat:o,collectionContextStore:r,canEdit:n,disabled:s,format:l}=e;window.__c={n:"TimelineDropzoneSelectableGroupResults"};const a=(0,oe.O7)(),[d]=(0,i.useState)((()=>new ge.G(a,t.pointer))),u=(0,c.VK)((()=>r.groupsStore.getGroupState(o)),[r,o]),p=(0,c.VK)((()=>r.permissionScopes.state),[r]),h=(0,c.VK)((()=>r.collectionViewStore()),[r]),m=(0,c.VK)((()=>n&&p.canEditContent&&!p.isSyncedCollection&&a.device.isMobile&&!(null!=h&&h.isSyncedCollection())),[n,h,a,p]),S=(0,i.useMemo)((()=>{if(d)return(0,v.jsx)(It.Z,{store:d,shouldShowDropZone:n,canDropBelow:n,canNativeDropBelow:n,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,r){const{droppedDirection:i,droppedStores:n,duplicate:s}=e,l=o.collectionStore();if(!l)return;const a=o.groupsStore.getGroupState(t);if(!a)return;const c=o.collectionViewBlockStore(),d=yr.default.mark("collections.drop_item_lag");yr.default.measureAfterNextFlush(d,{environment:r,getData:()=>he.yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),c&&Q.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:r,perform:e=>{L.by({environment:r,collectionStore:l,targetStore:c,droppedDirection:i,collectionContextStore:o,groupsPointer:a.groupsPointer,droppedStores:n,duplicate:s,transaction:e})}})}(e,o,r,a),onNativeDrop:e=>function(e,t,o,r){const{files:i,droppedDirection:n}=e,s=t.collectionStore();if(!s)return;const l=t.collectionViewBlockStore(),a=yr.default.mark("collections.drop_item_lag");yr.default.measureAfterNextFlush(a,{environment:r,getData:()=>he.yr({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),l&&Q.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:r,perform:e=>{L.tQ({environment:r,collectionStore:s,targetStore:l,droppedDirection:n,collectionContextStore:t,groupsPointer:o?[o]:[],files:i,transaction:e})}})}(e,r,o,a),analyticsName:"timeline",style:{width:"100%"}})}),[n,r,a,o,d]);return u?(0,v.jsxs)(v.Fragment,{children:[S,(0,v.jsx)(Ar,{collectionContextStore:r,groupsPointer:u.groupsPointer,format:l,canDrag:m,disableRequest:!0,resultProps:{groupFormat:o,collectionContextStore:r,isLast:!1,handleOpenPeekPage:_.ZT},canDrop:!0,resultComponent:Um,disabled:s,direction:Dr.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:Xm})]}):null}const Ym=i.memo(Qm,Jt.Z);function Xm(e){return(0,v.jsx)("div",{style:{width:"100%",height:Zh.Z+1}})}var Jm=o(62193);function eS(e){window.__c={n:"TimelineItemDependencyDrawHandle"};const{store:t,schema:o,timelineState:r,dateValueStore:n,collectionContextStore:s,isFullScreen:l,isRootChild:a}=e,d=(0,i.useRef)(null),[u,p]=(0,i.useState)(!1),h=(0,oe.O7)(),m=(0,c.VK)((()=>{const e=r.drawState.state;if(e)return e.startStore===t}),[t,r.drawState]),S=(0,c.VK)((()=>!m&&r.hoveredItem.state===t&&!Eo.Z.state),[m,t,r.hoveredItem]),g=(0,c.VK)((()=>(0,Bi.H5)(s)),[s]),C=(0,i.useCallback)((e=>{if(e.preventDefault(),!r.scrollLeft.state||!d.current)return;const i=(0,Se.VW)(d.current);Ah.J4({timelineState:r,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:s,verticalScroller:i}),p(!1)}),[s,o,t,r]),f=(0,i.useCallback)((e=>{if(!d.current)return;const t=(0,Se.VW)(d.current);Ah.mz({timelineState:r,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[r]),y=(0,i.useCallback)((()=>{Q.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:h,perform:e=>{Ah.$o({timelineState:r,environment:h,transaction:e,collectionContextStore:s,isFullScreen:l,isRootChild:a})}})}),[h,r,s,l,a]),x=(0,i.useCallback)((e=>{Ah.x({timelineState:r,environment:h})}),[h,r]),b=(0,i.useCallback)((()=>{p(!0)}),[p]),w=(0,i.useCallback)((()=>{p(!1)}),[p]),k=(0,re.yK)((e=>({draggableStyle:{position:"absolute",top:0,right:-24,width:24,height:"100%",zIndex:1},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:g?e.collectionValidDependencyArrow:e.collectionUnsetDependencyArrow,strokeWidth:Bi.lf},svgCircleFill:{color:e.white}})),[g]),_=(0,i.useCallback)((e=>{if(!n.state)return;return(0,v.jsx)("div",{ref:d,style:k.draggableStyle,...e,children:S&&(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("div",{style:k.draggableSvgStyle,children:(0,v.jsxs)("svg",{style:{width:22,height:30},onMouseMove:b,onMouseLeave:w,children:[(0,v.jsx)($h.Z,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},style:k.svgPathStyle,showArrowHead:u}),(0,v.jsx)("circle",{cx:u?10+Bi.S7:10,cy:14,r:u?Bi.S7:Bi.Wk,style:k.svgPathStyle,fill:k.svgCircleFill.color})]})})})})}),[n,w,b,S,k.draggableStyle,k.draggableSvgStyle,k.svgCircleFill.color,k.svgPathStyle,u]);return(0,v.jsx)(xl.Z,{render:_,onDraggableDragStart:C,onDraggableDragMove:f,onDraggableDragEnd:y,onDraggableDragCancel:x})}const tS={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},oS={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};function rS(e){let{type:t,store:o,query:r,schema:n,timelineState:s,dateValueStore:l,collectionContextStore:a,isInPeekRenderer:d,isFullScreen:u,isRootChild:p}=e;window.__c={n:"TimelineItemResizer"};const h=(0,oe.O7)(),m=(0,j.useIntl)(),[S,g]=(0,i.useState)(!1),C=(0,c.VK)((()=>{const e=s.dragState.state;return e?e.stores[0]===o&&("left"===t?e.type===Bi.px.LeftResizer:e.type===Bi.px.RightResizer):S&&!Eo.Z.state}),[S,o,s,t]),f=(0,c.VK)((()=>l.state),[l]),y=(0,c.VK)((()=>s.zoomLevel.state),[s]),x=(0,re.yK)((e=>{const t={position:"absolute",top:6,borderRadius:3,width:3,bottom:6,background:e.regularTextColor},o={fontSize:12,position:"absolute",width:200,lineHeight:`${Zh.Z}px`,pointerEvents:"none"};return{leftDraggableIndicator:{...t,left:Math.ceil(3.5)+1},rightDraggableIndicator:{...t,left:Math.floor(.5)},leftDraggableLabel:{...o,right:12,textAlign:"right"},rightDraggableLabel:{...o,left:12},timelineBackground:{background:d?e.peekTimelineBackground:e.timelineBackground,padding:4,borderRadius:4}}}),[d]),b=(0,i.useCallback)((()=>g(!0)),[]),w=(0,i.useCallback)((()=>g(!1)),[]),k=(0,i.useCallback)((e=>{Ah.td({timelineState:s,currentX:e.currentX})}),[s]),_=(0,i.useCallback)((()=>{Q.createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:h,perform:e=>{Ah.fX({timelineState:s,collectionContextStore:a,query:r,schema:n,intl:m,environment:h,transaction:e})}}),I.ne(h,{...(0,Bi.Ii)({environment:h,collectionContextStore:a,timelineState:s,isFullScreen:u,isRootChild:p}),type:t})}),[a,h,m,u,p,r,n,s,t]),T=(0,i.useCallback)((e=>{e.preventDefault(),Ah.f$({timelineState:s,store:o,startX:e.startX,type:"left"===t?Bi.px.LeftResizer:Bi.px.RightResizer,query:r,schema:n,intl:m,environment:h})}),[h,m,r,n,o,s,t]),V=(0,i.useCallback)((()=>{Ah.cQ({timelineState:s,environment:h})}),[h,s]),O=(0,i.useCallback)((e=>{const o="left"===t;if(f)return(0,v.jsx)("div",{style:o?oS:tS,onMouseMove:b,onMouseLeave:w,...e,children:C&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:o?x.leftDraggableIndicator:x.rightDraggableIndicator}),(0,v.jsx)("span",{style:o?x.leftDraggableLabel:x.rightDraggableLabel,children:(0,v.jsx)("span",{style:x.timelineBackground,children:o?(0,Bi.yk)(f,y):(0,Bi.fc)(f,y)})})]})})}),[f,y,w,b,C,x,t]);return(0,v.jsx)(xl.Z,{render:O,onDraggableDragStart:T,onDraggableDragMove:k,onDraggableDragEnd:_,onDraggableDragCancel:V})}const iS=i.memo(rS,Jt.Z),nS=(0,j.defineMessages)({typeAName:{defaultMessage:"Type a nameâ¦",id:"timelineItem.itemName.placeholder"}});var sS=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}(sS||{});class lS extends s.Z{constructor(){super(...arguments),this.propertiesWrapEl=i.createRef(),this.renderProperty=(e,t)=>{const{showProperties:o,store:r,disabled:i,blockPropertyValueOverlayStore:n,clonedStore:s}=this.props,l=t===o.length-1,a=null==r?void 0:r.getAssociatedCollectionStore();if(a){if("title"===e)return this.renderTitle(l);if(r&&s)return(0,v.jsx)(vo.Z,{store:s,property:e,disabled:i||!r.canEdit(),locked:!1,format:yo.C.Timeline,tableWrap:!1,isLast:l,blockPropertyValueOverlayStore:n,enablePointerEventsForInteractiveTypes:!0,collectionStore:a,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e)}},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDateRangeButtonMouseMove=()=>function(e,t,o,r){const i=o.dragState.state;if((Eo.Z.state||i)&&!r.state||e.device.isPhone)return;o.hoveredItem.setState(t)}(this.environment,this.props.store,this.props.timelineState,this.isDrawingDependencyStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDateRangeButtonMouseLeave=()=>function(e,t){const o=e.dragState.state;if((Eo.Z.state||o)&&!t.state)return;e.hoveredItem.setState(void 0)}(this.props.timelineState,this.isDrawingDependencyStore),this.handleAnimationStateChange=()=>{const{current:e}=this.propertiesWrapEl,t=this.animationStateStore.state;e&&t&&(e.style.position=t.position===sS.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)},this.pageURLStore=this.createComputedStore((()=>{const{store:e}=this.props;if(e)return(0,Bo.ZP)({store:e,fullyQualified:!1,pageVisitSource:u.tY.LinkInPage})})),this.peekURLStore=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=Lo.default.state;if(e&&o)return le.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.isHoveredStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props;return t.hoveredItem.state===e})),this.isDrawingDependencyStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.drawState.state;return o&&o.startStore!==e})),this.editingTitleStore=this.createComputedStore((()=>{var e;const{store:t}=this.props,o=Go.default.state;if("editing"!==o.mode)return!1;const r=null===(e=(0,No.QY)(o.multiSelection))||void 0===e?void 0:e.store;return t&&r&&r===t.getBlockTitleStore()})),this.animationStateStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,itemPositionStore:o}=this.props,r=o.state;if(r){const{left:o,right:i}=r,n=i-o;if(!((0,Bi.Tp)(this.environment)&&n>50))return{position:sS.Absolute,left:o};{const r=e.scrollLeft.state;if(void 0!==r){const e=r+t-o+21;if(e<0)return{position:sS.Absolute,left:o};if(e>n)return{position:sS.Absolute,left:i};if(e>0)return{position:sS.Sticky,left:t+21}}}}})),this.passesFilterStore=this.createComputedStore((()=>{var e,t;const o=this.props.parentStore,r=(0,Ut.m1)({collectionContextStore:this.props.collectionContextStore,collectionStore:o,environment:this.environment}),i=null===(e=this.props.store)||void 0===e?void 0:e.getModel(),n=null===(t=this.props.store)||void 0===t?void 0:t.getRecordModel;if(!r||!i||!n)return!0;const s=Yt.default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs");return(0,xr.q)(r)({block:i,getRecordModel:n,propertyMapping:null==o?void 0:o.getPropertyMapping(),formulaTimeoutTimestampMs:Date.now()+s,resultCache:new Map})})),this.shouldShowHighlightHalo=this.createComputedStore((()=>!!this.props.store&&le.Sc(this.props.store))),this.isTypedMSVCollection=this.createComputedStore((()=>"collectionTypedView"===this.props.collectionContextStore.contextType))}didMount(){super.didMount(),this.animationStateStore.addListener(this.handleAnimationStateChange),this.handleAnimationStateChange()}willUnmount(){super.willUnmount(),this.animationStateStore.removeListener(this.handleAnimationStateChange)}UNSAFE_willUpdate(){this.animationStateStore.enqueueRecompute()}renderComponent(){const{itemPositionStore:e,store:t,timelineState:o,query:r,schema:i,dateValueStore:n,disabled:s,isDraggingViaTimelineItemStore:l,collectionContextStore:a,isFullScreen:c,isRootChild:d}=this.props,u=e.state;if(!u)return;const p=(0,Bi.H5)(a),{left:h,right:m,maskPercent:S}=u,g=this.isHoveredStore.state,C=this.pageURLStore.state,f=this.peekURLStore.state,y=!s&&(null==t?void 0:t.canEdit()),x=this.environment.device.isPhone,b=y&&!x&&(p||a.permissionScopes.state.canConfigureBlock)&&!this.isTypedMSVCollection.state,w=a.currentSubitemFormatStoreForUiDisplay.state?42:10,k=Math.max(m-h,w)+1,_=l.state,T=(0,v.jsx)(dS,{collectionContextStore:this.props.collectionContextStore,toggleButton:this.props.toggleButton,itemPositionStore:this.props.itemPositionStore}),V=this.passesFilterStore.state,O=a.isCompactView.state;return t&&!u.isPlaceholder?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(It.Z,{style:uS(h,k,_,u,V,this.props.isInPeekRenderer,this.theme),haloStyle:(P=this.theme,R=this.shouldShowHighlightHalo,{borderRadius:4,...le.pB(R.state,P)}),className:ro.ovr,store:t,canSelect:!0,shouldShowHalo:!O,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,canDrag:y,analyticsName:"timeline",onDraggableDragStart:pS,onDraggableDragMove:e=>function(e,t,o,r,i,n,s){if(!t)return;o.dragState.state||Ah.f$({timelineState:o,store:t,startX:e.startX,type:Bi.px.ItemDrag,query:r,schema:i,intl:n,environment:s});Ah.td({timelineState:o,currentX:e.currentX})}(e,this.props.store,this.props.timelineState,this.props.query,this.props.schema,this.props.intl,this.environment),onDraggableDragEnd:()=>function(e,t,o,r,i,n){Q.createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:n,perform:s=>{Ah.fX({timelineState:e,collectionContextStore:t,query:o,schema:r,intl:i,environment:n,transaction:s})}})}(this.props.timelineState,this.props.collectionContextStore,this.props.query,this.props.schema,this.props.intl,this.environment),onDraggableDragCancel:()=>function(e,t){Ah.cQ({timelineState:e,environment:t})}(this.props.timelineState,this.environment),canTriggerContextMenu:y,getGhostElement:hS,disableScrollToReveal:!0,onMouseMove:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDateRangeButtonMouseMove,onMouseLeave:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDateRangeButtonMouseLeave,showBlockMenuInput:!0,children:[T,(0,v.jsx)(To.Z,{style:{width:"100%",height:"100%",borderRadius:4},innerStyle:{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:4},onClick:this.props.handleOpenPeekPage,href:C,metaHref:f,hovered:g,ignoreLocalHoverState:!0}),b&&this.props.store&&(0,v.jsx)(eS,{store:this.props.store,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,schema:this.props.schema,timelineState:this.props.timelineState,dateValueStore:this.props.dateValueStore,collectionContextStore:this.props.collectionContextStore}),y&&!x&&(0,v.jsx)(iS,{type:"left",store:t,query:r,schema:i,timelineState:o,dateValueStore:n,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:d}),y&&!x&&(0,v.jsx)(iS,{type:"right",store:t,query:r,schema:i,timelineState:o,dateValueStore:n,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:d})]}),this.renderProperties(S,_,V)]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:uS(h,k,_,u,V,this.props.isInPeekRenderer,this.theme),className:ro.ovr}),this.renderProperties(S,_,V)]});var P,R}renderProperties(e,t,o){const{showProperties:r}=this.props;return(0,v.jsx)("div",{style:SS(e,t,o,this.isHoveredStore),children:(0,v.jsx)("div",{style:cS(this.props.collectionContextStore,this.props.toggleButton),ref:this.propertiesWrapEl,className:ro.z_z,children:r.map(this.renderProperty)})})}renderTitle(e){var t;const{store:o,collectionContextStore:r,parentStore:i}=this.props,n=o?o.getIcon():void 0,s=null==r?void 0:r.shouldShowPageIcon(),l=null==o?void 0:o.hasError(),a=!o||o.isEmptyPage(),c=this.editingTitleStore.state,d=r.currentSubitemFormatStoreForUiDisplay.state,u=d&&i?null===(t=i.getSchema()[d.property])||void 0===t?void 0:t.name:"";return(0,v.jsxs)("div",{style:{display:"flex",marginRight:e?0:10,fontSize:14,fontWeight:R.Z.fontWeight.medium,alignItems:"center"},children:[s&&n&&!l&&(0,v.jsx)(Vo.Z,{disabled:!0,icon:n,isEmptyPage:a,size:20,style:{marginLeft:2,marginRight:6}}),l&&(0,po.t)({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:this.theme.accentColors.orange[500]}),o&&!c&&(0,v.jsx)(Wa.Z,{style:{whiteSpace:"nowrap",maxWidth:400},store:o}),c&&o&&(0,v.jsx)(Po.Z,{store:o.getBlockTitleStore(),style:{whiteSpace:this.environment.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:()=>mS(this.props.store,this.environment),onEsc:()=>mS(this.props.store,this.environment),onTab:_.yR,placeholder:ze.default.formatMessage(nS.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline"}),o&&(0,Fo.Cr)({collectionContextStore:r,blockId:o.id,blockStore:o})&&(0,v.jsx)("div",{style:{paddingTop:2,paddingLeft:4},children:(0,v.jsx)(bo.O,{blockStore:o,collectionContextStore:r})}),o&&(0,Fo.wI)({collectionContextStore:r,blockStore:o})&&(0,v.jsx)("div",{style:{paddingTop:2,paddingLeft:8,color:this.theme.lightTextColor},children:(0,v.jsx)(wo.B,{blockStore:o,collectionContextStore:r})}),!o&&(0,v.jsx)("span",{children:i&&u?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:u}}):(0,v.jsx)(j.FormattedMessage,{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})})]},"title")}}lS.displayName="TimelineItemDateRange";const aS=lS;function cS(e,t){const o=e.currentSubitemFormatStoreForUiDisplay.state;return{display:"flex",height:Zh.Z-2+1,paddingLeft:o&&t?24:6,width:800,overflow:"hidden"}}function dS(e){let{collectionContextStore:t,toggleButton:o,itemPositionStore:r}=e;window.__c={n:"ToggleButton"};const i=(0,c.VK)((()=>t.currentSubitemFormatStoreForUiDisplay.state),[t]),n=(0,c.VK)((()=>r.state),[r]);return!i||!o||null!=n&&n.isExistingSubitemPlaceholder?null:(0,v.jsx)("span",{style:{zIndex:1,paddingTop:3},children:o})}function uS(e,t,o,r,i,n,s){const l=s.mode;return{position:"absolute",left:e,marginTop:1,marginBottom:1,width:t,height:Zh.Z-2,borderRadius:4,display:"flex",...r.isExistingSubitemPlaceholder?void 0:{..."light"===l?{background:r.isPlaceholder?s.buttonHoveredBackground:s.contentBackground,boxShadow:r.isPlaceholder?void 0:s.buttonBoxShadow}:{background:n?s.calendarItemBackground:s.popoverBackground,boxShadow:r.isPlaceholder?void 0:s.lightBoxShadow}},...r.isPlaceholder&&{cursor:"crosshair"},...o&&{display:"none"},...!i&&{opacity:.5},zIndex:M.ov}}function pS(e){e.preventDefault()}function hS(e){const t=da.C.findSelectablesFromStore(e),o=_.oA(t.map((e=>e.getNode()))),r=_.oA(o.map((e=>e.closest(`.${ro.o4s}`))))[0];if(r){const e=Wp.eN(r),t=e.cloned.querySelector(`.${ro.ovr}`),o=e.cloned.querySelector(`.${ro.z_z}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map(Wp.eN)}function mS(e,t){e&&W.Ys({environment:t,store:e})}function SS(e,t,o,r){return{width:"100%",WebkitMaskImage:e<1&&r.state?`linear-gradient(90deg, rgba(0,0,0,1) ${100*e}%, rgba(0,0,0,0.4) ${100*e}%)`:void 0,pointerEvents:"none",...t&&{display:"none"},zIndex:M.ov,opacity:o?1:.5}}var gS=o(31505),CS=o(39301),fS=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(fS||{});function vS(e){let{store:t,type:o,timelineState:r,scrollerLeftOffset:n,paddingLeft:s,format:l,itemPositionStore:a,dateValueStore:d,isDraggingViaTimelineItemStore:u,collectionContextStore:p,isFullScreen:h,isInPeekRenderer:m,isRootChild:S}=e;window.__c={n:"TimelineScrollArrow"};const g=(0,oe.O7)(),C=(0,i.useRef)(fS.NotDefined),f=(0,i.useRef)(null),y=(0,i.useRef)(null),[x,b]=(0,i.useState)(!1),w="left"===o?gS.Y:CS.n,k=(0,c.VK)((()=>r.outerSizeObserver.rect.state),[r]),_=(0,c.SI)((()=>{const e=a.state;if(e){const{left:t,right:i}=e;if(u.state)return fS.Hidden;const s=r.scrollLeft.state;if(void 0!==s){if("left"===o){const e=s+n;if(e-i>0)return fS.VisibleOutOfItem;if(e-t>0)return fS.VisibleInItem}else{const e=s+k.width;if(t-e>0)return fS.VisibleOutOfItem;if(i-e>0)return fS.VisibleInItem}return fS.Hidden}}return fS.NotDefined}),[u,a,k,n,r,o]),T=(0,re.yK)((e=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:x?e.regularIconColor:e.mediumIconColor,borderRadius:4,border:`1px solid ${e.contentBackground}`,..."left"===o&&{marginLeft:8,marginRight:4},..."right"===o&&{marginRight:8,marginLeft:4}},icon:{height:6,fill:m?e.cardContentBackground:e.contentBackground},wrap:{position:"sticky",left:"left"===o?n:k.width-220,width:220,height:Ia-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===o?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis",zIndex:M.fQ}})),[x,m,k,n,o]);(0,i.useLayoutEffect)((()=>{V()}),[]),(0,i.useEffect)((()=>(_.addListener(V),()=>{_.removeListener(V)})),[]),(0,i.useEffect)((()=>{_.enqueueRecompute()}));const V=(0,i.useCallback)((()=>{const e=f.current,t=y.current;if(e&&t){const o=_.state,r=o===fS.VisibleInItem||o===fS.VisibleOutOfItem;e.style.opacity=""+(r?1:0),e.style.transform=`scale(${r?1:.3})`,t.style.pointerEvents=o===fS.VisibleOutOfItem?"":"none";C.current!==fS.NotDefined&&o!==fS.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),C.current=o}}),[_]),O=(0,i.useCallback)((()=>{const e=d.state,i=r.zoomLevel.state,{snapUnit:n}=Bi.BJ[i],a=(0,Bi.x2)(i,200);if(e)if("left"===o){const{start:t}=(0,Bi.XO)(e,n),o=(0,Bi.GK)({timestamp:t.valueOf(),environment:g,timelineState:r,paddingLeft:s,format:l})-a;Ah.Nf({timelineState:r,environment:g,zoomLevel:i,centerTimestamp:o})}else{const{end:t}=(0,Bi.XO)(e,n),o=(0,Bi.PF)({timestamp:t.valueOf(),timelineState:r})+a;Ah.Nf({timelineState:r,environment:g,zoomLevel:i,centerTimestamp:o})}b(!1),W.Ys({environment:g,store:t}),I.gw(g,{...(0,Bi.Ii)({environment:g,collectionContextStore:p,timelineState:r,isFullScreen:h,isRootChild:S}),type:o})}),[p,d,g,l,h,S,s,t,r,o]),P=(0,i.useCallback)((()=>{g.device.isPhone||Eo.Z.state||b(!0)}),[g]),R=(0,i.useCallback)((()=>{g.device.isPhone||b(!1)}),[g]);return(0,v.jsxs)("div",{style:T.wrap,onMouseOver:P,onMouseOut:R,onMouseDown:me.$0,onClick:O,ref:y,children:[(0,v.jsx)("div",{style:T.arrow,ref:f,children:w(T.icon)}),x&&(0,v.jsx)(xS,{dateValueStore:d,timelineState:r,isInPeekRenderer:m})]})}const yS=i.memo(vS,Jt.Z);function xS(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:r}=e;window.__c={n:"DateRangeComponent"};const i=(0,re.yK)((e=>({dateRange:{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:r?e.peekTimelineBackground:e.timelineBackground,pointerEvents:"none"}})),[r]),n=(0,c.VK)((()=>t.state),[t]),s=(0,c.VK)((()=>o.zoomLevel.state),[o]);return n?(0,v.jsx)("span",{style:i.dateRange,children:(0,Bi._Q)(n,s)}):null}class bS extends s.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.dateRangeRef=i.createRef(),this.storeTypes={nodeStore:d.default.createClass(null)},this.handleMouseMove=e=>{const{timelineState:t,store:o,groupFormat:i,disabled:n,query:s,schema:l}=this.props,a=t.dragState.state,c=t.drawState.state,{horizontalScroller:d}=t,u=t.scrollLeft.state,p=t.zoomLevel.state,h=t.currentRange.state,{snapUnit:m,getDateRangePlaceholderDuration:S}=Bi.BJ[p];if(!c&&Eo.Z.state||a||kS(this.props.store,this.props.query,this.props.schema,this.environment)||!d||void 0===u||n)return;const g=d.getBoundingClientRect(),C=u+(e.clientX-g.left),f=(0,Bi.x2)(p,C),v=r.ou.fromMillis(h.startTimestamp+f),y=(0,Bi.DS)(v,m),x=(0,Bi.DS)(S(v),m),b=(0,Pu.hT)(y.valueOf(),(0,Ee.r)()),w=(0,Bi.AZ)({startValue:b,snapUnit:m,desiredStart:y,desiredEnd:x});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:this.parentCollectionStore.state,groupFormat:i,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:s,schema:l}})},this.handleClick=e=>{const{store:t,query:o,schema:r,timelineState:i,groupFormat:n,collectionContextStore:s}=this.props,l=i.dateRangePlaceholder.state,a=s.groupsStore.getGroupState(n);if(a)if(l.active){const{date:e}=l;Q.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:i=>{Ah.oP({environment:this.environment,store:t,query:o,schema:r,date:e,transaction:i})}}),i.dateRangePlaceholder.setState({active:!1})}else{const{timelineState:o,collectionContextStore:r}=this.props,{horizontalScroller:i}=o,n=o.scrollLeft.state,s=this.itemPositionStore.state,l=this.dateRangeRef.current;if(!i||void 0===n||!s||!l)return;const c=i.getBoundingClientRect(),d=n+(e.clientX-c.left),p=l.propertiesWrapEl.current;if(!p)return;const h=p.lastElementChild;if(!h)return;const m=n+(h.getBoundingClientRect().right-c.left);d>s.right&&d<=m&&(0,me.ZP)({event,context:me.Af.EditorClick,callback:()=>{(0,aa.X9)()||se.CH({environment:this.environment,store:t,openInNew:Sr.DJ(e),peekMode:(0,le.kr)(r.collectionViewStore()),resultsStore:a.resultsStore,collectionContextStore:r,pageVisitSource:u.tY.PeekOpen})}})}},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onRefChange=e=>function(e,t){t.setState(e)}(e,this.stores.nodeStore),this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,Bi.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:this.subitemPlaceholderDateStore.state})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.shouldRenderScrollArrowsStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e&&!e.isPlaceholder)})),this.subitemPlaceholderDateStore=this.createComputedStore((()=>{const{subitemPath:e}=this.props,t=(0,kr.ub)(e);if(!t||Boolean(this.dateValueStore.state))return;const o=t.value.store,r=Kh.findCollectionTimelineViewItems(o);if(r.length>0){return r[0].dateValueStore.state}})),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,timelineState:t,groupFormat:o}=this.props,r=t.dateRangePlaceholder.state;if(r.active&&r.store===e&&!r.newTimelineItemProps&&(0,ie.ZH)(r.groupFormat,o))return r.date})),this.dateValueStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,r=this.placeholderDateStore.state;if(r)return r;if(o){const t=o.stores.indexOf(e);if(t>=0)return o.temporaryValues[t]}return kS(this.props.store,this.props.query,this.props.schema,this.environment)}),!0),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,r=Mr.ZP.state;return Boolean(o&&o.stores.includes(e)&&r.isDragging&&r.draggedStores.includes(e))})),this.parentCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore()))}get registries(){return[Kh]}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.clonedStore=e.store.clone()}renderComponent(){var e;const{store:t,timelineState:o,scrollerLeftOffset:r,paddingLeft:i,format:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:u,isFullScreen:p,isRootChild:h,toggleButton:m,groupFormat:S}=this.props,g=this.shouldRenderDateRangeStore.state,C=this.shouldRenderScrollArrowsStore.state,f=null===(e=u.groupsStore.getGroupState(S))||void 0===e?void 0:e.reducerResultStore;if(f)return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{style:{display:"flex",height:0},children:[C&&(0,v.jsx)(yS,{store:t,type:"left",timelineState:o,scrollerLeftOffset:r,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:i,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h}),C&&(0,v.jsx)(yS,{store:t,type:"right",timelineState:o,scrollerLeftOffset:r,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:i,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:p,isRootChild:h})]}),(0,v.jsx)("div",{style:{display:"flex",height:Zh.Z+1,width:"100%",cursor:"default"},onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),z.AI({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onMouseMove:this.handleMouseMove,onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(this.props.timelineState),onClick:this.handleClick,className:ro.o4s,ref:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onRefChange,children:g&&(0,v.jsx)(aS,{store:t,parentStore:this.parentCollectionStore.state,toggleButton:m,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:s,schema:l,timelineState:o,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:r,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,intl:ze.default.getIntl(),ref:this.dateRangeRef,resultStore:f,handleOpenPeekPage:this.props.handleOpenPeekPage})})]})}}bS.displayName="CollectionTimelineViewItem";const wS=bS;function kS(e,t,o,r){return(0,Bi.bk)({store:e,query:t,schema:o,userId:r.currentUser.id,intl:ze.default.getIntl()})}class _S extends s.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,Bi.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:void 0})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>!1)),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,parentStore:t,timelineState:o,groupFormat:r}=this.props,i=o.dateRangePlaceholder.state;if(i.active&&i.store===e&&i.newTimelineItemProps&&i.parentStore===t&&(0,ie.ZH)(i.groupFormat,r))return i.date})),this.dateValueStore=this.createComputedStore((()=>{const e=this.placeholderDateStore.state;if(e)return e}),!0)}UNSAFE_willMount(e){super.UNSAFE_willMount(e),e.store&&(this.clonedStore=e.store.clone())}renderComponent(){var e;const{store:t,parentStore:o,timelineState:i,scrollerLeftOffset:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:u,isFullScreen:p,isRootChild:h,toggleButton:m,groupFormat:S}=this.props,g=this.shouldRenderDateRangeStore.state,C=null===(e=u.groupsStore.getGroupState(S))||void 0===e?void 0:e.reducerResultStore,f=!t&&!g&&u.shouldAllowNewItemCreation();if(C)return(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("div",{style:{display:"flex",height:Zh.Z+1,width:"100%",cursor:"default"},onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),z.AI({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onMouseMove:e=>function(e,t,o,i,n,s,l,a,c,d,u,p){var h;const m=t.drawState.state,S=t.dragState.state,{horizontalScroller:g}=t,C=t.scrollLeft.state,f=t.zoomLevel.state,v=t.currentRange.state,{snapUnit:y,getDateRangePlaceholderDuration:x}=Bi.BJ[f];if(!m&&Eo.Z.state||S||!g||void 0===C||n)return;const b=null===(h=d.groupsStore.getGroupState(i))||void 0===h?void 0:h.resultsStore;if(!b)return;const w=g.getBoundingClientRect(),k=C+(e.clientX-w.left),_=(0,Bi.x2)(f,k),T=r.ou.fromMillis(v.startTimestamp+_),V=(0,Bi.DS)(T,y),O=(0,Bi.DS)(x(T),y),P=(0,Pu.hT)(V.valueOf(),(0,Ee.r)()),R=(0,Bi.AZ)({startValue:P,snapUnit:y,desiredStart:V,desiredEnd:O});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:u,groupFormat:i,date:R,newTimelineItemProps:{query:s,schema:l,resultsStore:b,isFullScreen:a,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,this.props.timelineState,this.props.store,this.props.groupFormat,this.props.disabled,this.props.query,this.props.schema,this.props.isFullScreen,this.props.canEditTimelineItems,this.props.collectionContextStore,this.props.parentStore,this.props.subitemPath),onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(this.props.timelineState),onClick:e=>function(e,t,o,r,i,n,s,l,a,c,d,u){const p=i.dateRangePlaceholder.state;if(p.active){const{date:e}=p,h=u?u.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";Q.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,perform:i=>{const p=Ah.mg({environment:t,transaction:i,date:e,store:c,parentStore:d,query:o,schema:r,isFullScreen:n,groupFormat:s,canEditTimelineItems:l,collectionContextStore:a,subitemPath:u,from:h});ue.W(t,{from:h,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,he.Pn)(a)})}}),i.dateRangePlaceholder.setState({active:!1})}}(0,this.environment,this.props.query,this.props.schema,this.props.timelineState,this.props.isFullScreen,this.props.groupFormat,this.props.canEditTimelineItems,this.props.collectionContextStore,this.props.store,this.props.parentStore,this.props.subitemPath),className:ro.o4s,children:[g&&(0,v.jsx)(aS,{store:o?void 0:t,parentStore:o,toggleButton:m,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:s,schema:l,timelineState:i,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,intl:ze.default.getIntl(),resultStore:C,handleOpenPeekPage:()=>{}}),f&&(0,v.jsx)(PS,{parentStore:this.props.parentStore,collectionContextStore:this.props.collectionContextStore,paddingLeft:this.props.paddingLeft,isFullScreen:this.props.isFullScreen,showTable:this.props.showTable})]})})}}_S.displayName="CollectionTimelineViewItemNew";const TS=_S;function VS(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function OS(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.mediumIconColor}}function PS(e){let{parentStore:t,collectionContextStore:o,paddingLeft:r,isFullScreen:i,showTable:n}=e;window.__c={n:"AddRowIndicatorComponent"};const s=(0,re.Fg)(),l=(0,c.VK)((()=>o.currentSubitemFormatStoreForUiDisplay.state),[o]),a=(0,c.VK)((()=>{var e;return l&&t?null===(e=t.getSchema()[l.property])||void 0===e?void 0:e.name:""}),[l,t]);return(0,v.jsx)("div",{style:VS(r,i,n),children:(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:Fa,lineHeight:R.Z.lineHeight.UIRegular.desktop},children:[(0,de.R)(OS(s)),(0,v.jsx)("span",{style:{color:s.mediumTextColor},children:t&&a?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:a}}):(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}class RS extends s.Z{constructor(){super(...arguments),this.resultPropsMemo=new Jm.Uw,this.resultProps=()=>{const{groupFormat:e,disabled:t,query:o,format:r,schema:i,blockPropertyValueOverlayStore:n,collectionContextStore:s,isFullScreen:l,isRootChild:a,showTable:c,canEditTimelineItems:d,scrollerLeftOffsetStore:u,timelineState:p,paddingLeft:h,showTimelinePropertiesStore:m,isInPeekRenderer:S}=this.props,g=s.permissionScopes.state;return this.resultPropsMemo.memo((()=>({disabled:t||!("collectionTypedView"===s.contextType||g.canEditContent),timelineState:p,schema:i,query:o,format:r,scrollerLeftOffset:u.state,paddingLeft:h,showProperties:m.state,blockPropertyValueOverlayStore:n,collectionContextStore:s,isFullScreen:l,showTable:c,isRootChild:a,groupFormat:e,canEditTimelineItems:d,isInPeekRenderer:S,handleOpenPeekPage:()=>IS(this.props.collectionContextStore,this.props.groupFormat,this.environment),isLast:!1})),[t,p,i,o,r,u,g,h,m,n,s,l,c,a,e,d,S,()=>IS(this.props.collectionContextStore,this.props.groupFormat,this.environment)])},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,schema:t,groupFormat:o,query:r,showTable:i}=this.props;if(!r.timeline_by)return;const n=e.groupsStore.getGroupState(o);if(!n)return;const s=n.currentLimit.state,l=_.oA([o&&(0,Ae.Ko)({schema:t,propertyMapping:void 0,group:o,timeZone:(0,Ee.r)()}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:l.length>0?{operator:"and",filters:l}:void 0,limit:s}}))}renderComponent(){const{store:e,format:t,groupFormat:o,collectionContextStore:r,isFullScreen:i,paddingLeft:n,showTable:s}=this.props,l=r.groupsStore.getGroupState(o);if(!l)return;const a=o?[o]:[],c=this.resultsReducerStore.state,d=l.reducerResultStore.state,u=le.VM({collectionContextStore:r,reducerResult:d,isFullScreen:i});return(0,v.jsxs)(v.Fragment,{children:[c&&(0,v.jsx)(Ke.Z,{id:a.length>0?`results:${(0,ie.KW)(a)}`:"timeline_results",reducer:c,groupsPointer:a,collectionContextStore:r,resultStore:l.reducerResultStore}),this.renderCollectionGroupResults(),u&&(0,v.jsx)("div",{style:{width:"100%"},children:s?(0,v.jsx)("div",{style:{height:33}}):(0,v.jsx)(qr,{style:{position:"sticky",left:i?n:3,width:"max-content",height:33},groupsPointer:a,store:e,collectionContextStore:r,format:t,isFullScreen:i,incrementLimitsInRelatedGroups:!1})}),(0,v.jsx)(MS,{...this.props,store:void 0,indentLevel:0,handleOpenPeekPage:()=>IS(this.props.collectionContextStore,this.props.groupFormat,this.environment)})]})}renderCollectionGroupResults(){const{groupFormat:e,format:t,collectionContextStore:o}=this.props,r=o.groupsStore.getGroupState(e);if(r)return(0,v.jsx)(Ar,{disableSelectable:!0,collectionContextStore:o,groupsPointer:r.groupsPointer,format:t,canDrag:!1,disableRequest:!0,resultProps:this.resultProps(),canDrop:!1,resultComponent:wS,disabled:!0,direction:Dr.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:e=>function(e,t,o){return(0,v.jsx)(MS,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>IS(o.collectionContextStore,o.groupFormat,t)})}(e,this.environment,this.props)})}}function MS(e){window.__c={n:"AddRowTimelineItem"};const{store:t,parentStore:o,subitemPath:r,timelineState:i,disabled:n,query:s,format:l,schema:a,collectionContextStore:d,blockPropertyValueOverlayStore:u,isFullScreen:p,isRootChild:h,groupFormat:m,paddingLeft:S,showTimelinePropertiesStore:g,scrollerLeftOffsetStore:C,showTable:f,canEditTimelineItems:y,isInPeekRenderer:x,isReady:b,canEdit:w}=e,k=(0,c.VK)((()=>d.groupsStore.getGroupState(m)),[d,m]),_=(0,c.VK)((()=>d.permissionScopes.state),[d.permissionScopes]),T=(0,c.VK)((()=>C.state),[C]),V=(0,c.VK)((()=>g.state),[g]);return k&&b&&w&&!_.isSyncedCollection?(0,v.jsx)(TS,{store:t,disabled:n||!_.canEditContent,timelineState:i,schema:a,query:s,format:l,scrollerLeftOffset:T,paddingLeft:S,showProperties:V,blockPropertyValueOverlayStore:u,collectionContextStore:d,isFullScreen:p,showTable:f,isRootChild:h,groupFormat:m,canEditTimelineItems:y,isInPeekRenderer:x,parentStore:o,subitemPath:r}):null}RS.displayName="TimelineItemGroupResults";const jS=(0,j.injectIntl)(RS);function IS(e,t,o){const r=e.groupsStore.getGroupState(t);if(!r)return;yr.default.mark("collections.open_item_page_lag");const i=e.collectionViewStore();H.Xd({collectionContextStore:e,resultsStore:r.resultsStore});const n=null==i?void 0:i.getFormat().collection_peek_mode,s=n||Rr.Ls.timeline;Or.hy(o,{is_peek:!0,from:"timeline",peek_mode:s})}function FS(){window.__c={n:"TimelineTableShimmer"};const e=(0,re.yK)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,v.jsx)("div",{style:e.rowContainer,children:(0,v.jsx)(Ei.Z,{style:e.rowShimmer})})}class BS extends s.Z{constructor(){super(...arguments),this.groupsPointerMemo=new Jm.Uw,this.groupsPointer=()=>{const{groupFormat:e}=this.props;return this.groupsPointerMemo.memo((()=>e?[e]:[]),[e])},this.renderGroupResults=e=>{const{device:t}=this.environment,{schema:o,disabled:r,collectionContextStore:i,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,groupFormat:c}=this.props,d=i.collectionViewStore();if(!d)return;const u=this.groupsPointer();if(!i.groupsStore.getGroupState(u))return;const p=s.state,h=!l&&t.isMobile&&!d.isSyncedCollection(),m=this.titleColumnIndexStore.state;return(0,v.jsx)(Ar,{collectionContextStore:i,groupsPointer:u,disableRequest:!0,format:a,canDrag:h,resultProps:{schema:o,collectionContextStore:i,propertyFormats:p,onPropertyTab:e.onPropertyTab,onPropertyUntab:e.onPropertyUntab,onPropertyEnter:e.onPropertyEnter,onPropertyClick:e.onPropertyClick,onPropertyEsc:e.onPropertyEsc,onPropertyBgClick:e.onPropertyBgClick,onPropertyContextMenu:e.onPropertyContextMenu,onOpenProperty:e.onOpenProperty,disabled:r,blockPropertyValueOverlayStore:n,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableTableWrap:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:DS,titleColumnIndex:m,groupFormat:c,shouldShowMultiSelectCheckbox:!1},resultComponent:Xl,canDrop:!1,disabled:r,direction:Dr.Vertical,getItemSelectableStyle:()=>({display:"flex",borderBottom:`1px solid ${this.theme.tableDividerColor}`,width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:e.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:n,titleColumnIndex:m,nestedCreateSubitemButton:this.nestedCreateSubitemButton})},this.nestedCreateSubitemButton=e=>{const{collectionContextStore:t,disabled:o}=this.props,{store:r,parentStore:i,subitemPath:n,indentLevel:s}=e;if(i)return(0,v.jsx)(Qn,{store:r,collectionStore:i,subitemPath:n,indentLevel:s,collectionContextStore:t,disabled:o,groupsPointer:this.groupsPointer(),onSubitemCreate:e=>function(e,t,o,r){o&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{mo.bA({isNewBlock:!0,environment:r,blockPropertyValueOverlayStore:o,store:e,property:"title",format:yo.C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})}))}))}(e,this.props.collectionContextStore,this.props.blockPropertyValueOverlayStore,this.environment)})},this.handleAddRowClick=()=>{const{collectionContextStore:e,isFullScreen:t,groupFormat:o}=this.props,{device:r}=this.environment,i=o?[o]:[],n=e.groupsStore.getGroupState(i);if(!Ce.M_(this.environment)||!n)return;e.searchQuery.state&&pe.Ug({searchQuery:"",collectionContextStore:e,isFullScreen:t});const s=e.currentSubitemFormatStoreForCollection.state;Q.createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:this.environment,perform:t=>{const i=L.IW({environment:this.environment,collectionContextStore:e,groupsPointer:o?[o]:[],shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"timeline_table_group_results"});if(i){if(r.isMobile){const e=(0,Bo.ZP)({store:i.newStore,fullyQualified:!1,pageVisitSource:u.tY.Create});this.navigate(e)}else l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{if(i.coercionSucceeded)mo.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:i.newStore,property:"title",format:yo.C.Table,collectionContextStore:e,disableHorizontalEdgeScroll:!0});else{const t=o?[o]:[],r=e.groupsStore.getGroupState(t);se.CH({environment:this.environment,store:i.newStore,peekMode:(0,le.kr)(e.collectionViewStore()),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:e,pageVisitSource:u.tY.Create})}}))}));ue.W(this.environment,{from:s?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:i.newStore.id,creating_block_id:i.newStore.id,...(0,he.Pn)(e)})}}})},this.titleColumnIndexStore=this.createComputedStore((()=>{const{showTablePropertyFormatsStore:e}=this.props;return e.state.findIndex((e=>"title"===e.property))}))}renderComponent(){const{groupFormat:e,isFullScreen:t,collectionContextStore:o,blockPropertyValueOverlayStore:r,isReady:i,store:n,disabled:s,format:l,schema:a,isInPeekRenderer:c,query:d,showTablePropertyFormatsStore:u,showHoverActionsStore:p}=this.props,h=o.groupsStore.getGroupState(this.groupsPointer());if(!h)return;const m=h.reducerResultStore.state,S=(0,le.VM)({collectionContextStore:o,reducerResult:m,isFullScreen:t}),g=o.shouldShowSpinner.state,C=i&&0===(null==m?void 0:m.blockIds.length)&&!g,f=o.permissionScopes.state;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ES,{store:n,format:l,schema:a,query:d,collectionContextStore:o,disabled:s,paddingBottom:this.props.paddingBottom,isInPeekRenderer:c,blockPropertyValueOverlayStore:r,tableStore:this.props.tableStore,showTablePropertyFormats:this.props.showTablePropertyFormatsStore.state,timelineState:this.props.timelineState,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,groupFormat:e}),(0,v.jsx)("div",{style:{height:(0,Bi.vX)(Boolean(e)),width:0}}),C&&this.renderEmptyTablePlaceholder(),this.renderTableRows(e),g&&(0,v.jsx)(FS,{}),S&&this.renderLoadMoreButton(),LS(this.props.collectionContextStore,this.props.isReady,this.props.canEdit)&&this.renderTableAddRowButton(),(0,v.jsx)(ds,{groupFormat:e,style:AS(this.props.isReady,this.props.groupFormat,this.props.isFullScreen,this.props.paddingLeft),disabled:s||!f.canConfigureBlock,schema:a,query:d,collectionContextStore:o,isInPeekRenderer:c,isFullScreen:t,showPropertyFormats:u.state,showHoverActionsStore:p,showRightActionsSpacer:!1}),(e||t)&&(0,v.jsx)("div",{style:{height:Ba,width:0,marginBottom:e?Bi.y1:void 0}})]})}renderTableRows(e){const{store:t,schema:o,query:r,collectionContextStore:i,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,tableStore:c,paddingLeft:d}=this.props;if(!i.collectionViewStore())return;return i.groupsStore.getGroupState(e)?(0,v.jsx)(ga,{store:t,format:a,schema:o,query:r,collectionContextStore:i,minWidth:void 0,blockPropertyValueOverlayStore:n,showPropertyFormats:s.state,disabled:!l,disableHorizontalEdgeScroll:!0,groupFormat:e,render:this.renderGroupResults,tableStore:c,paddingLeft:d}):void 0}renderEmptyTablePlaceholder(){const{canEdit:e}=this.props;return(0,v.jsx)(ko.Z,{onClick:this.handleAddRowClick,onMouseDown:me.$0,disabled:!e,style:{display:"flex",alignItems:"center",height:Fa,width:"100%",paddingLeft:8,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:this.theme.contentBackground,left:0,right:0,borderBottom:`1px solid ${this.theme.tableDividerColor}`},children:e?(0,v.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,v.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}renderLoadMoreButton(){const{collectionContextStore:e,format:t,canEdit:o}=this.props,r=this.groupsPointer();if(!e.groupsStore.getGroupState(r))return;const i=Qt({collectionContextStore:e,groupsPointer:r});return(0,v.jsxs)(ko.Z,{onMouseDown:me.$0,onClick:e=>function(e,t,o,r,i){const n=t.groupsStore.getGroupState(o);if(!n)return;const s=n.reducerResultStore.state;(0,me.Wi)(e),W.ZH(i),s&&L.ID({collectionContextStore:t,environment:i,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:n.groupsPointer,incrementLimitsInRelatedGroups:!1}});I.uD(i)}(e,this.props.collectionContextStore,this.props.groupFormat,this.props.isFullScreen,this.environment),disabled:i,hoveredStyle:i?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:Fa+1,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,borderBottom:`1px solid ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,wr.M)(ZS(this.theme)),(0,v.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,v.jsx)(j.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),i?(0,v.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,v.jsx)(Ue.Z,{style:{width:12,height:12}})}):o&&(0,v.jsx)(Ur,{collectionContextStore:e,format:t})]})}renderTableAddRowButton(){return(0,v.jsxs)(ko.Z,{onClick:this.handleAddRowClick,style:(e=this.props.isInPeekRenderer,t=this.theme,{borderBottom:`1px solid ${t.tableDividerColor}`,display:"flex",alignItems:"center",height:Fa,width:"100%",paddingLeft:8,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}),className:ro.tfM,onMouseDown:me.$0,children:[(0,de.R)(ZS(this.theme)),(0,v.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]});var e,t}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):G.c4({environment:this.environment,url:e})}}BS.displayName="TimelineTableGroupResults",BS.contextTypes={...mr.wK,...s.w};const NS=(0,j.injectIntl)(BS);function DS(){}function LS(e,t,o){const r=e.permissionScopes.state;return Boolean(t&&o&&!r.isSyncedCollection)}function AS(e,t,o,r){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:r},...o&&!t&&{left:r}}}function ES(e){let{groupFormat:t,store:o,format:r,schema:i,query:n,collectionContextStore:s,disabled:l,paddingBottom:a,isInPeekRenderer:d,blockPropertyValueOverlayStore:u,tableStore:p,showTablePropertyFormats:h,timelineState:m,isFullScreen:S,isRootChild:g}=e;window.__c={n:"TimelineTableGroupResultsHeaderRow"};const C=(0,c.VK)((()=>s.groupsStore.getGroupState(t)),[s,t]),f=(0,c.VK)((()=>s.permissionScopes.state),[s]),y=(0,c.VK)((()=>s.viewIsFlushToTopbar()),[s]);if(!C)return null;const x=Boolean(t);return(0,v.jsx)(Il,{store:o,format:r,schema:i,query:n,collectionContextStore:s,isInPeekRenderer:d,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:u,showPropertyFormats:h,showRightActions:!1,allowHidingTitle:!0,tableStore:p,formatKey:"timeline_table_properties",disabled:l||!f.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,Bi.vX)(x),paddingTop:x?0:Bi.Ne-Bi.pe,disableTopBorder:!y||x,disableCellRightBorder:!0,groupFormat:t,children:!x&&f.canConfigureBlock&&(0,v.jsx)(gm,{isGrouped:!1,format:r,collectionContextStore:s,timelineState:m,isFullScreen:S,isRootChild:g})})}function ZS(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}class HS extends Mo.Z{constructor(){super(...arguments),this.widthEl=null,this.storeTypes={tableStore:$n,hiddenGroupsVisible:d.default.createClass(!1),groupsReducerResultStore:d.default.createClass(void 0)},this.renderTableGroupHeader=e=>{const{format:t,collectionContextStore:o,isFullScreen:r,isRootChild:i}=this.props,n=o.permissionScopes.state;return(0,v.jsxs)(Nt,{...e,height:Bi.Zn-1,paddingTop:Bi.xd,toggleClosedMarginBottom:Bi.xd,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.tableDividerColor}`:void 0}}(e,this.theme),style:US(e.index,this.props.collectionContextStore,this.theme),children:[0===e.index&&n.canConfigureBlock&&(0,v.jsx)(gm,{isGrouped:!0,format:t,collectionContextStore:o,timelineState:this.timelineState,isFullScreen:r,isRootChild:i})," "]})},this.renderTableGroupResults=e=>{const{store:t,isFullScreen:o,schema:r,query:i,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,showHoverActionsStore:a,paddingBottom:c,isRootChild:d,disabled:u}=this.props,p=this.isReady.state,h=KS(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment);if(s.groupsStore.getGroupState(e))return(0,v.jsx)(NS,{store:t,groupFormat:e,schema:r,query:i,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:this.showTablePropertyFormatsStore,showHoverActionsStore:a,tableStore:this.stores.tableStore,paddingLeft:h,paddingBottom:c,format:WS(this.props.format,this.stores.tableStore),isFullScreen:o,isRootChild:d,isReady:p,canEdit:this.canEditCollectionTimeline(),disabled:u&&this.canEditCollectionTimeline()})},this.renderTimelineItemGroupResults=e=>{const{store:t,isFullScreen:o,schema:r,query:i,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,isRootChild:a,disabled:c}=this.props,d=this.isReady.state,u=KS(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment);return(0,v.jsx)(jS,{store:t,groupFormat:e,schema:r,query:i,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTimelinePropertiesStore:this.showTimelinePropertiesStore,paddingLeft:u,format:WS(this.props.format,this.stores.tableStore),isFullScreen:o,isRootChild:a,isReady:d,canEdit:this.canEditCollectionTimeline(),disabled:c,showTable:this.showTableStore.state,canEditTimelineItems:this.canEditTimelineItemsStore.state,scrollerLeftOffsetStore:this.scrollerLeftOffsetStore})},this.renderTimelineItemGroupHeader=e=>{if(this.showTableStore.state)return;const{collectionContextStore:t}=e,o=t.isCompactView.state,r=this.timelineState.outerSizeObserver.rect.state.width;return(0,v.jsx)("div",{style:{position:"sticky",left:0,width:r,height:Bi.Zn,zIndex:M.sL},children:(0,v.jsx)(Nt,{...e,style:{width:"100%",height:"100%",paddingLeft:this.props.isFullScreen?KS(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},getComputedStickyStyle:e=>function(e,t){return e?{background:t.contentBackground,boxShadow:`0 1px 0 ${t.tableDividerColor}`}:{background:"transparent",boxShadow:void 0}}(e&&!o,this.theme),preventToggleBackground:this.props.isInPeekRenderer})})},this.renderTimelineItemHiddenGroupsButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return(0,v.jsx)("div",{style:{width:"100%",height:Vi+Oi,display:"flex"},children:(0,v.jsx)(Pi,{...e,style:{position:"sticky",left:t?KS(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):3,width:"max-content",paddingLeft:4,paddingRight:8}})})},this.renderTimelineAddGroupButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t,collectionContextStore:o}=this.props;return"collectionTypedView"!==o.contextType?(0,v.jsx)("div",{style:{width:"100%",height:Ln+An,display:"flex"},children:(0,v.jsx)(Hn,{...e,style:{position:"sticky",left:t?KS(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):3,width:"max-content",paddingLeft:4,paddingRight:8}})}):void 0},this.renderTimelineGroupsLoadMoreButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return(0,v.jsx)("div",{style:{width:"100%",height:Mi+2*ji,display:"flex"},children:(0,v.jsx)(Fi,{...e,style:{position:"sticky",left:t?KS(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):3,width:"max-content",paddingLeft:4,paddingRight:8}})})},this.renderRowDropzoneSelectableGroupResults=e=>{const{collectionContextStore:t,store:o,format:r,disabled:i}=this.props;return(0,v.jsx)(Ym,{store:o,groupFormat:e,collectionContextStore:t,canEdit:this.canEditCollectionTimeline(),format:r,disabled:i&&this.canEditCollectionTimeline()})},this.handleHorizontalScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,savePreference:o}=e;if(!t)return;const r=t.scrollLeft,i=e.scrollLeft.state;this.environment.device.isIOS&&void 0!==i&&0===r&&i>Bi.lx?t.scrollLeft=i:(o&&o(),e.scrollLeft.setState(r),(0,Bi.rr)(this.environment)?this.resetWindowForScrollDebounced():this.resetWindowForScroll())},this.resetWindowForScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o}=e;if(!t)return;const r=e.zoomLevel.state,{startTimestamp:i,endTimestamp:n}=e.currentRange.state,s=t.scrollLeft,l=o.rect.state.width,a=(0,Bi.e$)(r,n-i),c=(0,Bi.al)(e);if(s<Bi.lx){const t=-(0,Bi.x2)(r,Bi.Ge);e.currentRange.setState({startTimestamp:i+t,endTimestamp:n+t}),Ah.Nf({timelineState:e,environment:this.environment,zoomLevel:r,centerTimestamp:c})}else if(s+l>a-Bi.lx){const t=(0,Bi.x2)(r,Bi.Ge);e.currentRange.setState({startTimestamp:i+t,endTimestamp:n+t}),Ah.Nf({timelineState:e,environment:this.environment,zoomLevel:r,centerTimestamp:c})}},this.resetWindowForScrollDebounced=_.Ds(this.resetWindowForScroll,200),this.handleWidthElMount=e=>{if(e){this.widthEl=e;const{timelineState:t}=this,{outerSizeObserver:o}=t;o.observe(e);const r=(0,Se.xH)(e);r&&(t.horizontalScroller=r,(0,Sr.lj)(r,"scroll",this.handleHorizontalScroll),this.scrollToCenteredTimestamp())}},this.handleTimelineElMount=e=>{if(e){const{timelineState:t}=this,{timelineSizeObserver:o}=t;o.observe(e)}},this.scrollToCenteredTimestamp=()=>{const{timelineState:e}=this,{startTimestamp:t,endTimestamp:o}=e.currentRange.state;Ah.KA({timelineState:e,centerTimestamp:(t+o)/2})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=(e,t,o)=>function(e,t,o,r,i){!function(e,t,o,r,i){if(r.device.isMobile)ne._({environment:r,store:e,pageVisitSource:u.tY.Create});else{const{groupFormat:t}=o,n=t?[t]:[],s=i.groupsStore.getGroupState(n);se.CH({environment:r,store:e,peekMode:le.kr(i.collectionViewStore()),resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:i,pageVisitSource:u.tY.Create})}}(e,0,o,r,i)}(e,0,o,this.environment,this.props.collectionContextStore),this.showTablePropertyFormatsStore=this.createComputedStore((()=>function(e,t){const o=WS(e,t);return o&&o.timeline_table_properties?o.timeline_table_properties:[]}(this.props.format,this.stores.tableStore).filter((e=>e.visible))),!0),this.tableWidthStore=this.createComputedStore((()=>this.showTableStore.state?this.showTablePropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0):0)),this.scrollerLeftOffsetStore=this.createComputedStore((()=>(0,Bi.xI)({environment:this.environment,paddingLeft:KS(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment),format:this.props.format,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild}))),this.scrollPixelWidthStore=this.createComputedStore((()=>{const{timelineState:e}=this,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state;return(0,Bi.e$)(t,r-o)})),this.showTimelinePropertiesStore=this.createComputedStore((()=>{const{format:e}=this.props;return(e.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))})),this.showTableStore=this.createComputedStore((()=>{const{format:e,isFullScreen:t,isRootChild:o}=this.props;return(0,Bi.C1)({environment:this.environment,format:e,isFullScreen:t,isRootChild:o})})),this.canEditTimelineItemsStore=this.createComputedStore((()=>{const{query:e,schema:t}=this.props;return le.D2({query:e,schema:t})})),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getTimelineItemGroupStyle=e=>{const t=this.showTableStore.state,o=this.getGroupPaddingState(e);let r=0,i=0;return o.groupHeader&&t&&(r+=Bi.Zn-1),o.tableHeaderRow&&(r+=Bi.pe),o.tableEmptyRow&&(r+=Fa),o.tableAggregationRow&&(i+=Ba),o.hiddenGroupsButton&&t&&(i+=Vi+Oi),o.groupsLoadMoreButton&&t&&(i+=Mi+2*ji),o.addGroupButton&&t&&(i+=Ln+An),o.groupPaddingBottom&&(i+=Bi.y1),o.extraGroupMarginBottom&&(i+=Bi.xd+1),{paddingTop:r,paddingBottom:i,minHeight:Bi.Zn,boxShadow:e.index>0&&(!t||o.tableHeaderRow)?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}},this.getRowDropzoneSelectableGroupStyle=e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=this.getGroupPaddingState(e);let o=0,r=0;return t.groupHeader&&(o+=Bi.Zn),t.tableHeaderRow&&(o+=Bi.pe),t.tableEmptyRow&&(o+=Fa),t.addItemRow&&(r+=Zh.Z),t.loadMoreButton&&(r+=33),t.tableAggregationRow&&(r+=Ba),t.hiddenGroupsButton&&(r+=Vi+Oi),t.groupsLoadMoreButton&&(r+=Mi+2*ji),t.groupPaddingBottom&&(r+=Bi.y1),t.extraGroupMarginBottom&&(r+=Bi.xd),t.addGroupButton&&(r+=Ln+An),t.dropZoneSelectableGroupExtraBottomPadding&&(r+=1),{paddingTop:o,paddingBottom:r}}}get registries(){return super.registries.concat(Eh.Z)}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.timelineState=(0,Bi.Gz)({isFullScreen:e.isFullScreen,isRootChild:e.isRootChild});const{collectionContextStore:t}=e,o=t.collectionViewStore();o&&Ah.j2({timelineState:this.timelineState,environment:this.environment,collectionViewStore:o,collectionContextStore:t})}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{timelineState:t}=this,{query:o,collectionContextStore:r}=e;Eo.Z.state&&t.hoveredItem.setState(void 0);const i=r.collectionStore();i&&!o.timeline_by&&i.isDefined()&&function(e,t,o){const{schema:r}=e,i=t.permissionScopes.state,n=t.collectionStore();if(!n)return;const s=t.collectionViewStore();if(!s||!i.canConfigureBlock)return;const l=(0,j.defineMessages)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});Q.createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:o,perform:e=>{let t,a=le.HI(r);if(!a&&i.canConfigureCollection){a=(0,Zd.ZP)();t={[a]:{name:ze.default.formatMessage(l.date),type:"date"}}}pe.Es({collectionViewStore:s,update:{timeline_by:a},transaction:e}),go.sW({store:s,data:{type:"timeline"},transaction:e}),t&&pe.xO({environment:o,collectionStore:n,update:t,transaction:e})}})}(e,this.props.collectionContextStore,this.environment)}didMountOrUpdate(){super.didMountOrUpdate();const e=this.timelineState,{collectionContextStore:t,isFullScreen:o,isRootChild:r}=this.props;I.iR(this.environment,(0,Bi.Ii)({environment:this.environment,collectionContextStore:t,timelineState:e,isFullScreen:o,isRootChild:r}));const i=e.drawState.state;if(null!=i&&i.tryToCompleteDrawnArrow){(0,Bi.H5)(t)&&Q.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:this.environment,perform:i=>{Ah.$o({timelineState:e,environment:this.environment,transaction:i,collectionContextStore:t,isFullScreen:o,isRootChild:r})}})}}willUnmount(){super.willUnmount();const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o,timelineSizeObserver:r}=e;o.destroy(),r.destroy(),e.destroyed=!0,t&&(0,Sr.ZV)(t,"scroll",this.handleHorizontalScroll)}customizeEdgeScrollRect(e){const t=this.scrollerLeftOffsetStore.state;return Gu.iL.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}addBlockToView(e){const{store:t,transaction:o}=e,{collectionContextStore:r}=this.props,i=r.collectionStore();if(i)return Ah.Fv({environment:this.environment,store:t,timelineState:this.timelineState,query:this.props.query,collectionStore:i,collectionContextStore:this.props.collectionContextStore,groupFormat:void 0,transaction:o})}renderPersisted(){const{store:e,isInPeekRenderer:t,paddingRight:o,isFullScreen:r,isRootChild:i,query:n,schema:s,format:l,collectionContextStore:a,disabled:c}=this.props,{timeline_by:d}=n;if(!d)return(0,v.jsx)(GS,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom});const u=s[d];if(!u||!fe.Lt(u))return(0,v.jsx)(GS,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom});const{timelineState:p}=this,h=this.scrollerLeftOffsetStore.state,m=this.showTableStore.state,S=KS(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment),g=le.az(a,r),C=l.collection_group_by,f=a.viewIsFlushToTopbar(),y=a.isCompactView.state,x=(0,gr.Z)((d=>(0,v.jsx)(ii,{isFullScreen:r,renderEmitter:a.renderEmitter,children:(0,v.jsx)("div",{style:this.getStyle(m),className:ro.kDE,...d,children:(0,v.jsxs)(It.Z,{store:e,analyticsName:"timeline",shouldShowHalo:!r&&!y,canSelect:!r,style:y?{height:"100%"}:{},children:[(0,v.jsx)(Em,{timelineState:p}),(0,v.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:Bi.Ne},ref:this.handleTimelineElMount,children:[C?this.renderTimelineItemGroups(C):this.renderTimelineItemGroupResults(void 0),(0,v.jsx)(nm,{timelineState:p,disabled:c,isReady:this.isReady.state,renderEmitter:a.renderEmitter,isFullScreen:r,isRootChild:i})]}),(0,v.jsx)(_m,{isInPeekRenderer:t,timelineState:p,query:n,schema:s,scrollerLeftOffset:h,collectionContextStore:a,showTable:m}),(0,v.jsx)(hm,{timelineState:p,isInPeekRenderer:t,paddingLeft:S,paddingRight:!r&&i?8:o,format:l,scrollerLeftOffset:h,isFullScreen:r,isRootChild:i,showTable:m,collectionContextStore:a,isReady:this.isReady.state}),m&&this.renderTable(C,S),(0,v.jsx)("div",{style:{paddingTop:Bi.Ne,pointerEvents:"none"},children:C?this.renderRowDropzoneSelectableGroups(C):(0,v.jsx)("div",{style:this.getRowDropzoneSelectableGroupStyle(void 0),children:this.renderRowDropzoneSelectableGroupResults(void 0)})}),!g&&(0,v.jsx)(an.Z,{onChange:e=>function(e,t,o,r){const i=o.isLoading.state,n=o.groupsStore.getGroupState([]);if(!n)return;const s=n.reducerResultStore.state;e<no.Z.incrementScrollOffset&&s&&!i&&s.hasMore&&L.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})})})));return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{ref:this.handleWidthElMount}),!f&&(0,v.jsx)("div",{style:{height:4}}),x]})}renderTable(e,t){const{store:o,isFullScreen:r,collectionContextStore:i}=this.props;return(0,v.jsx)("div",{style:{position:"sticky",left:0,height:0,width:this.tableWidthStore.state,zIndex:M.eU},children:(0,v.jsx)(It.Z,{style:this.getTableSelectableStyle(t),store:o,shouldShowHalo:!1,canSelect:!r,analyticsName:"timeline",children:e?this.renderTableGroups(e):(0,v.jsx)(ii,{isFullScreen:r,ignoreAncestorContainer:!0,renderEmitter:i.renderEmitter,children:(0,v.jsx)("div",{children:this.renderTableGroupResults(void 0)})})})})}renderTableGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,ke.hJ)()?(0,v.jsx)(on,{reducerId:"timeline_groups",store:t,collectionContextStore:r,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderTableGroupResults,getGroupStyle:()=>({}),renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,timelineProps:{type:"table",reducerResultStore:this.stores.groupsReducerResultStore,hiddenGroupsVisible:this.stores.hiddenGroupsVisible}}):(0,v.jsx)(Gn,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:ie.Uh,groupAggregationKey:ie.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderTableGroupResults,renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,ignoreAncestorStickyContainer:!0,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!1})}renderTimelineItemGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,ke.hJ)()?(0,v.jsx)(on,{reducerId:"timeline_groups",store:t,collectionContextStore:r,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderTimelineItemGroupResults,getGroupStyle:this.getTimelineItemGroupStyle,renderHeader:this.renderTimelineItemGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,timelineProps:{type:"item",reducerResultStore:this.stores.groupsReducerResultStore,hiddenGroupsVisible:this.stores.hiddenGroupsVisible}}):(0,v.jsx)(Gn,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:ie.Uh,groupAggregationKey:ie.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderTimelineItemGroupResults,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:this.renderTimelineItemGroupHeader,getGroupStyle:this.getTimelineItemGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,renderHiddenGroupsButton:this.renderTimelineItemHiddenGroupsButton,renderAddGroupButton:this.renderTimelineAddGroupButton,renderGroupsLoadMoreButton:this.renderTimelineGroupsLoadMoreButton,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!0})}renderRowDropzoneSelectableGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,ke.hJ)()?(0,v.jsx)(on,{reducerId:"timeline_groups",store:t,collectionContextStore:r,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderRowDropzoneSelectableGroupResults,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,renderHeader:()=>null,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,timelineProps:{type:"dropzone",reducerResultStore:this.stores.groupsReducerResultStore,hiddenGroupsVisible:this.stores.hiddenGroupsVisible}}):(0,v.jsx)(Gn,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:ie.Uh,groupAggregationKey:ie.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderRowDropzoneSelectableGroupResults,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:()=>null,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,renderHiddenGroupsButton:()=>null,renderAddGroupButton:()=>null,renderGroupsLoadMoreButton:()=>null,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!0})}canEditCollectionTimeline(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&e.canEditContent&&!e.isSyncedCollection}getGroupPaddingState(e){const{groupFormat:t,currentGroups:o,visibleGroups:r,hiddenGroups:i,total:n}=e,{collectionContextStore:s,isFullScreen:l,disabled:a,format:c}=this.props,{hiddenGroupsVisible:d}=this.stores,u=c.collection_group_by,p=this.showTableStore.state,h=s.groupsStore.getGroupState(t),m=Boolean(t&&!(null!=h&&h.toggleStateStore.state)),S=function(e,t,o,r){if(!e)return!0;const i=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<i){const t=r.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(t,m,o,this.props.collectionContextStore),g=null==h?void 0:h.reducerResultStore.state,C=le.VM({collectionContextStore:s,reducerResult:g,isFullScreen:l}),f=t===i[i.length-1],v=t===r[r.length-1],y=r.length<n,x=d.state?f:v,b=s.permissionScopes.state,w=x&&!a&&b.canConfigureBlock&&u&&(0,ie.Wz)(u,b.canConfigureCollection),k=g&&0===g.blockIds.length;return{groupHeader:Boolean(t&&(!p||!S)),tableHeaderRow:Boolean(p&&!m&&!S),tableAggregationRow:Boolean(p&&!m),addItemRow:Boolean(this.canEditCollectionTimeline()&&!m),hiddenGroupsButton:Boolean(v&&i.length>0),groupsLoadMoreButton:Boolean(v&&y),loadMoreButton:Boolean(!m&&C),groupPaddingBottom:Boolean(!m),tableEmptyRow:Boolean(p&&!m&&k),extraGroupMarginBottom:Boolean(p&&m),addGroupButton:Boolean(w),dropZoneSelectableGroupExtraBottomPadding:Boolean(!p)}}getStyle(e){const{isFullScreen:t,paddingBottom:o,collectionContextStore:r}=this.props,i=this.scrollPixelWidthStore.state,n=this.isReady.state,s=r.isCompactView.state;return{position:"relative",float:"left",minWidth:"100%",width:i,...s?{}:{background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground},...!t&&!e&&{borderBottom:`1px solid ${this.theme.tableDividerColor}`},...!n&&{minHeight:150},...t&&{paddingBottom:o},height:s?"100%":this.getComputedOuterHeight()}}getTableSelectableStyle(e){const{collectionContextStore:t}=this.props,o=t.isCompactView.state;return{whiteSpace:"nowrap",...o?{}:{background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground},paddingLeft:e,borderRight:`1px solid ${this.theme.tableDividerColor}`,boxShadow:this.theme.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:this.tableWidthStore.state+e+1,height:o?"100%":this.getComputedOuterHeight()}}getComputedOuterHeight(){const{device:e}=this.environment,{paddingBottom:t,isFullScreen:o}=this.props,{timelineSizeObserver:r}=this.timelineState,i=r.rect.state.height||120,n=this.showTableStore.state;return i+t+(o?0:72)+(!o&&n?28:0)+(o&&e.isMobile?72:0)}}HS.displayName="CollectionTimelineView";const zS=HS;function GS(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:r}=e;window.__c={n:"MissingDateProperty"};const i=(0,c.VK)((()=>t.permissionScopes.state.canConfigureBlock),[t]),n=t.settingsStore;return(0,v.jsx)(uu,{collectionContextStore:t,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:i?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,v.jsx)(du,{onClick:()=>{A.r$({collectionContextStore:t,collectionSettingsStore:n}),A.H4({collectionSettingsStore:n,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:r}})}function KS(e,t,o,r,i){return function(e,t,o,r){return(0,Bi.fj)({environment:r,isRootChild:e,isFullScreen:t,format:o})}(e,t,o,i)?Bi.Qw:r}function US(e,t,o){const r=t.viewIsFlushToTopbar();return 0!==e||r?{borderTop:`1px solid ${o.tableDividerColor}`}:{}}function WS(e,t){const{temporaryFormat:o}=t.state;return o||e}var $S=o(74194),qS=o(14562),QS=o(61679),YS=o(58493),XS=o(31192),JS=o(95691),eg=o(96787),tg=o(77744),og=o(19977),rg=o(45162),ig=o(82136),ng=o(15201),sg=o(72711),lg=o(57819),ag=o(16772),cg=o(97053),dg=o(55217);function ug(e){window.__c={n:"DocumentView"};const{store:t,disabled:o,paddingLeft:r,paddingRight:n,setRef:s}=e,l=(0,oe.O7)(),a=(0,c.VK)((()=>{const e=t.getFormat();return{pageFont:e.page_font,pageSmallText:e.page_small_text}}),[t]),d=(0,c.VK)((()=>(0,Ya.CX)(t)),[t]),u=(0,cg.Nr)(t),p=(0,c.VK)((()=>(0,Ya.a_)(t)),[t]),h=(0,c.VK)((()=>t.isLocked()),[t]),{safePaddingLeft:m,safePaddingRight:S}=(0,c.VK)((()=>({safePaddingLeft:l.WindowSizeStore.getSafePaddingLeftCSS(r),safePaddingRight:l.WindowSizeStore.getSafePaddingRightCSS(n)})),[l.WindowSizeStore,r,n]),g=(0,c.VK)((()=>Boolean((0,lg.RR)(ag.default.state))),[]),C=(0,c.VK)((()=>t.getContentStore()),[t]),f=(0,c.VK)((()=>(0,XS.ww)(l.device)),[l.device]),y=d?e=>sg.og(e,t,l):void 0;function x(e,t){return(0,v.jsxs)("div",{style:e,ref:e=>{e&&s(e)},className:ro.QS0,onClick:t,children:[!p&&(0,v.jsx)(dg.Z,{store:C,emptyDroppableStyle:{width:"100%"},disabled:h||o}),u&&(0,v.jsx)(Ue.Z,{})]})}const b=(0,i.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{device:t}=l,o=a.pageFont||XS.rk,r=XS.sL[o];let i;if(t.isMobile)i=t.isAndroid?XS.pE:XS.tb;else{i=a.pageSmallText?XS.Pc[o]||XS.ZY:XS.TE[o]||XS.jo}let n={},s={},c={};n={gridTemplateColumns:`${m} calc(100% - ${m} - ${S}) ${S}`},s=g?{paddingBottom:"600px"}:d?{paddingBottom:"15vh"}:{paddingBottom:0},c={...s,paddingLeft:e?0:m,paddingRight:e?0:S};const u=XS.VN[o],p=XS.n5[o]||1.5;return{wrapper:{flexShrink:0,flexGrow:1,display:"grid",gridTemplateColumns:"100%",maxWidth:"100%",width:"100%",...n},leftPadding:{},body:{display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:r,fontSize:i,letterSpacing:u?`${u}em`:void 0,lineHeight:p,zIndex:M.ke,...s},rightPadding:{},nonIOSLayoutBody:{flexShrink:0,flexGrow:1,maxWidth:"100%",display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:r,fontSize:i,letterSpacing:u?`${u}em`:void 0,lineHeight:p,width:"100%",zIndex:M.ke,...c}}}),[l,a.pageFont,a.pageSmallText,g,d,m,S]),w=b();return f?(0,v.jsxs)("div",{style:w.wrapper,children:[w.leftPadding&&(0,v.jsx)(Jn.p,{allowSelectionWithin:!1,style:w.leftPadding,onClick:y}),x(w.body,y),w.rightPadding&&(0,v.jsx)(Jn.p,{allowSelectionWithin:!1,style:w.rightPadding,onClick:y})]}):x(w.nonIOSLayoutBody,y)}const pg=i.memo(ug,Jt.Z);function hg(e){window.__c={n:"WikiHomeView"};const{store:t,style:o,canEdit:r,padding:n}=e,s=(0,oe.O7)(),l=(0,i.useRef)(null),a=(0,c.VK)((()=>t.isLocked()),[t]),d=(0,c.VK)((()=>Td.fg(s,t)),[t,s]),u=(0,cg.Bt)(),p=(0,i.useMemo)((()=>({width:(0,Ya.du)(t,ig.S.CollectionPageView,s)})),[t,s]);let h=(0,v.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5,paddingBottom:u},children:[(0,v.jsx)(ts.Z,{isVisible:!0,animationStyle:p,render:()=>(0,v.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:(0,v.jsx)(pg,{...e,...n,setRef:e=>{(0,tg.k$)(l,e)}})})}),!s.device.isMobile&&d&&(0,v.jsx)(og.Z,{pageBlockStore:t,isVisible:d,context:ig.S.CollectionPageView,pageViewBlockAccessor:()=>l.current})]});return(0,rg.Aw)(s)&&(h=(0,v.jsx)(ng.O,{displayName:"PageContent",style:o,disabled:!r||a,children:h})),h}class mg extends d.default{getInitialState(){return{stage:"NOT_TRACKING"}}}function Sg(e){window.__c={n:"SetupInitialDatabaseItemsVisibleTracker"};const{collectionContextStore:t,parentMountTime:o}=e,{handleInitialDatabaseRender:r,handleItemMount:n}=function(e,t){const o=(0,oe.O7)(),r=(0,c.qz)(void 0,mg),n=(0,i.useRef)(0),s=(0,i.useRef)(t),a=(0,i.useCallback)((()=>{"NOT_TRACKING"===r.state.stage&&r.setState({stage:"COUNTING_VISIBLE_ITEMS"})}),[r]),d=(0,i.useCallback)((()=>{if("COUNTING_VISIBLE_ITEMS"===r.state.stage&&(n.current++,1===n.current)){const e=performance.now();l.default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===r.state.stage&&r.setState({stage:"SHOULD_TRACK",endTime:e})}))}}),[r]),u=(0,i.useCallback)((t=>{if("SHOULD_TRACK"===t.state.stage){const r=he.Pp({environment:o,collectionContextStore:e,visibleItemsCount:n.current||0});yr.default.measureFromAppStart({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:o,data:r}),s.current&&yr.default.measure({metricName:"collections.initial_mount_to_items_visible",startTime:s.current,endTime:t.state.endTime},{environment:o,data:r}),t.reset(),n.current=0}}),[e,o]);return(0,i.useEffect)((()=>(r.addListener(u),()=>{r.removeListener(u)})),[u,r]),{handleInitialDatabaseRender:a,handleItemMount:d}}(t,o);return t.initialDatabaseItemsVisibleTracker||(t.initialDatabaseItemsVisibleTracker={handleInitialDatabaseRender:r,handleItemMount:n}),null}const gg=["table","board"],Cg=["timeline"],fg=180,vg=(0,j.defineMessages)({searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"},openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},openFullscreenPageButtonTooltip:{defaultMessage:"Open as full page",id:"database.collectionViewBlock.openFullscreenPageButton.tooltip"},filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"},sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});class yg{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let r=!0;this.didEmit||(this.didEmit=!0,r=!1),this.lastValue===t?r=!1:this.lastValue=t,r&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=Md.ZP.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&Md.ZP.removeListener(this.listener,this.environment)}}class xg extends Mo.Z{constructor(){super(...arguments),this.isCollectionViewBlock=!0,this.collectionContextStore=new no.Z(this.environment),this.headerSizeObserver=new Zc.E,this.headerEl=null,this.horizontalScrollerEl=null,this.resizeObserver=void 0,this.timelineViewRef=i.createRef(),this.automationsViewRef=i.createRef(),this.parentNode=void 0,this.renderStartTime=void 0,this.subscriptions=new Map,this.collectionTypeChangeSubscription=void 0,this.collectionRefetcher=new uh(this.collectionContextStore,this.environment),this.syncStateTimeout=void 0,this.switchViewMetric=void 0,this.storeTypes={collectionContextStore:no.Z,mouseStore:jo.Z,headerMouseStore:jo.Z,verticalScrollerStore:gt.Z,focusStore:d.default.createClass(!1),noDateResultStore:d.default.createClass(void 0),tasksResultStore:d.default.createClass(void 0),templateButtonPopupStore:eo.Z,filterBarSettingsStore:d.default.createClass({open:!1,stack:[]}),createFilterButtonPopupStore:eo.Z,createFilterSettingsStore:d.default.createClass({open:!1,stack:[]}),filterBarCreateFilterSettingsStore:d.default.createClass({open:!1,stack:[]}),createSortSettingsStore:d.default.createClass({open:!1,stack:[]}),viewSettingsPlacementStore:d.default.createClass(void 0),saveControlMoreActionsButtonPopupStore:eo.Z},this.renderCreateFilterPopup=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores;return(0,v.jsx)(J.P,{context:Mc.HV.TopbarFilterPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderCreateSortPopup=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;return(0,v.jsx)(J.P,{context:Mc.HV.TopbarSortPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderViewSettings=()=>{const e=this.isInPeekRenderer(),t=(0,le.Ks)(this.props.store)?{paddingLeft:0,paddingRight:0}:this.leftRightPadding.state;if(t)return(0,v.jsx)(Fc,{collectionContextStore:this.collectionContextStore,headerSizeObserver:this.headerSizeObserver,placementStore:this.stores.viewSettingsPlacementStore,isInPeekRenderer:e,overridePlacement:this.isInHomeWidget.state?"popup":void 0,...t})},this.renderTemplatesPopup=()=>{const{collectionContextStore:e}=this,{store:t}=this.props,o=e.collectionStore();if(o){if(Id.Z.state.online){const r=e.permissionScopes.state;return(0,v.jsx)(Lh.Z,{isOverlay:!0,collectionStore:o,canConfigureCollection:r.canConfigureCollection,onEmptyPageClick:this.handleTemplateEmptyPageClick,onEmptyEnter:this.handleTemplateEmptyPageClick,onTemplateClick:this.handleTemplateClick,onCancelClick:this.handleTemplateCancelClick,locked:t.isLocked()})}return(0,v.jsx)("div",{style:{fontSize:14,color:this.theme.mediumTextColor,width:280,padding:8},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"})})}},this.renderNoDatePopup=e=>{const{collectionContextStore:t}=this,o=t.collectionStore(),r=t.collectionViewStore(),i=this.getNoDateProperty();if(!o||!r||!i)return;const n=r.getType();return!r.isDefined()||"timeline"!==n&&"calendar"!==n?void 0:(0,v.jsx)(th,{collectionStore:o,property:i,onClose:e.close,onAddPage:this.handleNoDateAddPage,collectionViewType:n,collectionContextStore:t})},this.handleRelativeVariableStaleStoreChange=async e=>{if(e.state){const e=this.collectionContextStore,t=e.collectionViewBlockStore(),o=e.collectionViewStore(),r=e.collectionStore();if(!t||!o||!r)return;await pe.dj(this.environment,e,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}},this.handleViewAutomationSettingsClick=e=>{(0,me.ZP)({event:e,context:me.Af.CollectionAutomationSettingsClick,callback:this.handleViewAutomationSettingsClickInner})},this.handleViewAutomationSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.state.open,r=(0,jd.n)(t);o&&"automationSettings"===(null==r?void 0:r.type)?A.E3({collectionSettingsStore:t}):(A.r$({collectionContextStore:e,collectionSettingsStore:t}),A.wl({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings"}}))},this.handleViewClick=e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:r}=e;if(t.id!==o.id&&!r){const e=t.getType(),r=o.getType();var i;if(e&&r)this.switchViewMetric={from:e,to:r,metric:yr.default.mark("collections.switch_view_lag"),sizeHintAtStart:null===(i=this.collectionContextStore.remoteResult.state)||void 0===i?void 0:i.sizeHint}}},this.handleFilterClick=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores,o=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0,r=e.currentPropertyFiltersStore.state,i=e.filtersBarOpenStore.state;this.isCompactView.state&&A.wl({collectionSettingsStore:e.settingsStore,item:{type:"filters"}}),i||r.length>0||o?e.filtersBarOpen.setState(!i):A.wl({collectionSettingsStore:t,item:{type:"createFilter"}}),F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_filter"})},this.handleSortClick=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;this.hasSort.state?this.isCompactView.state?A.wl({collectionSettingsStore:e.settingsStore,item:{type:"sort"}}):(e.filtersBarOpen.setState(!0),A.wl({collectionSettingsStore:e.filterBarSortSettingsStore,item:{type:"sort"}})):A.wl({collectionSettingsStore:t,item:{type:"createSort"}}),F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_sort"})},this.handleCreateFilterPopupDismiss=()=>{const{createFilterSettingsStore:e}=this.stores;A.E3({collectionSettingsStore:e})},this.handleCreateSortPopupDismiss=()=>{const{createSortSettingsStore:e}=this.stores;A.E3({collectionSettingsStore:e})},this.handleCollectionEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!1})},this.handleCollectionTypeChangeEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!0})},this.handlePageVisibilityChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("page_show")},this.handlePeekViewChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("exit_peek")},this.shouldQueueCollectionEmit=()=>{var e;return!Dd.Z.state.isVisible||!(!Ho.default.isCenterPeekOpen()||null!==(e=Ho.default.peekTarget.state)&&void 0!==e&&e.uiContains(this.props.store))},this.shouldRefetch=()=>{if(!Ho.default.isCenterPeekOpen()&&Dd.Z.state.isVisible)return!0},this.handleHeaderMount=e=>{e&&this.headerSizeObserver.observe(e),this.headerEl=e},this.handleHorizontalScrollerMount=e=>{var t,o;var r;(null==e||null===(t=e.scrollerEl())||void 0===t?void 0:t.classList.contains(ro.PBs))?this.horizontalScrollerEl=e:this.horizontalScrollerEl=(null==e||null===(r=e.context.scrollerContext)||void 0===r?void 0:r.horizontalScroller)||null;const i=this.collectionContextStore.collectionViewStore();this.resetFrozoneStore(i);const n=null===(o=this.horizontalScrollerEl)||void 0===o?void 0:o.scrollerEl();"undefined"!=typeof ResizeObserver&&n&&(this.resizeObserver=new ResizeObserver(this.handleHorizontalScrollerResizeDebounced),this.resizeObserver.observe(n))},this.handleHorizontalScrollerResize=()=>{var e,t;const o=null===(e=this.horizontalScrollerEl)||void 0===e||null===(e=e.scrollerEl())||void 0===e?void 0:e.getBoundingClientRect().width,r=this.collectionContextStore.frozoneStore.state.scrollerWidth,i=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.getBoundingClientRect().left,n=this.collectionContextStore.frozoneStore.state.scrollerLeftOffset;if(o===r&&i===n)return;if(this.isCompactView.state)return;const s=this.collectionContextStore.collectionViewStore(),l=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,scrollerWidth:o,scrollerLeftOffset:i,frozenIndex:null==s?void 0:s.getTableFrozenColumnIndex(o,l),tryShowHiddenFrozenColumn:!1})},this.handleHorizontalScrollerResizeDebounced=_.Ds(this.handleHorizontalScrollerResize,50),this.handleEditorMouseDown=e=>{const{device:t}=this.environment,{target:o}=e,r=this.getCurrentCollectionViewStore();if(!r||t.isMobile||!(o instanceof HTMLElement))return;const i=this.props.overrideViewType??r.getType();i&&(0,me.ZP)({event:e,context:me.Af.EditorMouseDown,callback:()=>{e.preventDefault(),z.AI({environment:this.environment,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===i||"table"===i})}})},this.handleEditorClick=(e,t)=>{(0,me.ZP)({event:e,context:me.Af.EditorClick,callback:()=>{if(this.isInPeekRenderer()||H.E5(this.environment),"page"===t&&!aa.X9()){const{clientX:t,clientY:o,target:r}=e;l.default.afterNextFlush((()=>{Q.createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:this.environment,perform:e=>{q.jh(this.environment,{x:t,y:o,target:r instanceof Element?r:void 0},e)}})}))}}})},this.handleScroll=e=>{var t,o;const r=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.scrollLeft,i=null===(o=this.leftRightPadding.state)||void 0===o?void 0:o.paddingLeft;if(void 0===r||void 0===i)return;const n=r>i;n!==this.collectionContextStore.frozoneStore.state.isScrolled&&(this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,isScrolled:n}),this.handleHorizontalScrollerResize())},this.handleFocusIn=e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,a.E)(t)&&this.stores.focusStore.setState(!0)},this.handleFocusOut=()=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=()=>{Eo.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleHeaderMouseMove=()=>{Eo.Z.state||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleLoadedStoreChange=()=>{if(!this.isLoadedStore.state||!this.componentIsMounted||this.collectionContextStore.wasCreatedThisSession.state||!this.isFullScreen())return;const e=this.environment.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const o=()=>{var e,o,r;return{...he.vS(this.collectionContextStore),is_push:(null===(e=t)||void 0===e?void 0:e.isPush)??!1,collectionViewType:null===(o=this.collectionContextStore.collectionViewStore())||void 0===o?void 0:o.getType(),initial_route:this.environment.RouterStore.state.initialRoute.name,prefetchCache:null===(r=this.environment.prefetchCache)||void 0===r||null===(r=r.getPrefetchAnalytic("queryCollection"))||void 0===r?void 0:r.type,wasm_sqlite_initialized:Bd.Z.state.metricData.state.wasm_sqlite_initialized}};var i;Bd.Z.state.initialRenderCompleted?yr.default.measureAfterNextFlush("navigation_database_render",{environment:this.environment,getData:o}):(Z.setInitialRenderCompleted(),yr.default.measureFromAppStartAfterNextFlush("initial_database_render",{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime&&yr.default.measureAfterNextFlush({metricName:"initial_database_render_from_component_mount",startTime:this.renderStartTime},{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime=void 0,null===(i=this.collectionContextStore.initialDatabaseItemsVisibleTracker)||void 0===i||i.handleInitialDatabaseRender(),r.vF.hackyOffsetParsesCorrectly()||Od.j(this.environment,"luxon_hacky_offset_parses_correctly_false"))},this.handleSearchButtonClick=()=>{this.collectionContextStore.searchOpen.setState(!0),F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_search"})},this.handleSearchQueryChange=e=>{pe.Ug({searchQuery:e.target.value,collectionContextStore:this.collectionContextStore,isFullScreen:Boolean(this.props.isFullScreen)}),I.ik(this.environment,{view_type:this.getCurrentViewType()})},this.handleSearchFocus=()=>{zo.default.reset(),Go.default.reset()},this.handleSearchBlur=()=>{this.collectionContextStore.searchQuery.state||this.handleClearSearch()},this.handleSearchKeyDown=e=>{27===e.keyCode&&this.handleClearSearch()},this.handleClearSearch=()=>{this.collectionContextStore.searchQuery.setState(""),this.collectionContextStore.searchOpen.setState(!1)},this.handleAddItemClick=e=>{var t;if(!this.collectionContextStore.collectionViewBlockStore()||!(0,Ce.M_)(this.environment))return;const o=this.isInHomeWidget.state,r=this.isMultiSourceView.state,i=null===(t=this.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.getType();Q.createAndCommit({userAction:"CollectionViewBlock.handleAddItemClick",environment:this.environment,perform:t=>{var n;pe.NZ({store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,transaction:t,shouldCoerce:!0,showMoveTo:r,peekModeOverride:o?"center_peek":void 0,from:"cvb_add_item",useCrdt:(0,so.SL)({event:e,source:"table"===i?"collection_table_view":"collection_non_table_view",contextualDefault:null===(n=this.collectionContextStore.defaultPageTemplateStore.state)||void 0===n?void 0:n.useCrdt()})})}}),F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_new_item"}),this.projManagementTooltipTourAssignToSomeone()},this.handleTemplatesDropdownClick=()=>{F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_templates_dropdown"})},this.handleTemplateClick=e=>{Q.createAndCommit({userAction:"CollectionViewBlock.handleTemplateClick",environment:this.environment,perform:t=>{const o=pe.NZ({transaction:t,store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,shouldCoerce:!1,from:"cvb_template",useCrdt:e.useCrdt});o&&E.ob({title:"template",environment:this.environment,store:o,templateStore:e.templateStore,isKeyboard:e.isKeyboard,isCreateIn:!1,transaction:t,from:"collection_view_block"})}}),this.projManagementTooltipTourAssignToSomeone(),this.stores.templateButtonPopupStore.reset()},this.handleTemplateEmptyPageClick=()=>{Q.createAndCommit({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",environment:this.environment,perform:e=>{pe.NZ({transaction:e,store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,shouldCoerce:!1,from:"cvb_template_empty_page",useCrdt:!1})}}),this.stores.templateButtonPopupStore.reset()},this.handleTemplateCancelClick=()=>{this.stores.templateButtonPopupStore.reset()},this.handleSetSourceClick=()=>{const{collectionContextStore:e}=this,t=e.settingsStore;this.isPlaceholderExternalCollectionStore.state?A.NG({collectionSettingsStore:t}):(A.r$({collectionContextStore:e,collectionSettingsStore:t}),F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_select_data_source"}))},this.handleNoDateAddPage=e=>{const{collectionContextStore:t}=this,o=this.getCollectionStore(),r=this.getCurrentCollectionViewStore(),i=this.timelineViewRef.current;if(!r||!o)return;if(!r.isDefined())return;const{performResult:n}=Q.createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:this.environment,perform:n=>"calendar"===r.getType()?D.Fv({environment:this.environment,store:e,collectionStore:o,collectionContextStore:t,startDayOfWeek:Pr.AK.state,results:this.getDefaultResults(),transaction:n}):i?i.addBlockToView({store:e,transaction:n}):void 0});n&&W.Z5({environment:this.environment,stores:[n]})},this.handleOpenAsPageClick=()=>{I.Ji(this.environment,{view_type:this.getCurrentViewType()})},this.handleNoDateButtonClick=()=>{F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_no_date"})},this.initializeSyncStatePolling=async()=>{if(this.isSyncingStore.state){const e=this.getCollectionStore(),t=null==e?void 0:e.getFormat().uri,o=null==e?void 0:e.getFormat().bot_id,r=null==e?void 0:e.id;if(!t||!o||!r)return;await this.pollSyncState({uri:t,botId:o,collectionId:r})}},this.pollSyncState=async e=>{const t=await N.getExternalCollectionSyncState(this.environment,e);if("success"===t.type&&t.data.result){const o=t.data.result,r=this.collectionContextStore.numberChildrenReceived,i=this.collectionContextStore.numberChildrenUnfurled;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(this.syncStateTimeout=setTimeout((async()=>{await this.pollSyncState(e)}),1e4))}},this.resetCollectionSubscriptions=e=>{const t=Array.from(this.subscriptions.keys()),o=_.e5(t,e),r=_.e5(e,t);for(const n of o){var i;null===(i=this.subscriptions.get(n))||void 0===i||i.unsubscribe(),this.subscriptions.delete(n)}for(const n of r){const e=new yg(this.environment,(0,T.jY)(n),this.handleCollectionEmit);e.subscribe(),this.subscriptions.set(n,e)}},this.subscribeToTypeChanges=()=>{const e=this.collectionContextStore.contextType,t=this.collectionContextStore.databaseType;if("collectionTypedView"!==e||!t||this.collectionTypeChangeSubscription)return;const o=new yg(this.environment,(0,T.JY)({spaceId:this.props.store.getSpaceId(),databaseType:t}),this.handleCollectionTypeChangeEmit);o.subscribe(),this.collectionTypeChangeSubscription=o},this.isSyncingStore=this.createComputedStore((()=>{var e;const t=this.getCollectionStore(),o=null==t?void 0:t.isSyncedCollection(),r=!0===(null==t||null===(e=t.getFormat().sync_state)||void 0===e?void 0:e.syncing),i=this.environment.device.isMobile;return Boolean(o&&r&&!i)})),this.canShowPmIntroTooltipStore=this.createComputedStore((()=>{if(this.environment.device.isMobile)return!1;const e=Lo.default.state.currentUserSettingsStore,t=Lo.default.state.currentSpaceStore;if(!(0,X.jH)(e,t)&&(!t||t.getCreatedTime()<X.VL))return!1;if(!this.isTasksDB())return!1;if(this.props.store.pathIsDead())return!1;return!!this.collectionContextStore.permissionScopes.state.canEditContent&&(!!(0,X.Z0)()&&Lo.default.state.inAppCalloutStore.canShow("pm_intro_tooltip"))})),this.isMultiSourceView=this.createComputedStore((()=>"collectionTypedView"===this.collectionContextStore.contextType)),this.isInHomeWidget=this.createComputedStore((()=>(0,Pr.YO)(this.collectionContextStore.isInPeekRenderer.state))),this.isMyTasksPage=this.createComputedStore((()=>(0,Pr.qG)(this.props.store.id))),this.isTasksEmpty=this.createComputedStore((()=>!!this.isMyTasksPage.state&&this.collectionContextStore.isEmptyStore.state)),this.isCompactView=this.createComputedStore((()=>this.collectionContextStore.isCompactView.state)),this.isTasksDB=()=>{const e=this.collectionContextStore.collectionViewBlockStore();return(null==e?void 0:e.getFormat().app_config_uri)===p.NB},this.shouldRestrictHeaderWidthForMarginComments=()=>this.isRootOrDirectChild()&&!(0,le._5)(this.props.store)&&this.marginCommentsVisible.state,this.shouldRenderOptions=()=>void 0!==this.collectionContextStore.collectionStore()||"collectionTypedView"===this.collectionContextStore.contextType,this.shouldRestrictWidthForMarginComments=this.createComputedStore((()=>{const e=this.getCurrentCollectionViewStore(),t=this.props.overrideViewType??(null==e?void 0:e.getType());return this.shouldRestrictHeaderWidthForMarginComments()&&t&&(le.bu.has(t)||"timeline"===t&&this.collectionContextStore.collectionStore()&&!(0,Bi.C1)({environment:this.environment,format:this.collectionContextStore.normalizedFormatStore.state,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild()}))})),this.isPlaceholderExternalCollectionStore=this.createComputedStore((()=>{const e=this.getCollectionStore();return!!e&&(0,m.OY)(e.getValue())})),this.getExternalIntegrationId=this.createComputedStore((()=>{const e=this.getCollectionStore();if(e)return e.getFormat().integration_id})),this.leftRightPadding=this.createComputedStore((()=>{var e;const{store:t,isFullScreen:o,overridePaddingLeft:r,overridePaddingRight:i,renderInLayoutEditorGrid:n}=this.props;if(n)return{paddingLeft:0,paddingRight:0};const s=(0,le.Bs)({environment:this.environment,store:t,isFullScreen:o,sizeObserver:this.headerSizeObserver,viewType:null===(e=this.collectionContextStore.collectionViewStore())||void 0===e?void 0:e.getType()});s&&void 0!==r&&(s.paddingLeft=r),s&&void 0!==i&&(s.paddingRight=i);const l=this.shouldRestrictWidthForMarginComments.state;return s&&l&&(s.paddingRight+=(0,Td.gC)(this.environment,(0,le.en)(t),this.isInFrameWhenSidePeekOpen.state)),s})),this.isLoadedStore=this.createComputedStore((()=>this.collectionContextStore.isLoaded.state)),this.leftRightMargin=this.createComputedStore((()=>{if(!this.isRootOrDirectChild()||!this.marginCommentsVisible.state||!(0,le._5)(this.props.store)||this.props.store.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};const e=Td.QB/2;return{marginLeft:e,marginRight:-e}})),this.noDateTotal=this.createComputedStore((()=>{if(this.noDateReducerStore.state){const e=this.stores.noDateResultStore.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}return 0})),this.noDateReducerStore=this.createComputedStore((()=>{const e=this.getNoDateProperty();if(e){return{type:"aggregation",aggregation:{property:e,aggregator:"empty"}}}})),this.hasTasksReducerStore=this.createComputedStore((()=>{if(this.isMyTasksPage.state){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}})),this.hasAppliedFilter=this.createComputedStore((()=>(0,Ut.RL)({collectionContextStore:this.collectionContextStore,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0)),this.hasSort=this.createComputedStore((()=>{const{collectionContextStore:e}=this;return e.currentSortsStore.state.length>0})),this.showHoverActionsStore=this.createComputedStore((()=>{const{device:e}=this.environment,{mouseStore:t,headerMouseStore:o,focusStore:r,createSortSettingsStore:i,createFilterSettingsStore:n,filterBarCreateFilterSettingsStore:s,saveControlMoreActionsButtonPopupStore:l}=this.stores,{collectionContextStore:a}=this,c=this.isFullScreen(),d=r.state,u=a.settingsStore.state.open,p=a.searchOpen.state,h=i.state.open,m=n.state.open,S=s.state.open,g=a.filterBarSortSettingsStore.state.open,C=Array.from(a.filterBarItemSettingsStoreMap.values()),f=l.state.open,v=C.some((e=>e.state.open));return Boolean(t.state.mouseEntered||o.state.mouseEntered||d||c||this.shouldShowProjManagementTooltipTour()||e.isMobile||u||v||h||m||S||p||f||g)})),this.showCompactDesktopHeaderStore=this.createComputedStore((()=>{const{device:e}=this.environment,t=this.headerSizeObserver.rect.state;return!e.isMobile&&t.width&&t.width<400||this.isCompactView.state})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>(0,le.Ks)(this.props.store))),this.isInPeek=this.createComputedStore((()=>(0,le.en)(this.props.store))),this.shouldRenderCompactViewVerticalScroller=this.createComputedStore((()=>{const e=this.props.overrideViewType??this.getCurrentViewType();return!("collectionVirtualView"===this.collectionContextStore.contextType)&&this.isCompactView.state&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":return!0;case"calendar":return!1;default:return(0,ut.t1)(e)}}(e)})),this.reasonToDisableNewTaskButton=this.createComputedStore((()=>{const e=this.collectionContextStore.collectionStoresStore.state,t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));if(this.isMultiSourceView.state)return e?0===e.length?"noDbs":t?void 0:Nh:"loading"}))}insertBlocks(e,t){const o=this.getCollectionStore();if(o)for(const r of e)L.mp({environment:this.environment,store:r,collectionStore:o,collectionContextStore:this.collectionContextStore,shouldCoerce:!0,groupsPointer:[],transaction:t});return[]}handleCreated(){W.ZH(this.environment),l.default.afterNextFlush((()=>{const{collectionContextStore:e}=this,t=e.collectionStore(),o=e.collectionViewBlockStore(),r=e.settingsStore;if(!o)return;const i=o.getCollectionViewSourceCollectionStore();if(this.isPlaceholderExternalCollectionStore.state)A.NG({collectionSettingsStore:r});else if(i)pe.W1({environment:this.environment,collectionContextStore:e});else if(t)A.r$({collectionContextStore:e,collectionSettingsStore:r}),(0,ee.V)({collectionStore:t,collectionContextStore:e,collectionSettingsStore:r});else{const t=Yt.default.checkGate("typed_db_creation");A.r$({collectionContextStore:e,collectionSettingsStore:r}),t?A.wl({collectionSettingsStore:r,item:{type:"createTypedDB"}}):A.wl({collectionSettingsStore:r,item:{type:"createViewSource"}})}}))}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.trackRenderTime({isFirstRender:!0}),this.collectionContextStore.isLoaded.addListener(this.handleLoadedStoreChange),this.handleLoadedStoreChange(),this.renderStartTime=performance.now()}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{store:t}=e,o=t.id,{collectionContextStore:r}=this,i=this.collectionContextStore.collectionViewStore(),n=this.collectionContextStore.collectionStore(),s=this.environment.currentUser.id,l=i?i.id:void 0,a=n?n.id:void 0,c=this.getViewStores().map((e=>e.id)),d=this.getDefaultCollectionViewStore(),u=k.Z.get({userId:s,key:no.Z.getLocalViewPreferenceKey(o)});let p;if(e.viewId&&c.indexOf(e.viewId)>=0?p=e.viewId:i&&c.indexOf(i.id)>=0?p=i.id:u&&c.indexOf(u)>=0?p=u:d&&c.indexOf(d.id)>=0&&(p=d.id),p){const e=ge.Xr.createChildStore(t,{table:O.n,id:p}),i=e.getCollectionStore(),n=!i||i.isDefined();e.isDefined()&&n&&(p!==u&&k.Z.set({userId:s,key:no.Z.getLocalViewPreferenceKey(o),value:p}),(p!==l||i&&i.id!==a)&&pe.mc({environment:this.environment,collectionViewBlockStore:t,collectionViewStore:e,collectionStore:i,collectionContextStore:r,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild(),isInPeekRenderer:this.isInPeekRenderer()}),void 0===r.frozoneStore.state.frozenIndex&&this.resetFrozoneStore(e))}const h=r.collectionStore();if(h){h.getTemplatePageStores().map((e=>e.getValue()))}this.isSyncingStore.addListener(this.initializeSyncStatePolling),this.ensureStoreListeners()}UNSAFE_willUpdate(){this.trackRenderTime({isFirstRender:!1})}didMount(){var e,t;super.didMount(),Dd.Z.addListener(this.handlePageVisibilityChange),Ho.default.addListener(this.handlePeekViewChange),this.collectionContextStore.relativeVariablesAreStale.addListener(this.handleRelativeVariableStaleStoreChange);const o=this.collectionContextStore.collectionViewStore(),r=this.collectionContextStore.collectionStore();if(o&&r){const e=o.getType();e&&B.es(this.environment,{collection_id:r.id,collection_view_id:o.id,collection_view_block_id:this.props.store.id,type:e,is_full_screen:this.isFullScreen(),is_peek:this.isInPeekRenderer(),peek_mode:Ho.default.state.mode})}if(o&&"collectionTypedView"===this.collectionContextStore.contextType){const e=this.collectionContextStore.databaseType,t=o.getType();e&&t&&B.Wg(this.environment,{collection_view_id:o.id,collection_view_block_id:this.props.store.id,type:t,databaseType:e,is_my_tasks:(0,Xc.Ep)("myTasks")===this.props.store.id})}const i=this.collectionContextStore.sprintSettingsContextStore.state;$.Wu({environment:this.environment,sprintSettingsContext:i}),null===(e=(t=this.props).setCollectionContextStore)||void 0===e||e.call(t,this.collectionContextStore)}didMountOrUpdate(){var e,t;const o=this.getCollectionStore();o?this.resetCollectionSubscriptions([o.id]):this.resetCollectionSubscriptions(this.collectionContextStore.remoteCollectionIds.state);const r=this.collectionContextStore.frozoneStore.state.scrollerWidth,i=null===(e=this.collectionContextStore.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(r,this.collectionContextStore.normalizedFormatStore.state);var s;(void 0===i||this.isCompactView.state||this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,frozenIndex:i}),this.collectionContextStore.remoteCollectionIds.addListener((e=>this.resetCollectionSubscriptions(e.state))),this.subscribeToTypeChanges(),this.parentNode)||(this.parentNode=null===(s=n.findDOMNode(this))||void 0===s?void 0:s.parentElement,this.parentNode&&((0,Sr.lj)(this.parentNode,"focusin",this.handleFocusIn),(0,Sr.lj)(this.parentNode,"focusout",this.handleFocusOut),(0,Sr.lj)(this.parentNode,"mousemove",this.handleMouseMove),(0,Sr.lj)(this.parentNode,"mouseleave",this.handleMouseLeave)));const l=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.scrollerEl();l&&(0,Sr.lj)(l,"scroll",this.handleScroll)}didUpdate(e){this.trackSwitchViewLag()}willUnmount(){var e,t;super.willUnmount();const{collectionContextStore:o}=this;pe.ob({collectionContextStore:o}),this.unsubscribeAll(),this.headerSizeObserver.destroy(),Dd.Z.removeListener(this.handlePageVisibilityChange),Ho.default.removeListener(this.handlePeekViewChange),this.collectionContextStore.isLoaded.removeListener(this.handleLoadedStoreChange),this.collectionContextStore.relativeVariablesAreStale.removeListener(this.handleRelativeVariableStaleStoreChange),this.parentNode&&((0,Sr.ZV)(this.parentNode,"focusin",this.handleFocusIn),(0,Sr.ZV)(this.parentNode,"focusout",this.handleFocusOut),(0,Sr.ZV)(this.parentNode,"mousemove",this.handleMouseMove),(0,Sr.ZV)(this.parentNode,"mouseleave",this.handleMouseLeave));const r=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();r&&(0,Sr.ZV)(r,"scroll",this.handleScroll),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.isSyncingStore.removeListener(this.initializeSyncStatePolling),clearTimeout(this.syncStateTimeout)}renderPersisted(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=this.getCollectionStore(),r=e.normalizedSchemaStore.state,i=e.normalizedQueryStore.state,n=e.normalizedFormatStore.state,s=this.isFullScreen();if(!(t&&r&&i&&n))return;const l=this.props.overrideViewType??t.getType();if(!l)return;if(o&&!o.isDefined())return;if(this.isCollectionViewOfExternalCollectionWithoutExternalObjectId())return(0,v.jsx)(Ui.L1,{value:this.collectionContextStore,children:(0,v.jsx)(Jn.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,onClick:this.handleEditorClick,ref:this.handleHeaderMount,children:(0,v.jsx)(It.Z,{store:this.props.store,shouldShowHoverMenu:!0,analyticsName:kg(l),shouldShowHalo:!this.isFullScreen()&&!this.isCompactView.state,canSelect:!this.isFullScreen(),children:(0,v.jsx)(qS.Z,{store:this.props.store,style:{width:"auto"},disabled:!1})})})});const a=(0,na.$3)(this.environment)-Ya.zL,c=this.isInFrameWhenSidePeekOpen.state&&!this.props.isFullScreen&&!(0,le._5)(this.props.store)&&a>0&&!this.isInHomeWidget.state,d=this.renderView(o,t,this.props.overrideViewType??l,r,i,n),u=this.isInPeek.state?St.Z.X:(0,Pr.p5)({environment:this.environment,isFullScreen:this.isFullScreen()}),p=this.props.renderInLayoutEditorGrid&&!Cg.includes(l)?d:(0,v.jsx)(Ct.Z,{type:u,className:ro.x9t,onMouseDown:this.handleEditorMouseDown,preventType:this.isInPeek.state||this.isInHomeWidget.state?St.Z.None:K.Q7(this.environment),onClick:e=>this.handleEditorClick(e,l),style:this.getScrollerStyle(l,n,c?a/2:void 0),ref:this.handleHorizontalScrollerMount,children:d}),h=(0,v.jsx)(vt,{children:p}),m={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state},S=s?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:{position:"sticky",height:0,left:0,zIndex:M.Nm},children:this.renderViewSettings()}),(0,v.jsx)(Jn.p,{allowSelectionWithin:!0,style:{...m,position:"relative"},children:p})]}):(0,v.jsx)(Jn.p,{allowSelectionWithin:!0,style:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state,...c&&{marginLeft:-a/2},height:"calc(100% - 40px)"},children:(0,v.jsxs)("div",{style:{position:"relative",height:"100%"},children:[this.shouldRenderCompactViewVerticalScroller.state?h:p,this.renderViewSettings()]})});return this.props.renderInLayoutEditorGrid?(0,v.jsxs)(Ui.L1,{value:this.collectionContextStore,children:[(0,v.jsx)(_g,{}),(0,v.jsxs)(QS.cx,{children:[(0,v.jsxs)(QS.bU,{children:[this.renderMultiSelectToolbar(),this.renderHeader(l)]}),gg.includes(l)?(0,v.jsx)(QS.i2,{children:S}):(0,v.jsx)(QS.bU,{children:S}),(0,v.jsxs)(QS.bU,{children:[this.renderBottomBorderForViewSettings(),(0,v.jsx)(Sg,{collectionContextStore:this.collectionContextStore,parentMountTime:this.renderStartTime})]})]})]}):(0,v.jsxs)(Ui.L1,{value:this.collectionContextStore,children:[(0,v.jsx)(_g,{}),this.renderMultiSelectToolbar(),this.renderHeader(l),S,this.renderBottomBorderForViewSettings(),(0,v.jsx)(Sg,{collectionContextStore:this.collectionContextStore,parentMountTime:this.renderStartTime})]})}renderHeader(e){var t,o;const{device:r}=this.environment,{store:i,disableHoverMenu:n}=this.props,s=this.isFullScreen(),l=this.noDateReducerStore.state,a=this.hasTasksReducerStore.state,c=this.showHoverActionsStore.state,d=this.showCompactDesktopHeaderStore.state,u=this.leftRightPadding.state,p=(null===(t=this.collectionContextStore.collectionViewBlockStore())||void 0===t?void 0:t.isCollectionViewPageWithContent())&&"page"===(null===(o=this.collectionContextStore.collectionViewStore())||void 0===o?void 0:o.getType()),h=this.shouldShowProjManagementTooltipTour()?(0,v.jsx)(ph.Z,{store:i,origin:this.renderViewSettingsButton(),isFirstTooltip:!1,phase:"click_view_settings"}):this.renderViewSettingsButton();return(0,v.jsxs)(Jn.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,ref:this.handleHeaderMount,children:[u&&(0,v.jsxs)(It.Z,{store:i,shouldShowCopyLinkButton:i.isLocked(),shouldShowHoverMenu:!n&&this.canEdit()&&!s,analyticsName:kg(e),children:[r.isPhone?(0,v.jsxs)("div",{style:this.getHeaderStyle(),children:[this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,v.jsx)(ts.Z,{isVisible:!0,animationStyle:{opacity:c?1:0},render:()=>(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[this.renderLoadingSpinner(),this.renderFullScreenButton(),h,this.renderAddItemButton()]})})]}):(0,v.jsxs)("div",{style:this.getHeaderStyle(),children:[this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,v.jsx)(ts.Z,{isVisible:!0,animationStyle:{opacity:c?1:0},render:()=>(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:2},children:[this.renderLoadingSpinner(),!d&&this.renderLockIndicator(),!d&&this.renderNoDateButton(),"page"!==e&&this.renderFilterButton(),"page"!==e&&this.renderSortButton(),this.renderAutomationSettingsButton(),!d&&"page"!==e&&this.renderSearch(),p&&this.renderPageViewSearch(),this.renderFullScreenButton(),h,this.renderAddItemButton()]})})]}),a&&(0,v.jsx)(Ke.Z,{id:"tasks_results",collectionContextStore:this.collectionContextStore,reducer:a,resultStore:this.stores.tasksResultStore}),l&&(0,v.jsx)(Ke.Z,{id:"no_date_count",collectionContextStore:this.collectionContextStore,reducer:l,resultStore:this.stores.noDateResultStore})]}),(0,v.jsxs)("div",{style:this.getHeaderPositioningStyle(),children:[this.renderSource(),this.renderFilterBar()]})]})}renderLockIndicator(){const{device:e}=this.environment,{store:t}=this.props;if(!this.isFullScreen()&&!e.isPhone&&t.canEditCollection())return(0,v.jsx)(YS.Z,{store:t,isMobile:!1,isInlineCollection:!0,disableTooltip:!0,buttonStyle:{marginLeft:4,marginRight:4}})}renderViewTabBar(){return(0,v.jsx)(yd,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,isPlaceholderExternalCollectionStore:this.isPlaceholderExternalCollectionStore,onViewClick:this.handleViewClick,disabled:this.props.hideHeader||this.isInHomeWidget.state})}renderFullScreenButton(){const{store:e}=this.props;if(this.isFullScreen())return;const t=(0,Bo.ZP)({store:e,fullyQualified:!1,pageVisitSource:u.tY.Expand}),o=ze.default.formatMessage(vg.openFullscreenPageButtonTooltip);return(0,v.jsx)(et.ZP,{renderTooltip:()=>o,render:e=>(0,v.jsx)(jt.Z,{ariaLabel:o,href:t,onClick:this.handleOpenAsPageClick,icon:x.Z,style:{...this.getTopbarIconButtonStyle()},iconStyle:{fill:this.getTopbarIconButtonStyle().fill,width:16},...e})})}renderAutomationSettingsButton(){const{collectionContextStore:e,automationsViewRef:t}=this,o=this.getCurrentCollectionViewStore(),r=this.props.overrideViewType??(null==o?void 0:o.getType()),i=e.settingsStore,n=i.state.open,s=(0,jd.n)(i),l=(0,h.Cf)({tab:s}),a=e.aliveAutomationCount.state;if("page"===r||this.isPlaceholderExternalCollectionStore.state||!(0,Rd.cB)(e))return;const c=a>0;return(0,v.jsx)(et.ZP,{renderTooltip:()=>ze.default.formatMessage(vg.openAutomationsSettingsButtonTooltip),render:e=>(0,v.jsx)(jt.Z,{ariaLabel:ze.default.formatMessage(vg.openAutomationsSettingsButtonAriaLabel),className:ro.RIA,icon:S.K,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:14,fill:c?this.theme.icon.uiBluePrimary:this.theme.mediumTextColor},hovered:n&&l,onClick:this.handleViewAutomationSettingsClick,ref:t,...e})})}renderViewSettingsButton(){return this.isPlaceholderExternalCollectionStore.state?null:(0,v.jsx)(ca.LazyCollectionViewSettingsButton,{collectionContextStore:this.collectionContextStore,style:this.getTopbarIconButtonStyle()})}renderFilterButton(){const{device:e}=this.environment,{createFilterSettingsStore:t}=this.stores;if(this.shouldRenderOptions()&&!this.isPlaceholderExternalCollectionStore.state)return(0,v.jsx)(Je.ZP,{popupType:e.isMobile?Ye.Z4.SlideUp:Ye.Z4.Popup,open:t.state.open,origin:this.renderFilterButtonOrigin(),onDismiss:this.handleCreateFilterPopupDismiss,originGap:4,render:this.renderCreateFilterPopup})}renderFilterButtonOrigin(){const e=this.hasAppliedFilter.state;if(this.showCompactDesktopHeaderStore.state){const t=ze.default.formatMessage(vg.filterLabel),o=0===this.collectionContextStore.collectionStoresStore.state.length;return(0,v.jsx)(et.ZP,{renderTooltip:()=>t,disableTooltip:o,render:r=>(0,v.jsx)(jt.Z,{...r,disabled:o,ariaLabel:t,icon:C.Q,iconStyle:{width:14,height:void 0,fill:e?this.theme.icon.uiBluePrimary:this.theme.mediumIconColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleFilterClick})})}return(0,v.jsx)(Xe.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleFilterClick,children:(0,v.jsx)(j.FormattedMessage,{...vg.filterLabel})})}renderSortButton(){const{device:e}=this.environment;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const{createSortSettingsStore:t}=this.stores;return(0,v.jsx)(Je.ZP,{popupType:e.isMobile?Ye.Z4.SlideUp:Ye.Z4.Popup,open:t.state.open,origin:this.renderSortButtonOrigin(),onDismiss:this.handleCreateSortPopupDismiss,originGap:4,render:this.renderCreateSortPopup})}renderSortButtonOrigin(){const e=this.hasSort.state;if(this.showCompactDesktopHeaderStore.state){const t=ze.default.formatMessage(vg.sortLabel),o=0===this.collectionContextStore.collectionStoresStore.state.length;return(0,v.jsx)(et.ZP,{renderTooltip:()=>t,disableTooltip:o,render:r=>(0,v.jsx)(jt.Z,{...r,disabled:o,ariaLabel:t,icon:w.j,iconStyle:{width:18,height:void 0,fill:e?this.theme.icon.uiBluePrimary:this.theme.mediumIconColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleSortClick})})}return(0,v.jsx)(Xe.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleSortClick,children:(0,v.jsx)(j.FormattedMessage,{...vg.sortLabel})})}renderSearch(){const{collectionContextStore:e}=this;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const t=e.searchOpen.state,o=e.searchQuery.state;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(jt.Z,{icon:g.e,iconStyle:{width:14,height:void 0,fill:this.theme.mediumTextColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleSearchButtonClick}),(0,v.jsx)(ts.Z,{isVisible:t,animationStyle:{width:150,opacity:1},enterAnimationStyle:{width:0,opacity:0},exitAnimationStyle:{width:0,opacity:0},render:()=>(0,v.jsx)(Rc.Z,{capture:t,allowEsc:!0,render:e=>(0,v.jsx)("div",{...e,children:(0,v.jsx)("div",{style:{display:"flex",alignItems:"center",overflow:"hidden"},children:(0,v.jsx)($S.Z,{style:this.getSearchInputStyle(),format:$S.B.Transparent,value:o,onChange:this.handleSearchQueryChange,placeholder:ze.default.formatMessage(vg.searchInputPlaceholder),focusInitial:t,showClearButton:!0,onFocus:this.handleSearchFocus,onBlur:this.handleSearchBlur,onCancel:this.handleClearSearch,onClick:me.Wi,onClearButtonClick:this.handleClearSearch,onKeyDown:this.handleSearchKeyDown})})})})})]})}renderPageViewSearch(){var e;const t=this.getCurrentCollectionViewStore();if("page"!==(null==t?void 0:t.getType()))return null;const o=null===(e=this.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return o?(0,v.jsxs)(Xe.Z,{style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:R.Z.fontWeight.medium,color:this.theme.mediumTextColor},onClick:()=>{U.Kf({environment:this.environment,analyticsFrom:"wiki-home-collection-view"}),Ad.ZP.updateFilters({ancestors:[o]})},children:[(0,g.e)({width:14,fill:this.theme.mediumIconColor,marginRight:6}),(0,v.jsx)(j.FormattedMessage,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}renderAddItemButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore();if("page"===(this.props.overrideViewType??(null==t?void 0:t.getType()))||this.isPlaceholderExternalCollectionStore.state||!e.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return null;const o=(0,le.PI)(e),r={fontSize:14,...this.isCompactView.state?{marginLeft:4,marginRight:6,marginTop:4,width:24,height:24}:{marginLeft:6,height:28}},i=this.isCompactView.state?{marginRight:0,marginLeft:-4,width:15}:{},n=this.isMultiSourceView.state,s=e=>(0,v.jsx)(JS.Z,{title:this.isCompactView.state?null:o,icon:this.isCompactView.state?b.f:void 0,color:"blue",onClick:this.handleAddItemClick,dropdownEvents:e,style:r,iconStyle:i,className:ro.sqL,disabled:Boolean(this.reasonToDisableNewTaskButton.state),disableDropdown:n});return(0,v.jsx)(Ye.ZP,{popupType:this.environment.device.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,render:this.renderTemplatesPopup,originGap:4,onClick:this.handleTemplatesDropdownClick,renderOrigin:e=>this.shouldShowProjManagementTooltipTour()?(0,v.jsx)(ph.Z,{store:this.props.store,origin:s(e),isFirstTooltip:!0,phase:"create_a_task"}):(0,v.jsx)(et.ZP,{renderTooltip:()=>this.reasonToDisableNewTaskButton.state===Nh?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,v.jsx)("br",{})}}):this.isCompactView.state?o:null,render:t=>this.isCompactView.state||this.reasonToDisableNewTaskButton.state===Nh?(0,v.jsx)("div",{...t,style:{marginLeft:4,marginRight:4},children:s(e)}):s(e)}),buttonPopupStore:this.stores.templateButtonPopupStore})}renderNoDateButton(){const e=this.noDateTotal.state,{collectionContextStore:t}=this,o=t.permissionScopes.state;if(t.collectionStore()&&0!==e&&o.canEditContent)return(0,v.jsx)(Ye.ZP,{popupType:this.environment.device.isMobile?Je.kQ.SlideUp:Je.kQ.Popup,render:this.renderNoDatePopup,onClick:this.handleNoDateButtonClick,renderOrigin:t=>(0,v.jsx)(Xe.Z,{isGray:!0,style:this.getTopbarActionButtonStyle(!1),...t,children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:e}})})})}renderFilterBar(){const{collectionContextStore:e}=this,t=e.filtersBarOpenStore.state,o=e.shouldShowSource.state?8:12,r=this.getCurrentCollectionViewStore();if("page"!==(this.props.overrideViewType??(null==r?void 0:r.getType()))&&!this.isCompactView.state){if(!t){if(!e.getCompleteSprintButtonContext.state)return;return(0,v.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:this.environment.device.isPhone?12:8,paddingTop:o},children:[(0,v.jsx)("div",{style:{flex:1}}),(0,v.jsx)(eg.Z,{collectionContextStore:e})]})}return(0,v.jsx)(uc.Z,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,createFilterSettingsStore:this.stores.filterBarCreateFilterSettingsStore,saveControlMoreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}}renderSource(){if(!this.isPlaceholderExternalCollectionStore.state)return this.collectionContextStore.shouldShowSource.state?(0,v.jsx)(ec,{store:this.props.store,collectionContextStore:this.collectionContextStore,isFullScreen:this.isFullScreen(),showHoverActionsStore:this.showHoverActionsStore,canEdit:this.canEdit()}):void 0}renderView(e,t,o,r,i,n){const{store:s}=this.props,{collectionContextStore:l}=this,a=!this.canEdit()||"collectionVirtualView"===l.contextType;"rendered"!==Lo.default.state.renderPhase&&Lo.default.setState({...Lo.default.state,renderPhase:"rendered"});const c=this.isFullScreen(),d=this.isInPeekRenderer(),u=this.getBlockPropertyValueOverlayStore(),p=this.isRootOrDirectChild();let h=this.leftRightPadding.state;if(h){if(!e&&this.collectionContextStore.hasSingleCollection())return this.renderNoSourcePlaceholder(o);if(this.isPlaceholderExternalCollectionStore.state)return this.renderNoSourceExternalCollectionPlaceholder(o);if(this.isTasksEmpty.state)return(0,v.jsx)(Dh,{collectionContextStore:l,onAddTaskClick:this.handleAddItemClick,from:l.isCompactView.state?"home_tile_tasks":"home_tasks"});if("table"===o)return(0,v.jsx)(Aa,{schema:r,format:n,query:i,store:s,collectionContextStore:l,showHoverActionsStore:this.showHoverActionsStore,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p,viewSettingsPlacementStore:this.stores.viewSettingsPlacementStore},t.id);if("board"===o)return(0,v.jsx)(hu,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id);if("page"===o){const e=t.getFormat().page_pointer;if(!e)return;const o=this.createComputedStore((()=>s.id===e.id?s:ge.G.createChildStore(s,{table:e.table,id:e.id}))),r=(0,Pr.ui)(this.environment),i=o.state;if(!i.isCollectionView())return;const n=this.canEdit();return(0,v.jsx)(hg,{canEdit:n,disabled:this.props.store.isLocked()||this.props.disabled,padding:{paddingBottom:XS.ZP.paddingBottom(this.environment),paddingLeft:r,paddingRight:r},store:i,style:XS.d$})}return"calendar"===o?(0,v.jsx)(Sp,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id):"list"===o?(this.isInFrameWhenSidePeekOpen.state&&!this.isInHomeWidget.state&&(h={...h,paddingRight:24}),(0,v.jsx)(Ap,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id)):"gallery"===o?(0,v.jsx)(mn,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id):"timeline"===o?(0,v.jsx)(zS,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isRootChild:p,isInPeekRenderer:d,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,showHoverActionsStore:this.showHoverActionsStore,ref:this.timelineViewRef,...h},t.id):"chart"===o?(0,v.jsx)(ca.LazyCollectionChartView,{collectionContextStore:l,schema:r,format:n},t.id):void 0}}renderNoSourcePlaceholder(e){const t=this.isFullScreen(),o=this.collectionContextStore.permissionScopes.state;return(0,v.jsx)(uu,{collectionContextStore:this.collectionContextStore,title:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:o.canConfigureBlock?(0,v.jsx)(j.FormattedMessage,{defaultMessage:"<button>Select a data source</button> to continue",id:"collectionViewBlock.setSourceButton.title",values:{button:e=>(0,v.jsx)(du,{onClick:this.handleSetSourceClick,children:e})}}):void 0,icon:y({height:48,fill:this.theme.lightIconColor,margin:"0 auto"}),style:{...this.leftRightPadding.state,paddingBottom:t?void 0:this.getPaddingBottom(e)}})}renderNoSourceExternalCollectionPlaceholder(e){var t;const o=this.isFullScreen(),r=this.collectionContextStore.permissionScopes.state,i=this.collectionContextStore.settingsStore.state.open,n={display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},s=this.getExternalIntegrationId.state,l=Fd.Z.integrations.state.find((e=>e.id===s)),a=!(this.environment.device.isMobileBrowser&&this.isPlaceholderExternalCollectionStore.state&&!this.isUserAuthenticated());if(l)return(0,v.jsx)("div",{style:{...this.leftRightPadding.state,paddingTop:8,paddingBottom:o?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,v.jsxs)("div",{style:{paddingRight:i?te.nJ:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,v.jsx)(Vo.Z,{icon:null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.getIcon(),size:48,disabled:!0,isEmptyPage:!1}),(0,v.jsx)("div",{style:{fontSize:17,fontWeight:R.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2},children:(0,v.jsx)(j.FormattedMessage,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:l.name}})}),r.canConfigureBlock&&(0,v.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:this.theme.lightTextColor},children:a&&(0,v.jsx)(j.FormattedMessage,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:l.name,button:e=>(0,v.jsx)(ko.Z,{style:n,onClick:this.handleSetSourceClick,children:e})}})})]})})}renderLoadingSpinner(){const e=this.collectionContextStore.shouldShowSpinner.state&&!this.isInHomeWidget.state;return(0,v.jsx)(Vd.Z,{show:e,...le.Mq,render:e=>e?(0,v.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,v.jsx)(Ue.Z,{style:{width:14,height:14}})}):void 0},"loading-spinner")}renderBottomBorderForViewSettings(){const{collectionContextStore:e}=this;if(e.settingsStore.state.open&&"sidebar"===this.stores.viewSettingsPlacementStore.state)return(0,v.jsx)("div",{style:{...this.leftRightPadding.state,...this.leftRightMargin.state,borderTop:`1px solid ${this.theme.tableDividerColor}`,height:12}})}renderMultiSelectToolbar(){if((0,le.fk)({environment:this.environment,collectionContextStore:this.collectionContextStore})){var e;const t=(null===(e=this.leftRightPadding.state)||void 0===e?void 0:e.paddingLeft)??0,o=this.leftRightMargin.state.marginLeft??0;return(0,v.jsx)(xh,{marginLeft:t+o})}}unsubscribeAll(){for(const e of this.subscriptions.values())e.unsubscribe();this.collectionTypeChangeSubscription&&this.collectionTypeChangeSubscription.unsubscribe()}resetFrozoneStore(e){var t,o;if(this.isCompactView.state)return;const r=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.stores.store.state.clientWidth,i=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null===(o=this.horizontalScrollerEl)||void 0===o||null===(o=o.stores.store.state.clientRect)||void 0===o?void 0:o.left)??0,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,i),tryShowHiddenFrozenColumn:!1})}isCollectionViewOfExternalCollectionWithoutExternalObjectId(){var e;const t=null===(e=this.getCollectionStore())||void 0===e?void 0:e.getValue();return Boolean(t&&(0,m.Ev)(t))}isUserAuthenticated(){const e=this.collectionContextStore.collectionStore();if(!e)return!1;const t=e.getFormat().integration_id,o=Fd.Z.integrations.state.find((e=>e.id===t));return!(!t||!o)&&(0,Pd.NP)(t).length>0}getViewStores(){const{store:e}=this.props;return e.getCollectionViewStores()}getCurrentCollectionViewStore(){return this.collectionContextStore.collectionViewStore()}getDefaultCollectionViewStore(){var e;const t=this.getViewStores();if(null!==(e=t[0])&&void 0!==e&&e.isDefined())return t[0]}getCollectionStore(){return this.collectionContextStore.collectionStore()}getMinWidth(){const{store:e}=this.props,{device:t}=this.environment,o=t.isPhone,r=this.isFullScreen(),i=this.getCurrentViewType(),n=("gallery"===i||("calendar"===i||"list"===i)&&r)&&this.isInFrameWhenSidePeekOpen.state,s=(0,na.ll)(this.environment,this.isInPeekRenderer()),l=Ho.default.state;return this.isInHomeWidget.state?void 0:r||this.isRootOrDirectChild()?o?`calc(100% - ${2*(0,Pr.ui)(this.environment)}px - ${s}px)`:this.isInPeekRenderer()?`calc(100% - ${2*Ho.PeekModePadding.horizontal[l.mode]}px - ${s}px)`:this.isInFrameWhenSidePeekOpen.state?(0,na.$3)(this.environment)+(n?(0,na.vJ)(this.environment):0):r?`calc(100% - ${2*(0,Pr.CP)(this.environment)}px - ${s}px)`:(0,le._5)(e)?`calc(100% - ${2*(0,Pr.ui)(this.environment)}px - ${s}px)`:Ya.zL-2*(0,Pr.ui)(this.environment)-s:`calc(100% - ${s}px)`}isInPeekRenderer(){return(0,le.en)(this.props.store)}getBlockPropertyValueOverlayStore(){return this.isInPeekRenderer()?Ld.Z:Nd.Z}resetLeftScrollAfterFlush(){l.default.afterNextFlush((()=>{var e;const t=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();if(t){t.scrollLeft=0;const e=Se.xH(t);e&&(e.scrollLeft=0)}}))}isFullScreen(){return Boolean(this.props.isFullScreen)}getDefaultResults(){const e=this.collectionContextStore.localResultStore.state,t=this.getCollectionStore();if(t&&e&&"reducer"===e.type){const o=_.sE(e.reducerResults,(e=>"results"===e.type));if(o)return o.blockIds.map((e=>ge.G.createChildStore(t,{id:e,table:V.iU})))}return[]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):G.c4({environment:this.environment,url:e})}getCurrentViewType(){var e;const{collectionContextStore:t}=this,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getNoDateProperty(){const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.normalizedQueryStore.state;if(!e||!t)return;const o=e.getType();return"timeline"===o&&t.timeline_by?t.timeline_by:"calendar"===o&&t.calendar_by?t.calendar_by:void 0}ensureStoreListeners(){const{collectionContextStore:e}=this,{store:t}=this.props;e.blockIsPrivateStore.state;for(const o of t.getCollectionViewStores())o.getValue()}getScrollerStyle(e,t,o){const{store:r}=this.props,i=this.isFullScreen(),n=this.isRootOrDirectChild(),s=this.leftRightPadding.state,l=this.getPaddingBottom(e),a=this.collectionContextStore.settingsStore.state.open,c="collectionVirtualView"===this.collectionContextStore.contextType;return{flexGrow:1,flexShrink:0,...r.isLocked()&&{cursor:"default"},..."timeline"===e&&this.collectionContextStore.collectionStore()&&!i&&!(0,Bi.fj)({environment:this.environment,isFullScreen:i,isRootChild:n,format:t})&&s&&{marginLeft:s.paddingLeft,marginRight:s.paddingRight,marginBottom:l},...a&&!i&&"sidebar"===this.stores.viewSettingsPlacementStore.state&&{minHeight:te.j9},...this.isInHomeWidget.state?{paddingRight:this.isMyTasksPage.state?8:void 0,height:this.shouldRenderCompactViewVerticalScroller.state||c?void 0:"100%"}:{},...this.isInFrameWhenSidePeekOpen.state&&"timeline"!==e&&!this.isInHomeWidget.state?{position:"sticky",left:0,paddingLeft:void 0===this.collectionContextStore.frozoneStore.state.frozenIndex?0:o,width:(0,na.$3)(this.environment)}:{},..."page"===e?{zIndex:M.y}:{}}}getPaddingBottom(e){return this.props.isFullScreen?"timeline"===e?96:fg:"timeline"===e||"gallery"===e?0:wt.Z.state}getHeaderWrapStyle(){const{hideHeader:e}=this.props,t=this.leftRightPadding.state,o=(0,na.$3)(this.environment),r=(0,le._5)(this.props.store)||this.isFullScreen()?o:Math.min(Ya.zL,o),i=this.isInFrameWhenSidePeekOpen.state&&!Ho.default.isSidePeekOpening.state;return{minHeight:40,paddingLeft:null==t?void 0:t.paddingLeft,paddingRight:i?0:null==t?void 0:t.paddingRight,flexShrink:0,...(this.isFullScreen()||i)&&{position:"sticky",zIndex:86,left:0,width:i&&t?r-(t.paddingLeft/2??0):void 0},...this.props.store.isLocked()&&{cursor:"default"},...this.leftRightMargin.state,...e?{opacity:0,height:0,minHeight:void 0,pointerEvents:"none"}:{}}}getHeaderStyle(){const{collectionContextStore:e}=this,t=this.getCurrentViewType(),o=e.viewIsFlushToTopbar();return{display:"flex",alignItems:"center",height:40,boxShadow:("timeline"===t||"table"===t)&&o||this.isCompactView.state?void 0:`inset 0 -1px 0 ${this.theme.tableDividerColor}`,...this.getHeaderPositioningStyle()}}getHeaderPositioningStyle(){const e=this.leftRightPadding.state;return{left:null==e?void 0:e.paddingLeft,width:"100%"}}getSearchInputStyle(){return{fontSize:14,lineHeight:1,paddingRight:4,color:this.theme.regularTextColor,marginBottom:1}}getTopbarActionButtonStyle(e){return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:e?this.theme.blueColor:this.theme.mediumTextColor,fontWeight:R.Z.fontWeight.regular,lineHeight:1,borderRadius:4}}getTopbarIconButtonStyle(){return{display:"flex",alignItems:"center",fontSize:14,padding:6,...this.isInHomeWidget.state?{height:24,width:24,color:this.theme.lightTextColor,fill:this.theme.lightIconColor}:{height:28,width:28,color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor},fontWeight:R.Z.fontWeight.regular,lineHeight:1,borderRadius:4}}shouldShowProjManagementTooltipTour(){return this.canShowPmIntroTooltipStore.state}projManagementTooltipTourAssignToSomeone(){const e=Lo.default.state.currentUserSettingsStore,t=Lo.default.state.currentSpaceStore;e&&t&&Y.uR({environment:this.environment,requiredCurrPhase:"create_a_task",nextPhase:"assign_to_someone",currentUserSettingsStore:e,currentSpaceStore:t})}trackRenderTime(e){let{isFirstRender:t}=e;const o=yr.default.mark("collections.collection_view_block_render");yr.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>({...he.vS(this.collectionContextStore),is_first_render:t})})}trackSwitchViewLag(){if(!this.switchViewMetric)return;const{from:e,to:t,metric:o,sizeHintAtStart:r}=this.switchViewMetric;yr.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>{const o=he.vS(this.collectionContextStore),{view_type:i,row_count_category:n,...s}=o;return{from:e,to:t,did_trigger_fetch:this.collectionContextStore.isLoading.state,row_count_category:he.ZO(r),...s}}}),this.switchViewMetric=void 0}}xg.displayName="CollectionViewBlock",xg.contextTypes={...mr.wK,...s.w};class bg extends s.Z{componentDidCatch(e){throw P.vd("collections"),e}renderComponent(){return(0,v.jsx)(xg,{...this.props})}}const wg=xg;function kg(e){return"page"===e?"page_view":e}function _g(){window.__c={n:"CollectionViewBlockKeyboardArea"};return(0,c.VK)((()=>Yt.default.checkGate("collection_subitem_nested_operations")),[])?(0,v.jsx)(Tc,{}):null}},58493:(e,t,o)=>{o.d(t,{Z:()=>_});var r=o(67294),i=o(480),n=o(86628),s=o(24405),l=o(16184),a=o(45238),c=o(85893);const d=(0,a.I)("mobileLocked",{viewBox:"0 0 26 26",svg:(0,c.jsx)("path",{d:"M7.88672 23.417H18.1133C19.499 23.417 20.1758 22.7295 20.1758 21.2256V13.3408C20.1758 11.9873 19.6172 11.2891 18.4678 11.1709V8.46387C18.4678 4.41406 15.8145 2.45898 13 2.45898C10.1855 2.45898 7.53223 4.41406 7.53223 8.46387V11.2246C6.47949 11.3857 5.82422 12.0732 5.82422 13.3408V21.2256C5.82422 22.7295 6.50098 23.417 7.88672 23.417ZM9.26172 8.23828C9.26172 5.54199 10.9912 4.11328 13 4.11328C15.0088 4.11328 16.7383 5.54199 16.7383 8.23828V11.1602L9.26172 11.1709V8.23828Z"})}),u=(0,a.I)("mobileUnlocked",{viewBox:"0 0 32 26",svg:(0,c.jsx)("path",{d:"M7.89355 23.417H18.1094C19.4951 23.417 20.1826 22.7295 20.1826 21.2256V13.3408C20.1826 12.0303 19.6562 11.332 18.582 11.1816V8.23828C18.582 5.54199 20.3115 4.11328 22.3203 4.11328C24.3291 4.11328 26.0586 5.54199 26.0586 8.23828V10.623C26.0586 11.2783 26.4346 11.6006 26.9287 11.6006C27.4014 11.6006 27.7881 11.3105 27.7881 10.623V8.46387C27.7881 4.41406 25.1348 2.45898 22.3203 2.45898C19.5059 2.45898 16.8525 4.41406 16.8525 8.46387V11.1602L8.1084 11.1816C6.72266 11.1816 5.82031 11.8584 5.82031 13.3408V21.2256C5.82031 22.7295 6.50781 23.417 7.89355 23.417Z"})}),p=(0,a.I)("unlockedFilled",{viewBox:"0 0 16 16",svg:(0,c.jsx)("path",{d:"M2.33301 14.6338H8.94336C9.85938 14.6338 10.3105 14.1826 10.3105 13.1914V8.08496C10.3105 7.2168 9.95508 6.75195 9.24414 6.65625V4.83105C9.24414 3.22461 10.2627 2.35645 11.4863 2.35645C12.71 2.35645 13.7354 3.22461 13.7354 4.83105V6.28711C13.7354 6.76562 14.0156 7.01855 14.3848 7.01855C14.7471 7.01855 15.0273 6.7793 15.0273 6.28711V4.96094C15.0273 2.36328 13.2979 1.1123 11.4863 1.1123C9.6748 1.1123 7.94531 2.36328 7.94531 4.96094V6.64258L2.44922 6.64941C1.5332 6.64941 0.96582 7.10742 0.96582 8.08496V13.1914C0.96582 14.1826 1.41699 14.6338 2.33301 14.6338Z"})});var h=o(19889),m=o(7928),S=o(9291),g=o(36610),C=o(96802),f=o(82530),v=o(34700),y=o(92547),x=o(79797),b=o(64921),w=o(26388);const k={width:16,marginRight:4};const _=function(e){let{isMobile:t,store:o,disableTooltip:r,isInlineCollection:i,buttonStyle:s,lockStore:l}=e;window.__c={n:"PageLockTopbarIndicator"};const a=(0,n.qz)(l,y.Z);return t?(0,c.jsx)(I,{store:o,lockStore:a}):(0,c.jsx)(j,{store:o,disableTooltip:r,isMobile:t,isInlineCollection:i,buttonStyle:s,lockStore:a})};function T(e,t,o){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginRight:2,height:24,marginTop:e?1:0,marginLeft:e?0:-5,...t&&{marginLeft:e?8:12,marginRight:0},...o}}function V(e,t,o,r,i){return{...T(e,r,i),...(0,v.X)({noDrag:t.device.isElectronMac}),color:o.lightTextColor,fill:o.lightIconColor}}function O(e,t,o,r,i){return{...T(e,r,i),...(0,v.X)({noDrag:t.device.isElectronMac}),paddingLeft:5,border:`1px solid ${o.blueColor}`,color:o.blueColor,fill:o.blueColor}}function P(e){let{store:t}=e;window.__c={n:"TooltipComponent"};const o=(0,s.Fg)(),r=(0,n.VK)((()=>t.getFormat().block_locked_by),[t]),i=(0,S.useIntl)(),l=(0,n.VK)((()=>r&&(0,m.Nz)(i,x.t1.createChildStore(t,{table:h.KJ,id:r}).getModel())),[r,i,t]);return r?(0,c.jsx)("div",{children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,c.jsx)("b",{children:l}),br:(0,c.jsx)("br",{}),prompttext:e=>(0,c.jsx)("span",{style:{color:o.mediumInvertedTextColor},children:e})}})}):null}function R(e,t,o){f.createAndCommit({userAction:"PageLockTopbarIndicator.handleLockClick",environment:e,perform:o=>{C.Wq({environment:e,store:t,isLocked:!1,transaction:o})}}),o.setState({...o.state,justUnlocked:!0});const r=t.getType();if(r){var i;let o;t.isCollectionView()&&(o=t.getCollectionViewCollectionStore()),g.UJ(e,{from:"topbar",block_type:r,locked:!1,collection_id:null===(i=o)||void 0===i?void 0:i.id})}}function M(e,t,o){f.createAndCommit({userAction:"PageLockTopbarIndicator.handleUnlockClick",environment:e,perform:o=>{C.Wq({environment:e,store:t,isLocked:!0,transaction:o})}}),o.setState({...o.state,justUnlocked:!1});const r=t.getType();if(r){var i;let o;t.isCollectionView()&&(o=t.getCollectionViewCollectionStore()),g.UJ(e,{from:"topbar",block_type:r,locked:!0,collection_id:null===(i=o)||void 0===i?void 0:i.id})}}function j(e){let{store:t,disableTooltip:o,isMobile:a,isInlineCollection:d,buttonStyle:u,lockStore:h}=e;window.__c={n:"DesktopComponent"};const m=(0,s.Fg)(),g=(0,i.O7)(),C=(0,r.useCallback)((()=>M(g,t,h)),[g,t,h]),f=(0,r.useCallback)((()=>R(g,t,h)),[g,t,h]),v=(0,n.VK)((()=>t.isLocked()),[t]),y=(0,n.VK)((()=>h.state.justUnlocked),[h]);return v?(0,c.jsx)(w.ZP,{renderTooltip:()=>(0,c.jsx)(P,{store:t}),disableTooltip:o,render:e=>(0,c.jsxs)(b.Z,{style:V(a,g,m,d,u),onClick:f,...e,children:[(0,l.Q)(k),(0,c.jsx)("div",{style:{lineHeight:1},children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]})}):y?(0,c.jsxs)(b.Z,{style:O(a,g,m,d,u),onClick:C,hoveredStyle:{background:m.outlineBlueButtonHoveredBackground},pressedStyle:{background:m.outlineBlueButtonPressedBackground},children:[p(k),(0,c.jsx)("div",{style:{lineHeight:1},children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]}):null}function I(e){let{store:t,lockStore:o}=e;window.__c={n:"MobileComponent"};const l=(0,s.Fg)(),a=(0,i.O7)(),p=(0,r.useCallback)((()=>M(a,t,o)),[a,t,o]),h=(0,r.useCallback)((()=>R(a,t,o)),[a,t,o]),m=(0,n.VK)((()=>t.isLocked()),[t]),{WindowSizeStore:g}=a,C=(0,n.VK)((()=>g.getSafePaddingLeftCSS(10)),[g]),f=(0,n.VK)((()=>g.getSafePaddingRightCSS(14)),[g]),v=(0,n.VK)((()=>o.state.justUnlocked),[o]);return m?(0,c.jsxs)(b.Z,{onClick:h,mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:C,paddingRight:f},children:[d({width:20,marginRight:6}),(0,c.jsx)("div",{children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]}):v?(0,c.jsxs)(b.Z,{onClick:p,mobileFeedback:!0,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:C,paddingRight:f,color:l.blueColor,fill:l.blueColor},children:[u({height:26,width:32,marginRight:6}),(0,c.jsx)("div",{children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):null}},71424:(e,t,o)=>{o.d(t,{EZ:()=>i,FD:()=>n,G5:()=>r,rK:()=>s});const r=220,i=24,n=-7,s=-3},34700:(e,t,o)=>{function r(e){return"drag"in e&&e.drag?{WebkitAppRegion:"drag"}:"noDrag"in e&&e.noDrag?{WebkitAppRegion:"no-drag"}:{}}o.d(t,{X:()=>r})},34232:(e,t,o)=>{o.d(t,{Z:()=>i});var r=o(67294);function i(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[n,s]=(0,r.useState)(i),l=(0,r.useRef)(null),a=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{null!==a.current&&window.clearTimeout(a.current),null!==l.current&&window.clearTimeout(l.current),a.current=null,l.current=null,e?0===t?s(!0):l.current=window.setTimeout((()=>{l.current=null,s(!0)}),t):0===o?s(!1):a.current=window.setTimeout((()=>{a.current=null,s(!1)}),o)}),[e,t,o]),n}},35599:(e,t,o)=>{o.d(t,{Z:()=>a});var r=o(67294),i=o(24405),n=o(86432),s=o(63143),l=o(77907);function a(e){window.__c={n:"CalendarDateIcon"};const t=(0,l.useDependency)(l.deps.calendarDateIcons),o=function(){const[e,t]=(0,r.useState)(new Date),o=(0,r.useRef)();return(0,r.useEffect)((()=>{const r=()=>{const o=new Date;o.getDate()!==e.getDate()&&t(o)},i=new Date,n=new Date(i);n.setHours(i.getHours()+1),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);const l=n.getTime()-i.getTime(),a=setTimeout((()=>{r(),o.current=window.setInterval(r,s.U6)}),l);return()=>{clearTimeout(a),clearInterval(o.current)}}),[e]),e}(),a=e.dateNumber??o.getDate(),c=(0,i.yK)((t=>({icon:{width:16,height:16,color:t.mediumIconColor,...e.style}})),[e.style]),d=(0,r.useCallback)((e=>{if(e<1||e>31)return(0,n.s)(c.icon);if("resolved"!==t.status)return(0,n.s)(c.icon);const o=`calendarDate${e<10?`0${e}`:`${e}`}Icon`;return(0,t.value[o])(c.icon)}),[c,t]);return d(a)}},92547:(e,t,o)=>{o.d(t,{Z:()=>n});var r=o(49085);class i extends r.default{getInitialState(){return{justUnlocked:!1}}}const n=i},64788:(e,t,o)=>{o.d(t,{P:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("addPageCover",{viewBox:"0 0 14 14",svg:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 0a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm0 12h10L8.5 5.5l-2 4-2-1.5L2 12z"})})},86432:(e,t,o)=>{o.d(t,{s:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("calendarDate31",{viewBox:"0 0 20 20",svg:(0,i.jsxs)("g",{children:[(0,i.jsx)("path",{d:"M7.565 10.164c0-.753-.429-1.246-1.104-1.246-.649 0-.87.467-.87 1.207v.13c-.077.013-.142.026-.22.026-.468 0-.805-.39-.805-1.052 0-1.012.935-1.908 2.713-1.908 1.584 0 2.596.805 2.596 2.116 0 .987-.843 1.636-1.674 1.804 1.558.17 2.207 1.052 2.207 2.13 0 1.843-1.39 2.803-3.531 2.803h-.052c-1.61 0-2.74-.662-2.74-1.687 0-.584.442-1.052 1.104-1.052.052 0 .104.013.156.013.13 1.052.857 1.48 1.584 1.48.7 0 1.194-.428 1.194-1.077v-.026c0-1.013-.87-1.117-2.181-1.246l-.208-1.22c1.22-.144 1.83-.494 1.83-1.195zm4.95 4.66v-6.05c-1.298.286-1.583-.285-1.44-.856.779-.13 2.804-.597 3.57-.818v7.776l1.415.286c0 .506-.299.805-.831.805-.442 0-1.467-.026-1.96-.026-.766 0-2.168.026-2.168.026a.851.851 0 01-.052-.299c0-.246.104-.493.441-.584l1.026-.26z"}),(0,i.jsx)("path",{d:"M16.664 0H3.334A3.333 3.333 0 000 3.334v13.332A3.333 3.333 0 003.334 20h13.332A3.333 3.333 0 0020 16.666V3.334A3.333 3.333 0 0016.666 0h-.002zm-.525 17.932H3.861a1.797 1.797 0 01-1.797-1.797V5.485h15.872v10.652c0 .993-.804 1.797-1.797 1.797v-.002z"})]})})},2585:(e,t,o)=>{o.d(t,{f:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},27961:(e,t,o)=>{o.d(t,{z:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionDescriptionSmall",{viewBox:"0 0 14 14",svg:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 4.667C6.69049 4.667 6.39366 4.54405 6.17481 4.32519C5.95595 4.10634 5.833 3.80951 5.833 3.5C5.833 3.19049 5.95595 2.89366 6.17481 2.67481C6.39366 2.45595 6.69049 2.333 7 2.333C7.30951 2.333 7.60634 2.45595 7.82519 2.67481C8.04405 2.89366 8.167 3.19049 8.167 3.5C8.167 3.80951 8.04405 4.10634 7.82519 4.32519C7.60634 4.54405 7.30951 4.667 7 4.667V4.667ZM8 11C8 11.2652 7.89464 11.5196 7.70711 11.7071C7.51957 11.8946 7.26522 12 7 12C6.73478 12 6.48043 11.8946 6.29289 11.7071C6.10536 11.5196 6 11.2652 6 11V7C6 6.73478 6.10536 6.48043 6.29289 6.29289C6.48043 6.10536 6.73478 6 7 6C7.26522 6 7.51957 6.10536 7.70711 6.29289C7.89464 6.48043 8 6.73478 8 7V11ZM7 0C5.14348 0 3.36301 0.737498 2.05025 2.05025C0.737498 3.36301 0 5.14348 0 7C0 8.85652 0.737498 10.637 2.05025 11.9497C3.36301 13.2625 5.14348 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.14348 13.2625 3.36301 11.9497 2.05025C10.637 0.737498 8.85652 0 7 0V0Z"})})},45453:(e,t,o)=>{o.d(t,{p:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionHide",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M12.6172 12.9492C12.8047 13.1309 13.0918 13.1426 13.2793 12.9492C13.4727 12.75 13.4609 12.4688 13.2793 12.2871L3.35352 2.37305C3.17773 2.19141 2.87305 2.18555 2.69141 2.37305C2.51562 2.54883 2.51562 2.85352 2.69141 3.0293L12.6172 12.9492ZM8 2.70703C6.98047 2.70703 6.05469 2.88281 5.19336 3.16406L6.13086 4.10156C6.72266 3.93164 7.33789 3.83203 8 3.83203C11.7441 3.83203 14.7207 7.08984 14.7207 7.77539C14.7207 8.23828 13.7715 9.43359 12.2656 10.377L13.1328 11.25C14.9727 10.043 16.0449 8.4668 16.0449 7.77539C16.0449 6.57422 12.8047 2.70703 8 2.70703ZM8 12.8496C9.08398 12.8496 10.0742 12.6621 10.9707 12.3516L10.0391 11.4199C9.40039 11.6074 8.72656 11.7246 8 11.7246C4.25586 11.7246 1.2793 8.5957 1.2793 7.77539C1.2793 7.38281 2.27539 6.11133 3.88086 5.12695L2.99609 4.24219C1.08008 5.46094 -0.0507812 7.07227 -0.0507812 7.77539C-0.0507812 8.97656 3.25977 12.8496 8 12.8496ZM10.9238 8.90625C11.0762 8.56055 11.1641 8.17383 11.1641 7.77539C11.1641 6.01172 9.75781 4.62305 8 4.62305C7.5957 4.62305 7.21484 4.69922 6.86328 4.8457L10.9238 8.90625ZM8 10.9336C8.45703 10.9336 8.88477 10.8281 9.26562 10.6465L5.12305 6.49805C4.93555 6.88477 4.83008 7.3125 4.83008 7.78125C4.83594 9.49805 6.23633 10.9336 8 10.9336Z"})})},9056:(e,t,o)=>{o.d(t,{g:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionShow",{viewBox:"0 0 30 30",svg:(0,i.jsx)("path",{d:"M15,4 C8.641,4 0,10.469 0,15 C0,19.531 8.641,26 15,26 C21.359,26 30,19.531 30,15 C30,10.469 21.359,4 15,4 Z M15,24 C9.149,24 2,17.975 2,15 C2,12.025 9.149,6 15,6 C20.851,6 28,12.025 28,15 C28,17.975 20.851,24 15,24 Z M15,8 C11.134,8 8,11.134 8,15 C8,18.866 11.134,22 15,22 C18.866,22 22,18.866 22,15 C22,11.134 18.866,8 15,8 Z M15,20 C12.238,20 10,17.761 10,15 C10,12.239 12.238,10 15,10 C17.762,10 20,12.239 20,15 C20,17.761 17.762,20 15,20 Z"})})},31505:(e,t,o)=>{o.d(t,{Y:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",svg:(0,i.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})})},39301:(e,t,o)=>{o.d(t,{n:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",svg:(0,i.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})})},97439:(e,t,o)=>{o.d(t,{D:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("doubleChevronLeft",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M7.07031 13.8887C7.2207 14.0391 7.40527 14.1211 7.62402 14.1211C8.06836 14.1211 8.41699 13.7725 8.41699 13.3281C8.41699 13.1094 8.32812 12.9043 8.17773 12.7539L3.37207 8.05762L8.17773 3.375C8.32812 3.21777 8.41699 3.0127 8.41699 2.80078C8.41699 2.35645 8.06836 2.00781 7.62402 2.00781C7.40527 2.00781 7.2207 2.08984 7.07031 2.24023L1.73828 7.44922C1.56055 7.62012 1.46484 7.8252 1.46484 8.06445C1.46484 8.29688 1.55371 8.49512 1.73828 8.67969L7.07031 13.8887ZM13.1748 13.8887C13.3252 14.0391 13.5098 14.1211 13.7354 14.1211C14.1797 14.1211 14.5283 13.7725 14.5283 13.3281C14.5283 13.1094 14.4395 12.9043 14.2891 12.7539L9.4834 8.05762L14.2891 3.375C14.4395 3.21777 14.5283 3.0127 14.5283 2.80078C14.5283 2.35645 14.1797 2.00781 13.7354 2.00781C13.5098 2.00781 13.3252 2.08984 13.1748 2.24023L7.84961 7.44922C7.66504 7.62012 7.57617 7.8252 7.56934 8.06445C7.56934 8.29688 7.66504 8.49512 7.84961 8.67969L13.1748 13.8887Z"})})},7525:(e,t,o)=>{o.d(t,{t:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("doubleChevronRight",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M2.25781 14.1211C2.47656 14.1211 2.66797 14.0391 2.81836 13.8887L8.14355 8.67969C8.32812 8.49512 8.41699 8.29688 8.41699 8.06445C8.41699 7.8252 8.32812 7.62012 8.14355 7.44922L2.81836 2.24023C2.66797 2.08984 2.4834 2.00781 2.25781 2.00781C1.81348 2.00781 1.46484 2.35645 1.46484 2.80078C1.46484 3.0127 1.55371 3.21777 1.7041 3.375L6.50977 8.05762L1.7041 12.7539C1.55371 12.9043 1.46484 13.1094 1.46484 13.3281C1.46484 13.7725 1.81348 14.1211 2.25781 14.1211ZM8.36914 14.1211C8.58789 14.1211 8.77246 14.0391 8.92285 13.8887L14.2549 8.67969C14.4395 8.49512 14.5283 8.29688 14.5283 8.06445C14.5283 7.8252 14.4326 7.62012 14.2549 7.44922L8.92285 2.24023C8.77246 2.08984 8.58789 2.00781 8.36914 2.00781C7.9248 2.00781 7.56934 2.35645 7.56934 2.80078C7.56934 3.0127 7.66504 3.21777 7.81543 3.375L12.6211 8.05762L7.81543 12.7539C7.66504 12.9043 7.56934 13.1094 7.56934 13.3281C7.56934 13.7725 7.9248 14.1211 8.36914 14.1211Z"})})},4635:(e,t,o)=>{o.d(t,{W:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("options",{viewBox:"0 0 17 15",svg:(0,i.jsx)("path",{d:"M11.2871 4.48438C12.1309 4.48438 12.8574 3.95312 13.1621 3.21875H15.7324C16.123 3.21875 16.4512 2.875 16.4512 2.46094C16.4512 2.04688 16.123 1.71094 15.7324 1.71094H13.1621C12.8652 0.96875 12.1387 0.4375 11.2871 0.4375C10.4355 0.4375 9.70898 0.96875 9.41211 1.71094H1.04492C0.630859 1.71094 0.302734 2.04688 0.302734 2.46094C0.302734 2.875 0.630859 3.21875 1.04492 3.21875H9.41211C9.7168 3.95312 10.4434 4.48438 11.2871 4.48438ZM11.2871 3.42188C10.748 3.42188 10.3262 2.99219 10.3262 2.46094C10.3262 1.91406 10.748 1.49219 11.2871 1.49219C11.834 1.49219 12.248 1.91406 12.248 2.46094C12.248 2.99219 11.834 3.42188 11.2871 3.42188ZM1.02148 6.58594C0.630859 6.58594 0.302734 6.92188 0.302734 7.33594C0.302734 7.74219 0.630859 8.08594 1.02148 8.08594H3.67773C3.98242 8.83594 4.70898 9.35938 5.56055 9.35938C6.4043 9.35938 7.13086 8.83594 7.43555 8.08594H15.709C16.123 8.08594 16.4512 7.75 16.4512 7.33594C16.4512 6.92188 16.123 6.58594 15.709 6.58594H7.43555C7.13086 5.84375 6.4043 5.32031 5.56055 5.32031C4.70898 5.32031 3.98242 5.84375 3.67773 6.58594H1.02148ZM5.56055 8.30469C5.02148 8.30469 4.5918 7.875 4.5918 7.33594C4.5918 6.78906 5.02148 6.375 5.56055 6.375C6.09961 6.375 6.52148 6.78906 6.52148 7.33594C6.52148 7.875 6.09961 8.30469 5.56055 8.30469ZM11.2871 14.2344C12.1387 14.2344 12.8652 13.7031 13.1621 12.9609H15.7324C16.123 12.9609 16.4512 12.625 16.4512 12.2109C16.4512 11.7891 16.123 11.4609 15.7324 11.4609H13.1621C12.8652 10.7188 12.1387 10.1875 11.2871 10.1875C10.4434 10.1875 9.70898 10.7188 9.41211 11.4609H1.04492C0.630859 11.4609 0.302734 11.7969 0.302734 12.2109C0.302734 12.6172 0.630859 12.9609 1.04492 12.9609H9.41211C9.70898 13.7031 10.4355 14.2344 11.2871 14.2344ZM11.2871 13.1719C10.748 13.1719 10.3262 12.7422 10.3262 12.2109C10.3262 11.6641 10.748 11.25 11.2871 11.25C11.834 11.25 12.248 11.6641 12.248 12.2109C12.248 12.7422 11.834 13.1719 11.2871 13.1719Z"})})},23903:(e,t,o)=>{o.d(t,{P:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("pin",{viewBox:"0 0 13 19",svg:(0,i.jsx)("path",{d:"M1.25 12.875h4.227v3.648c0 1.196.5 2.188.695 2.188.187 0 .687-.992.687-2.188v-3.648h4.227c.703 0 1.148-.438 1.148-1.102 0-1.648-1.32-3.304-3.359-4.109L8.617 4c.992-.648 1.93-1.383 2.328-1.914.211-.266.305-.531.305-.758 0-.476-.367-.828-.914-.828H2.008c-.555 0-.914.352-.914.828 0 .227.093.492.297.758.398.531 1.343 1.266 2.328 1.914L3.46 7.664C1.42 8.47.1 10.125.1 11.774c0 .664.446 1.101 1.149 1.101zm4.922-5.719c-.5 0-.984.047-1.438.14l.235-3.874c.008-.11-.008-.149-.086-.188-1.172-.601-2.078-1.312-2.14-1.468-.063-.102 0-.164.085-.164h6.68c.086 0 .148.062.086.164-.063.156-.969.867-2.14 1.468-.071.04-.095.079-.079.188l.234 3.875a7.177 7.177 0 00-1.437-.14zm-4.61 4.54c-.18 0-.257-.102-.226-.313.172-1.406 1.969-3.086 4.836-3.086 2.86 0 4.656 1.68 4.828 3.086.031.21-.047.312-.227.312h-9.21z"})})},79310:(e,t,o)=>{o.d(t,{A:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("pinStrikethrough",{viewBox:"0 0 15 19",svg:(0,i.jsx)("path",{d:"M3.094 1.328c0 .227.094.492.297.758.398.531 1.343 1.266 2.328 1.914l-.055.86 1.149 1.156.156-2.594c.008-.11-.008-.149-.086-.188-1.172-.601-2.078-1.312-2.14-1.468-.063-.102.007-.164.085-.164h6.68c.086 0 .148.062.086.164-.063.156-.961.867-2.14 1.468-.071.04-.087.079-.079.188l.234 3.875a7.12 7.12 0 00-1.437-.14h-.203l1.203 1.226c2.164.219 3.758 1.984 3.758 3.234 0 .04-.008.078-.008.117l.844.97c.257-.157.468-.477.468-.93 0-1.649-1.32-3.313-3.359-4.11L10.617 4c.992-.648 1.93-1.383 2.336-1.914.203-.266.297-.531.297-.758 0-.476-.367-.828-.914-.828H4.008c-.555 0-.914.352-.914.828zM.367 2.656l14.125 14.11a.603.603 0 00.852 0 .597.597 0 000-.852L1.227 1.804a.606.606 0 00-.86 0 .618.618 0 000 .852zm1.735 9.117c0 .665.445 1.102 1.148 1.102h4.234v3.648c0 1.196.493 2.188.688 2.188.195 0 .687-.992.687-2.188V12.97h.446L8.03 11.695H3.562c-.171 0-.257-.101-.226-.312.094-.875.828-1.805 1.984-2.399l-.82-.82c-1.477.867-2.398 2.234-2.398 3.61z"})})},75071:(e,t,o)=>{o.d(t,{f:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("plusThick",{viewBox:"0 0 14 14",svg:(0,i.jsx)("path",{d:"M2 7.16357C2 7.59692 2.36011 7.95093 2.78735 7.95093H6.37622V11.5398C6.37622 11.9731 6.73022 12.3271 7.16357 12.3271C7.59692 12.3271 7.95093 11.9731 7.95093 11.5398V7.95093H11.5398C11.9731 7.95093 12.3271 7.59692 12.3271 7.16357C12.3271 6.73022 11.9731 6.37622 11.5398 6.37622H7.95093V2.78735C7.95093 2.36011 7.59692 2 7.16357 2C6.73022 2 6.37622 2.36011 6.37622 2.78735V6.37622H2.78735C2.36011 6.37622 2 6.73022 2 7.16357Z"})})}}]);