"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1165],{79474:(e,t,o)=>{o.d(t,{r:()=>i});var r=o(43604);async function i(e){return new Promise((t=>{r.Z.setState({open:!0,onClose:()=>{r.Z.setState({open:!1}),t(!1)},onConfirm:()=>{r.Z.setState({open:!1}),t(!0)},...e})}))}},44866:(e,t,o)=>{o.r(t),o.d(t,{autofillPropertyForBlocks:()=>$,autofillPropertyForCollection:()=>J,fillAllPagesMessages:()=>V,getDefaultAiInference:()=>te,getPropertyCompletionForBlock:()=>ee,saveOrRemovePropertyAiInference:()=>X,submitFeedbackForAiAutofill:()=>Q,triggerAiAutofillUpsell:()=>K});o(57658);var r=o(67294),i=o(26263),n=o(99036),s=o(80951),a=o(74229),l=o(482),p=o(4615),c=o(3791),d=o(97880),u=o(9291),h=o(10910),m=o(8406),g=o(54642),f=o(893),y=o(79474),S=o(47307),v=o(96802),M=o(9953),x=o(64964),C=o(82530),_=o(75330),P=o(86628),b=o(98519),I=o(52423),T=o(79576),k=o(73420),j=o(68785),w=o(6854),A=o(85893);const O=function(e){let{environment:t,inferenceIds:o,aiInference:i}=e;window.__c={n:"AiAutofillProgressLabel"};const n=(0,P.VK)((()=>{const{state:e}=T.W;return"uninitialized"===e.type?null:{numBlocksToAutofill:e.numBlocksToAutofill,numBlocksAutofilled:e.numBlocksAutofilled,propertySchema:e.propertySchema,collectionId:e.collectionId,sessionId:e.sessionId,haveAllBlocksCompletedAutofill:e.haveAllBlocksCompletedAutofill}}),[]),s=(0,r.useCallback)((()=>{n&&(o.forEach((e=>{h.qG(t,{ai_inference_type:i.type,type:"undo_from_snackbar",inference_id:e,collection_id:n.collectionId,session_id:n.sessionId})})),I.Yw(t,!0),x.rN(),T.W.setState({type:"filling",...n,didInterruptStreaming:!0}))}),[n,t,i,o]);if(!n)return null;const{numBlocksToAutofill:a,numBlocksAutofilled:l,propertySchema:{name:p}}=n;return l===a?(0,A.jsxs)(k.X2,{gap:4,alignItems:"center",children:[(0,b.k)({width:16}),(0,A.jsx)(u.FormattedMessage,{defaultMessage:'AI updated "{propertyName}" on {numPages, plural, one {1 page} other {# pages}}',id:"snackbar.aiAutofill.autofillInProgress",values:{propertyName:p,numPages:a}}),(0,A.jsx)(w.Pn,{onClick:s,children:(0,A.jsx)(u.FormattedMessage,{defaultMessage:"Undo",id:"snackbar.aiAutofill.undo"})}),(0,A.jsx)(w.Pn,{onClick:()=>{x.rN()},children:(0,A.jsx)(u.FormattedMessage,{defaultMessage:"Close",id:"snackbar.aiAutofill.close"})})]}):(0,A.jsxs)(k.X2,{gap:4,alignItems:"center",children:[(0,A.jsx)(j.Z,{}),0===l?(0,A.jsx)(u.FormattedMessage,{defaultMessage:'AI updating "{propertyName}" on {numPages, plural, one {1 page} other {# pages}}',id:"snackbar.aiAutofill.autofillStarting",values:{propertyName:p,numPages:a}}):(0,A.jsx)(u.FormattedMessage,{defaultMessage:'AI updated "{propertyName}" on {numFilledPages} of {numTotalPages} pages',id:"snackbar.aiAutofill.completedAutofill",values:{propertyName:p,numFilledPages:l,numTotalPages:a}}),(0,A.jsx)(w.Pn,{onClick:s,children:(0,A.jsx)(u.FormattedMessage,{defaultMessage:"Stop & undo",id:"snackbar.aiAutofill.undoAndStop"})})]})};var Z=o(33929),F=o(77907),R=o(80444),N=o(79797),D=o(1310),E=o(44041),B=o(35057),L=o(88280),Y=o(84654);const V=(0,u.defineMessages)({fillAllPagesTooltip:{defaultMessage:"{hasNames, select, true {Autofill {propertyName} for all pages in {collectionName}} other {Autofill this property for all pages in the database}}",id:"aiAutofill.fillAllPages.buttonTooltip"},fillAllPagesAddOnMessage:{defaultMessage:"Only with Notion AI add-on",id:"aiAutofill.fillAllPages.onlyWithAiAddOnMessageInTooltip"}});function U(e){let{environment:t,propertyId:o,propertySchema:r,storesWithCompletions:i,blockIdToInferenceId:a,useTemporaryStore:l,markdownLinkifyIt:p,tinyMceMicrosoftWordPasteFilter:c,doneStreaming:u,aiInferenceOverride:h}=e;C.createAndCommit({userAction:"BlockPropertyValue.handleActionButtonClick.aiAutofill",environment:t,canUndo:!Boolean(l),undoCheckpoint:!0,perform:e=>{var t;for(const{store:m,temporaryStore:g,completion:y}of i){const i=l?g:m;let S;switch(r.type){case"text":S=f.of({text:y.trim(),stripText:!1,markdownLinkifyIt:p,tinyMceMicrosoftWordPasteFilter:c});break;case"multi_select":case"select":const i=l?null===(t=m.getAssociatedCollectionStore())||void 0===t?void 0:t.clone(g.inMemoryRecordCache):m.getAssociatedCollectionStore(),a=h??r.select_ai_inference;let v=y.trim().split(",").map((e=>e.trim()));if(u||(v=v.slice(0,-1)),i&&null!=a&&a.add_options){const t=(0,n.RR)({newTokenValues:v.length>0&&"select"===r.type?[[v[0]]]:[v],property:o,propertySchema:r,collectionId:i.id});if(t)for(const o of t)C.applyOperation({store:i,operation:o,transaction:e})}null!=a&&a.add_options||(v=v.filter((e=>{var t;return null===(t=r.options)||void 0===t?void 0:t.find((t=>t.value===e))}))),S=(0,s.zq)(v);break;default:(0,d.t1)(r)}M.sO({store:i.getPropertyStore(o),value:S,transaction:e});const x=i.getFormat().ai_property_inference_map??{},_=a[m.id]??"";v.FH({stores:[i],update:{ai_property_inference_map:{...x,[o]:{inference_id:_,created_time:Date.now()}}},transaction:e})}}})}const H=(0,u.defineMessages)({FAILED_TO_AUTOFILL:{defaultMessage:"Something went wrong. Please try again later",id:"propertyCompletionActions.error.unableToAutofill"},INVALID_PROPERTY_FOR_AUTOFILL:{defaultMessage:"Invalid property configuration for AI autofill",id:"propertyCompletionActions.error.invalidPropertyForAutofill"},NO_BLOCKS_TO_AUTOFILL:{defaultMessage:"Nothing to update with AI",id:"propertyCompletionActions.error.noBlocksToAutofill"}}),W=(0,u.defineMessages)({featureUnavailable:{id:"completionActions.featureNotEnabledError",defaultMessage:"This feature is not currently enabled"}});function q(e){let{autofillPropertyResult:t}=e;const o=Z.default.formatMessage(H[t]);x.rN(),S.deprecatedShowErrorMessage(o)}const G={ai_limit_property_autofill:(0,A.jsx)(u.FormattedMessage,{defaultMessage:"This workspace has used all of its free AI responses. Contact your workspace owner to add Notion AI.",id:"aiAutofill.outOfAiUpsellDialogMessage"}),ai_autofill_on_page_edit:(0,A.jsx)(u.FormattedMessage,{defaultMessage:"Auto-update requires the Notion AI Add-on. Contact your workspace owner to add Notion AI.",id:"aiAutofill.autoUpdateOnPageEditUpsellDialogMessage"}),ai_autofill_fill_all_pages:(0,A.jsx)(u.FormattedMessage,{defaultMessage:"Updating all pages requires the Notion AI Add-on. Contact your workspace owner to add Notion AI.",id:"aiAutofill.fillAllPagesUpsellDialogMessage"}),ai_autofill_bulk_fill:(0,A.jsx)(u.FormattedMessage,{defaultMessage:"Filling more pages at once requires the Notion AI Add-on. Contact your workspace owner to add Notion AI.",id:"aiAutofill.bulkFillUpsellDialogMessage"})};function K(e){var t;let{environment:o,from:r}=e;null!==(t=R.default.state.currentSpaceStore)&&void 0!==t&&t.canAdmin()||S.deprecatedShowErrorMessage(G[r]),E.y(o,{from:r,for:(0,B.zt)(),addOnFeature:"ai"})}function z(e){let{errorCode:t,environment:o}=e;return 405===t?x.oV({label:Z.default.formatMessage(W.featureUnavailable)}):(402===t&&(x.rN(),K({environment:o,from:"ai_limit_property_autofill"})),Y.showCompletionErrorWithCode(t))}async function $(e){var t;let{environment:o,stores:r,property:s,propertySchema:l,userEventForAnalytics:c,sessionIdForAnalytics:u,collectionContextStore:f,from:y,isBulkAction:S,aiInferenceOverride:v}=e;const M=u||(0,p.ZP)(),C=s,_=r.map((e=>({spaceId:e.getSpaceId(),...e.pointer,propertyId:C,inferenceId:(0,p.ZP)()}))),P=r[0].getAssociatedCollectionId()??(null===(t=r[0].getCollectionViewCollectionStore())||void 0===t?void 0:t.id),b=new i.Z({name:"propertyCompletionActions.autofillPropertyForBlocks"});if(T.W.setIsWriting({stores:r,propertySchema:l,sessionIdForAnalytics:u}),"uninitialized"!==T.W.state.type&&(0,n.qQ)(l)&&P){x.oV({label:(0,A.jsx)(O,{environment:o,inferenceIds:_.map((e=>e.inferenceId)),aiInference:(0,n.q3)(l)}),durationMs:D.JY});try{var I;if(o.defaultRecordCache.inMemoryRecordCache.addCacheOverride(b),!(0,d.Of)(_))return q({autofillPropertyResult:"NO_BLOCKS_TO_AUTOFILL"});const e=v||(0,n.q3)(l);if(!e)return q({autofillPropertyResult:"INVALID_PROPERTY_FOR_AUTOFILL"});_.forEach((t=>{h.qG(o,{type:c,inference_id:t.inferenceId,ai_inference_type:e.type,collection_id:P,session_id:M})})),null!==(I=R.default.state.currentSpaceStore)&&void 0!==I&&I.id&&g.publishAiSession(o,{inference_type:"autofill",id:M,spaceId:R.default.state.currentSpaceStore.id,metadata:{blockPropertyPointers:_,aiInference:e,collection_id:P}});const t=await g.getCompletionForProperty(o,{blockPropertyPointers:_,aiInference:e,aiSessionId:M,model:"default"});if("success"!==t.type)return q({autofillPropertyResult:"FAILED_TO_AUTOFILL"});f&&m.rv({block_id:r[0].pointer.id,property:C,property_type:l.type,from:y,environment:o,collectionContextStore:f,isFromBulkActionsToolbar:S});const i=Object.fromEntries(r.map((e=>[e.pointer.id,{store:e,temporaryStore:e.clone(b),completion:""}]))),s=Object.fromEntries(_.map((e=>[e.id,e.inferenceId]))),p=new Set,[u,x]=await Promise.all([F.deps.markdownLinkifyIt.loader(),F.deps.tinyMceMicrosoftWordPasteFilter.loader()]);if(a.H1.is(t.data)){for await(const e of t.data){if("error"===e.type)return T.W.setState({...T.W.state,didInterruptStreaming:!0}),z({errorCode:e.errorCode,environment:o});if(T.W.state.didInterruptStreaming)return;const t=i[e.blockPropertyPointer.id],r=t.completion+e.completion;i[e.blockPropertyPointer.id]={...t,completion:r},p.add(e.blockPropertyPointer.id),U({environment:o,propertyId:C,propertySchema:l,storesWithCompletions:Object.values(i),blockIdToInferenceId:s,useTemporaryStore:!0,markdownLinkifyIt:u,tinyMceMicrosoftWordPasteFilter:x,aiInferenceOverride:v}),T.W.setState({...T.W.state,numBlocksAutofilled:p.size})}T.W.setState({...T.W.state,haveAllBlocksCompletedAutofill:!0})}o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(b),U({environment:o,propertyId:C,propertySchema:l,storesWithCompletions:Object.values(i),blockIdToInferenceId:s,useTemporaryStore:!1,markdownLinkifyIt:u,tinyMceMicrosoftWordPasteFilter:x,doneStreaming:!0,aiInferenceOverride:v})}finally{o.defaultRecordCache.inMemoryRecordCache.hasCacheOverride(b)&&o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(b)}}}function Q(e){const{environment:t,inferenceId:o,feedbackType:r,userContent:i,shareWithNotion:n}=e;h.NF(t,{type:"property_autofill",inference_id:o,feedback_type:r,timestamp:(new Date).toUTCString(),user_comment:i,share_with_notion:n})}async function J(e){var t,o;let{environment:r,collectionStore:i,propertySchema:s,property:a,sessionIdForAnalytics:d}=e;if(!(0,n.qQ)(s))return;const u=(0,n.q3)(s);if(!i||!s||!u)return;const m=(null===(t=L.subscriptionDataStoreInstance.state)||void 0===t?void 0:t.addOns)??[];if(!(0,c.de)(m))return void K({environment:r,from:"ai_autofill_fill_all_pages"});if(!(await y.r({sourceAction:"fill_all_pages",propertyName:s.name,collectionName:(null===(o=i.getName())||void 0===o?void 0:o.toString())||""})))return;h.qG(r,{type:"generate_from_fill_all_pages",inference_id:(0,p.ZP)(),ai_inference_type:u.type,collection_id:i.id,session_id:d??(0,p.ZP)()});const g=[];g.push(l.op.update({pointer:i.pointer,path:["format","update_ai_inferences_status"],args:{[a]:{type:"requested",created_time:Date.now()}}})),_.HW({environment:r,collectionStore:i,performTransaction:e=>{for(const t of g)C.applyOperation({store:(0,N.Kv)(i,t.pointer),operation:t,transaction:e})}})}function X(e){const{environment:t,propertySchema:o,collectionStore:r,property:i,draftAiInference:s}=e;let a="";switch(o.type){case"text":a="ai_inference";break;case"select":case"multi_select":a="select_ai_inference";break;default:return}const l=[];if(l.push({pointer:r.pointer,command:"set",path:["schema",i,a],args:s}),s)h._e(t,{type:"set_ai_inference",ai_inference_type:s.type,collection_id:r.id});else{const e=(0,n.q3)(o);h._e(t,{type:"remove_ai_inference",ai_inference_type:null==e?void 0:e.type,collection_id:r.id})}_.HW({environment:t,collectionStore:r,performTransaction:e=>{for(const t of l)C.applyOperation({store:(0,N.Kv)(r,t.pointer),operation:t,transaction:e})}})}async function ee(e){var t;let{environment:o,store:r,property:i,propertySchema:n,userEventForAnalytics:s,sessionIdForAnalytics:l}=e;const c=l||(0,p.ZP)(),d=i,u={spaceId:r.getSpaceId(),...r.pointer,propertyId:d,inferenceId:(0,p.ZP)()},m=r.getAssociatedCollectionId()??(null===(t=r.getCollectionViewCollectionStore())||void 0===t?void 0:t.id),f=te(n,!1);if(!f)return"";h.qG(o,{type:s,inference_id:u.inferenceId,ai_inference_type:f.type,collection_id:m,session_id:c});const y=(0,p.ZP)();g.publishAiSession(o,{inference_type:"autofill",id:y,metadata:{blockPropertyPointers:[u],aiInference:f,collection_id:m}});const S=await g.getCompletionForProperty(o,{blockPropertyPointers:[u],aiInference:f,aiSessionId:y,model:"default"});if("success"!==S.type)return"";let v="";if(a.H1.is(S.data))for await(const a of S.data)"error"!==a.type&&(v+=a.completion);return v}function te(e,t){if(!(0,n.qQ)(e))return;const o=(0,n.q3)(e);return!o&&(0,n.cu)(e)?{type:e.type,auto_update_on_edit:t,add_options:!1}:o}},30772:(e,t,o)=>{o.d(t,{l:()=>g});o(67294);var r=o(480),i=o(24405),n=o(45238),s=o(85893);const a=(0,n.I)("infoFilled",{viewBox:"0 0 16 16",svg:(0,s.jsx)("path",{d:"M7.99634 15.5659C6.96118 15.5659 5.98706 15.3682 5.07397 14.9727C4.16089 14.582 3.35522 14.0376 2.65698 13.3394C1.96362 12.6411 1.41919 11.8354 1.02368 10.9224C0.628174 10.0093 0.43042 9.03516 0.43042 8C0.43042 6.96484 0.628174 5.99072 1.02368 5.07764C1.41919 4.16455 1.96362 3.36133 2.65698 2.66797C3.35522 1.96973 4.15845 1.42285 5.06665 1.02734C5.97974 0.631836 6.95386 0.434082 7.98901 0.434082C9.02905 0.434082 10.0056 0.631836 10.9187 1.02734C11.8318 1.42285 12.6375 1.96973 13.3357 2.66797C14.0339 3.36133 14.5808 4.16455 14.9763 5.07764C15.3718 5.99072 15.5696 6.96484 15.5696 8C15.5696 9.03516 15.3718 10.0093 14.9763 10.9224C14.5808 11.8354 14.0339 12.6411 13.3357 13.3394C12.6375 14.0376 11.8318 14.582 10.9187 14.9727C10.0056 15.3682 9.03149 15.5659 7.99634 15.5659ZM6.65601 12.2114H9.7395C9.91528 12.2114 10.0618 12.1577 10.179 12.0503C10.2961 11.938 10.3547 11.7939 10.3547 11.6182C10.3547 11.4521 10.2961 11.313 10.179 11.2007C10.0618 11.0835 9.91528 11.0249 9.7395 11.0249H8.89722V7.43604C8.89722 7.20654 8.84106 7.021 8.72876 6.87939C8.61646 6.73779 8.45288 6.66699 8.23804 6.66699H6.78784C6.61694 6.66699 6.4729 6.72559 6.35571 6.84277C6.23853 6.95996 6.17993 7.09912 6.17993 7.26025C6.17993 7.43604 6.23853 7.58008 6.35571 7.69238C6.4729 7.7998 6.61694 7.85352 6.78784 7.85352H7.55688V11.0249H6.65601C6.48511 11.0249 6.33862 11.0835 6.21655 11.2007C6.09937 11.313 6.04077 11.4521 6.04077 11.6182C6.04077 11.7939 6.09937 11.938 6.21655 12.0503C6.33862 12.1577 6.48511 12.2114 6.65601 12.2114ZM7.95239 5.48779C8.24536 5.48779 8.49194 5.38525 8.69214 5.18018C8.89233 4.9751 8.99243 4.73096 8.99243 4.44775C8.99243 4.1499 8.89233 3.90088 8.69214 3.70068C8.49194 3.49561 8.24536 3.39307 7.95239 3.39307C7.66431 3.39307 7.41772 3.49561 7.21265 3.70068C7.00757 3.90088 6.90503 4.1499 6.90503 4.44775C6.90503 4.73096 7.00757 4.9751 7.21265 5.18018C7.41772 5.38525 7.66431 5.48779 7.95239 5.48779Z"})});var l=o(9291),p=o(64921),c=o(26388),d=o(43224),u=o(35948),h=o(4023);const m=(0,l.defineMessages)({addDescriptionTooltip:{id:"database.description.addDescriptionTooltip",defaultMessage:"Add description"},editDescriptionTooltip:{id:"database.description.editDescriptionTooltip",defaultMessage:"Edit description"}});function g(e){let{onClick:t,description:o,showTooltip:n,addDescriptionText:g,editDescriptionText:f}=e;window.__c={n:"CollectionDescriptionIconButton"};const{isMobile:y}=(0,r.Fy)(),[S,v]=(0,u.C)(),M=(0,l.useIntl)(),x=(0,i.yK)((e=>({button:{flexShrink:0,flexGrow:0,borderRadius:y?24:20,marginLeft:4},info:{width:y?18:16,height:y?18:16,fill:v?e.regularIconColor:e.mediumIconColor}})),[v,y]);return(0,s.jsx)(c.ZP,{renderTooltip:e=>(0,s.jsx)("div",{...e,children:null!=o&&o.length?o:g??M.formatMessage(m.addDescriptionTooltip)}),disableTooltip:!n,style:d.F6,placement:h.u.Top,render:e=>(0,s.jsx)(p.Z,{...e,ref:S,onClick:t,"aria-label":null!=o&&o.length?g:f??M.formatMessage(m.editDescriptionTooltip),style:x.button,children:a(x.info)})})}},27871:(e,t,o)=>{o.d(t,{i:()=>h,k:()=>d});var r=o(67294),i=o(480),n=o(24405),s=o(9291),a=o(68894),l=o(72495),p=o(43224),c=o(85893);const d=(0,s.defineMessages)({descriptionHeader:{id:"database.viewSettings.propertyTab.description.title",defaultMessage:"Description"},addDescription:{id:"database.viewSettings.propertyTab.description.addDescription",defaultMessage:"Add a description..."}}),u=60;function h(e){let{initialDescription:t,handleSaveDescription:o,disableAutoSection:h}=e;window.__c={n:"CollectionDescriptionSection"};const[m,g]=(0,r.useState)(t??""),f=(0,r.useRef)(m),{isMobile:y}=(0,i.Fy)(),S=(0,s.useIntl)(),v=(0,n.yK)((e=>({title:{display:"flex",alignItems:"center",gap:4,cursor:"default",color:e.mediumTextColor},infoTooltip:{width:300,whiteSpace:"normal"},menuItem:{padding:y?"8px 0":void 0},descriptionInput:{lineHeight:"20px",fontSize:y?14:13}})),[y]),M=(0,r.useCallback)((()=>o(f.current)),[o]);(0,r.useEffect)((()=>()=>M()),[M]);const x=(0,r.useMemo)((()=>(0,c.jsx)(a.ZP,{value:m,onChange:e=>{g(e.target.value),f.current=e.target.value},onBlur:M,onSubmit:M,placeholder:S.formatMessage(d.addDescription),focusInitial:!0,disabled:!1,style:v.menuItem,inputOuterStyle:v.descriptionInput,textarea:!0,textareaSubmitOnEnter:!0,maxlength:p.pT,autosize:!0,autosizeMaxHeight:u,showClearButton:!1})),[m,S,M,v.descriptionInput,v.menuItem]);return y&&!h?(0,c.jsx)(l.Z,{topBorder:!0,title:(0,c.jsx)("span",{style:v.title,children:S.formatMessage(d.descriptionHeader)}),children:x}):x}},2520:(e,t,o)=>{o.d(t,{DQ:()=>J,rw:()=>X,OF:()=>G,L6:()=>K,ZP:()=>re});o(57658);var r=o(67294),i=o(83355),n=o(8848),s=o(15095),a=o(72126),l=o(54153),p=o(9291),c=o(68425),d=o(23586),u=o(72187),h=o(24608),m=o(5385),g=o(33929),f=o(4391),y=o(29798),S=o(73657),v=o(68785),M=o(32163),x=o(43145),C=o(72495),_=o(480),P=o(86628),b=o(24405),I=o(79362),T=o(98742),k=o(61766),j=o(64921),w=o(31945),A=o(1743),O=o(3386),Z=o(26388),F=o(85893);function R(e){let{shouldOpenVariations:t,icon:o,focused:r,color:i,onClick:n,onMouseEnter:s,variations:a,hideTooltip:l,insertIcon:p}=e;window.__c={n:"IconPickerMenuItem"};const c=(0,P.qz)(void 0,k.Z);return t?(0,F.jsx)(Y,{icon:o,focused:r,color:i,onClick:n,onMouseEnter:s,variations:a,hideTooltip:l,insertIcon:p,buttonPopupStore:c}):(0,F.jsx)(B,{icon:o,focused:r,color:i,onClick:n,onMouseEnter:s,variations:a,hideTooltip:l})}const N=R;function D(e){const{device:t}=e;return t.isMobile?{width:u.mz,height:u.mz,fontSize:u.jo}:{width:u.T8,height:u.T8,fontSize:u.WB}}function E(e){return{iconButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,...D(e)},variationMenu:{display:"flex",padding:2,gap:1},iconImage:{...e.device.isMobile?{width:u.jo,height:u.jo}:{width:u.WB,height:u.WB}}}}function B(e){let{events:t,icon:o,focused:r,color:i,onClick:n,onMouseEnter:s,variations:a,hideTooltip:l}=e;window.__c={n:"SingleIconComponent"};const p=(0,b.Fg)(),c=(0,_.O7)(),d=a.tooltip?a.tooltip:o,u="dark"===p.mode?a.dark:a.light;return(0,F.jsx)(Z.ZP,{allowHover:Boolean(o&&!l),disableTooltip:l,renderTooltip:()=>d.replaceAll("-"," ").replaceAll("_"," "),closeDelay:0,render:e=>(0,F.jsx)(j.Z,{focused:r,onClick:n,...(0,T.Z)(t||{},(0,T.Z)({onMouseEnter:s},e)),ignoreLocalHoverState:!0,style:E(c).iconButton,children:(0,F.jsx)("img",{src:`data:image/svg+xml;utf8,${encodeURIComponent(u[i])}`,style:E(c).iconImage,onContextMenu:e=>e.preventDefault()})},o)})}function L(e){window.__c={n:"VariationMenuComponent"};const{parent:t,icon:o,variations:r,insertIcon:i}=e,n=(0,b.Fg)(),s=(0,_.O7)(),a="dark"===n.mode?r.light:r.dark,l=Object.keys(a).sort(((e,t)=>I.Oe.indexOf(e)-I.Oe.indexOf(t))).map((n=>{const s=`${o}_${n}`;return{key:s,action:e=>{t.close(),i(`/icons/${s}.svg`)},render:t=>(0,F.jsx)(R,{...e,...t,icon:s,color:n,variations:r,shouldOpenVariations:!1,hideTooltip:!0})}}));return(0,F.jsx)(A.Z,{debugName:"IconPickerMenuItem",capture:!0,allowEsc:!0,children:(0,F.jsx)(M.Z,{type:M.i.Grid,itemsPerRow:5,initialFocus:0,sections:[{key:"variations",render:e=>(0,F.jsx)("div",{...e}),items:l}],renderRow:(e,t)=>(0,F.jsx)("div",{style:E(s).variationMenu,children:e},t)})})}function Y(e){let{icon:t,focused:o,color:i,onClick:n,onMouseEnter:s,variations:a,hideTooltip:l,insertIcon:p,buttonPopupStore:c}=e;window.__c={n:"IconWithVariationsComponent"};const d=(0,r.useCallback)((()=>function(e){e.setState({...e.state,open:!1})}(c)),[c]),u=(0,r.useCallback)((e=>function(e,t){e.preventDefault(),t.setState({...t.state,open:!0})}(e,c)),[c]);return(0,F.jsx)(O.Z,{debugName:"IconPickerMenuItem",capture:o,onEnter:u,onEsc:d,children:(0,F.jsx)(w.ZP,{buttonPopupStore:c,popupType:w.Z4.Popup,renderOrigin:e=>(0,F.jsx)(B,{icon:t,focused:o,color:i,onClick:n,onMouseEnter:s,variations:a,hideTooltip:l,events:e}),render:e=>(0,F.jsx)(L,{parent:e,icon:t,variations:a,insertIcon:p})})},t)}const V={display:"flex",flexDirection:"column"},U="recentIcons",H=8,W=u.tg,q=u.Nm,G=u.II,K=u.pq,z=u.$P,$=u.qJ,Q=u.PS,J=356,X=u.T8*H+2*Q,ee=u.vP,te=(0,p.defineMessages)({noResults:{defaultMessage:"No results",id:"emojiPicker.noResults.message"}});class oe extends i.Z{constructor(){super(...arguments),this.filter="",this.splitFilter=[],this.storeTypes={store:f.Z,menuListStore:y.Z},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_insertIcon=e=>ae(e,this.environment,this.props.onSubmit,this.props.menuRef,this.stores.store,this.props.iconLoggingData),this.createListItem=(e,t)=>{const o=m.x(),r=this.props.enforceIconColor??o,i=`/icons/${`${e}${r?`_${r}`:""}`}.svg`;return{key:i,action:e=>function(e,t,o,r,i,n){ae(e,t,o,r,i,n)}(i,this.environment,this.props.onSubmit,this.props.menuRef,this.stores.store,this.props.iconLoggingData),render:o=>(0,F.jsx)(N,{...o,icon:e,color:r??"gray",variations:t,insertIcon:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_insertIcon,shouldOpenVariations:!Boolean(r)})}},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_performGetAllIconsRequest=e=>async function(e,t,o){if(!a.xb(o.getState().allIcons))return o.getState().allIcons;const r=await(0,h.ZP)({environment:t,url:e,method:"GET",format:"json",mode:"cors"});if("success"===r.type)return o.setState({...o.state,allIcons:r.data}),r.data;throw r.error}(e,this.environment,this.stores.store),this.createCategory=(e,t)=>{if(!t)return;let o=[];return o="recent"===e.id?this.stores.store.state.recentIcons||[]:Object.keys(t),0!==o.length?{key:e.id,items:o.map((e=>{if(void 0!==t[e])return this.createListItem(e,t[e])})).filter(Boolean),render:t=>(0,F.jsx)(C.Z,{isTitleUppercase:!0,title:e.title,children:(0,F.jsx)("div",{style:se(this.environment,this.theme),children:t.children})},t.key)}:void 0},this.handleScroll=e=>{if(Math.abs(e)<100){const{loadIconCount:e,allIcons:t}=this.stores.store.state,o=ie(this.environment,this.props.menuRef)*ne(this.environment),r=Math.max(o,this.getAllSectionsIconCount(t));this.stores.store.setState({...this.stores.store.state,loadIconCount:Math.min(r,e+o)})}}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=l.Z.get(U);this.stores.store.setState({...this.stores.store.state,recentIcons:t||[]})}renderComponent(){return(0,F.jsx)(d.Z,{request:"/icons/all",performRequest:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_performGetAllIconsRequest,render:(e,t,o)=>o?this.renderIconPicker(t):(0,F.jsx)("div",{style:{display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center",paddingBottom:"10px"},children:(0,F.jsx)(v.Z,{})})})}renderIconPicker(e){const{menuListStore:t}=this.stores,o=function(e,t,o,r){let{loadIconCount:i}=r.state;0===i&&(i+=ie(t,o)*ne(t));const n=[];let s=0;for(const a of e){if(!(s+a.items.length<=i)){n.push({...a,items:a.items.slice(0,i-s)});break}n.push(a),s+=a.items.length}return n}(this.getAllSections(e),this.environment,this.props.menuRef,this.stores.store),r=this.environment.device.isDesktop&&o.length>0?0:void 0;return 0===o.length&&(this.props.onNoResults&&this.props.onNoResults(),o.push({key:"no results",items:[{key:"no results",action:e=>{},render:(e,t)=>(0,F.jsx)(S.Z,{...e,caption:g.default.formatMessage(te.noResults)})}],render:e=>(0,F.jsx)(C.Z,{...e})})),(0,F.jsxs)("div",{style:V,children:[(0,F.jsx)("div",{style:{flexGrow:1},children:(0,F.jsx)(M.Z,{...(i=this.environment,n=this.props.menuRef,{type:M.i.Grid,itemsPerRow:ie(i,n),renderRow:(e,t)=>(0,F.jsx)("div",{style:{display:"flex"},children:e},t)}),store:t,initialFocus:r,sections:o,disableKeyboardArrowWrap:!0,unfocusOnScroll:this.environment.device.isMobile})}),(0,F.jsx)(x.Z,{onChange:this.handleScroll})]});var i,n}createFilteredSection(e){if(!e)return[];const t=function(e,t){const o=a.oA(Object.keys(e).map((o=>{const r=e[o],i=((null==r?void 0:r.tooltip)??o).replace("-"," "),n=[i,...r.tags],s=n.findIndex((e=>e===t));if(-1!==s)return[0===s?100:50,o];const a=n.findIndex((e=>e.startsWith(t))),l=i.includes(t);return 0!==a&&l?[40,o]:-1!==a?[0===a?80:30,o]:void 0})));return a.MR(o,(e=>-e[0])).map((e=>e[1]))}(e,this.filter);return 0===t.length?[]:[{key:"search-results",items:t.map((t=>this.createListItem(t,e[t]))),render:e=>(0,F.jsx)(C.Z,{children:(0,F.jsx)("div",{style:se(this.environment,this.theme),children:e.children})},e.key)}]}getAllSections(e){this.filter=s.rJ(this.props.filter)??"",this.splitFilter=this.filter?this.filter.split(" ").filter(Boolean):[];const t=a.oA((o=this.props.filter,a.oA([!o&&{id:"recent",title:(0,F.jsx)(p.FormattedMessage,{id:"iconPicker.section.recent",defaultMessage:"Recent"})},!o&&{id:"icons",title:(0,F.jsx)(p.FormattedMessage,{id:"iconPicker.section.icons",defaultMessage:"Icons"})}])).map((t=>this.createCategory(t,e))));var o;return this.props.filter&&this.filter?this.createFilteredSection(e):t}getAllSectionsIconCount(e){const t=this.getAllSections(e);let o=0;for(const r of t)o+=r.items.length;return o}}oe.displayName="IconPicker";const re=oe;function ie(e,t){var o,r;const{device:i,WindowSizeStore:n}=e;return i.isPhone?(window.innerWidth-n.getSafePaddingLeftPx(z)-n.getSafePaddingRightPx($))/u.mz:i.isTablet?W:null!=t&&null!==(o=t.current)&&void 0!==o&&o.offsetWidth?((null==t||null===(r=t.current)||void 0===r?void 0:r.offsetWidth)-2*Q)/u.T8:i.isTablet?W:H}function ne(e){return e.device.isMobile?K:G}function se(e,t){const{device:o,WindowSizeStore:r}=e;return{display:"flex",flexDirection:"column",flexWrap:"wrap",alignItems:"flex-start",...o.isPhone?{background:t.popoverBackground,paddingTop:10,paddingBottom:10,paddingLeft:r.getSafePaddingLeftCSS(z),paddingRight:r.getSafePaddingLeftCSS($),boxShadow:`0 1px 0 ${t.regularDividerColor}`,marginBottom:1}:{background:n.ZP.transparent,paddingLeft:o.isTablet?ee:Q,paddingRight:o.isTablet?ee:Q}}}function ae(e,t,o,r,i,n){const s=function(e){return e.replace("_dark","")}(e);o(s);const p=s.split(/[/_.]/),d=p[2],u=p[3];!function(e,t,o,r){const i=l.Z.get(U),n=a.G0([e],i),s=a.qn(n,ie(t,o)*q);l.Z.set(U,s),r.setState({...r.state,recentIcons:s})}(d,t,r,i),n&&c.fA(t,"pick_colored_icon",{icon:d,color:u,...n})}},3072:(e,t,o)=>{o.d(t,{Z:()=>x});o(57658),o(67294);var r=o(480),i=o(2032),n=o(72126),s=o(9291),a=o(47853),l=o(16187),p=o(87279),c=o(98742),d=o(52275),u=o(78140),h=o(32163),m=o(40721),g=o(53437),f=o(72495),y=o(26388),S=o(42782),v=o(85893);const M=(0,s.defineMessages)({noneText:{defaultMessage:"None",id:"database.propertyAggregationMenu.noneText"}});const x=(0,s.injectIntl)((function(e){let{onClose:t,property:o,schema:i,source:n,noneText:a,intl:l,onChange:c}=e;window.__c={n:"PropertyAggregationMenu"};const d=(0,r.O7)(),{device:g}=d;let y;return y=g.isMobile?{menuType:p.og.Modal,title:(0,v.jsx)(s.FormattedMessage,{defaultMessage:"Table aggregation",id:"database.mobilePropertyAggregationMenu.title"}),right:(0,v.jsx)(m.DoneMenuText,{}),onClickRight:t}:{menuType:p.og.Popup,width:200},(0,v.jsx)(u.Z,{...y,children:(0,v.jsx)(h.Z,{type:h.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,v.jsx)(f.Z,{...e}),items:b(o,i,n,l,c,d,a)}],onAccept:t})})}));function C(e){let{aggregationType:t,label:o,props:r}=e;const i=l.Sn[t];return(0,v.jsx)(y.ZP,{placement:g.GI.Placement.Right,delayThreshold:0,render:e=>(0,v.jsx)(d.Z,{title:o,...(0,c.Z)(e,r)}),renderTooltip:()=>(0,v.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,v.jsx)("img",{src:(0,a.D)(i),style:{borderRadius:4,width:140,marginTop:4}}),l.BG[t]]})},r.key)}function _(e,t){const o=l.VN[e],r=l.Sn[e];return{key:o,render:t=>(0,v.jsx)(y.ZP,{placement:g.GI.Placement.Right,delayThreshold:0,render:e=>(0,v.jsx)(d.Z,{title:o,...(0,c.Z)(e,t)}),renderTooltip:()=>(0,v.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[r&&(0,v.jsx)("img",{src:(0,a.D)(r),style:{borderRadius:4,width:140,marginTop:4}}),l.BG[e]]})},t.key),action:()=>{t(e)}}}function P(e,t,o,r,i){const{device:s}=i,a=l.VN[t],c=n.oA(function(e,t,o,r){const i=o[e];if(!i||"status"!==i.type)return;const n=i.groups;return n?n.map((e=>({key:`${t}${e.name}`,render:o=>(0,v.jsx)(C,{aggregationType:t,label:e.name,props:o}),action:()=>{r({operator:t,groupName:e.name})}}))):void 0}(e,t,o,r));return{key:t,render:(e,t)=>(0,v.jsx)(S.Z,{...e,onFocus:t.onFocus,renderOrigin:e=>(0,v.jsx)(d.Z,{...e,title:a}),renderExtension:(e,o)=>{let r;return r=s.isMobile?{menuType:p.og.Modal,title:a,right:(0,v.jsx)(m.DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:p.og.Popup,width:200,...e},(0,v.jsx)(u.Z,{...r,children:(0,v.jsx)(h.Z,{type:h.i.Vertical,initialFocus:0,sections:[{key:"groups",render:e=>(0,v.jsx)(f.Z,{...e}),items:c}],onAccept:t.onAccept})})}}),action:()=>null}}function b(e,t,o,r,n,s,a){const l=[],p=t[e];if(!p)return[];l.push({key:"none",render:e=>(0,v.jsx)(d.Z,{...e,title:a||r.formatMessage(M.noneText)}),action:()=>n(void 0)});for(const c of i.o5)l.push(_(c,n));if((0,i.iV)(p))for(const c of i.Sy){const e=_(c,n);if("show_unique"===c)switch(o){case"tableAggregation":continue;case"rollupPropertyMenu":l.splice(1,0,e);continue}l.push(e)}if((0,i.O4)(p))for(const c of i.k$)l.push(_(c,n));if((0,i.dN)(p))for(const c of i.f8)l.push(_(c,n));if((0,i.Mv)(p))for(const c of i.gC)l.push(_(c,n));if((0,i.Ei)(p))for(const c of i.OK)l.push(P(e,c,t,n,s));if((0,i.FN)(p))for(const c of i.tD)l.push(_(c,n));return l}},18145:(e,t,o)=>{o.d(t,{Z:()=>F,t:()=>O});o(67294);var r=o(83355),i=o(86628),n=o(2032),s=o(99036),a=o(42853),l=o(72126),p=o(9291),c=o(36610),d=o(94166),u=o(66890),h=o(16187),m=o(75079),g=o(87279),f=o(98742),y=o(61766),S=o(79797),v=o(52275),M=o(31945),x=o(78140),C=o(32163),_=o(40721),P=o(53437),b=o(72495),I=o(26388),T=o(97820),k=o(3072),j=o(69872),w=o(77498),A=o(85893);let O=function(e){return e[e.BlockPropertyOverlay=0]="BlockPropertyOverlay",e[e.ViewSettings=1]="ViewSettings",e}({});class Z extends r.Z{constructor(){super(...arguments),this.storeTypes={relationButtonPopupStore:y.Z,targetPropertyButtonPopupStore:y.Z,aggregationButtonPopupStore:y.Z},this.renderRelationSelect=e=>(0,A.jsx)(w.Z,{schema:this.props.schema,isRelationProperty:!0,onAccept:this.handleRelationAccept,onClose:e.close,allowProperty:L}),this.renderTargetPropertySelect=e=>{const t=R(this.props.schema,this.props.property,this.props.parentStore);if(t)return(0,A.jsx)(w.Z,{isRelationProperty:!1,schema:t.relatedCollectionSchema,onAccept:this.handleTargetPropertyAccept,allowProperty:Y,onClose:e.close})},this.renderAggregationSelect=e=>{const t=R(this.props.schema,this.props.property,this.props.parentStore);if(t&&t.propertySchema.target_property)return(0,A.jsx)(k.Z,{property:t.propertySchema.target_property,schema:t.relatedCollectionSchema,onChange:this.handlePropertyAggregationMenuChange,onClose:e.close,noneText:(0,A.jsx)(p.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),source:"rollupPropertyMenu"})},this.handleRelationAccept=e=>{const{onChange:t,analyticsFrom:o}=this.props,r=R(this.props.schema,this.props.property,this.props.parentStore);if(!r)return;const i={...r.propertySchema,relation_property:e,target_property:"title",target_property_type:"title",aggregation:void 0};null==t||t({propertySchema:i}),c.Zr(this.environment,{...(0,m.Pn)(this.context.collectionContextStore),from:o})},this.handleTargetPropertyAccept=e=>{const{onChange:t,analyticsFrom:o}=this.props,r=R(this.props.schema,this.props.property,this.props.parentStore);if(!r||!r.relatedCollectionValue||!r.relatedCollectionSchema)return;const i=r.relatedCollectionSchema[e];if(!i)return;const n={...r.propertySchema,target_property:e,target_property_type:i.type,aggregation:void 0};null==t||t({propertySchema:n}),c.yj(this.environment,{...(0,m.Pn)(this.context.collectionContextStore),from:o,property_type:i.type})},this.handlePropertyAggregationMenuChange=e=>{const{onChange:t,analyticsFrom:o}=this.props,r=R(this.props.schema,this.props.property,this.props.parentStore);if(!r)return;const i={...r.propertySchema,aggregation:e,show_as:void 0};null==t||t({propertySchema:i});const s=e?(0,n.gu)(e):void 0;c.en(this.environment,{...(0,m.Pn)(this.context.collectionContextStore),from:o,aggregation:s})}}renderComponent(){const{device:e}=this.environment,{context:t}=this.props,o=R(this.props.schema,this.props.property,this.props.parentStore);if(!o)return;const r=Boolean(o.propertySchema.relation_property),i=Boolean(o.propertySchema.relation_property&&o.propertySchema.target_property);if(t===O.BlockPropertyOverlay){let t;return t=e.isMobile?{menuType:g.og.Modal,title:o.propertySchema.name,right:(0,A.jsx)(_.DoneMenuText,{}),onClickRight:this.props.onDismiss}:{menuType:g.og.Popup},(0,A.jsx)(x.Z,{...t,children:(0,A.jsx)(C.Z,{type:C.i.Vertical,initialFocus:void 0,sections:l.oA([this.renderRelationSection(),this.renderTargetPropertySection(r),this.renderAggregationSection(i)])})})}return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(M.ZP,{popupType:e.isMobile?P.kQ.SlideUp:P.kQ.Popup,alignmentToOrigin:M.vR.End,renderOrigin:e=>(0,A.jsx)(d.Z,{title:(0,A.jsx)(p.FormattedMessage,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"}),disabled:this.props.disabled,showChevron:!0,rotateChevron:this.stores.relationButtonPopupStore.state.open,right:o.relationPropertySchema?(0,A.jsx)(T.Z,{propertySchema:o.relationPropertySchema,showIcon:!0}):(0,A.jsx)(p.FormattedMessage,{id:"database.viewSettings.rollupOptions.selectRelation",defaultMessage:"Select"}),...e}),render:this.renderRelationSelect,buttonPopupStore:this.stores.relationButtonPopupStore}),(0,A.jsx)(I.ZP,{renderTooltip:()=>(0,A.jsx)(D,{}),disableTooltip:r,render:t=>(0,A.jsx)(M.ZP,{popupType:e.isMobile?P.kQ.SlideUp:P.kQ.Popup,alignmentToOrigin:M.vR.End,renderOrigin:e=>(0,A.jsx)(d.Z,{title:(0,A.jsx)("span",{style:{...!i&&{color:this.theme.mediumTextColor}},children:(0,A.jsx)(p.FormattedMessage,{defaultMessage:"Property",id:"database.viewSettings.rollupOptions.targetProperty"})}),disabled:!r||this.props.disabled,showChevron:!0,rotateChevron:this.stores.targetPropertyButtonPopupStore.state.open,right:r&&(o.targetPropertySchema?(0,A.jsx)(T.Z,{propertySchema:o.targetPropertySchema,showIcon:!0}):(0,A.jsx)(p.FormattedMessage,{id:"database.viewSettings.rollupOptions.selectTargetProperty",defaultMessage:"Select"})),...(0,f.Z)(t,e)}),render:this.renderTargetPropertySelect,buttonPopupStore:this.stores.targetPropertyButtonPopupStore})}),(0,A.jsx)(I.ZP,{renderTooltip:()=>(0,A.jsx)(E,{}),disableTooltip:i,render:t=>(0,A.jsx)(M.ZP,{popupType:e.isMobile?P.kQ.SlideUp:P.kQ.Popup,alignmentToOrigin:M.vR.End,renderOrigin:e=>(0,A.jsx)(d.Z,{disabled:!i||this.props.disabled,title:(0,A.jsx)("span",{style:{...!i&&{color:this.theme.mediumTextColor}},children:(0,A.jsx)(p.FormattedMessage,{defaultMessage:"Calculate",id:"database.viewSettings.rollupOptions.calculate"})}),showChevron:!0,rotateChevron:this.stores.aggregationButtonPopupStore.state.open,right:i&&(0,A.jsx)(N,{schema:this.props.schema,property:this.props.property,parentStore:this.props.parentStore}),...(0,f.Z)(t,e)}),render:this.renderAggregationSelect,buttonPopupStore:this.stores.aggregationButtonPopupStore})})]})}renderRelationSection(){const{device:e}=this.environment,{disabled:t}=this.props,o=R(this.props.schema,this.props.property,this.props.parentStore);if(o)return{key:0,render:e=>(0,A.jsx)(b.Z,{...e,title:(0,A.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editRelation.title",defaultMessage:"Relation"}),isTitleUppercase:!0}),items:[{key:0,render:r=>(0,A.jsx)(M.ZP,{popupType:e.isMobile?P.kQ.SlideUp:P.kQ.Popup,renderOrigin:e=>o.relationPropertySchema?(0,A.jsx)(j.Z,{...(0,f.Z)(r,e),propertySchema:o.relationPropertySchema,format:j.L.Name,right:B(t,this.theme),disabled:t}):(0,A.jsx)(v.Z,{...(0,f.Z)(r,e),title:(0,A.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editRelation.buttonTitle",defaultMessage:"Select an existing relation…"}),right:B(t,this.theme),style:{color:this.theme.mediumTextColor},disabled:t}),render:this.renderRelationSelect,buttonPopupStore:this.stores.relationButtonPopupStore},r.key),action:()=>{this.stores.relationButtonPopupStore.setState({open:!0})}}]}}renderTargetPropertySection(e){const{device:t}=this.environment,{disabled:o}=this.props,r=R(this.props.schema,this.props.property,this.props.parentStore);if(r)return{key:1,render:e=>(0,A.jsx)(b.Z,{...e,title:(0,A.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editProperty.title",defaultMessage:"Property"}),topBorder:!0,isTitleUppercase:!0}),items:[{key:0,render:i=>(0,A.jsx)(I.ZP,{renderTooltip:()=>(0,A.jsx)(D,{}),disableTooltip:e,render:n=>(0,A.jsx)(M.ZP,{popupType:t.isMobile?P.kQ.SlideUp:P.kQ.Popup,renderOrigin:t=>r.targetPropertySchema?(0,A.jsx)(j.Z,{...(0,f.Z)(i,t),propertySchema:r.targetPropertySchema,format:j.L.Name,right:B(o,this.theme),disabled:o}):(0,A.jsx)(v.Z,{...(0,f.Z)(i,n),title:(0,A.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editProperty.buttonTitle",defaultMessage:"Select a property to display…"}),right:B(!e||o,this.theme),disabled:!e||o,disabledFeedback:!0}),render:this.renderTargetPropertySelect,buttonPopupStore:this.stores.targetPropertyButtonPopupStore})},i.key),action:()=>{this.stores.targetPropertyButtonPopupStore.setState({open:!0})}}]}}renderAggregationSection(e){const{device:t}=this.environment,{disabled:o}=this.props;if(R(this.props.schema,this.props.property,this.props.parentStore))return{key:2,render:e=>(0,A.jsx)(b.Z,{...e,title:(0,A.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editAggregate.title",defaultMessage:"Calculate"}),topBorder:!0,isTitleUppercase:!0}),items:[{key:0,render:r=>(0,A.jsx)(I.ZP,{renderTooltip:()=>(0,A.jsx)(E,{}),disableTooltip:e,render:i=>e?(0,A.jsx)(M.ZP,{popupType:t.isMobile?P.kQ.SlideUp:P.kQ.Popup,renderOrigin:e=>(0,A.jsx)(v.Z,{...(0,f.Z)(r,e),title:(0,A.jsx)(N,{schema:this.props.schema,property:this.props.property,parentStore:this.props.parentStore}),right:B(o,this.theme),disabled:o}),render:this.renderAggregationSelect,buttonPopupStore:this.stores.aggregationButtonPopupStore}):(0,A.jsx)(v.Z,{...(0,f.Z)(r,i),title:(0,A.jsx)(p.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),right:B(o,this.theme),disabled:!0,disabledFeedback:!0})},r.key),action:()=>{this.stores.aggregationButtonPopupStore.setState({open:!0})}}]}}}Z.displayName="RollupPropertyMenu",Z.contextTypes={...r.w,...u.xm};const F=Z;function R(e,t,o){const r=e[t];if(!r)return;let i,n;if(r.relation_property){const t=e[r.relation_property];t&&"relation"===t.type&&(i=t)}if(i){const e=s.j0(i);if(e){n=S.NW.createChildStore(o,e).getValue()}}const a=n?s.oC(n):{};let l;return n&&r.target_property&&(l=a[r.target_property]),{propertySchema:r,relationPropertySchema:i,relatedCollectionValue:n,relatedCollectionSchema:a,targetPropertySchema:l}}function N(e){let{schema:t,property:o,parentStore:r}=e;window.__c={n:"CurrentAggregation"};const s=(0,i.VK)((()=>R(t,o,r)),[r,o,t]);return s?s.propertySchema.aggregation?(0,A.jsx)(A.Fragment,{children:h.VN[(0,n.gu)(s.propertySchema.aggregation)]}):(0,A.jsx)(p.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}):null}function D(){return(0,A.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editProperty.tooltip",defaultMessage:"Select an existing relation first."})}function E(){return(0,A.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editAggregate.tooltip",defaultMessage:"Select an existing relation and property first."})}function B(e,t){return e?void 0:(0,a.i)({width:11,fill:t.mediumIconColor})}function L(e){return"relation"===e.type}function Y(e){return"rollup"!==e.type&&!s.Eu.includes(e.type)}},9050:(e,t,o)=>{o.d(t,{Z:()=>p});o(67294);var r=o(480),i=o(24405),n=o(8848),s=o(80025),a=o(52275),l=o(85893);const p=function(e){const{color:t}=e;return(0,l.jsx)(a.Z,{...e,icon:(0,l.jsx)(c,{color:t}),title:(0,s.Vn)(t)})};function c(e){let{color:t}=e;window.__c={n:"ColorTileComponent"};const o=(0,i.Fg)(),s=(0,r.O7)(),a=(0,n.KR)(o,t);return(0,l.jsx)("div",{style:{width:s.device.isMobile?24:18,height:s.device.isMobile?24:18,background:a.menuBackgroundColor,color:a.textColor,boxShadow:o.innerBorderBoxShadow,borderRadius:4}})}},73456:(e,t,o)=>{o.d(t,{Z:()=>N});o(57658),o(67294);var r=o(83355),i=o(49085),n=o(99036),s=o(8848),a=o(84619),l=o(96711),p=o(18557),c=o(37612),d=o(72126),u=o(6287),h=o(82990),m=o(9291),g=o(36610),f=o(47307),y=o(30772),S=o(27871),v=o(18533),M=o(66890),x=o(92658),C=o(75079),_=o(87279),P=o(50959),b=o(93405),I=o(68894),T=o(78140),k=o(32163),j=o(40721),w=o(53437),A=o(72495),O=o(9050),Z=o(22084),F=o(85893);class R extends r.Z{constructor(){super(...arguments),this.storeTypes={renameInputStore:x.Z,showSelectDescription:i.default.createClass(!1)},this.renderPopup=()=>{const{device:e}=this.environment,{option:t,statusGroup:o,propertySchema:r,intl:i}=this.props,{renameInputStore:n}=this.stores,d=this.stores.showSelectDescription.state,M=[];d&&M.push({key:"description",render:t=>(0,F.jsx)(A.Z,{...t,desktopStyle:{paddingTop:0},title:e.isMobile?i.formatMessage(S.k.descriptionHeader):void 0}),items:[{key:"description",render:e=>(0,F.jsx)(S.i,{...e,initialDescription:t.description,handleSaveDescription:e=>function(e,t,o,r,i,n,s,a){if(e===(a.description??""))return;const l={...a,description:e},p={pointer:{table:u.v,id:r},command:"keyedObjectListUpdate",path:["schema",i,"options"],args:{value:l}};o([p]),g.$q(t,{property_type:n.type,action:"select_set_description",from:s})}(e,this.environment,this.props.onChange,this.props.collectionId,this.props.property,this.props.propertySchema,this.props.analyticsFrom,this.props.option),disableAutoSection:!0}),action:()=>{}}]});const x={key:"action",render:e=>(0,F.jsx)(A.Z,{...e}),items:[]};M.push(x),x.items.push({key:"delete",render:e=>(0,F.jsx)(b.Z,{...e,title:(0,F.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteLabel",defaultMessage:"Delete"}),svg:c.y}),action:this.handleDelete}),o&&"status"===r.type&&(x.items.push({key:"setAsDefault",render:e=>(0,F.jsx)(b.Z,{...e,title:(0,F.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.setAsDefault",defaultMessage:"Set as default"}),svg:p.z}),action:()=>async function(e,t,o,r,i,n,s,a,l){if("status"!==o.type||!l)return;if(n.value===o.defaultOption)return;if(void 0!==o.defaultOption){if(!(await f.confirmUserAction({message:(0,F.jsx)("span",{children:(0,F.jsx)(m.FormattedMessage,{defaultMessage:"Change default to <b>{defaultValue}</b>?",id:"database.editProperty.setAsDefault.confirm.title",values:{defaultValue:n.value,b:e=>(0,F.jsx)("span",{style:{fontWeight:h.Z.fontWeight.semibold},children:e})}})}),description:(0,F.jsx)("span",{children:(0,F.jsx)(m.FormattedMessage,{defaultMessage:"New pages will start with {defaultValue} as the default status. Existing pages <b>without a status explicitly set</b> will switch to {defaultValue}.",id:"database.editProperty.setAsDefault.confirm.description",values:{defaultValue:n.value,b:e=>(0,F.jsx)("span",{style:{fontWeight:h.Z.fontWeight.semibold},children:e})}})}),acceptLabel:(0,F.jsx)(m.FormattedMessage,{defaultMessage:"Continue",id:"database.editProperty.setAsDefault.confirm.continueButton"})})))return}const p={table:u.v,id:e},c=[],d={pointer:p,command:"update",path:["schema",t],args:{defaultOption:n.value}};c.push(d),r(c),s(),g.$q(a,{property_type:o.type,action:"status_set_default",from:i,collection_id:e})}(this.props.collectionId,this.props.property,this.props.propertySchema,this.props.onChange,this.props.analyticsFrom,this.props.option,this.props.onClose,this.environment,this.props.statusGroup)}),x.items.push({key:"Group",render:e=>(0,F.jsx)("div",{...e,children:(0,F.jsx)(v.Z,{...e,title:(0,F.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.Group",defaultMessage:"Group"}),selectedKey:o.name,options:(r.groups??[]).map((e=>({key:e.name,title:P.ZA[e.name]??e.name}))),icon:e=>(0,l.V)({...e,width:16,marginRight:0}),onChange:e=>{!function(e,t,o,r,i,n,s,a,l){if("status"!==s.type||!l)return;const p={table:u.v,id:t},c=[],d=s.groups??[],h=d.findIndex((e=>e.id===l.id)),m=d.findIndex((t=>t.name===e));if(h===m)return;const f={pointer:p,command:"listRemove",path:["schema",r,"groups",h,"optionIds"],args:{id:o.id}},y={pointer:p,command:"listAfter",path:["schema",r,"groups",m,"optionIds"],args:{id:o.id}};c.push(f,y);const S=s.options??[],v=d.flatMap((e=>{const t=e.optionIds??[],o=S.filter((e=>t.includes(e.id)));return o})),M={pointer:p,command:"set",path:["schema",r,"options"],args:v};c.push(M),i(c),g.$q(a,{property_type:s.type,action:"status_set_default",from:n,collection_id:t})}(e,this.props.collectionId,this.props.option,this.props.property,this.props.onChange,this.props.analyticsFrom,this.props.propertySchema,this.environment,this.props.statusGroup)}})}),action:()=>{}}));const C=s.AP.map((e=>{const o={key:e,render:o=>(0,F.jsx)(O.Z,{...o,color:e,checkState:t.color===e}),action:()=>{!function(e,t,o,r,i,n,s,a){const l={...t,color:e},p={pointer:{table:u.v,id:o},command:"keyedObjectListUpdate",path:["schema",r,"options"],args:{value:l}};n([p]),g.$q(a,{property_type:i.type,action:"select_change_color",from:s,collection_id:o})}(e,this.props.option,this.props.collectionId,this.props.property,this.props.propertySchema,this.props.onChange,this.props.analyticsFrom,this.environment)}};return o})),w={key:"color",render:e=>(0,F.jsx)(A.Z,{...e,title:(0,F.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.colorsSection",defaultMessage:"Colors"}),isTitleUppercase:!0,topBorder:!0}),items:C};let R;return M.push(w),R=e.isMobile?{menuType:_.og.Modal,title:(0,F.jsx)(Z.a,{format:a.lo.Large,value:t.value,color:t.color,showRemoveButton:!1,isSingle:!0}),right:(0,F.jsx)(j.DoneMenuText,{}),onClickRight:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRenameInputSubmit}:{menuType:_.og.Popup,width:220},(0,F.jsxs)(T.Z,{...R,children:[(0,F.jsx)(A.Z,{isInput:!0,children:(0,F.jsx)(I.ZP,{focusInitial:!0,selectAll:!e.isMobile,value:n.state.inputValue,maxlength:180,onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRenameInputChange,onSubmit:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRenameInputSubmit,showClearButton:!1,inputRight:(0,F.jsx)(y.l,{onClick:()=>this.stores.showSelectDescription.setState(!d),description:t.description,showTooltip:!d})})}),(0,F.jsx)(k.Z,{type:k.i.Vertical,disableKeyboard:!0,initialFocus:void 0,sections:M})]})},this.handleDelete=()=>{const{option:e,collectionId:t,onChange:o,analyticsFrom:r,statusGroup:i,propertySchema:s,property:a}=this.props;"status"!==s.type||e.value!==s.defaultOption?f.showDialog({showCancel:!0,keepFocus:!1,message:(0,F.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteModal.prompt",defaultMessage:"Are you sure you want to delete this option?"}),items:[{label:(0,F.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteModal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:()=>{if(!n.cu(s)&&"status"!==s.type)return;const l={table:u.v,id:t},p=[],c={pointer:l,command:"keyedObjectListRemove",path:["schema",a,"options"],args:{remove:{id:e.id}}};if(p.push(c),i&&"status"===s.type){const t=(s.groups??[]).findIndex((e=>e.id===i.id)),o={pointer:l,command:"listRemove",path:["schema",a,"groups",t,"optionIds"],args:{id:e.id}};p.push(o)}o(p),this.props.onClose(),g.$q(this.environment,{...(0,C.Pn)(this.context.collectionContextStore),property_type:s.type,action:"select_delete_option",from:r})}}]}):f.showErrorMessage((0,F.jsx)(m.FormattedMessage,{defaultMessage:"Cannot delete default option.",id:"database.editProperty.errorDialog.forbidDeleteDefaultOption.message"}))},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRenameInputChange=e=>function(e,t){const o=e.target.value.replace(/,/g,"");t.setState({...t.state,inputValue:o}),t.emit()}(e,this.stores.renameInputStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRenameInputSubmit=()=>{return e=this.props.onClose,t=this.props.collectionId,o=this.props.propertySchema,r=this.props.property,i=this.props.onChange,n=this.props.option,s=this.stores.renameInputStore,e(),void D(t,o,r,i,n,s);var e,t,o,r,i,n,s},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDismiss=()=>{return e=this.props.onClose,t=this.props.collectionId,o=this.props.propertySchema,r=this.props.property,i=this.props.onChange,n=this.props.option,s=this.stores.renameInputStore,e(),void D(t,o,r,i,n,s);var e,t,o,r,i,n,s}}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.stores.renameInputStore.setState({...this.stores.renameInputStore.state,inputValue:e.option.value})}renderComponent(){const{origin:e,open:t,alignmentToOrigin:o}=this.props,{device:r}=this.environment;return(0,F.jsx)(w.ZP,{popupType:r.isMobile?w.ZP.PopupType.SlideUp:w.ZP.PopupType.Popup,open:t,onDismiss:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDismiss,origin:e,render:this.renderPopup,alignmentToOrigin:o})}}R.displayName="SelectOptionActionMenu",R.contextTypes={...r.w,...M.xm};const N=(0,m.injectIntl)(R);function D(e,t,o,r,i,n){const s=n.state.inputValue,a=t.options||[],l=a.find((e=>e.id!==i.id&&e.value.trim().toLowerCase()===s.trim().toLowerCase()));if(i.value!==s)if(s)if(l)f.showErrorMessage((0,F.jsx)(m.FormattedMessage,{defaultMessage:"This select option already exists.",id:"database.editProperty.errorDialog.duplicateSelectValue.message"}));else{const n=a.find((e=>e.id===i.id));if(!n)return;const l={...n,value:s},p={pointer:{table:u.v,id:e},command:"keyedObjectListUpdate",path:["schema",o,"options"],args:{value:l}},c="status"===t.type&&i.value===t.defaultOption?{pointer:{table:u.v,id:e},command:"update",path:["schema",o],args:{defaultOption:s}}:void 0;r(d.oA([p,c]))}else f.showErrorMessage((0,F.jsx)(m.FormattedMessage,{defaultMessage:"Please type a value.",id:"database.editProperty.errorDialog.missingSelectValue.message"}))}},72589:(e,t,o)=>{o.d(t,{Z:()=>O});var r=o(67294),i=o(480),n=o(86628),s=o(24405),a=o(35011),l=o(84619),p=o(73110),c=o(73717),d=o(35102),u=o(42875),h=o(66673),m=o(59753),g=o(149),f=o(82990),y=o(36610),S=o(66890),v=o(75079),M=o(33929),x=o(87279),C=o(73807),_=o(80444),P=o(19629),b=o(30752),I=o(8606),T=o(53876),k=o(78140),j=o(65668),w=o(85893);const A=200;function O(e){var t,o,s,l;window.__c={n:"CollectionFormulaEditor"};const{property:f,disabled:P,formulas:b,getRecordModel:I,propertySchema:T,collectionStore:O,handleSave:F,handleClose:R,blockStore:N,analyticsFrom:D}=e,E=(0,i.O7)(),B=(0,S.Y$)(),[L,Y]=(0,r.useState)(null==T||null===(t=T.formula2)||void 0===t?void 0:t.code),V=(0,h.Kt)(L,A,Object.is),U=(0,r.useRef)(null===(o=T.formula2)||void 0===o?void 0:o.code),H=(0,r.useRef)(L),W=(0,r.useRef)(null==T||null===(s=T.formula2)||void 0===s?void 0:s.result_type),q=(0,r.useCallback)((e=>{H.current=e,Y(e)}),[]),G=(0,r.useCallback)((e=>{W.current=e}),[]),[K,z]=(0,r.useState)([]),$=(0,i.Fy)();(0,r.useEffect)((()=>()=>{const e=U.current,t=H.current,o=W.current;t===e&&void 0===ee||(F({newValue:t,newType:(0,a.x9)(o??{type:"unknown"}),propertySchema:T,collectionStore:O,property:f}),y.$q(E,{...(0,v.Pn)(B),property_type:T.type,action:"formula_v2_edit",from:D}))}),[]);const Q=(0,n.VK)((()=>O.pointer),[O.pointer]),J=(0,r.useMemo)((()=>{const e={type:"block",collection:Q};return{kind:p.yp.ThisRow,type:e}}),[Q]),X=(0,r.useMemo)((()=>{const e=m.s8.fromGetRecordModelFn(I);return{sourceProperty:f,valueTypes:[J],handleDataRequest:b.createFormulaDataRequestHandler(I,e),formulaPropertyNames:L&&(0,d.Ny)(L)}}),[L,b,I,f,J]),ee=(0,n.VK)((()=>{if("v2"!==T.version&&T.formula)return b.convertCollectionFormulaToFormula2(T.formula,Q,O.getSchema())}),[Q,O,b,T.formula,T.version]),te=(0,r.useRef)(!1);(0,r.useEffect)((()=>{!async function(){if(!ee||te.current)return;const e=await b.analyzeFormula(ee,X);let t;t=g.x.isFail(e)?{type:"unknown"}:e.value.type??{type:"unknown"},te.current=!0,q(ee),G(t)}()}),[O,b,q,G,f,T,ee,X]);const oe=(0,r.useMemo)((()=>{var e;const t="v2"===T.version?null===(e=T.formula2)||void 0===e?void 0:e.code:ee;return U.current=t,t}),[null===(l=T.formula2)||void 0===l?void 0:l.code,T.version,ee]),re=(0,n.VK)((()=>{var e;return null===(e=_.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),ie=(0,C._)(),ne=(0,n.VK)((()=>{z([]);const e=O.getModel(),t=null==N?void 0:N.getModel(),o=null==N?void 0:N.getRecordModel;if(!(t&&e&&V&&o))return;const r=(0,a.NM)({block:t,property:f,formulaCode:V,getRecordModel:o,intl:M.default.getIntl(),userTimeZone:(0,u.r)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+ie,resultCache:new Map});if(r){if(!g.x.isFail(r))return r.value;(0,c.y_)(r.error)&&z([r.error])}}),[O,N,V,f,ie]);return X&&re?(0,w.jsx)(k.Z,{menuType:$.isMobile?x.og.Modal:x.og.Popup,hideMobileTopbar:!0,width:$.isMobile?void 0:740,disableBottomPadding:!0,maxHeight:"unset",disableHeaderBorder:!0,disableScroller:!0,children:(0,w.jsx)(j.Z,{initialCode:oe,outputFooter:void 0!==N&&(0,w.jsx)(Z,{formulaResult:ne,blockStore:N,formulaSchema:T}),formulas:b,getRecordModel:I,focus:!0,disabled:P,parentSpaceId:re,typecheckContext:X,onCodeChange:q,onTypeChange:G,handleClose:R,parentCollection:O,evaluationErrors:K})}):null}const Z=r.memo((e=>{let{formulaResult:t,blockStore:o,formulaSchema:i}=e;window.__c={n:"FormulaOutputFooter"};const[a,p]=(0,n.VK)((()=>{var e;if(!t||"undefined"===t.type)return[[],"text"];const r=(0,b.$I)(t,o.getRecordModel,(0,u.r)());return[r,(null===(e=r[0])||void 0===e?void 0:e.type)??"text"]}),[o.getRecordModel,t]),c=(0,n.VK)((()=>{if(null==a||!a.length)return[];const e=(0,P.vQ)(p,i);return(0,w.jsx)(P.E1,{propertyType:p,rootPropertySchema:i,numberRightAlign:!1,children:a.map(((t,r)=>(0,w.jsx)(P.gZ,{token:t,targetPropertySchema:i,blockStore:o,withComma:e&&r<a.length-1,numberRightAlign:!1},`${t.id}-${r}`)))})}),[o,i,a,p]),d=(0,s.yK)((e=>({output:{display:"flex",alignItems:"center",zIndex:1,fontSize:f.Z.fontSize.UISmall.desktop,height:38,padding:10,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,overflow:"hidden"},equals:{fontSize:f.Z.fontSize.UIRegular.desktop,color:e.mediumTextColor,marginRight:6,marginLeft:2}})),[]),h=(0,r.useMemo)((()=>({baseStyles:{sizing:"small",tokenFormat:l.lo.Small,textStyle:{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},tokenWrapStyle:{display:"flex",flexWrap:"nowrap",...T.RQ[l.lo.Medium]}},store:o,isEmpty:!1,isReadOnly:!0,shouldRenderTooltip:!1,shouldWrap:!1,collectionContextStore:void 0,templateVariableContext:void 0,property:void 0,unmappedProperty:void 0,propertySchema:i,trackEditBlockProperty:()=>{},format:0,containerRef:null})),[o,i]);return(0,w.jsx)(I.O.Provider,{value:h,children:(0,w.jsxs)("div",{style:d.output,children:[(0,w.jsx)("span",{style:d.equals,children:"="}),c]})})}))},5385:(e,t,o)=>{o.d(t,{x:()=>i});var r=o(80444);function i(){var e;return null===(e=r.default.state)||void 0===e||null===(e=e.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.icon_picker_color}},12205:(e,t,o)=>{o.d(t,{J:()=>n});var r=o(86628),i=o(80444);function n(){const{currentSpaceStore:e}=(0,r.Kw)(i.default);return(0,r.VK)((()=>(null==e?void 0:e.canAdmin())??!1),[e])}},43604:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o(49085).default.createValue({open:!1})},4391:(e,t,o)=>{o.d(t,{Z:()=>n});var r=o(49085);class i extends r.default{getInitialState(){return{allIcons:{},recentIcons:[],loadIconCount:0}}}const n=i},2607:(e,t,o)=>{o.d(t,{b:()=>p});o(57658),o(30541);var r,i=o(21202),n=o(77420),s=o(19889),a=o(70203),l=o(97880);class p{}r=p,p.text=e=>new u(e),p.textValue=e=>"string"==typeof e?r.text(e).build():e,p.mentionDate=e=>new m(e),p.mentionUser=e=>new g(e),p.mentionGroup=(e,t)=>new v(e,t),p.mentionBot=e=>new g(e),p.mentionPage=e=>new g(e),p.mentionTemplateVariable=e=>new f(e),p.mentionFormulaContextVariable=e=>new y(e),p.mentionFormulaPagePropertyVariable=e=>new S(e),p.mentionCitation=e=>new M(e),p.equation=e=>new h(e),p.concat=e=>new c(e);class c{constructor(e){this.build=()=>{const e=[];for(const t of this.tokens){const o=t.build();e.push(o[0])}return e},this.tokens=e}}class d{constructor(e){this.styles={},this.highlight=void 0,this.linkData=void 0,this.bold=()=>(this.styles[a.GKr.Bold]=!0,this),this.italic=()=>(this.styles[a.GKr.Italic]=!0,this),this.strike=()=>(this.styles[a.GKr.Strike]=!0,this),this.code=()=>(this.styles[a.GKr.Code]=!0,this),this.underline=()=>(this.styles[a.GKr.Underline]=!0,this),this.color=e=>(this.highlight=e,this),this.link=e=>(this.linkData=e,this),this.build=()=>{const e=[];for(const t of(0,l.Yd)(this.styles))e.push([t]);return this.highlight&&e.push([a.GKr.Highlight,this.highlight]),this.linkData&&e.push([a.GKr.Link,this.linkData]),this.onBuild(e)},this.onBuild=e}}class u extends d{constructor(e){super((t=>{if(this.url&&t.unshift(a.edl(this.url)),t.length>0){return[[e,t]]}return[[e]]})),this.url=void 0,this.link=e=>(this.url=e,this)}}class h extends d{constructor(e){super((t=>[a.qZ6(e,t)]))}}class m extends d{constructor(e){super((t=>{let o;"date"in e?o=this.getDateAnnotationData(e.date):"time"in e?o=this.getTimeAnnotationData(e.time,e.timeZone):(0,l.t1)(e);const r=a.pZr(o);return[a.YCD(r,t)]})),this.getDateString=e=>e.toISOString().split("T")[0],this.getTimeString=e=>e.toISOString().split("T")[1].slice(0,5)}getDateAnnotationData(e){if(Array.isArray(e)){const[t,o]=e;return{type:"daterange",start_date:this.getDateString(t),end_date:this.getDateString(o)}}return{type:"date",start_date:this.getDateString(e)}}getTimeAnnotationData(e,t){if(Array.isArray(e)){const[o,r]=e;return{type:"datetimerange",start_date:this.getDateString(o),start_time:this.getTimeString(o),end_date:this.getDateString(r),end_time:this.getTimeString(r),time_zone:t??"Etc/GMT"}}return{type:"datetime",start_date:this.getDateString(e),start_time:this.getTimeString(e),time_zone:t??"Etc/GMT"}}}class g extends d{constructor(e){super((t=>{let o;return e.table===s.KJ?o=a.tEo(e.id):e.table===n.cZ?o=a.CbB(e.id):e.table===i.iU?o=a.$0A(e.id,e.spaceId):(0,l.t1)(e),[a.YCD(o,t)]}))}}class f extends d{constructor(e){super((t=>{const o=a.WBu({type:e});return[a.YCD(o,t)]}))}}class y extends d{constructor(e){super((t=>{const o=a._QF(e);return[a.YCD(o,t)]}))}}class S extends d{constructor(e){super((t=>{const o=a.kbv(e);return[a.YCD(o,t)]}))}}class v extends d{constructor(e,t){super((o=>{const r=a.XIB(e,t);return[a.YCD(r,o)]}))}}class M extends d{constructor(e){super((t=>{const o=a.hNu(e);return[a.YCD(o,t)]}))}}},11843:(e,t,o)=>{o.d(t,{E:()=>s,S:()=>n});var r=o(40506);const i={"de-DE":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"da-DK":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"fi-FI":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"nb-NO":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"nl-NL":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"sv-SE":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"en-US":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"es-ES":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"es-LA":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"fr-FR":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"pt-BR":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"ko-KR":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"YYYY[년] MMMM"},"zh-CN":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"YYYY[年]MMM"},"zh-TW":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"YYYY[年]MMM"},"ja-JP":{time:{"12h":"A h:mm","24h":"H:mm",hidden:r.n3},month:"YYYY[年]MMM"},pseudo:{time:{"12h":"A h:mm","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"}},n=["de-DE","fr-FR"],s=e=>i[e]}}]);