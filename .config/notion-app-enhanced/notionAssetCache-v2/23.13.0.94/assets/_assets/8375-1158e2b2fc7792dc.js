"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8375],{81575:(e,t,n)=>{n.d(t,{AK:()=>m,Mc:()=>s,OS:()=>c,Td:()=>h,Uu:()=>a,XC:()=>l,ZK:()=>x,e8:()=>p,gV:()=>u,hc:()=>v,n0:()=>g,u0:()=>f,xi:()=>d});var o=n(97978),i=n(15010),r=n(35057);function s(e){o.j(e,"add_slack_integration")}function a(e){o.j(e,"remove_slack_integration")}function l(e,t){o.j(e,"slack_notification_create",t)}function d(e,t){o.j(e,"slack_notification_delete",t)}function c(e,t){o.j(e,"slack_notification_update",t)}function u(e,t){const n=r.zt(),s=i.JF();o.j(e,"slack_imports_invite_render_button",{subscription_tier:n,domain_type:s,origin:t.origin,invite_flow_id:t.invite_flow_id})}function p(e,t){const n=r.zt(),s=i.JF();o.j(e,"slack_imports_invite_render_invite_popup",{subscription_tier:n,domain_type:s,origin:t.origin,invite_flow_id:t.invite_flow_id})}function m(e,t){const n=r.zt(),s=i.JF();o.j(e,"slack_imports_invite_click_invite_button",{subscription_tier:n,domain_type:s,invited_user_count:t.invited_user_count,origin:t.origin,invite_token_query:t.inviteTokenQuery,invite_targets:t.inviteTargets,invite_flow_id:t.invite_flow_id})}function f(e,t){const n=r.zt(),s=i.JF();o.j(e,"slack_imports_invite_completed",{subscription_tier:n,domain_type:s,invited_user_count:t.invited_user_count,is_success:t.is_success,origin:t.origin,invite_flow_id:t.invite_flow_id,error:t.error,invite_stage:t.invite_stage})}function h(e,t){const n=r.zt(),s=i.JF();o.j(e,"slack_imports_invite_dismiss_popup",{subscription_tier:n,domain_type:s,origin:t.origin,invite_flow_id:t.invite_flow_id})}function v(e,t){const n=r.zt(),s=i.JF();o.j(e,"slack_imports_invite_click_select_all",{subscription_tier:n,domain_type:s,origin:t.origin,invite_flow_id:t.invite_flow_id,invited_user_count:t.invited_user_count,is_unselect:t.is_unselect,invite_token_query:t.invite_token_query})}function g(e,t){const n=r.zt(),s=i.JF();o.j(e,"slack_imports_invite_start_slack_integration",{subscription_tier:n,domain_type:s,origin:t.origin,invite_flow_id:t.invite_flow_id,from:t.from})}function x(e,t){const n=r.zt(),s=i.JF();o.j(e,"slack_imports_invite_complete_slack_integration",{subscription_tier:n,domain_type:s,origin:t.origin,invite_flow_id:t.invite_flow_id,from:t.from,is_success:t.is_success})}},18533:(e,t,n)=>{n.d(t,{Z:()=>y});var o=n(67294),i=n(480),r=n(86628),s=n(68626),a=n(72126),l=n(91155),d=n(52275),c=n(31945),u=n(78140),p=n(32163),m=n(53437),f=n(72495),h=n(87279),v=n(61766),g=n(94166),x=n(85893);const y=function(e){let{icon:t,title:n,selectedKey:y,options:b,onChange:k,onClick:w,popupStyle:S,menuItemOptionsStyle:C,disabled:M,collectionContextStore:I,openButtonPopup:_}=e;window.__c={n:"CollectionSettingsPickListMenuItem"};const T=(0,i.Fy)(),F=b.find((e=>a.Xy(e.key,y))),j=(0,r.qz)(void 0,v.Z),R=(0,r.Kw)(j);return(0,o.useEffect)((()=>{I&&_&&(j.setState({...j.state,open:_}),I.settingsStore.setState({...I.settingsStore.state,openButtonPopup:void 0})),F||s.log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,l.Ui)("Selected key is invalid.")})})),(0,x.jsx)(c.ZP,{popupType:T.isMobile?m.kQ.SlideUp:m.kQ.Popup,alignmentToOrigin:c.vR.End,placementToOrigin:c.pO.Bottom,style:S,originGap:0,buttonPopupStore:j,disabled:M,onClick:w,renderOrigin:e=>(0,x.jsx)(g.Z,{title:n,showChevron:!0,right:null==F?void 0:F.title,rotateChevron:R.open,disabled:M,icon:t,...e}),render:e=>{let t;t=T.isMobile?{menuType:h.og.ActionSheet}:{menuType:h.og.Popup,width:250};const n=a.oA(b.map(((t,n)=>({key:n,render:e=>(0,x.jsx)(d.Z,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,body:t.body,style:C,checkState:a.Xy(t.key,y)}),action:()=>{k(t.key),e.close()}}))));return(0,x.jsx)(u.Z,{...t,children:(0,x.jsx)(p.Z,{type:p.i.Vertical,sections:[{key:0,render:e=>(0,x.jsx)(f.Z,{enableActionSheetTitle:!0,...e}),items:n}],initialFocus:0})})}})}},73657:(e,t,n)=>{n.d(t,{Z:()=>r});n(67294);var o=n(28992),i=n(85893);const r=function(e){return(0,i.jsx)(o.Z,{...e,style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...e.style}})}},66957:(e,t,n)=>{n.d(t,{Z:()=>u});var o=n(67294),i=n(480),r=n(86628),s=n(24405),a=n(87279),l=n(89728),d=n(85893);function c(e){let{tabs:t,selectedIndex:n,onChange:c,separatorIndexes:u,right:p,style:m,rightStyle:f,tabStyle:h,tabTitleStyle:v,tabBorderStyle:g,selectedTabStyle:x,readOnly:y,hideTabBorder:b}=e;window.__c={n:"TabBarMenuItem"};const k=(0,o.useContext)(a.Xp),{device:w,WindowSizeStore:S}=(0,i.O7)(),{safePaddingLeft:C,safePaddingRight:M}=(0,r.VK)((()=>({safePaddingLeft:S.getSafePaddingLeftCSS(16),safePaddingRight:S.getSafePaddingRightCSS(16)})),[S]),I=(0,s.yK)((e=>{const t={paddingTop:6,paddingBottom:6,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:e.mediumTextColor,...h},n=`inset 0 -1px 0 ${e.regularDividerColor}`,o=k.menuType===a.og.Popup,i={fontSize:16,paddingTop:2,paddingLeft:o?16:C,paddingRight:o?16:M,zIndex:2,height:44,background:e.popoverBackground};return{container:{overflowY:"visible",overflowX:"auto",display:"flex",width:"100%",position:"relative",boxShadow:b?void 0:n,...w.isMobile?i:{fontSize:14,paddingLeft:8,paddingRight:8,zIndex:1},...m},separator:{display:"inline-flex",alignItems:"center",margin:"0 4px",paddingBottom:4,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:e.regularDividerColor},mobile:{},tab:t,selectedTab:{...t,position:"relative",color:e.regularTextColor,...x},border:{borderBottom:`2px solid ${e.regularTextColor}`,position:"absolute",bottom:0,left:8,right:8,...g},rightContainer:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"flex-end",color:e.mediumTextColor,...f}}}),[k.menuType,w.isMobile,f,C,M,x,m,g,h,b]);return(0,d.jsxs)("div",{className:"hide-scrollbar",style:I.container,children:[t.map(((e,t)=>{const i=t===n;return(0,d.jsxs)(o.Fragment,{children:[(0,d.jsxs)("div",{style:i?I.selectedTab:I.tab,children:[(0,d.jsx)(l.Z,{style:v,onClick:()=>c(t),disabled:y,mobileFeedback:w.isMobile,children:e}),i&&(0,d.jsx)("div",{style:I.border})]},`tabButton-${t}`),u&&u.includes(t)&&(0,d.jsx)("div",{style:I.separator,className:"notranslate",children:"|"},`${t}-separator`)]},t)})),p&&(0,d.jsx)("div",{style:I.rightContainer,children:p})]})}const u=o.memo(c)},65668:(e,t,n)=>{n.d(t,{Z:()=>mt});n(57658);var o=n(67294),i=n(480),r=n(86628),s=n(24405),a=n(73717),l=n(50610),d=n(35102),c=n(66673),u=n(13148),p=n(54497),m=n(72126),f=n(149),h=n(70203),v=n(97880),g=n(82990),x=n(9291),y=n(98104),b=n(82530),k=n(37181),w=n(68657),S=n(33929),C=n(68056),M=n(18514),I=n(80444),_=n(24666),T=n(73063),F=n(3386),j=n(16354),R=n(74420),A=n(12396),E=n(84619),V=n(73110),B=n(89679),P=n(77097);const O={true:{name:"true",type:{type:"checkbox"},description:P.Gw.true,examples:[{input:"true"},{input:[(0,B.h0)("Checked"),[" == true"]]}]},false:{name:"false",type:{type:"checkbox"},description:P.Gw.false,examples:[{input:"false"},{input:[(0,B.h0)("Checked"),[" == false"]]}]},and:{name:"and",type:{type:"checkbox"},description:P.Gw.and,examples:[{input:"3 > 2 and 2 > 3",output:"false"},{input:[(0,B.h0)("Naughty"),[" && "],(0,B.h0)("Nice")]}]},or:{name:"or",type:{type:"checkbox"},description:P.Gw.or,examples:[{input:"3 > 2 or 2 > 3",output:"true"},{input:[(0,B.h0)("Naughty"),[" || "],(0,B.h0)("Nice")]}]},not:{name:"not",type:{type:"checkbox"},description:P.Gw.not,examples:[{input:"not true",output:"false"},{input:"not (2 > 3)",output:"true"},{input:[["!"],(0,B.h0)("Checked")]}]},"+":{name:"+",type:{type:"number"},description:P.Gw["+"],examples:[{input:"3 + 2",output:"5"},{input:"add(-1, 2)",output:"1"}]},"-":{name:"-",type:{type:"number"},description:P.Gw["-"],examples:[{input:"3 - 2",output:"1"},{input:"subtract(-1, 2)",output:"-3"}]},"*":{name:"*",type:{type:"number"},description:P.Gw["*"],examples:[{input:"3 * 2",output:"6"},{input:"multiply(-1, 2)",output:"-2"}]},"/":{name:"/",type:{type:"number"},description:P.Gw["/"],examples:[{input:"3 / 2",output:"1.5"},{input:"divide(-1, 2)",output:"-0.5"}]},"%":{name:"%",type:{type:"number"},description:P.Gw["%"],examples:[{input:"3 % 2",output:"1"},{input:"mod(-1, 2)",output:"-1"}]},"^":{name:"^",type:{type:"number"},description:P.Gw["^"],examples:[{input:"3 ^ 2",output:"9"},{input:"pow(-1, 2)",output:"1"}]},"==":{name:"==",type:{type:"checkbox"},description:P.Gw["=="],examples:[{input:"3 == 2",output:"false"},{input:'equal("A", "A")',output:"true"}]},"!=":{name:"!=",type:{type:"checkbox"},description:P.Gw["!="],examples:[{input:"3 != 2",output:"true"},{input:'unequal("A", "A")',output:"false"}]},">":{name:">",type:{type:"checkbox"},description:P.Gw[">"],examples:[{input:"3 > 2",output:"true"},{input:'now() > parseDate("2040-01-01")',output:"false"}]},"<":{name:"<",type:{type:"checkbox"},description:P.Gw["<"],examples:[{input:"3 < 2",output:"false"},{input:'now() < parseDate("2040-01-01")',output:"true"}]},">=":{name:">=",type:{type:"checkbox"},description:P.Gw[">="],examples:[{input:"3 >= 2",output:"true"},{input:'now() >= parseDate("2040-01-01")',output:"false"}]},"<=":{name:"<=",type:{type:"checkbox"},description:P.Gw["<="],examples:[{input:"3 <= 2",output:"false"},{input:'now() <= parseDate("2040-01-01")',output:"true"}]}};var N=n(75e3),D=n(56505),L=n(87279),U=n(29798),Z=n(73657),G=n(64921),K=n(52275),z=n(31945),W=n(78140),H=n(28992),$=n(32163),Q=n(40721),Y=n(72495),X=n(42875),q=n(75553),J=n(20852),ee=n(82883),te=n(44805),ne=n(893),oe=n(95477),ie=n(60682),re=n(24990),se=n(62619),ae=n(55227),le=n(77907),de=n(77080),ce=n(85893);const ue=o.memo((e=>{let{infoHelper:t,getRecordModel:n,style:o}=e;const i=t;if(void 0===(null==i?void 0:i.kind))return null;switch(i.kind){case V.x2.Token:return(0,ce.jsx)(fe,{completion:i,getRecordModel:n,style:o});case V.x2.LibraryFunction:{const e=!(null==t||!t.calledFromUnifiedFunctionProperty),r=function(e,t){if(t&&void 0!==e.syntax[1])return e.syntax[1];return e.syntax[0]}(i.libraryFunction,e),s=function(e,t){if(t&&void 0!==e.examples[1])return e.examples[1];return e.examples[0]}(i.libraryFunction,e),a=i.libraryFunction.returnType;return(0,ce.jsx)(me,{icon:Ce("function"==typeof a?a([]).type:a.type),name:r,description:S.default.formatMessage(i.libraryFunction.description),examples:s.length>0?s.map(((e,t)=>(0,ce.jsx)(pe,{example:e,getRecordModel:n},t))):void 0,style:o})}case V.x2.Binding:var r;return i.text===V.GV?(0,ce.jsx)(me,{icon:Ce(i.type.type),name:i.text,description:S.default.formatMessage(xe.currentValueDescription),style:o}):i.text===V.WY?(0,ce.jsx)(me,{icon:Ce(i.type.type),name:i.text,description:S.default.formatMessage(xe.currentIndexDescription),style:o}):(0,ce.jsx)(me,{icon:Ce(i.type.type),name:i.text,description:S.default.formatMessage("array"===(null==i||null===(r=i.type)||void 0===r?void 0:r.type)?xe.listVariableType:xe.variableType),style:o});case V.x2.Builtin:{const e=O[i.builtin];return(0,ce.jsx)(me,{icon:Ce(e.type.type),name:e.name,description:S.default.formatMessage(e.description),examples:e.examples.length>0?e.examples.map(((e,t)=>(0,ce.jsx)(pe,{example:e,getRecordModel:n},t))):void 0,style:o})}default:return(0,v.t1)(i)}}));function pe(e){let{example:t,getRecordModel:n}=e;window.__c={n:"CodeExample"};const a=(0,le.useDependency)(le.deps.prismjs),l=(0,ie.kw)(),d=(0,i.O7)(),{device:c}=d,u=(0,r.VK)((()=>{var e;return null===(e=I.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),p=(0,s.Fg)(),f=(0,x.useIntl)(),v=(0,r.VK)((()=>re.Z.state),[]),g=(0,r.VK)((()=>{var e;const o=document.createElement("div"),i="string"!=typeof t.input?h.QaF(t.input):t.input,r=(null===(e=a.value)||void 0===e?void 0:e.highlight(`${i}`,a.value.languages[J.PrismLanguages.notion],J.PrismLanguages.notion))??"";o.innerHTML=ae.g7(r);const s=m.oA(Array.from(o.childNodes).map(ve)),g="string"==typeof t.input?[[t.input],[" = "]]:t.input.concat([[" = "]]),x=ae.kF(g,m.oA(s)),y=g.map(h.hDy).map(((e,t)=>te.fn({annotations:e,theme:p,getRecordModel:n,spaceId:u})));return x.map(((e,t)=>{const o=y[e.textTokenIndex],i=g[e.textTokenIndex];return h.km_(i)?(0,te.$i)({args:{textValue:{value:g,spaceId:u},getRecordModel:n,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,X.r)(),disabled:!1,isAndroid:c.isAndroid,isSafariOrIOS:c.isSafari||c.isIOS,isWindows:c.isWindows,showEmojiInline:c.isWindows,emojiType:l,highlightDiscussionId:void 0,theme:p,intl:f,renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:oe.default.domainBaseUrl,publicDomainName:oe.default.publicDomainName,currentUserId:d.currentUser.id,overwriteBaseUrlFromSpaceId:void 0,externalIntegrations:[],formulaValueTypes:[],emojiData:v,isMobileNative:c.isMobileNative,isMobileNativeExternalLinkFixEnabled:de.default.checkGate("mobile_native_external_link_fix"),displayInUserTimezone:de.default.checkGate("display_date_in_user_timezone")},style:o.style,classNames:o.classNames,index:t,token:i,tokenValue:h.WiV(i),tokenAnnotations:h.hDy(i)}):(0,ce.jsx)("span",{className:[e.classNames||"",...o.classNames].join(" "),style:o.style,"data-token-index":e.textTokenIndex,children:e.value},t)}))}),[t.input,a.value,p,n,u,c.isAndroid,c.isSafari,c.isIOS,c.isWindows,c.isMobileNative,l,f,d.currentUser.id,v]),y=(0,r.VK)((()=>Array.isArray(t.output)?(0,te.IY)({textValue:{value:t.output,spaceId:u},getRecordModel:n,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,X.r)(),disabled:!1,isAndroid:c.isAndroid,isSafariOrIOS:c.isSafari||c.isIOS,isWindows:c.isWindows,showEmojiInline:c.isWindows,emojiType:l,theme:p,intl:f,katex:void 0,isClient:!0,baseUrl:oe.default.domainBaseUrl,publicDomainName:oe.default.publicDomainName,currentUserId:d.currentUser.id,overwriteBaseUrlFromSpaceId:void 0,externalIntegrations:[],formulaValueTypes:[],emojiData:v,isMobileNative:c.isMobileNative,isMobileNativeExternalLinkFixEnabled:de.default.checkGate("mobile_native_external_link_fix"),displayInUserTimezone:de.default.checkGate("display_date_in_user_timezone")}):t.output),[c.isAndroid,c.isIOS,c.isSafari,c.isWindows,c.isMobileNative,v,l,d.currentUser.id,t.output,n,f,u,p]),b=!1!==t.isCopyable&&("string"==typeof t.input||!0===t.isCopyable),k=(0,o.useCallback)((()=>{if(b){const e=(Array.isArray(t.input)?(0,ee.X)({intl:f,textValue:t.input,getRecordModel:n,userTimeZone:(0,X.r)()}):t.input).replaceAll(/\/\*.*\*\//g,"").trim();ne.RD({stringValue:e,environment:d,copiedMessage:ge.copiedExampleMessage})}}),[d,t.input,n,f,b]),w=(0,s.yK)((e=>({code:{fontFamily:"monospace",whiteSpaceCollapse:"preserve",fontSize:11,borderRadius:5,border:`1px solid ${e.stroke.deemphasized}`,margin:"0 -4px",padding:"0 6px",pointerEvents:"none",opacity:.95,display:"flex",flexDirection:"row",alignItems:"center",tabSize:2},left:{flexGrow:1,padding:"6px 0"},right:{alignSelf:"center"},copyButton:{height:22,width:22,pointerEvents:"auto"},copyButtonIcon:{height:12,width:12}})),[]);return(0,ce.jsxs)("div",{style:w.code,children:[(0,ce.jsxs)("div",{style:w.left,children:[(0,ce.jsx)("div",{children:g}),y?(0,ce.jsxs)("div",{children:["= ",y]}):null]}),b?(0,ce.jsx)("div",{style:w.right,children:(0,ce.jsx)(T.Z,{ariaLabel:f.formatMessage(ge.copyToClipboard),onClick:k,icon:q.U,style:w.copyButton,iconStyle:w.copyButtonIcon,disallowTabbing:!0})}):null]})}function me(e){let{name:t,icon:n,description:o,examples:i,style:r}=e;window.__c={n:"FormulaHelperBody"};const a=(0,s.yK)((e=>({helper:{display:"flex",flexDirection:"column",fontSize:12,height:"auto",width:"100%",gap:8,overflow:"auto",textWrap:"wrap",...r},name:{fontSize:14,fontWeight:600,display:"flex",alignItems:"center"},description:{color:e.mediumTextColor},iconStyle:{height:14,width:14,fill:e.mediumIconColor,display:"inline",marginRight:6},divider:{borderColor:e.stroke.deemphasized},examples:{display:"flex",flexDirection:"column",gap:4}})),[r]);return(0,ce.jsxs)("div",{style:a.helper,children:[(0,ce.jsxs)("span",{style:a.name,children:[void 0!==n&&n(a.iconStyle),t]}),void 0!==o&&(0,ce.jsx)("span",{style:a.description,children:o}),void 0!==i&&(0,ce.jsx)("div",{style:a.examples,children:i})]})}function fe(e){let{completion:t,getRecordModel:n,style:o}=e;window.__c={n:"FormulaTokenCompletionHelper"};const{name:i,description:s,icon:a,examples:l}=(0,r.VK)((()=>{if(!n)return{};if(t.token.type===V.Oy.BlockProperty){var e;if(V.WG.includes(t.token.property)&&!t.token.collection){var o;const e=null===(o=V.dy[t.token.property])||void 0===o?void 0:o.type,i=e?A.wG[e]:void 0,r=B.QP[t.token.property],s="function"==typeof(null==r?void 0:r.description)?r.description():null==r?void 0:r.description,a=t.name??t.token.property;return{name:a,icon:i,description:s?S.default.formatMessage(s):void 0,examples:null!==r?he(r,n,{collection:t.token.collection,property:t.token.property,name:a},{name:a,type:t.token.property}):void 0}}if(!t.token.collection)return{};const i=(0,d.SR)(t.token.property),r=n(t.token.collection),s=null==r||null===(e=r.getNormalizedSchema())||void 0===e?void 0:e[i];if(!s)return{};const a=B.QP[s.type];return a?{name:t.name,icon:A.wG[s.type],description:S.default.formatMessage("function"==typeof a.description?a.description(s):a.description),examples:he(a,n,{collection:t.token.collection,property:i,name:t.name},s)}:{}}return{}}),[t,n]);return void 0===i?null:(0,ce.jsx)(me,{name:i,icon:a,description:s,examples:l,style:o})}function he(e,t,n,o){const i=e.examples;let r=[];return r="function"==typeof i?i(n,o).map(((e,n)=>(0,ce.jsx)(pe,{example:e,getRecordModel:t},n))):i.map(((e,n)=>(0,ce.jsx)(pe,{example:e,getRecordModel:t},n))),r.length>0?r:void 0}function ve(e){return se.Gs(e)?[e.data]:se.kK(e)?[e.textContent||"",e.className]:void 0}const ge=(0,x.defineMessages)({codeExamples:{id:"formula2Input.helperText.codeExamples",defaultMessage:"Examples"},copiedExampleMessage:{id:"formula2Input.helperText.copiedExampleMessage",defaultMessage:"Copied example to clipboard!"},copyToClipboard:{defaultMessage:"Copy to Clipboard",id:"database.copyButton.copyToClipboard"}}),xe=(0,x.defineMessages)({currentValueDescription:{id:"formula2Input.helperText.currentValueDescription",defaultMessage:"Returns the value of the current item in the list function."},currentIndexDescription:{id:"formula2Input.helperText.currentIndexDescription",defaultMessage:"Returns the index of the current item in the list function, starting from 0."},variableType:{id:"formula2Input.variableHelper.description",defaultMessage:"User-defined variable."},listVariableType:{id:"formula2Input.variableHelper.descriptionWithList",defaultMessage:"User-defined variable, list."},emailForUser:{id:"formula2Input.helperText.emailForUser",defaultMessage:"Returns the email address of a provided user."},nameForUser:{id:"formula2Input.helperText.nameForUser",defaultMessage:"Returns the display name of a provided user."}});var ye=n(21396);function be(e){window.__c={n:"FormulaAutocompleteMenu"};const{store:t,selection:n,cursorEditorInfo:a,cursorEditorInfoRef:l,context:c,onChange:u,getRecordModel:p,setInfoHelper:f}=e,g=(0,s.yK)((()=>({menu:{top:0,left:0,right:0,bottom:0,position:"absolute",marginBottom:2},menuSection:{paddingTop:6,paddingBottom:2}})),[]),x=(0,i.Fy)(),y=(0,r.qz)(void 0,U.Z),b=(0,o.useMemo)((()=>{const e=m.vM((null==a?void 0:a.completions)??[],"kind");let o=-1;return Object.entries(e).map(((e,i)=>{const[r,s]=e,a=s.map(((e,r)=>{o+=1;const s=o;return{key:`${i}-${r}`,render:t=>(0,ce.jsx)(ke,{...t,completion:e,context:c,getRecordModel:p,menuListStore:y,indexGlobal:s,cursorEditorInfoRef:l,setInfoHelper:f}),action:()=>{var o;void 0!==e&&l.current&&(f({...e,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(o=l.current.completionsInfo)||void 0===o?void 0:o.type)}),function(e){var t;const{completion:n,store:o,selection:i,onChange:r,cursorEditorInfo:s}=e,a=(null==i?void 0:i.startIndex)||0,l=(null==i?void 0:i.endIndex)||0,c=a!==l,u=(null===(t=s.completionsInfo)||void 0===t?void 0:t.prefix)||"",p="overridePrefixLength"in n?n.overridePrefixLength??0:u.length,m=c?a:l-p,f=o.getValue();if(n.kind===V.x2.Token){if(n.token.type===V.Oy.Checkbox)return;if(n.token.type===V.Oy.BlockProperty){const e=(0,h._QS)(f,m,l),t=n.token.collection?(0,d.SR)(n.token.property):n.token.property,o=(0,h.YCD)((0,h.kbv)({collection:n.token.collection,property:t,name:n.name}));return void r({newValue:(0,h.P$X)(e,[o],m),newSelection:{startIndex:m+1,endIndex:m+1}})}if(n.token.type===V.Oy.ContextValue){const e=(0,h._QS)(f,m,l),t=(0,d.Kv)(n.token.valueId),o=(0,h.YCD)((0,h._QF)({id:t}));r({newValue:(0,h.P$X)(e,[o],m),newSelection:{startIndex:m+1,endIndex:m+1}})}else{if(n.token.type===V.Oy.Date||n.token.type===V.Oy.Block||n.token.type===V.Oy.Person)return;(0,v.t1)(n.token)}}else if(n.kind===V.x2.LibraryFunction){var g,x,y,b;const e=(0,h._QS)(f,m,l),t=(0,h.V3y)(`${n.libraryFunction.name}()`,[]),o=(0,h.P$X)(e,[t],m);let i=m+n.libraryFunction.name.length+1;void 0!==(null===(g=n.libraryFunction)||void 0===g||null===(g=g.parameters)||void 0===g?void 0:g.varargs)||null!==(x=n.libraryFunction)&&void 0!==x&&null!==(x=x.parameters)&&void 0!==x&&null!==(x=x.expected)&&void 0!==x&&x.length&&(1!==(null===(y=n.libraryFunction)||void 0===y||null===(y=y.parameters)||void 0===y||null===(y=y.expected)||void 0===y?void 0:y.length)||"member dot receiver"!==(null===(b=s.completionsInfo)||void 0===b?void 0:b.type))||(i+=1);r({newValue:o,newSelection:{startIndex:i,endIndex:i}})}else if(n.kind===V.x2.Binding||n.kind===V.x2.Builtin){const e=(0,h._QS)(f,m,l),t=n.kind===V.x2.Binding?n.text:`${n.builtin} `,o=(0,h.V3y)(t,[]),i=(0,h.P$X)(e,[o],m),s=m+t.length;r({newValue:i,newSelection:{startIndex:s,endIndex:s}})}else(0,v.t1)(n)}({completion:e,store:t,selection:n,onChange:u,cursorEditorInfo:l.current}))}}}));return{key:r,render:e=>(0,ce.jsx)(Y.Z,{...e,style:g.menuSection,title:S.default.formatMessage(_e[r])}),items:a}}))}),[c,null==a?void 0:a.completions,l,p,y,u,n,f,t,g.menuSection]),k=(0,o.useCallback)((e=>{var t;if(x.isMobile)return;const n=void 0!==e.indexGlobal?null===(t=l.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[e.indexGlobal]:void 0;var o;n&&f({...n,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(o=l.current)||void 0===o||null===(o=o.completionsInfo)||void 0===o?void 0:o.type)})}),[l,x.isMobile,f]);let w;return(0,o.useEffect)((()=>{if(x.isMobile)return;const e=e=>{var t,n;if(void 0!==e.state.focus.indexGlobal&&null!==(t=l.current)&&void 0!==t&&t.completions&&(null===(n=l.current)||void 0===n?void 0:n.completions.length)>0){var o;const t=null===(o=l.current)||void 0===o||null===(o=o.completions)||void 0===o?void 0:o[e.state.focus.indexGlobal];void 0!==t&&f((e=>{var n;return void 0===e||void 0===(null===(n=l.current)||void 0===n?void 0:n.callParameter)?t:e}))}};return y.addListener(e),()=>y.removeListener(e)}),[l,y,f,x.isMobile]),(0,o.useEffect)((()=>{var e,t,n,o;if(x.isMobile)return;const i="function"===(null==a||null===(e=a.callParameter)||void 0===e||null===(e=e.expression)||void 0===e||null===(e=e.type)||void 0===e?void 0:e.type)?null===(t=a.callParameter.expression)||void 0===t?void 0:t.type:void 0;void 0!==i&&void 0!==(null==a||null===(n=a.callParameter)||void 0===n?void 0:n.parameterIndex)&&(null==a||null===(o=a.callParameter)||void 0===o?void 0:o.parameterIndex)>-1&&f({kind:V.x2.LibraryFunction,libraryFunction:i.libraryFunction,calledFromUnifiedFunctionProperty:i.calledFromUnifiedFunctionProperty})}),[null==a?void 0:a.callParameter,x.isMobile,f]),(0,o.useEffect)((()=>{b.length>0&&y.update((e=>({focus:{...e,section:0,indexLocal:0,indexGlobal:0}})))}),[b.length,y,f]),w=x.isPhone?{menuType:L.og.ActionSheet,disableBottomPadding:!0,maxHeight:"100%"}:{menuType:L.og.Popup,width:x.isPhone?180:228,minWidth:x.isPhone?180:228,maxWidth:x.isPhone?180:228},(0,ce.jsx)(W.Z,{...w,scrollerStyle:g.menu,children:(0,ce.jsx)($.Z,{type:$.i.Vertical,initialFocus:0,priority:1,store:y,onKeyboardArrow:k,sections:m.oA([...b,0===b.length&&{key:"no-results",render:e=>(0,ce.jsx)(Y.Z,{...e,disableDesktopPadding:!0,style:g.menuSection,children:(0,ce.jsx)(Me,{})}),items:[]}])})})}const ke=o.forwardRef(((e,t)=>{window.__c={n:"CompletionMenuItem"};const{completion:n,context:a,getRecordModel:l,menuListStore:c,indexGlobal:u,cursorEditorInfoRef:p,setInfoHelper:m,onMouseEnter:f,...h}=e,g=(0,i.Fy)(),y=(0,s.yK)((e=>({icon:{width:14,fill:e.mediumIconColor},lightParens:{color:e.lightTextColor}})),[]),b=(0,o.useCallback)((e=>{if(!g.isMobile){var t;const e=null===(t=p.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[u];m(e)}null==f||f(e)}),[p,u,f,m,g.isMobile]),k=(0,r.VK)((()=>c.state.focus.indexGlobal===u),[c,u]),w=(0,o.useMemo)((()=>g.isMobile?(0,ce.jsx)(z.ZP,{popupType:z.Z4.SlideUp,renderOrigin:e=>(0,ce.jsx)(G.Z,{mobileFeedback:!0,style:{width:16,height:16},...e,children:(0,D.S)(y.icon)}),render:e=>{var t;let o;return o=g.isMobile?{menuType:L.og.Modal,title:(0,ce.jsx)(x.FormattedMessage,{defaultMessage:"Documentation",id:"database.formulaPropertyEntryMenuItem.title"}),right:(0,ce.jsx)(Q.DoneMenuText,{}),onClickRight:e.close}:{menuType:L.og.Popup},(0,ce.jsx)(W.Z,{...o,children:(0,ce.jsx)(Y.Z,{children:(0,ce.jsx)(H.Z,{title:(0,ce.jsx)(ue,{infoHelper:{...n,calledFromUnifiedFunctionProperty:"member dot receiver"===(null==p||null===(t=p.current)||void 0===t||null===(t=t.completionsInfo)||void 0===t?void 0:t.type)},getRecordModel:l,style:{padding:4}}),style:{paddingTop:16,paddingBottom:16}})})})}}):(0,ce.jsx)(we,{visible:k})),[n,p,g.isMobile,l,k,y.icon]),S=(0,r.VK)((()=>{var e;if(n.kind!==V.x2.Token||n.token.type!==V.Oy.BlockProperty||!l)return;if(V.WG.includes(n.token.property))return n.token.property;if(!n.token.collection)return;const t=(0,d.SR)(n.token.property),o=l(n.token.collection);return null==o||null===(e=o.getNormalizedSchema())||void 0===e||null===(e=e[t])||void 0===e?void 0:e.type}),[n,l]);if(n.kind===V.x2.Token){if(n.token.type===V.Oy.Checkbox)return null;if(n.token.type===V.Oy.BlockProperty)return(0,ce.jsx)(K.Z,{...h,icon:S?A.wG[S](y.icon):(0,ce.jsx)(Se,{type:"unknown"}),title:n.name??n.token.property,right:w,onMouseEnter:b,ref:t});if(n.token.type===V.Oy.ContextValue){const e=(0,d.vx)(a.valueTypes,(0,d.Kv)(n.token.valueId));return e?(0,ce.jsx)(K.Z,{...h,icon:(0,ce.jsx)(Se,{type:e.type.type}),title:(0,ce.jsx)("div",{style:{display:"flex"},children:(0,ce.jsx)(ye.F,{value:e,format:E.lo.Medium,isSingle:!0,shouldShrink:!0})}),right:w,onMouseEnter:b,ref:t}):null}if(n.token.type===V.Oy.Date)return null;if(n.token.type===V.Oy.Block)return null;if(n.token.type===V.Oy.Person)return null;(0,v.t1)(n.token)}else{if(n.kind===V.x2.LibraryFunction){const e=n.libraryFunction.returnType;return(0,ce.jsx)(K.Z,{...h,icon:(0,ce.jsx)(Se,{type:"function"==typeof e?e([]).type:e.type}),title:(0,ce.jsxs)(ce.Fragment,{children:[n.libraryFunction.name,(0,ce.jsx)("span",{style:y.lightParens,children:"()"})]}),right:w,onMouseEnter:b,ref:t})}if(n.kind===V.x2.Builtin)return(0,ce.jsx)(K.Z,{...h,title:n.builtin,icon:(0,ce.jsx)(Se,{type:O[n.builtin].type.type}),right:w,onMouseEnter:b,ref:t});if(n.kind===V.x2.Binding)return(0,ce.jsx)(K.Z,{...h,title:n.text,icon:(0,ce.jsx)(Se,{type:n.type.type}),right:w,onMouseEnter:b,ref:t});(0,v.t1)(n)}})),we=o.memo((e=>{let{visible:t}=e;window.__c={n:"FormulaAutocompleteEnterIcon"};const n=(0,s.yK)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"opacity 50ms 200ms",visibility:t?"visible":"hidden",opacity:t?1:0}})),[t]);return(0,N.U)(n.icon)})),Se=o.memo((e=>{var t;let{type:n}=e;window.__c={n:"FormulaValueTypeIcon"};const o=(0,s.yK)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"transform .3s ease"}})),[]);return null===(t=Ce(n))||void 0===t?void 0:t(o.icon)}));function Ce(e){return"text"===e?A.wG.text:"number"===e?A.wG.number:"checkbox"===e?A.wG.checkbox:"date"===e?A.wG.date:"block"===e?A.wG.relation:"person"===e?A.wG.person:"select"===e?A.wG.select:"array"===e?A.wG.multi_select:"function"===e||void 0===e||"unknown"===e?A.wG.formula:void(0,v.t1)(e)}function Me(){return(0,ce.jsx)(Z.Z,{caption:(0,ce.jsx)(x.FormattedMessage,{defaultMessage:"No results",id:"FormulaAutocompleteMenu.noResults.message"})})}const Ie=(0,x.defineMessages)({[V.x2.Token]:{defaultMessage:"Properties",id:"formulaAutocompleteMenu.token.message"},[V.x2.LibraryFunction]:{defaultMessage:"Functions",id:"formulaAutocompleteMenu.function.message"},[V.x2.Binding]:{defaultMessage:"Variables",id:"formulaAutocompleteMenu.variables.message"},[V.x2.Builtin]:{defaultMessage:"Built-ins",id:"formulaAutocompleteMenu.builtin.message"}}),_e={[V.x2.Token]:Ie[V.x2.Token],[V.x2.LibraryFunction]:Ie[V.x2.LibraryFunction],[V.x2.Binding]:Ie[V.x2.Binding],[V.x2.Builtin]:Ie[V.x2.Builtin]};var Te=n(37652),Fe=n(84169),je=n(62134),Re=n(42922),Ae=n(89728),Ee=n(26388);const Ve={alignSelf:"right",marginRight:4,height:24,padding:"0 8px"},Be=(0,x.defineMessages)({accept:{defaultMessage:"Accept",id:"database.formula.acceptFormulaInput.tooltip"},back:{defaultMessage:"Back",id:"formulas.SimpleFormulaValuePicker.back"},close:{id:"formula2Input.close",defaultMessage:"Close"},done:{id:"formula2Input.done",defaultMessage:"Done"},formulaHeader:{id:"formula2Input.NotionFormula",defaultMessage:"Notion Formula"},learnTooltip:{id:"formula2Input.learnAboutFormulas",defaultMessage:"Learn about formulas!"},revert:{id:"formula2Input.revert",defaultMessage:"Revert"},revertTooltip:{id:"formula2Input.revertTooltip",defaultMessage:"Revert to previous formula"}}),Pe=o.memo((e=>{window.__c={n:"FormulaInputHeader"};const{onClickBack:t,onClickClose:n,onClickRevert:o,showRevert:i,disabled:r}=e,a=(0,s.yK)((e=>({headerRow:{display:"flex",color:e.mediumTextColor,flexDirection:"row",padding:"8px 2px 6px 12px",flexWrap:"wrap",fontWeight:500},headerLeft:{flexGrow:1,fontSize:14,display:"inline-flex",alignItems:"center"}})),[]);return(0,ce.jsxs)("span",{style:a.headerRow,children:[(0,ce.jsx)("span",{style:a.headerLeft,children:t?(0,ce.jsx)(Oe,{onClick:t}):(0,ce.jsx)(Le,{})}),i?(0,ce.jsx)(Ue,{onClick:o}):null,r?(0,ce.jsx)(Ne,{onClick:n}):(0,ce.jsx)(De,{onClick:n})]})}));function Oe(e){window.__c={n:"BackButton"};const{onClick:t}=e,n=(0,x.useIntl)();return(0,ce.jsx)(Ae.Z,{isGray:!0,isSmall:!0,icon:Te.V,onClick:t,children:n.formatMessage(Be.back)})}function Ne(e){window.__c={n:"CloseButton"};const{onClick:t}=e,n=(0,x.useIntl)();return(0,ce.jsx)(Re.Z,{onClick:t,style:Ve,children:n.formatMessage(Be.close)})}function De(e){window.__c={n:"DoneButton"};const{onClick:t}=e,n=(0,i.O7)(),o=(0,x.useIntl)(),r=(0,s.yK)((e=>({commandText:{color:e.mediumInvertedTextColor}})),[]);return(0,ce.jsx)(Ee.ZP,{renderTooltip:()=>(0,ce.jsxs)("div",{children:[(0,ce.jsx)("span",{children:o.formatMessage(Be.accept)})," ",(0,ce.jsxs)("span",{style:r.commandText,children:[je.fg(n).command,"+Enter"]})]}),render:e=>(0,ce.jsx)(Re.Z,{onClick:t,style:Ve,...e,children:o.formatMessage(Be.done)})})}function Le(){window.__c={n:"Title"};const e=(0,x.useIntl)(),t=(0,s.yK)((()=>({headerTitle:{fontSize:12,display:"flex",alignItems:"center"},helpButton:{marginLeft:2,height:20,width:20}})),[]);return(0,ce.jsxs)("span",{style:t.headerTitle,children:[e.formatMessage(Be.formulaHeader),(0,ce.jsx)(Ee.ZP,{placement:Ee.ug.Top,render:n=>(0,ce.jsx)(T.Z,{...n,ariaLabel:e.formatMessage(Be.learnTooltip),icon:Fe.m,href:(0,M.UY)("guides.formulas"),external:!0,style:t.helpButton}),renderTooltip:()=>e.formatMessage(Be.learnTooltip)})]})}function Ue(e){window.__c={n:"RevertButton"};const{onClick:t}=e,n=(0,x.useIntl)(),o=(0,s.yK)((e=>({revertButton:{marginLeft:4,marginRight:4,color:e.mediumIconColor}})),[]);return(0,ce.jsx)(Ee.ZP,{placement:Ee.ug.Top,render:e=>(0,ce.jsx)(Ae.Z,{...e,"aria-label":n.formatMessage(Be.revertTooltip),isGray:!0,isSmall:!0,style:o.revertButton,onClick:t,children:n.formatMessage(Be.revert)}),renderTooltip:()=>n.formatMessage(Be.revertTooltip)})}n(52262),n(24506);var Ze=n(83355),Ge=n(1302),Ke=n(13991),ze=n(14577),We=n(15095),He=n(62193),$e=n(6746),Qe=n(52423),Ye=n(993),Xe=n(56971),qe=n(14976),Je=n(45023),et=n(70219),tt=n(89086),nt=n(30874),ot=n(29595),it=n(1743),rt=n(93262);const st={flexGrow:1,flexShrink:1,textAlign:"left",fontFamily:g.Z.getCompositeFontFamily(Ke.SP).githubMono,fontSize:12,tabSize:2,whiteSpace:"pre-wrap",borderRadius:4,minHeight:"1em",height:"100%",wordBreak:"break-all",paddingLeft:12,paddingRight:13,paddingBottom:10};class at extends Ze.Z{constructor(){super(...arguments),this.editor=null,this.mergeEditorRefs=(0,He.sH)(),this.renderContentContainer=(e,t)=>{let{leafRef:n,wrapperRef:i,...r}=e;const{device:s}=this.environment;return(0,ce.jsx)("div",{ref:i,...r,onKeyDown:e=>{!function(e,t,n){(0,Je.Z)(n,e,"command+enter")&&(t(),e.stopPropagation())}(e,this.props.handleSave,this.environment),null==r||r.onKeyDown(e)},style:{flexGrow:1,display:"table"},children:(0,ce.jsx)(ot.Z,{ref:this.mergeEditorRefs(this.editorRef,n),style:st,getDisabled:()=>this.props.disabled,getHtml:()=>function(e,t,n,i,r,s,a,l,d,c,u,p,f){const v=h.QaF(e),g="notion",x=n.languages[g],y=document.createElement("div"),b=n.highlight(v,x,g);y.innerHTML=ae.g7(b);const k=m.oA(Array.from(y.childNodes).map(dt));for(const o of t)e=h.aSf({textValue:e,selection:o,annotation:[h.GKr.FormulaError]});const w=function(e){let{syntaxTokens:t,textValue:n,store:o,parentSpaceId:i,valueTypes:r,theme:s,isAndroid:a,isSafariOrIOS:l,isWindows:d,isMobileNative:c,currentUserId:u,overwriteBaseUrlFromSpaceId:p}=e;const m=ae.kF(n,t),f=n.map(h.hDy).map(((e,t)=>te.fn({annotations:e,theme:s,getRecordModel:o.getRecordModel,spaceId:i})));return m.map(((e,t)=>{const m=n[e.textTokenIndex],v=f[e.textTokenIndex];return h.km_(m)?(0,te.$i)({args:{textValue:{value:n,spaceId:i},getRecordModel:o.getRecordModel,getRecordRole:o.getRecordRole,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,X.r)(),disabled:!1,isAndroid:a,isSafariOrIOS:l,isWindows:d,showEmojiInline:d,emojiType:"raw",highlightDiscussionId:void 0,theme:s,intl:S.default.getIntl(),renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:oe.default.domainBaseUrl,publicDomainName:oe.default.publicDomainName,currentUserId:u,overwriteBaseUrlFromSpaceId:p,externalIntegrations:nt.Z.integrations.state,formulaValueTypes:r,emojiData:re.Z.state,isMobileNative:c,isMobileNativeExternalLinkFixEnabled:de.default.checkGate("mobile_native_external_link_fix"),displayInUserTimezone:de.default.checkGate("display_date_in_user_timezone")},style:v.style,classNames:v.classNames,index:t,token:m,tokenValue:h.WiV(m),tokenAnnotations:h.hDy(m)}):(0,ce.jsx)("span",{className:[e.classNames||"",...v.classNames].join(" "),style:v.style,"data-token-index":e.textTokenIndex,children:e.value},t)}))}({store:i,parentSpaceId:r,valueTypes:s,syntaxTokens:m.oA(k),textValue:e||[],theme:a,isAndroid:l,isSafariOrIOS:d,isWindows:c,isMobileNative:u,overwriteBaseUrlFromSpaceId:p,currentUserId:f}),C=(0,ce.jsxs)(o.Fragment,{children:[w,(0,ce.jsx)("span",{children:"\n"})]});return $e.Z.renderToStaticMarkup(C)}(this.textValueStore.state,this.props.errorRanges,this.props.Prism,this.props.store,this.props.parentSpaceId,this.props.valueTypes,this.theme,s.isAndroid,s.isSafari||s.isIOS,s.isWindows,s.isMobileNative,(0,et.b)(this.environment),this.environment.currentUser.id),getSelection:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_getContainerSelection,onMutation:e=>function(e,t,n){const{newValue:o}=e;b.createAndCommit({userAction:"FormulaInputText.handleMutation",environment:n,perform:e=>{Ye.aS({environment:n,store:t,newValue:o,disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableDateReminderMentions:!0,disableFilters:!0,transaction:e}),e.postEnqueueActions.push((()=>{b.createAndCommit({userAction:"FormulaInputText.normalizeTextValue",environment:n,perform:e=>{Ye.vE({store:t,transaction:e})}})}))}})}(e,this.props.store,this.environment),spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,suppressNewlineEvents:!1,placeholder:" "})})},this.handleClick=e=>{qe.SD({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.props.disabled})},this.handleDelete=e=>{if(this.props.disabled)return;const t=_.default.state;"editing"===t.mode&&t.multiSelection.start.store===this.props.store&&(b.createAndCommit({userAction:"FormulaInputText.handleDelete",environment:this.environment,perform:n=>{Xe.as({environment:this.environment,multiSelection:t.multiSelection,deleteForwards:!0,transaction:n,event:e})}}),this.scrollSelectionIntoView())},this.handleBackspace=e=>{if(this.props.disabled)return;const t=_.default.state;if("editing"===t.mode&&t.multiSelection.start.store===this.props.store){if(Xe.YV({device:this.environment.device,event:e,multiSelection:t.multiSelection}))return;b.createAndCommit({userAction:"FormulaInputText.handleBackspace",environment:this.environment,perform:n=>{Xe.as({environment:this.environment,multiSelection:t.multiSelection,deleteForwards:!1,transaction:n,event:e})}}),this.scrollSelectionIntoView()}},this.handleShiftEnter=e=>{var t,n,o;if(this.props.disabled)return;if(null===(t=e.preventDefault)||void 0===t||t.call(e),this.editor&&this.editor.isComposing)return;const i=_.default.state,r="editing"===i.mode&&(0,C.QY)(i.multiSelection);if(!r)return;const s=this.textValueStore.state,a=We.p4(h.QaF(s)),l=null===(n=a.slice(0,r.selection.startIndex).join("").split("\n"))||void 0===n?void 0:n.at(-1),d=(null==l||null===(o=l.match(/^\t*/))||void 0===o?void 0:o[0].length)||0,c=(null==l?void 0:l.split("").reverse())||[];let u=0;const p=c.some((e=>{if(")"===e)u++;else if("("===e){if(0===u)return!0;u--}return!1}))?d+1:d;let m="\t".repeat(p);const f=")"===a[r.selection.endIndex],v=!(null==l||!l.endsWith("("))&&f;v&&(m+=`\n${"\t".repeat(p-1)}`),b.createAndCommit({userAction:"FormulaInputText.handleShiftEnter",environment:this.environment,perform:e=>{Ye.hJ({environment:this.environment,store:this.props.store,string:`\n${m}`,selection:r.selection,disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e}),v&&y.Z5({store:this.props.store,selection:{startIndex:r.selection.startIndex+p+1,endIndex:r.selection.startIndex+p+1}})}}),this.scrollSelectionIntoView()},this.handleCopy=e=>{var t;const{markdownLinkifyIt:n}=this.props,o=window.getSelection();null!=o&&o.anchorNode&&null!==(t=this.editor)&&void 0!==t&&null!==(t=t.getNode())&&void 0!==t&&t.contains(o.anchorNode)&&ne.JG({environment:this.environment,event:e,markdownLinkifyIt:n})},this.handleCut=e=>{const{markdownLinkifyIt:t}=this.props;this.props.disabled?e.preventDefault():(ne.by({environment:this.environment,event:e,markdownLinkifyIt:t}),this.scrollSelectionIntoView())},this.handlePaste=e=>{const{markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:n}=this.props;this.props.disabled?e.preventDefault():(b.createAndCommit({userAction:"FormulaInputText.handlePaste",environment:this.environment,perform:o=>{ne.v({environment:this.environment,event:e,disableEmbedMenu:!0,transaction:o,onPasteFiles:ne.AL,markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:n})}}),this.scrollSelectionIntoView())},this.handleMouseOver=e=>{qe.vO({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.props.disabled})},this.handleMouseOut=e=>{qe.kV({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.props.disabled})},this.scrollSelectionIntoView=()=>{const e=window.getSelection();null!=e&&e.rangeCount&&Ge.default.afterNextFlush((()=>{var t;const n=e.getRangeAt(0).getClientRects()[0],o=null===(t=this.editor)||void 0===t||null===(t=t.getNode())||void 0===t||null===(t=t.parentElement)||void 0===t?void 0:t.parentElement,i=null==o?void 0:o.getBoundingClientRect();n&&o&&i&&(i.top>=n.top?o.scrollTo({top:o.scrollTop+(n.top-i.top)-6}):i.bottom<=n.bottom+n.height&&o.scrollTo({top:o.scrollTop+(n.bottom-i.bottom)+28}))}))},this.clearBrowserSelection=()=>{var e;null===(e=this.getEditorNode())||void 0===e||e.blur()},this.textValueStore=new ze.Z((()=>this.props.store.getValue()||[]),{debugName:"FormulaInputText.textValueStore"}),this.isEditing=this.createComputedStore((()=>{var e;const t=_.default.state;return"editing"===t.mode&&(null===(e=(0,C.QY)(t.multiSelection))||void 0===e?void 0:e.store)===this.props.store})),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_getContainerSelection=()=>function(e,t){if(t.state)return(0,tt.HE)(e)}(this.props.store,this.isEditing),this.getEndSelection=()=>{const e=We.p4(h.QaF(this.textValueStore.state));return{startIndex:e.length,endIndex:e.length}},this.editorRef=e=>{this.editor=e}}UNSAFE_willMount(e){e.focus&&y.NX({store:e.store})}renderComponent(){const{store:e,disabled:t,handleSave:n}=this.props;return(0,ce.jsx)(it.Z,{debugName:"FormulaInputText",capture:!0,allowEnter:!0,allowTabUntab:!0,allowUndo:!0,allowEsc:!0,allowCopyPaste:!0,children:(0,ce.jsx)(rt.Z,{store:e,disabled:t,clearBrowserSelection:this.clearBrowserSelection,getEndSelection:this.getEndSelection,onClick:this.handleClick,onDelete:this.handleDelete,onBackspace:this.handleBackspace,onShiftEnter:this.handleShiftEnter,onCommandShiftEnter:m.yR,onTab:e=>function(e,t,n,o){if(t)return;e.preventDefault();const i=_.default.state,r="editing"===i.mode&&(0,C.QY)(i.multiSelection);r&&b.createAndCommit({userAction:"FormulaInputText.handleTab",environment:o,perform:e=>{Ye.wA({environment:o,store:n,selection:r.selection,transaction:e,shouldStripTokens:!1,disableFilters:!0})}})}(e,this.props.disabled,this.props.store,this.environment),onUntab:e=>function(e,t,n,o){if(t)return;e.preventDefault();const i=_.default.state,r="editing"===i.mode&&(0,C.QY)(i.multiSelection);r&&b.createAndCommit({userAction:"FormulaInputText.handleUntab",environment:o,perform:e=>{Ye.O5({environment:o,store:n,selection:r.selection,transaction:e,shouldStripTokens:!1,disableFilters:!0})}})}(e,this.props.disabled,this.props.store,this.environment),onToggleBold:e=>ct(e,this.props.disabled),onToggleItalics:e=>ct(e,this.props.disabled),onToggleUnderline:e=>ct(e,this.props.disabled),onToggleStrike:e=>ct(e,this.props.disabled),onToggleCode:m.yR,onCopy:this.handleCopy,onCut:this.handleCut,onPaste:this.handlePaste,onMoveUp:e=>{return t=this.environment,void b.createAndCommit({userAction:"FormulaInputText.handleMoveUp",environment:t,perform:e=>{Ye.fs({environment:t,transaction:e,direction:"up"})}});var t},onMoveDown:e=>{return t=this.environment,void b.createAndCommit({userAction:"FormulaInputText.handleMoveDown",environment:t,perform:e=>{Ye.fs({environment:t,transaction:e,direction:"down"})}});var t},onUndo:e=>function(e,t,n){var o;e.preventDefault();const i=Qe.XT();(null==i||null===(o=i.getFirstStore())||void 0===o?void 0:o.id)===t.id&&Qe.Yw(n)}(e,this.props.store,this.environment),onRedo:e=>function(e,t,n){var o;e.preventDefault();const i=Qe.M7();(null==i||null===(o=i.getFirstStore())||void 0===o?void 0:o.id)===t.id&&Qe.KX(n)}(e,this.props.store,this.environment),onEsc:n,render:this.renderContentContainer,disableStyleAnnotations:!0,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!1,canInsertText:!0,canSelectionDrag:!0,disableMobileActionBar:!0,topBottomPadding:40,pasteBehavior:"inline"})})}getEditorNode(){var e;return(null===(e=this.editor)||void 0===e?void 0:e.getNode())||void 0}}function lt(e){window.__c={n:"FormulaInputTextWithDeps"};const{value:t}=(0,le.useDependency)(le.deps.prismjs),{value:n}=(0,le.useDependency)(le.deps.markdownLinkifyIt),{value:o}=(0,le.useDependency)(le.deps.tinyMceMicrosoftWordPasteFilter);return t?(0,ce.jsx)(at,{...e,Prism:t,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}):null}function dt(e){return se.Gs(e)?[e.data]:se.kK(e)?[e.textContent||"",e.className]:void 0}function ct(e,t){t||e.preventDefault()}at.displayName="FormulaInputText";const ut=!1,pt=400;function mt(e){window.__c={n:"FormulaInput"};const{evaluationErrors:t,initialCode:n,parentSpaceId:u,outputFooter:p,disabled:g,typecheckContext:b,formulas:k,handleBack:S,onCodeChange:M,onTypeChange:T,parentCollection:j}=e,R=(0,x.useIntl)(),A=(0,i.Fy)(),{store:E,setValue:V}=(0,w.Cl)({initialValue:n,onChange:M,source:"formula",parentCollection:j}),B=(0,o.useCallback)((e=>{if(V(e.newValue),e.newSelection){const t={start:{store:E,index:e.newSelection.startIndex},end:{store:E,index:e.newSelection.endIndex}};y.NA({multiSelection:t})}}),[V,E]),P=(0,r.VK)((()=>{var e;const t=_.default.state;if("editing"===t.mode&&(null===(e=(0,C.QY)(t.multiSelection))||void 0===e?void 0:e.store)===E)return{startIndex:t.multiSelection.start.index,endIndex:t.multiSelection.end.index}}),[E]),O=(0,r.VK)((()=>!m.Xy(E.getValue(),n)),[n,E]),{handleClose:N}=e,D=(0,o.useCallback)((()=>{N(E.getValue())}),[N,E]),L=(0,r.VK)((()=>E.getValue()),[E]),[U,Z]=(0,r.VK)((()=>L?k.processFormulaInput(L):[void 0,void 0]),[L,k]),G=(0,r.VK)((()=>{if(U)return k.parseFormulaInputToCst(U,Z)}),[U,k,Z]),K=(0,r.VK)((()=>{if(G)return k.convertFormulaCSTToAST(G[0])}),[k,G]),[z,W]=(0,o.useState)(void 0);(0,o.useEffect)((()=>{!async function(){if(K&&b&&f.x.isSuccess(K)){const e=await k.addTypesToFormulaASTAsync(K.value,b,Z);W(e),null==T||T(e.node.type)}else W(void 0)}()}),[K,b,Z,G,k,T]);const H=(0,o.useMemo)((()=>void 0!==z?[...(0,d.Kl)(z.node,!1),...z.errors]:[]),[z]),$=(0,o.useMemo)((()=>({parseErrors:(null==G?void 0:G[1])??[],typeErrors:H,evaluationErrors:t})),[t,G,H]),Q=(0,c.Kt)($,pt,Object.is),Y=$.parseErrors.length+$.typeErrors.length+$.evaluationErrors.length>0,X=(0,r.VK)((()=>function(e){const{errors:t,intl:n,codeLength:o,formulas:i}=e,{parseErrors:r,typeErrors:s,evaluationErrors:l}=t,d=[];if(s&&s.length>0){const e=s.map((e=>{const t=(0,a.FR)((0,a.ic)(e));return{msg:n.formatMessage(...t),range:{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}}}));d.push(...e)}else if(l&&l.length>0){const e=l.map((e=>{const t=(0,a.FR)((0,a.OY)(e));return{msg:n.formatMessage(...t),range:i.isUniqueFormulaEvaluatorError(e)?{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}:void 0}}));d.push(...e)}if(r){const e=r.map((e=>{const t=(0,a.FR)((0,a.sG)(e));return{msg:n.formatMessage(...t),range:"eof"===e.offset?{startIndex:o-1,endIndex:o}:{startIndex:e.offset,endIndex:e.offset+1}}}));d.push(...e)}return d}({errors:Q,codeLength:Z?(0,l.eD)(Z):(0,h.QaF)(L).length,formulas:k,intl:R})),[L,Q,k,R,Z]),q=(0,o.useMemo)((()=>X.map((e=>e.range)).filter(v.$K)),[X]),[J,ee]=(0,o.useState)(void 0),te=(0,o.useRef)(void 0),[ne,oe]=(0,o.useState)(void 0),ie=(0,o.useRef)(1);(0,o.useEffect)((()=>{ie.current++;const e=ie.current;!async function(){if(k){const t=await k.getFormulaEditorInfoAtPosition({formula:L??[],inputPosition:P&&P.startIndex===P.endIndex?P.startIndex:0,context:b,includeDeprecatedCompletions:!1});f.x.isSuccess(t)&&ie.current===e&&(te.current=t.value,ee(t.value))}}()}),[P,k,b,L]);const re=(0,r.VK)((()=>{var e;return!(null!==(e=I.default.state.currentUserSettingsStore)&&void 0!==e&&null!==(e=e.getSettings())&&void 0!==e&&e.dismissed_formulas2_footer)||ut&&Math.random()<.66}),[]),se=(0,o.useCallback)((()=>{V(n)}),[n,V]);ut&&console.log("FormulaInput",{currentValue:L,cursorEditorInfo:J,infoHelper:ne,errorMessagesWithRange:X,errorRanges:q,astWithTypes:z});const ae=(0,s.yK)((e=>({container:{display:"flex",height:"100%",paddingBottom:re?30:void 0,flexDirection:"column"},editorSection:{display:"flex",flexDirection:"column",backgroundColor:"light"===e.mode?e.cardBackground:e.accentColors.gray[30]},inputText:{display:"flex",flexGrow:1,flexShrink:1,overflow:"auto",maxHeight:"min(calc(90vh - 240px - 38px - 30px), 298px)",minHeight:"28px",cursor:"text"},bottomSection:{display:"flex",flexDirection:"row",height:A.isMobile?"100%":240,maxHeight:A.isMobile?void 0:"calc(90vh - 38px - 31px - 38px - 30px)",borderTop:`1px solid ${e.outlineButtonBorder}`},leftColumn:{position:"relative",borderRight:`1px solid ${e.outlineButtonBorder}`,width:A.isMobile?"100%":void 0},rightColumn:{display:"flex",flexGrow:1},infoHelper:{padding:"12px 14px"}})),[re,A.isMobile]);return(0,ce.jsx)(F.Z,{debugName:"FormulaInput",capture:!0,children:(0,ce.jsxs)("div",{style:ae.container,children:[(0,ce.jsxs)("div",{style:ae.editorSection,children:[(0,ce.jsx)(Pe,{onClickBack:S,onClickClose:D,onClickRevert:se,showRevert:O,disabled:g}),(0,ce.jsx)("div",{style:ae.inputText,children:(0,ce.jsx)(lt,{value:L,focus:!0,store:E,disabled:g,parentSpaceId:u,valueTypes:b.valueTypes,errorRanges:q,handleSave:D},"input")})]}),X.length>0&&Y?(0,ce.jsx)(ft,{errorMessagesWithRange:X}):p,!g&&(0,ce.jsxs)("div",{style:ae.bottomSection,children:[(0,ce.jsx)("div",{style:ae.leftColumn,children:(0,ce.jsx)(be,{store:E,context:b,selection:P,cursorEditorInfo:J,cursorEditorInfoRef:te,onChange:B,getRecordModel:e.getRecordModel,setInfoHelper:oe})}),!A.isMobile&&(0,ce.jsx)("div",{style:ae.rightColumn,children:(0,ce.jsx)(ue,{infoHelper:ne,getRecordModel:e.getRecordModel,style:ae.infoHelper})})]}),re&&(0,ce.jsx)(vt,{})]})})}const ft=o.memo((e=>{let{errorMessagesWithRange:t}=e;window.__c={n:"FormulaErrorsHelper"};const n=(0,s.yK)((e=>({errors:{display:"flex",flexDirection:"row",alignItems:"center",padding:10,fontSize:g.Z.fontSize.UISmall.desktop,height:38,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,textWrap:"nowrap",color:e.darkTextColor,flexShrink:0},icon:{width:12,height:12,fill:"light"===e.mode?e.accentColors.red[400]:e.accentColors.red[700],display:"inline",marginRight:4,marginTop:1},errorMessages:{overflow:"hidden",textOverflow:"ellipsis",color:"light"===e.mode?e.accentColors.red[500]:e.accentColors.red[800]}})),[]);return 0===t.length?null:(0,ce.jsxs)("div",{style:n.errors,children:[(0,p.t)(n.icon),(0,ce.jsx)("span",{style:n.errorMessages,children:t.slice(0,3).map(((e,t)=>(0,ce.jsx)(ht,{index:t,errorMessageWithRange:e},t)))})]})}));function ht(e){let{errorMessageWithRange:t,index:n}=e;window.__c={n:"FormulaErrorsHelperError"};const{msg:o,range:i}=t,r=(0,s.yK)((()=>({errorRange:{opacity:.75}})),[]);return(0,ce.jsxs)(ce.Fragment,{children:[n>0?" ":null,o,void 0!==i&&(0,ce.jsxs)(ce.Fragment,{children:[" ",(0,ce.jsx)("span",{style:r.errorRange,children:`[${i.startIndex},${i.endIndex}]`})]})]})}const vt=o.memo((()=>{window.__c={n:"FormulaUpdateFooter"};const e=(0,i.Fy)(),t=(0,i.O7)(),n=(0,o.useCallback)((()=>{const e=I.default.state.currentUserSettingsStore;e&&b.createAndCommit({userAction:"TutorialActions.dismissTutorial",environment:t,perform:t=>{k.d2({userSettingsStore:e,transaction:t,data:{dismissed_formulas2_footer:!0}})},userId:e.id,canUndo:!1})}),[t]),r=(0,s.yK)((t=>({updateBanner:{zIndex:1,position:e.isMobile?void 0:"absolute",alignSelf:"flex-end",justifySelf:"flex-end",bottom:0,display:"flex",flex:"none",alignItems:"center",fontSize:g.Z.fontSize.UISmall.desktop,paddingLeft:4,paddingRight:8,minHeight:30,height:"auto",width:"100%",color:t.mediumTextColor,borderTop:`1px solid ${t.outlineButtonBorder}`},messageText:{flexGrow:1,marginLeft:4,marginTop:6,marginBottom:6},icon:{width:14,height:14,color:t.blueColor},dismissButton:{marginLeft:2,borderRadius:"100%"},iconCloseStyle:{width:12,height:12}})),[e.isMobile]);return(0,ce.jsxs)("div",{style:r.updateBanner,children:[(0,ce.jsx)(R.Z,{}),(0,ce.jsx)(j.Z,{href:(0,M.UY)("guides.formulasWhatsChanged"),external:!0,style:r.messageText,children:S.default.formatMessage(gt.learnMoreFooter)}),(0,ce.jsx)(T.Z,{ariaLabel:S.default.formatMessage(gt.learnMoreFooter),style:r.dismissButton,onClick:n,icon:u.U})]})}));const gt=(0,x.defineMessages)({learnMoreFooter:{id:"formula2Input.learnMore.button.label",defaultMessage:"We've recently updated our formula language! Learn more."}})},21396:(e,t,n)=>{n.d(t,{F:()=>p,e:()=>u});n(21703),n(67294);var o=n(24405),i=n(73110),r=n(49019),s=n(53016),a=n(26774),l=n(97880),d=n(93044),c=n(85893);function u(e){if(e.kind===i.yp.ContextValue)return e.name;if(e.kind===i.yp.Binding||e.kind===i.yp.ThisRow)throw new Error("Not implemented yet.");(0,l.t1)(e)}function p(e){window.__c={n:"FormulaValueToken"};const{value:t}=e,n=(0,o.Fg)(),i=u(t);let l,p;if("date"===t.type.type?l=s.V:"person"===t.type.type?l=a.O:("block"===t.type.type||"array"===t.type.type&&"block"===t.type.of.type)&&(l=r.e),l){const e=l;p=()=>e({width:12,height:12,marginRight:4})}return(0,c.jsx)(d.ZP,{...e,title:i,renderAvatar:p,shouldShrink:!0,style:{background:n.outlineBlueButtonPressedBackground,color:n.blueColor,padding:"2px 4px"}})}},68657:(e,t,n)=>{n.d(t,{Cl:()=>p,NY:()=>m});var o=n(67294),i=n(480),r=n(86628),s=n(72126),a=n(4615),l=n(21202),d=(n(70203),n(84398)),c=n(77080),u=n(79797);function p(e){const{initialValue:t,onChange:n,source:c="title",parentCollection:p}=e,m=(0,i.O7)(),f=(0,d.$)("formulaPrototypeHelpers.useMockTextStore",{isMockTextStore:!0,overrideDefaultRecordCache:!0}),h=function(e){const{initialValue:t,inMemoryRecordCache:n,source:r,parentCollection:s}=e,d=(0,i.O7)(),c=(0,o.useMemo)((()=>t),[]);return(0,o.useMemo)((()=>{const e={id:(0,a.ZP)(),table:l.iU};n.setRecord({pointer:e,userId:d.currentUser.id},{value:{alive:!0,id:e.id,parent_id:(null==s?void 0:s.id)??a._6,parent_table:"block",properties:{[r]:c},space_id:(null==s?void 0:s.getSpaceId())??a._6,type:"page",version:0},role:"editor"});const t=new u.ST({environment:d,inMemoryRecordCache:n,path:["properties",r],pointer:e,userId:d.currentUser.id});return n.emitRecord(e,[]),t}),[d,n,c,s,r])}({initialValue:t,inMemoryRecordCache:f,source:c,parentCollection:p}),v=(0,o.useRef)(t),g=(0,o.useCallback)((e=>{const t=m.currentUser.id,n=h.getRecordStoreAtRootPath();if(n instanceof u.G){const o=n.getValue();o&&(f.setRecord({pointer:h.pointer,userId:t},{role:"editor",value:{...o,properties:{...null==o?void 0:o.properties,[c]:e}}}),f.emitRecord(h.pointer,[]))}}),[m.currentUser.id,h,f,c]);return(0,r.VK)((()=>{const e=h.getValue();s.Xy(v.current,e)||(v.current=e,null==n||n(e))}),[h,n]),{store:h,setValue:g}}function m(){return c.default.checkGate("formula_buttons")}},18441:(e,t,n)=>{n.d(t,{P9:()=>l,YJ:()=>d,jc:()=>a,jg:()=>s});n(57658);var o=n(77657),i=n(59753),r=n(32161);function s(e){if(e.integration_id!==o.nO)throw"Cannot render account for integration.";const t=/(.+) - (.+)/.exec(e.account_name);if(!t)return{accountName:e.account_name};const[,n,i]=t;return{organizationName:n,accountName:i}}function a(e){return i.kk.fromValue(r.P,e).getSlackWorkspaceId()}function l(e,t){return t?e.filter((e=>{const n=a(e);return!!n&&t(n)})):e}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n={};for(const o of e){const{accountName:e,organizationName:i}=s(o);c({query:t,accountName:e,organizationName:i})&&(n[e]||(n[e]=[]),n[e].push({externalAuthentication:o,workspaceName:i}))}return n}function c(e){const{accountName:t,organizationName:n,query:o}=e;if(0===o.length)return!0;const i=t.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0,r=!!n&&n.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0;return i||r}},84398:(e,t,n)=>{n.d(t,{$:()=>s});var o=n(67294),i=n(26263),r=n(480);function s(e,t){const{cacheFallback:n,isMockTextStore:s,isTemporaryData:a,overrideDefaultRecordCache:l}=t??{},d=(0,r.O7)(),{inMemoryRecordCache:c}=d.defaultRecordCache,u=(0,o.useMemo)((()=>{const t=new i.Z({isTemporaryData:Boolean(a),name:e});return t.isMockTextStore=Boolean(s),n&&t.addCacheFallback(n),l&&c.addCacheOverride(t),t}),[n,c,s,a,e,l]);return(0,o.useEffect)((()=>function(){n&&u.removeCacheFallback(n),l&&c.removeCacheOverride(u)}),[n,c,u,l]),u}},17031:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(35431);class i extends o.Z{findCollectionTemplatePickerItemFromStore(e){if(e)return this.find((t=>t.props.templateStore===e))}}const r=new i},87199:(e,t,n)=>{n.d(t,{k:()=>o});const o=(0,n(9291).defineMessages)({paymentMethodUnverified:{id:"subscriptions.paymentMethodUnverified",defaultMessage:"Your payment is being processed. Please try again when your payment has completed."},otherPaymentMethod:{id:"subscriptions.otherPaymentMethod",defaultMessage:"Other"}})},44041:(e,t,n)=>{n.d(t,{y:()=>b});n(67294);var o=n(47425),i=n(9291),r=n(86572),s=n(47307),a=n(33929),l=n(52533),d=n(80444),c=n(92083),u=n(39343),p=n(87199),m=n(70060),f=n(88893),h=n(35057),v=n(88280),g=n(34583),x=n(64891),y=n(85893);const b=async function(e,t){var n;r.sA(e,{from:t.from,for_subscription_tier:t.for,addOnFeature:t.addOnFeature});if((0,h.QM)()&&["block_limit_sidebar","block_limit_settings","block_limit_banner"].includes(t.from)&&!t.addOnFeature&&(0,m.XA)(e))return void c.Z.setState({open:!0,openedFrom:"upsell",currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0});if(!t.addOnFeature&&(0,o.QM)(t.for))return;const b=(0,l.S$)({environment:e})&&"personal"===t.for;if(e.device.isMobileNative){if("ai"===t.addOnFeature){const t=(0,l.Y2)({environment:e})?(0,y.jsx)(i.FormattedMessage,{id:"upsellActions.noIAPForAIWithExternalPurchaseOption",defaultMessage:"This workspace has used all of its free AI responses. Visit on desktop to purchase Notion AI and go unlimited."}):(0,y.jsx)(i.FormattedMessage,{id:"upsellActions.noIAPForAIWithoutExternalPurchaseOption",defaultMessage:"This workspace has used all of its free AI responses. Unfortunately, additional AI responses cannot be purchased on this platform."});return void s.showErrorMessage(t)}if(!b)return}const k=d.default.state.currentSpaceStore;if(!k)return;if(!k.canAdmin())return;await g.bi(e);const w=v.subscriptionDataStoreInstance.state;if(!w)return;if("unsubscribed_admin"!==w.type&&"subscribed_admin"!==w.type)return void(t.dontOpenPlansOnCancel||c.Z.setState({open:!0,openedFrom:"upsell",currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0}));if(f.ri(w))return void s.showErrorMessage(a.default.formatMessage(p.k.paymentMethodUnverified));if(f.Q6(w)){const e=(0,y.jsx)(i.FormattedMessage,{id:"upsellActions.referToSalesRep",defaultMessage:"This workspace is part of a managed account. Please contact your account representative to discuss any changes to your subscription."});return void s.showErrorMessage(e)}if(b)return void(e.mobileNative&&k.id&&e.mobileNative.openUpgradeModal(k.id));if("revenueCat"===(null===(n=w.customerData)||void 0===n?void 0:n.activeSubscriptionPlatform)){const e=(0,y.jsx)(i.FormattedMessage,{id:"upsellActions.switchPlanFromInAppPurchase",defaultMessage:"You're currently subscribed through an in-app purchase with Apple. To switch plans, cancel your subscription with Apple first."});return void s.showErrorMessage(e)}const S=f.XX(w);if(t.addOnFeature&&(0,u.Fk)(S)){const e=(0,y.jsx)(i.FormattedMessage,{id:"upsellActions.noAddOnPurchaseDuringFreeTrial",defaultMessage:"Unfortunately, additional {addOn, select, ai {AI responses} other {features}} cannot be purchased while a workspace is on a free trial.",values:{addOn:t.addOnFeature}});s.showErrorMessage(e)}else{if(S&&f.MM(w))return t.addOnFeature?void x.af({environment:e,from:t.from,view:"add_ons",addOnFeature:t.addOnFeature,billingInterval:S.interval,pageSection:t.pageSection}):void x.af({environment:e,from:t.from,view:"plans",temporarySubscriptionTier:t.for,billingInterval:S.interval,pageSection:t.pageSection});{const n=(0,m.px)(e,t.for)?"ai_fifty_percent":void 0;g.I0(e,{subscriptionTier:t.for,from:t.from,addOnFeature:t.addOnFeature,coupon:n,isTrial:t.isTrial})}}}},39343:(e,t,n)=>{n.d(t,{Fk:()=>a,U6:()=>d,nx:()=>l});var o=n(30120),i=n(13991),r=n(7057),s=n(95477);function a(e){return!(null==e||!e.trialEnd)&&e.trialEnd>=o.ou.now().toSeconds()}function l(e){const t=function(e){if(!a(e))return;const t=1e3*(null==e?void 0:e.trialEnd);return null!=e&&e.periodEnd&&e.periodEnd>=o.ou.now().toSeconds()&&e.periodEnd<t?e.periodEnd:t}(e);return t?(0,r.Yx)(t,"long",i.SP):void 0}function d(e){return e?s.default.trials[e.id].duration:s.default.trials.default.duration}},37652:(e,t,n)=>{n.d(t,{V:()=>r});n(67294);var o=n(45238),i=n(85893);const r=(0,o.I)("arrowLeft",{viewBox:"0 0 30 30",svg:(0,i.jsx)("polygon",{points:"29 14 4.813 14 13.406 5.406 12 4 1 15 12 26 13.406 24.594 4.813 16 29 16"})})},8597:(e,t,n)=>{n.d(t,{Z:()=>r});n(67294);var o=n(45238),i=n(85893);const r=(0,o.I)("arrowUp",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M8 14.5586C8.44434 14.5586 8.74512 14.251 8.74512 13.7998V5.30957L8.69043 3.83984L10.4951 5.84961L12.0469 7.38086C12.1836 7.51074 12.3682 7.59961 12.5801 7.59961C12.9902 7.59961 13.291 7.28516 13.291 6.86816C13.291 6.66992 13.2158 6.49219 13.0586 6.32812L8.55371 1.81641C8.40332 1.66602 8.20508 1.57715 8 1.57715C7.79492 1.57715 7.59668 1.66602 7.44629 1.81641L2.94141 6.32812C2.78418 6.49219 2.70898 6.66992 2.70898 6.86816C2.70898 7.28516 3.0166 7.59961 3.42676 7.59961C3.63184 7.59961 3.82324 7.51074 3.95312 7.38086L5.50488 5.84961L7.30957 3.83301L7.25488 5.30957V13.7998C7.25488 14.251 7.5625 14.5586 8 14.5586Z"})})},82114:(e,t,n)=>{n.d(t,{Q:()=>i,p:()=>r});n(67294);var o=n(45238);const i=(0,n(85893).jsx)("path",{d:"M.911 8.034c0 4.505 3.049 7.24 7.246 7.24 1.135 0 2.215-.158 2.885-.376.472-.15.622-.397.622-.65a.44.44 0 00-.451-.444 1.3 1.3 0 00-.321.048c-.834.205-1.552.341-2.516.341-3.74 0-6.29-2.255-6.29-6.118 0-3.698 2.407-6.275 6.03-6.275 3.206 0 5.886 1.975 5.886 5.523 0 2.072-.697 3.466-1.825 3.466-.752 0-1.176-.437-1.176-1.183V4.972c0-.37-.205-.595-.554-.595-.341 0-.553.226-.553.595v.779h-.062c-.349-.84-1.203-1.374-2.222-1.374-1.77 0-3.014 1.51-3.014 3.678 0 2.187 1.237 3.712 3.042 3.712 1.06 0 1.88-.575 2.276-1.545h.062c.13.963.943 1.551 2.023 1.551 1.907 0 3.09-1.873 3.09-4.498 0-3.971-2.92-6.548-6.96-6.548C3.886.727.912 3.632.912 8.034zm6.911 2.652c-1.223 0-2.003-1.018-2.003-2.638 0-1.593.786-2.611 2.01-2.611 1.258 0 2.05.998 2.05 2.584 0 1.62-.813 2.665-2.057 2.665z"}),r=(0,o.I)("at",{viewBox:"0 0 16 16",svg:i})},96711:(e,t,n)=>{n.d(t,{V:()=>r});n(67294);var o=n(45238),i=n(85893);const r=(0,o.I)("checkboxSquareChecked",{viewBox:"0 0 14 14",svg:(0,i.jsx)("path",{d:"M2.85742 13.4561H11.1357C12.6123 13.4561 13.3779 12.6904 13.3779 11.2344V2.91504C13.3779 1.45215 12.6123 0.693359 11.1357 0.693359H2.85742C1.38086 0.693359 0.615234 1.45215 0.615234 2.91504V11.2344C0.615234 12.6973 1.38086 13.4561 2.85742 13.4561ZM2.93945 12.1162C2.30371 12.1162 1.95508 11.7812 1.95508 11.1182V3.02441C1.95508 2.36133 2.30371 2.0332 2.93945 2.0332H11.0537C11.6826 2.0332 12.0381 2.36133 12.0381 3.02441V11.1182C12.0381 11.7812 11.6826 12.1162 11.0537 12.1162H2.93945ZM6.26855 10.3115C6.51465 10.3115 6.72656 10.1885 6.87012 9.96973L9.92578 5.19141C10.0146 5.04785 10.0967 4.88379 10.0967 4.72656C10.0967 4.3916 9.7959 4.16602 9.47461 4.16602C9.26953 4.16602 9.08496 4.27539 8.94141 4.50781L6.24121 8.8418L4.96973 7.22168C4.80566 7.00977 4.6416 6.93457 4.43652 6.93457C4.10156 6.93457 3.8418 7.20117 3.8418 7.54297C3.8418 7.70703 3.90332 7.85742 4.01953 8.00098L5.63281 9.96973C5.81738 10.209 6.01562 10.3115 6.26855 10.3115Z"})})},18557:(e,t,n)=>{n.d(t,{z:()=>r});n(67294);var o=n(45238),i=n(85893);const r=(0,o.I)("flag",{viewBox:"0 0 13 14",svg:(0,i.jsx)("path",{d:"M0.825195 13.8457C1.16699 13.8457 1.4541 13.5654 1.4541 13.2168V9.47754C1.63867 9.40918 2.21973 9.19727 3.10156 9.19727C5.59668 9.19727 7.25781 10.4414 9.66406 10.4414C10.7168 10.4414 11.1885 10.3115 11.7217 10.0654C12.207 9.84668 12.4941 9.4502 12.4941 8.82129V1.99219C12.4941 1.55469 12.1523 1.27441 11.6943 1.27441C11.3047 1.27441 10.6895 1.54102 9.58887 1.54102C7.20996 1.54102 5.52148 0.296875 3.0332 0.296875C1.99414 0.296875 1.5293 0.419922 0.975586 0.672852C0.49707 0.891602 0.196289 1.24707 0.196289 1.86914V13.2168C0.196289 13.5586 0.483398 13.8457 0.825195 13.8457ZM9.63672 9.16309C7.41504 9.16309 5.71289 7.92578 3.12207 7.92578C2.45215 7.92578 1.84375 8.00098 1.48145 8.14453V2.0332C1.59766 1.83496 2.11035 1.56836 3.05371 1.56836C5.38477 1.56836 7.09375 2.80566 9.56836 2.80566C10.2383 2.80566 10.792 2.73047 11.2158 2.61426V8.69824C11.0996 8.89648 10.5801 9.16309 9.63672 9.16309Z"})})}}]);