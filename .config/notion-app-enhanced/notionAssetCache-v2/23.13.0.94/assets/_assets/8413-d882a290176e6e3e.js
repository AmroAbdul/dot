"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8413],{3992:(e,t,o)=>{o.r(t),o.d(t,{addRecurrence:()=>g,createRecurrenceInner:()=>h,disableRecurrence:()=>y});var n=o(40506),i=o(4615),r=o(98963),a=o(18844),l=o(6287),s=o(97978),c=o(80444),d=o(79797),u=o(96802),p=o(9953),m=o(82530);function g(e){let{environment:t,blockStore:o,recurrence:s}=e;const c=o.getAutomationId(),u=function(e){return{...e,start_date:(0,n.Io)(new Date(e.start_date))}}(s);c?function(e,t,o,n){const s=o.getParentStore();if(!s||s.table!==l.v)return;const c=o.getSpaceId(),u={table:r.cv,id:t,spaceId:c},g=d.Mz.createChildStore(o,u),y=g.getTrigger();if(!y)return;const h=g.getActionStores()[0];m.createAndCommit({environment:e,userAction:"recurrenceActions.updateRecurrence",perform:t=>{const r=f({automationId:g.id,spaceId:c,collectionPointer:s.getSpaceShardedPointer(),templatePageId:o.id});let l;h?(l=h.id,p.sW({store:h,data:r,transaction:t})):(l=(0,i.ZP)(),p.ae({environment:e,table:a.Xj,inMemoryRecordCache:g.inMemoryRecordCache,transaction:t,value:{id:l,...r}})),p.sW({store:g,data:{status:"active",trigger:{id:y.id,type:"recurrence",recurrence:n},action_ids:[l]},transaction:t})}}),S(e,{type:"updated",frequency:n.frequency})}(t,c,o,u):function(e,t,o){m.createAndCommit({environment:e,userAction:"recurrenceActions.createRecurrence",perform:n=>{h(n,e,t,o)}})}(t,o,u)}function y(e){let{environment:t,blockStore:o}=e;const n=o.getAutomationId();if(!n)return;const i={table:r.cv,id:n,spaceId:o.getSpaceId()};m.createAndCommit({environment:t,userAction:"recurrenceActions.disableRecurrence",perform:e=>{p.sW({store:(0,d.Kv)(o,i),data:{status:"disabled",run_at:void 0},transaction:e})}}),S(t,{type:"disabled"})}function h(e,t,o,n){const{currentUserRootStore:s}=c.default.state;if(!s)return;const d=o.getParentStore();if(!d||d.table!==l.v)return;if(!d.getParentBlockStore())return;const m=o.getSpaceId(),g=(0,i.ZP)(),y=(0,i.ZP)();p.ae({environment:t,table:r.cv,inMemoryRecordCache:o.inMemoryRecordCache,value:{id:g,parent_id:o.id,parent_table:o.table,alive:!0,space_id:m,status:"active",trigger:{id:(0,i.ZP)(),type:"recurrence",recurrence:n},action_ids:[y]},transaction:e}),u.FH({stores:[o],update:{automation_id:g},transaction:e}),p.ae({environment:t,table:a.Xj,inMemoryRecordCache:o.inMemoryRecordCache,transaction:e,value:{id:y,...f({automationId:g,spaceId:m,collectionPointer:d.getSpaceShardedPointer(),templatePageId:o.id})}}),S(t,{type:"created",frequency:n.frequency})}function f(e){const{automationId:t,spaceId:o,collectionPointer:n,templatePageId:i}=e;return{parent_id:t,parent_table:r.cv,type:"create_page",alive:!0,space_id:o,config:{collection:n,template_page_id:i}}}function S(e,t){s.j(e,"recurrence_saved",t)}},20804:(e,t,o)=>{o.d(t,{e:()=>T});var n=o(67294),i=o(480),r=o(86628),a=o(63362),l=o(40745),s=o(8597),c=o(88437),d=o(1230),u=o(41490),p=o(25651),m=o(37612),g=o(97880),y=o(9291),h=o(52275),f=o(91839),S=o(78140),v=o(32163),x=o(72495),C=o(63474),b=o(47043),w=o(12455),k=o(95193),M=o(10383),j=o(26247),_=o(85893);const A=(0,y.defineMessages)({addStepAboveMenuItemLabel:{defaultMessage:"Add step above",id:"automations.actionContextMenu.addStepAboveMenuItemLabel"},addStepBelowMenuItemLabel:{defaultMessage:"Add step below",id:"automations.actionContextMenu.addStepBelowMenuItemLabel"},deleteMenuItemLabel:{defaultMessage:"Delete",id:"automations.actionContextMenu.deleteMenuItemLabel"},duplicateAboveMenuItemLabel:{defaultMessage:"Duplicate above",id:"automations.actionContextMenu.duplicateAboveMenuItemLabel"},duplicateBelowMenuItemLabel:{defaultMessage:"Duplicate below",id:"automations.actionContextMenu.duplicateBelowMenuItemLabel"},duplicatingMenuItemLabel:{defaultMessage:"Duplicating…",id:"automations.actionContextMenu.duplicatingMenuItemLabel"},editMenuItemLabel:{defaultMessage:"Edit",id:"automations.actionContextMenu.editMenuItemLabel"},moveDownMenuItemLabel:{defaultMessage:"Move down",id:"automations.actionContextMenu.moveDownMenuItemLabel"},moveUpMenuItemLabel:{defaultMessage:"Move up",id:"automations.actionContextMenu.moveUpMenuItemLabel"}});function T(e){window.__c={n:"ActionContextMenu"};const{actionStore:t,closeMenu:o}=e,{automationContextStore:l,maybePersistedTransactionActions:s}=(0,w.i)(),c=(0,i.O7)(),d=(0,C.D)(),[u,p]=(0,n.useState)(),m=(0,r.VK)((()=>null==l?void 0:l.context.automationStore),[l]),g=(0,r.VK)((()=>(null==m?void 0:m.getActionIds())??[]),[m]),y=(0,r.VK)((()=>g.indexOf(t.id)),[t.id,g]),h=(0,r.VK)((()=>(0,j.r)(l,t)),[t,l]),f=(0,r.VK)((()=>{if(!h||!t.isType("update_pages"))return;const e=t.getConfigStore().getKeyStore("properties").getValue();return null==e?void 0:e[0]}),[t,h]),S=0===y,v=y===g.length-1,x=(0,n.useCallback)((()=>{p(void 0),null==o||o()}),[o]),k=(0,n.useCallback)((async()=>{if(!m)return;const e=s.createAndCommit({perform:e=>b.AN({environment:c,includeParenting:!0,insertionPoint:{beforeActionId:t.id},sourceActionStore:t,transaction:e}),userAction:"ActionContextMenu.duplicateAction"});await e.performResult.onComplete,t.isDefined()&&(0,a.eI)(d,{automation_action_id:t.id,automation_action_type:t.getType(),automation_id:m.id,from:"duplicate"}),x()}),[t,m,c,d,x,s]),A=(0,n.useCallback)((async()=>{if(!m)return;const e=s.createAndCommit({perform:e=>b.AN({sourceActionStore:t,environment:c,includeParenting:!0,insertionPoint:{afterActionId:t.id},transaction:e}),userAction:"ActionContextMenu.duplicateAction"});await e.performResult.onComplete,t.isDefined()&&(0,a.eI)(d,{automation_action_id:t.id,automation_action_type:t.getType(),automation_id:m.id,from:"duplicate"}),x()}),[t,m,c,d,x,s]),T=(0,n.useCallback)((()=>{const e=null==l?void 0:l.context;return e?(s.createAndCommit({perform:o=>{b.sl({actionStore:t,clientContext:e,transaction:o}),t.isDefined()&&(0,a.co)(d,{automation_action_id:t.id,automation_action_type:t.getType(),automation_id:e.automationStore.id})},userAction:"ActionContextMenu.removeAction"}),x(),Promise.resolve()):Promise.resolve()}),[t,null==l?void 0:l.context,d,x,s]),V=(0,n.useCallback)((()=>{const e=null==l?void 0:l.context;if(!e)return Promise.resolve();s.createAndCommit({perform:t=>{const o=I(g,y-1,y);b.kM({clientContext:e,newActionIds:o,transaction:t})},userAction:"ActionContextMenu.moveAction"}),x()}),[g,null==l?void 0:l.context,y,x,s]),F=(0,n.useCallback)((()=>{const e=null==l?void 0:l.context;if(!e)return Promise.resolve();s.createAndCommit({perform:t=>{const o=I(g,y+1,y);b.kM({clientContext:e,newActionIds:o,transaction:t})},userAction:"ActionContextMenu.moveAction"}),x()}),[g,null==l?void 0:l.context,y,x,s]),Z=(0,n.useMemo)((()=>{if(h&&f)return function(){p({initialState:{actionId:t.id,propertyId:f,type:"eventActionProperty"},insertionPoint:void 0})}}),[t.id,h,f]),K=(0,n.useCallback)((()=>{p({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{beforeActionId:t.id}})}),[t.id]),B=(0,n.useCallback)((()=>{p({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{afterActionId:t.id}})}),[t.id]);return(0,_.jsxs)(_.Fragment,{children:[!u&&(0,_.jsx)(P,{onAddStepAbove:K,onAddStepBelow:B,onDelete:T,onDuplicateAbove:k,onDuplicateBelow:A,onEdit:Z,onMoveDown:v?void 0:F,onMoveUp:S?void 0:V}),u&&(0,_.jsx)(M.Z,{initialState:u.initialState,insertionPoint:u.insertionPoint,onClose:x})]})}function P(e){window.__c={n:"BaseActionContextMenu"};const{onAddStepAbove:t,onAddStepBelow:o,onDelete:i,onDuplicateAbove:r,onDuplicateBelow:a,onEdit:h,onMoveDown:f,onMoveUp:C}=e,b=(0,k.F)(),w=function(e){const{hasSeparator:t,onMoveDown:o,onMoveUp:i}=e,r=(0,n.useMemo)((()=>{if(i)return{action:i,key:"moveUp",render:e=>(0,_.jsx)(V,{...e,icon:(0,s.Z)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.moveUpMenuItemLabel})})}}),[i]),a=(0,n.useMemo)((()=>{if(o)return{action:o,key:"moveDown",render:e=>(0,_.jsx)(V,{...e,icon:(0,l.M)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.moveDownMenuItemLabel})})}}),[o]),c=[r,a].filter(g.$K);if(0===c.length)return;return{items:c,key:"moveSteps",render:e=>(0,_.jsx)(x.Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({onMoveDown:f,onMoveUp:C}),M=function(e){const{hasSeparator:t,onAddStepAbove:o,onAddStepBelow:i}=e,r=(0,n.useMemo)((()=>{if(o)return{action:o,key:"addStepAbove",render:e=>(0,_.jsx)(V,{...e,icon:(0,u.F)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.addStepAboveMenuItemLabel})})}}),[o]),a=(0,n.useMemo)((()=>{if(i)return{action:i,key:"addStepBelow",render:e=>(0,_.jsx)(V,{...e,icon:(0,d.H)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.addStepBelowMenuItemLabel})})}}),[i]),l=[r,a].filter(g.$K);if(0===l.length)return;return{items:l,key:"addSteps",render:e=>(0,_.jsx)(x.Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:Boolean(w),onAddStepAbove:t,onAddStepBelow:o}),j=function(e){const{hasSeparator:t,onDuplicateAbove:o,onDuplicateBelow:i}=e,[r,a]=(0,n.useState)(!1),l=(0,n.useMemo)((()=>{if(o)return{action:async()=>{a(!0);try{await o()}finally{a(!1)}},key:"duplicateAbove",render:e=>(0,_.jsx)(V,{...e,icon:(0,c.a)({height:16,width:16}),isLoading:r,children:r?(0,_.jsx)(y.FormattedMessage,{...A.duplicatingMenuItemLabel}):(0,_.jsx)(y.FormattedMessage,{...A.duplicateAboveMenuItemLabel})})}}),[r,o]),s=(0,n.useMemo)((()=>{if(i)return{action:async()=>{a(!0);try{await i()}finally{a(!1)}},key:"duplicateBelow",render:e=>(0,_.jsx)(V,{...e,icon:(0,c.a)({height:16,width:16}),isLoading:r,children:r?(0,_.jsx)(y.FormattedMessage,{...A.duplicatingMenuItemLabel}):(0,_.jsx)(y.FormattedMessage,{...A.duplicateBelowMenuItemLabel})})}}),[r,i]),d=[l,s].filter(g.$K);if(0===d.length)return;return{items:d,key:"duplicateSteps",render:e=>(0,_.jsx)(x.Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:Boolean(w||M),onDuplicateAbove:r,onDuplicateBelow:a}),T=function(e){const{hasSeparator:t,onDelete:o,onEdit:i}=e,r=(0,n.useMemo)((()=>{if(i)return{action:i,key:"edit",render:e=>(0,_.jsx)(V,{...e,icon:(0,p.R)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.editMenuItemLabel})})}}),[i]),a=(0,n.useMemo)((()=>{if(o)return{action:o,key:"delete",render:e=>(0,_.jsx)(V,{...e,icon:(0,m.y)({height:16,width:16}),children:(0,_.jsx)(y.FormattedMessage,{...A.deleteMenuItemLabel})})}}),[o]),l=[r,a].filter(g.$K);if(0===l.length)return;return{items:l,key:"otherActions",render:e=>(0,_.jsx)(x.Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:Boolean(w||M||j),onDelete:i,onEdit:h});return(0,_.jsx)(S.Z,{...b,children:(0,_.jsx)(v.Z,{type:v.i.Vertical,sections:[w,M,j,T].filter(g.$K),initialFocus:0})})}function V(e){const{children:t,icon:o,isLoading:n,...i}=e,r=n?(0,_.jsx)(f.Z,{}):o;return(0,_.jsx)(h.Z,{...i,disabled:n,disabledFeedback:n,icon:r,title:t})}function I(e,t,o){if(t<0||t>=e.length||o<0||o>=e.length)return e;const n=[...e];return n[t]=e[o],n[o]=e[t],n}},19454:(e,t,o)=>{o.d(t,{v:()=>M});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(63362),s=o(28751),c=o(4615),d=o(97880),u=o(9291),p=o(82530),m=o(52275),g=o(78140),y=o(32163),h=o(72495),f=o(26388),S=o(60442),v=o(49117),x=o(98742),C=o(63474),b=o(47043),w=o(95193),k=o(85893);function M(e){window.__c={n:"AddActionMenu"};const{contextStore:t,onActionAdded:o,insertionPoint:a}=e,M=(0,u.useIntl)(),_=(0,i.O7)(),A=(0,C.D)(),T=(0,w.F)({width:280}),P=function(e){const{contextStore:t}=e,[o,i]=(0,n.useState)([]),a=(0,r.VK)((()=>(0,v.uV)(t.context.automationStore,t.context.type)),[t.context.automationStore,t.context.type]),l=(0,n.useMemo)((()=>(0,s.P)("display")),[]);return(0,r.VK)((async()=>{if(a){const e=await Promise.all(l.map((async e=>await e.isAvailableForContext(a))));return i(function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}(l.filter(((t,o)=>e[o]))))}o.length>0&&i([])}),[a,o.length,l]),o}({contextStore:t}),V=P.map((e=>{const{display:n}=e,i={key:e.type,render:e=>{const t=t=>(0,k.jsx)(m.Z,{...(0,x.Z)(t??{},e),icon:(0,k.jsx)(j,{display:n}),disabled:!1,title:M.formatMessage(n.name)}),o=n.description;return o?(0,k.jsx)(f.ZP,{renderTooltip:()=>(0,k.jsx)(S.Z,{caption:M.formatMessage(o)}),placement:f.ug.Right,delayThreshold:0,render:t}):t()},action:()=>{const n=(0,c.ZP)(),i=t.context.automationStore;p.createAndCommit({userAction:"AutomationActionList.addAction",environment:_,perform:t=>{b.zY({actionId:n,actionType:e.type,automationStore:i,environment:_,intl:M,transaction:t,insertionPoint:a})}}),(0,l.eI)(A,{automation_id:i.id,automation_action_id:n,automation_action_type:e.type}),o(n)}};return i})).filter(d.$K);return(0,k.jsx)(g.Z,{...T,children:(0,k.jsx)(y.Z,{type:y.i.Vertical,sections:[{key:0,render:e=>(0,k.jsx)(h.Z,{enableActionSheetTitle:!0,...e}),items:V}],initialFocus:0})})}function j(e){window.__c={n:"AddActionIcon"};const{display:t}=e,o=(0,a.yK)((e=>({icon:{width:13,height:13,fill:t.hasSideEffects?e.blueColor:e.mediumIconColor},iconWrapper:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",background:t.hasSideEffects?"rgba(35, 131, 226, 0.14)":e.accentColors.gray[50],borderRadius:4,marginLeft:-2}})),[t.hasSideEffects]);return(0,k.jsx)("div",{style:o.iconWrapper,children:t.icon(o.icon)})}},48312:(e,t,o)=>{o.d(t,{Xd:()=>W});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(63362),s=o(28751),c=o(40745),d=o(8597),u=o(56666),p=o(88437),m=o(1230),g=o(41490),y=o(37612),h=o(98963),f=o(97880),S=o(82990),v=o(9291),x=o(82530),C=o(30583),b=o(23063),w=o(52275),k=o(31945),M=o(50478),j=o(73063),_=o(91839),A=o(78140),T=o(32163),P=o(53437),V=o(72495),I=o(28267),F=o(63474),Z=o(47043),K=o(95193),B=o(35294),O=o(19454),R=o(85893);const D=(0,v.defineMessages)({moreActionsButtonAriaLabel:{defaultMessage:"More actions",id:"buttonBlock.button.moreActionsButtonAriaLabel"}});function W(e){window.__c={n:"AutomationActionHeader"};const{contextStore:t,actionStore:o,disabled:i,dragging:l,title:c,picker:d,onActionAdded:u}=e,p=(0,n.useRef)(null),m=(0,I.X)(p),g=(0,n.useMemo)((()=>Boolean(m&&m.width<320)),[m]),[y,h]=(0,n.useState)(!1),f=(0,n.useMemo)((()=>l||!i&&y),[i,l,y]),v=(0,a.yK)((e=>({iconHandle:{display:"flex",justifyContent:"center",left:0,position:"absolute",top:0,width:24},iconWrap:{position:"relative",width:24},nameRow:{display:"flex",alignItems:g?"flex-start":"center"},name:{flexGrow:1,fontWeight:S.Z.fontWeight.medium,display:"flex",overflow:"hidden",...g?{flexDirection:"row",flexWrap:"wrap",marginLeft:8,alignItems:"center"}:{alignItems:"center",marginLeft:8}},title:{whiteSpace:"nowrap"},picker:{position:"relative",left:-4,...g?{flexShrink:1,display:"inline-flex",minWidth:0}:{flexGrow:1,width:0}}})),[g]),x=(0,r.VK)((()=>o.getType()),[o]);if(!x)return null;const C=(0,s.z)(x),{display:w}=C;return(0,R.jsxs)("div",{onMouseLeave:()=>h(!1),onMouseEnter:()=>h(!0),style:v.nameRow,ref:p,children:[(0,R.jsxs)("div",{style:v.iconWrap,children:[(0,R.jsx)(b.Z,{isVisible:!0,animationStyle:{opacity:f?0:1},enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:1},render:()=>(0,R.jsx)(E,{display:w})}),(0,R.jsx)(b.Z,{isVisible:!i,animationStyle:{opacity:f?1:0},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>(0,R.jsx)("div",{style:v.iconHandle,children:(0,R.jsx)(M.ZP,{hideClickMessage:!0})})})]}),(0,R.jsxs)("div",{style:v.name,children:[(0,R.jsx)("div",{style:v.title,children:c}),!g&&(0,R.jsx)(R.Fragment,{children:" "}),d&&(0,R.jsx)("div",{style:v.picker,children:d})]}),!i&&(0,R.jsx)(N,{contextStore:t,actionStore:o,onActionAdded:u})]})}function E(e){window.__c={n:"ActionIcon"};const{display:t}=e,o=(0,a.yK)((e=>({iconWrap:{width:24,height:24,display:"flex",alignItems:"center",borderRadius:4,background:t.hasSideEffects?"rgba(35, 131, 226, 0.14)":e.accentColors.gray[50],flexShrink:0},icon:{width:14,height:14,fill:t.hasSideEffects?e.blueColor:e.accentColors.gray[500],margin:"0 auto"}})),[t.hasSideEffects]);return(0,R.jsx)("div",{style:o.iconWrap,children:t.icon(o.icon)})}function N(e){window.__c={n:"MoreActionsButton"};const{contextStore:t,actionStore:o,onActionAdded:i}=e,r=(0,v.useIntl)(),a=(0,B.d)(),[l,s]=(0,n.useState)("closed"),[c,d]=n.useState(void 0);return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(k.ZP,{popupType:a,alignmentToOrigin:k.vR.Center,placementToOrigin:k.pO.Bottom,originGap:0,renderOrigin:e=>(0,R.jsx)(j.Z,{ariaLabel:r.formatMessage(D.moreActionsButtonAriaLabel),icon:u.o,...e}),render:t=>(0,R.jsx)(H,{onClose:()=>t.close(),onAddStep:e=>{d(new DOMRect(C.IL.x,C.IL.y,1,1)),s(e?"above":"below"),t.close()},...e})}),(0,R.jsx)(P.ZP,{popupType:a,open:"closed"!==l,originRect:c,placementToOrigin:P.ZP.Placement.Bottom,alignmentToOrigin:P.ZP.Alignment.Center,render:()=>(0,R.jsx)(O.v,{contextStore:t,onActionAdded:e=>{i(e),s("closed")},insertionPoint:"above"===l?{beforeActionId:o.id}:{afterActionId:o.id}}),onDismiss:()=>s("closed")})]})}function L(e,t,o){if(t<0||t>=e.length||o<0||o>=e.length)return e;const n=[...e];return n[t]=e[o],n[o]=e[t],n}function H(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,contextStore:o,actionStore:a,onAddStep:s}=e,u=(0,i.O7)(),S=(0,F.D)(),C=(0,r.VK)((()=>o.context.automationStore),[o]),b=(0,r.VK)((()=>C.getActionIds()),[C]),[k,M]=(0,n.useState)(!1),j=b.length<h.FT,P=b.indexOf(a.id),I=0===P,B=P===b.length-1,O=(0,K.F)(),D={key:"duplicate",action:async()=>{M(!0);const e=x.createAndCommit({userAction:"AutomationAction.duplicateAction",environment:u,perform:e=>Z.AN({environment:u,sourceActionStore:a,includeParenting:!0,transaction:e})});a.isDefined()&&(0,l.eI)(S,{automation_id:o.context.automationStore.id,automation_action_id:a.id,automation_action_type:a.getType(),from:"duplicate"});try{await e.performResult.onComplete}finally{M(!1)}t()},render:e=>{const t=k?(0,R.jsx)(_.Z,{}):(0,p.a)({height:16,width:16}),o=k?(0,R.jsx)(v.FormattedMessage,{id:"automations.duplicatingActionButton.label",defaultMessage:"Duplicating..."}):(0,R.jsx)(v.FormattedMessage,{id:"automations.duplicateBelowActionButton.label",defaultMessage:"Duplicate below"});return(0,R.jsx)(w.Z,{...e,disabled:k,icon:t,title:o})}},W={key:"delete",action:()=>{x.createAndCommit({userAction:"AutomationAction.removeAction",environment:u,perform:e=>{Z.sl({clientContext:o.context,actionStore:a,transaction:e}),a.isDefined()&&(0,l.co)(S,{automation_id:o.context.automationStore.id,automation_action_id:a.id,automation_action_type:a.getType()})}}),t()},render:e=>(0,R.jsx)(w.Z,{...e,icon:(0,y.y)({height:16,width:16}),title:(0,R.jsx)(v.FormattedMessage,{id:"automations.deleteActionButton.label",defaultMessage:"Delete"})})},E=[!0,!1].map((e=>{if(!(e&&I||!e&&B))return{key:e?"moveUp":"moveDown",action:()=>{x.createAndCommit({userAction:"AutomationAction.moveAction",environment:u,perform:t=>{let n;n=L(b,e?P-1:P+1,P),Z.kM({clientContext:o.context,transaction:t,newActionIds:n})}}),t()},render:t=>(0,R.jsx)(w.Z,{...t,icon:(e?d.Z:c.M)({width:16,height:16}),title:e?(0,R.jsx)(v.FormattedMessage,{id:"automations.moveUpButton.label",defaultMessage:"Move up"}):(0,R.jsx)(v.FormattedMessage,{id:"automations.moveDownButton.label",defaultMessage:"Move down"})})}})).filter(f.$K),N=[!0,!1].map((e=>({key:e?"addStepAbove":"addStepBelow",action:()=>{s(e)},render:t=>(0,R.jsx)(w.Z,{...t,disabledFeedback:!0,icon:e?(0,g.F)({width:16,height:16}):(0,m.H)({width:16,height:16}),title:e?(0,R.jsx)(v.FormattedMessage,{id:"automations.addStepAboveButton.label",defaultMessage:"Add step above"}):(0,R.jsx)(v.FormattedMessage,{id:"automations.addStepBelowButton.label",defaultMessage:"Add step below"})})})));return(0,R.jsx)(A.Z,{...O,children:(0,R.jsx)(T.Z,{type:T.i.Vertical,sections:[...E.length>0?[{key:"movement",render:e=>(0,R.jsx)(V.Z,{enableActionSheetTitle:!0,...e}),items:E}]:[],...j?[{key:"addSteps",render:e=>(0,R.jsx)(V.Z,{enableActionSheetTitle:!0,topBorder:!0,...e}),items:N},{key:"duplicate",render:e=>(0,R.jsx)(V.Z,{enableActionSheetTitle:!0,topBorder:!0,...e}),items:[D]}]:[],{key:"delete",render:e=>(0,R.jsx)(V.Z,{enableActionSheetTitle:!0,topBorder:!0,...e}),items:[W]}],initialFocus:0})})}},32984:(e,t,o)=>{o.d(t,{vV:()=>le,QF:()=>re,li:()=>me});var n=o(67294),i=o(86628),r=o(24405),a=o(3865),l=o(48777),s=o(23290),c=o(76218),d=o(72126),u=o(6287),p=o(97880),m=o(9291),g=o(9953),y=o(52275),h=o(31945),f=o(78140),S=o(32163),v=o(72495),x=o(480),C=o(40190),b=o(61766),w=o(53437),k=o(72865),M=o(149),j=o(87279),_=o(77907),A=o(40721),T=o(65668),P=o(85893);const V=(0,_.withDependency)(_.deps.formulas,((e,t)=>(0,P.jsx)(I,{...t,formulas:e})));function I(e){window.__c={n:"FormulaInputMenu"};const{value:t,onChange:o,onClose:r,disabled:a,contextStore:l,formulas:s}=e,c=(0,x.Fy)(),d=(0,n.useCallback)((()=>{o({type:"simple",value:null==t?void 0:t.value}),r()}),[o,r,null==t?void 0:t.value]),u=(0,n.useCallback)((e=>{void 0!==e&&e[0][0].length?o({type:"formula",value:e}):o(void 0),r()}),[o,r]),p=(0,i.VK)((()=>l.context.parentRecordStore.getSpaceId()),[l.context.parentRecordStore]),m=(0,i.Kw)(l.compilationResultStore),g=(0,n.useMemo)((()=>s.createFormulaDataRequestHandler(l.context.parentRecordStore.getRecordModel,l.context.parentRecordStore.loadRecordModel)),[l.context.parentRecordStore.getRecordModel,l.context.parentRecordStore.loadRecordModel,s]),y=(0,i.VK)((()=>{if(M.x.isFail(m))return;return{valueTypes:m.value.valueTypes,handleDataRequest:g}}),[m,g],{useDeepEqual:!0});let h;return h=c.isMobile?{menuType:j.og.Modal,right:(0,P.jsx)(A.DoneMenuText,{}),onClickRight:parent.close}:{menuType:j.og.Popup,maxHeight:"50vh",width:600,height:320,disableHeaderBorder:!0},p&&y?(0,P.jsx)(f.Z,{...h,children:(0,P.jsx)(T.Z,{formulas:s,initialCode:null==t?void 0:t.value,typecheckContext:y,handleClose:u,handleBack:d,parentSpaceId:p,disabled:a,focus:!0,evaluationErrors:[],getRecordModel:l.context.parentRecordStore.getRecordModel})}):null}var F=o(70203),Z=o(68657),K=o(65187);function B(e){window.__c={n:"NumberInput"};const{value:t,disabled:o,buttonPopupStore:i,onChange:a}=e,l=(0,r.yK)((e=>({wrap:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,borderRadius:4,padding:4}})),[]),s=(0,n.useCallback)((e=>{"="===(0,F.QaF)(e)&&(0,Z.NY)()?(a({type:"formula",value:void 0}),i.setState({open:!0})):a({type:"simple",value:e})}),[a,i]),{store:c}=(0,Z.Cl)({initialValue:null==t?void 0:t.value,onChange:s});return(0,P.jsx)("div",{style:l.wrap,children:(0,P.jsx)(K.Z,{disabled:o,store:c,pasteBehavior:"inline",disableSlashCommands:!0,disableEmojiCommands:!0,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableEmbedMenu:!0,disableMobileActionBar:!0,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEquationInteraction:!0})})}var O=o(53498),R=o(18466),D=o(13991),W=o(32426),E=o(82990),N=o(60682),L=o(14976),H=o(75311),U=o(30387);function z(e){window.__c={n:"ValuePickerValue"};const{value:t,type:o,currentSimpleFormulaValueTokens:n,contextStore:a,context:l}=e,{collectionStore:s,property:c}=l,d=(0,r.yK)((()=>({tokenWrap:{display:"flex",alignItems:"center",flexGrow:1,overflow:"hidden",marginTop:6}})),[]),u=(0,H.M)(s,c),m=(0,i.VK)((()=>(0,Z.NY)()),[]);if("formula"===(null==t?void 0:t.type)&&t.value&&m)return(0,P.jsx)(q,{...e});if("text"===o.type||"number"===o.type)return null;if("date"===o.type||"select"===o.type||"checkbox"===o.type){const e=n[0];return void 0===e?(0,P.jsx)($,{}):(0,P.jsx)("div",{style:d.tokenWrap,children:(0,P.jsx)(O.K,{token:e,contextStore:a,disabled:!0,currentSimpleFormulaValueTokens:n,context:l})})}if("person_array"===o.type||"block_array"===o.type||"select_array"===o.type)return 0===n.length?(0,P.jsx)($,{}):(0,P.jsx)("div",{style:d.tokenWrap,children:u(n,"first").map(((e,t)=>(0,P.jsx)(O.K,{token:e,contextStore:a,disabled:!0,currentSimpleFormulaValueTokens:n,context:l},t)))});(0,p.t1)(o)}function $(){window.__c={n:"ValueEmptyPlaceholder"};const e=(0,r.yK)((e=>({placeholderText:{color:e.lightTextColor}})),[]);return(0,P.jsx)("div",{style:e.placeholderText,children:(0,P.jsx)(m.FormattedMessage,{...U.s.personSelect})})}function q(e){window.__c={n:"MinimalFormulaText"};const{value:t,contextStore:o}=e,a=(0,x.O7)(),l=(0,r.Fg)(),s=(0,r.yK)((e=>({wrap:{display:"flex",alignItems:"center",pointerEvents:"none",fontFamily:E.Z.getCompositeFontFamily(D.SP).githubMono,fontSize:12,flexGrow:1,...E.Z.textOverflowStyle},icon:{width:14,fill:e.mediumIconColor,marginRight:6}})),[]),c=(0,N.kw)(),d=(0,i.VK)((()=>a.KatexStore.getKatex()),[a]),u=(0,i.VK)((()=>o.context.parentRecordStore.getSpaceId()),[o.context.parentRecordStore]),p=(0,i.Kw)(o.compilationResultStore),m=M.x.isSuccess(p)?p.value.valueTypes:void 0,g=(0,n.useMemo)((()=>R.Z.withListenerIgnored((()=>(0,L.IY)({environment:a,textValue:null!=t&&t.value&&u?{value:t.value,spaceId:u}:void 0,parentStore:o.context.parentRecordStore,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,theme:l,emojiType:c,katex:d,parentBlockId:void 0,renderedPageBlockId:void 0,formulaValueTypes:m||[]})))),[t,u,a,o.context.parentRecordStore,c,d,l,m]);return(0,P.jsxs)("div",{style:s.wrap,children:[(0,W.D)(s.icon),g]})}function G(e){window.__c={n:"SimpleFormulaValuePicker"};const{type:t,value:o,disabled:n}=e,a=(0,x.Fy)(),l=!o||"simple"===o.type,s=(0,i.VK)((()=>(0,c.A6)(null==o?void 0:o.value)),[o]),d=(0,r.yK)((e=>({button:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow}})),[]),u=(0,i.qz)(void 0,b.Z);return"number"===t.type&&l?(0,P.jsx)(B,{...e,buttonPopupStore:u}):"text"===t.type?(0,P.jsx)(k.D,{...e}):(0,P.jsx)(h.ZP,{popupType:a.isMobile?w.kQ.SlideUp:w.kQ.Popup,alignmentToOrigin:h.vR.End,placementToOrigin:h.pO.Bottom,originGap:0,buttonPopupStore:u,disabled:n,renderOrigin:t=>(0,P.jsx)(C.S,{disabled:n,variant:"gray",...t,style:d.button,children:(0,P.jsx)(z,{...e,currentSimpleFormulaValueTokens:s})}),render:t=>l?(0,P.jsx)(O.a,{...e,onClose:t.close,currentSimpleFormulaValueTokens:s}):(0,P.jsx)(V,{...e,onClose:t.close})})}var Y=o(28267),Q=o(12455),X=o(73266),J=o(95193),ee=o(35294),te=o(12396),oe=o(57410);function ne(e){window.__c={n:"AutomationPropertyPicker"};const{alreadyHaveProperties:t,availablePropertyIds:o,collectionStore:a,currentValue:l,disabled:s,onChange:c,onRemove:d}=e,u=(0,x.O7)(),p=(0,r.Fg)(),{device:g}=u,y=(0,i.VK)((()=>a.getSchema()??{}),[a]),S=(0,i.VK)((()=>a.getFormat()??{}),[a]),v=(0,i.VK)((()=>l?a.getSchema()[l]:void 0),[l,a]),b=(0,r.yK)((e=>({propertyIcon:{fill:e.lightTextColor,height:"auto",marginRight:4,width:16}})),[]),w=(0,n.useCallback)((()=>o),[o]),k=(0,ee.d)();return(0,P.jsx)(h.ZP,{popupType:k,alignmentToOrigin:h.vR.End,placementToOrigin:h.pO.Bottom,originGap:0,disabled:s,renderOrigin:e=>(0,P.jsx)(C.S,{...e,disabled:s,icon:v?e=>(0,P.jsx)(te.ZP,{icon:void 0,type:v.type,size:16,theme:p,style:{...e,...b.propertyIcon}}):void 0,variant:t||v?v?"default":"gray":"blue",children:v?(0,P.jsx)(P.Fragment,{children:(0,P.jsx)("div",{style:{fontWeight:E.Z.fontWeight.medium,...E.Z.textOverflowStyle},children:v.name})}):t?(0,P.jsx)(m.FormattedMessage,{id:"automations.propertyPicker.buttonPlaceholderAlreadyHaveProperties",defaultMessage:"Edit another property"}):(0,P.jsx)(m.FormattedMessage,{id:"automations.propertyPicker.buttonPlaceholder",defaultMessage:"Edit a property"})}),render:e=>{const t=(0,J.U)({device:g,width:280,paddingTop:4});return(0,P.jsx)(f.Z,{...t,children:(0,P.jsx)(oe.Z,{schema:y,format:S,showRemoveOption:Boolean(d),currentProperty:l,getProperties:w,onAccept:t=>{t&&t!==l?c(t):void 0===t&&(null==d||d(l)),e.close()}})})}})}const ie=(0,m.defineMessages)({replaceActionLabel:{id:"automations.AutomationActionSetPropertiesSection.replaceAction.label",defaultMessage:"Replace with"},appendActionLabel:{id:"automations.AutomationActionSetPropertiesSection.appendAction.label",defaultMessage:"Add"},removeActionLabel:{id:"automations.AutomationActionSetPropertiesSection.removeAction.label",defaultMessage:"Remove"},toggleActionLabel:{id:"automations.AutomationActionSetPropertiesSection.toggleAction.label",defaultMessage:"Toggle"},titlePlaceholder:{id:"automations.AutomationActionSetPropertiesSection.titlePlaceholder",defaultMessage:"Untitled"}});function re(e){window.__c={n:"ButtonAutomationActionSetPropertiesSection"};const{contextStore:t,actionStore:o,collectionStore:r,disabled:a,showSetPropertyActions:l}=e,s=(0,i.VK)((()=>o.id),[o.id]),{maybePersistedTransactionActions:c}=(0,Q.i)(),d=(0,i.VK)((()=>{var e;return(null===(e=o.getConfig())||void 0===e?void 0:e.values)??{}}),[o]),u=(0,i.VK)((()=>{var e;return(null===(e=o.getConfig())||void 0===e?void 0:e.properties)??[]}),[o]),p=(0,n.useMemo)((()=>({properties:u,values:d})),[u,d]),m=(0,n.useCallback)((e=>{const t=u.concat([e]),n={...d,[e]:void 0};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.propertiesChange",perform:e=>{ae({configStore:o.getConfigStore(),properties:t,transaction:e,values:n})}})}),[u,d,c,o]),g=(0,n.useCallback)(((e,t)=>{const n=u.indexOf(e);if(-1===n)return;const i=u.slice(0);i[n]=t;const r={...d,[t]:void 0};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.setProperties",perform:e=>{ae({configStore:o.getConfigStore(),properties:i,transaction:e,values:r})}})}),[u,d,c,o]),y=(0,n.useCallback)((e=>{const t=u.filter((t=>t!==e)),n={...d,[e]:void 0};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.removeProperty",perform:e=>{ae({configStore:o.getConfigStore(),properties:t,transaction:e,values:n})}})}),[u,d,c,o]),h=(0,n.useCallback)(((e,t)=>{const n={...d,[e]:t};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.handleValueChange",perform:e=>{ae({configStore:o.getConfigStore(),properties:u,transaction:e,values:n})}})}),[d,c,o,u]);return(0,P.jsx)(le,{contextStore:t,actionId:s,config:p,onPropertyAdd:m,onPropertyChange:g,onPropertyRemove:y,onPropertyValueChange:h,collectionStore:r,showSetPropertyActions:l,disabled:a})}function ae(e){const{configStore:t,properties:o,transaction:n,values:i}=e;g.sW({store:t,data:{properties:o,values:i},transaction:n})}function le(e){window.__c={n:"AutomationActionSetPropertiesSection"};const{contextStore:t,actionId:o,config:n,collectionStore:l,onPropertyAdd:s,onPropertyChange:c,onPropertyRemove:d,onPropertyValueChange:u,disabled:p,showSetPropertyActions:m}=e,g=(0,r.yK)((e=>({addPropertyValuePlaceholder:{color:e.mediumTextColor,flexGrow:1,textAlign:"right"},addPropertyRow:{display:"flex",alignItems:"center"}})),[]),y=(0,i.VK)((()=>(0,a.cO)({collectionFormat:l.getFormat(),collectionSchema:l.getSchema(),sort:!1,sourcePropertyIds:n.properties})),[l,n.properties]),h=(0,i.VK)((()=>(0,a.cO)({collectionFormat:l.getFormat(),collectionSchema:l.getSchema(),filter:e=>{let[t]=e;return!y.includes(t)}})),[l,y]),f=0===h.length;return(0,P.jsxs)(P.Fragment,{children:[y.length>0&&(0,P.jsx)(se,{availablePropertyIds:h,contextStore:t,actionId:o,config:{properties:y,values:n.values},collectionStore:l,onPropertyChange:c,onPropertyRemove:d,onPropertyValueChange:u,showSetPropertyActions:m,disabled:p}),!p&&!f&&(0,P.jsx)("div",{style:g.addPropertyRow,children:(0,P.jsx)(ne,{availablePropertyIds:h,currentValue:void 0,collectionStore:l,onChange:s,disabled:p,alreadyHaveProperties:y.length>0})})]})}function se(e){window.__c={n:"PropertySectionList"};const{availablePropertyIds:t,contextStore:o,actionId:i,config:a,collectionStore:l,onPropertyChange:s,onPropertyRemove:c,onPropertyValueChange:d,showSetPropertyActions:u,disabled:p}=e,m=(0,n.useRef)(null),g=(0,Y.X)(m),y=(0,X.a)(g),h=(0,r.yK)((()=>({wrap:{alignItems:"center",columnGap:4,display:"grid",gridTemplateColumns:y?"100%":"160px 1fr",minWidth:0,rowGap:y?4:8},propertyValue:{...y?{fontSize:14,marginBlockEnd:16}:{}},lastPropertyValue:{...y?{fontSize:14,marginBlockEnd:0}:{}}})),[y]);return(0,P.jsx)("div",{style:h.wrap,ref:m,children:a.properties.map(((e,n)=>{const r=n===a.properties.length-1;return(0,P.jsx)(ce,{actionId:i,availablePropertyIds:t,collectionStore:l,contextStore:o,disabled:p,onPropertyChange:s,onPropertyRemove:c,onPropertyValueChange:d,property:e,showSetPropertyActions:u,value:a.values[e],valueStyle:r?h.lastPropertyValue:h.propertyValue},e)}))})}function ce(e){window.__c={n:"PropertySection"};const{actionId:t,availablePropertyIds:o,collectionStore:a,contextStore:d,disabled:p,onPropertyChange:g,onPropertyRemove:y,onPropertyValueChange:h,property:f,showSetPropertyActions:S,value:v,valueStyle:x}=e,C={type:"collection",collectionStore:a,property:f},b=(0,m.useIntl)(),w=(0,r.yK)((e=>({propertyName:{},propertyValue:{display:"flex",gap:4,minWidth:50,...x}})),[x]),k=(0,n.useMemo)((()=>{if("title"===f)return b.formatMessage(ie.titlePlaceholder)}),[b,f]),M=(0,i.VK)((()=>{const e=a.getSchema()[f];if(e)return e}),[a,f]),j=(0,i.VK)((()=>{if(M)return(0,c.qW)({table:u.v,id:a.id,spaceId:a.getSpaceId()},f,M)}),[a,M,f]),_=(0,i.VK)((()=>null==M?void 0:M.type),[M]),A=null==v?void 0:v.value,T=(0,i.VK)((()=>(0,s.o9)(v)),[v]),V=(0,i.VK)((()=>d.context.parentRecordStore.getSpaceId()),[d.context.parentRecordStore]),I=(0,i.VK)((()=>d.getContextValuesForAction(t)),[d,t]),F=(0,n.useCallback)((e=>{g(f,e)}),[g,f]),Z=(0,n.useCallback)((()=>y(f)),[y,f]),K=(0,n.useCallback)((e=>{h(f,e)}),[h,f]),B=(0,n.useCallback)((e=>{K({action:e,value:A})}),[A,K]),O=(0,n.useCallback)((e=>{K({action:T,value:e})}),[T,K]);if(!j||!V)return null;const R=me(_);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:w.propertyName,children:(0,P.jsx)(ne,{availablePropertyIds:o,currentValue:f,collectionStore:a,onChange:F,disabled:p,onRemove:Z})}),(0,P.jsxs)("div",{style:w.propertyValue,children:[S&&M&&l.Y[M.type]&&(0,P.jsx)(de,{disabled:p,onChange:B,value:T}),(0,P.jsx)(G,{...R,type:j,value:null==v?void 0:v.value,onChange:O,disabled:p,contextStore:d,context:C,placeholder:k,disableMobileActionBar:!0,formulaTypecheckContextValues:I,disableTemplateVariableMentions:!0})]})]})}function de(e){window.__c={n:"SetPropertyListActionDropdownButton"};const{disabled:t,onChange:o,value:n}=e,i=(0,r.yK)((e=>({button:{boxShadow:e.inputBoxShadow}})),[]),a=(0,ee.d)();return(0,P.jsx)(h.ZP,{popupType:a,alignmentToOrigin:h.vR.End,placementToOrigin:h.pO.Bottom,originGap:0,disabled:t,renderOrigin:e=>(0,P.jsx)(C.S,{...e,disabled:t,style:i.button,variant:"gray",children:(0,P.jsx)(pe,{action:n})}),render:e=>(0,P.jsx)(ue,{onChange:o,parent:e,value:n})})}function ue(e){window.__c={n:"SetPropertyListActionDropdownMenu"};const{value:t,onChange:o,parent:n}=e,i=(0,J.F)({width:250}),r=d.oA(s.E2.map(((e,i)=>({key:i,render:o=>(0,P.jsx)(y.Z,{...o,disabled:!1,title:(0,P.jsx)(pe,{action:e}),checkState:t===e}),action:()=>{e!==t&&o(e),n.close()}}))));return(0,P.jsx)(f.Z,{...i,children:(0,P.jsx)(S.Z,{type:S.i.Vertical,sections:[{key:0,render:e=>(0,P.jsx)(v.Z,{enableActionSheetTitle:!0,...e}),items:r}],initialFocus:0})})}function pe(e){const{action:t}=e;return"replace"===t?(0,P.jsx)(m.FormattedMessage,{...ie.replaceActionLabel}):"append"===t?(0,P.jsx)(m.FormattedMessage,{...ie.appendActionLabel}):"remove"===t?(0,P.jsx)(m.FormattedMessage,{...ie.removeActionLabel}):"toggle"===t?(0,P.jsx)(m.FormattedMessage,{...ie.toggleActionLabel}):void(0,p.t1)(t)}function me(e){return"email"===e||"phone_number"===e||"url"===e?{disableEmojiCommands:!0,disableFormattingAndMentions:!0}:{}}},64973:(e,t,o)=>{o.d(t,{mv:()=>k,pW:()=>w,rn:()=>M});var n=o(67294),i=o(480),r=o(6740),a=o(37989),l=o(86628),s=o(24405),c=o(25651),d=o(37612),u=o(77744),p=o(97880),m=o(9291),g=o(64921),y=o(52275),h=o(78140),f=o(32163),S=o(72495),v=o(61766),x=o(95193),C=o(74197),b=o(85893);function w(e){window.__c={n:"AutomationBaseStepElement"};const{icon:t,onBlur:o,onClick:c,onFocus:d,onMouseDown:p,onMouseEnter:m,onMouseLeave:y,title:h,caption:f,onEdit:S,onDelete:x,disabled:C}=e,{isMobile:w}=(0,i.Fy)(),[M,j]=(0,r.Z)(),[_,A]=(0,a.Z)(),[T,P]=(0,n.useState)(!1),V=T||j||A,I=(0,u.lq)(M,_),F=(0,l.qz)(void 0,v.Z),Z=(0,s.yK)((e=>({button:{position:"relative"},moreButtonWrap:{display:V||w?"block":"none",position:"absolute",right:12,top:14},container:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:8,justifyContent:"center",paddingBlock:16,paddingInline:12},title:{alignItems:"center",display:"flex",flexDirection:"row",gap:6},iconWrap:{flexShrink:0,alignSelf:"baseline",height:"24px",display:"flex",alignItems:"center"},iconStyle:{width:16,height:16,color:e.mediumIconColor},body:{flex:"1 1 auto",fontSize:14,lineHeight:1.3,minWidth:0,whiteSpace:"pre"}})),[V,w]),K=(0,n.useCallback)((e=>{P(!0),m&&m(e)}),[m]),B=(0,n.useCallback)((e=>{P(!1),y&&y(e)}),[y]);return(0,b.jsxs)(g.Z,{onBlur:o,onClick:()=>{null==c||c(F)},onFocus:d,onMouseDown:p,onMouseEnter:K,onMouseLeave:B,style:Z.button,disabled:C,disabledFeedback:C,ref:I,focused:V,children:[!C&&(S||x)&&(0,b.jsx)("div",{style:Z.moreButtonWrap,children:(0,b.jsx)(k,{onEdit:S,onDelete:x,disabled:C,buttonPopupStore:F})}),(0,b.jsxs)("div",{style:Z.container,children:[(0,b.jsxs)("div",{style:Z.title,children:[t&&(0,b.jsx)("div",{"aria-hidden":"true",style:Z.iconWrap,children:t(Z.iconStyle)}),(0,b.jsx)("div",{style:Z.body,children:h})]}),f]})]})}function k(e){window.__c={n:"MoreActionsButton"};const{onDelete:t,onEdit:o,disabled:i,buttonPopupStore:r}=e,a=(0,l.qz)(r,v.Z),s=(0,n.useCallback)((()=>a.setState({open:!1})),[a]),c=(0,n.useMemo)((()=>(0,b.jsx)(M,{onClose:s,onEdit:o,onDelete:t})),[s,t,o]);return(0,b.jsx)(C.f,{actionMenu:c,buttonPopupStore:a,disabled:i})}function M(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,onEdit:o,onDelete:n}=e,i=(0,x.F)(),r=[o?{action:()=>{null==t||t(),o()},key:"edit",render:e=>(0,b.jsx)(y.Z,{...e,icon:(0,c.R)({height:16,width:16}),title:(0,b.jsx)(m.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.edit",defaultMessage:"Edit"})})}:void 0,n?{action:()=>{null==t||t(),n()},key:"delete",render:e=>(0,b.jsx)(y.Z,{...e,icon:(0,d.y)({height:16,width:16}),title:(0,b.jsx)(m.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.delete",defaultMessage:"Delete"})})}:void 0].filter(p.$K);return(0,b.jsx)(h.Z,{...i,children:(0,b.jsx)(f.Z,{type:f.i.Vertical,sections:[{items:r,key:"items",render:e=>(0,b.jsx)(S.Z,{enableActionSheetTitle:!0,topBorder:!0,...e})}],initialFocus:0})})}},73239:(e,t,o)=>{o.d(t,{a:()=>h});var n=o(67294),i=o(86628),r=o(84619),a=o(9291),l=o(31945),s=o(76798),c=o(21396),d=o(61766),u=o(79797),p=o(35294),m=o(40190),g=o(8808),y=o(85893);function h(e){window.__c={n:"AutomationCollectionPicker"};const{actionStore:t,currentValue:o,contextStore:h,onChange:f,disabled:S,dropdownButtonStyle:v,errorMessage:x,skipVariables:C}=e,b=(0,i.qz)(void 0,d.Z),w=(0,i.VK)((()=>o&&"collection"===o.type?u.NW.createChildStore(h.context.parentRecordStore,o.collection):void 0),[o,h.context.parentRecordStore]),k=(0,i.VK)((()=>{if(t&&o&&"variable"===o.type)return h.getContextValueForActionById(t.id,o.id)}),[t,o,h]),M=(0,n.useCallback)((e=>{"collection"!==e.type&&"variable"!==e.type||(f(e),b.reset())}),[f,b]),j=(0,n.useCallback)((()=>b.reset()),[b]),_=(0,p.d)(),A=(0,m.d)({errorMessage:x,hasValue:Boolean(w||k)});return(0,y.jsx)(l.ZP,{buttonPopupStore:b,popupType:_,alignmentToOrigin:l.vR.End,placementToOrigin:l.pO.Bottom,originGap:0,disabled:S,renderOrigin:e=>(0,y.jsx)(m.S,{...A,...e,disabled:S,style:v,children:w?(0,y.jsx)(s.Z,{store:w}):k?(0,y.jsx)(c.F,{format:r.lo.Medium,isSingle:!0,value:k}):(0,y.jsx)(a.FormattedMessage,{id:"automations.databasePicker.buttonPlaceholder",defaultMessage:"Select database"})}),render:e=>(0,y.jsx)(g.L,{actionId:null==t?void 0:t.id,automationContextStore:h,onChange:M,onClose:j,selectedTarget:o,skipPages:!0,skipVariables:C})})}},29180:(e,t,o)=>{o.d(t,{f:()=>C});var n=o(67294),i=o(480),r=o(86628),a=o(72126),l=o(21202),s=o(9291),c=o(40071),d=o(31945),u=o(78140),p=o(32163),m=o(76798),g=o(72495),y=o(79797),h=o(64737),f=o(95193),S=o(35294),v=o(40190),x=o(85893);function C(e){window.__c={n:"AutomationCollectionTemplatePicker"};const{collectionStore:t,currentTemplateId:o,onChange:n,disabled:a,errorMessage:c,dropdownButtonStyle:p}=e,g=(0,i.O7)(),{device:C}=g,w=(0,r.VK)((()=>{if(!t)return;if(o){const e=y.G.createChildStore(t,{id:o,spaceId:t.getSpaceId(),table:l.iU});if(!e.pathIsDead())return e}const e=t.getDefaultTemplatePageStore();return e&&!e.pathIsDead()?e:void 0}),[t,o]),k=(0,S.d)(),M=(0,v.d)({errorMessage:c,hasValue:!0}),j=(0,r.VK)((()=>(0,h.q)(t)),[t]),_=Boolean(o);return(0,x.jsx)(d.ZP,{popupType:k,alignmentToOrigin:d.vR.End,placementToOrigin:d.pO.Bottom,originGap:0,disabled:a,renderOrigin:e=>(0,x.jsx)(v.S,{...M,...e,disabled:a,style:{...p,minWidth:50},children:w&&(_||(0,h.w)(w))?(0,x.jsx)(m.Z,{store:w}):(0,x.jsx)(s.FormattedMessage,{id:"automations.templatePicker.buttonPlaceholder",defaultMessage:"Empty"})}),render:e=>{const o=(0,f.U)({device:C,width:280});return(0,x.jsx)(u.Z,{...o,children:t&&(0,x.jsx)(b,{collectionStore:t,templatePageStores:j,parent:e,onChange:n})})}})}function b(e){window.__c={n:"AutomationCollectionTemplateMenuList"};const{collectionStore:t,templatePageStores:o,parent:l,onChange:d}=e,u=(0,i.O7)(),{device:m}=u,y=(0,r.VK)((()=>t.getDefaultTemplatePageStore()),[t]),h=o.map((e=>{const o={key:e.id,render:o=>(0,n.createElement)(c.Z,{...o,key:e.id,isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:e,isMobile:m.isMobile,locked:!0,isDefault:y===e,onCancelClick:()=>{},draggable:!1}),action:t=>{d(e.id),l.close()}};return o})),f={key:"empty",render:e=>(0,n.createElement)(c.Z,{...e,key:"empty",isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:void 0,isMobile:m.isMobile,locked:!0,onCancelClick:()=>{},draggable:!1}),action:e=>{d(void 0),l.close()}};return(0,x.jsx)(p.Z,{type:p.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,x.jsx)(g.Z,{...e,title:(0,x.jsx)(s.FormattedMessage,{id:"automations.templatePicker.menuHeader",defaultMessage:"Select a template"})}),items:a.oA([...h,y?void 0:f])}]})}},52105:(e,t,o)=>{o.d(t,{W:()=>f,m:()=>S});var n=o(67294),i=o(86628),r=o(76205),a=o(9291),l=o(94166),s=o(6758),c=o(31945),d=o(8982),u=o(78140),p=o(72495),m=o(95193),g=o(35294),y=o(40190),h=o(85893);function f(e){var t;window.__c={n:"AutomationCombinatorFilterPopup"};const{filter:o,onChange:n,noFiltersMessage:i,collectionStore:l,disabled:s}=e,d=(0,g.d)({tabletBehavior:"slideUp"}),u=(null==o||null===(t=o.filters)||void 0===t?void 0:t.length)||0;return(0,h.jsx)(c.ZP,{popupType:d,alignmentToOrigin:c.vR.End,placementToOrigin:c.pO.Bottom,originGap:0,disabled:s,renderOrigin:e=>(0,h.jsx)(y.S,{disabled:s,variant:"gray",...e,onClick:t=>{e.onClick(t),0===u&&n(r.TI)},children:u>0?(0,h.jsx)(a.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",id:"automations.QueryCollectionAction.filterRuleCount.label",values:{ruleCount:u}}):i}),render:e=>(0,h.jsx)(S,{collectionStore:l,disabled:s,filter:o,onChange:n,onClose:()=>e.close()})})}function S(e){window.__c={n:"AutomationCombinatorFilterMenu"};const{filter:t,onChange:o,onClose:c,collectionStore:g}=e,y=(0,i.VK)((()=>g.getSchema()),[g]),f=(0,m.F)({minWidth:300,tabletBehavior:"actionSheet"}),S=(0,n.useCallback)(((e,t)=>o(t)),[o]),v=(0,n.useCallback)((()=>{o(void 0),c()}),[o,c]);return(0,h.jsxs)(u.Z,{...f,children:[(0,h.jsx)(d.D,{children:(0,h.jsx)(s.Pq,{collectionViewId:"Automation.FilterMenu",collectionViewType:"table",combinatorFilter:t||r.hh,index:0,level:0,onChange:S,parentStore:g,schema:y})}),(0,h.jsx)(p.Z,{topBorder:!0,children:(0,h.jsx)(l.Z,{title:(0,h.jsx)(a.FormattedMessage,{defaultMessage:"Delete filter",id:"automations.AutomationCombinatorFilterPopup.deleteFilter.label"}),onClick:v})})]})}},40190:(e,t,o)=>{o.d(t,{S:()=>g,d:()=>y});var n=o(67294),i=o(480),r=o(24405),a=o(42853),l=o(54497),s=o(82990),c=o(24677),d=o(98104),u=o(89728),p=o(26388),m=o(85893);const g=n.forwardRef(((e,t)=>{window.__c={n:"AutomationDropdownButton"};const{variant:o,onClick:g,style:y,icon:h,children:f,disabled:S}=e,v=(0,i.O7)(),x=(0,r.yK)((e=>({button:{..."gray"===o&&{color:e.mediumTextColor},..."blue"===o&&{color:e.blueColor,fontWeight:500},..."error"===o&&{color:e.errorText},maxWidth:"calc(100% + 2px)",marginLeft:1,padding:"0 8px 0 5px",...y},warningIcon:{width:12,height:12,marginLeft:-6,marginLeft:6,fill:e.errorText,color:e.errorText},chevronIcon:{width:10,height:10,marginLeft:4,marginTop:2,fill:e.lightIconColor},spacer:{flexGrow:1}})),[o,y]),C=(0,n.useCallback)((e=>{d.ZH(v),c.ZH(v),null==g||g(e)}),[g,v]);return(0,m.jsx)(p.ZP,{renderTooltip:()=>"error"===o?e.errorMessage:null,placement:p.ug.Bottom,disableTooltip:"error"!==o,delayThreshold:0,render:e=>(0,m.jsxs)(u.Z,{...e,style:x.button,icon:h,onClick:C,ref:t,shouldShrink:!0,disabled:S,disabledFeedback:S,children:[(0,m.jsx)("div",{style:{...s.Z.textOverflowStyle},children:f}),(0,m.jsx)("div",{style:x.spacer}),"error"===o&&(0,l.t)(x.warningIcon),(0,a.i)(x.chevronIcon)]})})}));function y(e){const{errorMessage:t,hasValue:o}=e;return(0,n.useMemo)((()=>t?{variant:"error",errorMessage:t}:o?{variant:"gray"}:{variant:"blue"}),[t,o])}},28607:(e,t,o)=>{o.d(t,{D:()=>a});o(67294);var n=o(24405),i=o(64921),r=o(85893);function a(e){window.__c={n:"AutomationEmptyStepButton"};const{ariaLabel:t,disabled:o,icon:a,onClick:l,title:s}=e,c=(0,n.yK)((e=>({button:{alignItems:"center",background:e.sidebarBackground,border:`1px dashed ${e.stroke.regular}`,borderRadius:6,display:"flex",color:e.accentColors.gray[900],gap:6,justifyContent:"center",padding:16},buttonWrap:{background:e.sidebarBackground,position:"relative"},iconWrap:{fill:e.accentColors.gray[600]},title:{fontSize:14,lineHeight:1.3}})),[]);return(0,r.jsx)("div",{style:c.buttonWrap,children:(0,r.jsxs)(i.Z,{ariaLabel:t,disabled:o,disabledFeedback:o,onClick:l,style:c.button,children:[a&&(0,r.jsx)("div",{"aria-hidden":"true",style:c.iconWrap,children:a}),(0,r.jsx)("div",{style:c.title,children:s})]})})}},55950:(e,t,o)=>{o.d(t,{_v:()=>Ie,HC:()=>Pe,L5:()=>Te,RD:()=>Ae});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(47453),s=o(82990),c=o(9291),d=o(31945),u=o(73063),p=o(91537),m=o(12455),g=o(73266),y=o(35294),h=o(28607),f=(o(21703),o(97880)),S=o(52275),v=o(79131),x=o(61766),C=o(45452),b=o(47043),w=o(10383),k=o(28751),M=o(70203),j=o(9953),_=o(82530),A=o(78140),T=o(32163),P=o(72495),V=o(72865),I=o(21273),F=o(95193),Z=o(20804),K=o(40190),B=o(80253),O=o(85893);const R=(0,c.defineMessages)({codeLabel:{defaultMessage:"Code",id:"automations.AssistantAction.codeLabel"},promptLabel:{defaultMessage:"Prompt",id:"automations.AssistantAction.promptLabel"},humanLabel:{defaultMessage:"User",id:"automations.AssistantAction.humanLabel"},descriptionLabel:{defaultMessage:"Description",id:"automations.AssistantAction.descriptionLabel"}});function D(e){window.__c={n:"AssistantTypeDropdownButton"};const{currentOption:t,disabled:o,onChange:i}=e,a=(0,c.useIntl)(),l=(0,y.d)(),s=(0,r.qz)(void 0,x.Z),u=(0,n.useCallback)((e=>{i&&e!==t&&i(e),s.setState({open:!1})}),[s,t,i]);return(0,O.jsx)(d.ZP,{alignmentToOrigin:d.vR.End,buttonPopupStore:s,disabled:o,originGap:0,placementToOrigin:d.pO.Bottom,popupType:l,render:()=>(0,O.jsx)(W,{currentOption:t,onChange:u}),renderOrigin:e=>(0,O.jsx)(K.S,{...e,disabled:o,variant:"gray",children:a.formatMessage(E(t))})})}function W(e){window.__c={n:"AssistantTypeDropdownMenu"};const{currentOption:t,onChange:o}=e,n=(0,c.useIntl)(),i=(0,F.F)({maxWidth:360}),r=["prompt","code"].map((e=>({key:e,render:o=>(0,O.jsx)(S.Z,{...o,checkState:t===e,title:n.formatMessage(E(e))}),action:()=>null==o?void 0:o(e)})));return(0,O.jsx)(A.Z,{...i,children:(0,O.jsx)(T.Z,{initialFocus:0,sections:[{key:0,render:e=>(0,O.jsx)(P.Z,{enableActionSheetTitle:!0,...e}),items:r}],type:T.i.Vertical})})}function E(e){switch(e){case"code":return R.codeLabel;case"prompt":return R.promptLabel;case"human":return R.humanLabel}}function N(e){window.__c={n:"ActionTitle"};const{actionStore:t,disabled:o,value:n,onChange:i}=e,l=(0,r.VK)((()=>t.getType()),[t]),s=(0,a.yK)((()=>({actionTitle:{display:"flex",gap:"0.5em",alignItems:"center",height:"24px"}})),[]);if(!l)return null;const d=(0,k.z)(l);return(0,O.jsxs)("div",{style:s.actionTitle,children:[(0,O.jsx)(c.FormattedMessage,{...d.display.name}),(0,O.jsx)(D,{currentOption:n,disabled:o,onChange:i})]})}var L=o(51592),H=o(41301),U=o(64737),z=o(32984),$=o(73239),q=o(29180);function G(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,errorMessage:i,onChange:l,value:d}=e,u=(0,a.yK)((()=>({b:{fontWeight:s.Z.fontWeight.medium},picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]),p=(0,r.VK)((()=>{let e;if("collection"===(null==d?void 0:d.type)){const o=t.getRecordModel(d.collection);e=null==o?void 0:o.getDatabaseType()}return(0,L.sN)(e)}),[t,d]);return(0,O.jsxs)("div",{style:u.title,children:[(0,O.jsx)(c.FormattedMessage,{defaultMessage:"<span>Add <b>{itemType}</b> to </span>{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{b:e=>(0,O.jsx)("b",{style:u.b,children:e}),collectionPicker:(0,O.jsx)("div",{style:u.picker,children:(0,O.jsx)($.a,{actionStore:t,contextStore:o,currentValue:d,disabled:n,dropdownButtonStyle:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},errorMessage:i,onChange:l,skipVariables:!0})}),itemType:p,span:e=>(0,O.jsx)("span",{style:u.span,children:e})}})," "]})}function Y(e){window.__c={n:"CollectionTemplateTitle"};const{collectionStore:t,disabled:o,errorMessage:n,onChange:i,value:r}=e,l=(0,a.yK)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]);return(0,O.jsx)("div",{style:l.title,children:(0,O.jsx)(c.FormattedMessage,{defaultMessage:"<span>as </span>{collectionTemplatePicker}",id:"automations.CreatePageActionV2.header.template",values:{collectionTemplatePicker:(0,O.jsx)(q.f,{collectionStore:t,currentTemplateId:r,disabled:o,dropdownButtonStyle:{height:"auto",marginBlock:-6,marginInline:-5,paddingBlock:6,paddingInline:5},errorMessage:n,onChange:i}),span:e=>(0,O.jsx)("span",{style:l.span,children:e})}})})}var Q=o(26612),X=o(98963),J=o(19471);const ee=(0,c.defineMessages)({confirmationMessageLabel:{defaultMessage:"Confirmation message",id:"automations.BaseModalAction.confirmationMessageLabel"},continueButtonTextLabel:{defaultMessage:"Continue button text",id:"automations.BaseModalAction.continueButtonTextLabel"},cancelButtonTextLabel:{defaultMessage:"Cancel button text",id:"automations.BaseModalAction.cancelButtonTextLabel"}});var te=o(33732),oe=o(48309);function ne(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,errorMessage:i,onChange:r,value:l}=e,s=(0,a.yK)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]);return(0,O.jsxs)("div",{style:s.title,children:[(0,O.jsx)(c.FormattedMessage,{defaultMessage:"<span>Open </span>{pagePicker}",id:"automations.OpenPageAction.action.title",values:{pagePicker:(0,O.jsx)("div",{style:s.picker,children:(0,O.jsx)(oe.s,{actionStore:t,contextStore:o,disabled:n,dropdownButtonStyle:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},errorMessage:i,onChange:r,target:l})}),span:e=>(0,O.jsx)("span",{style:s.span,children:e})}})," "]})}function ie(e){window.__c={n:"PeekModeTitle"};const{actionStore:t,disabled:o,onChange:n}=e,i=(0,a.yK)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]),l=(0,r.VK)((()=>t.getOpenPageIn()),[t]);return(0,O.jsx)("div",{style:i.title,children:(0,O.jsx)(c.FormattedMessage,{defaultMessage:"<span>in </span>{peekModePicker}",id:"automations.OpenPageAction.peekMode.title",values:{peekModePicker:(0,O.jsx)("div",{style:i.picker,children:(0,O.jsx)(re,{disabled:o,dropdownButtonStyle:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},onChange:n,value:l})}),span:e=>(0,O.jsx)("span",{style:i.span,children:e})}})})}function re(e){window.__c={n:"AutomationPeekModePicker"};const{disabled:t,dropdownButtonStyle:o,onChange:i,value:l}=e,s=(0,a.Fg)(),c=(0,r.qz)(void 0,x.Z),u=(0,r.VK)((()=>(0,te.v)({currentViewType:void 0,theme:s}).find((e=>e.key===l))),[l,s]),p=(0,n.useCallback)((()=>c.reset()),[c]),m=(0,n.useCallback)((e=>{e!==(null==u?void 0:u.key)&&i(e),p()}),[p,null==u?void 0:u.key,i]),g=(0,y.d)();return u?(0,O.jsx)(d.ZP,{alignmentToOrigin:d.vR.End,buttonPopupStore:c,disabled:t,originGap:0,placementToOrigin:d.pO.Bottom,popupType:g,renderOrigin:e=>(0,O.jsx)(K.S,{...e,disabled:t,style:o,variant:"gray",children:u.title}),render:e=>(0,O.jsx)(ae,{onChange:m,value:l})}):null}function ae(e){window.__c={n:"PeekModeMenu"};const{onChange:t,value:o}=e,n=(0,a.Fg)(),i=(0,a.yK)((()=>({menuItem:{paddingBlock:8}})),[]),l=(0,F.F)({maxWidth:360,width:280}),s=(0,r.VK)((()=>(0,te.v)({currentViewType:void 0,theme:n}).map(((e,n)=>({action:()=>t(e.key),key:n,render:t=>(0,O.jsx)(S.Z,{...t,body:e.body,caption:e.caption,checkState:o===e.key,disabled:!1,icon:e.icon,style:i.menuItem,title:e.title})})))),[t,i.menuItem,n,o]),c=[{key:0,render:e=>(0,O.jsx)(P.Z,{enableActionSheetTitle:!0,...e}),items:s}];return(0,O.jsx)(A.Z,{...l,children:(0,O.jsx)(T.Z,{initialFocus:0,sections:c,type:T.i.Vertical})})}var le=o(67174);const se={create_page:function(e){window.__c={n:"CreatePageAction"};const{actionStore:t}=e,{automationContextStore:o,disabled:i,maybePersistedTransactionActions:a,suppressActionErrors:l}=(0,m.i)(),s=(0,k.z)("create_page"),{display:c}=s,[d,u]=(0,r.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),[p,g]=(0,r.VK)((()=>{const e=t.getCollectionStore();return null!=e&&e.isDefined()?[e,{collection:e.getSpaceShardedPointer(),type:"collection"}]:[void 0,void 0]}),[t]),y=(0,r.VK)((()=>(0,U.q)(p).length>0),[p]),h=(0,r.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.template_page_id}),[t]),S=(0,n.useMemo)((()=>({values:u??{},properties:d??[]})),[u,d]),v=(0,r.qz)(void 0,x.Z),C=(0,n.useCallback)((()=>v.reset()),[v]),b=(0,n.useMemo)((()=>(0,O.jsx)(Z.e,{actionStore:t,closeMenu:C})),[t,C]),w=(0,n.useCallback)((e=>{"collection"===e.type&&a.createAndCommit({perform:o=>{j.sW({data:{collection:e.collection,properties:["title"],template_page_id:null,values:null},store:t.getConfigStore(),transaction:o})},userAction:"CreatePageAction.setCollection"})}),[t,a]),M=(0,n.useCallback)((e=>{const{properties:o,values:n}=S;let i=!1;if(e&&o&&1===o.length&&o.includes("title")){var r;const e=null==n?void 0:n.title;e&&null!==(r=e.value)&&void 0!==r&&r.value||(i=!0)}a.createAndCommit({perform:o=>{j.sW({store:t.getConfigStore(),data:{template_page_id:e??null,...i&&{properties:[]}},transaction:o})},userAction:"CreatePageAction.onTemplateChange"})}),[t,a,S]),_=(0,n.useMemo)((()=>!l.includes(t.id)),[l,t]),A=(0,H.TU)({actionId:t.id,contextStore:o,errorKey:"collection",shouldShow:_}),T=(0,H.TU)({actionId:t.id,contextStore:o,errorKey:"template",shouldShow:_});if(!o)return null;const P=Boolean(i);return(0,O.jsxs)(B.Ao,{actionMenu:b,buttonPopupStore:v,disabled:P,children:[(0,O.jsxs)(B.vu,{disabled:P,display:c,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:[(0,O.jsx)(G,{actionStore:t,automationContextStore:o,disabled:P,errorMessage:A,onChange:w,value:g}),(0,f.$K)(p)&&y&&(0,O.jsx)(Y,{collectionStore:p,disabled:P,errorMessage:T,onChange:M,value:h})]}),p&&(0,O.jsx)(B.R7,{disabled:P,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,O.jsx)(z.QF,{actionStore:t,collectionStore:p,contextStore:o,disabled:P,showSetPropertyActions:!1})})]})},update_pages:o(26247).B,query_collection:()=>null,open_page:function(e){window.__c={n:"OpenPageAction"};const{actionStore:t}=e,{automationContextStore:o,disabled:i,maybePersistedTransactionActions:a,suppressActionErrors:l}=(0,m.i)(),s=(0,r.qz)(void 0,x.Z),c=(0,k.z)("open_page"),{display:d}=c,u=(0,r.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]),p=(0,n.useMemo)((()=>({headerWrap:{paddingInlineEnd:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}})),[]),g=(0,n.useCallback)((e=>{a.createAndCommit({perform:o=>{j.sW({store:t.getConfigStore(),data:{target:e},transaction:o})},userAction:"OpenPageAction.setTarget"})}),[a,t]),y=(0,n.useCallback)((e=>{a.createAndCommit({perform:o=>{j.sW({store:t.getConfigStore(),data:{open_in:e},transaction:o})},userAction:"OpenPageAction.setPeekMode"})}),[a,t]),h=(0,n.useCallback)((()=>s.reset()),[s]),f=(0,n.useMemo)((()=>!l.includes(t.id)),[l,t]),S=(0,H.TU)({actionId:t.id,contextStore:o,shouldShow:f}),v=(0,n.useMemo)((()=>(0,O.jsx)(Z.e,{actionStore:t,closeMenu:h})),[t,h]);if(!o)return null;const C=Boolean(i);return(0,O.jsx)(B.Ao,{actionMenu:v,buttonPopupStore:s,children:(0,O.jsxs)(B.vu,{disabled:C,display:d,styles:p,children:[(0,O.jsx)(ne,{actionStore:t,automationContextStore:o,disabled:C,errorMessage:S,onChange:g,value:u}),(0,O.jsx)(ie,{actionStore:t,disabled:C,onChange:y})]})})},duplicate_blocks:Q.JM,modal_confirmation:function(e){window.__c={n:"ModalConfirmationAction"};const{actionStore:t}=e,o=(0,c.useIntl)(),{automationContextStore:l,disabled:d,maybePersistedTransactionActions:u}=(0,m.i)(),p=function(){const{isMobile:e}=(0,i.Fy)();return(0,a.yK)((t=>({wrap:{display:"flex",flexDirection:"column",gap:10},inputLabel:{color:t.lightTextColor,fontSize:e?14:12,lineHeight:1.3,fontWeight:s.Z.fontWeight.medium},input:{backgroundColor:t.contentBackground,paddingTop:6,paddingBottom:6}})),[e])}(),g=(0,k.z)("modal_confirmation"),y=(0,r.qz)(void 0,x.Z),h=(0,n.useCallback)((()=>y.reset()),[y]),f=(0,n.useMemo)((()=>(0,O.jsx)(Z.e,{actionStore:t,closeMenu:h})),[t,h]),S=(0,r.VK)((()=>t.getConfigStore().getKeyStore("text")),[t]),v=(0,r.VK)((()=>S.getValue()),[S]),C=(0,r.VK)((()=>t.getConfigStore().getKeyStore("continue_button").getKeyStore("text")),[t]),b=(0,r.VK)((()=>t.getConfigStore().getKeyStore("cancel_button").getKeyStore("text")),[t]),w=(0,n.useCallback)((e=>{u.createAndCommit({userAction:"BaseModalAction.handleTextChange",perform:t=>{j.sO({store:S,value:e,transaction:t})}})}),[u,S]);if(!l)return null;const M=Boolean(d);return(0,O.jsxs)(B.Ao,{actionMenu:f,buttonPopupStore:y,disabled:M,children:[(0,O.jsx)(B.vu,{disabled:M,display:g.display,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,O.jsx)(c.FormattedMessage,{...g.display.name})}),(0,O.jsxs)(B.R7,{disabled:M,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:[(0,O.jsx)("label",{style:p.inputLabel,children:(0,O.jsx)(c.FormattedMessage,{...ee.confirmationMessageLabel})}),(0,O.jsx)(V.D,{disabled:M,value:v,onChange:w,multiline:!0,placeholder:o.formatMessage(ee.confirmationMessageLabel),disableFormattingAndMentions:!0,disableMobileActionBar:!0}),(0,O.jsx)("label",{style:p.inputLabel,children:(0,O.jsx)(c.FormattedMessage,{...ee.continueButtonTextLabel})}),(0,O.jsx)(J.W_,{disabled:M,maxlength:X.OO,style:p.input,store:C}),(0,O.jsx)("label",{style:p.inputLabel,children:(0,O.jsx)(c.FormattedMessage,{...ee.cancelButtonTextLabel})}),(0,O.jsx)(J.W_,{disabled:M,maxlength:X.OO,style:p.input,store:b})]})]})},slack_notification:le.e,assistant:function(e){window.__c={n:"AssistantAction"};const{actionStore:t}=e,o=(0,c.useIntl)(),l=(0,i.O7)(),s=(0,r.VK)((()=>I.Z.isJSAssistantEnabled()),[]),{disabled:d,maybePersistedTransactionActions:u}=(0,m.i)(),p=(0,a.yK)((e=>({wrap:{display:"flex",flexDirection:"column",gap:10},plainTextInput:{backgroundColor:e.contentBackground,paddingTop:6,paddingBottom:6},sectionMenuItemTitle:{paddingLeft:0}})),[]),g=(0,r.VK)((()=>t.getType()),[t]),y=(0,r.VK)((()=>t.getConfigStore().getKeyStore("description")),[t]),h=(0,r.VK)((()=>({type:"simple",value:(0,M.TPx)(y.getValue())})),[y],{useDeepEqual:!0}),f=(0,r.VK)((()=>{var e;return(null===(e=t.getConfig())||void 0===e?void 0:e.type)||"prompt"}),[t]),S=(0,r.VK)((()=>t.getConfigStore().getKeyStore("value")),[t]),v=(0,r.VK)((()=>({type:"simple",value:(0,M.TPx)(S.getValue())})),[S],{useDeepEqual:!0}),C=(0,r.qz)(void 0,x.Z),b=(0,n.useCallback)((()=>C.reset()),[C]),w=(0,n.useMemo)((()=>(0,O.jsx)(Z.e,{actionStore:t,closeMenu:b})),[t,b]),A=(0,n.useCallback)((e=>{u.createAndCommit({userAction:"AssistantAction.handleAssistantTypeChange",perform:o=>{j.sO({store:t.getConfigStore().getKeyStore("type"),value:e,transaction:o})}})}),[u,t]),T=(0,n.useCallback)((e=>{_.createAndCommit({userAction:"AssistantAction.handleDescriptionChange",environment:l,perform:t=>{j.sO({store:y,value:(0,M.QaF)(null==e?void 0:e.value),transaction:t})}})}),[l,y]),P=(0,n.useCallback)((e=>{_.createAndCommit({userAction:"AssistantAction.handleValueChange",environment:l,perform:t=>{j.sO({store:S,value:(0,M.QaF)(null==e?void 0:e.value),transaction:t})}})}),[l,S]);if(!s)return null;if(!g)return null;const F=(0,k.z)(g),K=Boolean(d),{display:D}=F;return(0,O.jsxs)(B.Ao,{actionMenu:w,buttonPopupStore:C,disabled:K,children:[(0,O.jsx)(B.vu,{disabled:K,display:D,children:(0,O.jsx)(N,{actionStore:t,disabled:K,value:f,onChange:A})}),(0,O.jsx)(B.R7,{disabled:K,children:(0,O.jsxs)("div",{style:p.wrap,children:[(0,O.jsx)(V.D,{disabled:K,value:h,onChange:T,placeholder:o.formatMessage(R.descriptionLabel),disableFormattingAndMentions:!0,disableMobileActionBar:!0}),(0,O.jsx)(V.D,{disabled:K,value:v,onChange:P,placeholder:o.formatMessage(E(f)),multiline:!0,disableFormattingAndMentions:!0,disableMobileActionBar:!0,code:"code"===f})]})})]})}};function ce(e){let{isEditable:t}=e;window.__c={n:"AutomationWorkflowEditorActionSection"};const{automationContextStore:o,disabled:n}=(0,m.i)(),{isMobile:l}=(0,i.Fy)(),d=(0,g.Z)(),u=(0,r.VK)((()=>{var e;return((null==o||null===(e=o.context.automationStore)||void 0===e?void 0:e.getActionStores())??[]).map((e=>e.isDefined()&&e.hasConcern("display")?e:null)).filter(f.K0)}),[o]),y=u.length>0,h=(0,a.yK)((e=>({section:{display:"flex",flexDirection:"column",gap:6},header:{alignItems:"center",display:"flex",flexDirection:"row"},headerAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0},title:{color:e.lightTextColor,fontSize:l?14:12,lineHeight:1.3,fontWeight:s.Z.fontWeight.medium}})),[l]),S=!n&&t&&y,v=t&&!d;return(0,O.jsxs)("section",{style:h.section,children:[(0,O.jsxs)("header",{style:h.header,children:[(0,O.jsx)("div",{style:h.title,children:(0,O.jsx)(c.FormattedMessage,{...p.s.actionTitle})}),S&&(0,O.jsx)("div",{style:h.headerAdd,children:(0,O.jsx)(ge,{disabled:n,hasAnyActions:y,variant:"icon"})})]}),v?(0,O.jsx)(ue,{actionStores:u}):(0,O.jsx)(de,{actionStores:u}),!n&&t&&(0,O.jsx)("footer",{children:(0,O.jsx)(ge,{disabled:n,hasAnyActions:y,variant:y?"menuitem":"button"})})]})}function de(e){let{actionStores:t}=e;window.__c={n:"AutomationActionList"};const o=Te();return(0,O.jsx)("div",{children:t.map((e=>(0,O.jsx)("div",{className:o,children:(0,O.jsx)(pe,{actionStore:e})},e.id)))})}function ue(e){let{actionStores:t}=e;window.__c={n:"DraggableAutomationActionList"};const{automationContextStore:o,disabled:i,onActionDragStart:a,onActionDragEnd:l,maybePersistedTransactionActions:s}=(0,m.i)(),c=(0,r.VK)((()=>{var e;const t=(null==o||null===(e=o.context.automationStore)||void 0===e?void 0:e.getActionStores())??[];return new Map(t.map((e=>{if(e.isDefined()&&e.hasConcern("display"))return[e.id,e]})).filter(f.$K))}),[null==o?void 0:o.context.automationStore]),d=(0,n.useMemo)((()=>Array.from(c.keys())),[c]),u=(0,r.qz)(void 0,C.Z);(0,r.VK)((()=>{const e=u.getState();if(e.willDrag){const t=c.get(e.draggingKey);(0,f.$K)(t)&&(0,f.$K)(a)&&a(t)}else e.willDrag||e.isDragging||null==l||l()}),[c,u,l,a]);const p=(0,n.useCallback)((e=>{if(!o)throw new Error("Error reordering actions. Could not find automationContextStore");s.createAndCommit({userAction:"AutomationButtonAction.moveAction",perform:t=>{b.kM({clientContext:o.context,newActionIds:e,transaction:t})}})}),[o,s]),g=(0,n.useCallback)(((e,t)=>{const o=c.get(e);return(0,f.$K)(o)?(0,O.jsx)(pe,{actionStore:o},o.id):null}),[c]);return t.length>0?(0,O.jsx)(me,{draggableListStore:u,hasDragging:!i,keys:d,onDrop:p,renderKey:g}):null}function pe(e){window.__c={n:"AutomationActionListItem"};const{actionStore:t}=e,o=(0,r.VK)((()=>t.getType()),[t]);if(!o)return null;const n=se[o];return(0,O.jsx)(n,{actionStore:t})}function me(e){window.__c={n:"DragList"};const{draggableListStore:t,hasDragging:o,keys:n,onDrop:i,renderKey:r,ruleTopOffset:a}=e,l=Ae({ruleTopOffset:a}),s=Te();return(0,O.jsxs)("div",{style:l.wrap,children:[(0,O.jsx)("div",{style:l.verticalRule}),(0,O.jsx)(v.ZP,{childClassName:s,direction:"vertical",disabled:!o,keys:n,onDrop:i,renderKey:r,store:t,style:l.list})]})}function ge(e){window.__c={n:"AddActionButton"};const{disabled:t,hasAnyActions:o,variant:s}=e,{isMobile:m}=(0,i.Fy)(),g=(0,y.d)(),f=(0,c.useIntl)(),v=(0,n.useMemo)((()=>({availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"})),[]),C=(0,r.qz)(void 0,x.Z),b=(0,n.useCallback)((()=>C.reset()),[C]),k=(0,a.yK)((e=>({buttonWrap:{boxShadow:"initial",background:"transparent"},button:{color:e.mediumTextColor,fill:e.mediumIconColor,margin:0,width:"100%"},buttonIcon:{height:m?18:16,width:24}})),[m]),M=Boolean(t);return(0,O.jsx)(d.ZP,{alignmentToOrigin:d.vR.Start,buttonPopupStore:C,disabled:M,placementToOrigin:d.pO.Bottom,popupType:g,render:()=>(0,O.jsx)(w.Z,{initialState:v,onClose:b}),renderOrigin:e=>"icon"===s?(0,O.jsx)(u.Z,{...e,ariaLabel:f.formatMessage(p.s.addActionAriaLabel),disabled:M,disabledFeedback:M,icon:l.R}):"button"===s?(0,O.jsx)(h.D,{...e,ariaLabel:f.formatMessage(p.s.addActionAriaLabel),disabled:M,icon:(0,l.R)({height:24,width:12}),title:(0,O.jsx)(c.FormattedMessage,{...p.s.addActionLabel})}):(0,O.jsx)(S.Z,{...e,buttonStyle:k.button,disabled:M,disabledFeedback:M,focused:!1,icon:(0,l.R)(k.buttonIcon),style:k.buttonWrap,title:o?(0,O.jsx)(c.FormattedMessage,{id:"automations.addActionButton.nonEmpty.label",defaultMessage:"Add another step"}):(0,O.jsx)(c.FormattedMessage,{id:"automations.addActionButton.empty.label",defaultMessage:"Add a step"})})})}const ye=(0,o(45238).I)("cursorArrowClick2",{viewBox:"0 0 20 20",svg:(0,O.jsxs)("g",{children:[(0,O.jsx)("path",{d:"M0 10.18c0 3.74 2.158 7.04 5.107 8.661 1.026.577 1.875-.79.743-1.445-2.452-1.367-4.18-4.082-4.18-7.217 0-4.609 3.672-8.3 8.281-8.3 4.61 0 8.31 3.691 8.31 8.3 0 .586.45.87.88.87.4 0 .78-.293.78-.87 0-5.449-4.52-9.96-9.97-9.96C4.511.218 0 4.73 0 10.178Z"}),(0,O.jsx)("path",{d:"M3.945 10.18c0 2.177 1.192 4.003 2.618 4.921.986.664 1.835-.654 1.005-1.22a4.41 4.41 0 0 1-2.011-3.702A4.38 4.38 0 0 1 9.95 5.765c2.442 0 4.326 1.944 4.414 4.414.02.45.362.801.81.801.45 0 .802-.351.802-.8 0-3.301-2.725-6.026-6.026-6.026-3.281 0-6.006 2.725-6.006 6.025Z"}),(0,O.jsx)("path",{d:"M9.58 17.25c-.01.38.44.508.684.263l1.494-1.494 1.67 4.121c.078.186.273.274.449.205l.967-.39c.176-.078.244-.283.156-.469l-1.748-4.063 2.1-.078c.37-.02.546-.38.283-.654l-5.332-5.488c-.254-.254-.625-.108-.635.254Z"})]})});var he=o(56812),fe=o(66315);function Se(){window.__c={n:"ButtonClickedTrigger"};const e=(0,c.useIntl)(),{automationContextStore:t}=(0,m.i)();if(!xe((0,r.VK)((()=>null==t?void 0:t.context.automationStore),[t])))return null;const o=e.formatMessage(he.Bo.triggerButtonClicked,{b:ve});return(0,O.jsx)(fe.R,{icon:ye,tooltip:o,children:o})}function ve(e){return(0,O.jsx)("span",{style:{fontWeight:s.Z.fontWeight.medium},children:e})}function xe(e){return(0,r.VK)((()=>Boolean(null==e?void 0:e.isTriggerType("button"))),[e])}var Ce=o(53570);function be(){window.__c={n:"PageAddedTrigger"};const{automationStore:e}=(0,m.i)(),{removePageAddedTrigger:t}=(0,Ce.i)(),o=(0,c.useIntl)(),n=(0,a.yK)((()=>({title:{fontWeight:s.Z.fontWeight.medium}})),[]);if(!we(e))return null;const i=he.Mz(o);return(0,O.jsx)(fe.R,{icon:l.R,onDelete:t,tooltip:i,children:(0,O.jsx)("div",{style:n.title,children:i})})}function we(e){return(0,r.VK)((()=>{if(!(null!=e&&e.isTriggerType("event")||null!=e&&e.isTriggerType("notification_event")))return!1;const t=e.getEventConfiguration();return Boolean(null==t?void 0:t.pagesAdded)}),[e])}var ke=o(61036),Me=o(55307);const je="automation-list-item",_e="automation-list-item-narrow";function Ae(e){const{ruleTopOffset:t}=e,o=(0,g.Z)();return(0,a.yK)((e=>({wrap:{position:"relative"},list:{marginBottom:o?0:-8},verticalRule:{background:e.stroke.regular,bottom:0,left:20,position:"absolute",top:t??0,width:1}})),[o,t])}function Te(){const e=(0,g.Z)();return(0,n.useMemo)((()=>`${je} ${e?_e:""}`),[e])}function Pe(e){window.__c={n:"ListItem"};const{children:t}=e,o=Te();return(0,O.jsx)("div",{className:o,children:t})}function Ve(e){window.__c={n:"List"};const{children:t,ruleTopOffset:o}=e,n=Ae({ruleTopOffset:o});return(0,O.jsxs)("div",{style:n.wrap,children:[(0,O.jsx)("div",{style:n.verticalRule}),(0,O.jsx)("div",{style:n.list,children:t})]})}function Ie(e){window.__c={n:"AutomationWorkflowEditor"};const{areActionsEditable:t,areTriggersEditable:o}=e,{isMobile:n}=(0,i.Fy)(),r=(0,a.yK)((e=>({verticalRule:{background:e.stroke.regular,marginLeft:20,height:36,width:1},container:{padding:n?"16px 16px 0px 16px":void 0}})),[n]);return(0,O.jsxs)("div",{style:r.container,children:[(0,O.jsx)(Ze,{isEditable:o}),(0,O.jsx)("div",{style:r.verticalRule}),(0,O.jsx)(ce,{isEditable:t})]})}function Fe(e){window.__c={n:"AddTriggerButton"};const{variant:t}=e,o=(0,y.d)(),i=(0,c.useIntl)(),r=(0,n.useMemo)((()=>({type:"eventTriggers"})),[]);return(0,O.jsx)(d.ZP,{alignmentToOrigin:d.vR.End,placementToOrigin:d.pO.Bottom,popupType:o,render:e=>(0,O.jsx)(Me.Z,{initialState:r,buttonPopupParent:e}),renderOrigin:e=>"icon"===t?(0,O.jsx)(u.Z,{...e,ariaLabel:i.formatMessage(p.s.addTriggerAriaLabel),icon:l.R}):(0,O.jsx)(h.D,{...e,ariaLabel:i.formatMessage(p.s.addTriggerAriaLabel),icon:(0,l.R)({height:24,width:12}),title:(0,O.jsx)(c.FormattedMessage,{...p.s.addTriggerLabel})})})}function Ze(e){window.__c={n:"AutomationTriggerList"};const{isEditable:t}=e,{isMobile:o}=(0,i.Fy)(),{showAnyPropertyTriggers:n,showButtonClickedTrigger:l,showPageAddedTrigger:d}=function(){const{automationContextStore:e}=(0,m.i)(),t=(0,r.VK)((()=>null==e?void 0:e.context.automationStore),[e]),o=xe(t),n=we(t),i=(0,ke.Zr)(t);return{showAnyPropertyTriggers:i,showPageAddedTrigger:n,showButtonClickedTrigger:o}}(),u=n||l||d,g=(0,a.yK)((e=>({section:{display:"flex",flexDirection:"column",gap:6},header:{alignItems:"center",display:"flex",flexDirection:"row"},headerAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0,visibility:u?void 0:"hidden"},title:{color:e.lightTextColor,fontSize:o?14:12,lineHeight:1.3,fontWeight:s.Z.fontWeight.medium}})),[u,o]);return(0,O.jsxs)("section",{style:g.section,children:[(0,O.jsxs)("header",{style:g.header,children:[(0,O.jsx)("div",{style:g.title,children:(0,O.jsx)(c.FormattedMessage,{...p.s.triggerTitle})}),t&&(0,O.jsx)("div",{style:g.headerAdd,children:(0,O.jsx)(Fe,{variant:"icon"})})]}),(0,O.jsxs)(Ve,{children:[l&&(0,O.jsx)(Se,{}),d&&(0,O.jsx)(be,{}),n&&(0,O.jsx)(ke.Dl,{}),!u&&t&&(0,O.jsx)(Fe,{variant:"button"})]})]})}},48309:(e,t,o)=>{o.d(t,{s:()=>h});var n=o(67294),i=o(86628),r=o(84619),a=o(9291),l=o(31945),s=o(76798),c=o(21396),d=o(61766),u=o(79797),p=o(35294),m=o(40190),g=o(8808),y=o(85893);function h(e){window.__c={n:"AutomationPagePicker"};const{contextStore:t,actionStore:o,target:h,onChange:f,disabled:S,errorMessage:v,dropdownButtonStyle:x}=e,C=(0,i.qz)(void 0,d.Z),b=(0,i.VK)((()=>{if(h&&"variable"===h.type)return t.getContextValueForActionById(o.id,h.id)}),[h,t,o.id]),w=(0,p.d)(),k=(0,m.d)({errorMessage:v,hasValue:Boolean(h)}),M=(0,n.useCallback)((e=>{"page"!==e.type&&"variable"!==e.type||(f(e),C.reset())}),[f,C]),j=(0,n.useCallback)((()=>C.reset()),[C]);return(0,y.jsx)(l.ZP,{buttonPopupStore:C,popupType:w,alignmentToOrigin:l.vR.End,placementToOrigin:l.pO.Bottom,originGap:0,disabled:S,renderOrigin:e=>(0,y.jsx)(m.S,{...e,...k,disabled:S,style:x,children:h&&"page"===h.type?(0,y.jsx)(s.Z,{store:u.G.createChildStore(t.context.parentRecordStore,h.page)}):b?(0,y.jsx)(c.F,{value:b,format:r.lo.Medium,isSingle:!0}):(0,y.jsx)(a.FormattedMessage,{id:"automations.AutomationPagePicker.pagesDropdown.label",defaultMessage:"Select page"})}),render:e=>(0,y.jsx)(g.L,{actionId:o.id,automationContextStore:t,onChange:M,onClose:j,selectedTarget:h,skipCollections:!0})})}},19471:(e,t,o)=>{o.d(t,{W_:()=>h,Yn:()=>y,bH:()=>g});var n=o(67294),i=o(480),r=o(86628),a=o(9953),l=o(98104),s=o(82530),c=o(1743),d=o(74194),u=o(24098),p=o(12455),m=o(85893);function g(e){window.__c={n:"AutomationPlainTextInput"};const{value:t,onChange:o,wrapStyle:i,...r}=e,[a,s]=(0,n.useState)(!1);return(0,m.jsx)(c.Z,{debugName:"AutomationPlainTextInput",capture:a,children:(0,m.jsx)(u.Z,{capture:!0,render:e=>(0,m.jsx)("div",{...e,style:i,children:(0,m.jsx)(d.Z,{value:t,onChange:e=>o(e.currentTarget.value),onBlur:()=>{s(!1)},onFocus:()=>{l.o9(),s(!0)},...r})})})})}function y(e){window.__c={n:"ConnectedAutomationPlainTextInput"};const{store:t,...o}=e,l=(0,i.O7)(),c=(0,r.VK)((()=>t.getValue()??""),[t]),d=(0,n.useCallback)((e=>{s.createAndCommit({userAction:"AutomationPlainTextInput.setValue",environment:l,perform:o=>{a.sO({store:t,transaction:o,value:e})}})}),[l,t]);return(0,m.jsx)(g,{value:c,onChange:d,...o})}function h(e){window.__c={n:"ConnectedAutomationPlainTextInputV2"};const{store:t,...o}=e,{maybePersistedTransactionActions:i}=(0,p.i)(),l=(0,r.VK)((()=>t.getValue()??""),[t]),s=(0,n.useCallback)((e=>{i.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:o=>{a.sO({store:t,transaction:o,value:e})}})}),[i,t]);return(0,m.jsx)(g,{value:l,onChange:s,...o})}},8808:(e,t,o)=>{o.d(t,{H:()=>z,L:()=>U});o(57658),o(21703);var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(84619),s=o(99319),c=o(73110),d=o(35102),u=o(58573),p=o(59054),m=o(56666),g=o(72126),y=o(4615),h=o(21202),f=o(6287),S=o(97880),v=o(9291),x=o(8406),C=o(32628),b=o(73657),w=o(52275),k=o(68894),M=o(78140),j=o(32163),_=o(11470),A=o(72495),T=o(26388),P=o(21396),V=o(78948),I=o(87279),F=o(98742),Z=o(77907),K=o(75822),B=o(80444),O=o(29798),R=o(79797),D=o(95193),W=o(85893);const E=(0,v.defineMessages)({searchInputPlaceholder:{defaultMessage:"Type to search…",id:"automations.AutomationTargetPickerMenu.search.placeholder"}}),N=5,L=20,H=20;function U(e){window.__c={n:"AutomationTargetPickerMenu"};const t=(0,i.O7)(),o=(0,D.F)({maxWidth:360,paddingTop:12,width:280}),r=(0,n.useMemo)((()=>(0,y.ZP)()),[]),a=(0,n.useCallback)((()=>{x.tW({environment:t,eventName:"abandoned_search",sessionId:r,source:C.S.Automation})}),[t,r]);return o.menuType===I.og.Popup&&(o.onClickOutside=a),(0,W.jsx)(M.Z,{...o,children:(0,W.jsx)(z,{...e,searchSessionId:r})})}function z(e){window.__c={n:"AutomationTargetPickerMenuChildren"};const{actionId:t,automationContextStore:o,onChange:a,onClose:m,selectedTarget:y,skipCollections:k,skipPages:M,skipVariables:I,searchSessionId:D}=e,E=(0,i.O7)(),L=(0,r.qz)(void 0,O.Z),U=(0,r.VK)((()=>{const{context:e}=o;if("button_property"===e.type)return e.collectionContextStore.collectionViewBlockStore()}),[o]),z=(0,r.VK)((()=>{if(I)return[];const e=(0,S.$K)(t)?o.getContextValuesForAction(t):o.getAllContextValues();if(e){return Object.values(e).filter((e=>{if(!(0,s.uy)(e.type,{type:"block"}))return!1;if("event"===o.context.type&&e.kind===c.yp.ContextValue){const t=(0,d.MY)(e.id);return!("global"===t.source&&"button_page"===t.global)}return!0}))}return[]}),[I,o,t],{useDeepEqual:!0}),Q=(0,n.useMemo)((()=>o.context.parentRecordStore),[o.context]),X=(0,r.VK)((()=>Q.getSpaceId()),[Q]),[J,ee]=(0,n.useReducer)(G,{automationVariables:[],collectionQueryLimit:N,pageQueryLimit:N,searchTerm:""});(0,n.useEffect)((()=>{if(J.searchTerm){const e=(0,u.ZP)(J.searchTerm,z,(e=>e.kind===c.yp.ContextValue?e.name:""));ee({type:"set_variables",variables:e})}else ee({type:"set_variables",variables:z})}),[J.searchTerm,z]);const te=function(e){const{collectionViewBlockStore:t,limit:o,parentStore:a,searchTerm:l,skip:s}=e,c=(0,i.O7)(),d=(0,r.VK)((()=>B.default.state.currentSpaceStore),[]),[u,m]=(0,n.useReducer)(Y,{error:void 0,isLoading:Boolean(s),results:void 0,total:void 0}),g=(0,Z.useDependency)(Z.deps.searchActions),[y]=(0,p.r5)((async()=>{if(s||"resolved"!==g.status)return;const e=g.value,n=await e.searchCollectionsWithRecents({collectionViewBlockStore:t,environment:c,spaceStore:d,limit:o,parentStore:a,query:l,requireEditPermissions:!0,searchSessionId:void 0});return{results:n.results,total:n.total}}),[t,c,o,a,l,s,g.status,g.value,d],{debounce:K.vp});return(0,n.useEffect)((()=>{if("pending"===y.status||"idle"===y.status)m({type:"query_loadstart"});else if("resolved"===y.status){var e,t;m({results:null===(e=y.value)||void 0===e?void 0:e.results,total:null===(t=y.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===y.status?m({error:y.error,type:"query_error"}):(0,S.t1)(y)}),[y]),u}({collectionViewBlockStore:U,limit:J.collectionQueryLimit,parentStore:Q,searchTerm:J.searchTerm,skip:k}),oe=function(e){const{limit:t,searchTerm:o,skip:r,spaceId:a}=e,l=(0,i.O7)(),[s,c]=(0,n.useReducer)(Y,{error:void 0,isLoading:Boolean(r),results:void 0,total:void 0}),[d]=(0,p.r5)((async()=>{if(r||!a)return;const e=await Z.deps.searchActions.loader(),n=await e.searchPagesInSpace({boostRecentlyViewedPages:!0,environment:l,excludeTemplates:!0,limit:t,query:o,requireEditPermissions:!1,source:"automation_page_picker",spaceId:a});return{results:n.results.map((e=>e.id)),total:n.total}}),[l,t,o,r,a],{debounce:K.vp});return(0,n.useEffect)((()=>{if("pending"===d.status||"idle"===d.status)c({type:"query_loadstart"});else if("resolved"===d.status){var e,t;c({results:null===(e=d.value)||void 0===e?void 0:e.results,total:null===(t=d.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===d.status?c({error:d.error,type:"query_error"}):(0,S.t1)(d)}),[d]),s}({limit:J.pageQueryLimit,searchTerm:J.searchTerm,skip:M,spaceId:X}),ne=(0,n.useCallback)((e=>{"collection"===e.type&&x.tW({environment:E,eventName:"select_search_item",queryLength:J.searchTerm.length,sessionId:D,source:C.S.Automation,totalResults:te.total}),y&&!g.Xy(y,e)?a(e):y?m():a(e)}),[E,D,J.searchTerm,te.total,y,a,m]),ie=(0,n.useCallback)((e=>{const t=e.target.value;ee({searchTerm:t,type:"set_search_term"}),L.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}),[L]),re=(0,n.useCallback)((()=>{ee({queryLimit:J.collectionQueryLimit+H,type:"set_collection_query_limit"})}),[J.collectionQueryLimit]),ae=(0,n.useCallback)((()=>{ee({queryLimit:J.pageQueryLimit+H,type:"set_page_query_limit"})}),[J.pageQueryLimit]),le="variable"===(null==y?void 0:y.type)?y.id:void 0,se="collection"===(null==y?void 0:y.type)?y.collection.id:void 0,ce="page"===(null==y?void 0:y.type)?y.page.id:void 0,de=[],ue=function(e){const{automationVariables:t,onClick:o,selectedVariableId:n}=e,i=t.map((e=>{if(e.kind!==c.yp.ContextValue)throw new Error("Not implemented yet.");return{action:()=>o({id:e.id,type:"variable"}),key:e.id,render:t=>(0,W.jsx)(T.ZP,{placement:T.ug.Right,render:o=>(0,W.jsx)(w.Z,{...(0,F.Z)(o,t),checkState:e.id===n,title:(0,W.jsx)("div",{style:{display:"flex"},children:(0,W.jsx)(P.F,{value:e,format:l.lo.Medium,isSingle:!0,shouldShrink:!0})})}),renderTooltip:()=>e.name,textWrap:!0})}}));if(0===i.length)return;return{key:"variable_results",items:i,render:e=>(0,W.jsx)(A.Z,{...e,title:(0,W.jsx)(v.FormattedMessage,{defaultMessage:"From this automation",id:"automations.AutomationTargetPickerMenu.variablesSection.title"})})}}({automationVariables:J.automationVariables,onClick:ne,selectedVariableId:le});ue&&de.push(ue);const pe=function(e){const{collectionQueryResult:t,onCollectionMenuItemClick:o,onShowMoreItemClick:n,parentRecordStore:i,selectedCollectionId:r}=e;if(t.isLoading)return;let a=[];if(t.error)a.push({action:n,key:"show_more_collection_results",render:e=>(0,W.jsx)(b.Z,{...e,caption:(0,W.jsx)(v.FormattedMessage,{defaultMessage:"Sorry, something went wrong while searching for databases.",id:"automations.AutomationTargetPickerMenu.errorCollections.label"}),shouldWrapCaption:!0})});else{const e=t.results??[],l=e.length;a=e.map((e=>{const t=R.NW.createChildStore(i,{table:f.v,id:e});return{action:()=>o({collection:t.getSpaceShardedPointer(),type:"collection"}),key:e,render:o=>(0,W.jsx)(_.Z,{...o,checkState:e===r,store:t})}}));const s=t.total??0,c=Math.max(0,s-l);c>0&&a.push({action:n,key:"show_more_collection_results",render:e=>(0,W.jsx)(q,{...e,showMoreCount:c})})}if(0===a.length)return;return{key:"collection_results",items:a,render:e=>(0,W.jsx)(A.Z,{...e,title:(0,W.jsx)(v.FormattedMessage,{defaultMessage:"Databases",id:"automations.AutomationTargetPickerMenu.collectionsSection.title"})})}}({collectionQueryResult:te,onCollectionMenuItemClick:ne,onShowMoreItemClick:re,parentRecordStore:Q,selectedCollectionId:se});pe&&de.push(pe);const me=function(e){const{pageQueryResult:t,onPageMenuItemClick:o,onShowMoreItemClick:n,parentRecordStore:i,selectedPageId:r}=e;if(t.isLoading)return;let a=[];if(t.error)a.push({action:n,key:"show_more_collection_results",render:e=>(0,W.jsx)(b.Z,{...e,caption:(0,W.jsx)(v.FormattedMessage,{defaultMessage:"Sorry, something went wrong while searching for pages.",id:"automations.AutomationTargetPickerMenu.errorPages.label"}),shouldWrapCaption:!0})});else{const e=t.results??[],l=e.length;a=e.map((e=>{const t=R.G.createChildStore(i,{table:h.iU,id:e});return{key:e,render:o=>(0,W.jsx)(_.Z,{...o,checkState:e===r,store:t}),action:()=>o({page:t.getSpaceShardedPointer(),type:"page"})}}));const s=t.total??0,c=Math.max(0,s-l);c>0&&a.push({action:n,key:"show_more_page_results",render:e=>(0,W.jsx)(q,{...e,showMoreCount:c})})}if(0===a.length)return;return{key:"page_results",items:a,render:e=>(0,W.jsx)(A.Z,{...e,title:(0,W.jsx)(v.FormattedMessage,{defaultMessage:"Pages",id:"automations.AutomationTargetPickerMenu.pagesSection.title"})})}}({onPageMenuItemClick:ne,onShowMoreItemClick:ae,pageQueryResult:oe,parentRecordStore:Q,selectedPageId:ce});me&&de.push(me);const ge=te.isLoading||oe.isLoading;return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)($,{onChange:ie,value:J.searchTerm}),ge?(0,W.jsx)(A.Z,{children:(0,W.jsx)(V.Z,{})}):!ge&&de.length>0?(0,W.jsx)(j.Z,{initialFocus:0,sections:de,store:L,type:j.i.Vertical}):(0,W.jsx)(b.Z,{caption:(0,W.jsx)(v.FormattedMessage,{defaultMessage:"No results",id:"automations.AutomationTargetPickerMenu.noResults.label"})})]})}function $(e){window.__c={n:"SearchInputSection"};const{onChange:t,value:o}=e,{isMobile:n}=(0,i.Fy)(),r=(0,v.useIntl)(),l=(0,a.yK)((()=>({section:{paddingBlockStart:0}})),[]);return(0,W.jsx)(A.Z,{style:l.section,children:(0,W.jsx)(k.ZP,{focusInitial:!n||void 0,onChange:t,placeholder:r.formatMessage(E.searchInputPlaceholder),showClearButton:!0,value:o??""})})}const q=(0,n.forwardRef)((function(e,t){window.__c={n:"ShowMoreButtonMenuItem"};const{showMoreCount:o}=e,n=(0,a.yK)((e=>({showMoreButton:{color:e.mediumTextColor,fill:e.mediumIconColor}})),[]);return(0,W.jsx)(w.Z,{...e,icon:(0,m.o)({width:16,height:16}),ref:t,style:n.showMoreButton,title:(0,W.jsx)(v.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"automations.AutomationTargetPickerMenu.showMore.label",values:{showMore:Math.min(o,H)}})})}));function G(e,t){if("set_variables"===t.type)return{...e,automationVariables:t.variables.slice(0)};if("set_search_term"===t.type){const o=t.searchTerm?L:N;return{...e,collectionQueryLimit:o,pageQueryLimit:o,searchTerm:t.searchTerm}}if("set_collection_query_limit"===t.type){if(e.collectionQueryLimit!==t.queryLimit)return{...e,collectionQueryLimit:t.queryLimit}}else if("set_page_query_limit"===t.type){if(e.pageQueryLimit!==t.queryLimit)return{...e,pageQueryLimit:t.queryLimit}}else(0,S.t1)(t);return e}function Y(e,t){if("query_loadstart"===t.type){if(!e.isLoading)return{...e,isLoading:!0}}else{if("query_finish"===t.type)return{...e,error:void 0,isLoading:!1,results:t.results,total:t.total};if("query_error"===t.type)return{...e,error:t.error,isLoading:!1,results:void 0,total:void 0};(0,S.t1)(t)}return e}},14648:(e,t,o)=>{o.d(t,{F:()=>w,Z:()=>v});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(80721),s=o(12392),c=o(82990),d=o(9291),u=o(73063),p=o(78140),m=o(32163),g=o(40721),y=o(89728),h=o(87279),f=o(85893);const S=(0,d.defineMessages)({backButtonAriaLabel:{id:"notificationRuleSettingsMenu.backButton.ariaLabel",defaultMessage:"Back to previous step"}});function v(e){window.__c={n:"AutomationTriggerActionMenu"};const{type:t,automationTriggerActionMenuStore:o,headerTitle:n,onClose:i,width:r,onDone:a}=e,l=w({automationTriggerActionMenuStore:o,onClose:i,onDone:a,title:n,width:r});return"custom"===t?(0,f.jsx)(C,{...e,menuProps:l}):(0,f.jsx)(x,{...e,menuProps:l})}function x(e){const{sections:t,menuProps:o}=e;return(0,f.jsx)(p.Z,{...o,children:(0,f.jsx)(m.Z,{type:m.i.Vertical,initialFocus:0,sections:t})})}function C(e){const{children:t,menuProps:o}=e;return(0,f.jsx)(p.Z,{...o,children:t})}function b(e){window.__c={n:"BackToPreviousStepButton"};const{automationActionMenuStore:t,menuHeaderTitle:o,onDone:n}=e,i=(0,d.useIntl)(),s=(0,r.VK)((()=>t.state.stack.length>1),[t]),p=(0,a.yK)((e=>({header:{display:"flex",alignItems:"center",margin:8,color:e.mediumTextColor,fontWeight:c.Z.fontWeight.medium,fontSize:c.Z.fontSize.UISmall.desktop},iconButtonStyle:{marginRight:8,marginLeft:-2,height:22},iconButtonIconStyle:{width:16,height:16},doneButtonStyle:{marginLeft:"auto"}})),[]);return void 0!==o||s?(0,f.jsxs)("div",{style:p.header,children:[s&&(0,f.jsx)(u.Z,{ariaLabel:i.formatMessage(S.backButtonAriaLabel),icon:l.W,style:p.iconButtonStyle,iconStyle:p.iconButtonIconStyle,onClick:()=>{t.popSettingsItem()}}),o,n&&(0,f.jsx)(y.Z,{onClick:n,isBlue:!0,style:p.doneButtonStyle,children:(0,f.jsx)(d.FormattedMessage,{id:"automationTriggerActionMenu.doneButton.title",defaultMessage:"Done"})})]}):null}function w(e){const{automationTriggerActionMenuStore:t,leftStyle:o,onClose:r,onDone:a,rightStyle:l,title:c,titleStyle:p,width:m}=e,{isMobile:y}=(0,i.Fy)(),v=(0,d.useIntl)(),x=(0,n.useCallback)((()=>{1===t.getState().stack.length?r():t.popSettingsItem()}),[t,r]);return(0,n.useMemo)((()=>{let e;return e=y?{leftOuterStyle:o,menuType:h.og.Modal,title:c,titleOuterStyle:p,left:(0,f.jsx)(u.Z,{ariaLabel:v.formatMessage(S.backButtonAriaLabel),icon:s.S,onClick:x}),right:(0,f.jsx)(g.DoneMenuText,{}),rightOuterStyle:l,onClickRight:()=>{null==a||a(),r()}}:{width:m??266,menuType:h.og.Popup,maxHeight:"50vh",header:(0,f.jsx)(b,{automationActionMenuStore:t,menuHeaderTitle:c,onDone:a})},e}),[t,v,y,o,r,a,x,l,c,p,m])}},93060:(e,t,o)=>{o.d(t,{y:()=>l});var n=o(67294),i=o(24405),r=o(26388),a=o(85893);function l(e){window.__c={n:"AutomationTriggerActionTooltip"};const{caption:t,disable:o,renderOrigin:l,title:s,tooltipAlignment:c,tooltipPlacement:d}=e,u=(0,i.yK)((e=>({tooltipTitle:{margin:0},tooltipCaption:{color:e.mediumInvertedTextColor,margin:0}})),[]),p=(0,n.useCallback)((()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{style:u.tooltipTitle,children:s}),(0,a.jsx)("p",{style:u.tooltipCaption,children:t})]})),[t,s,u.tooltipCaption,u.tooltipTitle]);return(0,a.jsx)(r.ZP,{alignment:c,delayThreshold:800,disableTooltip:o,placement:d,render:l,renderTooltip:p,textWrap:!0})}},74197:(e,t,o)=>{o.d(t,{f:()=>p});o(67294);var n=o(480),i=o(24405),r=o(56666),a=o(9291),l=o(31945),s=o(73063),c=o(53437),d=o(85893);const u=(0,a.defineMessages)({moreLabel:{id:"automationBaseStepElement.moreActionsMenu.title",defaultMessage:"More"}});function p(e){window.__c={n:"BaseStepActionsButton"};const{actionMenu:t,disabled:o,buttonPopupStore:p}=e,{device:m}=(0,n.O7)(),g=(0,a.useIntl)(),y=(0,i.yK)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26},icon:{height:14,width:14}})),[]);return(0,d.jsx)(l.ZP,{alignmentToOrigin:l.vR.Center,buttonPopupStore:p,originGap:0,placementToOrigin:l.pO.Bottom,popupType:m.isMobile?c.kQ.SlideUp:c.kQ.Popup,render:()=>t,renderOrigin:e=>(0,d.jsx)(s.Z,{...e,ariaLabel:g.formatMessage(u.moreLabel),disabled:o,disabledFeedback:o,hasBackground:!0,icon:r.o,iconStyle:y.icon,style:y.iconButton})})}},80253:(e,t,o)=>{o.d(t,{Ao:()=>A,R7:()=>P,YG:()=>_,_S:()=>j,vu:()=>T});var n=o(94184),i=o.n(n),r=o(67294),a=o(480),l=o(6740),s=o(37989),c=o(86628),d=o(24405),u=o(77744),p=o(98104),m=o(64921),g=o(50478),y=o(75024),h=o(35948),f=o(61766),S=o(12455),v=o(73266),x=o(74197),C=o(85893);const b="automation-list-item-base-step",w="automation-list-item-base-step--disabled",k="automation-list-item-icon",M="automation-list-item-drag-handle";function j(e){window.__c={n:"BaseStepLabel"};const{actionMenu:t,buttonPopupStore:o,children:n,disabled:l,icon:d,onClick:p,onMouseDown:m,onMouseEnter:g,onMouseLeave:y,subtitle:S,styles:k}=e,{isMobile:M}=(0,a.Fy)(),j=(0,c.qz)(o,f.Z),[_,A]=(0,s.Z)(),[T,P]=(0,h.C)(),I=(0,c.VK)((()=>j.getState()),[j]),F=!l&&(M||P||A||I.open),Z=V({disabled:l,hasActionMenu:Boolean(t),isActionMenuVisible:F,overrideStyles:k}),K=(0,v.Z)(),B=(0,u.lq)(_,T),O=(0,r.useMemo)((()=>({...Z.componentWrap,...Z.border})),[Z.border,Z.componentWrap]);return(0,C.jsxs)("div",{className:i()(b,{[w]:l}),onClick:p,onMouseDown:m,onMouseEnter:g,onMouseLeave:y,ref:B,style:O,children:[(0,C.jsxs)("div",{style:Z.headerWrap,children:[!K&&d&&(0,C.jsx)("div",{"aria-hidden":"true",style:Z.iconContainer,children:(0,C.jsx)("div",{style:Z.iconWrap,children:d(Z.icon)})}),(0,C.jsx)("div",{style:Z.titleWrap,children:n})]}),S&&(0,C.jsx)("div",{style:Z.subtitleWrap,children:S}),t&&(0,C.jsx)("div",{style:Z.actionMenuWrap,children:(0,C.jsx)(x.f,{actionMenu:t,buttonPopupStore:j,disabled:l})})]})}function _(e){window.__c={n:"BaseStepButton"};const{actionMenu:t,buttonPopupStore:o,children:n,disabled:r,icon:d,onBlur:g,onClick:y,onFocus:S,onMouseDown:k,onMouseEnter:M,onMouseLeave:j,styles:_,subtitle:A}=e,{isMobile:T}=(0,a.Fy)(),[P,I]=(0,l.Z)(),[F,Z]=(0,s.Z)(),[K,B]=(0,h.C)(),O=(0,c.qz)(o,f.Z),R=(0,c.VK)((()=>O.getState()),[O]),D=(0,u.lq)(K,F),W=!r&&(T||B||I||Z||R.open),E=!r&&B;(0,c.VK)((()=>{R.open||p.sD()}),[R]);const N=V({disabled:r,hasActionMenu:Boolean(t),isActionMenuVisible:W,overrideStyles:_}),L=(0,v.Z)();return(0,C.jsxs)("div",{className:i()(b,{[w]:r}),ref:D,style:N.buttonWrap,children:[(0,C.jsxs)(m.Z,{disabled:r,disabledFeedback:r,hovered:E,ignoreLocalHoverState:!0,onBlur:g,onClick:y,onFocus:S,onMouseDown:k,onMouseEnter:M,onMouseLeave:j,ref:P,style:N.componentWrap,children:[(0,C.jsxs)("div",{style:N.headerWrap,children:[!L&&d&&(0,C.jsx)("div",{"aria-hidden":"true",style:N.iconContainer,children:(0,C.jsx)("div",{style:N.iconWrap,children:d(N.icon)})}),(0,C.jsx)("div",{style:N.titleWrap,children:n})]}),A&&(0,C.jsx)("div",{style:N.subtitleWrap,children:A})]}),t&&(0,C.jsx)("div",{style:N.actionMenuWrap,children:(0,C.jsx)(x.f,{actionMenu:t,buttonPopupStore:O,disabled:r})})]})}function A(e){window.__c={n:"BaseStepElement"};const{actionMenu:t,buttonPopupStore:o,children:n,disabled:l,forceShowActionMenu:d,onMouseEnter:m,onMouseLeave:g,styles:y}=e,{isMobile:v}=(0,a.Fy)(),[k,M]=(0,s.Z)(),[j,_]=(0,h.C)(),A=(0,c.qz)(o,f.Z),T=(0,c.VK)((()=>A.getState()),[A]),{currentDraggingActionId:P}=(0,S.i)(),I=(0,u.lq)(j,k),F=!l&&(d||v||_||M||T.open);(0,c.VK)((()=>{T.open||p.sD()}),[T]);const Z=V({disabled:l,hasActionMenu:Boolean(t),isActionMenuVisible:F,overrideStyles:y}),K=(0,r.useMemo)((()=>({...Z.componentWrap,...Z.border,...P?{cursor:"grabbing"}:{}})),[P,Z.border,Z.componentWrap]);return(0,C.jsxs)("div",{className:i()(b,{[w]:l}),onMouseEnter:m,onMouseLeave:g,ref:I,style:K,children:[t&&(0,C.jsx)("div",{style:Z.actionMenuWrap,children:(0,C.jsx)(x.f,{actionMenu:t,buttonPopupStore:A,disabled:l})}),n]})}function T(e){window.__c={n:"BaseStepElementHeader"};const{children:t,disabled:o,display:n,onMouseEnter:i,onMouseLeave:r,styles:a}=e,l=V({disabled:o,hasActionMenu:!1,isActionMenuVisible:!1,overrideStyles:a}),s=(0,v.Z)();return(0,C.jsxs)("header",{onMouseEnter:i,onMouseLeave:r,style:l.headerWrap,children:[!s&&n&&(0,C.jsxs)("div",{"aria-hidden":"true",style:l.iconContainer,children:[(0,C.jsx)("div",{className:k,style:l.iconWrap,children:(0,C.jsx)(I,{display:n})}),(0,C.jsx)("div",{className:M,style:l.iconWrap,children:(0,C.jsx)(g.ZP,{hideClickMessage:!0})})]}),(0,C.jsx)("div",{style:l.titleWrap,children:t})]})}function P(e){window.__c={n:"BaseStepElementBody"};const{children:t,disabled:o,styles:n}=e,i=V({disabled:o,hasActionMenu:!1,isActionMenuVisible:!1,overrideStyles:n});return(0,C.jsx)("div",{style:i.bodyWrap,children:t})}function V(e){const{disabled:t,hasActionMenu:o,isActionMenuVisible:n,overrideStyles:i}=e;return(0,d.yK)((e=>({border:{border:`1px solid ${e.stroke.regular}`},buttonWrap:{background:e.cardContentBackground,border:`1px solid ${e.stroke.regular}`,overflow:"hidden",position:"relative"},componentWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:14,paddingInline:12,paddingBlock:14,position:"relative",...t?{cursor:"default",pointerEvents:"none"}:{},...null==i?void 0:i.componentWrap},headerWrap:{display:"flex",flexDirection:"row",gap:4,marginInlineEnd:o?38:0,...t?{opacity:.4}:{},...null==i?void 0:i.headerWrap},iconContainer:{marginRight:4,width:24,height:24,position:"relative"},iconWrap:{display:"flex",justifyContent:"center",width:"100%",height:"100%",position:"absolute",...null==i?void 0:i.iconWrap},icon:{fill:e.text.secondary,height:"auto",width:16,...null==i?void 0:i.icon},titleWrap:{alignSelf:"center",flex:"1 1 auto",fontSize:14,lineHeight:1.285,marginBlockStart:1,minWidth:0,whiteSpace:"pre",...null==i?void 0:i.titleWrap},subtitleWrap:{...null==i?void 0:i.subtitleWrap},bodyWrap:{fontSize:14,...null==i?void 0:i.bodyWrap},actionMenuWrap:{flex:"0 0 auto",height:26,position:"absolute",right:12,top:12,width:26,...n?{}:y.jy}})),[t,o,n,i])}function I(e){window.__c={n:"ActionIcon"};const{display:t}=e,o=(0,d.yK)((e=>({iconWrap:{width:24,height:24,display:"flex",alignItems:"center",borderRadius:4,background:t.hasSideEffects?"rgba(35, 131, 226, 0.14)":e.accentColors.gray[50],flexShrink:0},icon:{width:14,height:14,fill:t.hasSideEffects?e.blueColor:e.accentColors.gray[500],margin:"0 auto"}})),[t.hasSideEffects]);return(0,C.jsx)("div",{style:o.iconWrap,children:t.icon(o.icon)})}},37867:(e,t,o)=>{o.d(t,{Z:()=>u});o(67294);var n=o(480),i=o(24405),r=o(84619),a=o(54497),l=o(9291),s=o(85567),c=o(56812),d=o(85893);function u(e){let{key:t,tokenFormat:o=r.lo.Medium,isSingle:u,showRemoveButton:p,onClickRemove:m}=e;window.__c={n:"DeletedOptionToken"};const{isMobile:g}=(0,n.Fy)(),y=(0,l.useIntl)(),h=(0,i.yK)((e=>{const t="light"===e.mode?400:800,o="light"===e.mode?50:200,n="light"===e.mode?700:900;return{tokenValueWrap:{display:"inline-flex",gap:"4px",alignItems:"baseline"},warning:{color:e.accentColors.orange[t],height:"auto",width:g?16:14},warningWrap:{alignSelf:"center"},token:{backgroundColor:e.accentColors.yellow[o]},textWrap:{color:e.accentColors.yellow[n]}}}),[g]);return(0,d.jsx)(s.Z,{format:o,isSingle:u??!0,showRemoveButton:p??!1,onClickRemove:m,style:h.token,value:(0,d.jsxs)("span",{style:h.tokenValueWrap,children:[(0,d.jsx)("span",{style:h.warningWrap,children:(0,a.t)(h.warning)}),(0,d.jsx)("span",{style:h.textWrap,children:(0,c.ST)(y)})]})},t)}},10383:(e,t,o)=>{o.d(t,{Z:()=>se});var n=o(67294),i=o(86628),r=o(97880),a=o(91738),l=(o(57658),o(43261)),s=o.n(l),c=o(480),d=o(24405),u=o(63362),p=o(3865),m=o(12396),g=o(9999),y=o(65422),h=o(5257),f=o(4615),S=o(9291),v=o(52275),x=o(68894),C=o(78140),b=o(32163),w=o(72495),k=o(49117),M=o(65183),j=o(33929),_=o(63474),A=o(44041),T=o(35057),P=o(47043),V=o(12455),I=o(95193),F=o(28751),Z=o(59054);var K=o(85893);const B=(0,S.defineMessages)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search for action…"}}),O=["automation_actions","update_this_page_actions"],R=["update_this_page_actions","automation_actions"];function D(e){window.__c={n:"AddActionsMenu"};const{automationActionMenuStore:t,hasSearch:o,hasUpdateThisPagePropertyActions:a,onClose:l}=e,{isMobile:d}=(0,c.Fy)(),m=(0,c.O7)(),g=(0,S.useIntl)(),y=(0,_.D)(),{automationContextStore:h,automationStore:x,maybePersistedTransactionActions:B,onActionAdded:D}=(0,V.i)(),N=(0,i.VK)((()=>null==h?void 0:h.getCollectionStore()),[h]),H=function(){const{automationContextStore:e}=(0,V.i)(),[t,o]=(0,n.useState)([]),r=(0,i.VK)((()=>e?(0,k.uV)(e.context.automationStore,e.context.type):void 0),[e]),a=(0,n.useMemo)((()=>(0,F.P)("display")),[]),l=(0,i.VK)((()=>r?a.map((e=>e.isAvailableForContext(r))):[]),[a,r]);return(0,Z.r5)((async()=>{const e=await Promise.all(l);o(function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}(a.filter(((t,o)=>e[o]))))}),[a,l]),t}(),z=(0,i.VK)((()=>null==h?void 0:h.context.type),[h]),$="event"===z,q=(0,n.useMemo)((()=>$?R:O),[$]),G=(0,i.VK)((()=>t.getInsertionPoint()),[t]),[Y,Q]=n.useState(""),X=(0,i.VK)((()=>o?function(e){const{availableActions:t,searchInput:o}=e;if(0===t.length)return[];const n=new Map,i=t.map((e=>{const t=j.default.formatMessage(e.display.name);return n.set(e.type,t),t})),r=new Set(s().filter(o,i).map((e=>{let{original:t}=e;return t})));return t.filter((e=>{const t=n.get(e.type);return t&&r.has(t)}))}({availableActions:H,searchInput:Y}):H),[H,o,Y]),J=(0,n.useCallback)((e=>{if(!x)return;const{performResult:t}=B.createAndCommit({userAction:"AutomationActionList.addAction",perform:t=>P.zY({actionId:(0,f.ZP)(),actionType:e,automationStore:x,environment:m,insertionPoint:G,intl:g,transaction:t})});t&&((0,u.eI)(y,{automation_id:x.id,automation_action_id:t.id,automation_action_type:e}),null==D||D(t)),l()}),[x,B,l,m,G,g,y,D]),ee=(0,i.VK)((()=>a&&N&&x?function(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,i=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),a=o.getFormat(),l=o.getSchema(),c=(0,p.cO)({collectionFormat:a,collectionSchema:l,filter:e=>{let[t]=e;return!i.has(t)}}),d=new Map,u=c.map((e=>{const t=l[e];if(t){const o=`${t.name} ${M.SO[t.type]}`;return d.set(e,o),o}})).filter(r.$K),m=new Set(s().filter(n,u).map((e=>{let{original:t}=e;return t})));return c.filter((e=>{const t=d.get(e);return t&&m.has(t)}))}({automationStore:x,collectionStore:N,searchInput:Y}):[]),[x,N,a,Y]),te=(0,i.VK)((()=>null==N?void 0:N.getSchema()),[N]),oe=(0,n.useCallback)((()=>{l(),A.y(m,{for:"plus",from:"database_automation_action_item"})}),[m,l]),ne=(0,k.Rr)({contextType:z,environment:m}),ie=(0,i.VK)((()=>!(0,T.sX)()),[]),re=0===H.length&&ie,ae=(0,n.useMemo)((()=>{const e=[];o&&!re&&e.push(function(e){const{onChange:t,value:o}=e;return{items:[{action:()=>{},key:"search-input",render:e=>(0,K.jsx)(W,{...e,onChange:t,value:o})}],key:"search",render:e=>(0,K.jsx)(w.Z,{...e})}}({onChange:e=>Q(e.target.value),value:Y}));const n=q.reduce(((e,o)=>{if("automation_actions"===o){const t=function(e){const{actionRegistryItems:t,hasTopBorder:o,onMenuItemClick:n}=e,i=t.map((e=>function(e){const{actionRegistryItem:t,onClick:o}=e;return{action:()=>o(t.type),key:`${t.type}_action`,render:e=>(0,K.jsx)(E,{...e,actionRegistryItem:t})}}({actionRegistryItem:e,onClick:n}))).filter(r.$K);if(0===i.length)return;return{key:"automation_actions_section",items:i,render:e=>(0,K.jsx)(w.Z,{...e,topBorder:o})}}({actionRegistryItems:X,hasTopBorder:e.length>0,onMenuItemClick:J});t&&e.push(t)}else if("update_this_page_actions"===o){const o=te&&!(ie&&$)&&function(e){const{automationActionMenuStore:t,hasTopBorder:o,normalizedBlockSchema:n,propertyIds:i}=e;if(0===i.length)return;const a=i.map((e=>{const o=n[e];if(o)return function(e){const{automationActionMenuStore:t,propertyId:o,propertySchema:n}=e;return{action:()=>{t.pushSettingsItem({actionId:void 0,propertyId:o,type:"eventActionProperty"})},key:`update_this_page_property_${o}_action`,render:e=>(0,K.jsx)(L,{...e,propertySchema:n})}}({automationActionMenuStore:t,propertyId:e,propertySchema:o})})).filter(r.$K);if(0===a.length)return;return{key:"automation_update_this_page_section",items:a,render:e=>(0,K.jsx)(w.Z,{...e,title:(0,K.jsx)(S.FormattedMessage,{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"}),topBorder:o})}}({automationActionMenuStore:t,hasTopBorder:e.length>0,normalizedBlockSchema:te,propertyIds:ee});o&&e.push(o)}else(0,r.t1)(o);return e}),[]);return 0===n.length?e.push({key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>(0,K.jsx)(v.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,K.jsx)(S.FormattedMessage,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})})}],render:e=>(0,K.jsx)(w.Z,{...e})}):e.push(...n),ie&&ne&&e.push(function(e){const{onUpsellClick:t,hasTopBorder:o}=e;return{key:"upsell_section",items:[{action:t,key:"upsell_item",render:e=>(0,K.jsx)(U,{...e})}],render:e=>(0,K.jsx)(w.Z,{...e,topBorder:o})}}({hasTopBorder:e.length>0,onUpsellClick:oe})),e}),[t,ee,X,ne,te,o,$,ie,re,J,oe,Y,q]),le=(0,I.F)({paddingBottom:6,paddingTop:6,width:266});return d||(le.maxHeight="50vh"),(0,K.jsx)(C.Z,{...le,children:(0,K.jsx)(b.Z,{initialFocus:0,sections:ae,type:b.i.Vertical})})}function W(e){window.__c={n:"SearchInputMenuItem"};const{onChange:t,value:o,...n}=e,i=(0,S.useIntl)(),r=(0,d.yK)((()=>({input:{margin:0,padding:0}})),[]);return(0,K.jsx)(x.ZP,{...n,inputOuterStyle:{margin:0},onChange:t,placeholder:i.formatMessage(B.searchInputPlaceholder),style:r.input,value:o})}function E(e){const{actionRegistryItem:t,...o}=e;return(0,K.jsx)(v.Z,{...o,icon:(0,K.jsx)(N,{actionRegistryItem:t}),title:(0,K.jsx)(S.FormattedMessage,{...t.display.name})})}function N(e){window.__c={n:"AutomationActionMenuItemIcon"};const{actionRegistryItem:t}=e,o="slack_notification"===t.type,n=(0,d.yK)((e=>({icon:{fill:o?void 0:e.blueColor,height:"auto",width:o?16:12},iconWrap:{alignItems:"center",background:o?void 0:"rgba(35, 131, 226, 0.14)",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[o]);return(0,K.jsx)("div",{style:n.iconWrap,children:t.display.icon(n.icon)})}function L(e){window.__c={n:"UpdateThisPagePropertyMenuItem"};const{propertySchema:t,...o}=e,n=(0,d.yK)((e=>({chevronIcon:{marginInlineStart:6,width:12,height:"auto"}})),[]);return(0,K.jsx)(v.Z,{...o,icon:(0,K.jsx)(H,{propertySchema:t}),right:(0,h.o)(n.chevronIcon),title:t.name})}function H(e){window.__c={n:"UpdateThisPagePropertyMenuItemIcon"};const{propertySchema:t}=e,o=(0,d.Fg)(),n=(0,d.yK)((e=>({icon:{fill:e.blueColor,width:12},iconWrap:{alignItems:"center",background:"rgba(35, 131, 226, 0.14)",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[]);return(0,K.jsx)("div",{style:n.iconWrap,children:(0,K.jsx)(m.ZP,{icon:t.icon,size:16,style:n.icon,theme:o,type:t.type})})}function U(e){window.__c={n:"UpsellMenuItem"};const t=(0,d.yK)((e=>({aliasIcon:{height:"auto",marginBlockStart:2,width:12},icon:{fill:e.icon.yellow,height:"100%",width:"100%"},iconWrap:{background:e.accentColors.yellow[50],borderRadius:4,height:20,padding:3,width:20},right:{alignSelf:"start"}})),[]);return(0,K.jsx)(v.Z,{...e,caption:(0,K.jsx)(S.FormattedMessage,{defaultMessage:"Automatically set properties, create new pages, and more with automations.",id:"automationEventActionMenu.upsellSection.caption"}),icon:(0,K.jsx)("div",{style:t.iconWrap,children:(0,y.K)(t.icon)}),right:(0,g.J)(t.aliasIcon),rightStyle:t.right,shouldWrapCaption:!0,title:(0,K.jsx)(S.FormattedMessage,{defaultMessage:"Upgrade for more actions",id:"automationEventActionMenu.upsellSection.title"})})}var z=o(10450),$=o(30823),q=o(99036),G=o(76218),Y=o(70203),Q=o(82990),X=o(9953),J=o(53498),ee=o(32984),te=o(14648);const oe=(0,S.defineMessages)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"}});function ne(e){var t;window.__c={n:"UpdateThisPagePropertyActionMenu"};const{actionId:o,automationActionMenuStore:r,onClose:a,propertyId:l}=e,{automationContextStore:s,automationStore:d,maybePersistedTransactionActions:p,onActionAdded:m}=(0,V.i)(),g=(0,S.useIntl)(),y=(0,c.O7)(),h=(0,_.D)(),v=(0,i.VK)((()=>r.getInsertionPoint()),[r]),x=(0,i.VK)((()=>null==s?void 0:s.getCollectionStore()),[s]),C=(0,n.useMemo)((()=>x?{collectionStore:x,property:l,type:"collection"}:void 0),[x,l]),b=o??(0,f.ZP)(),w=(0,i.VK)((()=>{const e=((null==d?void 0:d.getActionStores())??[]).find((e=>e.id===b));if(e&&e.isType("update_pages"))return e}),[d,b]),k=(0,i.VK)((()=>null==x?void 0:x.getSchema()[l]),[x,l]),M=(0,n.useMemo)((()=>!!k&&("multi_select"===k.type||(0,q.en)(k)&&1!==k.limit)),[k]),j=Boolean(k&&"button"!==k.type&&"rollup"!==k.type&&"formula"!==k.type&&"text"===(0,$.vc)(k.type)),A=Boolean(k&&"button"!==k.type&&"rollup"!==k.type&&"formula"!==k.type&&"number"===(0,$.vc)(k.type)),T=Boolean(k&&"date"===k.type),I=Boolean(k&&"status"===k.type),F=(0,i.VK)((()=>{if(x&&k)return(0,G.qW)(x.getSpaceShardedPointer(),l,k)}),[x,k,l]),Z=(0,i.VK)((()=>{if(w)return w.getConfigStore().getKeyStore("values").getKeyStore(l).getValue()}),[w,l]),[B,O]=(0,n.useState)(Z),R=(0,n.useRef)(null==Z?void 0:Z.value),D=(0,G.A6)(null==B||null===(t=B.value)||void 0===t?void 0:t.value),W=(0,i.VK)((()=>s?w?s.getContextValuesForAction(w.id):s.getAllContextValues():[]),[w,s]),E=(0,n.useCallback)((e=>{if(!d)return;const{performResult:t}=p.createAndCommit({perform:t=>{if(!w)return P.zY({actionId:b,actionType:"update_pages",automationStore:d,config:{properties:[l],target:{id:(0,z.J0)(),type:"variable"},values:{[l]:{action:"replace",value:e}}},environment:y,intl:g,insertionPoint:v,transaction:t});X.sW({data:{[l]:{action:"replace",value:e}},store:w.getConfigStore().getKeyStore("values"),transaction:t})},userAction:"UpdateThisPagePropertyActionMenu.saveChanges"});t&&((0,u.eI)(h,{automation_id:d.id,automation_action_id:t.id,automation_action_type:"update_pages"}),null==m||m(t))}),[w,d,y,h,b,v,g,p,m,l]),N=(0,n.useCallback)((()=>{E(R.current),a()}),[E,a]),L=(0,n.useCallback)((e=>{if(R.current=e,j||A||M)O({action:"replace",value:e});else if(T){const t=(0,G.A6)(null==e?void 0:e.value);0===t.length?N():(0,G.S3)(t[0])&&(0,Y.fpG)(t[0])&&O({action:"replace",value:e})}}),[T,j,A,M,N]),H=(0,te.F)({automationTriggerActionMenuStore:r,leftStyle:{flexGrow:0},onClose:N,onDone:M||j||A?N:void 0,rightStyle:{flexGrow:0},title:(0,K.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:g.formatMessage(oe.menuHeaderTitle,{propertyName:(0,K.jsx)("div",{style:{...Q.Z.textOverflowStyle},children:(null==k?void 0:k.name)??""})})}),titleStyle:{minWidth:0}});if(!(k&&F&&s&&C))return null;const U=(0,ee.li)(k.type);return(0,K.jsx)(J.a,{context:C,contextStore:s,currentSimpleFormulaValueTokens:D,disabled:!1,formulaTypecheckContextValues:W,menuProps:H,onChange:L,onClose:N,showClearButton:!I,type:F,value:null==B?void 0:B.value,...U})}var ie=o(55132),re=o(42876);function ae(e){window.__c={n:"SlackSelectChannelMenu"};const{actionStore:t,automationActionMenuStore:o,onClose:i}=e,{maybePersistedTransactionActions:a}=(0,V.i)(),l=n.useCallback(((e,o)=>{t&&a.createAndCommit({perform:n=>{X.sW({data:{config:{external_bot_id:o.parent_id,target:e}},store:t,transaction:n})},userAction:"SlackSelectChannelMenu.handleChannelSelect"}),i()}),[t,a,i]),s=(0,n.useCallback)((()=>{const e=o.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?o.popSettingsItem():o.replaceSettingsItem({actionStore:t,type:"selectWorkspace"}))}),[t,o]);return(0,K.jsx)(re.ZP,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannel:"selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,r.t1)(e),onClose:i,onNotificationChannelSelect:l,onNewSlackAccountAdded:s,renderMenu:e=>(0,K.jsx)(te.Z,{type:"default",automationTriggerActionMenuStore:o,headerTitle:(0,K.jsx)(S.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:i})})}var le=o(9139);function se(e){window.__c={n:"ActionMenuController"};const{initialState:t,insertionPoint:o,onClose:l}=e,s=(0,i.VK)((()=>{const e=new a.H0;return e.setState({insertionPoint:o,stack:[t]}),e}),[t,o]),c=(0,i.VK)((()=>s.getCurrentTab()),[s]),d=(0,n.useCallback)((()=>null==l?void 0:l()),[l]);if(!c)return null;if("connectToSlackDefault"===c.type)return(0,K.jsx)(ie.Z,{actionStore:c.actionStore,automationActionMenuStore:s,onClose:d,type:"connectToSlackDefault"});if("connectToSlackReconnect"===c.type)return(0,K.jsx)(ie.Z,{actionStore:c.actionStore,automationActionMenuStore:s,externalBotId:c.externalBotId,notificationActionConfigStore:c.notificationActionConfigStore,onClose:d,type:"connectToSlackReconnect"});if("selectWorkspace"===c.type)return(0,K.jsx)(le.Z,{actionStore:c.actionStore,automationActionMenuStore:s,onClose:d});if("selectChannelNew"===c.type)return(0,K.jsx)(ae,{actionStore:c.actionStore,automationActionMenuStore:s,onClose:d,type:"selectChannelNew"});if("selectChannelUpdate"===c.type)return(0,K.jsx)(ae,{actionStore:c.actionStore,automationActionMenuStore:s,currentExternalAuthentication:c.currentExternalAuthentication,currentNotificationChannel:c.currentNotificationChannel,onClose:d,type:"selectChannelUpdate"});if("eventActions"===c.type)return(0,K.jsx)(D,{automationActionMenuStore:s,hasUpdateThisPagePropertyActions:c.hasUpdateThisPagePropertyActions,hasSearch:c.hasSearch,onClose:d});if("eventActionProperty"===c.type){const{propertyId:e,actionId:t}=c;return(0,K.jsx)(ne,{actionId:t,automationActionMenuStore:s,onClose:d,propertyId:e})}return"eventActionCreatePage"===c.type||"eventActionUpdatePages"===c.type?(0,K.jsx)("div",{children:"WILL BE REMOVED"}):(0,r.t1)(c)}},55132:(e,t,o)=>{o.d(t,{Z:()=>w});o(67294);var n=o(480),i=o(86628),r=o(24405),a=o(41892),l=o(77657),s=o(149),c=o(32161),d=o(97880),u=o(82990),p=o(9291),m=o(89475),g=o(42922),y=o(89728),h=o(72495),f=o(18441),S=o(80444),v=o(30874),x=o(79797),C=o(14648),b=o(85893);function w(e){window.__c={n:"SlackConnectToSlackView"};const{type:t,automationActionMenuStore:o,onClose:n}=e,r=A(),a=(0,i.VK)((()=>{var e;return null===(e=S.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),l=(0,i.VK)((()=>S.default.state.currentUserStore),[]),s=(0,i.VK)((()=>{if("connectToSlackReconnect"===t&&l)return(0,x.Kv)(l,{table:c.P,id:e.externalBotId,spaceId:a}).getValue()}),[a,l,e,t]);let d,u=_({viewType:"connectToSlackDefault"});if("connectToSlackReconnect"===t){if(!s)return null;const{accountName:e,organizationName:t}=(0,f.jg)(s);d=(0,f.jc)(s),u=_({viewType:"connectToSlackReconnect",accountName:e,organizationName:t})}return(0,b.jsx)(C.Z,{type:"custom",automationTriggerActionMenuStore:o,onClose:n,children:(0,b.jsx)(h.Z,{children:(0,b.jsxs)("div",{style:r.container,children:[(0,b.jsx)(M,{}),(0,b.jsxs)("div",{style:r.connectToSlackBody,children:[(0,b.jsx)("div",{style:r.connectToSlackTitleText,children:j(t)}),(0,b.jsx)("div",{style:r.connectToSlackDescriptionText,children:u})]}),(0,b.jsx)(k,{...e,slackWorkspaceId:d})]})})})}function k(e){window.__c={n:"AuthActionButtons"};const{automationActionMenuStore:t,slackWorkspaceId:o}=e,r=(0,n.O7)(),a=A(),c=(0,i.VK)((()=>{var e;return null===(e=S.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),u=(0,i.VK)((()=>v.Z.integrations.state.find((e=>e.id===l.nO))),[]);return u&&c?(0,b.jsxs)("div",{style:a.buttonGroup,children:[(0,b.jsx)(g.Z,{style:a.connectToSlackButton,isLarge:!0,onClick:async()=>{const n=await m.hM({environment:r,integration:u,spaceId:c,from:"collection_view_settings",options:{slackWorkspaceId:o}});s.x.isFail(n)?t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):"connectToSlackReconnect"===e.type||("connectToSlackDefault"===e.type?n.value.externalAuthentication?t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:n.value.externalAuthentication,actionStore:e.actionStore}):t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):(0,d.t1)(e))},children:(0,b.jsx)(p.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.connectButton.label",defaultMessage:"Connect"})}),(0,b.jsx)(y.Z,{style:a.cancelButton,isLarge:!0,onClick:()=>{t.popSettingsItem()},children:(0,b.jsx)(p.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.cancelButton.label",defaultMessage:"Cancel"})})]}):null}function M(){window.__c={n:"SlackIcon"};const e=A();return(0,b.jsx)("div",{children:(0,b.jsx)("img",{src:a.Z.images.externalIntegrations.slackIconPng,style:e.slackIcon})})}function j(e){return"connectToSlackDefault"===e?(0,b.jsx)(p.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.title",defaultMessage:"Connect to Slack"}):"connectToSlackReconnect"===e?(0,b.jsx)(p.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.reconnect.title",defaultMessage:"Reconnect to Slack"}):void(0,d.t1)(e)}function _(e){const{viewType:t}=e;return"connectToSlackDefault"===t?(0,b.jsx)(p.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.description",defaultMessage:"Get notified in channels, see rich previews, and more."}):"connectToSlackReconnect"===t?(0,b.jsx)(p.FormattedMessage,{id:"AutomationSlackConnectToSlackView.reconnect.description",defaultMessage:'Reconnect your Slack account ({accountName}) on {hasOrganizationName, select, true {"{organizationName}"} other {your Slack workspace}} to resume your notifications.',values:{accountName:e.accountName,hasOrganizationName:(0,d.$K)(e.organizationName),organizationName:e.organizationName}}):void(0,d.t1)(t)}function A(){return(0,r.yK)((e=>({container:{display:"flex",flexDirection:"column",margin:"10px 15px",justifyContent:"center",textAlign:"center"},connectToSlackBody:{margin:"0px 25px"},connectToSlackTitleText:{marginBottom:2,fontWeight:u.Z.fontWeight.semibold},connectToSlackDescriptionText:{fontSize:13,color:e.mediumTextColor},slackIcon:{width:23,height:"auto"},buttonGroup:{margin:"10px 10px 0px 10px"},connectToSlackButton:{width:"100%"},cancelButton:{color:e.mediumTextColor,width:"100%",justifyContent:"center",fontWeight:u.Z.fontWeight.medium,fontSize:13,marginTop:8}})),[])}},9139:(e,t,o)=>{o.d(t,{Z:()=>M});var n=o(67294),i=o(9291),r=(o(30541),o(57658),o(480)),a=o(86628),l=o(24405),s=o(41892),c=o(77657),d=o(5257),u=o(35840),p=o(149),m=o(89475),g=o(33929),y=o(18441),h=o(80444),f=o(30874),S=o(52275),v=o(68894),x=o(72495),C=o(85893);const b=(0,i.defineMessages)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Search…"}});function w(e){window.__c={n:"SlackSelectWorkspaceView"};const{onWorkspaceSelect:t,renderMenu:o,workspaceFilter:w,onNewSlackAccountAdded:k}=e,M=(0,r.O7)(),{isMobile:j}=(0,r.Fy)(),_=(0,a.VK)((()=>{var e;return null===(e=h.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),A=(0,a.VK)((()=>(0,y.P9)(f.Z.completeSlackAuthentications.state,w)),[w]),T=(0,a.VK)((()=>f.Z.integrations.state.find((e=>e.id===c.nO))),[]),[P,V]=n.useState(""),I=(0,l.yK)((e=>({chevronRight:{width:12,height:"auto",color:e.lightIconColor}})),[]);if(!T)return null;const F=Object.entries((0,y.YJ)(A,P)).map(((e,o)=>{let[n,r]=e;return{key:n,items:r.map((e=>{let{workspaceName:o,externalAuthentication:n}=e;return{key:n.id,action:()=>{t(n)},render:e=>(0,C.jsx)(S.Z,{...e,title:o??(0,C.jsx)(i.FormattedMessage,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace"}),right:(0,d.o)(I.chevronRight)})}})),render:e=>(0,C.jsx)(x.Z,{...e,title:n,topBorder:0!==o})}}));return F.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,C.jsx)("div",{children:(0,C.jsx)(v.ZP,{...e,inputLeft:(0,C.jsx)(v.f_,{icon:u.R}),showClearButton:!0,placeholder:g.default.formatMessage(b.workspaceSearchPlaceholder),focus:!j||void 0,value:P,onChange:e=>{V(e.target.value)}})})}],render:e=>(0,C.jsx)(x.Z,{...e})}),F.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!_)return;const e=await m.hM({environment:M,integration:T,spaceId:_,from:"collection_view_settings"});p.x.isFail(e)||e.value.externalAuthentication&&(t(e.value.externalAuthentication),null==k||k())},render:e=>(0,C.jsx)(S.Z,{...e,icon:(0,C.jsx)("img",{src:s.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,C.jsx)(i.FormattedMessage,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,C.jsx)(x.Z,{...e,topBorder:!0})}),(0,C.jsx)(C.Fragment,{children:o(F)})}var k=o(14648);function M(e){const{automationActionMenuStore:t,onClose:o}=e,r=n.useCallback((o=>{t.pushSettingsItem({actionStore:e.actionStore,type:"selectChannelNew",currentExternalAuthentication:o})}),[t,e.actionStore]);return(0,C.jsx)(w,{onWorkspaceSelect:r,renderMenu:e=>(0,C.jsx)(k.Z,{type:"default",automationTriggerActionMenuStore:t,headerTitle:(0,C.jsx)(i.FormattedMessage,{id:"notificationRuleSettings.selectSlackWorkspace.title",defaultMessage:"Select Slack workspace"}),sections:e,onClose:o})})}},60781:(e,t,o)=>{o.d(t,{JM:()=>j,YB:()=>_});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(72126),s=o(9291),c=o(9953),d=o(82530),u=o(15201),p=o(68709),m=o(31945),g=o(55217),y=o(79954),h=o(43250),f=o(12534),S=o(61766),v=o(79797),x=o(47043),C=o(35294),b=o(26612),w=o(48312),k=o(40190),M=o(85893);function j(e){window.__c={n:"DuplicateBlocksAction"};const{actionStore:t,disabled:o}=e,a=(0,i.O7)(),u=(0,r.VK)((()=>l.Ps(t.getBlockPointers())),[t],{useDeepEqual:!0}),p=(0,r.VK)((()=>(0,b.xy)(t.getInsertionPoint())),[t]),m=(0,n.useCallback)((e=>{d.createAndCommit({userAction:"DuplicateBlocksAction.setInsertionPoint",environment:a,perform:o=>{c.sW({store:t.getConfigStore(),data:{insertion_point:e},transaction:o})}})}),[a,t]);return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(w.Xd,{...e,title:(0,M.jsx)(s.FormattedMessage,{id:"automations.DuplicateBlocksAction.header",defaultMessage:"Insert blocks"}),picker:(0,M.jsx)(A,{currentOption:p,disabled:o,onChange:m})}),u?(0,M.jsx)(_,{...e,contentParentPointer:u}):null]})}function _(e){window.__c={n:"DuplicateBlocksActionEditor"};const{actionStore:t,disabled:o,contentParentPointer:l,buttonPlacement:c}=e,m=(0,i.O7)(),S=(0,a.yK)((e=>({listWrap:{background:e.contentBackground,borderRadius:5,boxShadow:e.inputBoxShadow,fontSize:14,minHeight:64,paddingBlock:3,paddingInline:10,..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},emptyPlaceholder:{caretColor:e.mediumTextColor,color:e.lightTextColor,fontSize:14,padding:"5px 0",display:"inline-block"}})),[]),C=(0,r.VK)((()=>v.G.createChildStore(t,l)),[t,l]),b=(0,r.VK)((()=>C.getContentStore()),[C]),w=(0,n.useCallback)((e=>{(0,f.ZP)({event:e,context:f.Af.EditorClick,callback:()=>{if(!b)return;(b.getValue()||[]).length>0||d.createAndCommit({userAction:"DuplicateBlocksAction.handleListClick",environment:m,perform:e=>{x.Nj({environment:m,parentStore:b,transaction:e})}})}})}),[m,b]);if(!b)return null;const k="inline"===(null==c?void 0:c.type);return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(y.Z,{store:C,analyticsName:"duplicate_blocks_action",isListContainer:!0,children:(0,M.jsx)(p.p,{allowSelectionWithin:!0,children:(0,M.jsx)("div",{style:S.listWrap,onClick:w,className:h.Wh_,children:(0,M.jsx)(u.O,{displayName:"DuplicateBlocksActionContent",disabled:o,children:(0,M.jsx)(g.Z,{disabled:o,store:b,emptyPlaceholder:(0,M.jsx)("div",{style:S.emptyPlaceholder,children:k?(0,M.jsx)(s.FormattedMessage,{id:"automations.DuplicateBlocksAction.emptyPlaceholder",defaultMessage:"Click to edit or drop blocks here…"}):(0,M.jsx)(s.FormattedMessage,{id:"automations.DuplicateBlocksAction.emptyCannotDropPlaceholder",defaultMessage:"Click to edit blocks here…"})}),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})})})})})})}function A(e){window.__c={n:"InsertBlockInDropdownButton"};const{currentOption:t,disabled:o,onChange:i}=e,a=(0,s.useIntl)(),l=(0,C.d)(),c=(0,r.qz)(void 0,S.Z),d=(0,n.useCallback)((e=>{i&&t.key!==e&&i(e),c.setState({open:!1})}),[c,t,i]);return(0,M.jsx)(m.ZP,{alignmentToOrigin:m.vR.End,buttonPopupStore:c,disabled:o,originGap:0,placementToOrigin:m.pO.Bottom,popupType:l,render:()=>(0,M.jsx)(b.A3,{currentOption:t,onChange:d}),renderOrigin:e=>(0,M.jsx)(k.S,{...e,disabled:o,variant:"gray",children:a.formatMessage(t.menuItemLabel)})})}},26612:(e,t,o)=>{o.d(t,{A3:()=>Z,JM:()=>I,xy:()=>K});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(28751),s=o(1230),c=o(41490),d=o(72126),u=o(82990),p=o(9291),m=o(9953),g=o(82530),y=o(52275),h=o(31945),f=o(78140),S=o(32163),v=o(72495),x=o(61766),C=o(12455),b=o(95193),w=o(35294),k=o(20804),M=o(60781),j=o(40190),_=o(80253),A=o(85893);const T=(0,p.defineMessages)({aboveMenuItemLabel:{id:"automations.DuplicateBlocksAction.aboveButtonLabel",defaultMessage:"Above button"},aboveTitle:{id:"automations.DuplicateBlocksAction.aboveTitle",defaultMessage:"above button"},belowMenuItemLabel:{id:"automations.DuplicateBlocksAction.belowButtonLabel",defaultMessage:"Below button"},belowTitle:{id:"automations.DuplicateBlocksAction.belowTitle",defaultMessage:"below button"},title:{defaultMessage:"Insert blocks {insertionPicker}",id:"automations.DuplicateBlocksAction.title"}}),P={before:{icon:(0,c.F)({width:16}),key:"before",menuItemLabel:T.aboveMenuItemLabel,title:T.aboveTitle},after:{icon:(0,s.H)({width:16}),key:"after",menuItemLabel:T.belowMenuItemLabel,title:T.belowTitle}},V=P.after;function I(e){window.__c={n:"DuplicateBlocksAction"};const{actionStore:t}=e,{disabled:o,editorPlacement:s}=(0,C.i)(),c=(0,i.O7)(),u=(0,a.yK)((()=>({title:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0",whiteSpace:"pre-wrap"}})),[]),y=(0,r.VK)((()=>(0,d.Ps)(t.getBlockPointers())),[t],{useDeepEqual:!0}),h=(0,r.VK)((()=>K(t.getInsertionPoint())),[t]),f=(0,n.useCallback)((e=>function(e,t,o){g.createAndCommit({userAction:"DuplicateBlocksAction.setInsertionPoint",environment:e,perform:e=>{m.sW({store:t.getConfigStore(),data:{insertion_point:o},transaction:e})}})}(c,t,e)),[t,c]),S=(0,r.qz)(void 0,x.Z),v=(0,n.useCallback)((()=>S.reset()),[S]),b=(0,n.useMemo)((()=>(0,A.jsx)(k.e,{actionStore:t,closeMenu:v})),[t,v]),w=(0,l.z)("duplicate_blocks"),{display:j}=w,P=Boolean(o);return(0,A.jsxs)(_.Ao,{actionMenu:b,buttonPopupStore:S,disabled:P,children:[(0,A.jsx)(_.vu,{disabled:P,display:j,children:(0,A.jsx)("div",{style:u.title,children:(0,A.jsx)(p.FormattedMessage,{...T.title,values:{insertionPicker:(0,A.jsx)(F,{currentOption:h,disabled:P,onChange:f})}})})}),(0,A.jsx)(_.R7,{disabled:P,children:y?(0,A.jsx)(M.YB,{actionStore:t,buttonPlacement:s,contentParentPointer:y,disabled:P}):null})]})}function F(e){window.__c={n:"InsertBlockInDropdownButton"};const{currentOption:t,disabled:o,onChange:i}=e,l=(0,p.useIntl)(),s=(0,a.yK)((e=>({button:{color:e.text.primary,fontWeight:u.Z.fontWeight.medium,height:"auto",marginBlock:-6,marginInline:-5,paddingBlock:6,paddingInline:5}})),[]),c=(0,w.d)(),d=(0,r.qz)(void 0,x.Z),m=(0,n.useCallback)((e=>{i&&t.key!==e&&i(e),d.setState({open:!1})}),[d,t,i]);return(0,A.jsx)(h.ZP,{alignmentToOrigin:h.vR.End,buttonPopupStore:d,disabled:o,originGap:0,placementToOrigin:h.pO.Bottom,popupType:c,render:()=>(0,A.jsx)(Z,{currentOption:t,onChange:m}),renderOrigin:e=>(0,A.jsx)(j.S,{...e,disabled:o,style:s.button,variant:"gray",children:l.formatMessage(t.title)})})}function Z(e){window.__c={n:"InsertBlockInDropdownMenu"};const{currentOption:t,onChange:o}=e,n=(0,p.useIntl)(),i=(0,b.F)({maxWidth:360}),r=Object.values(P).map((e=>({key:e.key,render:o=>(0,A.jsx)(y.Z,{...o,checkState:t.key===e.key,icon:e.icon,title:n.formatMessage(e.menuItemLabel)}),action:()=>o(e.key)})));return(0,A.jsx)(f.Z,{...i,children:(0,A.jsx)(S.Z,{initialFocus:0,sections:[{key:0,render:e=>(0,A.jsx)(v.Z,{enableActionSheetTitle:!0,...e}),items:r}],type:S.i.Vertical})})}function K(e){return Object.values(P).find((t=>t.key===e))??V}},67174:(e,t,o)=>{o.d(t,{e:()=>_,p:()=>P});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(28751),s=o(90199),c=o(606),d=o(97880),u=o(82990),p=o(9291),m=o(31945),g=o(28020),y=o(46654),h=o(80444),f=o(61766),S=o(30874),v=o(41301),x=o(12455),C=o(35294),b=o(20804),w=o(10383),k=o(40190),M=o(80253),j=o(85893);function _(e){window.__c={n:"SlackNotificationAction"};const{actionStore:t}=e,{automationContextStore:o,automationStore:i,disabled:a,suppressActionErrors:s}=(0,x.i)(),c=(0,l.z)("slack_notification"),{display:d}=c,u=Boolean(a),m=K(i)?(0,j.jsx)(v.So,{content:(0,j.jsx)(p.FormattedMessage,{...v.Mm.slackNotificationAuthenticationError})}):null,g=(0,r.qz)(void 0,f.Z),y=(0,n.useCallback)((()=>g.reset()),[g]),h=(0,n.useMemo)((()=>(0,j.jsx)(b.e,{actionStore:t,closeMenu:y})),[t,y]),S=(0,n.useMemo)((()=>!s.includes(t.id)),[s,t]),C=(0,v.TU)({actionId:t.id,contextStore:o,errorKey:"external_bot_id",shouldShow:S}),w=(0,v.TU)({actionId:t.id,contextStore:o,errorKey:"target",shouldShow:S});return(0,j.jsx)(M.Ao,{actionMenu:h,buttonPopupStore:g,disabled:u,children:(0,j.jsx)(M.vu,{disabled:u,display:d,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,j.jsx)(A,{actionStore:t,automationStore:i,disabled:u,errorMessage:m??C??w})})})}function A(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationStore:o,disabled:n,errorMessage:i}=e,r=(0,a.yK)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]);return(0,j.jsx)("div",{style:r.title,children:(0,j.jsx)(p.FormattedMessage,{defaultMessage:"<span><b>Notify</b> </span>{slackTargetPicker}",id:"automations.slackNotificationAction.action.title",values:{b:e=>(0,j.jsx)("b",{style:{fontWeight:u.Z.fontWeight.medium},children:e}),slackTargetPicker:(0,j.jsx)("div",{style:r.picker,children:(0,j.jsx)(T,{actionStore:t,automationStore:o,disabled:n,errorMessage:i})}),span:e=>(0,j.jsx)("span",{style:r.span,children:e})}})})}function T(e){window.__c={n:"AutomationSlackTargetPicker"};const{actionStore:t,automationStore:o,disabled:i,errorMessage:a}=e,[l,s]=(0,r.VK)((()=>[void 0!==t.getConfigStore().getKeyStore("external_bot_id").getValue(),t.getConfigStore().getKeyStore("target").getValue()]),[t]),u=(0,r.VK)((()=>{const e=h.default.state.currentUserStore,t=null==e?void 0:e.pointer,n=o.getCreatedByPointer();return!(!(0,d.$K)(t)||!(0,d.$K)(n))&&c.dr.isEqual(t,n)}),[o]),g=(0,r.qz)(void 0,f.Z),y=(0,n.useCallback)((()=>g.reset()),[g]),v=function(e){const{actionStore:t,automationStore:o}=e,[n,i]=(0,r.VK)((()=>{const e=t.getConfigStore();return[e.getKeyStore("target").getValue(),e.getKeyStore("external_bot_id").getValue()]}),[t]),a=K(o),l=function(e){return(0,r.VK)((()=>{const t=e.getConfigStore().getKeyStore("external_bot_id").getValue();if(t)return S.Z.completeSlackAuthentications.state.find((e=>t===e.id))}),[e])}(t),s=(0,r.VK)((()=>S.Z.completeSlackAuthentications.state.length??0),[]);if((0,d.$K)(n)&&(0,d.$K)(i))return a?{actionStore:t,externalBotId:i,notificationActionConfigStore:t,type:"connectToSlackReconnect"}:(0,d.$K)(l)?{actionStore:t,currentExternalAuthentication:l,currentNotificationChannel:n,type:"selectChannelUpdate"}:{actionStore:t,type:"connectToSlackDefault"};return 0===s?{actionStore:t,type:"connectToSlackDefault"}:s>1?{actionStore:t,type:"selectWorkspace"}:{actionStore:t,type:"selectChannelNew"}}({actionStore:t,automationStore:o}),x=(0,C.d)(),b=l&&(0,d.$K)(s),M=(0,k.d)({errorMessage:a,hasValue:b});return(0,j.jsx)(m.ZP,{alignmentToOrigin:m.vR.End,buttonPopupStore:g,disabled:i,originGap:0,placementToOrigin:m.pO.Bottom,popupType:x,renderOrigin:e=>(0,j.jsx)(k.S,{...M,...e,disabled:i,style:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},children:b?(0,j.jsx)(P,{channel:s,isAutomationOwner:u}):(0,j.jsx)(p.FormattedMessage,{id:"slackNotificationAction.targetPicker.noTarget",defaultMessage:"Select Slack channel"})}),render:()=>(0,j.jsx)(w.Z,{initialState:v,onClose:y})})}function P(e){window.__c={n:"SlackChannelWithIcon"};const{channel:t,isAutomationOwner:o}=e,n=(0,i.O7)(),a=(0,r.VK)((()=>{const e=(0,g.RM)();return!(0,d.$K)(e)||Boolean((0,y.IJ)(n,e))}),[n]);return t&&!a&&o?"public"===t.type?(0,j.jsx)(V,{channelName:t.name}):"private"===t.type?(0,j.jsx)(I,{channelName:t.name}):"me"===t.type?(0,j.jsx)(F,{channelName:t.name}):(0,d.t1)(t.type):(0,j.jsx)(Z,{})}function V(e){return(0,j.jsx)("span",{style:u.Z.textOverflowStyle,children:`#${e.channelName}`})}function I(e){window.__c={n:"PrivateSlackChannel"};const{channelName:t}=e,o=B();return(0,j.jsxs)("div",{style:o.container,children:[(0,s.b)(o.lockIcon),(0,j.jsx)("span",{style:u.Z.textOverflowStyle,children:t})]})}function F(e){const{channelName:t}=e;return(0,j.jsx)("span",{style:u.Z.textOverflowStyle,children:`@${t}`})}function Z(){window.__c={n:"NonOwnerPrivateChannel"};const e=B();return(0,j.jsxs)("div",{style:e.container,children:[(0,s.b)(e.lockIcon),(0,j.jsx)("span",{style:u.Z.textOverflowStyle,children:(0,j.jsx)(p.FormattedMessage,{defaultMessage:"Private channel",id:"slackNotificationAction.slackTargetPersonalChannel.displayName"})})]})}function K(e){return(0,r.VK)((()=>"disabled_auth"===e.getStatus()),[e])}function B(){const{isMobile:e}=(0,i.Fy)(),t=e?u.Z.fontSize.UISmall.mobile:u.Z.fontSize.UISmall.desktop;return(0,a.yK)((()=>({container:{alignItems:"baseline",display:"inline-flex",gap:2,minWidth:50,width:"100%"},lockIcon:{alignSelf:"center",height:"auto",width:t}})),[t])}},26247:(e,t,o)=>{o.d(t,{B:()=>oe,r:()=>ne});var n=o(67294),i=o(86628),r=o(35102),a=o(12455),l=(o(21703),o(480)),s=o(24405),c=o(28751),d=o(76205),u=o(43690),p=o(84619),m=o(149),g=o(97880),y=o(82990),h=o(9291),f=o(9953),S=o(82530),v=o(51592),x=o(31945),C=o(76798),b=o(21396),w=o(54802),k=o(61766),M=o(79797),j=o(41301),_=o(35294),A=o(20804),T=o(32984),P=o(52105),V=o(40190),I=o(8808),F=o(80253),Z=o(85893);const K=(0,h.defineMessages)({multipleTargetsFilter:{defaultMessage:"<span>Edit </span>{filterPicker}",id:"automations.UpdatePagesAction.multipleTargetsFilter"},multipleTargetsPicker:{defaultMessage:"<span>in </span>{targetPicker}",id:"automations.UpdatePagesAction.multipleTargetsPicker"},singleTarget:{defaultMessage:"<span>Edit </span>{targetPicker}",id:"automations.UpdatePagesAction.singleTarget"}});function B(e){window.__c={n:"UpdatePagesAction"};const{actionStore:t}=e,o=(0,l.O7)(),{automationContextStore:r,disabled:s,suppressActionErrors:d}=(0,a.i)(),p=(0,i.VK)((()=>t.getTargetStore()),[t]),m=(0,i.VK)((()=>(0,g.$K)(r)?E(t,r):void 0),[r,t]),y=(0,i.VK)((()=>{var e;const o=t.getCollectionTargetStore(),n=null==o||null===(e=o.getKeyStore("filter"))||void 0===e?void 0:e.getValue();if(n)return(0,u.Ih)(n,(null==m?void 0:m.getSchema())||{})}),[t,m]),h=(0,i.VK)((()=>{const e=t.getVariableTargetStore();if(e)return e.getValue();const o=t.getCollectionTargetStore();if(o){const e=o.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[t]),v=(0,i.VK)((()=>{if(!h||"variable"!==h.type||!r)return!1;const e=r.getContextValueForActionById(t.id,h.id);return"block"===(null==e?void 0:e.type.type)}),[t.id,r,h]),x=(0,i.qz)(void 0,k.Z),C=(0,n.useCallback)((()=>x.reset()),[x]),b=(0,n.useMemo)((()=>(0,Z.jsx)(A.e,{actionStore:t,closeMenu:C})),[t,C]),w=(0,n.useMemo)((()=>!d.includes(t.id)),[d,t]),M=(0,j.TU)({contextStore:r,actionId:t.id,shouldShow:w}),_=(0,n.useCallback)((e=>{S.createAndCommit({userAction:"UpdatePagesAction.filterChange",environment:o,perform:t=>{f.sW({data:{filter:e},store:p,transaction:t})}})}),[o,p]),P=(0,n.useCallback)((e=>{let n;if("collection"===e.type)n="UpdatePageAction.updateCollection";else if("variable"===e.type)n="UpdatePageAction.updateVariable";else{if("page"===e.type)throw new Error("Not implemented yet.");(0,g.t1)(e)}S.createAndCommit({userAction:n,environment:o,perform:o=>{f.sW({data:{properties:null,target:e,values:null},store:t.getConfigStore(),transaction:o})}})}),[o,t]),V=Boolean(s),I=(0,c.z)("update_pages"),{display:K}=I;return r?(0,Z.jsxs)(F.Ao,{actionMenu:b,buttonPopupStore:x,disabled:V,children:[(0,Z.jsx)(F.vu,{disabled:V,display:K,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:v||!m?(0,Z.jsx)(O,{actionStore:t,automationContextStore:r,disabled:V,errorMessage:M,onTargetChange:P,value:h}):(0,Z.jsx)(R,{actionStore:t,automationContextStore:r,collectionStore:m,disabled:V,errorMessage:M,filter:y,onFilterChange:_,onTargetChange:P,value:h})}),m&&(0,Z.jsx)(F.R7,{disabled:V,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,Z.jsx)(T.QF,{actionStore:t,collectionStore:m,contextStore:r,disabled:V,showSetPropertyActions:!0})})]}):null}function O(e){window.__c={n:"ActionSingleTitle"};const{actionStore:t,automationContextStore:o,disabled:n,errorMessage:i,onTargetChange:r,value:a}=e,l=(0,s.yK)((()=>({b:{fontWeight:y.Z.fontWeight.medium},picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]);return(0,Z.jsx)("div",{style:l.title,children:(0,Z.jsx)(h.FormattedMessage,{...K.singleTarget,values:{b:e=>(0,Z.jsx)("b",{style:l.b,children:e}),targetPicker:(0,Z.jsx)(W,{actionStore:t,automationContextStore:o,disabled:n,errorMessage:i,onChange:r,value:a}),span:e=>(0,Z.jsx)("span",{style:l.span,children:e})}})})}function R(e){window.__c={n:"ActionMultipleTitle"};const{actionStore:t,automationContextStore:o,collectionStore:n,disabled:i,errorMessage:r,filter:a,onFilterChange:l,onTargetChange:c,value:d}=e,u=(0,s.yK)((()=>({b:{fontWeight:y.Z.fontWeight.medium},picker:{display:"inline-flex",minWidth:50},span:{flex:0},title:{display:"inline-flex",minWidth:50}})),[]);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)("div",{style:u.title,children:[(0,Z.jsx)(h.FormattedMessage,{...K.multipleTargetsFilter,values:{filterPicker:(0,Z.jsx)(D,{collectionStore:n,disabled:i,filter:a,onChange:l}),span:e=>(0,Z.jsx)("span",{style:u.span,children:e})}})," "]}),(0,Z.jsx)("div",{style:u.title,children:(0,Z.jsx)(h.FormattedMessage,{...K.multipleTargetsPicker,values:{targetPicker:(0,Z.jsx)(W,{actionStore:t,automationContextStore:o,disabled:i,errorMessage:r,onChange:c,value:d}),span:e=>(0,Z.jsx)("span",{style:u.span,children:e})}})})]})}function D(e){var t;window.__c={n:"FilterPicker"};const{collectionStore:o,disabled:r,filter:a,onChange:l}=e,c=(0,s.yK)((()=>({b:{fontWeight:y.Z.fontWeight.medium}})),[]),u=(0,i.qz)(void 0,k.Z),p=(0,_.d)({tabletBehavior:"slideUp"}),m=(0,n.useCallback)((()=>u.reset()),[u]),g=(0,i.VK)((()=>{const e=o.getModel(),t=null==e?void 0:e.getDatabaseType();return(0,v.Q_)(t)}),[o]),f=(null==a||null===(t=a.filters)||void 0===t?void 0:t.length)||0;return(0,Z.jsx)(x.ZP,{alignmentToOrigin:x.vR.End,disabled:r,originGap:0,placementToOrigin:x.pO.Bottom,popupType:p,renderOrigin:e=>(0,Z.jsx)(V.S,{...e,disabled:r,variant:"gray",onClick:t=>{e.onClick(t),0===f&&l(d.TI)},style:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},children:f>0?(0,Z.jsx)(h.FormattedMessage,{defaultMessage:"<b>{itemType}</b> that match {ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",id:"automations.UpdatePagesAction.FilterPicker.withRules",values:{b:e=>(0,Z.jsx)("b",{style:c.b,children:e}),itemType:g,ruleCount:f}}):(0,Z.jsx)(h.FormattedMessage,{defaultMessage:"all <b>{itemType}</b>",id:"automations.UpdatePagesAction.FilterPicker.noRules",values:{b:e=>(0,Z.jsx)("b",{style:c.b,children:e}),itemType:g}})}),render:()=>(0,Z.jsx)(P.m,{collectionStore:o,disabled:r,filter:a,onChange:l,onClose:m})})}function W(e){window.__c={n:"TargetPicker"};const{actionStore:t,automationContextStore:o,disabled:r,errorMessage:a,onChange:l,value:s}=e,c=(0,i.VK)((()=>{if("collection"===(null==s?void 0:s.type))return M.NW.createChildStore(t,s.collection)}),[t,s]),d=(0,i.VK)((()=>{if(s&&"variable"===s.type)return o.getContextValueForActionById(t.id,s.id)}),[s,o,t.id]),u=(0,V.d)({errorMessage:a,hasValue:Boolean(s||d)}),m=(0,i.qz)(void 0,k.Z),y=(0,_.d)(),f=(0,n.useCallback)((()=>m.reset()),[m]),S=(0,n.useCallback)((e=>{l(e),f()}),[l,f]);return(0,Z.jsx)(x.ZP,{buttonPopupStore:m,popupType:y,alignmentToOrigin:x.vR.End,placementToOrigin:x.pO.Bottom,originGap:0,disabled:r,renderOrigin:e=>(0,Z.jsx)(V.S,{disabled:r,...u,...e,style:{height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},children:(0,g.$K)(c)?(0,Z.jsx)(C.Z,{store:c}):d?(0,Z.jsx)(b.F,{format:p.lo.Medium,isSingle:!0,value:d}):(0,Z.jsx)(h.FormattedMessage,{id:"automations.UpdatePagesAction.pagesDropdown.label",defaultMessage:"Select database"})}),render:e=>(0,Z.jsx)(I.L,{actionId:t.id,automationContextStore:o,onChange:S,onClose:f,selectedTarget:s,skipPages:!0})})}function E(e,t){const o=e.getTargetStore().getValue();if(o){if("collection"===o.type)return M.NW.createChildStore(e,o.collection);if("variable"===o.type){if(!t)return;const n=t.compilationResultStore.state;if(m.x.isFail(n))return;const i=(0,r.vx)(n.value.valueTypes,o.id);if(i)return(0,w.wB)(i,e)}else{if("page"===o.type)return;(0,g.t1)(o)}}}var N=o(3865),L=o(10383),H=o(29723),U=o(23704),z=o(23723),$=o(93377),q=o(82207),G=o(84799),Y=o(99144),Q=o(4328),X=o(73427),J=o(72080);function ee(e){var t;window.__c={n:"UpdateThisPageAction"};const{actionStore:o}=e,{automationContextStore:r,disabled:l}=(0,a.i)(),s=(0,i.VK)((()=>o.getConfig()),[o]),c=(0,i.VK)((()=>(0,g.$K)(r)?E(o,r):void 0),[r,o]),d=(0,i.VK)((()=>null==c?void 0:c.getSchema()),[c]),u=(0,i.VK)((()=>null==c?void 0:c.getDeletedSchema()),[c]),p=(0,i.qz)(void 0,k.Z),m=(0,n.useCallback)((()=>p.reset()),[p]),y=(0,n.useMemo)((()=>(0,Z.jsx)(A.e,{actionStore:o,closeMenu:m})),[o,m]),h=((null==s?void 0:s.properties)??[])[0],f=null==d?void 0:d[h],S=null==u?void 0:u[h],v=null==s||null===(t=s.values)||void 0===t?void 0:t[h],x=Boolean(l),C={actionMenu:y,buttonPopupStore:p,disabled:x,value:null==v?void 0:v.value};return!f&&S?(0,Z.jsx)(z.RN,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(z.rV,{...e,...C,propertySchema:S})}):f||S?f&&c?(0,N.SF)(f)?"person"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(q.ZP,{...e,...C,propertySchema:f})}):"status"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(Q.yr,{...e,...C,propertySchema:f})}):"select"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(Y.D9,{...e,...C,propertySchema:f})}):"multi_select"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)($.m,{...e,...C,propertySchema:f})}):"date"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(U.er,{...e,...C,propertySchema:f,valueContext:{collectionStore:c,property:h,type:"collection"}})}):"relation"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(G.ZP,{...e,...C,collectionStore:c,propertySchema:f})}):"checkbox"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(H.Q2,{...e,...C,propertySchema:f})}):"title"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(X.QQ,{...e,...C,propertySchema:f})}):"text"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(X.Vk,{...e,...C,propertySchema:f})}):"email"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(X.Kh,{...e,...C,propertySchema:f})}):"url"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(X.GJ,{...e,...C,propertySchema:f})}):"number"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(X.go,{...e,...C,propertySchema:f})}):"phone_number"===f.type?(0,Z.jsx)(te,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(X.gi,{...e,...C,propertySchema:f})}):null:(0,Z.jsx)(J.l6,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,Z.jsx)(J.OZ,{...e,...C,propertySchema:f})}):null:(0,Z.jsx)(z.RN,{actionId:o.id,renderOrigin:e=>(0,Z.jsx)(z.PO,{...e,...C})})}function te(e){window.__c={n:"EditActionMenuButtonPopup"};const{actionId:t,propertyId:o,renderOrigin:r}=e,a=(0,_.d)(),l=(0,i.qz)(void 0,k.Z),s=(0,n.useCallback)((()=>l.reset()),[l]),c=(0,n.useMemo)((()=>({actionId:t,propertyId:o,type:"eventActionProperty"})),[t,o]);return(0,Z.jsx)(x.ZP,{buttonPopupStore:l,popupType:a,render:()=>(0,Z.jsx)(L.Z,{initialState:c,onClose:s}),renderOrigin:r})}function oe(e){window.__c={n:"UpdatePagesActionResolver"};const{actionStore:t}=e,{automationContextStore:o}=(0,a.i)();return(0,i.VK)((()=>ne(o,t)),[t,o])?(0,Z.jsx)(ee,{...e}):(0,Z.jsx)(B,{...e})}function ne(e,t){var o;if(!t.isType("update_pages"))return!1;const n=t.getConfig(),i="variable"===(null==n||null===(o=n.target)||void 0===o?void 0:o.type)?(0,r.MY)(n.target.id):void 0;return"event"===(null==e?void 0:e.context.type)&&i&&"global"===i.source&&"button_page"===i.global}},29723:(e,t,o)=>{o.d(t,{G7:()=>v,LJ:()=>S,Q2:()=>f});var n=o(67294),i=o(24405),r=o(76218),a=o(65628),l=o(96711),s=o(42283),c=o(82990),d=o(9291),u=o(20776),p=o(4023),m=o(56812),g=o(93060),y=o(80253),h=o(85893);function f(e){window.__c={n:"UpdateThisPageCheckboxPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:a,propertySchema:l,value:d}=e,u=(0,i.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...c.Z.textOverflowStyle,fontWeight:c.Z.fontWeight.semibold}})),[]),m=S({propertySchema:l,styles:u,value:d}),f=v({propertySchema:l,value:d}),x=(0,n.useCallback)((e=>(0,h.jsx)(y.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:r,icon:s.r,onClick:a,children:(0,h.jsx)("div",{style:u.content,children:m})})),[t,o,r,a,u.content,m]);return(0,h.jsx)(g.y,{renderOrigin:x,title:f,tooltipAlignment:p.v.Center,tooltipPlacement:p.u.Left})}function S(e){const{propertySchema:t,styles:o,value:n}=e,i=(0,r.A6)(null==n?void 0:n.value)[0],s=t.name,c=!0===i?(0,l.V)({width:12}):(0,a.z)({width:10}),p=!0===i?(0,h.jsx)(d.FormattedMessage,{...m.Bo.actionCheckboxPropertyChecked}):(0,h.jsx)(d.FormattedMessage,{...m.Bo.actionCheckboxPropertyUnchecked});return(0,h.jsx)(d.FormattedMessage,{...m.hW({propertyName:(0,h.jsx)("span",{style:o.propertyName,children:s}),propertyValue:(0,h.jsx)(u.o,{icon:c,shouldTruncateChildren:!0,children:p})})})}function v(e){const{propertySchema:t,value:o}=e,n=!0===(0,r.A6)(null==o?void 0:o.value)[0]?(0,h.jsx)(d.FormattedMessage,{...m.Bo.actionCheckboxPropertyChecked}):(0,h.jsx)(d.FormattedMessage,{...m.Bo.actionCheckboxPropertyUnchecked});return(0,h.jsx)(d.FormattedMessage,{...m.hW({propertyName:t.name,propertyValue:n})})}},23704:(e,t,o)=>{o.d(t,{Sg:()=>_,er:()=>j,kD:()=>A});var n=o(67294),i=o(86628),r=o(24405),a=o(84619),l=o(7057),s=o(35102),c=o(76218),d=o(42875),u=o(53016),p=o(70203),m=o(97880),g=o(82990),y=o(9291),h=o(26388),f=o(21396),S=o(75311),v=o(85567),x=o(54802),C=o(56812),b=o(12455),w=o(93060),k=o(80253),M=o(85893);function j(e){window.__c={n:"UpdateThisPageDatePropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:a,onClick:l,propertySchema:s,value:c,valueContext:d}=e,{automationContextStore:p}=(0,b.i)(),m=(0,y.useIntl)(),f=(0,r.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...g.Z.textOverflowStyle,fontWeight:g.Z.fontWeight.semibold}})),[]),S=(0,i.VK)((()=>p?_({automationContextStore:p,intl:m,propertySchema:s,styles:f,value:c,valueContext:d}):void 0),[p,m,s,f,c,d]),v=(0,i.VK)((()=>p?A({automationContextStore:p,intl:m,propertySchema:s,value:c,valueContext:d}):void 0),[p,m,s,c,d]),x=(0,n.useCallback)((e=>(0,M.jsx)(k.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:a,icon:u.V,onClick:l,children:(0,M.jsx)("div",{style:f.content,children:S})})),[t,o,a,l,f.content,S]);return p&&S&&v?(0,M.jsx)(w.y,{disable:a,renderOrigin:x,title:v,tooltipAlignment:h.v2.Center,tooltipPlacement:h.ug.Left}):null}function _(e){const{automationContextStore:t,intl:o,propertySchema:n,styles:i,value:r,valueContext:u}=e,h=(0,M.jsx)("span",{style:i.propertyName,children:n.name});if(void 0===(null==r?void 0:r.value))return(0,M.jsx)(y.FormattedMessage,{...C.xf({propertyName:h})});let b;const w=x.tk(t),k=(0,S._)(u),j=(0,c.A6)(null==r?void 0:r.value)[0];if(!(0,m.$K)(j)||"string"==typeof j||"boolean"==typeof j||(0,p.IWo)(j)||(0,p.STW)(j))b=(0,M.jsx)(v.Z,{format:a.lo.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,M.jsx)("span",{style:g.Z.textOverflowStyle,children:(0,M.jsx)(y.FormattedMessage,{...C.Bo.unknownValue})})});else if((0,p.wjk)(j)){const e=(0,p.vmO)(j).id,t=(0,s.vx)(w,e);b=t?(0,M.jsx)(f.F,{value:t,format:a.lo.Medium,isSingle:!1,shouldShrink:!0}):(0,M.jsx)(v.Z,{format:a.lo.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,M.jsx)("span",{style:g.Z.textOverflowStyle,children:(0,M.jsx)(y.FormattedMessage,{...C.Bo.unknownValue})})})}else if((0,p.fpG)(j)){const e=(0,p.zyO)(j);b=e?(0,l.OB)({value:e,date_format:k.dateFormat,time_format:k.timeFormat,userTimeZone:(0,d.r)(),allowRelativeDates:!0,intl:o,shortenDateAndRange:!0,displayInUserTimezone:!0,formatValuesFn:e=>{let{endDate:t,endTime:o,startDate:n}=e;return(0,m.$K)(o)?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(T,{value:n})," → ",(0,M.jsx)(T,{value:o})]}):(0,m.$K)(t)?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(T,{value:n})," → ",(0,M.jsx)(T,{value:t})]}):(0,M.jsx)(T,{value:n})}}):null}else(0,m.t1)(j);return void 0===b?void 0:(0,M.jsx)(y.FormattedMessage,{...C.zU({propertyName:h,propertyValue:b})})}function A(e){const{automationContextStore:t,intl:o,propertySchema:n,value:i,valueContext:r}=e,a=n.name;if(void 0===(null==i?void 0:i.value))return(0,M.jsx)(y.FormattedMessage,{...C.xf({propertyName:a})});let u;const g=x.tk(t),h=(0,S._)(r),v=(0,c.A6)(null==i?void 0:i.value)[0];if(!(0,m.$K)(v)||"string"==typeof v||"boolean"==typeof v||(0,p.IWo)(v)||(0,p.STW)(v))u=(0,M.jsx)(y.FormattedMessage,{...C.Bo.unknownValue});else if((0,p.wjk)(v)){const e=(0,p.vmO)(v).id,t=(0,s.vx)(g,e);u=t?(0,f.e)(t):(0,M.jsx)(y.FormattedMessage,{...C.Bo.unknownValue})}else if((0,p.fpG)(v)){const e=(0,p.zyO)(v);u=e?(0,l.ZV)({value:e,date_format:h.dateFormat,time_format:h.timeFormat,userTimeZone:(0,d.r)(),allowRelativeDates:!0,intl:o,shortenDateAndRange:!0,displayInUserTimezone:!0}):null}else(0,m.t1)(v);return void 0===u?void 0:(0,M.jsx)(y.FormattedMessage,{...C.zU({propertyName:a,propertyValue:u})})}function T(e){window.__c={n:"AutomationDateToken"};const{value:t}=e,o=(0,r.Fg)();return(0,M.jsx)(v.Z,{backgroundColor:o.accentColors.gray[75],format:a.lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:{marginBlockEnd:4},value:t})}},23723:(e,t,o)=>{o.d(t,{Ox:()=>h,PO:()=>g,RN:()=>y,Si:()=>f,fX:()=>S,rV:()=>m});var n=o(67294),i=o(86628),r=o(24405),a=o(9291),l=o(31945),s=o(61766),c=o(35294),d=o(92688),u=o(72080),p=o(85893);function m(e){window.__c={n:"UpdateThisPageDeletedPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:i,propertySchema:a}=e,l=(0,r.yK)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),s=h({propertySchema:a,styles:l}),c=f({propertySchema:a});return(0,p.jsx)(u.gq,{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:i,styles:l,tooltip:c,children:s})}function g(e){window.__c={n:"UpdateThisPagePermanentlyDeletedPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:i}=e,a=(0,r.yK)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),l=S();return(0,p.jsx)(u.gq,{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:i,styles:a,tooltip:l,children:l})}function y(e){window.__c={n:"UpdateThisPageDeletedPropertyMenuButtonPopup"};const{actionId:t,propertyId:o,renderOrigin:r}=e,a=(0,c.d)(),u=(0,i.qz)(void 0,s.Z),m=(0,n.useCallback)((()=>u.reset()),[u]);return(0,p.jsx)(l.ZP,{buttonPopupStore:u,popupType:a,render:()=>(0,p.jsx)(d.k,{actionId:t,closeMenu:m,propertyId:o}),renderOrigin:r})}function h(e){const{propertySchema:t,styles:o}=e;return(0,p.jsx)(a.FormattedMessage,{defaultMessage:"{propertyName} property was deleted",id:"updateThisPageUnsupportedPropertyAction.deletedProperty.title",values:{propertyName:(0,p.jsx)("span",{style:o.propertyType,children:t.name})}})}function f(e){const{propertySchema:t}=e;return(0,p.jsx)(a.FormattedMessage,{defaultMessage:"{propertyName} property was deleted",id:"updateThisPageUnsupportedPropertyAction.deletedProperty.title",values:{propertyName:t.name}})}function S(){return(0,p.jsx)(a.FormattedMessage,{defaultMessage:"The property was permanently deleted",id:"updateThisPageUnsupportedPropertyAction.permanentlyDeleted.title"})}},93377:(e,t,o)=>{o.d(t,{H:()=>f,m:()=>S});var n=o(67294),i=o(86628),r=o(24405),a=o(76218),l=o(72050),s=o(97880),c=o(82990),d=o(9291),u=o(26388),p=o(56812),m=o(93060),g=o(80253),y=o(99144),h=o(85893);const f=5;function S(e){window.__c={n:"UpdateThisPageMultiSelectPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:S,limit:v=f,onClick:x,propertySchema:C,value:b}=e,w=(0,d.useIntl)(),k=null!=b&&b.value?(0,a.A6)(null==b?void 0:b.value):[],M=p.oJ({limit:v,optionValues:k.map((e=>"string"==typeof e?e:void 0)).filter(s.$K),propertySchema:C}),j=(0,r.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:M.length<=1?"nowrap":"wrap",whiteSpace:"pre"},propertyName:{...c.Z.textOverflowStyle,fontWeight:c.Z.fontWeight.semibold}})),[M.length]),_=(0,i.VK)((()=>(0,y.F0)({intl:w,propertySchema:C,styles:j,values:M})),[w,M,C,j]),A=(0,i.VK)((()=>(0,y.I7)({intl:w,propertySchema:C,values:M})),[w,M,C]),T=(0,n.useCallback)((e=>(0,h.jsx)(g.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:S,icon:l.A,onClick:x,children:(0,h.jsx)("div",{style:j.content,children:_})})),[t,o,S,x,j.content,_]);return(0,h.jsx)(m.y,{renderOrigin:T,title:A,tooltipAlignment:u.v2.Center,tooltipPlacement:u.ug.Left})}},82207:(e,t,o)=>{o.d(t,{UD:()=>x,ZP:()=>v,iT:()=>C,y3:()=>b});var n=o(67294),i=o(86628),r=o(24405),a=o(66897),l=o(80951),s=o(26774),c=o(97880),d=o(82990),u=o(9291),p=o(26388),m=o(92864),g=o(56812),y=o(12455),h=o(93060),f=o(80253),S=o(85893);function v(e){window.__c={n:"UpdateThisPagePersonPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:a,onClick:l,propertySchema:m,value:g}=e,{automationContextStore:v}=(0,y.i)(),w=(0,u.useIntl)(),k=(0,i.VK)((()=>{const e=null==v?void 0:v.context.automationStore;return(0,c.$K)(e)?x({getRecordModel:e.getRecordModel,propertySchema:m,value:g}):[]}),[null==v?void 0:v.context.automationStore,m,g]),M=(0,r.yK)((()=>({content:{alignItems:"center",display:"flex",flexWrap:k.length>1?"wrap":"nowrap",whiteSpace:"pre"},propertyName:{...d.Z.textOverflowStyle,fontWeight:d.Z.fontWeight.semibold},propertyValue:{...d.Z.textOverflowStyle,paddingBlockStart:4},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:4}})),[k.length]),j=(0,i.VK)((()=>C({actors:k,propertySchema:m,styles:M})),[k,m,M]),_=(0,i.VK)((()=>b({actors:k,intl:w,propertySchema:m})),[k,w,m]),A=(0,n.useCallback)((e=>(0,S.jsx)(f.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:a,icon:s.O,onClick:l,children:(0,S.jsx)("div",{style:M.content,children:j})})),[t,o,a,l,M.content,j]);return(0,S.jsx)(h.y,{renderOrigin:A,title:_,tooltipAlignment:p.v2.Center,tooltipPlacement:p.ug.Left})}function x(e){const{getRecordModel:t,propertySchema:o,value:n}=e;return(0,l.DW)({textValue:null==n?void 0:n.value,propertySchema:o,blockCreatorPointer:void 0}).map((e=>(0,a.Hl)({getRecordModel:t,pointer:e}))).filter(c.$K)}function C(e){const{actors:t,propertySchema:o,styles:n}=e,i=(0,S.jsx)("span",{style:n.propertyName,children:o.name}),r=function(e){const{actors:t,styles:o}=e;return 1===t.length?(0,S.jsx)("div",{style:o.propertyValue,children:(0,S.jsx)(m.ZP,{actor:t[0],showRemoveButton:!1,format:m.ZP.Format.Medium,isSingle:!1})}):(0,S.jsx)("ul",{style:o.propertyValueList,children:t.map(((e,t)=>(0,S.jsx)("li",{children:(0,S.jsx)("div",{style:o.propertyValue,children:(0,S.jsx)(m.ZP,{actor:e,showRemoveButton:!1,format:m.ZP.Format.Medium,isSingle:!1})},t)},t)))})}({actors:t,styles:n});let a;return a=0===t.length?g.ht({propertyName:i}):1===t.length?g.wE({propertyName:i,propertyValue:r}):g.Oq({propertyName:i,propertyValue:r}),(0,S.jsx)(u.FormattedMessage,{...a})}function b(e){const{actors:t,intl:o,propertySchema:n}=e,i=t.map((e=>(0,a.$4)(o,e))),r=n.name,l=o.formatList(i,{style:"long",type:"conjunction"});let s;return s=0===t.length?g.ht({propertyName:r}):1===t.length?g.wE({propertyName:r,propertyValue:l}):g.Oq({propertyName:r,propertyValue:l}),(0,S.jsx)(u.FormattedMessage,{...s})}},84799:(e,t,o)=>{o.d(t,{ZP:()=>j,vT:()=>A,wr:()=>T});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(84619),s=o(35102),c=o(76218),d=o(92607),u=o(21202),p=o(70203),m=o(97880),g=o(82990),y=o(9291),h=o(26388),f=o(21396),S=o(25845),v=o(37034),x=o(79797),C=o(56812),b=o(12455),w=o(93060),k=o(80253),M=o(85893);function j(e){window.__c={n:"UpdateThisPageRelationPropertyAction"};const{actionMenu:t,buttonPopupStore:o,collectionStore:l,disabled:s,onClick:c,propertySchema:u,value:p}=e,{automationContextStore:m}=(0,b.i)(),f=(0,i.O7)(),S=(0,y.useIntl)(),v=(0,r.VK)((()=>(null==m?void 0:m.getAllContextValues())??[]),[m]),x=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex",flex:"1 1 auto",minWidth:0,whiteSpace:"pre"},propertyName:{...g.Z.textOverflowStyle,fontWeight:g.Z.fontWeight.semibold,minWidth:20},propertyValue:{...g.Z.textOverflowStyle,minWidth:40},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:10},propertyValueListItem:{display:"flex"}})),[]),C=(0,r.VK)((()=>A({automationContextValues:v,collectionStore:l,propertySchema:u,styles:x,value:p})),[v,l,u,x,p]),j=(0,r.VK)((()=>T({automationContextValues:v,collectionStore:l,environment:f,intl:S,propertySchema:u,value:p})),[v,l,f,S,u,p]),_=(0,n.useCallback)((e=>(0,M.jsx)(k.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:s,icon:d.v,onClick:c,children:C})),[t,o,s,c,C]);return(0,M.jsx)(w.y,{renderOrigin:_,title:j,tooltipAlignment:h.v2.Center,tooltipPlacement:h.ug.Left})}function _(e){const{collectionStore:t,value:o}=e;return"string"==typeof o?(0,M.jsx)(S.Z,{blockId:o,format:l.lo.Medium,isSingle:!0,noUnderline:!0,parentStore:t,shouldShrink:!0}):(0,M.jsx)(f.F,{format:l.lo.Medium,isSingle:!0,shouldShrink:!0,value:o})}function A(e){const{automationContextValues:t,collectionStore:o,propertySchema:n,styles:i,value:r}=e,a=r?P({automationContextValues:t,limit:n.limit,value:r}):[],l=(0,M.jsx)("span",{style:i.propertyName,children:n.name});let s;return s=0===a.length?(0,M.jsx)("div",{style:i.content,children:(0,M.jsx)(y.FormattedMessage,{...C.Iu({propertyName:l})})}):1===a.length?(0,M.jsx)("div",{style:i.content,children:(0,M.jsx)(y.FormattedMessage,{...C.S0({propertyName:l,propertyValue:(0,M.jsx)("span",{style:i.propertyValue,children:(0,M.jsx)(_,{collectionStore:o,value:a[0]})})})})}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{style:i.content,children:(0,M.jsx)(y.FormattedMessage,{...C.om({propertyName:l,propertyValue:[]})})}),(0,M.jsx)("ul",{style:i.propertyValueList,children:a.map(((e,t)=>(0,M.jsx)("li",{style:i.propertyValueListItem,children:(0,M.jsx)(_,{collectionStore:o,value:e})},t)))})]}),s}function T(e){const{automationContextValues:t,collectionStore:o,environment:n,intl:i,propertySchema:r,value:a}=e,l=(a?P({automationContextValues:t,limit:r.limit,value:a}):[]).map((e=>{if("string"==typeof e){const t=x.G.createChildStore(o,{id:e,table:u.iU});return(0,v.vU)({environment:n,intl:i,store:t})}return(0,f.e)(e)})).filter(m.$K),s=r.name;let c;return c=0===l.length?C.Iu({propertyName:s}):1===l.length?C.S0({propertyName:s,propertyValue:l[0]}):C.om({propertyName:s,propertyValue:i.formatList(l,{style:"long",type:"conjunction"})}),(0,M.jsx)(y.FormattedMessage,{...c})}function P(e){const{automationContextValues:t,limit:o,value:n}=e;return(0,c.A6)(n.value).slice(0,o).map((e=>{if("string"!=typeof e&&"boolean"!=typeof e){if((0,p.wjk)(e)){const o=(0,p.vmO)(e).id,n=(0,s.vx)(t,o);if(!n)return;return n}if((0,p.STW)(e)){const t=(0,p.TOT)(e);if(!t)return;return t}}})).filter(m.$K)}},99144:(e,t,o)=>{o.d(t,{D9:()=>b,F0:()=>w,I7:()=>k});var n=o(67294),i=o(86628),r=o(24405),a=o(84619),l=o(76218),s=o(53866),c=o(72126),d=o(97880),u=o(82990),p=o(9291),m=o(26388),g=o(22084),y=o(85567),h=o(65380),f=o(56812),S=o(93060),v=o(80253),x=o(37867),C=o(85893);function b(e){window.__c={n:"UpdateThisPageSelectPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:a,onClick:d,propertySchema:g,value:y}=e,h=(0,p.useIntl)(),x=(0,r.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...u.Z.textOverflowStyle,fontWeight:u.Z.fontWeight.semibold}})),[]),b=null!=y&&y.value?(0,l.A6)(null==y?void 0:y.value)[0]:void 0,M=f.oJ({propertySchema:g,optionValues:(0,c.HD)(b)?[b]:[]}),j=(0,i.VK)((()=>w({intl:h,propertySchema:g,styles:x,values:M})),[h,M,g,x]),_=(0,i.VK)((()=>k({intl:h,propertySchema:g,values:M})),[h,M,g]),A=(0,n.useCallback)((e=>(0,C.jsx)(v.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:a,icon:s.w,onClick:d,children:(0,C.jsx)("div",{style:x.content,children:j})})),[t,o,a,d,x.content,j]);return(0,C.jsx)(S.y,{renderOrigin:A,title:_,tooltipAlignment:m.v2.Center,tooltipPlacement:m.ug.Left})}function w(e){const{intl:t,propertySchema:o,styles:n,tokenFormat:i,values:r}=e,l=i??a.lo.Medium,s=(0,C.jsx)("span",{style:n.propertyName,children:o.name}),c=r.map((e=>"deleted"===e.type?(0,C.jsx)(x.Z,{tokenFormat:l},`missing_option_value_${e.value}`):"option"===e.type?(0,C.jsx)(g.a,{color:e.value.color,format:l,isSingle:!0,showRemoveButton:!1,value:e.value.value},e.value.id):"truncation"===e.type?(0,C.jsx)(y.Z,{format:l,isRound:!0,isSingle:!0,showRemoveButton:!1,value:e.value},"More tokens"):void(0,d.t1)(e)));return 0===c.length?(0,C.jsx)(p.FormattedMessage,{...f.Mw({propertyName:s})}):1===c.length?(0,C.jsx)(p.FormattedMessage,{...f.rf({propertyName:s,propertyValue:c[0]})}):(0,C.jsx)(p.FormattedMessage,{...f.Sj({propertyName:s,propertyValue:(0,h.H)(t.formatList(c,{style:"long",type:"conjunction"}))})})}function k(e){const{intl:t,propertySchema:o,values:n}=e,i=o.name,r=n.map((e=>"deleted"===e.type?f.ST(t):"option"===e.type?e.value.value:"truncation"===e.type?e.value:void(0,d.t1)(e)));return 0===r.length?(0,C.jsx)(p.FormattedMessage,{...f.Mw({propertyName:i})}):1===r.length?(0,C.jsx)(p.FormattedMessage,{...f.rf({propertyName:i,propertyValue:r[0]})}):(0,C.jsx)(p.FormattedMessage,{...f.Sj({propertyName:i,propertyValue:(0,h.H)(t.formatList(r,{style:"long",type:"conjunction"}))})})}},4328:(e,t,o)=>{o.d(t,{LQ:()=>S,O3:()=>f,yr:()=>h});var n=o(67294),i=o(86628),r=o(24405),a=o(76218),l=o(3729),s=o(82990),c=o(9291),d=o(26388),u=o(56812),p=o(93060),m=o(80253),g=o(87181),y=o(85893);function h(e){window.__c={n:"UpdateThisPageStatusPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:u,onClick:g,propertySchema:h,value:v}=e,x=(0,c.useIntl)(),C=(0,a.A6)(null==v?void 0:v.value)[0],b=(0,r.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...s.Z.textOverflowStyle,fontWeight:s.Z.fontWeight.semibold}})),[]),w=(0,i.VK)((()=>f({intl:x,propertySchema:h,styles:b,value:C})),[x,h,C,b]),k=(0,i.VK)((()=>S({intl:x,propertySchema:h,value:C})),[x,h,C]),M=(0,n.useCallback)((e=>(0,y.jsx)(m.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:u,icon:l.T,onClick:g,children:(0,y.jsx)("div",{style:b.content,children:w})})),[t,o,u,g,b.content,w]);return w&&k?(0,y.jsx)(p.y,{renderOrigin:M,title:k,tooltipAlignment:d.v2.Center,tooltipPlacement:d.ug.Left}):null}function f(e){const{intl:t,propertySchema:o,styles:n,value:i}=e;if(!i||"string"!=typeof i)return;const r=(0,y.jsx)("span",{style:n.propertyName,children:o.name}),a=(0,g.L)({intl:t,groupValues:[],optionValues:[i],propertySchema:o});return 0!==a.length?(0,y.jsx)(c.FormattedMessage,{...(0,u.Ig)({propertyName:r,propertyValue:a})}):void 0}function S(e){const{intl:t,propertySchema:o,value:n}=e;if(!n||"string"!=typeof n)return;const i=o.name,r=(0,g.L)({intl:t,isText:!0,groupValues:[],optionValues:[n],propertySchema:o});return 0!==r.length?(0,y.jsx)(c.FormattedMessage,{...(0,u.Ig)({propertyName:i,propertyValue:r})}):void 0}},73427:(e,t,o)=>{o.d(t,{GJ:()=>I,Kh:()=>V,QQ:()=>T,Ut:()=>_,Vk:()=>P,gi:()=>Z,go:()=>F,lG:()=>A});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(84619),s=o(48524),c=o(55159),d=o(34093),u=o(108),p=o(83303),m=o(8938),g=o(23867),y=o(82990),h=o(9291),f=o(26388),S=o(85567),v=o(60682),x=o(14976),C=o(56812),b=o(12455),w=o(93060),k=o(80253),M=o(85893);function j(e){window.__c={n:"UpdateThisPageBaseTextPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:l,icon:s,onClick:c,propertySchema:d,value:u}=e,{automationStore:p}=(0,b.i)(),m=(0,i.O7)(),g=(0,a.Fg)(),h=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...y.Z.textOverflowStyle,fontWeight:y.Z.fontWeight.semibold}})),[]),S=(0,r.VK)((()=>_({automationStore:p,environment:m,propertySchema:d,styles:h,theme:g,value:u})),[p,m,d,h,g,u]),v=(0,r.VK)((()=>A({automationStore:p,environment:m,propertySchema:d,theme:g,value:u})),[p,m,d,g,u]),x=(0,n.useCallback)((e=>(0,M.jsx)(k.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:l,icon:s,onClick:c,children:(0,M.jsx)("div",{style:h.content,children:S})})),[t,o,l,s,c,h.content,S]);return S&&v?(0,M.jsx)(w.y,{renderOrigin:x,title:v,tooltipAlignment:f.v2.Center,tooltipPlacement:f.ug.Left}):null}function _(e){const{automationStore:t,environment:o,propertySchema:n,styles:i,theme:r,value:a}=e,s=void 0===(null==a?void 0:a.value),c=null!=a&&a.value?(0,x.IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,emojiType:(0,v.e_)(o),environment:o,formulaValueTypes:[],katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:null==a?void 0:a.value,spaceId:(0,g.C)(t.pointer.spaceId)},theme:r}):null,d=(0,M.jsx)("span",{style:i.propertyName,children:n.name}),u=(0,M.jsx)(S.Z,{format:l.lo.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,M.jsx)("span",{style:y.Z.textOverflowStyle,children:c})}),p=s?C.NZ({propertyName:d}):C.vE({propertyName:d,propertyValue:u});return(0,M.jsx)(h.FormattedMessage,{...p})}function A(e){const{automationStore:t,environment:o,propertySchema:n,theme:i,value:r}=e,a=void 0===(null==r?void 0:r.value),l=null!=r&&r.value?(0,x.IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,emojiType:(0,v.e_)(o),environment:o,formulaValueTypes:[],katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:null==r?void 0:r.value,spaceId:(0,g.C)(t.pointer.spaceId)},theme:i}):null,s=n.name,c=l,d=a?C.NZ({propertyName:s}):C.vE({propertyName:s,propertyValue:c});return(0,M.jsx)(h.FormattedMessage,{...d})}function T(e){return(0,M.jsx)(j,{...e,icon:p.c})}function P(e){return(0,M.jsx)(j,{...e,icon:u.p})}function V(e){return(0,M.jsx)(j,{...e,icon:s.n})}function I(e){return(0,M.jsx)(j,{...e,icon:m.O})}function F(e){return(0,M.jsx)(j,{...e,icon:c.J})}function Z(e){return(0,M.jsx)(j,{...e,icon:d.u})}},72080:(e,t,o)=>{o.d(t,{JS:()=>C,K1:()=>b,OZ:()=>S,gq:()=>v,l6:()=>x});var n=o(67294),i=o(86628),r=o(24405),a=o(54497),l=o(82990),s=o(9291),c=o(31945),d=o(65183),u=o(4023),p=o(61766),m=o(35294),g=o(93060),y=o(80253),h=o(86034),f=o(85893);function S(e){window.__c={n:"UpdateThisPageUnsupportedPropertyAction"};const{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:i,propertySchema:a}=e,l=(0,r.yK)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),s=C({propertySchema:a,styles:l}),c=b({propertySchema:a});return(0,f.jsx)(v,{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:i,styles:l,tooltip:c,children:s})}function v(e){window.__c={n:"UpdateThisPageBasePropertyAction"};const{actionMenu:t,buttonPopupStore:o,children:i,disabled:s,onClick:c,styles:d,tooltip:p}=e,m=(0,r.yK)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:l.Z.fontWeight.medium,whiteSpace:"normal"}})),[]),h=(0,n.useCallback)((e=>(0,f.jsx)(y.YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:s,icon:a.t,onClick:c,styles:d,children:(0,f.jsx)("div",{style:m.content,children:i})})),[t,o,i,s,c,d,m.content]);return(0,f.jsx)(g.y,{renderOrigin:h,title:p,tooltipAlignment:u.v.Center,tooltipPlacement:u.u.Left})}function x(e){window.__c={n:"UpdateThisPageUnsupportedPropertyMenuButtonPopup"};const{actionId:t,propertyId:o,renderOrigin:r}=e,a=(0,m.d)(),l=(0,i.qz)(void 0,p.Z),s=(0,n.useCallback)((()=>l.reset()),[l]);return(0,f.jsx)(c.ZP,{buttonPopupStore:l,popupType:a,render:()=>(0,f.jsx)(h.qO,{actionId:t,closeMenu:s,propertyId:o}),renderOrigin:r})}function C(e){const{propertySchema:t,styles:o}=e,n=t.type,i=d.SO[n];return(0,f.jsx)(s.FormattedMessage,{defaultMessage:"{propertyTypeDisplayName} property type is not supported",id:"updateThisPageUnsupportedPropertyAction.unsupportedProperty.title",values:{propertyTypeDisplayName:(0,f.jsx)("span",{style:o.propertyType,children:i})}})}function b(e){const{propertySchema:t}=e,o=t.type,n=d.SO[o];return(0,f.jsx)(s.FormattedMessage,{defaultMessage:"{propertyTypeDisplayName} property type is not supported",id:"updateThisPageUnsupportedPropertyAction.unsupportedProperty.title",values:{propertyTypeDisplayName:n}})}},92688:(e,t,o)=>{o.d(t,{_:()=>h,k:()=>y});var n=o(67294),i=o(86628),r=o(63362),a=o(5149),l=o(66890),s=o(58812),c=o(63474),d=o(47043),u=o(12455),p=o(53570),m=o(86034),g=o(85893);function y(e){window.__c={n:"DeletedPropertyActionMenu"};const{actionId:t,closeMenu:o,propertyId:p}=e,{automationContextStore:y,automationStore:h,maybePersistedTransactionActions:f}=(0,u.i)(),S=(0,l.DK)(),v=(0,c.D)(),x=(0,i.VK)((()=>null==S?void 0:S.settingsStore),[S]),C=(0,i.VK)((()=>h.getName()??""),[h]),b=(0,i.VK)((()=>{const e=h.getActionStores().find((e=>e.id===t));if(null!=e&&e.isDefined())return e}),[h,t]),w=(0,n.useCallback)((()=>{const e=null==y?void 0:y.context;e&&b&&(f.createAndCommit({perform:t=>{d.sl({actionStore:b,clientContext:e,transaction:t}),(0,r.co)(v,{automation_action_id:b.id,automation_action_type:b.getType(),automation_id:h.id})},userAction:"UnsupportedPropertyMenu.removeAction"}),null==o||o())}),[b,null==y?void 0:y.context,h.id,o,v,f]),k=(0,n.useMemo)((()=>{if(x&&p)return async function(){await(0,s.hL)({automationName:C,hasPendingChanges:!0})&&a.H4({collectionSettingsStore:x,item:{type:"deletedProperties",timelineViewTab:"timeline"}}),null==o||o()}}),[C,o,x,p]);return(0,g.jsx)(m.PO,{onDelete:w,onRestore:k,stepType:"action"})}function h(e){window.__c={n:"DeletedPropertyTriggerMenu"};const{closeMenu:t,propertyId:o}=e,{automationStore:r}=(0,u.i)(),c=(0,l.DK)(),{removePropertyTrigger:d}=(0,p.i)(),y=(0,i.VK)((()=>null==c?void 0:c.settingsStore),[c]),h=(0,i.VK)((()=>{const e=null==c?void 0:c.collectionStore();return Boolean(!(null!=e&&e.getDeletedSchema()[o]))}),[c,o]),f=(0,i.VK)((()=>r.getName()??""),[r]),S=(0,n.useCallback)((()=>{d(o),null==t||t()}),[t,o,d]),v=(0,n.useMemo)((()=>{if(y&&!h)return async function(){await(0,s.hL)({automationName:f,hasPendingChanges:!0})&&a.H4({collectionSettingsStore:y,item:{timelineViewTab:"timeline",type:"deletedProperties"}}),null==t||t()}}),[f,t,y,h]);return(0,g.jsx)(m.PO,{onDelete:S,onRestore:v,stepType:"trigger"})}},86034:(e,t,o)=>{o.d(t,{Iw:()=>A,PO:()=>T,qO:()=>_});var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(63362),s=o(50780),c=o(37612),d=o(55863),u=o(97880),p=o(9291),m=o(5149),g=o(52275),y=o(78140),h=o(32163),f=o(72495),S=o(66890),v=o(58812),x=o(68641),C=o(63474),b=o(47043),w=o(12455),k=o(95193),M=o(53570),j=o(85893);function _(e){window.__c={n:"UnsupportedPropertyActionMenu"};const{actionId:t,closeMenu:o,propertyId:i}=e,{automationContextStore:a,automationStore:s,maybePersistedTransactionActions:c}=(0,w.i)(),d=(0,S.DK)(),u=(0,C.D)(),p=(0,r.VK)((()=>null==d?void 0:d.settingsStore),[d]),g=(0,r.VK)((()=>d&&(0,x.jI)({collectionContextStore:d,timelineViewTab:"timeline"})),[d]),y=(0,r.VK)((()=>s.getName()??""),[s]),h=(0,r.VK)((()=>{const e=s.getActionStores().find((e=>e.id===t));if(null!=e&&e.isDefined())return e}),[s,t]),f=(0,n.useCallback)((()=>{const e=null==a?void 0:a.context;e&&h&&(c.createAndCommit({perform:t=>{b.sl({actionStore:h,clientContext:e,transaction:t}),(0,l.co)(u,{automation_action_id:h.id,automation_action_type:h.getType(),automation_id:s.id})},userAction:"UnsupportedPropertyMenu.removeAction"}),null==o||o())}),[h,null==a?void 0:a.context,s.id,o,u,c]),k=(0,n.useMemo)((()=>{if(p&&g&&i)return async function(){await(0,v.hL)({automationName:y,hasPendingChanges:!0})&&m.H4({collectionSettingsStore:p,item:{type:"property",formatKey:g,property:i}}),null==o||o()}}),[y,o,p,g,i]);return(0,j.jsx)(T,{onDelete:f,onEdit:k,stepType:"action"})}function A(e){window.__c={n:"UnsupportedPropertyTriggerMenu"};const{closeMenu:t,propertyId:o}=e,{automationStore:i}=(0,w.i)(),a=(0,S.DK)(),{removePropertyTrigger:l}=(0,M.i)(),s=(0,r.VK)((()=>null==a?void 0:a.settingsStore),[a]),c=(0,r.VK)((()=>a&&(0,x.jI)({collectionContextStore:a,timelineViewTab:"timeline"})),[a]),d=(0,r.VK)((()=>i.getName()??""),[i]),u=(0,n.useCallback)((()=>{l(o),null==t||t()}),[t,o,l]),p=(0,n.useMemo)((()=>{if(s&&c&&o)return async function(){await(0,v.hL)({automationName:d,hasPendingChanges:!0})&&m.H4({collectionSettingsStore:s,item:{type:"property",formatKey:c,property:o}}),null==t||t()}}),[d,t,s,c,o]);return(0,j.jsx)(T,{onDelete:u,onEdit:p,stepType:"trigger"})}function T(e){window.__c={n:"UnsupportedPropertyMenu"};const{onDelete:t,onEdit:o,onRestore:r,stepType:l}=e,m=(0,k.F)({width:266}),S=(0,i.Fy)().isMobile,v=(0,a.yK)((e=>({icon:{color:e.accentColors.gray[600],height:"auto",width:S?"12px":"16px"}})),[S]),x=(0,n.useMemo)((()=>(0,u.$K)(o)?{action:o,key:"edit-property-menu-item",render:e=>(0,j.jsx)(g.Z,{...e,icon:(0,s.E)(v.icon),title:(0,j.jsx)(p.FormattedMessage,{defaultMessage:"Edit property",id:"unsupportedPropertyMenu.editMenuItem.title"})})}:void 0),[o,v.icon]),C=(0,n.useMemo)((()=>(0,u.$K)(r)?{action:r,key:"restore-property-menu-item",render:e=>(0,j.jsx)(g.Z,{...e,icon:(0,d.s)(v.icon),title:(0,j.jsx)(p.FormattedMessage,{defaultMessage:"Restore property",id:"unsupportedPropertyMenu.restoreMenuItem.title"})})}:void 0),[r,v.icon]),b=(0,n.useMemo)((()=>(0,u.$K)(t)?{action:t,key:"delete-property-menu-item",render:e=>(0,j.jsx)(g.Z,{...e,icon:(0,c.y)(v.icon),title:"action"===l?(0,j.jsx)(p.FormattedMessage,{id:"automationUnsupportedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,j.jsx)(p.FormattedMessage,{id:"automationUnsupportedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})})}:void 0),[t,l,v.icon]);return(0,j.jsx)(y.Z,{...m,children:(0,j.jsx)(h.Z,{initialFocus:0,sections:[{key:"actions-section",items:[x,C,b].filter(u.$K),render:e=>(0,j.jsx)(f.Z,{...e})}],type:h.i.Vertical})})}},66315:(e,t,o)=>{o.d(t,{R:()=>m});o(21703);var n=o(67294),i=o(86628),r=o(26388),a=o(61766),l=o(12455),s=o(64973),c=o(55950),d=o(93060),u=o(80253),p=o(85893);function m(e){window.__c={n:"AutomationTriggerListItem"};const{onDelete:t,styles:o}=e,{disabled:m}=(0,l.i)(),g=Boolean(m),y=(0,i.qz)(void 0,a.Z),h=(0,n.useCallback)((()=>{if(!t)throw new Error("onDelete is not implemented for trigger");t(),y.setState({open:!1})}),[y,t]),f=(0,n.useMemo)((()=>t?(0,p.jsx)(s.rn,{onDelete:h}):null),[t,h]),S=(0,n.useCallback)((t=>{const n=e.onClick?u.YG:u._S;return(0,p.jsx)(n,{...t,actionMenu:f,buttonPopupStore:y,disabled:g,icon:e.icon,onClick:e.onClick,styles:o,children:e.children})}),[e.onClick,e.icon,e.children,f,y,g,o]);return(0,p.jsx)(c.HC,{children:(0,p.jsx)(d.y,{disable:g,renderOrigin:S,title:e.tooltip,tooltipAlignment:r.v2.Center,tooltipPlacement:r.ug.Left})})}},55307:(e,t,o)=>{o.d(t,{Z:()=>U});var n=o(67294),i=o(86628),r=o(97880),a=o(91738),l=o(43261),s=o.n(l),c=o(24405),d=o(3865),u=o(12396),p=o(5257),m=o(25651),g=o(47453),y=o(9291),h=o(47307),f=o(52275),S=o(68894),v=o(78140),x=o(32163),C=o(72495),b=o(54802),w=o(12455),k=o(95193),M=o(53570),j=o(85893);const _=(0,y.defineMessages)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search for trigger…"},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property"}});function A(e){window.__c={n:"AutomationEventTriggerMenu"};const{automationTriggerMenuStore:t,onClose:o}=e,{automationStore:a,collectionStore:l}=(0,w.P)(),A=(0,c.Fg)(),T=(0,y.useIntl)(),P=(0,M.i)(),V=(0,n.useMemo)((()=>({...P,closeMenu:o})),[P,o]),[I,F]=n.useState(""),Z=(0,i.VK)((()=>l.getSchema()),[l]),K=(0,i.VK)((()=>a.getTrigger()),[a]),B=(0,i.VK)((()=>("event"===(null==K?void 0:K.type)||"notification_event"===(null==K?void 0:K.type))&&K.event.pagesAdded),[K]),O=(0,i.VK)((()=>(0,d._X)({collectionFormat:l.getFormat(),collectionSchema:Z})),[l,Z]),R=(0,b.EF)({collectionSchema:Z,propertyIds:O,searchTerm:I}),D=(0,c.yK)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[]),W=(0,k.F)({maxHeight:"50vh",width:266}),E=(0,j.jsx)(S.ZP,{focus:!0,style:{marginTop:12,marginBottom:6},value:I,onChange:e=>{F(e.target.value)},placeholder:T.formatMessage(_.searchInputPlaceholder)}),N=B?void 0:function(e){const{intl:t,searchInput:o,styles:n,actions:i}=e,r=t.formatMessage(_.pageAddedCopy);if(!s().test(o,r))return;return{key:"page_added_section",items:[{key:"page_added",action(){i.addPageAddedTrigger(),i.closeMenu()},render:e=>(0,j.jsx)(f.Z,{...e,icon:(0,g.R)(n.propertyIcon),title:r})}],render:e=>(0,j.jsx)(C.Z,{...e})}}({intl:T,searchInput:I,actions:V,styles:D}),L=(0,i.VK)((()=>function(e){const{automationTriggerValue:t,automationTriggerMenuStore:o,showTopBorder:n,properties:i,collectionSchema:a,theme:l,intl:c,searchInput:g,styles:S,actions:v}=e,x=c.formatMessage(_.pagePropertiesEditedCopy);let b=!1,w=[];"event"!==(null==t?void 0:t.type)&&"notification_event"!==(null==t?void 0:t.type)||(b="any"===t.event.pagePropertiesEdited.type,w="some"===t.event.pagePropertiesEdited.type?t.event.pagePropertiesEdited.some:[]);const k=[b||!s().test(g,x)?void 0:{key:"any_property_edited",action:async()=>{const e=await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await h.confirmUserAction({message:(0,j.jsx)(y.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?"}),description:(0,j.jsx)(y.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers."}),acceptLabel:(0,j.jsx)(y.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace"})})}({hasSpecificPropertyChangedFilters:w.length>0});e&&(v.addAnyPropertyEditedTrigger(),v.closeMenu())},render:e=>(0,j.jsx)(f.Z,{...e,icon:(0,m.R)(S.propertyIcon),title:x})},...i.map((e=>{if(!w.find((t=>t.property===e)))return function(e){const{automationTriggerMenuStore:t,propertyId:o,collectionSchema:n,theme:i,actions:r}=e,a=n[o];if(!a)return;const l=(0,d.bD)(a);return{key:o,action:()=>{l?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(r.addPropertyTrigger({property:o,filter:{operator:"changes_to_any"}}),r.closeMenu())},render:e=>(0,j.jsx)(f.Z,{...e,icon:(0,j.jsx)(u.ZP,{icon:a.icon,type:a.type,size:16,theme:i}),title:a.name,right:l?(0,p.o)({marginLeft:6,width:12,height:"auto"}):void 0})}}({propertyId:e,collectionSchema:a,theme:l,automationTriggerMenuStore:o,actions:v})})).filter(r.$K)].filter(r.$K);if(0===k.length)return;return{key:"page_properties_edited_section",items:k,render:e=>(0,j.jsx)(C.Z,{...e,topBorder:n,title:(0,j.jsx)(y.FormattedMessage,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Property edited"})})}}({automationTriggerValue:K,automationTriggerMenuStore:t,showTopBorder:Boolean(N),properties:R,collectionSchema:Z,theme:A,searchInput:I,intl:T,styles:D,actions:V})),[K,t,N,R,Z,A,I,T,D,V]),H=n.useMemo((()=>{const e=[N,L].filter(r.$K);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>(0,j.jsx)(f.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,j.jsx)(y.FormattedMessage,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results"})})}],render:e=>(0,j.jsx)(C.Z,{...e})}]:e}),[N,L]);return(0,j.jsx)(v.Z,{...W,header:E,children:(0,j.jsx)(x.Z,{type:x.i.Vertical,sections:H,initialFocus:0})})}var T=o(76205),P=o(14648);function V(e){window.__c={n:"AutomationCheckboxPropertyChangedFilterMenu"};const{propertyId:t,automationTriggerMenuStore:o,propertySchema:r,propertyChangedFilter:a,onClose:l}=e,{updatePropertyTrigger:s}=(0,M.i)(),c=(0,i.VK)((()=>"changes_to_any"===a.operator?[{type:"exact",value:!0},{type:"exact",value:!1}]:(0,T.XA)(a)&&(0,T.vR)(a)?Array.isArray(a.value)?a.value:[a.value]:[]),[a]),[d,u]=(0,n.useState)(c),p=(0,n.useMemo)((()=>1===d.length?{operator:"checkbox_is",value:d[0]}:{operator:"changes_to_any"}),[d]),m=(0,n.useMemo)((()=>2===d.length||1===d.length&&"partial"),[d]),g=(0,n.useCallback)((e=>{const t=Boolean(d.find((t=>t.value===e)));u(t?d.filter((t=>t.value!==e)):[...d,{type:"exact",value:e}])}),[d]),h=(0,n.useCallback)((()=>{s({anyOptionCheckState:m,propertyId:t,currentFilter:p}),l()}),[m,p,l,t,s]),S=Boolean(d.find((e=>!0===e.value))),v=Boolean(d.find((e=>!1===e.value)));return(0,j.jsx)(P.Z,{type:"default",automationTriggerActionMenuStore:o,onDone:h,onClose:l,sections:[{key:"select",render:e=>(0,j.jsx)(C.Z,{...e,topBorder:!0}),items:[{key:"unchecked",render:e=>(0,j.jsx)(f.Z,{...e,checkState:v,isTokenTitle:!0,title:(0,j.jsx)(y.FormattedMessage,{defaultMessage:"Unchecked",id:"automations.propertyTrigger.checkbox.unchecked"})}),action:()=>g(!1)},{key:"checked",render:e=>(0,j.jsx)(f.Z,{...e,checkState:S,isTokenTitle:!0,title:(0,j.jsx)(y.FormattedMessage,{defaultMessage:"Checked",id:"automations.propertyTrigger.checkbox.checked"})}),action:()=>g(!0)}]}],headerTitle:(0,j.jsx)(y.FormattedMessage,{id:"automations.propertyTrigger.checkbox.title",defaultMessage:"{propertyName} set to",values:{propertyName:r.name}})})}var I=o(480),F=o(80951),Z=o(84619),K=o(72126),B=o(56416),O=o(60458),R=o(22084),D=o(47082);function W(e){window.__c={n:"AutomationSelectPropertyChangedFilterMenu"};const{propertyId:t,automationTriggerMenuStore:o,propertySchema:a,propertyChangedFilter:l,onClose:s}=e,{isMobile:c,isAndroid:d}=(0,I.Fy)(),u=(0,y.useIntl)(),{updatePropertyTrigger:p}=(0,M.i)(),m=(0,i.VK)((()=>{if("changes_to_any"===l.operator){return(a.options??[]).map((e=>({type:"exact",value:e.value})))}if(!(0,T.dx)(l)&&!(0,T.NU)(l))return[];if((0,T.vR)(l)){const e=(a.options??[]).map((e=>e.value));return(Array.isArray(l.value)?l.value:[l.value]).filter((t=>(0,r.$K)(t.value)&&e.includes(t.value)))}return[]}),[a,l]),[g,h]=n.useState(m),S=(0,i.VK)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let n=!1,i=!0;const r=t.options??[];for(const a of r){const e=o.some((e=>e.value===a.value));n||=e,i&&=e}return!!i||!!n&&"partial"}({propertySchema:a,selectedOptions:g})),[a,g]),v=n.useMemo((()=>(a.options??[]).map((e=>({type:"exact",value:e.value})))),[a]),x=n.useMemo((()=>"multi_select"===a.type?{operator:"enum_contains",value:g}:"select"===a.type?{operator:"enum_is",value:g}:(0,r.t1)(a)),[a,g]),b=!0===S?[]:g.map((e=>{if(!e.value||!a.options)return;const t=(0,F.i7)(a.options,e.value);return t?(0,j.jsx)(R.a,{format:c?Z.lo.Large:Z.lo.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=K.zu(g,e);h(t)}},t.id):void 0})),[w,k]=n.useState(""),_=(0,B.I4)({query:w,propertySchema:a,selectedValues:g,updateValue:e=>{k(""),h(e)},isMobile:c,styles:{}}),A=[{key:"search",items:[{key:"input",action:()=>{},render:e=>(0,j.jsx)(D.Z,{...e,focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:D.U.FilterValue,tokens:b,placeholder:S?u.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption"}):u.formatMessage({defaultMessage:"Select one or more options…",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder"}),onRemoveLastToken:()=>{const e=g.slice(0,g.length-1);h(e)},onClearButtonClick:()=>{h([]),s()},value:w,onChange:e=>{k(e.target.value)},dontShowBorderBottom:d,showClearButton:!0})}],render:e=>(0,j.jsx)(C.Z,{...e})},{key:"any",items:[{key:"any-option-item",action:()=>{!0===S?h([]):!1===S||"partial"===S?h(v):(0,r.t1)(S),k("")},render:e=>(0,j.jsx)(f.Z,{...e,icon:(0,j.jsx)(O.Z,{checked:S,size:14,onClick:e.onClick}),title:(0,j.jsx)(y.FormattedMessage,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,j.jsx)(C.Z,{...e,topBorder:!0})},_.length>0?{key:"items",items:_,render:e=>(0,j.jsx)(C.Z,{...e,topBorder:!0})}:void 0].filter(r.$K);return(0,j.jsx)(P.Z,{type:"default",automationTriggerActionMenuStore:o,onDone:()=>{p({anyOptionCheckState:S,propertyId:t,currentFilter:x}),s()},onClose:s,sections:A,headerTitle:(0,j.jsx)(y.FormattedMessage,{id:"automations.propertyChangedFilterHeader.select.title",defaultMessage:"{propertyName} set to",values:{propertyName:a.name}})})}var E=o(11299),N=o(97004);function L(e){window.__c={n:"AutomationStatusPropertyChangedFilterMenu"};const{propertyId:t,automationTriggerMenuStore:o,propertySchema:a,propertyChangedFilter:l,onClose:s}=e,{isMobile:c}=(0,I.Fy)(),{updatePropertyTrigger:d}=(0,M.i)(),u=(0,i.VK)((()=>{if("changes_to_any"===l.operator){return(a.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,T.r2)(l)&&(0,T.vR)(l)?(0,T.wB)(l):[]}),[a,l]),[p,m]=n.useState(u),g=(0,i.VK)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e,n=t.groups??[],i=t.options??[],r=n.map((e=>(0,N.IX)({group:e,options:i,filterValues:o}))),a=r.every((e=>!0===e.groupCheckState)),l=r.some((e=>!1!==e.groupCheckState));return!!a||!!l&&"partial"}({propertySchema:a,selectedStatusOptions:p})),[a,p]),h=n.useMemo((()=>(a.groups??[]).map((e=>({type:"is_group",value:e.name})))),[a]),S=(0,E.S)({propertySchema:a,statusFilterValues:p,updateValue:e=>{m(e)},isMobile:c,styles:{},visibleOptions:a.options??[]});return(0,j.jsx)(P.Z,{type:"default",automationTriggerActionMenuStore:o,onDone:()=>{d({anyOptionCheckState:g,propertyId:t,currentFilter:{operator:"status_is",value:p}}),s()},onClose:()=>{s()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===g?m([]):!1===g||"partial"===g?m(h):(0,r.t1)(g)},render:e=>(0,j.jsx)(f.Z,{...e,icon:(0,j.jsx)(O.Z,{checked:g,size:14,onClick:e.onClick}),title:(0,j.jsx)(y.FormattedMessage,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,j.jsx)(C.Z,{...e})},{key:"items",items:S,render:e=>(0,j.jsx)(C.Z,{...e,topBorder:!0})}],headerTitle:(0,j.jsx)(y.FormattedMessage,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",values:{propertyName:a.name}})})}function H(e){window.__c={n:"AutomationEventTriggerPropertyChangedFilterMenu"};const{propertyId:t,automationTriggerMenuStore:o,onClose:n}=e,{automationStore:r,collectionStore:a}=(0,w.P)(),l=(0,i.VK)((()=>a.getSchema()),[a])[t],s=(0,i.VK)((()=>r.getTrigger()),[r]);let c=[];"event"!==(null==s?void 0:s.type)&&"notification_event"!==(null==s?void 0:s.type)||(c="some"===s.event.pagePropertiesEdited.type?s.event.pagePropertiesEdited.some:[]);const u=c.find((e=>e.property===t))??{property:t,filter:{operator:"changes_to_any"}};if(!l)return null;return(0,d.bD)(l)?"multi_select"===l.type||"select"===l.type?(0,j.jsx)(W,{propertyId:t,automationTriggerMenuStore:o,propertySchema:l,propertyChangedFilter:u.filter,onClose:n}):"status"===l.type?(0,j.jsx)(L,{propertyId:t,automationTriggerMenuStore:o,propertySchema:l,propertyChangedFilter:u.filter,onClose:n}):"checkbox"===l.type?(0,j.jsx)(V,{automationTriggerMenuStore:o,onClose:n,propertyChangedFilter:u.filter,propertyId:t,propertySchema:l}):null:null}function U(e){window.__c={n:"AutomationTriggerMenuController"};const{initialState:t,buttonPopupParent:o}=e,l=(0,i.VK)((()=>{const e=new a.Bh;return e.setState({insertionPoint:void 0,stack:[t]}),e}),[t]),s=(0,i.VK)((()=>l.getCurrentTab()),[l]),c=(0,n.useCallback)((()=>o.close()),[o]);return s?"eventTriggers"===s.type?(0,j.jsx)(A,{automationTriggerMenuStore:l,onClose:c}):"propertyChangedFilter"===s.type?(0,j.jsx)(H,{propertyId:s.property,automationTriggerMenuStore:l,onClose:c}):(0,r.t1)(s):null}},61036:(e,t,o)=>{o.d(t,{Dl:()=>E,ew:()=>W,Zr:()=>N});var n=o(67294),i=o(86628),r=o(12455),a=o(24405),l=o(47453),s=o(82990),c=o(9291),d=o(56812),u=o(53570),p=o(66315),m=o(85893);function g(){window.__c={n:"AnyPropertyEditedTrigger"};const{removeAnyPropertyEditedTrigger:e}=(0,u.i)(),t=(0,c.useIntl)(),o=(0,a.yK)((()=>({title:{fontWeight:s.Z.fontWeight.medium}})),[]),n=d.c5(t);return(0,m.jsx)(p.R,{icon:l.R,onDelete:e,tooltip:n,children:(0,m.jsx)("div",{style:o.title,children:n})})}var y=o(3865),h=o(76205),f=o(31945),S=o(35294),v=o(55307);function x(e){window.__c={n:"EditAutomationTriggerPopup"};const{renderOrigin:t,property:o}=e,n=(0,S.d)();return(0,m.jsx)(f.ZP,{popupType:n,renderOrigin:t,render:e=>(0,m.jsx)(v.Z,{initialState:{type:"propertyChangedFilter",property:o},buttonPopupParent:e})})}var C=o(20239),b=o(51230),w=o(61410);function k(e){let{propertySchema:t,onClick:o}=e;return(0,m.jsx)(w.n,{onClick:o,icon:e=>(0,m.jsx)(b.Y,{propertySchema:t,style:e}),tooltip:(0,m.jsx)(j,{propertyName:t.name}),children:(0,m.jsx)(M,{propertyName:t.name})})}function M(e){let{propertyName:t}=e;window.__c={n:"PropertyEditedTriggerTitle"};const o=(0,c.useIntl)(),n=(0,a.yK)((()=>({propertyName:{...s.Z.textOverflowStyle,fontWeight:s.Z.fontWeight.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),i=d.$G(o,{propertyName:(0,m.jsx)("span",{style:n.propertyName,children:t})});return(0,m.jsx)("span",{style:n.wrap,children:i})}function j(e){let{propertyName:t}=e;window.__c={n:"PropertyEditedTriggerTooltip"};const o=(0,c.useIntl)();return(0,m.jsx)(m.Fragment,{children:d.$G(o,{propertyName:t})})}var _=o(54497),A=o(97880),T=o(61766),P=o(23723),V=o(92688);function I(e){window.__c={n:"PropertyWasDeletedTrigger"};const{deletedPropertySchema:t}=e,{property:o}=(0,n.useContext)(W),{removePropertyTrigger:r}=(0,u.i)(),l=(0,a.yK)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:s.Z.fontWeight.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),c=(0,S.d)(),d=(0,i.qz)(void 0,T.Z),g=(0,n.useCallback)((()=>d.reset()),[d]),y=(0,n.useCallback)((()=>{r(o)}),[o,r]),h=(0,A.$K)(t)?(0,P.Ox)({propertySchema:t,styles:l}):(0,P.fX)(),v=(0,A.$K)(t)?(0,P.Si)({propertySchema:t}):(0,P.fX)();return(0,m.jsx)(f.ZP,{buttonPopupStore:d,popupType:c,render:()=>(0,m.jsx)(V._,{closeMenu:g,propertyId:o}),renderOrigin:e=>(0,m.jsx)(p.R,{...e,icon:_.t,onDelete:y,styles:l,tooltip:v,children:(0,m.jsx)("div",{style:l.content,children:h})})})}var F=o(76954),Z=o(87181),K=o(72080),B=o(86034);function O(e){let{propertySchema:t}=e;window.__c={n:"UnsupportedPropertyTrigger"};const{property:o}=(0,n.useContext)(W),{removePropertyTrigger:r}=(0,u.i)(),l=(0,a.yK)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:s.Z.fontWeight.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),c=(0,S.d)(),d=(0,i.qz)(void 0,T.Z),g=(0,n.useCallback)((()=>d.reset()),[d]),y=(0,n.useCallback)((()=>{r(o)}),[o,r]),h=(0,K.JS)({propertySchema:t,styles:l}),v=(0,K.K1)({propertySchema:t});return(0,m.jsx)(f.ZP,{buttonPopupStore:d,popupType:c,render:()=>(0,m.jsx)(B.Iw,{closeMenu:g,propertyId:o}),renderOrigin:e=>(0,m.jsx)(p.R,{...e,icon:_.t,onDelete:y,styles:l,tooltip:v,children:(0,m.jsx)("div",{style:l.content,children:h})})})}function R(e){window.__c={n:"PropertyEditedTriggerRouter"};const{collectionStore:t}=(0,r.P)(),{property:o,filter:n}=e,[a,l]=(0,i.VK)((()=>{var e,n;return[null===(e=t.getSchema())||void 0===e?void 0:e[o],null===(n=t.getDeletedSchema())||void 0===n?void 0:n[o]]}),[t,o]);return a?(0,y.$M)(a)?(0,y.bD)(a)?(0,m.jsx)(D,{property:o,propertySchema:a,filter:n}):(0,m.jsx)(k,{propertySchema:a}):(0,m.jsx)(O,{propertySchema:a}):(0,m.jsx)(I,{deletedPropertySchema:l})}function D(e){window.__c={n:"EditablePropertyTrigger"};const{filter:t,propertySchema:o,property:i}=e,r=(0,n.useMemo)((()=>function(e){let{filter:t,propertySchema:o}=e;return e=>"changes_to_any"!==t.operator&&(0,h.vR)(t)?"checkbox"===o.type&&(0,h.XA)(t)?(0,m.jsx)(C.Ij,{...e,filter:t,propertySchema:o}):"status"===o.type&&(0,h.r2)(t)?(0,m.jsx)(Z.V,{...e,filter:t,propertySchema:o}):"select"===o.type&&(0,h.dx)(t)||"multi_select"===o.type&&(0,h.NU)(t)?(0,m.jsx)(F.v,{...e,filter:t,propertySchema:o}):(0,m.jsx)(k,{...e,propertySchema:o}):(0,m.jsx)(k,{...e,propertySchema:o})}({filter:t,propertySchema:o})),[t,o]);return(0,m.jsx)(x,{renderOrigin:r,property:i})}const W=(0,n.createContext)({pagePropertiesEdited:[],property:""});function E(){window.__c={n:"AllPropertyEditedTriggers"};const{automationContextStore:e,collectionStore:t}=(0,r.i)(),o=(0,i.VK)((()=>null==e?void 0:e.context.automationStore),[e]),n=N(o),a=(0,i.VK)((()=>{var e;if(!o||!o.isTriggerType("event")&&!o.isTriggerType("notification_event"))return;const t=null===(e=o.getEventConfiguration())||void 0===e?void 0:e.pagePropertiesEdited;return"none"===(null==t?void 0:t.type)?void 0:t}),[o]),l=(0,i.VK)((()=>null==t?void 0:t.getSchema()),[t]);return n&&a?"any"===a.type?(0,m.jsx)(g,{}):l?(0,m.jsx)(m.Fragment,{children:a.some.map((e=>{let{property:t,filter:o}=e;return(0,m.jsx)(W.Provider,{value:{property:t,pagePropertiesEdited:a.some},children:(0,m.jsx)(R,{property:t,filter:o})},t)}))}):null:null}function N(e){return(0,i.VK)((()=>{if(!(null!=e&&e.isTriggerType("event")||null!=e&&e.isTriggerType("notification_event")))return!1;const t=e.getEventConfiguration();return Boolean("none"!==(null==t?void 0:t.pagePropertiesEdited.type))}),[e])}},20239:(e,t,o)=>{o.d(t,{Ij:()=>p,l4:()=>y,zR:()=>g});o(67294);var n=o(24405),i=o(65628),r=o(96711),a=o(82990),l=o(9291),s=o(20776),c=o(56812),d=o(61410),u=o(85893);function p(e){window.__c={n:"CheckboxPropertyTrigger"};const t=(0,l.useIntl)(),{propertySchema:o,filter:n,onClick:i}=e;return(0,u.jsx)(d.n,{onClick:i,tooltip:y({filter:n,intl:t,propertySchema:o}),children:(0,u.jsx)(m,{propertySchema:o,filter:n})})}function m(e){let{propertySchema:t,filter:o}=e;window.__c={n:"CheckboxPropertyTriggerTitle"};const i=(0,l.useIntl)(),r=(0,n.yK)((()=>({propertyName:{...a.Z.textOverflowStyle,fontWeight:a.Z.fontWeight.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),s=g({filter:o,intl:i,propertySchema:t,styles:r});return(0,u.jsx)("span",{style:r.wrap,children:s})}function g(e){const{filter:t,intl:o,propertySchema:n,styles:i}=e,r=n.name,a=t.value,l={propertyName:(0,u.jsx)("span",{style:i.propertyName,children:r}),propertyValues:(0,u.jsx)(h,{checkboxValue:a.value??!1})};return(0,c.vz)(o,l)}function y(e){const{filter:t,intl:o,propertySchema:n}=e,i={propertyName:n.name,propertyValues:!0===t.value.value?(0,u.jsx)(l.FormattedMessage,{...c.Bo.actionCheckboxPropertyChecked}):(0,u.jsx)(l.FormattedMessage,{...c.Bo.actionCheckboxPropertyUnchecked})};return(0,c.vz)(o,i)}function h(e){const{checkboxValue:t}=e,o=!0===t?(0,r.V)({width:12}):(0,i.z)({width:10}),n=!0===t?(0,u.jsx)(l.FormattedMessage,{...c.Bo.actionCheckboxPropertyChecked}):(0,u.jsx)(l.FormattedMessage,{...c.Bo.actionCheckboxPropertyUnchecked});return(0,u.jsx)(s.o,{icon:o,children:n})}},61410:(e,t,o)=>{o.d(t,{n:()=>u});var n=o(67294),i=o(86628),r=o(12455),a=o(53570),l=o(66315),s=o(51230),c=o(61036),d=o(85893);function u(e){window.__c={n:"PropertyEditedTrigger"};const{property:t}=(0,n.useContext)(c.ew),{collectionStore:o}=(0,r.P)(),{removePropertyTrigger:u}=(0,a.i)(),p=(0,n.useCallback)((()=>{u(t)}),[t,u]),m=(0,i.VK)((()=>o.getSchema()),[o])[t],g=m?e=>(0,d.jsx)(s.Y,{propertySchema:m,style:e}):void 0;return(0,d.jsx)(l.R,{icon:g,onDelete:p,...e,children:e.children})}},76954:(e,t,o)=>{o.d(t,{v:()=>f,z:()=>v});o(67294);var n=o(24405),i=o(80951),r=o(84619),a=o(97880),l=o(82990),s=o(9291),c=o(22084),d=o(85567),u=o(65380),p=o(56812),m=o(37867),g=o(61410),y=o(85893);const h=5;function f(e){window.__c={n:"SelectPropertyTrigger"};const t=(0,s.useIntl)(),{filter:o,propertySchema:n,onClick:i}=e,r={...l.Z.textOverflowStyle,fontWeight:l.Z.fontWeight.medium},c=o.value,d=n.name,m=(Array.isArray(c)?c:[c]).map((e=>e.value)).filter(a.$K),f=v({intl:t,isText:!0,limit:h,optionValues:m,propertySchema:n}),x=t.formatList(f,{style:"long",type:"disjunction"}),C=(0,p.XJ)(t,{propertyName:(0,y.jsx)("span",{style:r,children:d}),propertyValues:(0,u.H)(x)});return(0,y.jsx)(g.n,{tooltip:C,onClick:i,children:(0,y.jsx)(S,{filter:o,propertySchema:n})})}function S(e){window.__c={n:"SelectPropertyTriggerTitle"};const{filter:t,propertySchema:o}=e,i=(0,s.useIntl)(),r=t.value,c=o.name,d=(Array.isArray(r)?r:[r]).map((e=>e.value)).filter(a.$K),m=v({intl:i,limit:h,optionValues:d,propertySchema:o}),g=i.formatList(m,{style:"long",type:"disjunction"}),f=(0,n.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...l.Z.textOverflowStyle,fontWeight:l.Z.fontWeight.semibold}})),[]),S=(0,p.XJ)(i,{propertyName:(0,y.jsx)("span",{style:f.propertyName,children:c}),propertyValues:(0,u.H)(g)});return(0,y.jsx)("div",{style:f.content,children:S})}function v(e){let{intl:t,isText:o,limit:n,optionValues:a,propertySchema:l,tokenFormat:s=r.lo.Medium}=e;const u=l.options??[],g=a.map((e=>{const n=(0,i.i7)(u,e);return n?o?n.value:(0,y.jsx)(c.a,{value:n.value,color:n.color,format:s,isSingle:!0,showRemoveButton:!1},n.id):o?(0,p.ST)(t):(0,y.jsx)(m.Z,{tokenFormat:s},`missing_option_value_${e}`)}));let h;if(void 0!==n&&g.length>n){const e=g.length-n,t=o?`+${e}`:(0,y.jsx)(d.Z,{format:r.lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");h=[...g.slice(0,n),t]}else h=g;return h}},87181:(e,t,o)=>{o.d(t,{L:()=>C,V:()=>S});o(67294);var n=o(24405),i=o(76205),r=o(80951),a=o(84619),l=o(97880),s=o(82990),c=o(9291),d=o(22084),u=o(85567),p=o(65380),m=o(56812),g=o(37867),y=o(61410),h=o(85893);const f=5;function S(e){window.__c={n:"StatusPropertyTrigger"};const t=(0,c.useIntl)(),{filter:o,limit:n=f,propertySchema:r,onClick:a}=e,s=r.name,d=(0,i.wB)(o),u=d.map((e=>"is_group"===e.type?e.value:void 0)).filter(l.$K),p=d.map((e=>"is_option"===e.type?e.value:void 0)).filter(l.$K),m=C({intl:t,groupValues:u,limit:n,optionValues:p,propertySchema:r}),g=C({intl:t,isText:!0,groupValues:u,limit:n,optionValues:p,propertySchema:r});return(0,h.jsx)(y.n,{onClick:a,tooltip:(0,h.jsx)(x,{propertyName:s,statusValues:g}),children:(0,h.jsx)(v,{propertyName:s,statusValues:m})})}function v(e){let{propertyName:t,statusValues:o}=e;window.__c={n:"StatusPropertyTriggerTitle"};const i=(0,c.useIntl)(),r=(0,n.yK)((()=>({propertyName:{...s.Z.textOverflowStyle,fontWeight:s.Z.fontWeight.semibold}})),[]),a=i.formatList(o,{style:"long",type:"disjunction"});return(0,h.jsx)(h.Fragment,{children:(0,m.VO)(i,{propertyName:(0,h.jsx)("span",{style:r.propertyName,children:t}),propertyValues:(0,p.H)(a)})})}function x(e){let{propertyName:t,statusValues:o}=e;window.__c={n:"StatusPropertyTriggerTooltip"};const i=(0,c.useIntl)(),r=(0,n.yK)((()=>({propertyName:{...s.Z.textOverflowStyle,fontWeight:s.Z.fontWeight.semibold}})),[]),a=i.formatList(o,{style:"long",type:"disjunction"});return(0,h.jsx)(h.Fragment,{children:(0,m.VO)(i,{propertyName:(0,h.jsx)("span",{style:r.propertyName,children:t}),propertyValues:(0,p.H)(a)})})}function C(e){let{groupValues:t,intl:o,isText:n,limit:i,optionValues:s,propertySchema:c,tokenFormat:p=a.lo.Medium}=e;const y=c.groups||[],f=c.options||[],S=t.map((e=>{const t=y.find((t=>t.name===e));if(t)return n?t.name:(0,h.jsx)("span",{children:t.name},t.id)})).filter(l.$K),v=s.map((e=>{const t=(0,r.i7)(f,e);if(void 0===t)return n?(0,m.ST)(o):(0,h.jsx)(g.Z,{tokenFormat:p},`missing_option_value_${e}`);if(n)return t.value;const i=y.find((e=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return(0,h.jsx)(d.F,{format:p,isSingle:!0,value:t.value,color:t.color,groupColor:null==i?void 0:i.color,showRemoveButton:!1,showEllipsis:!0},t.id)})),x=[...S,...v];let C=[];if(void 0!==i&&x.length>i){const e=v.length-i,t=n?`+${e}`:(0,h.jsx)(u.Z,{format:a.lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");C=[...v.slice(0,i),t]}else C=x;return C}},51230:(e,t,o)=>{o.d(t,{Y:()=>a});o(67294);var n=o(24405),i=o(12396),r=o(85893);function a(e){let{style:t,propertySchema:o}=e;window.__c={n:"TriggerPropertyIcon"};const a=(0,n.Fg)();return(0,r.jsx)(i.ZP,{size:16,theme:a,icon:o.icon,style:t,type:o.type})}},9015:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(67294),i=o(96245);const r=(0,n.createContext)({automationContextStore:void 0,automationStore:void 0,collectionStore:void 0,currentDraggingActionId:void 0,disabled:!0,maybePersistedTransactionActions:{createAndCommit:i.U},editorPlacement:{type:"inline"},editorWidth:300,suppressActionErrors:[]})},64737:(e,t,o)=>{o.d(t,{q:()=>r,w:()=>i});var n=o(97880);function i(e){return!e.pathIsDead()&&e.isDefined()}function r(e){if(!(0,n.$K)(e))return[];return e.getTemplatePageStores().filter((e=>i(e)))}},65380:(e,t,o)=>{o.d(t,{H:()=>i});o(57658),o(67294);var n=o(85893);function i(e){if(!Array.isArray(e))return[e];const t=[];for(const o of e)if("string"==typeof o&&" "!==o[0]){const e=t.pop();t.push((0,n.jsxs)("div",{children:[e,o]}))}else t.push(o);return t}},56812:(e,t,o)=>{o.d(t,{$G:()=>k,Bo:()=>i,Ig:()=>f,Iu:()=>u,Mw:()=>g,Mz:()=>C,NZ:()=>S,Oq:()=>d,S0:()=>p,ST:()=>A,Sj:()=>h,VO:()=>_,XJ:()=>j,aD:()=>x,c5:()=>b,hW:()=>r,ht:()=>s,nf:()=>w,oJ:()=>T,om:()=>m,rf:()=>y,vE:()=>v,vz:()=>M,wE:()=>c,xf:()=>a,zU:()=>l});var n=o(80951);const i=(0,o(9291).defineMessages)({actionCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.action.checkboxProperty.checked"},actionCheckboxPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.checkboxProperty.single"},actionCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.action.checkboxProperty.unchecked"},actionDatePropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.dateProperty.clear"},actionDatePropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.dateProperty.single"},actionPersonPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.personProperty.clear"},actionPersonPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.personProperty.single"},actionPersonPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.personProperty.multiple"},actionRelationPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.relationProperty.clear"},actionRelationPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.relationProperty.multiple"},actionRelationPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.relationProperty.single"},actionSelectPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.selectProperty.clear"},actionSelectPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.selectProperty.multiple"},actionSelectPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.selectProperty.single"},actionStatusPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.statusProperty.single"},actionTextPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.textProperty.clear"},actionTextPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.textProperty.single"},actionDeletedProperty:{defaultMessage:"Edit a deleted property",id:"automations.action.deletedProperty"},triggerAnyPageAdded:{defaultMessage:"Page added",id:"automations.trigger.pageAdded.title"},triggerAnyPagePropertyEdit:{defaultMessage:"Any property edited",id:"automations.trigger.anyPagePropertyEdited.title"},triggerAnyPropertyEdit:{defaultMessage:"{propertyName} is edited",id:"automations.trigger.propertyChangesToAny.title"},triggerButtonClicked:{defaultMessage:"<b>Button</b> is clicked",id:"automations.trigger.button.clicked"},triggerCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.trigger.checkboxProperty.checked"},triggerCheckboxPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.checkboxPropertySet.title"},triggerCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.trigger.checkboxProperty.unchecked"},triggerSelectPropertySet:{id:"automations.trigger.selectPropertySet.title",defaultMessage:"{propertyName} set to {propertyValues}"},triggerStatusPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.statusPropertySet.singleProperty"},triggerDeletedPropertyEdit:{defaultMessage:"Deleted property is edited",id:"automations.trigger.deletedPropertyEdited"},deletedPropertyOption:{defaultMessage:"Deleted option",id:"automations.values.deletedPropertyOption"},unknownValue:{defaultMessage:"Unknown value",id:"automations.values.unknownValue"}});function r(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionCheckboxPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function a(e){const{propertyName:t}=e;return{...i.actionDatePropertyClear,values:{propertyName:t}}}function l(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionDatePropertySetSingle,values:{propertyName:t,propertyValue:o}}}function s(e){const{propertyName:t}=e;return{...i.actionPersonPropertyClear,values:{propertyName:t}}}function c(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionPersonPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function d(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionPersonPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function u(e){const{propertyName:t}=e;return{...i.actionRelationPropertyClear,values:{propertyName:t}}}function p(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionRelationPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function m(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionRelationPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function g(e){const{propertyName:t}=e;return{...i.actionSelectPropertyClear,values:{propertyName:t}}}function y(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionSelectPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function h(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionSelectPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function f(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionStatusPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function S(e){const{propertyName:t}=e;return{...i.actionTextPropertyClear,values:{propertyName:t}}}function v(e){const{propertyName:t,propertyValue:o}=e;return{...i.actionTextPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function x(e){return e.formatMessage(i.actionDeletedProperty)}function C(e){return e.formatMessage(i.triggerAnyPageAdded)}function b(e){return e.formatMessage(i.triggerAnyPagePropertyEdit)}function w(e){return e.formatMessage(i.triggerDeletedPropertyEdit)}function k(e,t){const{propertyName:o}=t;return e.formatMessage(i.triggerAnyPropertyEdit,{propertyName:o})}function M(e,t){return e.formatMessage(i.triggerCheckboxPropertySet,t)}function j(e,t){return e.formatMessage(i.triggerSelectPropertySet,t)}function _(e,t){return e.formatMessage(i.triggerStatusPropertySet,t)}function A(e){return e.formatMessage(i.deletedPropertyOption)}function T(e){const{limit:t,optionValues:o,propertySchema:i}=e,r=i.options??[],a=r.length>0,l=o.map((e=>{const t=a?(0,n.i7)(r,e):void 0;return t?{type:"option",value:t}:{type:"deleted",value:e}}));let s=l;if(void 0!==t&&l.length>t){const e=l.length-t;s=[...l.slice(0,t),{type:"truncation",value:`+${e}`}]}return s}},91494:(e,t,o)=>{o.d(t,{X:()=>a});var n=o(86628),i=o(33929),r=o(68910);function a(e){const{automationStore:t,collectionStore:o}=e;return(0,n.VK)((()=>{if(!o||!t)return;const e=o.getSpaceShardedPointer();return new r.L({automationStore:t,parentPointer:e,type:"event",persisted:!0,intl:i.default.getIntl(),parentRecordStore:o})}),[o,t])}},12455:(e,t,o)=>{o.d(t,{P:()=>l,i:()=>a});o(21703);var n=o(67294),i=o(86628),r=o(9015);function a(){const e=(0,n.useContext)(r.Z),t=(0,i.VK)((()=>{var t;return null===(t=e.automationContextStore)||void 0===t?void 0:t.context.automationStore}),[e.automationContextStore]);if(!t)throw new Error("automationStore is undefined. Is this rendered inside an AutomationEditorContext.Provider?");return{...e,automationStore:t}}function l(){const{collectionStore:e,automationStore:t,...o}=a(),n=(0,i.VK)((()=>{if(!(null!=t&&t.isTriggerType("event")||null!=t&&t.isTriggerType("notification_event")))throw new Error("automationStore is wrong type. Is this called in the wrong type of automation?");return t}),[t]);if(!e)throw new Error("collectionStore is undefined. Is this rendered inside an AutomationEditorContext.Provider?");return{...o,collectionStore:e,automationStore:n}}},73266:(e,t,o)=>{o.d(t,{Z:()=>a,a:()=>r});var n=o(67294),i=o(9015);function r(e){return(0,n.useMemo)((()=>Boolean(e&&e.width<400)),[e])}function a(){const e=(0,n.useContext)(i.Z),{editorWidth:t}=e;return t<500}},95193:(e,t,o)=>{o.d(t,{F:()=>l,U:()=>a});var n=o(480),i=o(86628),r=o(87279);function a(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:r.og.ActionSheet}:{menuType:r.og.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function l(e){const t=(0,n.Fy)();return(0,i.VK)((()=>a({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},35294:(e,t,o)=>{o.d(t,{d:()=>a});var n=o(480),i=o(86628),r=o(53437);function a(e){const t=(0,n.Fy)();return(0,i.VK)((()=>t.isPhone||"slideUp"===(null==e?void 0:e.tabletBehavior)&&t.isTablet?r.kQ.SlideUp:r.kQ.Popup),[t,null==e?void 0:e.tabletBehavior])}},53570:(e,t,o)=>{o.d(t,{i:()=>s});o(57658);var n=o(67294),i=o(63362),r=o(82530),a=o(63474),l=o(12455);function s(){const{automationStore:e,collectionStore:t,maybePersistedTransactionActions:o}=(0,l.P)(),s=(0,a.D)(),d=(0,n.useMemo)((()=>({automation_id:e.id,collection_id:t.id})),[e.id,t.id]),u=(0,n.useCallback)((()=>{var t;const o=null===(t=e.getTrigger())||void 0===t?void 0:t.event.pagePropertiesEdited,n="some"===(null==o?void 0:o.type)&&o.some;return n||[]}),[e]),p=(0,n.useCallback)((t=>{o.createAndCommit({userAction:"automations.removePropertyTrigger",perform:o=>{r.applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:0===t.length?{type:"none"}:{type:"some",some:t}}},transaction:o})}})}),[e,o]);return{addPropertyTrigger:(0,n.useCallback)((e=>{p([...u(),e]);const o=t.getSchema()[e.property];(0,i.nK)(s,{automation_trigger:{type:"property",condition:"some",property_types:null!=o&&o.type?[o.type]:[]},...d})}),[d,t,s,u,p]),updatePropertyTrigger:(0,n.useCallback)((e=>{const{anyOptionCheckState:o,propertyId:n,currentFilter:r}=e,a=u();p((()=>{switch(o){case"partial":return c(a,(e=>e.property===n),(e=>({...e,filter:r})),{property:n,filter:r});case!0:return c(a,(e=>e.property===n),(e=>({...e,filter:{operator:"changes_to_any"}})),{property:n,filter:{operator:"changes_to_any"}});case!1:return a.filter((e=>e.property!==n))}})());const l=t.getSchema()[n];(0,i.nK)(s,{automation_trigger:{type:"property",condition:"some",property_types:null!=l&&l.type?[l.type]:[]},...d})}),[d,t,s,u,p]),removePropertyTrigger:(0,n.useCallback)((e=>{p(u().filter((t=>t.property!==e)));const o=t.getSchema()[e];(0,i.Ey)(s,{automation_trigger:{type:"property",condition:"some",property_types:null!=o&&o.type?[o.type]:[]},...d})}),[d,t,s,u,p]),addPageAddedTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.addPageAddedTrigger",perform:t=>{r.applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagesAdded:!0}},transaction:t})}}),(0,i.nK)(s,{automation_trigger:{type:"page"},...d})}),[d,e,s,o]),removePageAddedTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.removePageAddedTrigger",perform:t=>{r.applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagesAdded:!1}},transaction:t})}}),(0,i.Ey)(s,{automation_trigger:{type:"page"},...d})}),[d,e,s,o]),addAnyPropertyEditedTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.addAnyPagePropertyEditedTrigger",perform:t=>{r.applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:{type:"any"}}},transaction:t})}}),(0,i.nK)(s,{automation_trigger:{type:"property",condition:"any"},...d})}),[d,e,s,o]),removeAnyPropertyEditedTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.removeAnyPropertyEditedTrigger",perform:t=>{r.applyOperation({store:e,operation:{path:["trigger","event"],args:{pagePropertiesEdited:{type:"none"}},pointer:e.pointer,command:"update"},transaction:t})}}),(0,i.Ey)(s,{automation_trigger:{type:"property",condition:"any"},...d})}),[d,e,s,o])}}function c(e,t,o,n){let i=!1;const r=e.map((e=>t(e)?(i=!0,o(e)):e));return i||r.push(n),r}},96245:(e,t,o)=>{o.d(t,{$:()=>v,U:()=>S});o(21703);var n=o(67294),i=o(480),r=o(86628),a=o(77337),l=o(45953),s=o(98963),c=o(97880),d=o(82530),u=o(78243),p=o(28020),m=o(3932),g=o(84398),y=o(80444),h=o(79797);const f=1e3,S=e=>{const t=new m.Y({deadlockTimeoutMs:f});return{performResult:e.perform(t),serverCommitResult:Promise.resolve()}};function v(e){const{automationId:t,spaceId:o,defaultValue:S,persist:v}=e,x=(0,i.O7)(),C=(0,r.VK)((()=>{var e;return null===(e=y.default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]),b=(0,n.useMemo)((()=>{if(t&&o&&C)return{id:t,table:s.cv,spaceId:o}}),[t,o,C]),w=(0,g.$)("useUnpersistedAutomationStore",{cacheFallback:x.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),k=(0,n.useCallback)((()=>{if(!b)return;const e=w.getEntry({pointer:b,userId:C});if(!(0,c.$K)(e)&&C){if(!S)throw new Error("create is true but no defaultValue provided");w.setRecord({pointer:b,userId:C},{role:"editor",value:S})}return new h.Mz(x,b,{inMemoryRecordCache:w})}),[S,x,b,w,C]),M=(0,n.useCallback)((()=>{const e=p.np();if(b&&e)return h.Mz.createChildStore(e,b)}),[b]),j=(0,r.VK)((()=>{if(!b)return;const e=v?M():k();return e||void 0}),[M,k,v,b]),_=!v&&(0,u.B)({automationStorePointer:null==j?void 0:j.pointer,defaultRecordCache:x.defaultRecordCache.inMemoryRecordCache,inMemoryRecordCache:w,userId:C}),A=(0,n.useCallback)((e=>{let{perform:t}=e;const o=new m.Y({deadlockTimeoutMs:f}),n=t(o),i=l.Ak.create();o.stores.forEach((e=>{const t=e.getRecordModel(e.pointer);t&&i.addModel(t)})),(0,a.FS)({operations:o.operations,recordMap:i,updateOnly:!1});for(const r of i){const{model:e,pointer:t}=r;w.setModelAndRole({pointer:t,userId:C},e,"editor")}return w.emitAll(),{performResult:n,serverCommitResult:Promise.resolve()}}),[w,C]),T=(0,n.useCallback)((e=>v?d.createAndCommit({...e,environment:x}):A(e)),[A,x,v]);return{maybePersistedTransactionActions:{createAndCommit:T},maybePersistedAutomationStore:j,hasUnpersistedChanges:_}}},73590:(e,t,o)=>{o.d(t,{Z:()=>c});o(67294);var n=o(480),i=o(84169),r=o(25888),a=o(16354),l=o(94166),s=o(85893);const c=function(e){window.__c={n:"CollectionSettingsLearnMoreButton"};const{title:t,href:o,analyticsFrom:c}=e,d=(0,n.O7)();return(0,s.jsx)(a.Z,{href:o,onClick:()=>r.Fs(d,{from:c}),external:!0,children:(0,s.jsx)(l.Z,{icon:i.m,title:t,isGray:!0})})}},57410:(e,t,o)=>{o.d(t,{Z:()=>_});o(57658);var n=o(43261),i=o.n(n),r=o(67294),a=o(480),l=o(86628),s=o(24405),c=o(6695),d=o(56666),u=o(37612),p=o(72126),m=o(62965),g=o(9291),y=o(73657),h=o(52275),f=o(68894),S=o(32163),v=o(72495),x=o(69872),C=o(65183),b=o(33929),w=o(29798),k=o(85893);const M=(0,g.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertySelect.inputPlaceholder"},none:{defaultMessage:"None",id:"database.viewSettings.propertySelect.noneMessage"},remove:{defaultMessage:"Remove",id:"database.viewSettings.propertySelect.removeMessage"}});function j(e){let{currentProperty:t,showNoneOption:o,showRemoveOption:n,getProperties:m,onAccept:j,inputPlaceholder:_,defaultShowPropertyCount:A,schema:T,format:P,renderProperty:V}=e;window.__c={n:"CollectionSettingsPropertySelectMenu"};const I=(0,a.Fy)(),[F,Z]=(0,r.useState)(""),[K,B]=(0,r.useState)(!1),O=(0,l.qz)(void 0,w.Z),R=(0,s.yK)((e=>({icon:{width:16,fill:e.mediumTextColor,marginLeft:4,marginRight:2},menuItem:{color:e.mediumTextColor}})),[]),D=(0,c.iB)(P,T,void 0,c.j5.Page).collection_page_properties||[],W=!A||K,E=b.default.formatMessage(M.none),N=o?{key:"none",render:e=>(0,k.jsx)(h.Z,{...e,checkState:!t,title:E}),action:()=>{j(void 0)}}:void 0,L=n?{key:"remove",render:e=>(0,k.jsx)(h.Z,{...e,icon:(0,u.y)(R.icon),title:b.default.formatMessage(M.remove)}),action:()=>{j(void 0)}}:void 0,H=m();let U=p.MR(H,(e=>D.findIndex((t=>t.property===e))));if(F){const e=new Map;let t=U.map((t=>{const o=T[t],n=o?`${o.name} ${C.SO[o.type]}`:"";return e.set(t,n),n}));t=i().filter(F,t).map((e=>{let{original:t}=e;return t})),U=U.filter((o=>t.includes(e.get(o)||"")))}else!W&&A&&(U=U.slice(0,A));const z=p.oA([!F||i().test(F,E)?N:void 0,...U.map((e=>function(e,t,o,n,i){const r=t[e];if(!r)return;const a={key:e,render:t=>{const o=e===n;return i?i(t,e,o,r):(0,k.jsx)(x.Z,{...t,propertySchema:r,format:x.L.Name,checkState:o})},action:()=>{o(e)}};return a}(e,T,j,t,V)))]);if(!W&&H.length>U.length&&!F){const e={key:"show_more",render:e=>(0,k.jsx)(h.Z,{...e,icon:(0,d.o)(R.icon),style:R.menuItem,title:(0,k.jsx)(g.FormattedMessage,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:H.length-U.length}})}),action:()=>{B(!0)}};z.push(e)}const $=z.length>0,q=Boolean(F),G=!L||$||q;G&&!$&&z.push({action:p.ZT,key:"noResults",render:e=>(0,k.jsx)(y.Z,{...e,caption:(0,k.jsx)(g.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})});const Y=[];return G&&Y.push({key:"input",comp:(0,k.jsx)(v.Z,{children:(0,k.jsx)(f.ZP,{focusInitial:!I.isMobile||void 0,focus:!I.isMobile||void 0,value:F,onChange:e=>{Z(e.target.value),O.setState({...O.state,focus:{section:0,indexLocal:0,indexGlobal:0}}),B(!1)},placeholder:_||b.default.formatMessage(M.inputPlaceholder)})})}),(z.length>0||L)&&Y.push({key:"properties",comp:(0,k.jsx)(S.Z,{type:S.i.Vertical,initialFocus:0,sections:[...z.length>0?[{key:"results",render:e=>(0,k.jsx)(v.Z,{...e}),items:z}]:[],...L?[{key:"remove",render:e=>(0,k.jsx)(v.Z,{topBorder:z.length>0,...e}),items:[L]}]:[]],store:O})}),(0,k.jsx)(k.Fragment,{children:Y.map((e=>{let{key:t,comp:o}=e;return(0,k.jsx)(r.Fragment,{children:o},t)}))})}const _=r.memo(j,m.Z)},32628:(e,t,o)=>{o.d(t,{S:()=>P,Z:()=>Z});o(57658);var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(49085),s=o(56666),c=o(44495),d=o(6287),u=o(62965),p=o(9291),m=o(8406),g=o(73657),y=o(52275),h=o(68894),f=o(32163),S=o(11470),v=o(72495),x=o(26388),C=o(78948),b=o(23586),w=o(33929),k=o(77907),M=o(75822),j=o(80444),_=o(29798),A=o(79797),T=o(85893);let P=function(e){return e[e.Source=0]="Source",e[e.Relation=1]="Relation",e[e.Automation=2]="Automation",e}({});const V=(0,p.defineMessages)({linkedInputPlaceholder:{defaultMessage:"Link to a database…",id:"database.viewSettings.searchCollections.linkedInputPlaceholder"},linkedOrSourceInputPlaceholder:{defaultMessage:"Link or create a database…",id:"database.viewSettings.searchCollections.linkedOrSourceInputPlaceholder"},automationInputPlaceholder:{id:"automations.databasePicker.automationInputPlaceholder",defaultMessage:"Select a database…"}}),I=l.default.createClass("");function F(e){let{collectionContextStore:t,selectedCollectionStore:o,context:l,parentStore:c,onAccept:u,requireEditPermissions:x,searchSessionId:F,inputStore:Z}=e;window.__c={n:"CollectionSettingsSearchCollections"};const B=(0,i.O7)(),O=(0,r.qz)(Z,I),R=(0,r.qz)(void 0,_.Z),[D,W]=(0,n.useState)(5),E=(0,r.VK)((()=>O.state),[O]),N=(0,r.VK)((()=>null==t?void 0:t.getCollectionViewBlockSourceState()),[t]),L=(0,a.yK)((e=>({showMoreButton:{color:e.mediumTextColor,fill:e.mediumIconColor}})),[]),H="linked"===N||l===P.Relation?V.linkedInputPlaceholder:l===P.Source?V.linkedOrSourceInputPlaceholder:V.automationInputPlaceholder,U=(0,n.useCallback)((e=>{const{collectionStore:o,totalResults:n,clickedIndex:i}=e;t&&m.wd({environment:B,collectionContextStore:t,action:"select_existing_collection"}),u(o),m.tW({environment:B,eventName:"select_search_item",totalResults:n,clickedIndex:i,sessionId:F,source:l,queryLength:E.length})}),[t,l,B,E,u,F]);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(v.Z,{children:(0,T.jsx)(h.ZP,{focusInitial:!B.device.isMobile||void 0,value:E,onChange:e=>{O.setState(e.target.value),W(e.target.value?20:5),R.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:w.default.formatMessage(H),showClearButton:!0})}),(0,T.jsx)(b.Z,{request:{query:E,limit:D},performRequest:e=>async function(e,t,o,n,i,r){const{query:a,limit:l}=e,{currentSpaceStore:s}=j.default.state,c=null==i?void 0:i.collectionViewBlockStore(),d=await k.deps.searchActions.loader(),u=await d.searchCollectionsWithRecents({environment:o,collectionViewBlockStore:c,parentStore:t,spaceStore:s,query:a,limit:l,requireEditPermissions:r,searchSessionId:n});return{results:u.results,showMore:Math.max(0,u.total-u.results.length)}}(e,c,B,F,t,x),debounce:M.vp,render:(e,n,i)=>{if(!n)return(0,T.jsx)(v.Z,{children:(0,T.jsx)(C.Z,{})});const{results:r,showMore:a}=n,u=r.map((e=>{const n=A.NW.createChildStore(c,{table:d.v,id:e});return{key:e,render:i=>{var r;return(0,T.jsx)(S.Z,{...i,checkState:o&&o.id===e,store:n,right:l===P.Relation&&(null==t||null===(r=t.collectionStore())||void 0===r?void 0:r.id)===e&&(0,T.jsx)(K,{})})},action:e=>{const{index:t}=e;U({collectionStore:n,totalResults:r.length,clickedIndex:t})}}}));if(a>0){const e={key:"showMore",render:e=>(0,T.jsx)(y.Z,{...e,buttonStyle:L.showMoreButton,icon:(0,s.o)({width:16,height:16}),title:(0,T.jsx)(p.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.searchCollections.showMore.title",values:{showMore:Math.min(a,20)}})}),action:()=>{W(D+20)}};u.push(e)}return(0,T.jsxs)(T.Fragment,{children:[r.length>0&&(0,T.jsx)(f.Z,{type:f.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,T.jsx)(v.Z,{...e}),items:u}],store:R}),0===r.length&&(0,T.jsx)(g.Z,{caption:(0,T.jsx)(p.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.searchCollections.noResultsTitle"})})]})}})]})}const Z=n.memo(F,u.Z);function K(){return(0,T.jsx)(x.ZP,{renderTooltip:()=>(0,T.jsx)(p.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettigs.searchCollections.thisDatabase.tooltip"}),render:e=>(0,T.jsx)("div",{...e,children:(0,c.D)({width:14,height:14})})})}},33732:(e,t,o)=>{o.d(t,{Z:()=>de,v:()=>ce});o(57658),o(21703);var n=o(67294),i=o(83355),r=o(480),a=o(86628),l=o(24405),s=o(49085),c=o(15145),d=o(6906),u=o(99036),p=o(12396),m=o(53877),g=o(6695),y=o(72126),h=o(4615),f=o(82990),S=o(9291),v=o(36610),x=o(8406),C=o(5149),b=o(96802),w=o(8055),k=o(80402),M=o(82530),j=o(75330),_=o(10906),A=o(42922),T=o(64921),P=o(31945),V=o(74194),I=o(78140),F=o(53437),Z=o(72495),K=o(24006),B=o(86825),O=o(28020),R=o(40863),D=o(33929);const W=(0,S.defineMessages)({none:{defaultMessage:"None",id:"database.viewPropertiesMenu.coverFormat.none"},page_content:{defaultMessage:"Page content",id:"database.viewPropertiesMenu.coverFormat.pageContent"},page_cover:{defaultMessage:"Page cover",id:"database.viewPropertiesMenu.coverFormat.pageCover"}}),E=(0,S.defineMessages)({small:{defaultMessage:"Small",id:"database.viewPropertiesMenu.coverSize.small"},medium:{defaultMessage:"Medium",id:"database.viewPropertiesMenu.coverSize.medium"},large:{defaultMessage:"Large",id:"database.viewPropertiesMenu.coverSize.large"}}),N=function(e){return e?"page_content"===e.type?D.default.formatMessage(W.page_content):"page_cover"===e.type?D.default.formatMessage(W.page_cover):void 0:D.default.formatMessage(W.none)},L=e=>{switch(e){case"small":return D.default.formatMessage(E.small);case"medium":return D.default.formatMessage(E.medium);case"large":return D.default.formatMessage(E.large)}};var H=o(92918),U=o(65183),z=o(48543),$=o(65742),q=o(84210),G=o(87279),Y=o(18514),Q=o(80444),X=o(61766),J=o(77080),ee=o(36857),te=o(88923),oe=o(73590),ne=o(94166),ie=o(18533),re=o(57410),ae=o(8306),le=o(85893);class se extends i.Z{constructor(){super(...arguments),this.storeTypes={hoveredTypeStore:s.default.createClass(void 0),timelineByButtonPopupStore:X.Z,timelineByEndButtonPopupStore:X.Z,calendarByButtonPopupStore:X.Z},this.renderViewTypeButton=e=>{const{intl:t,collectionContextStore:o}=this.props,n=pe(this.props.collectionContextStore),i=o.permissionScopes.state,r=n===e,a=r||!i.canConfigureBlock;return(0,le.jsxs)(T.Z,{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"calc(33% - 12px)",flexGrow:0,flexShrink:0,fontSize:11,borderRadius:4,margin:6,padding:6,boxShadow:`0 0 0 1px ${this.theme.regularDividerColor}`,color:this.theme.mediumTextColor,fill:this.theme.mediumTextColor,...r&&{boxShadow:`0 0 0 2px ${this.theme.blueColor}`,color:this.theme.blueColor,fill:this.theme.blueColor,fontWeight:500}},disabled:a,onClick:()=>{M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderViewTypeButton",environment:this.environment,perform:n=>{j.z2({environment:this.environment,collectionContextStore:o,newViewType:e,transaction:n,intl:t})}}),x.wd({environment:this.environment,collectionContextStore:o,action:"change_type",original_view_type:n})},onMouseMove:()=>{this.stores.hoveredTypeStore.setState(e)},children:[U.aW[e]({width:void 0,height:20,marginBottom:4,marginTop:4}),(0,le.jsx)("div",{children:U.Bh[e]})]},e)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleViewTypeAreaMouseLeave=()=>{this.stores.hoveredTypeStore.setState(void 0)},this.isChartsEnabled=this.createComputedStore((()=>J.default.checkGate("charts_mvp")))}renderComponent(){const{collectionContextStore:e,showDoneButton:t}=this.props,{hoveredTypeStore:o}=this.stores,{device:n}=this.environment,i=e.normalizedQueryStore.state,r=e.normalizedSchemaStore.state,a=e.normalizedFormatStore.state,l=e.isFullScreen.state,s=e.isRootChild.state,c=pe(this.props.collectionContextStore),d=Boolean(me(this.props.collectionContextStore)),p="table"===c||"board"===c||"gallery"===c,m="table"===c,g=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,u.Lt)(t)})),y="timeline"===c&&g.length>0,h="timeline"===c&&g.length>1,f="timeline"===c&&Boolean(null==i?void 0:i.timeline_by_end),v="calendar"===c&&g.length>0,w="calendar"===c,k="board"===c,j=(0,$.d$)({environment:this.environment,isFullScreen:l,isRootChild:s}),_="timeline"===c&&Boolean(a.timeline_show_table)&&j,T="timeline"===c&&j,P=e.collectionViewBlockStore();if(!P)return;const V=P.getCollectionViewSourceCollectionStore(),I=!("collectionTypedView"===e.contextType||V&&l),F=!(0,O.YO)(e.isInPeekRenderer.state),K=e.permissionScopes.state,R="page"===c,D=["table","board","timeline","calendar","list","gallery"];return this.isChartsEnabled.state&&D.push("chart"),(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(Z.Z,{topBorder:!1,shouldShowBottomDivider:n.isMobile,children:(0,le.jsxs)("div",{style:{...!n.isMobile&&{width:"100%",paddingLeft:8,paddingRight:8},...n.isMobile&&{background:this.theme.contentBackground,width:"100%",paddingTop:12,paddingBottom:12}},onMouseLeave:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleViewTypeAreaMouseLeave,children:[(0,le.jsx)("div",{style:{display:"flex",flexFlow:"wrap",justifyContent:"center"},children:D.map(this.renderViewTypeButton)}),(0,le.jsx)("div",{style:{color:this.theme.lightTextColor,fontSize:12,margin:"6px 8px 0px 8px"},children:U.sN[o.state||c]})]})}),(0,le.jsxs)(Z.Z,{children:[I&&(0,le.jsx)(B.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.layoutTab.showDatabaseTitle.title"}),focused:!1,on:e.shouldShowSource.state,onClick:()=>function(e,t){const o=t.collectionViewStore();if(!o)return;const n=!t.shouldShowSource.state;M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleShowCollectionTitleClick",environment:e,perform:e=>{b.FH({stores:[o],update:{hide_linked_collection_name:!n},transaction:e})}}),x.wd({environment:e,collectionContextStore:t,action:"toggle_show_collection_title"})}(this.environment,this.props.collectionContextStore),disabled:!K.canConfigureBlock,textWrapperStyle:{opacity:1}}),d&&this.renderCardSettings(),m&&(0,le.jsx)(ke,{collectionContextStore:this.props.collectionContextStore}),p&&(0,le.jsx)(Me,{collectionContextStore:this.props.collectionContextStore}),R&&(0,le.jsx)(fe,{collectionContextStore:this.props.collectionContextStore}),y&&(0,le.jsx)(Se,{collectionContextStore:this.props.collectionContextStore}),f&&(0,le.jsx)(ve,{collectionContextStore:this.props.collectionContextStore}),h&&(0,le.jsx)(je,{collectionContextStore:this.props.collectionContextStore}),v&&(0,le.jsx)(xe,{collectionContextStore:this.props.collectionContextStore}),w&&(0,le.jsx)(_e,{collectionContextStore:this.props.collectionContextStore}),T&&(0,le.jsx)(ae.N,{collectionContextStore:e}),_&&(0,le.jsx)(Ce,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),k&&(0,le.jsx)(be,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),F&&(0,le.jsx)(Ae,{collectionContextStore:this.props.collectionContextStore}),(0,le.jsx)(Te,{collectionContextStore:this.props.collectionContextStore})]}),t&&(0,le.jsx)(Z.Z,{disableMobileBorders:!0,children:(0,le.jsx)(A.Z,{style:{display:"flex",margin:"0 14px"},onClick:()=>function(e,t,o){C.wl({collectionSettingsStore:t,item:{type:"main"}}),x.wd({environment:e,collectionContextStore:o,action:"click_create_view_done"})}(this.environment,this.props.collectionSettingsStore,this.props.collectionContextStore),children:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Done",id:"database.viewSettings.createViewTab.doneButton.title"})})}),(0,le.jsx)(Z.Z,{topBorder:!1,children:(0,le.jsx)(oe.Z,{href:(0,Y.UY)("guides.databaseView"),title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Learn about views",id:"database.viewSettings.layoutTab.learnMoreButton.title"}),analyticsFrom:"view_settings_layout"})})]})}renderCardSettings(){const{device:e}=this.environment,{collectionContextStore:t}=this.props,o=function(e){const t=e.normalizedFormatStore.state,o=me(e);if(o&&t)return t[o]}(this.props.collectionContextStore),n=function(e){const t=e.normalizedFormatStore.state,o=ge(e);if(o&&t){const e=t[o];if(e)return e}return g.PZ}(this.props.collectionContextStore),i=!e.isMobile||"board"===pe(this.props.collectionContextStore),r=t.permissionScopes.state;return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(ie.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Card preview",id:"database.viewSettings.layoutTab.cardPreviewButtonTitle"}),selectedKey:o,popupStyle:{minWidth:190},options:Pe(this.environment,this.theme,this.props.collectionContextStore),onChange:e=>function(e,t,o){const n=me(o),i=o.collectionViewStore();if(!n||!i)return;M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverFormatChange",environment:t,perform:t=>{b.FH({stores:[i],update:{[n]:e},transaction:t})}}),x.wd({environment:t,collectionContextStore:o,action:"update_cover_format"})}(e,this.environment,this.props.collectionContextStore),disabled:!r.canConfigureBlock}),i&&(0,le.jsx)(ie.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Card size",id:"databdatabase.viewSettings.layoutTab.cardSizeButtonTitle"}),selectedKey:n,popupStyle:{minWidth:190},options:ue(),onChange:e=>function(e,t,o){const n=ge(o),i=o.collectionViewStore();if(!n||!i)return;M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverSizeFormatChange",environment:t,perform:t=>{b.FH({stores:[i],update:{[n]:e},transaction:t})}}),x.wd({environment:t,collectionContextStore:o,action:"toggle_cover_size_format"})}(e,this.environment,this.props.collectionContextStore),disabled:!r.canConfigureBlock}),o&&(0,le.jsx)(B.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Fit image",id:"databdatabase.viewSettings.layoutTab.fitImageButtonTitle"}),on:"contain"===he(this.props.collectionContextStore),focused:!1,onClick:()=>function(e,t){const o=ye(t),n=t.collectionViewStore(),i=t.normalizedFormatStore.state;if(!o||!n)return;M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverAspectFormatToggle",environment:e,perform:e=>{b.FH({stores:[n],update:{[o]:"contain"===i[o]?"cover":"contain"},transaction:e})}}),x.wd({environment:e,collectionContextStore:t,action:"toggle_cover_aspect_format"})}(this.environment,this.props.collectionContextStore),disabled:!r.canConfigureBlock,textWrapperStyle:{opacity:1}})]})}}function ce(e){const{currentViewType:t,theme:o}=e,n=t?z.Ls[t]:void 0;return["side_peek","center_peek","full_page"].map((e=>({key:e,title:(0,z.LQ)(e),body:(0,le.jsxs)(le.Fragment,{children:[(0,z.RI)(e),n&&t&&e===n&&(0,le.jsx)("div",{style:{marginTop:2,fontWeight:500,color:o.blueColor},children:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Default for {view}",id:"database.viewPropertiesMenu.peekMode.defaultForView",values:{view:(0,d.Z)(t)}})})]}),icon:(0,z.RO)(e)({width:16,fill:o.mediumTextColor})})))}se.displayName="CollectionSettingsViewLayoutMenu";const de=(0,S.injectIntl)(se);function ue(){return["small","medium","large"].map((e=>({key:e,title:L(e)})))}function pe(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function me(e){return U.DL[pe(e)]}function ge(e){return U.oy[pe(e)]}function ye(e){return U._Y[pe(e)]}function he(e){const t=e.normalizedFormatStore.state,o=ye(e);if(o&&t)return t[o]}function fe(e){let{collectionContextStore:t}=e;window.__c={n:"PageViewSetting"};const o=(0,r.O7)(),n=(0,a.VK)((()=>t.collectionViewStore()),[t]);return n?(0,le.jsx)("div",{style:{padding:5},children:(0,le.jsx)(V.Z,{showClearButton:!0,placeholder:"Enter page ID",focusInitial:!0,onChange:e=>{ee.Z.setState({pageId:e.target.value})},onSubmit:e=>{const t=ee.Z.state.pageId;t&&M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderPageViewSettings",environment:o,perform:e=>{b.FH({stores:[n],update:{page_pointer:{id:(0,h.Mt)(t),spaceId:e.spaceId,table:"block"}},transaction:e})}})}})}):null}function Se(e){let{collectionContextStore:t}=e;window.__c={n:"TimelineBySetting"};const o=(0,r.O7)(),n=(0,r.MO)(),i=(0,a.VK)((()=>{var e;return null===(e=t.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by}),[t]),l=(0,a.VK)((()=>{var e;return null===(e=t.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by_end}),[t]),s=(0,a.VK)((()=>t.permissionScopes.state),[t]),c=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),d=(0,a.VK)((()=>t.collectionViewStore()),[t]),p=(0,a.VK)((()=>t.collectionStore()),[t]),m=(0,a.VK)((()=>null==p?void 0:p.getSchema()),[p]),g=(0,a.VK)((()=>null==p?void 0:p.getFormat()),[p]);if(!(i&&d&&p&&g&&m))return null;const y=c[i];return y?(0,le.jsx)(P.ZP,{popupType:n?F.kQ.SlideUp:F.kQ.Popup,alignmentToOrigin:P.vR.End,placementToOrigin:P.pO.Bottom,originGap:0,renderOrigin:e=>(0,le.jsx)(ne.Z,{title:l?(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Start date",id:"database.viewSettings.layoutTab.timelineStartDate.title"}):(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Show timeline by",id:"database.viewSettings.layoutTab.showTimelineByProperty.title"}),disabled:!s.canConfigureBlock,showChevron:!0,right:(0,le.jsx)("div",{style:f.Z.textOverflowStyle,children:y.name}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},...e}),render:e=>{let r;return r=n?{menuType:G.og.ActionSheet}:{menuType:G.og.Popup,width:300},(0,le.jsx)(I.Z,{...r,children:(0,le.jsx)(re.Z,{schema:m,format:g,currentProperty:i,getProperties:()=>Object.keys(c).filter((e=>{const t=c[e];return t&&(0,u.Lt)(t)})),onAccept:n=>{n&&(M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderTimelineBySetting",environment:o,perform:e=>{j.Es({collectionViewStore:d,update:{timeline_by:n},transaction:e})}}),e.close(),x.wd({environment:o,collectionContextStore:t,action:"update_timeline_by",original_view_type:void 0,property_type:y.type}))}})})}}):null}function ve(e){let{collectionContextStore:t}=e;window.__c={n:"TimelineEndSetting"};const o=(0,r.O7)(),n=(0,r.MO)(),i=(0,a.VK)((()=>{var e;return null===(e=t.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by_end}),[t]),l=(0,a.VK)((()=>t.permissionScopes.state),[t]),s=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),c=(0,a.VK)((()=>t.collectionViewStore()),[t]),d=(0,a.VK)((()=>t.collectionStore()),[t]),p=(0,a.VK)((()=>null==d?void 0:d.getSchema()),[d]),m=(0,a.VK)((()=>null==d?void 0:d.getFormat()),[d]);if(!(i&&c&&d&&m&&p))return null;const g=s[i];return g?(0,le.jsx)(P.ZP,{popupType:n?F.kQ.SlideUp:F.kQ.Popup,alignmentToOrigin:P.vR.End,placementToOrigin:P.pO.Bottom,originGap:0,renderOrigin:e=>(0,le.jsx)(ne.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"End date",id:"database.viewSettings.layoutTab.timelineEndDate.title"}),showChevron:!0,right:g.name,disabled:!l.canConfigureBlock,...e}),render:e=>{let r;return r=n?{menuType:G.og.ActionSheet}:{menuType:G.og.Popup,width:300},(0,le.jsx)(I.Z,{...r,children:(0,le.jsx)(re.Z,{schema:p,format:m,currentProperty:i,getProperties:()=>Object.keys(s).filter((e=>{const t=s[e];return t&&(0,u.Lt)(t)})),onAccept:n=>{n&&(M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderTimelineEndSetting",environment:o,perform:e=>{j.Es({collectionViewStore:c,update:{timeline_by_end:n},transaction:e})}}),e.close(),x.wd({environment:o,collectionContextStore:t,action:"update_timeline_by_end",original_view_type:void 0,property_type:g.type}))}})})}}):null}function xe(e){let{collectionContextStore:t}=e;window.__c={n:"CalendarBySetting"};const o=(0,r.O7)(),n=(0,r.MO)(),i=(0,a.VK)((()=>{var e;return null===(e=t.normalizedQueryStore.state)||void 0===e?void 0:e.calendar_by}),[t]),l=(0,a.VK)((()=>t.permissionScopes.state),[t]),s=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),c=(0,a.VK)((()=>t.collectionViewStore()),[t]),d=(0,a.VK)((()=>t.collectionStore()),[t]),p=(0,a.VK)((()=>null==d?void 0:d.getSchema()),[d]),m=(0,a.VK)((()=>null==d?void 0:d.getFormat()),[d]);if(!(i&&c&&d&&m&&p))return null;const g=s[i];return g?(0,le.jsx)(P.ZP,{popupType:n?F.kQ.SlideUp:F.kQ.Popup,alignmentToOrigin:P.vR.End,placementToOrigin:P.pO.Bottom,originGap:0,renderOrigin:e=>(0,le.jsx)(ne.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Show calendar by",id:"database.viewSettings.layoutTab.showCalendarByProperty.title"}),disabled:!l.canConfigureBlock,showChevron:!0,right:(0,le.jsx)("div",{style:f.Z.textOverflowStyle,children:g.name}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},...e}),render:e=>{let r;return r=n?{menuType:G.og.ActionSheet}:{menuType:G.og.Popup,width:300},(0,le.jsx)(I.Z,{...r,children:(0,le.jsx)(re.Z,{schema:p,format:m,currentProperty:i,getProperties:()=>Object.keys(s).filter((e=>{const t=s[e];return t&&(0,u.Lt)(t)})),onAccept:n=>{n&&(M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderCalendarBySetting",environment:o,perform:e=>{j.Es({collectionViewStore:c,update:{calendar_by:n},transaction:e})}}),e.close(),x.wd({environment:o,collectionContextStore:t,action:"update_calendar_by",original_view_type:void 0,property_type:g.type}))}})})}}):null}function Ce(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"TimelineTableProperties"};const n=(0,r.O7)(),i=((0,a.VK)((()=>t.normalizedFormatStore.state),[t]).timeline_table_properties||[]).filter((e=>Boolean(e.visible))).length,l=(0,a.VK)((()=>t.permissionScopes.state),[t]);return(0,le.jsx)(ne.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Table properties",id:"database.viewSettings.layoutTab.tablePropertiesButton.title"}),showChevron:!0,right:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"{propertiesShown} shown",id:"database.viewSettings.layoutTab.propertiesButton.propertiesShown.title",values:{propertiesShown:i}}),onClick:()=>{C.H4({collectionSettingsStore:o,item:{type:"properties",timelineViewTab:"table"}}),x.wd({environment:n,collectionContextStore:t,action:"click_timeline_table_properties"})},disabled:!l.canConfigureBlock})}function be(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"BoardGroupByShortcuts"};const n=(0,r.O7)(),i=(0,a.VK)((()=>t.normalizedFormatStore.state.board_columns_by),[t]),l=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),s=(0,a.VK)((()=>t.permissionScopes.state),[t]),c=(0,a.VK)((()=>(0,H.h6)(n,t)),[t,n]);if(!i)return null;const d=l[i.property];return d?(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(ne.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Group by",id:"database.viewSettings.layoutTab.boardGroupByButton.title"}),showChevron:!0,right:d.name,onClick:()=>{C.H4({collectionSettingsStore:o,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}}),x.wd({environment:n,collectionContextStore:t,action:"click_board_group_by",original_view_type:void 0,property_type:d.type})},disabled:!s.canConfigureBlock}),(0,le.jsx)(B.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Color columns",id:"database.viewSettings.groupTab.colorColumns"}),on:!c,focused:!1,onClick:()=>{C.iN({environment:n,collectionContextStore:t})},disabled:!s.canConfigureBlock,textWrapperStyle:{opacity:1}})]}):null}function we(e,t,o){const n=o.collectionViewStore();if(!n)return;const{serverCommitResult:i}=M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleViewRangeOptionClick",environment:t,perform:t=>{b.FH({stores:[n],update:{calendar_view_range:e},transaction:t})}}),r=O.AK.state,a=o.dateRangeStart.state,l=o.dateRangeEnd.state,{newDateRangeStart:s,newDateRangeEnd:c}=function(e){const{newViewRange:t,oldCalendarEnd:o,startOfWeekSetting:n}=e;if("month"===t){const e=(0,m.IS)((0,m.kl)(o),n);return{newDateRangeStart:e,newDateRangeEnd:(0,m.V7)((0,m._)({date:e,monthsToAdd:1}),n)}}return{newDateRangeStart:(0,m.IS)(Date.now(),n),newDateRangeEnd:(0,m.V7)(Date.now(),n)}}({oldCalendarEnd:l,newViewRange:e,startOfWeekSetting:r});j.t5({dateRangeStart:s,dateRangeEnd:c,collectionContextStore:o}),i.then((()=>{x.wd({environment:t,collectionContextStore:o,action:"update_calendar_view_range"})})).catch((()=>{j.t5({dateRangeStart:a,dateRangeEnd:l,collectionContextStore:o})}))}function ke(e){let{collectionContextStore:t}=e;window.__c={n:"TableVerticalLinesSettingComponent"};const o=(0,r.O7)(),n=(0,a.VK)((()=>t.permissionScopes.state),[t]),i=(0,a.VK)((()=>!Boolean(t.normalizedFormatStore.state.hide_table_vertical_lines)),[t]);return(0,le.jsx)(B.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Show vertical lines",id:"database.viewSettings.layoutTab.tableShowVerticalLines"}),on:i,focused:!1,onClick:()=>function(e,t){const o=t.collectionViewStore();if(!o)return;const n=Boolean(t.normalizedFormatStore.state.hide_table_vertical_lines);k.AU({environment:e,collectionViewStore:o,currentValue:n}),x.wd({environment:e,collectionContextStore:t,action:"toggle_table_vertical_lines"})}(o,t),disabled:!n.canConfigureBlock,textWrapperStyle:{opacity:1}})}function Me(e){let{collectionContextStore:t}=e;window.__c={n:"TableWrapCellsSettingComponent"};const o=(0,r.O7)(),n=(0,a.VK)((()=>t.normalizedFormatStore.state),[t]),i=(0,a.VK)((()=>t.permissionScopes.state),[t]),l=(0,a.VK)((()=>pe(t)),[t]);return(0,le.jsx)(B.Z,{title:"table"===l?(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Wrap all columns",id:"database.viewSettings.layoutTab.tableWrapAllColumns"}):(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Wrap all properties",id:"database.viewSettings.layoutTab.tableWrapAllProperties"}),on:Boolean(n.table_wrap),focused:!1,onClick:()=>function(e,t){const o=t.collectionViewStore();if(!o)return;const n=Boolean(t.normalizedFormatStore.state.table_wrap);k.qY({environment:e,collectionViewStore:o,currentValue:n}),v.wd(e,{view_type:pe(t),action:"set_first_load_limit"}),x.wd({environment:e,collectionContextStore:t,action:"toggle_table_wrap_cells"})}(o,t),disabled:!i.canConfigureBlock,textWrapperStyle:{opacity:1}})}function je(e){let{collectionContextStore:t}=e;window.__c={n:"TimelineSeparateDatesSettingComponent"};const o=(0,r.O7)(),n=(0,a.VK)((()=>t.normalizedQueryStore.state),[t]),i=null==n?void 0:n.timeline_by_end,l=(0,a.VK)((()=>t.permissionScopes.state),[t]);return(0,le.jsx)(B.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Separate start and end dates",id:"database.viewSettings.layoutTab.timelineUseSeparateDates.title"}),focused:!1,on:Boolean(i),onClick:()=>function(e,t){const o=t.normalizedQueryStore.state,n=t.collectionViewStore(),i=null==o?void 0:o.timeline_by,r=null==o?void 0:o.timeline_by_end;if(!i||!n)return;const a=r?void 0:i;M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleTimelineSeparateDatesClick",environment:e,perform:e=>{j.Es({collectionViewStore:n,update:{timeline_by_end:a??null},transaction:e})}}),x.wd({environment:e,collectionContextStore:t,action:"toggle_timeline_separate_dates"})}(o,t),disabled:!l.canConfigureBlock,textWrapperStyle:{opacity:1}})}function _e(e){let{collectionContextStore:t}=e;window.__c={n:"CalendarViewRangeSettingComponent"};const o=(0,r.O7)(),i=(0,a.VK)((()=>t.permissionScopes.state),[t]),l=(0,a.VK)((()=>function(e){const t=e.normalizedFormatStore.state;return(null==t?void 0:t.calendar_view_range)||"month"}(t)),[t]),s=(0,a.VK)((()=>"peekModeFormat"===t.settingsStore.state.openButtonPopup),[t]),c=(0,n.useMemo)((()=>["month","week"].map((e=>({key:e,title:D.default.formatMessage(R.Lh[e])})))),[]);return(0,le.jsx)(ie.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Show calendar as",id:"database.viewSettings.layoutTab.showCalendarAs.title"}),collectionContextStore:t,openButtonPopup:s,selectedKey:l,popupStyle:{minWidth:190},options:c,onChange:e=>we(e,o,t),disabled:!i.canConfigureBlock})}function Ae(e){let{collectionContextStore:t}=e;window.__c={n:"PeekModeSetting"};const o=(0,l.Fg)(),n=(0,r.O7)(),i=(0,a.VK)((()=>t.permissionScopes.state),[t]),s=(0,a.VK)((()=>function(e){const t=e.normalizedFormatStore.state,o=pe(e);return(null==t?void 0:t.collection_peek_mode)||z.Ls[o]}(t)),[t]),d=(0,a.VK)((()=>"peekModeFormat"===t.settingsStore.state.openButtonPopup),[t]),u=(0,a.VK)((()=>pe(t)),[t]);return(0,le.jsx)(ie.Z,{title:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Open pages in",id:"database.viewSettings.layoutTab.peekModeTitle"}),collectionContextStore:t,openButtonPopup:d,selectedKey:s,popupStyle:{minWidth:190},options:ce({currentViewType:u,theme:o}),menuItemOptionsStyle:{paddingTop:8,paddingBottom:8},onClick:()=>function(e,t){x.nS({environment:e,collectionContextStore:t,from:"collection_view_settings"})}(n,t),onChange:e=>function(e,t,o){const n=o.collectionViewStore();if(n&&e&&(M.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handlePeekModeFormatClick",environment:t,perform:t=>{b.FH({stores:[n],update:{collection_peek_mode:e},transaction:t})}}),x.gl({environment:t,collectionContextStore:o,peek_mode:e,from:"collection_view_settings"}),te.default.state.open&&te.default.state.collectionContextStore===o)){const{mainEditorCurrentBlockStore:o}=Q.default.state,n="full_page"===e?(0,q.ZP)({store:te.default.state.target,fullyQualified:!1,pageVisitSource:c.tY.Expand}):(0,_.mb)({store:te.default.state.target,mainEditorCurrentBlockStore:o,collectionContextStore:te.default.state.collectionContextStore,fullyQualified:!1,overridePeekMode:(0,te.getPeekModeFromCollectionPeekModeFormat)(e)});n&&w.c4({environment:t,url:n})}}(e,n,t),disabled:!i.canConfigureBlock})}function Te(e){let{collectionContextStore:t}=e;window.__c={n:"ShowPageIconSetting"};const o=(0,r.O7)(),i=(0,a.VK)((()=>t.shouldShowPageIcon()??!0),[t]),l=(0,n.useCallback)((()=>{const e=t.collectionViewStore();e&&(M.createAndCommit({userAction:"CollectionSettingsProperty.TitleOptions.handleToggleShowIcon",environment:o,perform:t=>{b.FH({stores:[e],update:{show_page_icon:!i},transaction:t})}}),x.wd({environment:o,collectionContextStore:t,action:"toggle_show_page_icon"}))}),[t,o,i]);return(0,le.jsx)(ne.Z,{title:(0,le.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,le.jsx)(S.FormattedMessage,{defaultMessage:"Show page icon",id:"database.viewSettings.layoutTab.showPageIcon.title"})}),showChevron:!1,right:(0,le.jsx)(K.Z,{on:i,onClick:l,noColor:!1}),onClick:l})}function Pe(e,t,o){const n=o.normalizedSchemaStore.state;let i=Object.keys(n);i=y.MR(i,(e=>{const t=n[e];return t?t.name:""}));const r=y.oA(i.map((o=>{const i=n[o];if(i&&"file"===i.type){return{key:{type:"property",property:o},title:i.name,icon:(0,le.jsx)(p.ZP,{type:i.type,icon:i.icon,size:e.device.isMobile?16:14,theme:t,style:{fill:t.regularIconColor}})}}})));return[...[void 0,{type:"page_cover"},{type:"page_content"}].map((e=>({key:e,title:N(e)}))),...r]}},8306:(e,t,o)=>{o.d(t,{N:()=>ne,Z:()=>ie});var n=o(43261),i=o.n(n),r=(o(67294),o(83355)),a=o(480),l=o(86628),s=o(49085),c=o(99036),d=o(80951),u=o(12396),p=o(6695),m=o(5257),g=o(39132),y=o(61061),h=o(47453),f=o(37612),S=o(72126),v=o(97880),x=o(82990),C=o(9291),b=o(8406),w=o(5149),k=o(87085),M=o(96802),j=o(82530),_=o(75330),A=o(73657),T=o(54119),P=o(52275),V=o(79131),I=o(5145),F=o(73063),Z=o(68894),K=o(32163),B=o(89728),O=o(72495),R=o(86825),D=o(26388),W=o(66957),E=o(65183),N=o(68641),L=o(43224),H=o(65742),U=o(19124),z=o(33929),$=o(98742),q=o(18514),G=o(4023),Y=o(29798),Q=o(73590),X=o(97372),J=o(94166),ee=o(85893);const te=(0,C.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertiesTab.inputPlaceholder"},toggleFrozenColumnsAriaLabel:{defaultMessage:"Toggle frozen columns",id:"database.viewSettings.propertiesTab.toggleFrozenColumnsAriaLabel"},togglePropertyVisibilityAriaLabel:{defaultMessage:"Toggle property visibility",id:"database.viewSettings.propertiesTab.togglePropertyVisibilityAriaLabel"}});class oe extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:s.default.createClass(""),menuListStore:Y.Z},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTabChange=e=>function(e,t,o,n,i){b.wd({environment:t,collectionContextStore:n,action:0===e?"click_properties_tab_timeline":"click_properties_tab_table"}),w.FK({collectionSettingsStore:o,item:{type:"properties",timelineViewTab:0===e?"timeline":"table"}}),ue(i)}(e,this.environment,this.props.collectionSettingsStore,this.props.collectionContextStore,this.stores.inputStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleShowTableClick=()=>{ue(this.stores.inputStore)}}renderComponent(){const{collectionContextStore:e,timelineViewTab:t}=this.props,{device:o}=this.environment,{inputStore:n,menuListStore:i}=this.stores,r=n.state,a=(0,N.WY)({collectionContextStore:e}),l=(0,N.jI)({timelineViewTab:t,collectionContextStore:e}),s=(0,H.d$)({environment:this.environment,isFullScreen:e.isFullScreen.state,isRootChild:e.isRootChild.state});return(0,ee.jsxs)(X.ZP,{...this.props,title:(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Properties",id:"database.viewSettings.propertiesTab.title"}),header:(0,ee.jsx)(O.Z,{children:(0,ee.jsx)(Z.ZP,{focusInitial:!o.isMobile,value:r,showClearButton:!0,onChange:e=>{n.setState(e.target.value),i.setState({...i.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:z.default.formatMessage(te.inputPlaceholder)})}),footer:(0,ee.jsx)(se,{collectionContextStore:this.props.collectionContextStore,timelineViewTab:this.props.timelineViewTab}),children:["timeline"===a&&s&&this.renderTimelineControls(),l&&this.renderPropertyFormatList(l),(0,ee.jsx)(O.Z,{children:(0,ee.jsx)(ce,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore,timelineViewTab:this.props.timelineViewTab})})]})}renderTimelineControls(){const{timelineViewTab:e,collectionContextStore:t}=this.props,o="timeline"===e?0:1;return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(W.Z,{tabs:[(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Timeline",id:"database.viewSettings.propertiesTab.timelineProperties"},"database.viewSettings.propertiesTab.timelineProperties"),(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Table",id:"database.viewSettings.propertiesTab.tableProperties"},"database.viewSettings.propertiesTab.tableProperties")],selectedIndex:o,onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTabChange}),"table"===e&&(0,ee.jsx)(O.Z,{children:(0,ee.jsx)(ne,{collectionContextStore:t,onClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleShowTableClick})})]})}renderPropertyFormatList(e){const{collectionContextStore:t}=this.props,o=t.permissionScopes.state,n=t.normalizedFormatStore.state,r=t.normalizedSchemaStore.state,{inputStore:a}=this.stores,l=a.state;let s=n[e]||[];if(l){let e=s.map((e=>{const t=(0,d.Qm)({schema:r,property:e.property});return null==t?void 0:t.name}));e=i().filter(l,e).map((e=>{let{original:t}=e;return t})),s=s.filter((t=>{const o=r[t.property];return o&&o.name&&e.includes(o.name)}))}const c=s.filter((e=>Boolean(e.visible))),u=s.filter((e=>!Boolean(e.visible))),p="timeline_table_properties"===e?"table":(0,N.WY)({collectionContextStore:t});return 0===s.length?(0,ee.jsx)(O.Z,{children:(0,ee.jsx)(A.Z,{caption:(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertiesTab.noResults"})})}):(0,ee.jsx)(K.Z,{type:K.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,sections:S.oA([c.length>0&&{key:"visible_and_hidden_properties",render:t=>(0,ee.jsx)(O.Z,{...t,noTextOverflow:!0,isTitleUppercase:!1,title:(0,ee.jsx)(re,{viewType:p}),desktopTitleStyle:{height:19},right:!l&&o.canConfigureBlock&&(0,ee.jsx)(B.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:()=>function(e,t,o){b.wd({environment:t,collectionContextStore:o,action:"click_hide_all_properties"}),le({formatKey:e,visibility:!1},o,t)}(e,this.environment,this.props.collectionContextStore),children:(0,ee.jsx)(C.FormattedMessage,{id:"database.viewSettings.propertiesTab.hideAllProperties",defaultMessage:"Hide all"})}),children:this.renderPropertySortList({formatKey:e,visibleProperties:c,hiddenProperties:u,children:t.children})}),items:S.oA([...this.renderPropertySortListItems({formatKey:e,properties:c}),u.length>0&&{key:"group-header-hidden-property",render:t=>this.renderHiddenPropertySectionHeader({props:t,formatKey:e,children:(0,ee.jsx)(ee.Fragment,{})}),action:()=>{}},...this.renderPropertySortListItems({formatKey:e,properties:u})])},0===c.length&&u.length>0&&{key:"hidden_properties",render:t=>this.renderHiddenPropertySectionHeader({props:t,formatKey:e,children:this.renderPropertySortList({formatKey:e,visibleProperties:c,hiddenProperties:u,children:t.children})}),items:this.renderPropertySortListItems({formatKey:e,properties:u})}])})}renderHiddenPropertySectionHeader(e){const{props:t,formatKey:o,children:n}=e,{collectionContextStore:i}=this.props,r=i.permissionScopes.state,{inputStore:a}=this.stores,l=a.state,s="timeline_table_properties"===o?"table":(0,N.WY)({collectionContextStore:i});return(0,ee.jsx)(O.Z,{...t,noTextOverflow:!0,isTitleUppercase:!1,title:(0,ee.jsx)(ae,{viewType:s}),desktopTitleStyle:{height:19},right:!l&&r.canConfigureBlock&&(0,ee.jsx)(B.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:()=>function(e,t,o){b.wd({environment:t,collectionContextStore:o,action:"click_show_all_properties"}),le({formatKey:e,visibility:!0},o,t)}(o,this.environment,this.props.collectionContextStore),children:(0,ee.jsx)(C.FormattedMessage,{id:"database.viewSettings.propertiesTab.showAllProperties",defaultMessage:"Show all"})}),style:{width:"100%",paddingBottom:0},children:n})}renderPropertySortList(e){const{formatKey:t,visibleProperties:o,hiddenProperties:n,children:i}=e,r=S.oA([...o.map((e=>e.property)),o.length>0&&n.length>0&&{key:"group-header-hidden-property",draggable:!1},...n.map((e=>e.property))]);return de(this.environment,this.props.collectionContextStore,this.stores.inputStore)?(0,ee.jsx)(V.ZP,{direction:"vertical",keys:r,renderKey:(e,t)=>i[t],onDrop:(e,o)=>{!function(e,t,o,n){const{formatKey:i,newPropertyKeys:r}=e,a=o.collectionViewStore();if(!a)return;const l=o.normalizedFormatStore.state[i]||[],s=r.indexOf("group-header-hidden-property"),c=S.oA(r.filter((e=>!e.startsWith("group-header-"))).map(((e,t)=>{const o=l.find((t=>t.property===e));if(o)return s>=0?{...o,visible:Boolean(t<s)}:o}))),d=l.filter((e=>!r.includes(e.property))),u=[...c,...d];j.createAndCommit({userAction:"CollectionSettingsViewProperties.handlePropertyReorder",environment:t,perform:e=>{M.FH({stores:[a],update:{[i]:u},transaction:e})}}),b.wd({environment:t,collectionContextStore:o,action:"reorder_properties",original_view_type:a.getType()}),n.reset()}({formatKey:t,newPropertyKeys:e},this.environment,this.props.collectionContextStore,this.stores.menuListStore)}}):i}renderPropertySortListItems(e){const{formatKey:t,properties:o}=e;return S.oA(o.map((e=>this.renderPropertySortListItem({formatKey:t,propertyFormat:e}))))}renderPropertySortListItem(e){const{formatKey:t,propertyFormat:o}=e,{collectionContextStore:n}=this.props,i=n.permissionScopes.state,r=!o.visible,a=n.normalizedSchemaStore.state,l=(0,d.Qm)({schema:a,property:o.property}),s="title"!==o.property||function(e,t){const o=t.normalizedFormatStore.state,n=(0,N.WY)({collectionContextStore:t});if("board"===n)return(0,p.Lw)(o.board_cover);if("gallery"===n)return(0,p.Lw)(o.gallery_cover);if("timeline"===n)return"timeline_table_properties"===e||(0,p.vP)(Boolean(o.timeline_show_table),o.timeline_table_properties||[]);return!1}(t,this.props.collectionContextStore);let h=!i.canConfigureCollection||i.isSyncedCollection&&((0,d.wl)(o.property)||(0,c.HF)(o.property));if("collectionTypedView"===n.contextType&&i.canConfigureBlock&&(h=!1),!l)return;const{theme:f}=this;return{key:o.property,render:e=>{var n;return(0,ee.jsx)(D.ZP,{disableTooltip:!(null!==(n=l.description)&&void 0!==n&&n.length),renderTooltip:e=>(0,ee.jsxs)("div",{...e,style:L.F6,children:[(0,ee.jsx)("div",{children:l.name}),void 0!==(null==l?void 0:l.description)&&l.description.length>0?(0,ee.jsx)("div",{style:{color:this.theme.mediumInvertedTextColor},children:l.description}):null]}),placement:G.u.Left,render:n=>(0,ee.jsx)(P.Z,{...(0,$.Z)(e,n),title:(0,ee.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[de(this.environment,this.props.collectionContextStore,this.stores.inputStore)&&(0,ee.jsx)(I.ZP,{iconSize:12,style:{marginRight:8}}),(0,ee.jsx)(u.ZP,{type:l.type,icon:l.icon,size:16,theme:f,style:{fill:f.regularIconColor}}),(0,ee.jsx)("span",{style:{marginLeft:8,...x.Z.textOverflowStyle},children:l.name}),(0,c.qQ)(l)&&(0,c.q3)(l)&&("text"===l.type||(0,U.KZ)())&&(0,ee.jsx)(T.Z,{})]}),right:(0,ee.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,ee.jsx)(F.Z,{icon:r?y.B:g.c,iconStyle:{width:16,height:16},isDarkIconColor:!r,onClick:()=>{!function(e,t,o,n){var i;const{formatKey:r,propertyFormat:a}=e,l=o.collectionViewStore();if(!l)return;const s=o.normalizedFormatStore.state,c=s[r]||[],d=c.filter((e=>e.property!==a.property)),u=d.filter((e=>e.visible)),p=d.filter((e=>!e.visible)),m={...a,visible:!a.visible},g=[...u,m,...p],y={...s,[r]:g};j.createAndCommit({userAction:"CollectionSettingsViewProperties.handleTogglePropertyVisibility",environment:t,perform:e=>{_.iG({collectionViewStore:l,update:{format:y},transaction:e})}}),b.wd({environment:t,collectionContextStore:o,action:"toggle_property_visibility",original_view_type:l.getType(),property_type:null===(i=l.getCollectionStore())||void 0===i||null===(i=i.getSchema()[m.property])||void 0===i?void 0:i.type}),ue(n)}({formatKey:t,propertyFormat:o},this.environment,this.props.collectionContextStore,this.stores.inputStore)},ariaLabel:this.props.intl.formatMessage(te.togglePropertyVisibilityAriaLabel),disabled:!s||!i.canConfigureBlock}),!h&&(0,m.o)({width:12,fill:f.lightTextColor,marginLeft:5})]})})})},action:()=>{h||function(e,t,o,n){var i,r,a;const l=(null===(i=n.collectionStore())||void 0===i?void 0:i.getSchema())||n.normalizedSchemaStore.state||{},{formatKey:s,propertyFormat:c}=e;b.wd({environment:t,collectionContextStore:n,action:"click_property",original_view_type:null==n||null===(r=n.collectionViewStore())||void 0===r?void 0:r.getType(),property_type:null===(a=l[c.property])||void 0===a?void 0:a.type}),w.H4({collectionSettingsStore:o,item:{type:"property",formatKey:s,property:c.property}})}({formatKey:t,propertyFormat:o},this.environment,this.props.collectionSettingsStore,this.props.collectionContextStore)}}}}function ne(e){window.__c={n:"TimelineShowTableSwitcher"};const{collectionContextStore:t,onClick:o}=e,n=(0,a.O7)(),i=(0,l.Kw)(t.normalizedFormatStore),r=Boolean(i.timeline_show_table),s=(0,l.Kw)(t.permissionScopes);return(0,ee.jsx)(R.Z,{title:(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Show table",id:"database.viewSettings.propertiesTab.showTable"}),on:r,focused:!1,onClick:()=>{const e=t.collectionViewStore();e&&(j.createAndCommit({userAction:"CollectionSettingsViewProperties.TimelineShowTableSwitcher",environment:n,perform:t=>{M.FH({stores:[e],update:{timeline_show_table:!r,timeline_table_properties:[{property:"name",visible:!0}]},transaction:t})}}),null==o||o(),b.wd({environment:n,collectionContextStore:t,action:"timeline_toggle_show_table"}))},disabled:!s.canConfigureBlock,textWrapperStyle:{opacity:1}})}oe.displayName="CollectionSettingsViewProperties";const ie=(0,C.injectIntl)(oe);function re(e){let{viewType:t}=e;return"table"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Shown in table",id:"database.viewSettings.propertiesTab.shownInTableTitle"}):"timeline"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Shown in timeline",id:"database.viewSettings.propertiesTab.shownInTimelineTitle"}):"board"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Shown in board",id:"database.viewSettings.propertiesTab.shownInBoardTitle"}):"list"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Shown in list",id:"database.viewSettings.propertiesTab.shownInListTitle"}):"gallery"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Shown in gallery",id:"database.viewSettings.propertiesTab.shownInGalleryTitle"}):"calendar"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Shown in calendar",id:"database.viewSettings.propertiesTab.shownInCalendarTitle"}):"page"===t||"chart"===t?null:void(0,v.t1)(t)}function ae(e){let{viewType:t}=e;return"table"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Hidden in table",id:"database.viewSettings.propertiesTab.hiddenInTableTitle"}):"timeline"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Hidden in timeline",id:"database.viewSettings.propertiesTab.hiddenInTimelineTitle"}):"board"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Hidden in board",id:"database.viewSettings.propertiesTab.hiddenInBoardTitle"}):"list"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Hidden in list",id:"database.viewSettings.propertiesTab.hiddenInListTitle"}):"gallery"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Hidden in gallery",id:"database.viewSettings.propertiesTab.hiddenInGalleryTitle"}):"calendar"===t?(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Hidden in calendar",id:"database.viewSettings.propertiesTab.hiddenInCalendarTitle"}):"page"===t||"chart"===t?null:void(0,v.t1)(t)}function le(e,t,o){const{formatKey:n,visibility:i}=e,r=t.collectionViewStore();if(!r)return;const a=t.normalizedFormatStore.state[n]||[],l=a.filter((e=>Boolean(e.visible))),s=a.filter((e=>!Boolean(e.visible))),c=[...l.map((e=>({...e,visible:i}))),...s.map((e=>({...e,visible:i})))];j.createAndCommit({userAction:"CollectionSettingsViewProperties.setAllPropertiesVisibility",environment:o,perform:e=>{M.FH({stores:[r],update:{[n]:c},transaction:e})}})}function se(e){let{collectionContextStore:t,timelineViewTab:o}=e;window.__c={n:"FooterComponent"};const n=(0,a.O7)(),i=(0,l.VK)((()=>t.permissionScopes.state),[t]),r=(0,l.VK)((()=>"timeline"===(0,N.WY)({collectionContextStore:t})&&"table"===o&&!(0,N.vw)({collectionContextStore:t})),[t,o]),s=i.canConfigureCollection&&!r;return(0,ee.jsxs)(O.Z,{topBorder:!0,children:[s&&(0,ee.jsx)(J.Z,{icon:h.R,title:(0,ee.jsx)(C.FormattedMessage,{id:"database.viewSettings.propertiesTab.newProperty",defaultMessage:"New property"}),isGray:!0,onClick:()=>function(e,t){const o=t.collectionStore();o&&(b.wd({environment:e,collectionContextStore:t,action:"click_new_property"}),w.wl({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",propertyTypes:(0,E.TP)({isSyncedCollection:o.isSyncedCollection(),collectionContextStore:t,environment:e}),onAccept:(o,n,i,r)=>{k.PW({environment:e,propertyType:o,isSuggestedProperty:n,propertyName:i,selectOptions:r,collectionContextStore:t,from:"view_settings"})}}}))}(n,t)}),(0,ee.jsx)(Q.Z,{href:(0,q.UY)("guides.databaseProperties"),title:(0,ee.jsx)(C.FormattedMessage,{defaultMessage:"Learn about properties",id:"database.viewSettings.propertiesTab.learnMoreButton.title"}),analyticsFrom:"view_settings_properties"})]})}function ce(e){let{collectionContextStore:t,collectionSettingsStore:o,timelineViewTab:n}=e;window.__c={n:"DeletedPropertiesComponent"};const i=(0,a.O7)(),r=(0,l.VK)((()=>t.normalizedDeletedSchemaStore.state),[t]),s=Object.keys(r).length;return(0,l.VK)((()=>t.permissionScopes.state),[t]).canConfigureCollection&&s>0?(0,ee.jsx)(J.Z,{icon:f.y,title:(0,ee.jsx)(C.FormattedMessage,{id:"database.viewSettings.propertiesTab.deletedProperties",defaultMessage:"Deleted properties"}),isGray:!0,onClick:()=>function(e,t,o,n){o.collectionStore()&&(b.wd({environment:e,collectionContextStore:o,action:"click_deleted_properties"}),w.H4({collectionSettingsStore:t,item:{type:"deletedProperties",timelineViewTab:n}}))}(i,o,t,n),right:s,showChevron:!0}):null}function de(e,t,o){const n=o.state,i=t.permissionScopes.state;return!e.device.isMobile&&i.canConfigureBlock&&!n}function ue(e){e.reset()}},68155:(e,t,o)=>{o.d(t,{Z:()=>l});o(67294);var n=o(9291),i=o(62896),r=o(10906),a=o(85893);const l=function(e){let{collectionViewName:t,collectionViewType:o}=e;return t?(0,a.jsx)(i.Z,{children:t}):"page"===o?(0,a.jsx)(n.FormattedMessage,{id:"database.collectionView.untitledName.untitled",defaultMessage:"Untitled"}):(0,a.jsx)(n.FormattedMessage,{...r.b1[o]})}},40071:(e,t,o)=>{o.d(t,{Z:()=>ee});var n=o(94184),i=o.n(n),r=(o(67294),o(83355)),a=o(15145),l=o(88437),s=o(39132),c=o(18557),d=o(53470),u=o(37612),p=o(72126),m=o(9291),g=o(81193),y=o(98834),h=o(47307),f=o(96802),S=o(3992),v=o(8055),x=o(82530),C=o(68155),b=o(66890),w=o(66213),k=o(28651),M=o(19037),j=o(97978),_=o(43250),A=o(84210),T=o(33929),P=o(87279),V=o(98742),I=o(25498),F=o(77907),Z=o(17031),K=o(80444),B=o(61766),O=o(77080),R=o(96049),D=o(79797),W=o(24736),E=o(93405),N=o(31945),L=o(78140),H=o(32163),U=o(53437),z=o(31278),$=o(76798),q=o(72495),G=o(26388),Y=o(34574),Q=o(85893);const X=(0,m.defineMessages)({emptyPageTitle:{defaultMessage:"Empty",id:"database.templatePicker.emptyPageTitle"}});class J extends r.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:k.Z,buttonPopupStore:B.Z},this.renderActionMenuPopup=e=>{const{device:t}=this.environment,{templateStore:o}=this.props,n=!!o&&(0,M.J5)({environment:this.environment,blocks:[o],publicEditMode:void 0}),i=o?D.Mz.fromBlockStore(o):void 0,r=null!=i&&i.isActive()?null==i?void 0:i.getRecurrence():void 0,a={key:"section",render:e=>(0,Q.jsx)(q.Z,{...e}),items:p.oA([this.props.templateStore&&!this.canEditContentOnly.state&&n&&(!i||(null==i?void 0:i.isReady()))&&{key:"repeatControl",render:(e,t)=>o&&(0,Q.jsx)(F.LazyRecurrenceConfigMenu,{...e,recurrence:r,onChange:e=>{e?S.addRecurrence({environment:this.environment,blockStore:o,recurrence:e}):S.disableRecurrence({environment:this.environment,blockStore:o})},disabled:this.cannotEditRecurrence.state}),action:()=>function(e,t){j.j(e,"recurrence_menu_open",{isConfigured:void 0!==t})}(this.environment,this.props.recurrence)},this.props.isOverlay&&!this.canEditContentOnly.state&&{key:"Set default",render:e=>(0,Q.jsx)(E.Z,{...e,title:(0,Q.jsx)(m.FormattedMessage,{defaultMessage:"Set as default",id:"database.collectionTemplatePickerItem.actionMenu.setAsDefault"}),svg:c.z}),action:()=>this.handleSetAsDefault(e)},this.props.templateStore&&{key:"Edit",render:e=>(0,Q.jsx)(E.Z,{...e,title:n?(0,Q.jsx)(m.FormattedMessage,{defaultMessage:"Edit",id:"database.templatePickerItem.actionMenu.edit"}):(0,Q.jsx)(m.FormattedMessage,{defaultMessage:"View",id:"database.templatePickerItem.actionMenu.view"}),svg:n?d.H:s.c}),action:this.handleEdit},this.props.templateStore&&!this.canEditContentOnly.state&&n&&{key:"Duplicate",render:e=>(0,Q.jsx)(E.Z,{...e,title:(0,Q.jsx)(m.FormattedMessage,{defaultMessage:"Duplicate",id:"database.templatePickerItem.actionMenu.duplicate"}),svg:l.a}),action:this.handleDuplicate},this.props.templateStore&&!this.canEditContentOnly.state&&n&&{key:"Delete",render:e=>(0,Q.jsx)(E.Z,{...e,title:(0,Q.jsx)(m.FormattedMessage,{defaultMessage:"Delete",id:"database.templatePickerItem.actionMenu.delete"}),svg:u.y}),action:n?()=>async function(e,t,o){if(!o)return;if(!(await h.confirmUserAction({message:(0,Q.jsx)(m.FormattedMessage,{defaultMessage:"Are you sure you would like to delete this template?",id:"database.confirmDialog.templatePickerItem.deleteMessage"}),acceptLabel:(0,Q.jsx)(m.FormattedMessage,{defaultMessage:"Delete",id:"database.confirmDialog.templatePickerItem.deleteButton.label"})})))return;x.createAndCommit({userAction:"CollectionTemplatePickerItem.handleDelete",environment:e,perform:e=>y.R5({collectionStore:t,templateStore:o,transaction:e})}),g.sY(e,{template_action:"delete"})}(this.environment,this.props.collectionStore,this.props.templateStore):()=>{}}])};let f;return f=t.isMobile?{menuType:P.og.ActionSheet}:{menuType:P.og.Popup,width:230},(0,Q.jsx)(L.Z,{...f,children:(0,Q.jsx)(H.Z,{type:H.i.Vertical,initialFocus:void 0,sections:[a]})})},this.handleEdit=()=>{var e,t;const{buttonPopupStore:o}=this.stores;this.props.templateStore&&(null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t),this.navigateToBlock(this.props.templateStore),o.reset(),g.sY(this.environment,{template_action:"edit"}))},this.handleDuplicate=()=>{var e,t;const{buttonPopupStore:o}=this.stores,{templateStore:n,collectionStore:i}=this.props;if(!n)return;null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t);const{performResult:r}=x.createAndCommit({userAction:"CollectionTemplatePickerItem.duplicatedStore",environment:this.environment,perform:e=>{const t=y.Zh({environment:this.environment,collectionStore:i,templateStore:n,transaction:e});if(n.getAutomationId()){const o=D.Mz.fromBlockStore(n),i=null==o?void 0:o.getRecurrence();o&&null!=o&&o.isActive()&&i&&S.createRecurrenceInner(e,this.environment,t,i)}return t}});r&&this.navigateToBlock(r),o.reset(),g.sY(this.environment,{template_action:"duplicate"})},this.handleSetAsDefault=e=>{var t,o;const{collectionContextStore:n}=this.context,i=null==n?void 0:n.collectionStore(),r=null==n?void 0:n.collectionViewStore();if(!i||null==r||!r.isDefined())return;const a=null!==(t=this.props.templateStore)&&void 0!==t&&t.id?{template_page_id:null===(o=this.props.templateStore)||void 0===o?void 0:o.id}:"empty";h.showDialog({showCancel:!0,keepFocus:!1,message:(0,Q.jsx)(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.message",defaultMessage:"<span>Use “{pageName}” as default template when creating new pages?</span>",values:{span:e=>(0,Q.jsx)("span",{children:e}),pageName:this.props.templateStore?(0,Q.jsx)($.Z,{store:this.props.templateStore,style:{display:"inline"}}):T.default.formatMessage(X.emptyPageTitle)}}),items:[{label:(0,Q.jsx)(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.setCollection",defaultMessage:"For all views in “{databaseName}”",values:{databaseName:(0,Q.jsx)($.Z,{store:i,style:{display:"inline"}})}}),onAccept:()=>{e.close(),x.createAndCommit({environment:this.environment,userAction:"CollectionTemplatePickerItem.handleSetAsDefault:collection",perform:e=>{f.FH({stores:[i],update:{collection_default_template:a},transaction:e}),f.FH({stores:[r],update:{collection_view_default_template:a},transaction:e})}})}},{label:(0,Q.jsx)(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.setCollectionView",defaultMessage:"Only on “{viewName}” view",values:{viewName:(0,Q.jsx)(C.Z,{collectionViewName:r.getName(),collectionViewType:r.getType()})}}),onAccept:()=>{e.close(),x.createAndCommit({environment:this.environment,userAction:"CollectionTemplatePickerItem.handleSetAsDefault:collectionView",perform:e=>{f.FH({stores:[r],update:{collection_view_default_template:a},transaction:e})}})}}]})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=()=>{return e=this.stores.mouseStore,void(R.Z.state||e.setState({...e.state,mouseEntered:!0}));var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave=()=>{var e;(e=this.stores.mouseStore).setState({...e.state,mouseEntered:!1})},this.getRecordModel=this.props.collectionStore.getRecordModel,this.canEditContentOnly=this.createComputedStore((()=>{var e;return Boolean(null===(e=this.props.collectionStore.getParentBlockStore())||void 0===e?void 0:e.canEditContentOnly())})),this.cannotEditRecurrence=this.createComputedStore((()=>{if(!O.default.checkGate("recurrence_queue_task_improvements"))return!1;if(!this.props.templateStore)return!1;const e=(0,I.w)(this.props.templateStore);return!e.automationStoresReady||e.violatesConstraint}))}get registries(){return[Z.Z]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):v.c4({environment:this.environment,url:e})}renderComponent(){var e;const{device:t}=this.environment,{templateStore:o,isMobile:n,isOverlay:i,focused:r,locked:a,canConfigureCollection:l,draggable:s}=this.props,{mouseStore:c,buttonPopupStore:d}=this.stores,u=!o&&!i,p=(!a||a&&!s)&&(l||this.canEditContentOnly.state)&&(c.state.mouseEntered||d.state.open||n||i)&&!u,m=o?(0,Q.jsx)($.Z,{store:o}):T.default.formatMessage(X.emptyPageTitle),g=null==o||null===(e=o.getModel())||void 0===e?void 0:e.getRenderIcon({getRecordModel:this.getRecordModel});return(0,Q.jsx)(Y.Z,{className:_.$ji,type:o?"custom_template":"empty_page",format:i?"collection-overlay":"page-menu-item",locked:a||!l||!s,icon:(0,Q.jsx)(z.Z,{disabled:!0,icon:g,isEmptyPage:(null==o?void 0:o.isEmptyPage())??!0,size:t.isMobile&&i?24:20,isLarge:!i,style:{...!i&&{pointerEvents:"none",marginRight:10}},pageIconStyle:{...!i&&{fill:this.theme.lightIconColor}}}),title:m,onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,right:p&&this.renderActionMenuButton(),onMouseMove:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,onMouseLeave:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave,focused:r,isDefault:this.props.isDefault,recurrence:this.props.recurrence})}renderActionMenuButton(){const{isMobile:e,isOverlay:t}=this.props,{buttonPopupStore:o}=this.stores,n=!!this.props.templateStore&&(0,M.J5)({environment:this.environment,blocks:[this.props.templateStore],publicEditMode:void 0});return(0,Q.jsx)(G.ZP,{renderTooltip:()=>n?(0,Q.jsx)(m.FormattedMessage,{defaultMessage:"Edit this template",id:"database.templatePickerItem.editTemplate.tooltip"}):(0,Q.jsx)(m.FormattedMessage,{defaultMessage:"View this template",id:"database.templatePickerItem.viewTemplate.tooltip"}),delayThreshold:300,render:n=>(0,Q.jsx)(N.ZP,{popupType:e?U.ZP.PopupType.SlideUp:U.ZP.PopupType.Popup,placementToOrigin:N.pO.Right,originGap:12,buttonPopupStore:o,renderOrigin:o=>(0,Q.jsx)(W.Z,{className:i()(_.C_N,{[_.JiD]:e||t}),isMobile:e&&t,style:{...!t&&{marginRight:0}},...(0,V.Z)(n,o)}),render:this.renderActionMenuPopup,onClick:()=>{g.sY(this.environment,{template_action:"open_menu"})}})})}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=K.default.state,o=t?(0,A.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:a.tY.PeekOpen}):(0,A.ZP)({store:e,fullyQualified:!1,pageVisitSource:a.tY.LinkInPage});this.navigate(o)}}J.displayName="CollectionTemplatePickerItem",J.contextTypes={...r.w,...w.wK,...b.xm};const ee=J},34574:(e,t,o)=>{o.d(t,{Z:()=>h});o(67294);var n=o(83355),i=o(480),r=o(24405),a=o(49271),l=o(8848),s=o(53523),c=o(82990),d=o(9291),u=o(19124),p=o(64921),m=o(52275),g=o(85893);class y extends n.Z{constructor(){super(...arguments),this.completionsEnabledStore=this.createComputedStore((()=>{var e;const t=null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state;return(0,u.GD)(t)}))}renderComponent(){return"collection-overlay"===this.props.format?(0,g.jsx)(S,{className:this.props.className,icon:this.props.icon,format:this.props.format,title:this.props.title,isDefault:this.props.isDefault,recurrence:this.props.recurrence,right:this.props.right,focused:this.props.focused,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,locked:this.props.locked,type:this.props.type}):"phone-modal"===this.props.format?(0,g.jsx)(v,{icon:this.props.icon,format:this.props.format,title:this.props.title,isDefault:this.props.isDefault,recurrence:this.props.recurrence,focused:this.props.focused,onClick:this.props.onClick}):this.renderPageMenuItem()}renderPageMenuItem(){return(0,g.jsxs)(p.Z,{style:x(this.environment,this.theme,this.completionsEnabledStore),hovered:this.props.focused,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,hoveredStyle:{background:this.theme.buttonHoveredBackground,color:this.theme.regularTextColor},pressedStyle:{background:this.theme.buttonPressedBackground},children:[(0,g.jsx)("div",{style:{display:"flex",alignItems:"center",width:24,height:24,marginRight:10},children:this.props.icon}),(0,g.jsx)(f,{format:this.props.format,title:this.props.title,isDefault:this.props.isDefault,recurrence:this.props.recurrence}),this.props.right&&(0,g.jsx)("div",{style:{marginLeft:"auto",marginRight:4},children:this.props.right})]})}}y.displayName="TemplatePickerMenuItem";const h=y;function f(e){let{format:t,title:o,isDefault:n,recurrence:i}=e;window.__c={n:"TitleComponent"};const a=(0,r.Fg)();return"collection-overlay"!==t?(0,g.jsx)(g.Fragment,{children:o}):(0,g.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o,(0,g.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n&&(0,g.jsx)("span",{style:{fontSize:12,fontWeight:c.Z.fontWeight.medium,color:a.mediumTextColor},children:(0,g.jsx)(d.FormattedMessage,{defaultMessage:"DEFAULT",id:"database.templatePickerMenuItem.default"})}),i&&(0,s.N)({width:14,color:l.ZP.blue,marginLeft:8})]})]})}function S(e){let{className:t,icon:o,format:n,title:r,isDefault:a,recurrence:l,right:s,focused:c,onClick:d,onMouseMove:u,onMouseEnter:p,onMouseLeave:y,locked:h,type:S}=e;window.__c={n:"CollectionOverlayMenuItemComponent"};const v=(0,i.O7)(),{device:x}=v;return(0,g.jsx)(m.Z,{className:t,icon:o,title:(0,g.jsx)(f,{format:n,title:r,isDefault:a,recurrence:l}),right:s,focused:c,onClick:d,onMouseMove:u,onMouseEnter:p,onMouseLeave:y,showDragHandle:!x.isMobile&&!h,dragHandleDisabled:"empty_page"===S})}function v(e){let{icon:t,format:o,title:n,isDefault:i,recurrence:r,focused:a,onClick:l}=e;return(0,g.jsx)(m.Z,{icon:t,title:(0,g.jsx)(f,{format:o,title:n,isDefault:i,recurrence:r}),focused:a,onClick:l,showDragHandle:!1})}function x(e,t,o){const{device:n}=e;return{...a.ZD,display:"flex",alignItems:"center",flexGrow:1,height:n.isMobile?36:32,fontSize:16,borderRadius:4,paddingLeft:8,marginBottom:2,color:o.state?t.mediumTextColor:t.lightTextColor}}},72865:(e,t,o)=>{o.d(t,{D:()=>y});var n=o(67294),i=o(480),r=o(24405),a=o(20852),l=o(993),s=o(82530),c=o(43250),d=o(68657),u=o(24666),p=o(28385),m=o(65187),g=o(85893);function y(e){window.__c={n:"SimpleFormulaValueTextInput"};const{value:t,disabled:o,onChange:y,multiline:h,placeholder:f,disableFormattingAndMentions:S,disableMobileActionBar:v,disableEmojiCommands:x,disableTemplateVariableMentions:C,code:b}=e,w=(0,i.O7)(),k=(0,r.yK)((e=>({wrap:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,borderRadius:4,padding:h?"6px 10px":"4px 8px",overflow:"hidden",..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},text:h?{minHeight:60}:{whiteSpace:"pre"},placeholder:h?{minHeight:60}:{}})),[h]),M=(0,n.useCallback)((e=>{y({type:"simple",value:e})}),[y]),{store:j}=(0,d.Cl)({initialValue:null==t?void 0:t.value,onChange:M}),_=(0,n.useMemo)((()=>h?()=>{const e=u.default.state;"editing"===e.mode&&s.createAndCommit({userAction:"SimpleFormulaValueTextInput.handleEnter",environment:w,perform:t=>{l.hJ({environment:w,string:"\n",multiSelection:e.multiSelection,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}})}:void 0),[w,h]);return b?(0,g.jsx)("div",{style:k.wrap,className:c.Wh_,children:(0,g.jsx)(p.Z,{disabled:o,store:j,language:a.PrismLanguages.jsx,blockStore:void 0,codeWrap:!1,isQuickFind:!1,parentSpaceId:"",style:{padding:0}})}):(0,g.jsx)("div",{style:k.wrap,className:c.Wh_,children:(0,g.jsx)(m.Z,{placeholder:f,disabled:o,store:j,style:k.text,placeholderStyle:k.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:x,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,onEnter:_,disableMobileActionBar:v,disableTemplateVariableMentions:C,...S?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableFilters:!0}:{}})})}},53498:(e,t,o)=>{o.d(t,{a:()=>be,K:()=>M});var n=o(67294),i=o(480),r=o(86628),a=o(66897),l=o(99036),s=o(80951),c=o(84619),d=o(35102),u=o(76218),p=o(149),m=o(19889),g=o(70203),y=o(97880),h=o(37867),f=o(60458),S=o(92864),v=o(89845),x=o(25845),C=o(22084),b=o(21396),w=o(75311),k=o(85893);function M(e){window.__c={n:"ValuePickerMenuToken"};const{token:t,contextStore:o,disabled:n,setCurrentTokens:M,currentSimpleFormulaValueTokens:j,context:_}=e,A=(0,i.Fy)(),T=(0,r.Kw)(o.compilationResultStore),P=(0,r.VK)((()=>{if((0,u.S3)(t)&&(0,g.IWo)(t)){const e=(0,g.zEN)(t);if(e)return(0,a.Hl)({pointer:{table:m.KJ,id:e},getRecordValue:o.context.parentRecordStore.getRecordValue})}}),[o.context.parentRecordStore,t]),V=(0,r.VK)((()=>(0,w._)(_)),[_]),I=(0,r.VK)((()=>_.collectionStore.getSchema()[_.property]),[_]);if("string"==typeof t){if(!I||!(0,l.t)(I))return null;const e=(0,s.i7)((null==I?void 0:I.options)??[],t);if(!e)return(0,k.jsx)(h.Z,{isSingle:!1,showRemoveButton:!n,onClickRemove:()=>{null==M||M((0,u.Ck)(j,t))}},`deleted_option_value_${t}`);const o={value:e.value,color:e.color,isSingle:!1,showRemoveButton:!n,format:A.isMobile?c.lo.Medium:c.lo.Small,onClickRemove:()=>{null==M||M((0,u.Ck)(j,t))}};if((0,l.gB)(I)){var F;const t=null===(F=I.groups)||void 0===F||null===(F=F.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)})))||void 0===F?void 0:F.color;return(0,k.jsx)(C.F,{...o,groupColor:t})}return(0,k.jsx)(C.a,{...o})}if("boolean"==typeof t)return(0,k.jsx)(f.Z,{checked:t,disabled:!0,size:16,checkSize:12,style:{marginBottom:6}},t.toString());if((0,g.IWo)(t))return null!=P&&P.asActor?(0,k.jsx)(S.ZP,{actor:P,format:A.isMobile?S.ZP.Format.Medium:S.ZP.Format.Small,showRemoveButton:!n,onClickRemove:()=>{null==M||M((0,u.Ck)(j,t))},shouldShrink:!0,isSingle:!1},P.id):null;if((0,g.wjk)(t)){const e=(0,g.vmO)(t).id,o=p.x.isSuccess(T)?(0,d.vx)(T.value.valueTypes,e):void 0;return o?(0,k.jsx)(b.F,{value:o,format:c.lo.Small,isSingle:!1,shouldShrink:!0,showRemoveButton:!n,onClickRemove:()=>{null==M||M((0,u.Ck)(j,t))}}):null}if((0,g.fpG)(t)){const e=j[0],t=e&&(0,u.S3)(e)&&(0,g.fpG)(e)?(0,g.zyO)(e):void 0;return t?(0,k.jsx)(v.Z,{value:t,dateFormat:V.dateFormat,timeFormat:V.timeFormat,style:{marginBottom:6}}):null}if((0,g.STW)(t)){const e=(0,g.TOT)(t);return e?(0,k.jsx)(x.Z,{format:A.isMobile?c.lo.Medium:c.lo.Small,blockId:e,shouldWrap:!1,shouldShrink:!0,isSingle:!1,parentStore:o.context.parentRecordStore,showRemoveButton:!n,onClickRemove:()=>{null==M||M((0,u.Ck)(j,t))}},e):null}(0,y.t1)(t)}o(57658);var j=o(99319),_=o(73110),A=o(58573),T=o(59054),P=o(72126),V=o(9291),I=o(68657),F=o(87279),Z=o(77907),K=o(75822),B=o(29798),O=o(78140),R=o(32163),D=o(43765),W=o(40721),E=o(72495),N=o(78948),L=o(47082),H=o(30387),U=o(32426),z=o(24405),$=o(5257),q=o(52275);function G(e){window.__c={n:"IconMenuItem"};const t=(0,z.yK)((e=>({icon:{width:14,fill:e.mediumIconColor},chevronRight:{width:12,fill:e.mediumIconColor}})),[]);return(0,k.jsx)(q.Z,{icon:e.icon(t.icon),title:e.title,focused:!1,right:(0,$.o)(t.chevronRight),onClick:e.onClick})}function Y(e){window.__c={n:"CustomFormulaItem"};const{value:t,onChange:o}=e,i=(0,n.useCallback)((()=>{o({type:"formula",value:null==t?void 0:t.value})}),[t,o]);return(0,k.jsx)(G,{icon:U.D,title:(0,k.jsx)(V.FormattedMessage,{...H.s.customFormula}),onClick:i})}o(21703);var Q=o(21202),X=o(79797),J=o(11470),ee=o(26388);function te(e){window.__c={n:"ValuePickerMenuItem"};const{token:t,contextStore:o,args:n,checkState:h,checkType:v,context:x,onCheckboxClick:w}=e,M=(0,i.Fy)(),j=(0,r.VK)((()=>o.context.parentRecordStore.getSpaceId()),[o.context.parentRecordStore]),_=(0,r.VK)((()=>{if((0,u.S3)(t)&&(0,g.IWo)(t)){const e=(0,g.zEN)(t);if(e)return(0,a.Hl)({pointer:{table:m.KJ,id:e},getRecordValue:o.context.parentRecordStore.getRecordValue})}}),[o.context.parentRecordStore,t]),A=(0,r.VK)((()=>x.collectionStore.getSchema()[x.property]),[x]),T=(0,r.VK)((()=>A&&(0,l.t)(A)?A.options??[]:[]),[A]),P=(0,r.VK)((()=>A&&(0,l.gB)(A)?A.groups??[]:[]),[A]),V=(0,r.Kw)(o.compilationResultStore),I=Boolean(A&&(0,l.gB)(A)),F="single"===v?{checkState:h}:{icon:(0,k.jsx)(f.Z,{checked:h,size:14,onClick:w})};if("string"==typeof t){if(I){const e=(0,s.i7)(T,t),o=P.find((t=>{var o;return e&&(null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id))}));return e?(0,k.jsx)(q.Z,{...n,...F,title:(0,k.jsx)(C.F,{format:M.isMobile?c.lo.Large:c.lo.Small,isSingle:!0,value:e.value,color:e.color,groupColor:null==o?void 0:o.color,shouldShrink:!0,showRemoveButton:!1},t),isTokenTitle:!0,...n}):null}{const e=(0,s.i7)(T,t);return e?(0,k.jsx)(q.Z,{...n,...F,title:(0,k.jsx)(C.a,{value:e.value,color:e.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:M.isMobile?c.lo.Large:c.lo.Small}),isTokenTitle:!0,...n}):null}}if("boolean"==typeof t)return null;if((0,g.IWo)(t))return null!=_&&_.asActor&&_.table===m.KJ?(0,k.jsx)(q.Z,{...n,...F,title:(0,k.jsx)(S.vw,{isSingle:!0,shouldShrink:!0,format:M.isMobile?S.vw.Format.Large:S.vw.Format.Medium,userValue:_.asActor}),isTokenTitle:!0}):null;if((0,g.wjk)(t)){const e=(0,g.vmO)(t).id,o=p.x.isSuccess(V)?(0,d.vx)(V.value.valueTypes,e):void 0;return o?(0,k.jsx)(q.Z,{...F,title:(0,k.jsx)(ee.ZP,{renderTooltip:()=>(0,b.e)(o),placement:ee.ug.Right,render:e=>(0,k.jsx)("div",{style:{display:"flex"},...e,children:(0,k.jsx)(b.F,{value:o,format:c.lo.Medium,isSingle:!0,shouldShrink:!0})})}),...n}):null}if((0,g.fpG)(t))return null;if((0,g.STW)(t)){const e=(0,g.TOT)(t);if(!e)return null;if(!j)return null;const i=X.G.createChildStore(o.context.parentRecordStore,{table:Q.iU,id:e,spaceId:j});return(0,k.jsx)(J.Z,{store:i,checkState:h,hidePath:!0,...n})}(0,y.t1)(t)}function oe(e){const{currentSimpleFormulaValueTokens:t,value:o,contextStore:n,setCurrentTokens:i,action:r,context:a,checkType:l,onCheckboxClick:s}=e;if(o.kind!==_.yp.ContextValue)throw new Error("Not implemented yet.");const c=Boolean(t.find((e=>(0,u.S3)(e)&&(0,g.wjk)(e)&&(0,g.vmO)(e).id===o.id))),d=(0,g._QF)({id:o.id}),p=()=>{i("append"===r?c?(0,u.Ck)(t,d):[...t,d]:[d]),null==s||s()};return{key:o.id,render:e=>(0,k.jsx)(te,{token:d,contextStore:n,args:e,checkState:c,checkType:l,context:a,onCheckboxClick:p}),action:p}}function ne(e){var t,o;window.__c={n:"ValuePickerMenuBlockArray"};const{currentSimpleFormulaValueTokens:a,menuProps:s,onClose:c,onChange:d,contextStore:p,formulaTypecheckContextValues:m,context:y,showClearButton:h,showInputMenuItem:f,type:S}=e,v=(0,i.Fy)(),x=(0,V.useIntl)(),C=(0,i.O7)(),[b,U]=(0,n.useState)(""),z=(0,r.qz)(void 0,B.Z),{collectionStore:$,property:q}=y,G=(0,w.M)($,q),Q=G(a,"first"),X=(0,r.VK)((()=>$.getSchema()[y.property]),[$,y.property]),J=(0,r.VK)((()=>!(!X||!(0,l.en)(X))&&1===X.limit),[X]),ee=(0,n.useMemo)((()=>{const e="relation"===(null==X?void 0:X.type)?(0,l.j0)(X):void 0;return m.filter((t=>(0,j.uy)(t.type,{type:"block",collection:e},!0)))}),[m,X]),ne=(0,Z.useDependency)(Z.deps.searchActions),[ie]=(0,T.r5)((async()=>{const e=b?(0,A.ZP)(b,ee,(e=>e.kind===_.yp.ContextValue?e.name:"")):ee;if("resolved"!==ne.status)return;const t=ne.value,{results:o}=await t.searchPagesInCollection({environment:C,query:b,collectionId:S.collection.id,limit:20,spaceId:S.collection.spaceId,excludeTemplates:!0,source:"simple_formula_value_page_search",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!1});return{valueResults:e,pageResults:o}}),[C,b,ee,S,ne.status,ne.value],{debounce:K.vp}),re=(0,n.useCallback)((()=>{U(""),z.setState({...z.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}),[z]),ae=(0,n.useCallback)((e=>{const t=G(e,"last");d({type:"simple",value:(0,u.iC)(t)}),re(),J&&c()}),[G,d,re,J,c]),le=(0,r.VK)((()=>(0,I.NY)()),[]),se=P.oA(Q.map(((e,t)=>(0,k.jsx)(M,{token:e,contextStore:p,disabled:!1,currentSimpleFormulaValueTokens:Q,setCurrentTokens:ae,context:y},t)))),ce=(0,k.jsx)(L.Z,{focus:!v.isMobile||void 0,focusAfterAnimation:!0,format:L.U.FilterValue,tokens:se,placeholder:x.formatMessage(H.s.pageSearchPlaceholder),onRemoveLastToken:()=>{ae(Q.slice(0,Q.length-1))},onClearButtonClick:()=>{ae([])},value:b,onChange:e=>{U(e.target.value)},dontShowBorderBottom:v.isAndroid,showClearButton:h}),de=void 0!==(null==s?void 0:s.header)?s.header:(0,k.jsx)(E.Z,{style:{paddingBottom:0},title:x.formatMessage(H.s.genericMenuHeader)});let ue;ue=v.isMobile?{menuType:F.og.Modal,right:(0,k.jsx)(W.DoneMenuText,{}),onClickRight:c}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,paddingTop:0,footer:le&&(0,k.jsx)(E.Z,{topBorder:!0,children:(0,k.jsx)(Y,{...e})}),disableHeaderBorder:!0};const pe={...ue,...s,header:v.isMobile?null:de},me=J?"single":"multi",ge=[],ye=[...P.oA(((null===(t=ie.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>oe({currentSimpleFormulaValueTokens:Q,value:e,setCurrentTokens:ae,contextStore:p,action:"append",context:y,checkType:me})))),...P.oA(((null===(o=ie.value)||void 0===o?void 0:o.pageResults)||[]).map((e=>{const t=Boolean(Q.find((t=>(0,u.S3)(t)&&(0,g.STW)(t)&&(0,g.TOT)(t)===e))),o=(0,g.$0A)(e,S.collection.spaceId),n=()=>{ae(t?(0,u.Ck)(Q,o):[...Q,o])};return{key:e,render:e=>(0,k.jsx)(te,{token:o,contextStore:p,args:e,checkState:t,checkType:me,context:y,onCheckboxClick:n}),action:n}})))];if(f){const e=Boolean(de);ge.push({key:"search-input",render:t=>(0,k.jsx)(E.Z,{...t,style:{...e&&{paddingTop:0}}}),items:[{action:()=>{},key:"input",render:()=>ce}]})}if(ye.length>0){const e=Boolean(de)||f;ge.push({key:"values",render:t=>(0,k.jsx)(E.Z,{topBorder:e,...t}),items:ye})}return(0,k.jsxs)(O.Z,{...pe,children:[ie.error&&(0,k.jsx)(E.Z,{children:(0,k.jsx)(D.Z,{title:(0,k.jsx)(V.FormattedMessage,{...H.s.somethingWentWrong})})}),0===ge.length&&ie.value&&(0,k.jsx)(E.Z,{children:(0,k.jsx)(D.Z,{title:(0,k.jsx)(V.FormattedMessage,{...H.s.noResults})})}),!ie.value&&!ie.error&&(0,k.jsx)(E.Z,{children:(0,k.jsx)(N.Z,{})}),ge.length>0&&(0,k.jsx)(R.Z,{type:R.i.Vertical,initialFocus:0,sections:ge,store:z})]})}function ie(e){window.__c={n:"ValuePickerMenuCheckbox"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:a,formulaTypecheckContextValues:l,menuProps:s,onChange:c,onClose:d}=e,p=(0,V.useIntl)(),m=(0,i.Fy)(),g=l.filter((e=>"checkbox"===e.type.type)),y=(0,n.useCallback)((e=>{c({type:"simple",value:void 0!==e[0]?(0,u.YD)(e[0]):void 0})}),[c]),h=(0,n.useCallback)((e=>{y(e),d()}),[y,d]),f=(0,r.VK)((()=>(0,I.NY)()),[]),S=P.oA(g.map((e=>oe({currentSimpleFormulaValueTokens:a,value:e,setCurrentTokens:h,contextStore:o,action:"replace",context:t,checkType:"single"})))),v=[],x=a.some((e=>!0===e)),C=[...S,...[{key:0,render:e=>(0,k.jsx)(q.Z,{title:(0,k.jsx)(V.FormattedMessage,{...H.s.unchecked}),checkState:!x,...e}),action:()=>{h([!1])}},{key:1,render:e=>(0,k.jsx)(q.Z,{title:(0,k.jsx)(V.FormattedMessage,{...H.s.checked}),checkState:x,...e}),action:()=>{h([!0])}}]],b=void 0!==(null==s?void 0:s.header)?s.header:(0,k.jsx)(E.Z,{style:{paddingBottom:0},title:p.formatMessage(H.s.genericMenuHeader)}),w=Boolean(b);let M;v.push({key:"checkbox",render:e=>(0,k.jsx)(E.Z,{...e,topBorder:w}),items:C}),M=m.isMobile?{menuType:F.og.Modal,right:(0,k.jsx)(W.DoneMenuText,{}),onClickRight:d}:{header:b,menuType:F.og.Popup,maxHeight:"50vh",width:260,footer:f&&(0,k.jsx)(E.Z,{topBorder:!0,children:(0,k.jsx)(Y,{...e})}),disableHeaderBorder:!0};const j={...M,...s,header:m.isMobile?null:b};return(0,k.jsx)(O.Z,{...j,children:(0,k.jsx)(R.Z,{type:R.i.Vertical,initialFocus:0,sections:v})})}var re=o(53016),ae=o(40506),le=o(12392),se=o(28020),ce=o(73063),de=o(89728);function ue(e){window.__c={n:"ValueDatePicker"};const{currentSimpleFormulaValueTokens:t,disabled:o,setInDatePicker:i,onClose:a,setCurrentTokens:l,context:s}=e,c=t[0],d=c&&(0,u.S3)(c)&&g.fpG(c)?g.zyO(c):void 0,p=(0,V.useIntl)(),m=(0,r.Kw)(se.AK),y=(0,n.useCallback)((()=>{i(!1)}),[i]),h=(0,n.useCallback)((e=>{e&&(0,ae.U3)(e)?l([g.pZr(e)]):l([])}),[l]),f=(0,z.yK)((e=>({header:{display:"flex",alignItems:"center",fontSize:12,paddingInline:14,color:e.mediumTextColor,marginTop:8,fontWeight:500},iconWrap:{width:18,height:18,marginRight:4},icon:{width:12,height:12},title:{flex:"1 1 auto"}})),[]),S=(0,r.VK)((()=>(0,w._)(s)),[s]);return(0,k.jsx)(Z.DependencyConsumer,{dependency:Z.deps.menus,children:e=>{let{DatePropertyMenu:t}=e;return(0,k.jsx)(t,{firstDayOfWeek:m,value:d,canConfigureCollection:!1,onChangeValue:h,dateFormat:S.dateFormat,timeFormat:S.timeFormat,onDismiss:a,disabled:o,shouldShowReminder:!1,header:(0,k.jsxs)("div",{style:f.header,children:[(0,k.jsx)(ce.Z,{ariaLabel:p.formatMessage(H.s.back),icon:le.S,onClick:y,style:f.iconWrap,iconStyle:f.icon}),(0,k.jsx)("span",{style:f.title,children:(0,k.jsx)(V.FormattedMessage,{...H.s.pickADate})}),(0,k.jsx)(de.Z,{onClick:a,isBlue:!0,children:(0,k.jsx)(W.DoneMenuText,{})})]}),isTemplatePage:!1})}})}function pe(e){window.__c={n:"ValuePickerMenuDate"};const{currentSimpleFormulaValueTokens:t,onClose:o,onChange:a,contextStore:l,formulaTypecheckContextValues:s,context:c,menuProps:d}=e,p=(0,V.useIntl)(),m=(0,i.Fy)(),[g,y]=(0,n.useState)(!1),h=s.filter((e=>"date"===e.type.type)),f=(0,n.useCallback)((e=>{a({type:"simple",value:void 0!==e[0]?(0,u.YD)(e[0]):void 0})}),[a]),S=(0,n.useCallback)((e=>{f(e),o()}),[f,o]),v=(0,n.useCallback)((()=>{y(!0)}),[]),x=(0,n.useCallback)((()=>{f([]),o()}),[f,o]),C=(0,r.VK)((()=>(0,I.NY)()),[]);if(g)return(0,k.jsx)(ue,{...e,setInDatePicker:y,setCurrentTokens:f,currentSimpleFormulaValueTokens:t});const b=void 0!==(null==d?void 0:d.header)?d.header:(0,k.jsx)(E.Z,{style:{paddingBottom:0},title:p.formatMessage(H.s.genericMenuHeader)}),w=P.oA(h.map((e=>oe({currentSimpleFormulaValueTokens:t,value:e,setCurrentTokens:S,contextStore:l,action:"replace",context:c,checkType:"single"})))),M=[];if(w.length>0){const e=Boolean(b);M.push({key:"values",render:t=>(0,k.jsx)(E.Z,{topBorder:e,...t}),items:w})}const j=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(E.Z,{topBorder:!0,children:[(0,k.jsx)(G,{icon:re.V,title:(0,k.jsx)(V.FormattedMessage,{...H.s.pickADate}),onClick:v}),C&&(0,k.jsx)(Y,{...e})]}),t.length>0&&(0,k.jsx)(E.Z,{topBorder:!0,children:(0,k.jsx)(q.Z,{title:(0,k.jsx)(V.FormattedMessage,{...H.s.clear}),focused:!1,onClick:x})})]});let _;_=m.isMobile?{menuType:F.og.Modal,right:(0,k.jsx)(W.DoneMenuText,{}),onClickRight:o,footer:j}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,footer:j,disableHeaderBorder:!0};const A={..._,...d,header:m.isMobile?null:b};return(0,k.jsx)(O.Z,{...A,children:(0,k.jsx)(R.Z,{type:R.i.Vertical,initialFocus:0,sections:M})})}var me=o(68894);function ge(e){window.__c={n:"ValuePickerMenuNumber"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:a,formulaTypecheckContextValues:l,menuProps:s,onChange:c,onClose:d,value:p}=e,m=(0,V.useIntl)(),y=(0,i.Fy)(),h=l.filter((e=>"number"===e.type.type)),f=(0,n.useCallback)((e=>{c({type:"simple",value:e})}),[c]),S=(0,n.useCallback)((e=>{f(e),d()}),[f,d]),v=(0,n.useCallback)((e=>{const t=e.target.value;let o;o=""===t?void 0:[[t]],f(o)}),[f]),x=(0,n.useCallback)((e=>{const t=P.U2(e,"event.target.value");let o;o="string"==typeof t&&""!==t?[[t]]:void 0,S(o)}),[S]),C=(0,n.useCallback)((e=>{const t=void 0!==e[0]?(0,u.YD)(e[0]):void 0;S(t)}),[S]),b=(0,r.VK)((()=>(0,I.NY)()),[]),w=P.oA(h.map((e=>oe({currentSimpleFormulaValueTokens:a,value:e,setCurrentTokens:C,contextStore:o,action:"replace",context:t,checkType:"single"})))),M=[],j=[{action:x,key:"input",render:e=>{const t=a[0],o="string"==typeof t?t:(0,g.QaF)(null==p?void 0:p.value);return(0,k.jsx)(me.ZP,{...e,focus:!0,onChange:v,onClick:void 0,value:o})}}],_=[...j,...w],A=void 0!==(null==s?void 0:s.header)?s.header:(0,k.jsx)(E.Z,{style:{paddingBottom:0},title:m.formatMessage(H.s.genericMenuHeader)});let T;M.push({key:"textbox",render:e=>(0,k.jsx)(E.Z,{...e}),items:_}),T=y.isMobile?{menuType:F.og.Modal,right:(0,k.jsx)(W.DoneMenuText,{}),onClickRight:d}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,footer:b&&(0,k.jsx)(E.Z,{topBorder:!0,children:(0,k.jsx)(Y,{...e})}),disableHeaderBorder:!0};const Z={...T,...s,header:y.isMobile?null:A};return(0,k.jsx)(O.Z,{...Z,children:(0,k.jsx)(R.Z,{initialFocus:0,sections:M,type:R.i.Vertical})})}var ye=o(1302);function he(e){var t,o;window.__c={n:"ValuePickerMenuPersonArray"};const{context:a,contextStore:s,currentSimpleFormulaValueTokens:c,formulaTypecheckContextValues:d,menuProps:p,onChange:m,onClose:y,showClearButton:h,showInputMenuItem:f}=e,S=(0,i.Fy)(),v=(0,V.useIntl)(),x=(0,i.O7)(),{collectionStore:C,property:b}=a,[U,z]=(0,n.useState)(""),$=(0,r.qz)(void 0,B.Z),q=(0,w.M)(C,b),G=q(c,"first"),Q=(0,r.VK)((()=>{const e=C.getSchema()[a.property];return!(!e||!(0,l.en)(e))&&1===e.limit}),[C,a]),X=d.filter((e=>(0,j.uy)(e.type,{type:"person"}))),[J]=(0,T.r5)((async()=>{const e=U?(0,A.ZP)(U,X,(e=>e.kind===_.yp.ContextValue?e.name:"")):X,t=await Z.deps.searchActions.loader();return{valueResults:e,userResults:(await t.searchVisibleSpaceUsers({environment:x,query:U,membersOnly:!1})).map((e=>e.id)).slice(0,20)}}),[x,U,X],{debounce:K.vp}),ee=(0,n.useCallback)((()=>{z(""),$.setState({...$.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}),[$]),ne=(0,n.useCallback)((e=>{const t=q(e,"last");m({type:"simple",value:(0,u.iC)(t)}),ee()}),[m,ee,q]),ie=(0,r.VK)((()=>(0,I.NY)()),[]),re=P.oA(G.map(((e,t)=>(0,k.jsx)(M,{token:e,contextStore:s,disabled:!1,currentSimpleFormulaValueTokens:G,setCurrentTokens:ne,context:a},t)))),ae=(0,k.jsx)(L.Z,{focus:!S.isMobile||void 0,focusAfterAnimation:!0,format:L.U.FilterValue,tokens:re,placeholder:v.formatMessage(H.s.personSearchPlaceholder),onRemoveLastToken:()=>{ne(G.slice(0,G.length-1))},onClearButtonClick:()=>{ne([])},value:U,onChange:e=>{z(e.target.value)},dontShowBorderBottom:S.isAndroid,showClearButton:h}),le=void 0!==(null==p?void 0:p.header)?p.header:(0,k.jsx)(E.Z,{style:{paddingBottom:0},title:v.formatMessage(H.s.genericMenuHeader)});let se;se=S.isMobile?{menuType:F.og.Modal,right:(0,k.jsx)(W.DoneMenuText,{}),onClickRight:y}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,footer:ie&&(0,k.jsx)(E.Z,{topBorder:!0,children:(0,k.jsx)(Y,{...e})}),disableHeaderBorder:!0};const ce={...se,...p,header:S.isMobile?null:le},de=Q?"single":"multi",ue=[...P.oA(((null===(t=J.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>oe({currentSimpleFormulaValueTokens:G,value:e,setCurrentTokens:ne,contextStore:s,action:"append",context:a,checkType:de,onCheckboxClick:()=>{Q&&ye.default.afterNextFlush((()=>{y()}))}})))),...P.oA(((null===(o=J.value)||void 0===o?void 0:o.userResults)||[]).map((e=>{const t=Boolean(G.find((t=>(0,u.S3)(t)&&(0,g.IWo)(t)&&(0,g.zEN)(t)===e))),o=(0,g.tEo)(e),n=()=>{ne(t?(0,u.Ck)(G,o):[...G,o]),Q&&ye.default.afterNextFlush((()=>{y()}))};return{key:e,render:e=>(0,k.jsx)(te,{token:o,contextStore:s,args:e,checkState:t,checkType:de,context:a,onCheckboxClick:n}),action:n}})))],pe=[];if(f){const e=Boolean(le);pe.push({key:"search-input",render:t=>(0,k.jsx)(E.Z,{...t,style:{...e&&{paddingTop:0}}}),items:[{action:()=>{},key:"input",render:()=>ae}]})}if(ue.length>0){const e=Boolean(le)||f;pe.push({key:"users",render:t=>(0,k.jsx)(E.Z,{topBorder:e,...t}),items:ue})}return(0,k.jsxs)(O.Z,{...ce,children:[J.error&&(0,k.jsx)(E.Z,{children:(0,k.jsx)(D.Z,{title:(0,k.jsx)(V.FormattedMessage,{...H.s.somethingWentWrong})})}),0===pe.length&&J.value&&(0,k.jsx)(E.Z,{children:(0,k.jsx)(D.Z,{title:(0,k.jsx)(V.FormattedMessage,{...H.s.noResults})})}),!J.value&&!J.error&&(0,k.jsx)(E.Z,{children:(0,k.jsx)(N.Z,{})}),pe.length>0&&(0,k.jsx)(R.Z,{type:R.i.Vertical,initialFocus:0,sections:pe,store:$})]})}function fe(e){window.__c={n:"ValuePickerMenuSelect"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:a,formulaTypecheckContextValues:s,isSingle:c,menuProps:d,onChange:p,onClose:m,showClearButton:g,showInputMenuItem:h,type:f}=e,S=(0,i.Fy)(),v=(0,V.useIntl)(),[x,C]=(0,n.useState)(""),b=(0,r.qz)(void 0,B.Z),w=X.NW.createChildStore(o.context.parentRecordStore,f.collection),T=(0,r.VK)((()=>w.getSchema()[f.property]),[w,f]),Z=(0,r.VK)((()=>T&&(0,l.gB)(T)?T.groups??[]:[]),[T]),K=(0,r.VK)((()=>T&&(0,l.t)(T)&&T.options||[]),[T]),N=s.filter((e=>(0,j.uy)(e.type,{type:"select",collection:f.collection,property:f.property}))),U=(0,r.VK)((()=>({valueResults:x?(0,A.ZP)(x,N,(e=>e.kind===_.yp.ContextValue?e.name:"")):N,selectResults:x?(0,A.ZP)(x,K,(e=>e.value)):K})),[x,N,K]),z=(0,n.useCallback)((()=>{C(""),b.setState({...b.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}),[b]),$=(0,n.useCallback)((e=>{p({type:"simple",value:c?(0,u.YD)(e[0]):(0,u.iC)(e)}),z()}),[p,z,c]),q=(0,r.VK)((()=>(0,I.NY)()),[]),G=P.oA(a.map(((e,n)=>(0,k.jsx)(M,{token:e,contextStore:o,disabled:!1,currentSimpleFormulaValueTokens:a,setCurrentTokens:$,context:t},n)))),Q=void 0!==(null==d?void 0:d.header)?d.header:(0,k.jsx)(E.Z,{style:{paddingBottom:0},title:v.formatMessage(H.s.genericMenuHeader)}),J=(0,k.jsx)(L.Z,{focus:!S.isMobile||void 0,focusAfterAnimation:!0,format:L.U.FilterValue,tokens:G,placeholder:v.formatMessage(H.s.searchPlaceHolder),onRemoveLastToken:()=>{$(a.slice(0,a.length-1))},onClearButtonClick:()=>{$([])},value:x,onChange:e=>{C(e.target.value)},dontShowBorderBottom:S.isAndroid,showClearButton:g}),ee=[];if(h){const e=Boolean(Q);ee.push({key:"search-input",render:t=>(0,k.jsx)(E.Z,{...t,style:{...e&&{paddingTop:0}}}),items:[{action:()=>{},key:"input",render:()=>J}]})}const ne=Boolean(T&&(0,l.gB)(T)),ie={automationContextValues:U.valueResults??[],onClose:m,context:t,contextStore:o,currentSimpleFormulaValueTokens:a,isSingle:c,groupOptions:Z,selectOptions:U.selectResults??[],setCurrentTokens:$},re=ne?function(e){const{automationContextValues:t,onClose:o,context:n,contextStore:i,currentSimpleFormulaValueTokens:r,isSingle:a,groupOptions:l,selectOptions:s,setCurrentTokens:c}=e,d=[],p=a?"single":"multi",m=P.oA(t.map((e=>oe({currentSimpleFormulaValueTokens:r,value:e,setCurrentTokens:c,contextStore:i,action:a?"replace":"append",context:n,checkType:p,onCheckboxClick:()=>{a&&ye.default.afterNextFlush((()=>{o()}))}}))));m.length>0&&d.push({key:"automation-variables",render:e=>(0,k.jsx)(E.Z,{title:(0,k.jsx)(V.FormattedMessage,{...H.s.valuesFromThisAutomation}),topBorder:!0,...e}),items:m});const g=new Map(s.map((e=>[e.id,e]))),h=l.map((e=>{const t=(e.optionIds??[]).map((e=>g.get(e))).filter(y.$K).map((e=>{const t=Boolean(r.find((t=>"string"==typeof t&&t===e.value))),l=()=>{c(a?t?[]:[e.value]:t?(0,u.Ck)(r,e.value):[...r,e.value]),a&&ye.default.afterNextFlush((()=>{o()}))},s={key:e.id,render:o=>(0,k.jsx)(te,{token:e.value,contextStore:i,args:o,checkState:t,checkType:p,context:n,onCheckboxClick:l}),action:l};return s})),l={key:e.id,items:t,render:t=>(0,k.jsx)(E.Z,{title:e.name,topBorder:!0,...t})};return l})).filter((e=>e.items.length>0));return d.push(...h),d}(ie):function(e){const{automationContextValues:t,onClose:o,context:n,contextStore:i,currentSimpleFormulaValueTokens:r,isSingle:a,selectOptions:l,setCurrentTokens:s}=e,c=[],d=a?"single":"multi",p=P.oA(t.map((e=>oe({currentSimpleFormulaValueTokens:r,value:e,setCurrentTokens:s,contextStore:i,action:a?"replace":"append",context:n,checkType:d,onCheckboxClick:()=>{a&&ye.default.afterNextFlush((()=>{o()}))}})))),m=P.oA(l.map((e=>{const t=Boolean(r.find((t=>"string"==typeof t&&t===e.value))),l=()=>{s(a?t?[]:[e.value]:t?(0,u.Ck)(r,e.value):[...r,e.value]),a&&ye.default.afterNextFlush((()=>{o()}))},c={key:e.id,render:o=>(0,k.jsx)(te,{token:e.value,contextStore:i,args:o,checkState:t,checkType:d,context:n,onCheckboxClick:l}),action:l};return c}))),g=[...p,...m];g.length>0&&c.push({key:"options",render:e=>(0,k.jsx)(E.Z,{topBorder:!0,...e}),items:g});return c}(ie);let ae;ee.push(...re),ae=S.isMobile?{menuType:F.og.Modal,right:(0,k.jsx)(W.DoneMenuText,{}),onClickRight:m}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,paddingTop:0,footer:q&&(0,k.jsx)(E.Z,{topBorder:!0,children:(0,k.jsx)(Y,{...e})}),disableHeaderBorder:!0};const le={...ae,...d,header:S.isMobile?null:Q};return(0,k.jsxs)(O.Z,{...le,children:[0===ee.length&&(0,k.jsx)(E.Z,{children:(0,k.jsx)(D.Z,{title:(0,k.jsx)(V.FormattedMessage,{...H.s.noResults})})}),ee.length>0&&(0,k.jsx)(R.Z,{type:R.i.Vertical,initialFocus:0,sections:ee,store:b})]})}var Se=o(65187),ve=o(43250),xe=o(28992);function Ce(e){window.__c={n:"ValuePickerMenuText"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:a,formulaTypecheckContextValues:l,menuProps:s,onChange:c,onClose:d,value:p,disableEmojiCommands:m,disableFormattingAndMentions:g,disableMobileActionBar:y,disableTemplateVariableMentions:h}=e,f=(0,V.useIntl)(),{isMobile:S}=(0,i.Fy)(),v=(0,z.yK)((e=>({wrap:{background:e.inputBackground,borderRadius:4,boxShadow:e.inputBoxShadow,lineHeight:"24px",padding:1,marginBlock:S?12:0},text:{maxHeight:120,overflow:"auto",padding:"4px 10px"}})),[S]),x=(0,r.VK)((()=>(0,I.NY)()),[]),C=(0,n.useMemo)((()=>l.filter((e=>"text"===e.type.type))),[l]),b=(0,n.useCallback)((e=>{c({type:"simple",value:e})}),[c]),w=(0,n.useCallback)((e=>{b(e),d()}),[b,d]),M=(0,n.useCallback)((e=>{const t=void 0!==e[0]?(0,u.YD)(e[0]):void 0;w(t)}),[w]),{store:j}=(0,I.Cl)({initialValue:null==p?void 0:p.value,onChange:b}),_=P.oA(C.map((e=>oe({currentSimpleFormulaValueTokens:a,value:e,setCurrentTokens:M,contextStore:o,action:"replace",context:t,checkType:"single"})))),A=[],T=[{action:P.ZT,key:"input",render:e=>(0,k.jsx)(xe.Z,{...e,title:(0,k.jsx)("div",{className:ve.Wh_,style:v.wrap,children:(0,k.jsx)(Se.Z,{disableComment:!0,disabled:!1,disableEmbedMenu:!0,disableEmojiCommands:m,disableMobileActionBar:y,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableSlashCommands:!0,disableTemplateVariableMentions:h,...g?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0}:{},onEnter:d,pasteBehavior:"inline",store:j,style:v.text})})})}],Z=[..._,...T],K=void 0!==(null==s?void 0:s.header)?s.header:(0,k.jsx)(E.Z,{style:{paddingBottom:0},title:f.formatMessage(H.s.genericMenuHeader)});let B;A.push({key:"textbox",render:e=>(0,k.jsx)(E.Z,{...e}),items:Z}),B=S?{menuType:F.og.Modal,right:(0,k.jsx)(W.DoneMenuText,{}),onClickRight:d}:{menuType:F.og.Popup,maxHeight:"50vh",width:260,footer:x&&(0,k.jsx)(E.Z,{topBorder:!0,children:(0,k.jsx)(Y,{...e})}),disableHeaderBorder:!0};const D={...B,...s,header:S?null:K};return(0,k.jsx)(O.Z,{...D,children:(0,k.jsx)(R.Z,{initialFocus:0,sections:A,type:R.i.Vertical})})}function be(e){const{showClearButton:t,showInputMenuItem:o,type:n}=e;return"text"===n.type?(0,k.jsx)(Ce,{...e,type:n}):"number"===n.type?(0,k.jsx)(ge,{...e,type:n}):"checkbox"===n.type?(0,k.jsx)(ie,{...e,type:n}):"date"===n.type?(0,k.jsx)(pe,{...e,type:n}):"person_array"===n.type?(0,k.jsx)(he,{...e,showClearButton:t??!0,showInputMenuItem:o??!0,type:n}):"block_array"===n.type?(0,k.jsx)(ne,{...e,showClearButton:t??!0,showInputMenuItem:o??!0,type:n}):"select"===n.type?(0,k.jsx)(fe,{...e,showClearButton:t??!0,showInputMenuItem:o??!0,type:n,isSingle:!0}):"select_array"===n.type?(0,k.jsx)(fe,{...e,showClearButton:t??!0,showInputMenuItem:o??!0,type:n,isSingle:!1}):void(0,y.t1)(n)}},75311:(e,t,o)=>{o.d(t,{M:()=>s,_:()=>c});var n=o(67294),i=o(86628),r=o(99036),a=o(40506),l=o(97880);function s(e,t){const o=(0,i.VK)((()=>{const o=e.getSchema()[t];let n;return o&&(0,r.en)(o)&&(n=o.limit),n}),[e,t]);return(0,n.useCallback)(((e,t)=>(0,l.$K)(o)?"first"===t?e.slice(0,o):"last"===t?e.slice(-o):void(0,l.t1)(t):e),[o])}function c(e){var t;const o=null===(t=e.collectionStore.getSchema())||void 0===t?void 0:t[e.property];return o&&"date"===o.type?{dateFormat:o.date_format||a.sF,timeFormat:o.time_format||a.c_}:{dateFormat:a.sF,timeFormat:a.c_}}},30387:(e,t,o)=>{o.d(t,{s:()=>n});const n=(0,o(9291).defineMessages)({back:{defaultMessage:"Back",id:"formulas.SimpleFormulaValuePicker.back"},valuesFromThisAutomation:{defaultMessage:"From this automation",id:"formulas.SimpleFormulaValuePicker.valuesFromThisAutomation"},pickADate:{defaultMessage:"Pick a date",id:"formulas.SimpleFormulaValuePicker.pickADate"},clear:{defaultMessage:"Clear",id:"formulas.SimpleFormulaValuePicker.clear"},unchecked:{defaultMessage:"Unchecked",id:"formulas.SimpleFormulaValuePicker.checkbox.unchecked"},checked:{defaultMessage:"Checked",id:"formulas.SimpleFormulaValuePicker.checkbox.checked"},checkboxOptions:{defaultMessage:"Checkbox options",id:"formulas.SimpleFormulaValuePicker.checkbox.sectionHeader"},searchPlaceHolder:{defaultMessage:"Select one or more options…",id:"formulas.SimpleFormulaValuePicker.select.searchPlaceholder"},selectOptionsSectionHeader:{defaultMessage:"Select an option",id:"formulas.SimpleFormulaValuePicker.select.sectionHeader"},noResults:{defaultMessage:"No results",id:"formulas.simpleValuePicker.noResults"},pageSearchPlaceholder:{defaultMessage:"Search for one or more pages…",id:"formulas.SimpleFormulaValuePicker.pages.searchPlaceholder"},pages:{defaultMessage:"Pages",id:"formulas.SimpleFormulaValuePicker.pages.sectionHeader"},somethingWentWrong:{defaultMessage:"Something went wrong.",id:"formulas.simpleValuePicker.errorMessage"},personSelect:{defaultMessage:"Select...",id:"formulas.SimpleFormulaValuePicker.chooseAValue"},personSearchPlaceholder:{defaultMessage:"Search for one or more people…",id:"formulas.SimpleFormulaValuePicker.people.searchPlaceholder"},customFormula:{defaultMessage:"Custom formula",id:"formulas.SimpleFormulaValuePicker.customFormula"},peopleInWorkspace:{defaultMessage:"People",id:"formulas.SimpleFormulaValuePicker.people.sectionHeader"},genericMenuHeader:{defaultMessage:"Set property to",id:"formulas.SimpleFormulaValuePicker.genericMenuHeader"}})},42876:(e,t,o)=>{o.d(t,{ZP:()=>B});o(57658);var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(41892),s=o(77657),c=o(82114),d=o(36591),u=o(90199),p=o(35840),m=o(55159),g=o(72126),y=o(149),h=o(97880),f=o(9291),S=o(54642),v=o(89475),x=o(12457),C=o(33929),b=o(18441),w=o(80444),k=o(30874),M=o(49085),j=o(92595);class _ extends M.default{getStateForBot(e){return this.state[e]??{channels:{},fetching:!1,lastRefreshed:0}}updateStateForBot(e,t){this.setState({...this.state,[e]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const o=this.getStateForBot(e);this.setState({...this.state,[e]:{...o,channels:{...o.channels,...t}}})}}const A=new _;(0,j.exposeDebugValue)("ExternalNotificationChannelsStore",A);const T=A;var P=o(52275),V=o(68894),I=o(68785),F=o(72495),Z=o(85893);const K=(0,f.defineMessages)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…"}});function B(e){window.__c={n:"SlackSelectChannelView"};const{currentNotificationChannel:t,onNotificationChannelSelect:o,onClose:c,onNewSlackAccountAdded:u,renderMenu:m,channelFilter:M}=e,j=(0,i.O7)(),{isMobile:_}=(0,i.Fy)(),A=(0,r.VK)((()=>k.Z.completeSlackAuthentications.state),[]),B=e.currentExternalAuthentication??g.Ps(A);n.useEffect((()=>{B&&async function(e){const{environment:t,botId:o,spaceId:n}=e,i=T.getStateForBot(o);if(i.fetching||Date.now()-i.lastRefreshed<D)return;let r;T.updateStateForBot(o,{fetching:!0,lastRefreshed:Date.now()});for(;;){const e=await S.getExternalNotificationChannels(t,{botId:o,spaceId:n,cursor:r});if("success"!==e.type){console.error(e.error);break}{const t={};for(const o of e.data.channels)t[o.id]=o;if(T.addChannelsForBot(o,t),r=e.data.cursor,!r)break}}T.updateStateForBot(o,{fetching:!1})}({environment:j,botId:B.id,spaceId:B.space_id})}),[j,B]);const[W,E]=n.useState(""),{loadedChannelsForAccount:N,isLoading:L}=(0,r.VK)((()=>{if(!B)return{loadedChannelsForAccount:[],isLoading:!1};const e=T.getStateForBot(B.id);return{loadedChannelsForAccount:Object.values(e.channels),isLoading:e.fetching}}),[B]),H=(0,r.VK)((()=>k.Z.integrations.state.find((e=>e.id===s.nO))),[]),U=(0,r.VK)((()=>{var e;return null===(e=w.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),z=n.useCallback((e=>{B&&o(e,B),c()}),[o,B,c]),$=(0,a.yK)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[]),q=n.useCallback((e=>{const{channel:o}=e;return{key:o.id,render:e=>(0,Z.jsx)(P.Z,{...e,icon:R({channel:o,styles:$.icon}),desktopIconStyle:{width:8},title:o.name,right:o.id===(null==t?void 0:t.id)&&(0,d.e)($.icon)}),action:()=>{z(o)}}}),[z,$.icon,t]),{publicChannels:G,privateChannels:Y,personalChannels:Q}=n.useMemo((()=>function(e,t){const o=[],n=[],i=[];for(const r of e)t&&!t(r)||("public"===r.type?o.push(r):"private"===r.type?n.push(r):"me"===r.type?i.push(r):(0,h.t1)(r.type));return{publicChannels:o,privateChannels:n,personalChannels:i}}(N,M)),[M,N]),X=n.useCallback((()=>G.map((e=>({menuListItem:q({channel:e}),channelName:e.name})))),[G,q]),J=n.useCallback((()=>Y.map((e=>({menuListItem:q({channel:e}),channelName:e.name})))),[Y,q]),ee=n.useCallback((()=>Q.map((e=>({menuListItem:q({channel:e}),channelName:e.name})))),[Q,q]),te=n.useCallback((()=>X().map((e=>{let{menuListItem:t,channelName:o}=e;if(O({channelName:o,query:W}))return t})).filter(h.$K)),[X,W]),oe=n.useCallback((()=>J().map((e=>{let{menuListItem:t,channelName:o}=e;if(O({channelName:o,query:W}))return t})).filter(h.$K)),[J,W]),ne=n.useCallback((()=>ee().map((e=>{let{menuListItem:t,channelName:o}=e;if(O({channelName:o,query:W}))return t})).filter(h.$K)),[ee,W]),ie=n.useCallback((()=>{if(!B)return[];const e=[],t=te(),o=oe(),n=ne();return n.length>0&&e.push({key:"personal-channels",render:e=>(0,Z.jsx)(F.Z,{...e,title:(0,b.jg)(B).organizationName}),items:n}),t.length>0&&e.push({key:"public-channels",render:e=>(0,Z.jsx)(F.Z,{...e,topBorder:n.length>0,title:0===n.length&&(0,b.jg)(B).organizationName}),items:t}),o.length>0&&e.push({key:"private-channels",render:e=>(0,Z.jsx)(F.Z,{...e,topBorder:t.length>0,title:0===n.length&&t.length>0&&(0,b.jg)(B).organizationName}),items:o}),e}),[te,oe,ne,B]);if(!B||!H)return null;const re=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,Z.jsx)("div",{children:(0,Z.jsx)(V.ZP,{...e,inputLeft:(0,Z.jsx)(V.f_,{icon:p.R}),inputRight:(0,Z.jsx)(x.Z,{show:L,showDelay:500,showHold:300,render:e=>e&&(0,Z.jsx)(I.Z,{style:{marginRight:2}})}),showClearButton:!0,placeholder:C.default.formatMessage(K.channelSearchPlaceholder),focusInitial:!_,value:W,onChange:e=>{E(e.target.value)}})})}],render:e=>(0,Z.jsx)(F.Z,{...e})},...ie()];return t||re.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!U)return;const e=await v.hM({environment:j,integration:H,spaceId:U,from:"collection_view_settings"});y.x.isFail(e)||u()},render:e=>(0,Z.jsx)(P.Z,{...e,icon:(0,Z.jsx)("img",{src:l.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,Z.jsx)(f.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,Z.jsx)(F.Z,{...e,topBorder:!0})}),(0,Z.jsx)(Z.Fragment,{children:m(re)})}function O(e){const{channelName:t,query:o}=e;return 0===o.length||t.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0}function R(e){const{channel:t,styles:o}=e;return"private"===t.type?(0,u.b)(o):"me"===t.type?(0,c.p)(o):(0,m.J)(o)}const D=15e3},58812:(e,t,o)=>{o.d(t,{$K:()=>b,SC:()=>x,aO:()=>S,hL:()=>M,hY:()=>v,j3:()=>C});o(57658);var n=o(63362),i=o(4615),r=o(98963),a=o(97880),l=o(9291),s=o(81575),c=o(47307),d=o(9953),u=o(82530),p=o(47043),m=o(97978),g=o(54802),y=o(33929),h=o(79797);const f=(0,l.defineMessages)({automationDeleteConfirmationMessage:{id:"slackAutomations.remove.confirmation.message",defaultMessage:"Are you sure you want to delete {automationName}?"},automationDeleteAcceptLabel:{id:"slackAutomations.remove.confirmation.acceptLabel",defaultMessage:"Delete"},confirmDiscardChangesMessage:{id:"automations.confirmDiscardChanges.message",defaultMessage:"{hasName, select, true {Are you sure you want to discard {automationName}?} other {Are you sure you want to discard this automation?}}"},confirmDiscardChangesAccept:{defaultMessage:"Discard",id:"automations.confirmDiscardChanges.acceptLabel"}});function S(e){const{automationStore:t,collectionStore:o,environment:a,intl:l}=e,s=(0,m.mc)(a);u.createAndCommit({environment:a,userAction:"collectionSettingsAutomationsActions.createDatabaseAutomation",perform:e=>{u.applyOperation({store:o,operation:{pointer:o.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:t.id}},transaction:e});const n=h.Mz.createChildStore(o,t.pointer),s=t.getActionStores();for(const t of s){const o=t.getType();o&&p.zY({actionId:t.id,actionType:o,automationStore:n,config:t.getConfig(),environment:a,intl:l,transaction:e})}const c=w(s);d.ae({environment:a,inMemoryRecordCache:o.inMemoryRecordCache,table:r.cv,transaction:e,value:{action_ids:t.getActionIds(),alive:!0,id:t.id,parent_id:o.id,parent_table:o.table,properties:{name:t.getName()},space_id:o.getSpaceId(),status:"active",trigger:{id:(0,i.ZP)(),event:t.getEventConfiguration()??{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:o.getSpaceShardedPointer(),type:"collection"}},type:c}}})}});const c=k({automationStore:t,collectionStore:o});n.T0(s,c)}function v(e){const{automationStore:t,collectionStore:o,environment:i}=e;u.createAndCommit({environment:i,userAction:"collectionSettingsAutomationsActions.saveDatabaseAutomation",perform:e=>{const n=h.Mz.createChildStore(o,t.pointer),i=t.getName(),r=n.getKeyStore("properties");d.sW({store:r,data:{name:i},transaction:e});const a=t.getActionStores(),l=w(a),s=n.getTriggerStore();if(d.sW({store:s,data:{type:l},transaction:e}),(0,g.Xd)(n)&&(0,g.Xd)(t)){const o=n.getTriggerStore().getKeyStore("event");d.sW({store:o,data:t.getTriggerStore().getKeyStore("event").getValue(),transaction:e})}const c=[];for(const t of a){const o=t.getModel();if(!o)continue;const i=h.zq.createChildStore(n,t.pointer);d.sO({store:i,value:{alive:!0,config:o.getConfig(),id:o.id,parent_id:n.id,parent_table:n.table,space_id:n.getSpaceId(),type:o.type},transaction:e}),c.push(t.id)}d.sW({store:n,data:{action_ids:c},transaction:e})}});const r=(0,m.mc)(i),a=k({automationStore:t,collectionStore:o});n.r4(r,a)}async function x(e){const{intl:t,environment:o,collectionStore:i,existingAutomationStore:r,triggerType:a,onDelete:l}=e,p=r.getNameWithDefault(t);(await c.confirmUserActionV2({message:t.formatMessage(f.automationDeleteConfirmationMessage,{automationName:p}),acceptLabel:t.formatMessage(f.automationDeleteAcceptLabel)})).accept&&(!function(e){const{environment:t,triggerType:o,collectionStore:i,existingAutomationStore:r}=e;u.createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.deleteAutomation",perform:e=>{const t=i.getFormatStore().getKeyStore("automation_ids"),o=h.Mz.createChildStore(i,r.pointer);u.applyOperation({store:t,operation:{pointer:t.pointer,path:t.path,command:"listRemove",args:{id:o.id}},transaction:e}),d.sW({store:o,data:{alive:!1},transaction:e})}});const a=(0,m.mc)(t),l=k({automationStore:r,collectionStore:i});n.uO(a,l),"notification_event"===o&&s.xi(t,{type:"granular",source:"collection_view_settings",collection_id:i.id})}({environment:o,triggerType:a,collectionStore:i,existingAutomationStore:r}),null==l||l())}function C(e){const{automationStore:t,collectionStore:o,environment:i}=e;u.createAndCommit({environment:i,userAction:"collectionSettingsAutomationsActions.disableAutomation",perform:e=>{const n=h.Mz.createChildStore(o,t.pointer);d.sW({store:n,data:{status:"disabled"},transaction:e})}});const r=(0,m.mc)(i),a=k({automationStore:t,collectionStore:o});n.ai(r,a)}function b(e){const{automationStore:t,collectionStore:o,environment:i}=e;u.createAndCommit({environment:i,userAction:"collectionSettingsAutomationsActions.enableAutomation",perform:e=>{const n=h.Mz.createChildStore(o,t.pointer);d.sW({store:n,data:{status:"active"},transaction:e})}});const r=(0,m.mc)(i),a=k({automationStore:t,collectionStore:o});n.Rt(r,a)}function w(e){return 1===e.length&&e[0].isType("slack_notification")?"notification_event":"event"}function k(e){const{automationStore:t,collectionStore:o}=e,n=o.getSchema(),i=t.getActionStores().map((e=>{return e.isType("slack_notification")?{type:"slack_notification"}:e.isType("update_pages")?{property_types:((null===(t=e.getConfig())||void 0===t?void 0:t.properties)??[]).map((e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.type})).filter(a.$K),type:"update_pages"}:e.isType("create_page")?{property_types:((null===(o=e.getConfig())||void 0===o?void 0:o.properties)??[]).map((e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.type})).filter(a.$K),type:"create_page"}:void 0;var t,o})).filter(a.$K),r=t.getTriggerStore().getValue(),l=[];if("event"===(null==r?void 0:r.type)||"notification_event"===(null==r?void 0:r.type)){const{pagesAdded:e,pagePropertiesEdited:t}=r.event;e&&l.push({type:"page"}),"any"===t.type?l.push({condition:"any",type:"property"}):"none"===t.type?l.push({condition:"none",type:"property"}):l.push({condition:"some",property_types:t.some.map((e=>{var t;return null===(t=n[e.property])||void 0===t?void 0:t.type})).filter(a.$K),type:"property"})}let s;if(t.isTriggerType("event")||t.isTriggerType("notification_event")){const e=t.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();e&&"collection_view"===e.type&&(s=e.pointer.id)}return{automation_actions:i,automation_id:t.id,automation_triggers:l,collection_id:o.id,collection_view_id:s}}async function M(e){const{automationName:t,hasPendingChanges:o}=e;if(!o)return!0;return(await c.confirmUserActionV2({acceptLabel:y.default.formatMessage(f.confirmDiscardChangesAccept),message:y.default.formatMessage(f.confirmDiscardChangesMessage,{automationName:t,hasName:Boolean(t)})})).accept}},20776:(e,t,o)=>{o.d(t,{o:()=>l});o(67294);var n=o(24405),i=o(8848),r=o(82990),a=o(85893);function l(e){window.__c={n:"AutomationStepValueToken"};const{children:t,icon:o,shouldTruncateChildren:l}=e,s=(0,n.yK)((e=>{const t=(0,i.KR)(e,void 0);return{iconWrap:{flex:"0 0 auto"},textWrap:{...l?r.Z.textOverflowStyle:{},flex:"1 1 auto"},wrap:{backgroundColor:t.backgroundColor,borderRadius:12,color:t.textColor,display:"inline-flex",gap:4,minWidth:l?50:void 0,padding:"0 8px"}}}),[l]);return(0,a.jsxs)("span",{style:s.wrap,children:[o&&(0,a.jsx)("span",{"aria-hidden":"true",style:s.iconWrap,children:o}),(0,a.jsx)("span",{style:s.textWrap,children:t})]})}},91537:(e,t,o)=>{o.d(t,{Z:()=>fn,s:()=>yn});o(57658);var n=o(67294),i=o(480),r=o(86628),a=o(24405),l=o(63362),s=o(3865),c=o(47453),d=o(37612),u=o(4615),p=o(606),m=o(98963),g=o(6287),y=o(13493),h=o(97880),f=o(82990),S=o(9291),v=o(5149),x=o(64964),C=o(82530),b=o(91738),w=o(55132),k=o(9139),M=o(23867),j=o(8406),_=o(32628),A=o(78140),T=o(87279),P=o(91494),V=o(14648),I=o(85893);function F(e){window.__c={n:"AutomationEventActionCreatePage"};const{automationActionMenuStore:t,automationStore:o,collectionStore:r,onClose:a,updateCurrentState:l}=e,s=(0,u.ZP)(),c=(0,i.O7)(),d=(0,V.F)({automationTriggerActionMenuStore:t,leftStyle:{flexGrow:0},onClose:a,rightStyle:{flexGrow:0},title:(0,I.jsx)(S.FormattedMessage,{defaultMessage:"Add page to…",id:"automationEventActionCreatePage.menu.title"})}),p=(0,n.useCallback)((()=>{j.tW({environment:c,eventName:"abandoned_search",sessionId:s,source:_.S.Automation})}),[c,s]);d.menuType===T.og.Popup&&(d.onClickOutside=p);const m=(0,P.X)({automationStore:o,collectionStore:r}),g=(0,n.useCallback)((e=>{l({action:{id:(0,u.ZP)(),config:{collection:{...e.pointer,spaceId:(0,M.C)(e.pointer.spaceId)},properties:["title"],values:{}},type:"create_page"},type:"update_action"}),a()}),[a,l]);return m?(0,I.jsx)(A.Z,{...d,children:(0,I.jsx)(_.Z,{context:_.S.Automation,onAccept:g,parentStore:m.context.parentRecordStore,requireEditPermissions:!0,searchSessionId:s})}):null}var Z=o(43261),K=o.n(Z),B=o(12396),O=o(9999),R=o(65422),D=o(5257),W=o(52275),E=o(68894),N=o(32163),L=o(72495),H=o(49117),U=o(65183),z=o(54802),$=o(33929),q=o(44041),G=o(35057),Y=o(95193);const Q=(0,S.defineMessages)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search for action…"}});function X(e){window.__c={n:"AutomationEventActionMenu"};const{availableActions:t,automationActionMenuStore:o,automationStore:l,collectionStore:c,updateCurrentState:d,onClose:u}=e,p=(0,a.Fg)(),m=(0,S.useIntl)(),{isMobile:g}=(0,i.Fy)(),y=(0,i.O7)(),[f,v]=n.useState(""),x=(0,r.VK)((()=>c.getSchema()),[c]),C=(0,z.j_)(),b=(0,r.VK)((()=>function(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,i=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),r=o.getFormat(),a=o.getSchema(),l=(0,s.cO)({collectionFormat:r,collectionSchema:a,filter:e=>{let[t]=e;return!i.has(t)}}),c=new Map,d=l.map((e=>{const t=a[e];if(t){const o=`${t.name} ${U.SO[t.type]}`;return c.set(e,o),o}})).filter(h.$K),u=new Set(K().filter(n,d).map((e=>{let{original:t}=e;return t})));return l.filter((e=>{const t=c.get(e);return t&&u.has(t)}))}({automationStore:l,collectionStore:c,searchInput:f})),[l,c,f]),w=(0,r.VK)((()=>function(e){const{availableActions:t,searchInput:o}=e;if(0===t.length)return[];const n=new Map,i=t.map((e=>{const t=$.default.formatMessage(e.display.name);return n.set(e.type,t),t})),r=new Set(K().filter(o,i).map((e=>{let{original:t}=e;return t})));return t.filter((e=>{const t=n.get(e.type);return t&&r.has(t)}))}({availableActions:t,searchInput:f})),[t,f]),k=(0,H.Rr)({contextType:"event",environment:y}),M=(0,r.VK)((()=>!(0,G.sX)()),[]),j=0===t.length&&M,_=(0,n.useCallback)((()=>{u(),q.y(y,{for:"plus",from:"database_automation_action_item"})}),[y,u]),T=w.length>0?function(e){const{automationActionMenuStore:t,actions:o,initialSlackActionSelectMenuState:n,showTopBorder:i,theme:r}=e,a=o.map((e=>function(e){const{automationActionMenuStore:t,action:o,initialSlackActionSelectMenuState:n,theme:i}=e;if("slack_notification"===o.type)return{key:"slack_action",action:()=>{t.pushSettingsItem(n)},render:e=>(0,I.jsx)(W.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginLeft:2,marginRight:8,width:12,height:"auto"}),right:(0,D.o)({marginInlineStart:6,width:12,height:"auto"}),title:(0,I.jsx)(S.FormattedMessage,{...o.display.name})})};if("create_page"===o.type)return{key:"create_page",action:()=>{t.pushSettingsItem({actionId:void 0,type:"eventActionCreatePage"})},render:e=>(0,I.jsx)(W.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginInline:"2px 8px",width:14}),right:(0,D.o)({marginInlineStart:6,width:12}),title:(0,I.jsx)(S.FormattedMessage,{...o.display.name})})};if("update_pages"===o.type)return{key:"update_pages",action:()=>{t.pushSettingsItem({actionId:void 0,automationId:"",type:"eventActionUpdatePages"})},render:e=>(0,I.jsx)(W.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginInline:"2px 8px",width:14}),right:(0,D.o)({marginInlineStart:6,width:12}),title:(0,I.jsx)(S.FormattedMessage,{...o.display.name})})}}({automationActionMenuStore:t,action:e,initialSlackActionSelectMenuState:n,theme:r}))).filter(h.$K);if(0===a.length)return;return{key:"other_actions_section",items:a,render:e=>(0,I.jsx)(L.Z,{...e,topBorder:i})}}({automationActionMenuStore:o,actions:w,initialSlackActionSelectMenuState:C,theme:p}):void 0,P=b.length>0&&!M?function(e){const{automationActionMenuStore:t,properties:o,collectionSchema:n,theme:i,updateCurrentState:r,onClose:a,showTopBorder:l}=e,s=o.map((e=>function(e){const{automationActionMenuStore:t,propertyId:o,collectionSchema:n,theme:i}=e,r=n[o];if(!r)return;return{key:o,action:()=>{t.pushSettingsItem({propertyId:o,actionId:void 0,type:"eventActionProperty"})},render:e=>(0,I.jsx)(W.Z,{...e,icon:(0,I.jsx)(B.ZP,{icon:r.icon,size:16,style:{fill:i.regularIconColor,marginRight:6},theme:i,type:r.type}),right:(0,D.o)({marginInlineStart:6,width:12,height:"auto"}),title:r.name})}}({propertyId:e,collectionSchema:n,theme:i,updateCurrentState:r,automationActionMenuStore:t,onClose:a}))).filter(h.$K);if(0===s.length)return;return{key:"page_properties_edited_section",items:s,render:e=>(0,I.jsx)(L.Z,{...e,title:(0,I.jsx)(S.FormattedMessage,{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"}),topBorder:l})}}({automationActionMenuStore:o,properties:b,collectionSchema:x,showTopBorder:(0,h.$K)(T),theme:p,updateCurrentState:d,onClose:u}):void 0,V=M&&k?function(e){const{onUpsellClick:t,showTopBorder:o,theme:n}=e;return{key:"upsell_section",items:[{action:()=>t(),key:"upsell_item",render:e=>(0,I.jsx)(W.Z,{...e,icon:(0,I.jsx)("div",{style:{background:n.accentColors.yellow[50],borderRadius:4,height:20,padding:3,width:20},children:(0,R.K)({fill:n.icon.yellow,height:"100%",width:"100%"})}),right:(0,O.J)({height:"auto",marginBlockStart:2,width:12}),rightStyle:{alignSelf:"start"},caption:(0,I.jsx)(S.FormattedMessage,{defaultMessage:"Automatically set properties, create new pages, and more with automations.",id:"automationEventActionMenu.upsellSection.caption"}),title:(0,I.jsx)(S.FormattedMessage,{defaultMessage:"Upgrade for more actions",id:"automationEventActionMenu.upsellSection.title"}),shouldWrapCaption:!0})}],render:e=>(0,I.jsx)(L.Z,{...e,topBorder:o})}}({onUpsellClick:_,showTopBorder:!j,theme:p}):void 0,F=[T,P].filter(h.$K),Z={key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>(0,I.jsx)(W.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,I.jsx)(S.FormattedMessage,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})})}],render:e=>(0,I.jsx)(L.Z,{...e})},X=(j?[V]:0===F.length?[Z,V]:[...F,V]).filter(h.$K),J=(0,Y.F)({width:266,paddingBottom:2});return J.header=j?void 0:(0,I.jsx)(E.ZP,{onChange:e=>{v(e.target.value)},placeholder:m.formatMessage(Q.searchInputPlaceholder),style:{marginBlock:"12px 2px"},value:f}),g||(J.maxHeight="50vh"),(0,I.jsx)(A.Z,{...J,children:(0,I.jsx)(N.Z,{type:N.i.Vertical,sections:X,initialFocus:0})})}var J=o(10450),ee=o(30823),te=o(99036),oe=o(76218),ne=o(70203),ie=o(53498),re=o(32984);const ae=(0,S.defineMessages)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"}});function le(e){var t;window.__c={n:"AutomationEventActionProperty"};const{actionId:o,automationActionMenuStore:i,automationStore:a,collectionStore:l,onClose:s,propertyId:c,updateCurrentState:d}=e,p=(0,S.useIntl)(),m=(0,P.X)({automationStore:a,collectionStore:l}),y=o??(0,u.ZP)(),h=(0,r.VK)((()=>l.getSchema()[c]),[l,c]),v=(0,n.useMemo)((()=>!!h&&("multi_select"===h.type||(0,te.en)(h)&&1!==h.limit)),[h]),x=Boolean(h&&"button"!==h.type&&"rollup"!==h.type&&"formula"!==h.type&&"text"===(0,ee.vc)(h.type)),C=Boolean(h&&"button"!==h.type&&"rollup"!==h.type&&"formula"!==h.type&&"number"===(0,ee.vc)(h.type)),b=Boolean(h&&"date"===h.type),w=Boolean(h&&"status"===h.type),k=(0,r.VK)((()=>{if(h)return(0,oe.qW)({table:g.v,id:l.id,spaceId:l.getSpaceId()},c,h)}),[l,h,c]),M=(0,r.VK)((()=>{const e=a.getActionStores();if(y&&e.length>0){const t=e.find((e=>e.id===y));if(t&&t.isType("update_pages"))return t.getConfigStore().getKeyStore("values").getKeyStore(c).getValue()}}),[a,y,c]),[j,_]=(0,n.useState)(M),A=(0,n.useRef)(null==M?void 0:M.value),T=(0,oe.A6)(null==j||null===(t=j.value)||void 0===t?void 0:t.value),F=(0,r.VK)((()=>{if(!m)return[];const e=m.context.automationStore.getActionIds().some((e=>e===y));return e?m.getContextValuesForAction(y):m.getAllContextValues()}),[m,y]),Z=(0,n.useCallback)((e=>{d({action:{id:y,config:{properties:[c],target:{id:(0,J.J0)(),type:"variable"},values:{[c]:{action:"replace",value:e}}},type:"update_pages"},type:"update_action"})}),[y,c,d]),K=(0,n.useCallback)((()=>{Z(A.current),s()}),[Z,s]),B=(0,n.useCallback)((e=>{if(A.current=e,x||C||v)_({action:"replace",value:e});else if(b){const t=(0,oe.A6)(null==e?void 0:e.value);0===t.length?K():(0,oe.S3)(t[0])&&(0,ne.fpG)(t[0])&&_({action:"replace",value:e})}}),[b,x,C,v,K]),O=(0,V.F)({automationTriggerActionMenuStore:i,leftStyle:{flexGrow:0},onClose:K,onDone:v||x||C?K:void 0,rightStyle:{flexGrow:0},title:(0,I.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:p.formatMessage(ae.menuHeaderTitle,{propertyName:(0,I.jsx)("div",{style:{...f.Z.textOverflowStyle},children:(null==h?void 0:h.name)??""})})}),titleStyle:{minWidth:0}});if(!h||!k||!m)return null;const R={type:"collection",collectionStore:l,property:c},D=(0,re.li)(h.type);return(0,I.jsx)(ie.a,{context:R,contextStore:m,currentSimpleFormulaValueTokens:T,disabled:!1,formulaTypecheckContextValues:F,menuProps:O,onChange:B,onClose:K,showClearButton:!w,type:k,value:null==j?void 0:j.value,...D})}var se=o(28751),ce=o(8808);function de(e){window.__c={n:"AutomationEventActionUpdatePagesMenu"};const{actionId:t,automationActionMenuStore:o,automationStore:i,collectionStore:r,onClose:a,updateCurrentState:l}=e,s=(0,se.z)("update_pages"),c=(0,P.X)({automationStore:i,collectionStore:r}),d=(0,V.F)({automationTriggerActionMenuStore:o,leftStyle:{flexGrow:0},onClose:a,rightStyle:{flexGrow:0},title:(0,I.jsx)(S.FormattedMessage,{...s.display.name})}),p=(0,n.useCallback)((e=>{l({action:{id:(0,u.ZP)(),config:{properties:[],target:e,values:{}},type:"update_pages"},type:"update_action"}),a()}),[a,l]);return c?(0,I.jsx)(A.Z,{...d,children:(0,I.jsx)(ce.H,{actionId:t,automationContextStore:c,onChange:p,onClose:a,skipPages:!0})}):null}var ue=o(42876);function pe(e){var t;window.__c={n:"AutomationSlackSelectChannelView"};const{automationActionMenuStore:o,updateCurrentAutomationState:i,onClose:r}=e,a="selectChannelUpdate"===e.type?null===(t=e.actionStore)||void 0===t?void 0:t.id:void 0,l=n.useCallback(((e,t)=>{i({type:"update_action",action:{id:a??(0,u.ZP)(),type:"slack_notification",config:{target:e,external_bot_id:t.parent_id}}}),r()}),[a,r,i]),s=(0,n.useCallback)((()=>{const e=o.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?o.popSettingsItem():o.replaceSettingsItem({type:"selectWorkspace"}))}),[o]);return(0,I.jsx)(ue.ZP,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannel:"selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,h.t1)(e),onClose:r,onNotificationChannelSelect:l,onNewSlackAccountAdded:s,renderMenu:e=>(0,I.jsx)(V.Z,{type:"default",automationTriggerActionMenuStore:o,headerTitle:(0,I.jsx)(S.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:r})})}function me(e){window.__c={n:"AutomationActionMenuController"};const{automationStore:t,collectionStore:o,initialState:i,updateCurrentAutomationState:a,buttonPopupParent:l}=e,s=(0,r.VK)((()=>{const e=new b.H0;return e.setState({insertionPoint:void 0,stack:[i]}),e}),[i]),c=(0,r.VK)((()=>s.getCurrentTab()),[s]),d=(0,n.useCallback)((()=>l.close()),[l]);if(!c)return null;if("connectToSlackDefault"===c.type)return(0,I.jsx)(w.Z,{type:"connectToSlackDefault",automationActionMenuStore:s,onClose:d});if("connectToSlackReconnect"===c.type)return(0,I.jsx)(w.Z,{type:"connectToSlackReconnect",externalBotId:c.externalBotId,notificationActionConfigStore:c.notificationActionConfigStore,automationActionMenuStore:s,onClose:d});if("selectWorkspace"===c.type)return(0,I.jsx)(k.Z,{automationActionMenuStore:s,onClose:d});if("selectChannelNew"===c.type)return(0,I.jsx)(pe,{type:"selectChannelNew",updateCurrentAutomationState:a,currentExternalAuthentication:c.currentExternalAuthentication,automationActionMenuStore:s,onClose:d});if("selectChannelUpdate"===c.type)return(0,I.jsx)(pe,{type:"selectChannelUpdate",updateCurrentAutomationState:a,actionStore:c.actionStore,currentExternalAuthentication:c.currentExternalAuthentication,currentNotificationChannel:c.currentNotificationChannel,automationActionMenuStore:s,onClose:d});if("eventActions"===c.type)return(0,I.jsx)(X,{availableActions:c.availableActions,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:d,updateCurrentState:a});if("eventActionProperty"===c.type){const{propertyId:e,actionId:n}=c;return(0,I.jsx)(le,{actionId:n,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:d,propertyId:e,updateCurrentState:a})}return"eventActionCreatePage"===c.type?(0,I.jsx)(F,{automationStore:t,automationActionMenuStore:s,collectionStore:o,onClose:d,updateCurrentState:a}):"eventActionUpdatePages"===c.type?(0,I.jsx)(de,{actionId:c.actionId,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:d,updateCurrentState:a}):(0,h.t1)(c)}var ge=o(31945),ye=o(35294),he=o(28607);function fe(e){window.__c={n:"AutomationActionSelectButton"};const{automationStore:t,initialState:o,updateCurrentAutomationState:n,collectionStore:i}=e,r=(0,ye.d)();return i?(0,I.jsx)(ge.ZP,{alignmentToOrigin:ge.vR.Center,placementToOrigin:ge.pO.Bottom,popupType:r,render:e=>(0,I.jsx)(me,{automationStore:t,buttonPopupParent:e,collectionStore:i,initialState:o,updateCurrentAutomationState:n}),renderOrigin:e=>(0,I.jsx)(Se,{...e})}):(0,I.jsx)(Se,{onClick:()=>{}})}function Se(e){return(0,I.jsx)(he.D,{...e,icon:(0,c.R)({height:24,width:12}),title:(0,I.jsx)(S.FormattedMessage,{...yn.addActionLabel})})}var ve=o(76205),xe=o(36591),Ce=o(54497),be=o(72126),we=o(94166),ke=o(20616),Me=o(68155),je=o(10906),_e=o(73657),Ae=o(40721),Te=o(31278),Pe=o(26388),Ve=o(37034),Ie=o(61766),Fe=o(79797);function Ze(e){window.__c={n:"AutomationCollectionSelectMenu"};const{selectedSourcePointer:t,collectionContextStore:o,onSelect:l,disabled:s}=e,{isMobile:c}=(0,i.Fy)(),d=(0,S.useIntl)(),u=(0,i.O7)(),[p,m]=n.useState(""),g=(0,r.VK)((()=>o.collectionStore()),[o]),y=(0,r.VK)((()=>o.collectionViewBlockStore()),[o]),f=(0,r.VK)((()=>y&&g?y.getCollectionViewStores().filter((e=>{var t;const o=null===(t=e.getCollectionStore())||void 0===t?void 0:t.pointer;return(null==o?void 0:o.id)===g.id})):[]),[y,g]),v=(0,r.VK)((()=>{if(!g)return[];let e;t&&"collection_view"===t.table&&(e=Fe.Xr.createChildStore(g,t));return be.mN([...f,e].filter(h.$K),(e=>{let{id:t}=e;return t})).filter((e=>(0,je.D)(e,p)))}),[g,f,p,t]),x=(0,r.VK)((()=>{if(g&&(0,U.r_)({collectionStore:g,environment:u,intl:d,queryForFilter:p}))return function(e){const{collectionStore:t,environment:o,selectedSourcePointer:n,onSelect:i,isMobile:r,intl:a}=e,l=t.getIcon(),s=(0,Ve.vU)({environment:o,intl:a,store:t}),c=n&&"collection"===n.table&&n.id===t.id,d=t.getSpaceShardedPointer(),u={key:t.id,action:()=>{d&&i(d)},render:e=>(0,I.jsx)(W.Z,{...e,icon:l&&(0,I.jsx)(Te.Z,{isEmptyPage:!1,size:r?18:16,disabled:!0,icon:l}),title:s,caption:(0,I.jsx)(S.FormattedMessage,{id:"AutomationCollectionSelectMenu.collection.caption",defaultMessage:"Any page in this database",values:{collectionName:s}}),right:c&&(0,xe.e)({width:12,height:"auto"})})};return{key:"collection",items:[u],render:e=>(0,I.jsx)(L.Z,{...e,topBorder:!0})}}({collectionStore:g,environment:u,selectedSourcePointer:t,onSelect:l,isMobile:c,intl:d})}),[g,u,d,c,l,p,t]),C=(0,r.VK)((()=>g&&y&&f?function(e){const{blockStore:t,filteredCollectionViewStores:o,collectionStore:n,selectedSourcePointer:i,onSelect:r,intl:a}=e,l=n.getSchema(),s=o.map((e=>{const o=e.getSpaceShardedPointer();if(e.isDefined()&&o){const s=i&&"collection_view"===i.table&&i.id===o.id,c=(0,z.rU)({collectionViewStore:e,collectionSchema:l}),d=(0,h.$K)(c),u=e.getType(),p=e.getFormat().collection_view_icon,m=e.getName(),g=(o,n)=>(0,I.jsx)(W.Z,{...o,...n,icon:(0,I.jsx)(ke.F,{color:"lightGray",viewType:u,viewIcon:p}),title:(0,I.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},children:[(0,I.jsx)(Me.Z,{collectionViewType:u,collectionViewName:m}),d&&s&&(0,Ce.t)({width:16,height:"auto"})]}),caption:(0,I.jsx)(Be,{blockStore:t,collectionViewStore:e,intl:a,collectionSchema:l,referencesIncompatibleProperties:d}),right:s&&(0,xe.e)({width:12,height:"auto"}),disabled:d,disabledFeedback:d});let y;if(d&&c){var n;const e=null===(n=l[c])||void 0===n?void 0:n.type,t=e?U.SO[e]:void 0,o=t?(0,I.jsx)(S.FormattedMessage,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.specific",defaultMessage:"{propertyTypeName} properties are not supported",values:{propertyTypeName:t}}):(0,I.jsx)(S.FormattedMessage,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.default",defaultMessage:"Some properties are not supported"});y=e=>(0,I.jsx)(Pe.ZP,{placement:Pe.ug.Right,renderTooltip:()=>o,render:t=>g(e,t)})}else y=g;return{key:e.id,action:()=>{r(o)},render:y}}}));return[...s].filter(h.$K)}({blockStore:y,collectionStore:g,filteredCollectionViewStores:v,selectedSourcePointer:t,onSelect:l,intl:d}):[]),[y,g,f,v,d,l,t]),b=function(e){const{menuListItems:t}=e;if(0===t.length)return;return{key:"collection-views",items:t,render:e=>(0,I.jsx)(L.Z,{...e,topBorder:!0})}}({menuListItems:C}),w={key:"search",items:[{key:"search_item",action:()=>{},render:()=>(0,I.jsx)(E.ZP,{value:p,focus:!0,style:j.searchBar,textWrapperStyle:j.searchText,onChange:e=>m(e.target.value),placeholder:d.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})})}],render:e=>(0,I.jsx)(L.Z,{...e})};let k;(0,h.$K)(x)||(0,h.$K)(b)||(k={key:"no-results-section",items:[{key:"no-results-item",action:be.ZT,render:()=>(0,I.jsx)(_e.Z,{caption:(0,I.jsx)(S.FormattedMessage,{defaultMessage:"No results",id:"collectionViewSelect.noResults.title"})})}],render:e=>(0,I.jsx)(L.Z,{...e,topBorder:!0})});const M=[w,x,b,k].filter(h.$K),j=function(e){return(0,a.yK)((t=>({button:{marginTop:8},buttonPopup:{width:e?void 0:230},searchBar:{marginTop:8,marginBottom:8},searchText:{marginLeft:8,marginRight:8},buttonRight:{color:t.selectLightGray[500]},menuItemTextWrapper:{...e?{marginLeft:12}:{},minWidth:"auto"}})),[e])}(c),_=(0,r.qz)(void 0,Ie.Z),P=(0,ye.d)();if(!g)return null;const V=(0,I.jsx)(Ke,{pointer:t,collectionStore:g,intl:d});return(0,I.jsx)(ge.ZP,{alignmentToOrigin:ge.vR.End,placementToOrigin:ge.pO.Bottom,popupType:P,style:j.buttonPopup,buttonPopupStore:_,render:e=>{let t;return t=c?{menuType:T.og.Modal,title:(0,I.jsx)(S.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}),right:(0,I.jsx)(Ae.DoneMenuText,{}),onClickRight:()=>{e.close()}}:{menuType:T.og.Popup,width:230,maxHeight:"50vh"},(0,I.jsx)(A.Z,{...t,children:(0,I.jsx)(N.Z,{type:N.i.Vertical,sections:M,initialFocus:0,onAccept:()=>{e.close()}})})},renderOrigin:e=>(0,I.jsx)(we.Z,{title:(0,I.jsx)(S.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}),showChevron:!0,right:V,rightStyle:{flexShrink:1},rotateChevron:_.state.open,disabled:s,textWrapperStyle:j.menuItemTextWrapper,...e})})}function Ke(e){window.__c={n:"AutomationSourceCaption"};const{pointer:t,collectionStore:o,intl:n}=e,l=(0,i.O7)(),s=(0,a.yK)((e=>({warningIcon:{width:16,height:"auto",color:e.accentColors.orange[400]},titleContainer:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,flex:"1 1 auto",minWidth:0},title:{...f.Z.textOverflowStyle},errorText:{color:e.errorText,fontWeight:f.Z.fontWeight.medium}})),[]),c=(0,r.VK)((()=>t?Fe.t1.createChildStore(o,t):void 0),[o,t]),d=(0,r.VK)((()=>c?(0,Ve.vU)({environment:l,intl:n,store:c}):(0,I.jsx)("span",{style:s.errorText,children:(0,I.jsx)(S.FormattedMessage,{id:"AutomationCollectionSelectMenu.source.missing",defaultMessage:"Select database"})})),[l,n,s.errorText,c]),u=(0,r.VK)((()=>{if(!c||c.table===g.v)return!1;const e=o.getSchema();return(0,h.$K)((0,z.rU)({collectionViewStore:c,collectionSchema:e}))}),[o,c]);return(0,I.jsxs)("div",{style:s.titleContainer,children:[u&&(0,Ce.t)(s.warningIcon),(0,I.jsx)("span",{style:s.title,children:d})]})}function Be(e){window.__c={n:"CollectionViewCaption"};const{blockStore:t,collectionViewStore:o,intl:n,collectionSchema:a,referencesIncompatibleProperties:l}=e,s=(0,i.O7)(),c=(0,r.VK)((()=>!o.getAlive()),[o]),d=(0,r.VK)((()=>{const e=o.getParentBlockStore();if(e)return t.id!==e.id?(0,Ve.vU)({environment:s,intl:n,store:e}):void 0}),[t.id,o,n,s]),u=(0,r.VK)((()=>{const e=o.getQuery(a);return(0,ve.OH)({propertyFilters:o.getPropertyFiltersStore().getValue()??[],combinatorFilter:null==e?void 0:e.filter,schema:a}).reduce(((e,t)=>{if((0,ve.aN)(t))return e+1;return e+(t.filters??[]).length}),0)}),[a,o]);return l?(0,I.jsx)(S.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.unsupportedView",defaultMessage:"Not supported"}):c?(0,I.jsx)(S.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.deletedView",defaultMessage:"<emphasis>View not found.</emphasis>",values:{emphasis:e=>(0,I.jsx)("em",{children:e})}}):d?(0,I.jsx)(S.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionDifferentParent",defaultMessage:"<emphasis>View configured in {externalParentBlockName}</emphasis>",values:{emphasis:e=>(0,I.jsx)("em",{children:e}),externalParentBlockName:d}}):0===u?(0,I.jsx)(S.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionWithNoFilters",defaultMessage:"Any page in this view"}):(0,I.jsx)(S.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionWithFilters",defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",values:{ruleCount:u}})}var Oe=o(55950),Re=o(25651),De=o(4023),We=o(56812),Ee=o(84619),Ne=o(64973);function Le(e){window.__c={n:"DeletedPropertyStep"};const{propertyId:t,disabled:o,collectionStore:n,onClick:i}=e,l=(0,a.Fg)(),s="light"===l.mode?50:200,c="light"===l.mode?700:900,d=(0,a.yK)((e=>{const t="light"===e.mode?400:800;return{warning:{color:e.accentColors.orange[t]}}}),[]),u=(0,r.VK)((()=>n.getDeletedSchema()[t]),[n,t]);return(0,I.jsx)(Ne.pW,{disabled:o,icon:e=>(0,Ce.t)({...e,...d.warning}),title:(0,I.jsx)(Ee.ZP,{format:Ee.lo.Medium,value:(0,I.jsx)(S.FormattedMessage,{id:"deletedPropertyStep.deletedProperty.title",defaultMessage:"{propertyName} property deleted",values:{propertyName:null==u?void 0:u.name}}),theme:l,isSingle:!0,backgroundColor:l.accentColors.yellow[s],color:l.accentColors.yellow[c]}),onClick:i})}var He=o(93060);function Ue(e){window.__c={n:"UnsupportedPropertyTriggerAction"};const{disabled:t,onClick:o,onDelete:i,propertySchema:r}=e,l=(0,a.Fg)(),s="light"===l.mode?50:200,c="light"===l.mode?700:900,d=(0,a.yK)((e=>{const t="light"===e.mode?400:800;return{warning:{color:e.accentColors.orange[t]},title:{flexShrink:1,fontSize:12,fontWeight:f.Z.fontWeight.medium},titleWrap:{display:"flex"}}}),[]),u=function(e){const{propertySchema:t}=e,o=U.SO[t.type];return(0,I.jsx)(S.FormattedMessage,{id:"UnsupportedPropertyTriggerAction.unsupportedProperty.title",defaultMessage:"{propertyType} property not supported",values:{propertyType:o}})}({propertySchema:r}),p=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:t,icon:e=>(0,Ce.t)({...e,...d.warning}),onClick:o,onDelete:i,title:(0,I.jsx)("div",{style:d.titleWrap,children:(0,I.jsx)(Ee.ZP,{backgroundColor:l.accentColors.yellow[s],color:l.accentColors.yellow[c],format:Ee.lo.Medium,isSingle:!0,shouldShrink:!0,style:d.title,theme:l,value:u})})})),[s,t,o,i,d.title,d.titleWrap,d.warning,c,l,u]);return(0,I.jsx)(He.y,{renderOrigin:p,title:u,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left})}var ze=o(55863);function $e(e){window.__c={n:"AutomationDeletedPropertyMenu"};const{stepType:t,onDelete:o,onViewDeletedProperties:n}=e,r=(0,Y.F)({width:266}),l=(0,i.Fy)().isMobile,s=(0,a.yK)((e=>({icon:{width:l?"12px":"16px",height:"auto",color:e.accentColors.gray[600]},content:{fontSize:"14px",fontWeight:400}})),[l]);return(0,I.jsx)(A.Z,{...r,children:(0,I.jsx)(N.Z,{type:N.i.Vertical,sections:[{key:"actions-section",items:[{key:"view-deleted-properties",action:()=>{n()},render:e=>(0,I.jsx)(W.Z,{...e,title:(0,I.jsx)("span",{style:s.content,children:(0,I.jsx)(S.FormattedMessage,{id:"automationDeletedPropertyMenu.viewDeletedProperties.title",defaultMessage:"View deleted properties"})}),icon:(0,ze.s)(s.icon)})},{key:"delete-action",action:()=>{o()},render:e=>(0,I.jsx)(W.Z,{...e,title:(0,I.jsx)("span",{style:s.content,children:"action"===t?(0,I.jsx)(S.FormattedMessage,{id:"automationDeletedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,I.jsx)(S.FormattedMessage,{id:"automationDeletedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})}),icon:(0,d.y)(s.icon)})}],render:e=>(0,I.jsx)(L.Z,{...e})}],initialFocus:0})})}var qe=o(47307);const Ge=(0,S.defineMessages)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search for trigger…"},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property"}});function Ye(e){window.__c={n:"AutomationEventTriggerMenu"};const{automationStore:t,automationTriggerMenuStore:o,collectionStore:i,updateCurrentState:l,onClose:d}=e,u=(0,a.Fg)(),p=(0,S.useIntl)(),[m,g]=n.useState(""),y=(0,r.VK)((()=>i.getSchema()),[i]),f=(0,r.VK)((()=>t.getTrigger()),[t]),v=(0,r.VK)((()=>("event"===(null==f?void 0:f.type)||"notification_event"===(null==f?void 0:f.type))&&f.event.pagesAdded),[f]),x=(0,r.VK)((()=>(0,s._X)({collectionFormat:i.getFormat(),collectionSchema:y})),[i,y]),C=(0,z.EF)({collectionSchema:y,propertyIds:x,searchTerm:m}),b=(0,a.yK)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[]),w=(0,Y.F)({maxHeight:"50vh",width:266}),k=(0,I.jsx)(E.ZP,{focus:!0,style:{marginTop:12,marginBottom:6},value:m,onChange:e=>{g(e.target.value)},placeholder:p.formatMessage(Ge.searchInputPlaceholder)}),M=v?void 0:function(e){const{intl:t,searchInput:o,updateCurrentState:n,onClose:i,styles:r}=e,a=t.formatMessage(Ge.pageAddedCopy);if(!K().test(o,a))return;return{key:"page_added_section",items:[{key:"page_added",action:()=>{n({type:"update_trigger",trigger:{type:"page_added"}}),i()},render:e=>(0,I.jsx)(W.Z,{...e,icon:(0,c.R)(r.propertyIcon),title:a})}],render:e=>(0,I.jsx)(L.Z,{...e})}}({intl:p,searchInput:m,updateCurrentState:l,onClose:d,styles:b}),j=(0,r.VK)((()=>function(e){const{automationTriggerValue:t,automationTriggerMenuStore:o,showTopBorder:n,properties:i,collectionSchema:r,theme:a,updateCurrentState:l,onClose:c,intl:d,searchInput:u,styles:p}=e,m=d.formatMessage(Ge.pagePropertiesEditedCopy);let g=!1,y=[];"event"!==(null==t?void 0:t.type)&&"notification_event"!==(null==t?void 0:t.type)||(g="any"===t.event.pagePropertiesEdited.type,y="some"===t.event.pagePropertiesEdited.type?t.event.pagePropertiesEdited.some:[]);const f=[g||!K().test(u,m)?void 0:{key:"any_property_edited",action:async()=>{const e=await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await qe.confirmUserAction({message:(0,I.jsx)(S.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?"}),description:(0,I.jsx)(S.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers."}),acceptLabel:(0,I.jsx)(S.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace"})})}({hasSpecificPropertyChangedFilters:y.length>0});e&&(l({type:"update_trigger",trigger:{type:"any_page_property_edited"}}),c())},render:e=>(0,I.jsx)(W.Z,{...e,icon:(0,Re.R)(p.propertyIcon),title:m})},...i.map((e=>{if(!y.find((t=>t.property===e)))return function(e){const{automationTriggerMenuStore:t,propertyId:o,collectionSchema:n,theme:i,updateCurrentState:r,onClose:a}=e,l=n[o];if(!l)return;const c=(0,s.bD)(l);return{key:o,action:()=>{c?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(r({type:"update_trigger",trigger:{type:"property_changed",property:o,filter:{operator:"changes_to_any"}}}),a())},render:e=>(0,I.jsx)(W.Z,{...e,icon:(0,I.jsx)(B.ZP,{icon:l.icon,type:l.type,size:16,theme:i}),title:l.name,right:c?(0,D.o)({marginLeft:6,width:12,height:"auto"}):void 0})}}({propertyId:e,collectionSchema:r,theme:a,updateCurrentState:l,automationTriggerMenuStore:o,onClose:c})})).filter(h.$K)].filter(h.$K);if(0===f.length)return;return{key:"page_properties_edited_section",items:f,render:e=>(0,I.jsx)(L.Z,{...e,topBorder:n,title:(0,I.jsx)(S.FormattedMessage,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Property edited"})})}}({automationTriggerValue:f,automationTriggerMenuStore:o,showTopBorder:Boolean(M),properties:C,collectionSchema:y,theme:u,updateCurrentState:l,onClose:d,searchInput:m,intl:p,styles:b})),[f,o,M,C,y,u,l,d,m,p,b]),_=n.useMemo((()=>{const e=[M,j].filter(h.$K);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>(0,I.jsx)(W.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,I.jsx)(S.FormattedMessage,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results"})})}],render:e=>(0,I.jsx)(L.Z,{...e})}]:e}),[M,j]);return(0,I.jsx)(A.Z,{...w,header:k,children:(0,I.jsx)(N.Z,{type:N.i.Vertical,sections:_,initialFocus:0})})}function Qe(e){window.__c={n:"AutomationCheckboxPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:i,propertySchema:a,propertyChangedFilter:l,onClose:s}=e,c=(0,r.VK)((()=>"changes_to_any"===l.operator?[{type:"exact",value:!0},{type:"exact",value:!1}]:(0,ve.XA)(l)&&(0,ve.vR)(l)?Array.isArray(l.value)?l.value:[l.value]:[]),[l]),[d,u]=(0,n.useState)(c),p=(0,n.useMemo)((()=>1===d.length?{operator:"checkbox_is",value:d[0]}:{operator:"changes_to_any"}),[d]),m=(0,n.useMemo)((()=>2===d.length||1===d.length&&"partial"),[d]),g=(0,n.useCallback)((e=>{const t=Boolean(d.find((t=>t.value===e)));u(t?d.filter((t=>t.value!==e)):[...d,{type:"exact",value:e}])}),[d]),y=(0,n.useCallback)((()=>{(0,z.WM)({anyOptionCheckState:m,propertyId:t,updateCurrentState:o,currentFilter:p}),s()}),[m,p,s,t,o]),h=Boolean(d.find((e=>!0===e.value))),f=Boolean(d.find((e=>!1===e.value)));return(0,I.jsx)(V.Z,{type:"default",automationTriggerActionMenuStore:i,onDone:y,onClose:s,sections:[{key:"select",render:e=>(0,I.jsx)(L.Z,{...e,topBorder:!0}),items:[{key:"unchecked",render:e=>(0,I.jsx)(W.Z,{...e,checkState:f,isTokenTitle:!0,title:(0,I.jsx)(S.FormattedMessage,{defaultMessage:"Unchecked",id:"automations.propertyTrigger.checkbox.unchecked"})}),action:()=>g(!1)},{key:"checked",render:e=>(0,I.jsx)(W.Z,{...e,checkState:h,isTokenTitle:!0,title:(0,I.jsx)(S.FormattedMessage,{defaultMessage:"Checked",id:"automations.propertyTrigger.checkbox.checked"})}),action:()=>g(!0)}]}],headerTitle:(0,I.jsx)(S.FormattedMessage,{id:"automations.propertyTrigger.checkbox.title",defaultMessage:"{propertyName} set to",values:{propertyName:a.name}})})}var Xe=o(80951),Je=o(56416),et=o(60458),tt=o(22084),ot=o(47082);function nt(e){window.__c={n:"AutomationSelectPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:a,propertySchema:l,propertyChangedFilter:s,onClose:c}=e,{isMobile:d,isAndroid:u}=(0,i.Fy)(),p=(0,S.useIntl)(),m=(0,r.VK)((()=>{if("changes_to_any"===s.operator){return(l.options??[]).map((e=>({type:"exact",value:e.value})))}if(!(0,ve.dx)(s)&&!(0,ve.NU)(s))return[];if((0,ve.vR)(s)){const e=(l.options??[]).map((e=>e.value));return(Array.isArray(s.value)?s.value:[s.value]).filter((t=>(0,h.$K)(t.value)&&e.includes(t.value)))}return[]}),[l,s]),[g,y]=n.useState(m),f=(0,r.VK)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let n=!1,i=!0;const r=t.options??[];for(const a of r){const e=o.some((e=>e.value===a.value));n||=e,i&&=e}return!!i||!!n&&"partial"}({propertySchema:l,selectedOptions:g})),[l,g]),v=n.useMemo((()=>(l.options??[]).map((e=>({type:"exact",value:e.value})))),[l]),x=n.useMemo((()=>"multi_select"===l.type?{operator:"enum_contains",value:g}:"select"===l.type?{operator:"enum_is",value:g}:(0,h.t1)(l)),[l,g]),C=!0===f?[]:g.map((e=>{if(!e.value||!l.options)return;const t=(0,Xe.i7)(l.options,e.value);return t?(0,I.jsx)(tt.a,{format:d?Ee.lo.Large:Ee.lo.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=be.zu(g,e);y(t)}},t.id):void 0})),[b,w]=n.useState(""),k=(0,Je.I4)({query:b,propertySchema:l,selectedValues:g,updateValue:e=>{w(""),y(e)},isMobile:d,styles:{}}),M=[{key:"search",items:[{key:"input",action:()=>{},render:e=>(0,I.jsx)(ot.Z,{...e,focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:ot.U.FilterValue,tokens:C,placeholder:f?p.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption"}):p.formatMessage({defaultMessage:"Select one or more options…",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder"}),onRemoveLastToken:()=>{const e=g.slice(0,g.length-1);y(e)},onClearButtonClick:()=>{y([]),c()},value:b,onChange:e=>{w(e.target.value)},dontShowBorderBottom:u,showClearButton:!0})}],render:e=>(0,I.jsx)(L.Z,{...e})},{key:"any",items:[{key:"any-option-item",action:()=>{!0===f?y([]):!1===f||"partial"===f?y(v):(0,h.t1)(f),w("")},render:e=>(0,I.jsx)(W.Z,{...e,icon:(0,I.jsx)(et.Z,{checked:f,size:14,onClick:e.onClick}),title:(0,I.jsx)(S.FormattedMessage,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,I.jsx)(L.Z,{...e,topBorder:!0})},k.length>0?{key:"items",items:k,render:e=>(0,I.jsx)(L.Z,{...e,topBorder:!0})}:void 0].filter(h.$K);return(0,I.jsx)(V.Z,{type:"default",automationTriggerActionMenuStore:a,onDone:()=>{(0,z.WM)({anyOptionCheckState:f,propertyId:t,updateCurrentState:o,currentFilter:x}),c()},onClose:c,sections:M,headerTitle:(0,I.jsx)(S.FormattedMessage,{id:"automations.propertyChangedFilterHeader.select.title",defaultMessage:"{propertyName} set to",values:{propertyName:l.name}})})}var it=o(11299),rt=o(97004);function at(e){window.__c={n:"AutomationStatusPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:a,propertySchema:l,propertyChangedFilter:s,onClose:c}=e,{isMobile:d}=(0,i.Fy)(),u=(0,r.VK)((()=>{if("changes_to_any"===s.operator){return(l.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,ve.r2)(s)&&(0,ve.vR)(s)?(0,ve.wB)(s):[]}),[l,s]),[p,m]=n.useState(u),g=(0,r.VK)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e,n=t.groups??[],i=t.options??[],r=n.map((e=>(0,rt.IX)({group:e,options:i,filterValues:o}))),a=r.every((e=>!0===e.groupCheckState)),l=r.some((e=>!1!==e.groupCheckState));return!!a||!!l&&"partial"}({propertySchema:l,selectedStatusOptions:p})),[l,p]),y=n.useMemo((()=>(l.groups??[]).map((e=>({type:"is_group",value:e.name})))),[l]),f=(0,it.S)({propertySchema:l,statusFilterValues:p,updateValue:e=>{m(e)},isMobile:d,styles:{},visibleOptions:l.options??[]});return(0,I.jsx)(V.Z,{type:"default",automationTriggerActionMenuStore:a,onDone:()=>{(0,z.WM)({anyOptionCheckState:g,propertyId:t,updateCurrentState:o,currentFilter:{operator:"status_is",value:p}}),c()},onClose:()=>{c()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===g?m([]):!1===g||"partial"===g?m(y):(0,h.t1)(g)},render:e=>(0,I.jsx)(W.Z,{...e,icon:(0,I.jsx)(et.Z,{checked:g,size:14,onClick:e.onClick}),title:(0,I.jsx)(S.FormattedMessage,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,I.jsx)(L.Z,{...e})},{key:"items",items:f,render:e=>(0,I.jsx)(L.Z,{...e,topBorder:!0})}],headerTitle:(0,I.jsx)(S.FormattedMessage,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",values:{propertyName:l.name}})})}function lt(e){window.__c={n:"AutomationEventTriggerPropertyChangedFilterMenu"};const{automationStore:t,propertyId:o,automationTriggerMenuStore:n,collectionStore:i,updateCurrentState:a,onClose:l}=e,c=(0,r.VK)((()=>i.getSchema()),[i])[o],d=(0,r.VK)((()=>t.getTrigger()),[t]);let u=[];"event"!==(null==d?void 0:d.type)&&"notification_event"!==(null==d?void 0:d.type)||(u="some"===d.event.pagePropertiesEdited.type?d.event.pagePropertiesEdited.some:[]);const p=u.find((e=>e.property===o))??{property:o,filter:{operator:"changes_to_any"}};if(!c)return null;return(0,s.bD)(c)?"multi_select"===c.type||"select"===c.type?(0,I.jsx)(nt,{propertyId:o,updateCurrentState:a,automationTriggerMenuStore:n,propertySchema:c,propertyChangedFilter:p.filter,onClose:l}):"status"===c.type?(0,I.jsx)(at,{propertyId:o,updateCurrentState:a,automationTriggerMenuStore:n,propertySchema:c,propertyChangedFilter:p.filter,onClose:l}):"checkbox"===c.type?(0,I.jsx)(Qe,{automationTriggerMenuStore:n,onClose:l,propertyChangedFilter:p.filter,propertyId:o,propertySchema:c,updateCurrentState:a}):null:null}function st(e){window.__c={n:"AutomationTriggerMenuController"};const{automationStore:t,collectionStore:o,initialState:i,updateCurrentAutomationState:a,buttonPopupParent:l}=e,s=(0,r.VK)((()=>{const e=new b.Bh;return e.setState({insertionPoint:void 0,stack:[i]}),e}),[i]),c=(0,r.VK)((()=>s.getCurrentTab()),[s]),d=(0,n.useCallback)((()=>l.close()),[l]);return c?"eventTriggers"===c.type?(0,I.jsx)(Ye,{automationStore:t,automationTriggerMenuStore:s,collectionStore:o,updateCurrentState:a,onClose:d}):"propertyChangedFilter"===c.type?(0,I.jsx)(lt,{automationStore:t,propertyId:c.property,automationTriggerMenuStore:s,collectionStore:o,updateCurrentState:a,onClose:d}):(0,h.t1)(c):null}var ct=o(86034);function dt(e){window.__c={n:"AutomationAnyEditPropertyTrigger"};const{disabled:t,onDelete:o,onClick:i,propertySchema:r,onEdit:l}=e,s=(0,S.useIntl)(),c=(0,a.Fg)(),d=(0,a.yK)((()=>({propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold},wrap:{display:"inline-flex",width:"100%"}})),[]),u=(0,I.jsx)("span",{style:d.propertyName,children:r.name}),p=(0,We.$G)(s,{propertyName:u}),m=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:t,onClick:i,icon:e=>(0,I.jsx)(B.ZP,{size:16,theme:c,icon:r.icon,style:e,type:r.type}),title:(0,I.jsx)("span",{style:d.wrap,children:p}),onEdit:l,onDelete:o})),[t,i,o,l,r.icon,r.type,d.wrap,c,p]);return(0,I.jsx)(He.y,{renderOrigin:m,title:p,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left})}var ut=o(20239);function pt(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;if("changes_to_any"===t.operator)return(0,I.jsx)(dt,{disabled:r,propertySchema:o,onClick:n,onEdit:n,onDelete:i});{const e={filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r};return(0,I.jsx)(mt,{...e})}}function mt(e){window.__c={n:"ParametrizableCheckboxPropertyTriggerFilter"};const{filter:t,propertySchema:o,onEdit:i,onDelete:r,disabled:l}=e,s=(0,S.useIntl)(),c=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold}})),[]);let d,u;(0,ve.vR)(t)&&(d=(0,ut.zR)({filter:t,intl:s,propertySchema:o,styles:c}),u=(0,ut.l4)({filter:t,intl:s,propertySchema:o}));const p=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:l,icon:B.wG[o.type],onClick:i,onEdit:i,onDelete:r,title:(0,I.jsx)("div",{style:c.content,children:d})})),[l,r,i,o.type,c.content,d]);return d&&u?(0,I.jsx)(He.y,{renderOrigin:p,title:u,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left}):null}var gt=o(65380),yt=o(76954);const ht=5;function ft(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;if("changes_to_any"===t.operator)return(0,I.jsx)(dt,{disabled:r,propertySchema:o,onClick:n,onEdit:n,onDelete:i});{const e={filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r};return(0,I.jsx)(St,{...e})}}function St(e){window.__c={n:"ParametrizableSelectPropertyTriggerFilter"};const{filter:t,propertySchema:o,onEdit:i,onDelete:r,disabled:l}=e,s=(0,S.useIntl)(),c=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold}})),[]);let d,u;if((0,ve.vR)(t)){const e=t.value,n=o.name,i=(Array.isArray(e)?e:[e]).map((e=>e.value)).filter(h.$K),r=(0,yt.z)({intl:s,limit:ht,optionValues:i,propertySchema:o}),a=s.formatList(r,{style:"long",type:"disjunction"}),l=(0,yt.z)({intl:s,isText:!0,limit:ht,optionValues:i,propertySchema:o}),p=s.formatList(l,{style:"long",type:"disjunction"});d=(0,We.XJ)(s,{propertyName:(0,I.jsx)("span",{style:c.propertyName,children:n}),propertyValues:(0,gt.H)(a)}),u=(0,We.XJ)(s,{propertyName:(0,I.jsx)("span",{style:c.propertyName,children:n}),propertyValues:(0,gt.H)(p)})}const p=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:l,icon:B.wG[o.type],onClick:i,onDelete:r,onEdit:i,title:(0,I.jsx)("div",{style:c.content,children:d})})),[l,r,i,o.type,c.content,d]);return d&&u?(0,I.jsx)(He.y,{renderOrigin:p,title:u,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left}):null}var vt=o(3729),xt=o(87181);const Ct=5;function bt(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;return"changes_to_any"===t.operator?(0,I.jsx)(dt,{disabled:r,propertySchema:o,onClick:n,onDelete:i,onEdit:n}):(0,I.jsx)(wt,{...e,filter:t})}function wt(e){window.__c={n:"ParametrizableStatusPropertyTriggerFilter"};const{filter:t,limit:o=Ct,propertySchema:i,onEdit:r,onDelete:l,disabled:s}=e,c=(0,S.useIntl)(),d=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold}})),[]);let u,p;if((0,ve.vR)(t)){const e=i.name,n=(0,ve.wB)(t),r=n.map((e=>"is_group"===e.type?e.value:void 0)).filter(h.$K),a=n.map((e=>"is_option"===e.type?e.value:void 0)).filter(h.$K),l=(0,xt.L)({intl:c,groupValues:r,limit:o,optionValues:a,propertySchema:i}),s=c.formatList(l,{style:"long",type:"disjunction"}),m=(0,xt.L)({intl:c,isText:!0,groupValues:r,limit:o,optionValues:a,propertySchema:i}),g=c.formatList(m,{style:"long",type:"disjunction"});u=(0,We.VO)(c,{propertyName:(0,I.jsx)("span",{style:d.propertyName,children:e}),propertyValues:(0,gt.H)(s)}),p=(0,We.VO)(c,{propertyName:(0,I.jsx)("span",{style:d.propertyName,children:e}),propertyValues:(0,gt.H)(g)})}const m=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:s,icon:vt.T,title:(0,I.jsx)("div",{style:d.content,children:u}),onEdit:r,onDelete:l,onClick:r})),[s,l,r,d.content,u]);return u&&p?(0,I.jsx)(He.y,{renderOrigin:m,title:p,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left}):null}function kt(e){window.__c={n:"AutomationTriggerList"};const{automationStore:t,collectionStore:o,disabled:i,handleNavigateToDeletedProperties:a,updateCurrentState:l}=e,c=(0,ye.d)(),d=(0,r.VK)((()=>o.getSchema()),[o]),u=(0,r.VK)((()=>t.getTriggerStore().getKeyStore("event").getValue()),[t]),p=(0,n.useCallback)((e=>{l({type:"remove_trigger",trigger:{type:"property_changed",property:e,filter:{operator:"changes_to_any"}}})}),[l]),m=At(),g=[];return null!=u&&u.pagesAdded&&g.push((0,I.jsx)(jt,{disabled:i,updateCurrentState:l},"page_added_trigger")),"any"===(null==u?void 0:u.pagePropertiesEdited.type)&&g.push((0,I.jsx)(_t,{disabled:i,updateCurrentState:l},"any_page_property_edited_trigger")),"some"===(null==u?void 0:u.pagePropertiesEdited.type)&&g.push(...u.pagePropertiesEdited.some.map((e=>{const{property:r,filter:u}=e,m=d[r];return m?s.Ym[m.type]?"status"!==m.type||"changes_to_any"!==u.operator&&!(0,ve.r2)(u)?"select"!==m.type||"changes_to_any"!==u.operator&&!(0,ve.dx)(u)?"multi_select"!==m.type||"changes_to_any"!==u.operator&&!(0,ve.NU)(u)?"checkbox"!==m.type||"changes_to_any"!==u.operator&&!(0,ve.XA)(u)?"changes_to_any"===u.operator?(0,I.jsx)(dt,{disabled:i,onClick:e=>{e.setState({open:!0})},propertySchema:m,onDelete:()=>{p(r)}},`changes_to_any_${r}_trigger`):void 0:(0,I.jsx)(Mt,{automationStore:t,collectionStore:o,property:r,renderOrigin:e=>{let{onClick:t}=e;return(0,I.jsx)(pt,{disabled:i,filter:u,propertySchema:m,onEdit:t,onDelete:()=>{p(r)}})},updateCurrentState:l},`changes_to_any_${r}_trigger`):(0,I.jsx)(Mt,{property:r,automationStore:t,collectionStore:o,updateCurrentState:l,renderOrigin:e=>{let{onClick:t}=e;return(0,I.jsx)(ft,{disabled:i,filter:u,propertySchema:m,onEdit:t,onDelete:()=>{p(r)}})}},`changes_to_any_${r}_trigger`):(0,I.jsx)(Mt,{property:r,automationStore:t,collectionStore:o,updateCurrentState:l,renderOrigin:e=>{let{onClick:t}=e;return(0,I.jsx)(ft,{disabled:i,filter:u,propertySchema:m,onEdit:t,onDelete:()=>{p(r)}})}},`changes_to_any_${r}_trigger`):(0,I.jsx)(Mt,{automationStore:t,property:r,collectionStore:o,updateCurrentState:l,renderOrigin:e=>{let{onClick:t}=e;return(0,I.jsx)(bt,{disabled:i,filter:u,propertySchema:m,onEdit:t,onDelete:()=>{p(r)}})}},`changes_to_any_${r}_trigger`):(0,I.jsx)(ge.ZP,{alignmentToOrigin:ge.vR.Center,placementToOrigin:ge.pO.Bottom,popupType:c,render:()=>(0,I.jsx)(ct.Iw,{propertyId:r}),renderOrigin:e=>(0,n.createElement)(Ue,{...e,key:`unsupported_${r}_trigger`,disabled:i,onClick:()=>e.onClick(),propertySchema:m})},`unsupported_property_${r}_trigger`):(0,I.jsx)(ge.ZP,{alignmentToOrigin:ge.vR.Center,placementToOrigin:ge.pO.Bottom,popupType:c,render:()=>(0,I.jsx)($e,{stepType:"trigger",onDelete:()=>{l({type:"remove_trigger",trigger:{filter:u,property:r,type:"property_changed"}})},onViewDeletedProperties:a}),renderOrigin:e=>(0,I.jsx)(Le,{...e,disabled:i,propertyId:r,collectionStore:o})},`deleted_property_${r}_trigger`)})).filter(h.$K)),(0,I.jsx)("ul",{style:m.stepList,children:g.map(((e,t)=>(0,I.jsx)("li",{style:0===t?{}:m.stepItemWithBorderTop,children:e},t)))})}function Mt(e){window.__c={n:"AdvancedTriggerPopup"};const{automationStore:t,renderOrigin:o,collectionStore:n,property:i,updateCurrentState:r}=e,a=(0,ye.d)();return(0,I.jsx)(ge.ZP,{popupType:a,renderOrigin:o,render:e=>(0,I.jsx)(st,{automationStore:t,collectionStore:n,initialState:{type:"propertyChangedFilter",property:i},updateCurrentAutomationState:r,buttonPopupParent:e})})}function jt(e){window.__c={n:"AutomationTriggerPagedAdded"};const{disabled:t,updateCurrentState:o}=e,i=(0,S.useIntl)(),r=At(),a=We.Mz(i),l=(0,n.useCallback)((e=>{e.setState({open:!0})}),[]),s=(0,n.useCallback)((()=>o({trigger:{type:"page_added"},type:"remove_trigger"})),[o]),d=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:t,icon:c.R,onClick:l,onDelete:s,title:(0,I.jsx)("div",{style:r.semiBoldTitle,children:a})})),[t,l,s,r.semiBoldTitle,a]);return(0,I.jsx)(He.y,{renderOrigin:d,title:a,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left})}function _t(e){window.__c={n:"AutomationTriggerAnyPropertyEdited"};const{disabled:t,updateCurrentState:o}=e,i=(0,S.useIntl)(),r=At(),a=We.c5(i),l=(0,n.useCallback)((e=>{e.setState({open:!0})}),[]),s=(0,n.useCallback)((()=>{o({type:"remove_trigger",trigger:{type:"any_page_property_edited"}})}),[o]),c=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:t,onClick:l,icon:Re.R,title:(0,I.jsx)("div",{style:r.semiBoldTitle,children:a}),onDelete:s})),[t,l,s,r.semiBoldTitle,a]);return(0,I.jsx)(He.y,{renderOrigin:c,title:a,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left})}function At(){return(0,a.yK)((e=>({stepList:{border:`1px solid ${e.stroke.regular}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},semiBoldTitle:{fontWeight:f.Z.fontWeight.semibold},stepItemWithBorderTop:{borderTop:`1px solid ${e.stroke.regular}`}})),[])}var Tt=o(35102),Pt=o(51592),Vt=o(85740),It=o(28267),Ft=o(64737),Zt=o(73266),Kt=o(73239),Bt=o(29180),Ot=o(37989),Rt=o(43690),Dt=o(149),Wt=o(52105);function Et(e){window.__c={n:"UpdatePagesActionDatabaseAutomation"};const{actionStore:t,updateCurrentAutomationState:o}=e,i=t.id,a=(0,r.VK)((()=>t.getConfig()),[t]),l=(0,n.useCallback)((e=>{var t;const n="collection"===e.type&&"collection"===(null==a||null===(t=a.target)||void 0===t?void 0:t.type)&&e.collection.id!==(null==a?void 0:a.target.collection.id);o({action:{config:{...a,target:e,properties:n?[]:(null==a?void 0:a.properties)??[],values:n?{}:(null==a?void 0:a.values)??{}},id:i,type:"update_pages"},type:"update_action"})}),[a,i,o]),s=(0,n.useCallback)(((e,t)=>{o({action:{config:{...a,properties:e,values:t},id:i,type:"update_pages"},type:"update_action"})}),[i,a,o]),c=(0,n.useCallback)((()=>{o({action:{config:a,id:i,type:"update_pages"},type:"remove_action"})}),[a,i,o]);return(0,I.jsx)(Nt,{...e,onConfigChange:s,onDelete:c,onTargetChange:l})}function Nt(e){window.__c={n:"UpdatePagesActionV2"};const{actionStore:t,automationStore:o,collectionStore:i,disabled:l,onConfigChange:s,onDelete:c,onTargetChange:d}=e,u=(0,n.useRef)(null),p=(0,It.X)(u),m=(0,Zt.a)(p),[g,y]=(0,n.useState)(!1),f=(0,se.z)("update_pages"),S=(0,P.X)({automationStore:o,collectionStore:i}),v=(0,r.VK)((()=>{const e=t.getVariableTargetStore();if(e)return e.getValue();const o=t.getCollectionTargetStore();if(o){const e=o.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[t]),[x,C,b]=(0,r.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.target,null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),w=(0,n.useMemo)((()=>({values:b??{},properties:C??[]})),[b,C]),k=(0,r.VK)((()=>"collection"===(null==v?void 0:v.type)),[v]),M=(0,r.VK)((()=>{const e=t.getTargetStore().getValue();if(e&&S){if("collection"===e.type)return Fe.NW.createChildStore(S.context.parentRecordStore,e.collection);if("variable"===e.type){const t=S.compilationResultStore.state;if(Dt.x.isFail(t))return;const o=(0,Tt.vx)(t.value.valueTypes,e.id);if(o)return(0,z.wB)(o,S.context.parentRecordStore)}else{if("page"===e.type)return;(0,h.t1)(e)}}}),[t,S]),j=(0,r.VK)((()=>{if("collection"!==(null==x?void 0:x.type))return;const e=x.filter;return(0,h.$K)(e)?(0,Rt.Ih)(e,(null==M?void 0:M.getSchema())??{}):void 0}),[x,M]),_=(0,n.useCallback)((e=>{if(!(0,h.$K)(x))return void d(e);const t=x.type!==e.type,o="variable"===x.type&&"variable"===e.type&&x.id!==e.id,n="collection"===x.type&&"collection"===e.type&&x.collection.id!==e.collection.id;(t||o||n)&&d(e)}),[x,d]),A=(0,n.useCallback)((e=>{(0,h.$K)(x)&&"collection"===x.type&&(be.Xy(x.filter,e)||d({...x,filter:e}))}),[x,d]),T=(0,n.useCallback)((e=>{const t=w.properties.concat([e]);s(t,w.values)}),[s,w]),V=(0,n.useCallback)(((e,t)=>{const o=w.properties.indexOf(e);if(-1===o)return;const n=w.properties.slice(0);n[o]=t;const i={...w.values,[t]:void 0};s(n,i)}),[s,w]),F=(0,n.useCallback)((e=>{const t=w.properties.filter((t=>t!==e)),o={...w.values,[e]:void 0};s(t,o)}),[s,w]),Z=(0,n.useCallback)(((e,t)=>{const o={...w.values,[e]:t};s(w.properties,o)}),[s,w]),K=(0,n.useCallback)((()=>{y(!0)}),[]),B=(0,n.useCallback)((()=>{y(!1)}),[]),O=(0,a.yK)((e=>({sectionWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:m?12:16,paddingBlock:12,paddingInline:12},headerTitle:{alignItems:"center",display:"flex",flexWrap:"wrap",minWidth:100,whiteSpace:"pre"}})),[m]);return S?(0,I.jsxs)("section",{onMouseEnter:K,onMouseLeave:B,ref:u,style:O.sectionWrap,children:[(0,I.jsxs)(Ut,{disabled:l,icon:f.display.icon({height:21,width:14}),isHovered:g,onDelete:c,children:[(0,I.jsx)("div",{style:O.headerTitle,children:(0,I.jsx)(Lt,{actionStore:t,automationContextStore:S,disabled:l,onChange:_,value:v})}),k&&(0,h.$K)(M)&&(0,I.jsx)("div",{style:O.headerTitle,children:(0,I.jsx)(Ht,{collectionStore:M,disabled:l,filter:j,onChange:A})})]}),M&&(0,I.jsx)(re.vV,{actionId:t.id,collectionStore:M,config:w,contextStore:S,disabled:l,onPropertyAdd:T,onPropertyChange:V,onPropertyRemove:F,onPropertyValueChange:Z,showSetPropertyActions:!0})]}):null}function Lt(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,onChange:i,value:r}=e,l=(0,a.yK)((()=>({b:{fontWeight:f.Z.fontWeight.medium},picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Vt.H)({})}})),[]);return(0,I.jsx)(S.FormattedMessage,{defaultMessage:"<span>Update <b>pages</b> in </span>{collectionPicker}",id:"automations.UpdatePagesActionV2.header.title",values:{b:e=>(0,I.jsx)("b",{style:l.b,children:e}),collectionPicker:(0,I.jsx)("div",{style:l.picker,children:(0,I.jsx)(Kt.a,{actionStore:t,contextStore:o,currentValue:r,disabled:n,onChange:i})}),span:e=>(0,I.jsx)("span",{style:l.span,children:e})}})}function Ht(e){window.__c={n:"CollectionFilterTitle"};const{collectionStore:t,disabled:o,filter:n,onChange:l}=e,s=(0,i.O7)(),c=(0,S.useIntl)(),d=(0,r.VK)((()=>(0,Ve.vU)({environment:s,intl:c,store:t})),[t,c,s]),u=(0,a.yK)((()=>({picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Vt.H)({})}})),[]);return(0,I.jsx)(S.FormattedMessage,{defaultMessage:"<span>that match </span>{filterPicker}",id:"automations.UpdatePagesActionV2.header.filterTitle",values:{filterPicker:(0,I.jsx)("div",{style:u.picker,children:(0,I.jsx)(Wt.W,{collectionStore:t,disabled:o,filter:n,noFiltersMessage:(0,h.$K)(d)?(0,I.jsx)(S.FormattedMessage,{defaultMessage:"All pages in {collectionName}",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.label",values:{collectionName:d}}):(0,I.jsx)(S.FormattedMessage,{defaultMessage:"All pages in database",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.fallbackLabel"}),onChange:l})}),span:e=>(0,I.jsx)("span",{style:u.span,children:e})}})}function Ut(e){window.__c={n:"ActionHeader"};const{children:t,disabled:o,icon:n,isHovered:r,onDelete:l}=e,{isMobile:s}=(0,i.Fy)(),[c,d]=(0,Ot.Z)(),u=!o&&(s||r||d),p=(0,a.yK)((()=>({wrap:{alignItems:"start",cursor:o?"default":void 0,opacity:o?.4:void 0,display:"flex",gap:6,minHeight:28},iconWrap:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Vt.H)({})},titleWrap:{display:"flex",flex:"1 1 auto",flexWrap:"wrap",fontSize:14,lineHeight:1.4,minWidth:0},moreButtonWrap:{flex:"0 0 26px"}})),[o]);return(0,I.jsxs)("header",{ref:c,style:p.wrap,children:[n&&(0,I.jsx)("div",{style:p.iconWrap,children:n}),(0,I.jsx)("div",{style:p.titleWrap,children:t}),(0,I.jsx)("div",{style:p.moreButtonWrap,children:u&&(0,I.jsx)(Ne.mv,{disabled:o,onDelete:l})})]})}function zt(e){window.__c={n:"CreatePageActionDatabaseAutomation"};const{actionStore:t,updateCurrentAutomationState:o}=e,i=t.id,a=(0,r.VK)((()=>t.getConfig()),[t]),l=(0,n.useCallback)((e=>{o({action:{config:{...a,collection:e,properties:["title"],values:{},template_page_id:void 0},id:i,type:"create_page"},type:"update_action"})}),[i,a,o]),s=(0,n.useCallback)((e=>{if(!a)return;const{properties:t,values:n}=a;let r=!1;if(e&&t&&1===t.length&&t.includes("title")){var l;const e=null==n?void 0:n.title;e&&null!==(l=e.value)&&void 0!==l&&l.value||(r=!0)}o({action:{config:{...a,template_page_id:e,...r&&{properties:[]}},id:i,type:"create_page"},type:"update_action"})}),[i,a,o]),c=(0,n.useCallback)(((e,t)=>{o({action:{config:{...a,properties:e,values:t},id:i,type:"create_page"},type:"update_action"})}),[i,a,o]),d=(0,n.useCallback)((()=>{o({action:{config:a,id:i,type:"create_page"},type:"remove_action"})}),[a,i,o]);return(0,I.jsx)($t,{...e,onConfigChange:c,onDelete:d,onTargetCollectionChange:l,onTemplateChange:s})}function $t(e){window.__c={n:"CreatePageActionV2"};const{actionStore:t,automationStore:o,collectionStore:i,disabled:l,onConfigChange:s,onDelete:c,onTargetCollectionChange:d,onTemplateChange:u}=e,p=(0,n.useRef)(null),m=(0,It.X)(p),g=(0,Zt.a)(m),y=(0,se.z)("create_page"),[f,S]=(0,n.useState)(!1),[v,x,C]=(0,r.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.collection,null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),b=(0,r.VK)((()=>{if(v)return Fe.NW.createChildStore(i,v)}),[i,v]),w=(0,r.VK)((()=>{const e=t.getCollectionStore();if(e)return{collection:e.getSpaceShardedPointer(),type:"collection"}}),[t]),k=(0,r.VK)((()=>(0,Ft.q)(b).length>0),[b]),M=(0,r.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.template_page_id}),[t]),j=(0,P.X)({automationStore:o,collectionStore:i}),_=(0,n.useMemo)((()=>({values:C??{},properties:x??[]})),[C,x]),A=(0,n.useCallback)((e=>{d&&"collection"===e.type&&d(e.collection)}),[d]),T=(0,n.useCallback)((e=>{const t=_.properties.concat([e]);s(t,_.values)}),[s,_]),V=(0,n.useCallback)(((e,t)=>{const o=_.properties.indexOf(e);if(-1===o)return;const n=_.properties.slice(0);n[o]=t;const i={..._.values,[t]:void 0};s(n,i)}),[s,_]),F=(0,n.useCallback)((e=>{const t=_.properties.filter((t=>t!==e)),o={..._.values,[e]:void 0};s(t,o)}),[s,_]),Z=(0,n.useCallback)(((e,t)=>{const o={..._.values,[e]:t};s(_.properties,o)}),[s,_]),K=(0,n.useCallback)((()=>{S(!0)}),[]),B=(0,n.useCallback)((()=>{S(!1)}),[]),O=(0,a.yK)((e=>({sectionWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:g?12:16,paddingBlock:12,paddingInline:12},headerTitle:{alignItems:"center",display:"flex",flexWrap:"wrap",minWidth:100,whiteSpace:"pre"}})),[g]);return j?(0,I.jsxs)("section",{onMouseEnter:K,onMouseLeave:B,ref:p,style:O.sectionWrap,children:[(0,I.jsxs)(Ut,{disabled:l,icon:y.display.icon({height:21,width:14}),isHovered:f,onDelete:c,children:[(0,I.jsx)("div",{style:O.headerTitle,children:(0,I.jsx)(qt,{actionStore:t,automationContextStore:j,disabled:l,onChange:A,value:w})}),(0,h.$K)(b)&&k&&(0,I.jsx)("div",{style:O.headerTitle,children:(0,I.jsx)(Gt,{collectionStore:b,disabled:l,onChange:u,value:M})})]}),b&&(0,I.jsx)(re.vV,{actionId:t.id,collectionStore:b,config:_,contextStore:j,disabled:l,onPropertyAdd:T,onPropertyChange:V,onPropertyRemove:F,onPropertyValueChange:Z,showSetPropertyActions:!1})]}):null}function qt(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,onChange:i,value:l}=e,s=(0,a.yK)((()=>({b:{fontWeight:f.Z.fontWeight.medium},picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Vt.H)({})}})),[]),c=(0,r.VK)((()=>{let e;if("collection"===(null==l?void 0:l.type)){const o=t.getRecordModel(l.collection);e=null==o?void 0:o.getDatabaseType()}return(0,Pt.sN)(e)}),[t,l]);return(0,I.jsx)(S.FormattedMessage,{defaultMessage:"<span>Add <b>{itemType}</b> to </span>{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{b:e=>(0,I.jsx)("b",{style:s.b,children:e}),collectionPicker:(0,I.jsx)("div",{style:s.picker,children:(0,I.jsx)(Kt.a,{actionStore:t,contextStore:o,currentValue:l,disabled:n,onChange:i})}),itemType:c,span:e=>(0,I.jsx)("span",{style:s.span,children:e})}})}function Gt(e){window.__c={n:"CollectionTemplateTitle"};const{collectionStore:t,disabled:o,onChange:n,value:i}=e,r=(0,a.yK)((()=>({picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Vt.H)({})}})),[]);return(0,I.jsx)(S.FormattedMessage,{defaultMessage:"<span>as </span>{collectionTemplatePicker}",id:"automations.CreatePageActionV2.header.template",values:{collectionTemplatePicker:(0,I.jsx)(Bt.f,{collectionStore:t,currentTemplateId:i,disabled:o,onChange:n}),span:e=>(0,I.jsx)("span",{style:r.span,children:e})}})}var Yt=o(24600),Qt=o(30874),Xt=o(67174);function Jt(e){window.__c={n:"SlackNotificationAction"};const{actionStore:t,automationStore:o,collectionStore:n,currentUserIsOwner:i,disabled:a,updateCurrentAutomationState:l}=e,s=(0,ye.d)(),c=(0,r.VK)((()=>t.getConfig()),[t]),d=(0,r.VK)((()=>Qt.Z.completeSlackAuthentications.state.find((e=>(null==c?void 0:c.external_bot_id)===e.id))),[c]),u=(0,r.VK)((()=>"disabled_auth"===(null==o?void 0:o.getStatus())),[o]),p=(0,r.VK)((()=>c&&d&&c.target?o&&t&&c.external_bot_id&&u?{actionStore:t,externalBotId:c.external_bot_id,notificationActionConfigStore:t,type:"connectToSlackReconnect"}:{actionStore:t,currentExternalAuthentication:d,currentNotificationChannel:c.target,type:"selectChannelUpdate"}:{actionStore:t,type:"connectToSlackDefault"}),[c,t,o,d,u]),m=to();return i?(0,I.jsx)(ge.ZP,{alignmentToOrigin:ge.vR.Center,placementToOrigin:ge.pO.Bottom,popupType:s,render:e=>(0,I.jsx)(me,{automationStore:o,initialState:p,updateCurrentAutomationState:l,buttonPopupParent:e,collectionStore:n}),renderOrigin:e=>(0,I.jsx)(Ne.pW,{...e,disabled:a,onClick:()=>{e.onClick()},title:(0,I.jsx)(eo,{actionStore:t,currentUserIsOwner:i}),icon:Yt.P,caption:u&&(0,I.jsxs)("div",{style:m.container,children:[(0,Ce.t)(m.warningIcon),(0,I.jsx)("div",{style:m.caption,children:(0,I.jsx)(S.FormattedMessage,{id:"SlackNotificationAction.caption.reconnectNeeded",defaultMessage:"Reconnect Slack to resume"})})]}),onEdit:()=>{e.onClick()},onDelete:()=>{l({type:"remove_action",action:{id:t.id,type:"slack_notification"}})}})}):(0,I.jsx)(Ne.pW,{disabled:!0,icon:Yt.P,title:(0,I.jsxs)("div",{style:m.container,children:[(0,I.jsx)("div",{style:{fontWeight:500,marginRight:4},children:(0,I.jsx)(S.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify"})}),(0,I.jsx)(Xt.p,{channel:null==c?void 0:c.target,isAutomationOwner:i})]})})}function eo(e){window.__c={n:"SlackActionTitle"};const{actionStore:t,currentUserIsOwner:o}=e,n=to(),i=(0,r.VK)((()=>t.getConfig()),[t]);return i&&i.external_bot_id&&i.target?(0,I.jsxs)("div",{style:n.container,children:[(0,I.jsxs)("div",{style:{fontWeight:500},children:[(0,I.jsx)(S.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify"})," "]}),(0,I.jsx)(Xt.p,{channel:i.target,isAutomationOwner:o})]}):(0,I.jsx)("div",{style:n.container,children:(0,I.jsx)(S.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotificationPlaceholder",defaultMessage:"Send Slack notification to…"})})}function to(){return(0,a.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center",padding:0},caption:{fontSize:12,fontWeight:400,color:e.mediumTextColor},warningIcon:{width:12,height:"auto",color:e.accentColors.orange[400]}})),[])}var oo=o(42283),no=o(29723);function io(e){window.__c={n:"UpdateCheckboxPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:r,propertySchema:l,value:s}=e,c=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold}})),[]),d=(0,no.LJ)({propertySchema:l,styles:c,value:s}),u=(0,no.G7)({propertySchema:l,value:s}),p=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:t,icon:oo.r,onClick:o,onDelete:i,onEdit:r,title:(0,I.jsx)("div",{style:c.content,children:d})})),[t,o,i,r,c.content,d]);return(0,I.jsx)(He.y,{renderOrigin:p,title:u,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left})}var ro=o(53016),ao=o(23704);function lo(e){window.__c={n:"UpdateDatePropertyAction"};const{automationStore:t,collectionStore:o,disabled:i,onClick:l,onDelete:s,onEdit:c,propertySchema:d,value:u,valueContext:p}=e,m=(0,S.useIntl)(),g=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold}})),[]),y=(0,P.X)({automationStore:t,collectionStore:o}),h=(0,r.VK)((()=>y?(0,ao.Sg)({automationContextStore:y,intl:m,propertySchema:d,styles:g,value:u,valueContext:p}):void 0),[y,m,d,g,u,p]),v=(0,r.VK)((()=>y?(0,ao.kD)({automationContextStore:y,intl:m,propertySchema:d,value:u,valueContext:p}):void 0),[y,m,d,u,p]),x=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:i,icon:ro.V,onClick:l,onDelete:s,onEdit:c,title:(0,I.jsx)("div",{style:g.content,children:h})})),[i,l,s,c,g.content,h]);return y&&h&&v?(0,I.jsx)(He.y,{renderOrigin:x,title:v,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left}):null}var so=o(72050),co=o(93377),uo=o(99144),po=o(53866);function mo(e){window.__c={n:"UpdateSelectPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:l,propertySchema:s,value:c}=e,d=(0,S.useIntl)(),u=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold}})),[]),p=null!=c&&c.value?(0,oe.A6)(null==c?void 0:c.value)[0]:void 0,m=We.oJ({propertySchema:s,optionValues:(0,be.HD)(p)?[p]:[]}),g=(0,r.VK)((()=>(0,uo.F0)({intl:d,propertySchema:s,styles:u,values:m})),[d,m,s,u]),y=(0,r.VK)((()=>(0,uo.I7)({intl:d,propertySchema:s,values:m})),[d,m,s]),h=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:t,icon:po.w,onClick:o,onDelete:i,onEdit:l,title:(0,I.jsx)("div",{style:u.content,children:g})})),[t,o,i,l,u.content,g]);return(0,I.jsx)(He.y,{renderOrigin:h,title:y,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left})}function go(e){window.__c={n:"UpdateMultiSelectPropertyAction"};const{disabled:t,limit:o=co.H,onClick:i,onDelete:l,onEdit:s,propertySchema:c,value:d}=e,u=(0,S.useIntl)(),p=null!=d&&d.value?(0,oe.A6)(null==d?void 0:d.value):[],m=We.oJ({limit:o,optionValues:p.map((e=>"string"==typeof e?e:void 0)).filter(h.$K),propertySchema:c}),g=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:m.length<=1?"nowrap":"wrap",whiteSpace:"pre"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold}})),[m.length]),y=(0,r.VK)((()=>(0,uo.F0)({intl:u,propertySchema:c,styles:g,values:m})),[u,m,c,g]),v=(0,r.VK)((()=>(0,uo.I7)({intl:u,propertySchema:c,values:m})),[u,m,c]),x=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:t,icon:so.A,onClick:i,onDelete:l,onEdit:s,title:(0,I.jsx)("div",{style:g.content,children:y})})),[t,i,l,s,g.content,y]);return(0,I.jsx)(He.y,{renderOrigin:x,title:v,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left})}var yo=o(26774),ho=o(82207);function fo(e){window.__c={n:"UpdatePersonPropertyAction"};const{collectionStore:t,disabled:o,onClick:i,onDelete:l,onEdit:s,propertySchema:c,value:d}=e,u=(0,S.useIntl)(),p=(0,r.VK)((()=>(0,ho.UD)({getRecordModel:t.getRecordModel,propertySchema:c,value:d})),[t.getRecordModel,c,d]),m=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex",flexWrap:p.length>1?"wrap":"nowrap",whiteSpace:"pre"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold},propertyValue:{...f.Z.textOverflowStyle,paddingBlockStart:4},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:4}})),[p.length]),g=(0,r.VK)((()=>(0,ho.iT)({actors:p,propertySchema:c,styles:m})),[p,c,m]),y=(0,r.VK)((()=>(0,ho.y3)({actors:p,intl:u,propertySchema:c})),[p,u,c]),h=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:o,icon:yo.O,onClick:i,onDelete:l,onEdit:s,title:(0,I.jsx)("div",{style:m.content,children:g})})),[o,i,l,s,m.content,g]);return(0,I.jsx)(He.y,{renderOrigin:h,title:y,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left})}var So=o(92607),vo=o(84799);function xo(e){window.__c={n:"UpdateRelationPropertyAction"};const{automationStore:t,collectionStore:o,disabled:l,onClick:s,onDelete:c,onEdit:d,propertySchema:u,value:p}=e,m=(0,i.O7)(),g=(0,S.useIntl)(),y=(0,P.X)({automationStore:t,collectionStore:o}),h=(0,r.VK)((()=>(null==y?void 0:y.getAllContextValues())??[]),[y]),v=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex",flex:"1 1 auto",minWidth:0,whiteSpace:"pre"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold,minWidth:20},propertyValue:{...f.Z.textOverflowStyle,minWidth:40},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:10},propertyValueListItem:{display:"flex"}})),[]),x=(0,r.VK)((()=>(0,vo.vT)({automationContextValues:h,collectionStore:o,propertySchema:u,styles:v,value:p})),[h,o,u,v,p]),C=(0,r.VK)((()=>(0,vo.wr)({automationContextValues:h,collectionStore:o,environment:m,intl:g,propertySchema:u,value:p})),[h,o,m,g,u,p]),b=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:l,icon:So.v,onClick:s,onDelete:c,onEdit:d,title:x})),[l,s,c,d,x]);return(0,I.jsx)(He.y,{renderOrigin:b,title:C,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left})}var Co=o(4328);function bo(e){window.__c={n:"UpdateStatusPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:l,propertySchema:s,value:c}=e,d=(0,S.useIntl)(),u=(0,oe.A6)(null==c?void 0:c.value)[0],p=(0,a.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold}})),[]),m=(0,r.VK)((()=>(0,Co.O3)({intl:d,propertySchema:s,styles:p,value:u})),[d,s,u,p]),g=(0,r.VK)((()=>(0,Co.LQ)({intl:d,propertySchema:s,value:u})),[d,s,u]),y=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:t,icon:vt.T,onClick:o,onDelete:i,onEdit:l,title:(0,I.jsx)("div",{style:p.content,children:m})})),[t,o,i,l,p.content,m]);return m&&g?(0,I.jsx)(He.y,{renderOrigin:y,title:g,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left}):null}var wo=o(48524),ko=o(55159),Mo=o(34093),jo=o(108),_o=o(83303),Ao=o(8938),To=o(73427);function Po(e){window.__c={n:"UpdateBaseTextPropertyAction"};const{automationStore:t,disabled:o,icon:l,onClick:s,onDelete:c,onEdit:d,propertySchema:u,value:p}=e,m=(0,i.O7)(),g=(0,a.Fg)(),y=(0,a.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...f.Z.textOverflowStyle,fontWeight:f.Z.fontWeight.semibold}})),[]),h=(0,r.VK)((()=>(0,To.Ut)({automationStore:t,environment:m,propertySchema:u,styles:y,theme:g,value:p})),[t,m,u,y,g,p]),S=(0,r.VK)((()=>(0,To.lG)({automationStore:t,environment:m,propertySchema:u,theme:g,value:p})),[t,m,u,g,p]),v=(0,n.useCallback)((e=>(0,I.jsx)(Ne.pW,{...e,disabled:o,icon:l,onClick:s,onDelete:c,onEdit:d,title:(0,I.jsx)("div",{style:y.content,children:h})})),[o,l,s,c,d,y.content,h]);return h&&S?(0,I.jsx)(He.y,{renderOrigin:v,title:S,tooltipAlignment:De.v.Center,tooltipPlacement:De.u.Left}):null}function Vo(e){return(0,I.jsx)(Po,{...e,icon:_o.c})}function Io(e){return(0,I.jsx)(Po,{...e,icon:jo.p})}function Fo(e){return(0,I.jsx)(Po,{...e,icon:wo.n})}function Zo(e){return(0,I.jsx)(Po,{...e,icon:Ao.O})}function Ko(e){return(0,I.jsx)(Po,{...e,icon:ko.J})}function Bo(e){return(0,I.jsx)(Po,{...e,icon:Mo.u})}function Oo(e){const{automationStore:t,collectionStore:o,disabled:n,formulaValueContext:i,onClick:r,onEdit:a,propertySchema:l,setPropertyValue:s,onDelete:c}=e;return"person"===l.type?(0,I.jsx)(fo,{collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"status"===l.type?(0,I.jsx)(bo,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"select"===l.type?(0,I.jsx)(mo,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"multi_select"===l.type?(0,I.jsx)(go,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"date"===l.type?(0,I.jsx)(lo,{automationStore:t,collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value,valueContext:i}):"relation"===l.type?(0,I.jsx)(xo,{automationStore:t,collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"checkbox"===l.type?(0,I.jsx)(io,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"title"===l.type?(0,I.jsx)(Vo,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"text"===l.type?(0,I.jsx)(Io,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"email"===l.type?(0,I.jsx)(Fo,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"url"===l.type?(0,I.jsx)(Zo,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"number"===l.type?(0,I.jsx)(Ko,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):"phone_number"===l.type?(0,I.jsx)(Bo,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:l,value:s.value}):null}function Ro(e){window.__c={n:"CollectionSettingsAutomationActionList"};const{automationStore:t,collectionStore:o,updateCurrentAutomationState:n,handleNavigateToDeletedProperties:i,handleNavigateToEditProperty:l,currentUserIsOwner:s,disabled:c}=e,d=(0,r.VK)((()=>t.getActionStores().map((e=>e.isType("update_pages")?(0,I.jsx)(Do,{actionStore:e,automationStore:t,collectionStore:o,disabled:c,handleNavigateToDeletedProperties:i,handleNavigateToEditProperty:l,updateCurrentAutomationState:n},e.id):e.isType("slack_notification")?(0,I.jsx)(Jt,{actionStore:e,automationStore:t,collectionStore:o,updateCurrentAutomationState:n,currentUserIsOwner:s,disabled:c},e.id):e.isType("create_page")?(0,I.jsx)(zt,{actionStore:e,automationStore:t,collectionStore:o,disabled:c,updateCurrentAutomationState:n},e.id):void 0)).filter(h.$K)),[t,o,s,c,i,l,n]),u=(0,a.yK)((e=>({stepList:{border:`1px solid ${e.regularDividerColor}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},stepItemWithBorderTop:{borderTop:`1px solid ${e.regularDividerColor}`}})),[]);return(0,I.jsx)("ul",{style:u.stepList,children:d.map(((e,t)=>{const o=0===t?void 0:u.stepItemWithBorderTop;return(0,I.jsx)("li",{style:o,children:e},t)}))})}function Do(e){var t;window.__c={n:"InternalUpdatePageAction"};const{actionStore:o,automationStore:i,collectionStore:a,disabled:l,handleNavigateToDeletedProperties:c,updateCurrentAutomationState:d}=e,u=(0,ye.d)(),p=(0,r.VK)((()=>o.getConfig()),[o]),m=(0,r.VK)((()=>a.getSchema()),[a]),g=(0,n.useCallback)((()=>{d({action:{config:p,id:o.id,type:"update_pages"},type:"remove_action"})}),[p,o.id,d]),y="variable"===(null==p||null===(t=p.target)||void 0===t?void 0:t.type)?(0,Tt.MY)(p.target.id):void 0;if(y&&"global"===y.source&&"button_page"===y.global){var h;const e=((null==p?void 0:p.properties)??[])[0],t=m[e],r=null==p||null===(h=p.values)||void 0===h?void 0:h[e];if(t&&r){const c={type:"collection",collectionStore:a,property:e};return(0,s.SF)(t)?(0,I.jsx)(ge.ZP,{alignmentToOrigin:ge.vR.End,placementToOrigin:ge.pO.Bottom,popupType:u,render:t=>(0,I.jsx)(me,{automationStore:i,buttonPopupParent:t,collectionStore:a,initialState:{propertyId:e,actionId:o.id,type:"eventActionProperty"},updateCurrentAutomationState:d}),renderOrigin:e=>(0,I.jsx)(Oo,{...e,automationStore:i,collectionStore:a,disabled:l,formulaValueContext:c,onDelete:g,onEdit:e.onClick,propertySchema:t,setPropertyValue:r})}):(0,I.jsx)(ge.ZP,{alignmentToOrigin:ge.vR.Center,placementToOrigin:ge.pO.Bottom,popupType:u,render:()=>(0,I.jsx)(ct.qO,{actionId:o.id,propertyId:e}),renderOrigin:o=>(0,n.createElement)(Ue,{...o,key:`unsupported_${e}_action`,disabled:l,onClick:()=>o.onClick(),propertySchema:t})},`unsupported_property_${e}_action`)}return t?null:(0,I.jsx)(ge.ZP,{alignmentToOrigin:ge.vR.Center,placementToOrigin:ge.pO.Bottom,popupType:u,render:e=>(0,I.jsx)($e,{stepType:"action",onDelete:g,onViewDeletedProperties:c}),renderOrigin:t=>(0,I.jsx)(Le,{...t,disabled:l,propertyId:e,collectionStore:a})})}return(0,I.jsx)(Et,{actionStore:o,automationStore:i,collectionStore:a,disabled:l,updateCurrentAutomationState:d})}var Wo=o(9015),Eo=o(12455);var No=o(96245),Lo=o(97372),Ho=o(42922),Uo=o(73063),zo=o(3386),$o=o(68641),qo=o(63474),Go=o(5971),Yo=o(84398),Qo=o(80444),Xo=o(58812);var Jo=o(78243),en=o(77080);var tn=o(13273);var on=o(16184),nn=o(42402),rn=o(46654);const an=(0,S.defineMessages)({automationIncompatibleViewFilterAndOwner:{defaultMessage:"This automation may not work because the view has a non-supported filter",id:"AutomationHeaderView.incompatibleCollectionViewFilter.owner"},automationPublicAccess:{defaultMessage:"This automation is part of a public page",id:"AutomationHeaderView.automationPublicAccess"},automationUpgrade:{defaultMessage:"<anchor-upsell>Upgrade</anchor-upsell> to edit this automation or create your own",id:"AutomationHeaderView.automationUpgrade"},automationEditOnSite:{defaultMessage:"This automation can only be edited on notion.com",id:"AutomationHeaderView.automationEditOnSite"},automationSlackNoPermissions:{defaultMessage:"Ask {user} to edit this automation",id:"AutomationHeaderView.automationSlackNoPermissions"},automationSlackWithPermissions:{defaultMessage:"Ask {user} to edit this automation or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationSlackWithPermissions"},automationMissingPermissionsNoPermissions:{defaultMessage:"You must have full access to target databases in this automation to edit it",id:"AutomationHeaderView.automationMissingPermissionsNoPermissions"},automationMissingPermissionsWithPermissions:{defaultMessage:"You must have full access to target databases in this automation to edit it or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationMissingPermissionsWithPermissions"},automationGenericFullAccess:{defaultMessage:"You must have full access to this database to edit automations",id:"AutomationHeaderView.automationGenericFullAccess"}});function ln(e){window.__c={n:"AutomationHeaderView"};const{automationStore:t,automationPermissionScope:o,collectionStore:a,onDelete:l,referencesIncompatibleCollectionViewFilter:s}=e,c=(0,i.O7)(),d=(0,P.X)({automationStore:t,collectionStore:a}),u=(0,r.VK)((()=>null==d?void 0:d.context.type),[d]),p=(0,r.VK)((()=>Boolean((0,rn.IJ)(c,t))),[t,c]),m=(0,r.VK)((()=>(0,H.$5)(null==d?void 0:d.context)),[d]),g=(0,r.VK)((()=>(0,z.R4)(t)),[t]),y=(0,n.useCallback)((()=>{q.y(c,{from:"database_automation_settings_header_message",for:"plus"})}),[c]),h=dn();if(p)return(0,I.jsx)(sn,{icon:(0,I.jsx)("div",{style:h.lockedIconWrap,children:(0,on.Q)(h.lockedIcon)}),children:(0,I.jsx)("p",{style:h.paragraph,children:(0,I.jsx)(S.FormattedMessage,{...an.automationPublicAccess})})});if("sufficient"!==m.editPermissionStatus&&"free_workspace"===m.reason)return(0,H.Rr)({contextType:u,environment:c})?(0,I.jsx)(cn,{icon:(0,I.jsx)("div",{style:h.boltIconWrap,children:(0,R.K)(h.boltIcon)}),children:(0,I.jsx)("p",{style:h.paragraph,children:(0,I.jsx)(S.FormattedMessage,{...an.automationUpgrade,values:{"anchor-upsell":e=>(0,I.jsx)(nn.Z,{onClick:y,style:h.link,children:e})}})})}):(0,I.jsx)(sn,{icon:(0,I.jsx)("div",{style:h.lockedIconWrap,children:(0,on.Q)(h.lockedIcon)}),children:(0,I.jsx)("p",{style:h.paragraph,children:(0,I.jsx)(S.FormattedMessage,{...an.automationEditOnSite})})});if("sufficient"!==m.editPermissionStatus&&"missing_permissions"===m.reason&&m.actionId){const e=g[m.actionId];return(0,I.jsx)(sn,{icon:(0,I.jsx)("div",{style:h.lockedIconWrap,children:(0,on.Q)(h.lockedIcon)}),children:(0,I.jsx)("p",{style:h.paragraph,children:(0,I.jsx)(S.FormattedMessage,{..."readonly"===o?an.automationSlackNoPermissions:an.automationSlackWithPermissions,values:{"anchor-delete":e=>(0,I.jsx)(nn.Z,{onClick:l,style:h.link,children:e}),user:e}})})})}return"insufficient"===m.editPermissionStatus||"unknown"===m.editPermissionStatus?(0,I.jsx)(sn,{icon:(0,I.jsx)("div",{style:h.lockedIconWrap,children:(0,on.Q)(h.lockedIcon)}),children:(0,I.jsx)("p",{style:h.paragraph,children:(0,I.jsx)(S.FormattedMessage,{...an.automationGenericFullAccess})})}):s?(0,I.jsx)(sn,{icon:(0,I.jsx)("div",{style:h.lockedIconWrap,children:(0,Ce.t)(h.warningIcon)}),children:(0,I.jsx)(S.FormattedMessage,{...an.automationIncompatibleViewFilterAndOwner})}):null}function sn(e){window.__c={n:"AutomationMessage"};const{children:t,icon:o}=e,n=dn();return(0,I.jsx)("div",{style:n.wrapWrap,children:(0,I.jsxs)("div",{style:n.wrap,children:[o&&(0,I.jsx)("div",{style:n.iconWrap,children:o}),(0,I.jsx)("div",{style:n.messageWrap,children:t})]})})}function cn(e){window.__c={n:"AutomationUpsellMessage"};const{children:t,icon:o}=e,n=dn();return(0,I.jsx)("div",{style:n.wrapWrap,children:(0,I.jsxs)("div",{style:n.upsellWrap,children:[o&&(0,I.jsx)("div",{style:n.iconWrap,children:o}),(0,I.jsx)("div",{style:n.messageWrap,children:t})]})})}function dn(){const{isMobile:e}=(0,i.Fy)();return(0,a.yK)((t=>({boltIcon:{fill:t.icon.yellow,height:"100%",width:"100%"},boltIconWrap:{height:20,padding:2,width:20},icon:{},iconWrap:{flexGrow:0,flexShrink:0},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGray,borderRadius:4,height:20,padding:2,width:20},link:{color:t.text.uiBluePrimary},messageWrap:{flexGrow:1},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},warningIcon:{color:t.accentColors.orange[400],height:"100%",width:"100%"},warningIconWrap:{height:20,padding:2,width:20},wrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10},wrapWrap:{padding:e?12:"0 12px 12px 12px"},upsellWrap:{alignItems:"center",background:t.accentColors.yellow[50],border:`1px solid ${t.accentColors.yellow[100]}`,borderRadius:6,display:"flex",flexDirection:"row",gap:10,padding:8},personBadgeQuestionMark:{fill:t.mediumIconColor,width:16,height:"auto"},personBadgeQuestionMarkWrap:{height:20,padding:2,width:20}})),[e])}var un=o(24006),pn=o(75024);const mn=(0,S.defineMessages)({automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationPausedLabel:{defaultMessage:"Paused",id:"collectionSettings.editAutomationView.automationPausedLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"}});function gn(e){window.__c={n:"AutomationSectionStatus"};const{automationId:t,automationOwner:o,disabled:i,isAutomationPaused:r,onPause:l,onResume:s}=e,c=`toggle-${t}`,d=(0,n.useCallback)((()=>{r?null==s||s():null==l||l()}),[r,s,l]),u=(0,a.yK)((e=>({labelWrap:{color:i?e.text.tertiary:r?e.text.secondary:e.text.primary,flex:"1 1 auto",fontSize:14},sectionWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:6,marginBlockEnd:12},toggleWrap:{flex:"0 0 auto",paddingBlockStart:2}})),[i,r]),p=r?mn.automationPausedLabel:mn.automationEnabledLabel,m=r?mn.automationPausedHiddenAriaLabel:mn.automationEnabledHiddenAriaLabel;return(0,I.jsxs)("section",{style:u.sectionWrap,children:[(0,I.jsx)("div",{style:u.toggleWrap,children:(0,I.jsx)(Pe.ZP,{disableTooltip:!i||!r,renderTooltip:()=>(0,I.jsx)(S.FormattedMessage,{...mn.automationDisabledTooltip,values:{user:o}}),render:e=>(0,I.jsx)("div",{...e,children:(0,I.jsx)(un.Z,{disabled:i,inputId:c,on:!r,onClick:d})})})}),(0,I.jsx)("div",{style:u.labelWrap,children:(0,I.jsxs)("label",{htmlFor:c,children:[(0,I.jsx)("span",{"aria-hidden":!0,children:(0,I.jsx)(S.FormattedMessage,{...p})}),(0,I.jsx)("span",{style:pn.jy,children:(0,I.jsx)(S.FormattedMessage,{...m})})]})})]})}const yn=(0,S.defineMessages)({createAutomationViewMenuTitle:{id:"collectionSettings.createStatusAutomationView.menuTitle",defaultMessage:"New automation"},editAutomationViewMenuTitle:{id:"collectionSettings.editStatusAutomationView.menuTitle",defaultMessage:"Edit automation"},addTriggerLabel:{defaultMessage:"Add trigger",id:"collectionSettings.editAutomationView.triggerSection.placeholder"},addTriggerAriaLabel:{id:"collectionSettings.editAutomationView.addTrigger.iconButton",defaultMessage:"Add trigger"},addActionLabel:{defaultMessage:"Add action",id:"AutomationActionSelectButton.actionSection.addAction"},addActionAriaLabel:{id:"collectionSettings.editAutomationView.addAction.iconButton",defaultMessage:"Add action"},deleteButton:{id:"collectionSettings.editAutomationView.deleteButton",defaultMessage:"Delete"},triggerTitle:{defaultMessage:"When any of these occur",id:"collectionSettings.editAutomationView.triggerSection.title"},actionTitle:{defaultMessage:"Do this",id:"collectionSettings.editAutomationView.actionSection.title"},automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationPausedLabel:{defaultMessage:"Paused",id:"collectionSettings.editAutomationView.automationPausedLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"}}),hn=()=>{};function fn(e){window.__c={n:"CollectionSettingsEditAutomationView"};const{collectionSettingsStore:t,collectionContextStore:o,...a}=e,g=(0,n.useMemo)((()=>a),[]),{mode:y}=g,f=(0,S.useIntl)(),C=(0,qo.D)(),b=(0,i.O7)(),{isMobile:w}=(0,i.Fy)(),k=(0,ye.d)(),M=(0,Go.E)("button_property"),[j,_]=(0,n.useState)([]),A="create"===y,T=(0,Yo.$)("CollectionSettingsEditAutomationView",{cacheFallback:b.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),V=(0,r.VK)((()=>Qo.default.state.currentUserStore),[]),F=(0,r.VK)((()=>null==V?void 0:V.userId),[V]),Z=(0,r.VK)((()=>null==V?void 0:V.getDisplayName(f)),[V,f]),K=(0,r.VK)((()=>(0,G.sX)()),[]),B=(0,r.VK)((()=>o.collectionStore()),[o]),O=(0,r.VK)((()=>null==B?void 0:B.getSpaceId()),[B]),R=(0,r.VK)((()=>null==B?void 0:B.id),[B]),D=(0,r.VK)((()=>null==B?void 0:B.getSchema()),[B]),W=(0,r.VK)((()=>(0,$o.jI)({timelineViewTab:"timeline",collectionContextStore:o})),[o]),U=(0,n.useMemo)((()=>"update"===g.mode?g.automationId:(0,u.ZP)()),[g]),$=(0,r.VK)((()=>o.aliveAutomationCount.state),[o]),q=(0,r.VK)((()=>{if(O&&B&&F)return new Fe.Mz(b,{id:U,table:m.cv,spaceId:O})}),[U,B,F,b,O]),Y=(0,r.VK)((()=>(null==q?void 0:q.getStatus())??"disabled"),[q]),Q="active"===Y,X=(0,r.VK)((()=>(0,s.XO)(f,Z)),[Z,f]),J=(0,r.VK)((()=>{if(!O||!B||!F)return;const e={id:U,table:m.cv,spaceId:O},t=T.getEntry({pointer:e,userId:F});return t?t.value.value:z.sA({automationId:U,automationName:X,collectionStore:B,userId:F})}),[X,U,B,F,O,T]),{maybePersistedAutomationStore:ee,maybePersistedTransactionActions:te,hasUnpersistedChanges:oe}=(0,No.$)({automationId:U,spaceId:O,defaultValue:A?J:void 0,persist:!1}),ne=(0,r.VK)((()=>{if(!O||!B)return;const e={id:U,table:m.cv,spaceId:O},t=T.getEntry({pointer:e,userId:F});A&&!(0,h.$K)(t)&&F&&T.setRecord({pointer:e,userId:F},{role:"editor",value:J});const o=new Fe.Mz(b,e,{inMemoryRecordCache:T});return z.Xd(o)?o:void 0}),[J,U,B,F,b,A,O,T]),ie=(0,r.VK)((()=>{const e=M?ee:ne;if(e&&z.Xd(e))return e}),[M,ne,ee]),re=(0,r.VK)((()=>(null==ie?void 0:ie.getName())??""),[ie]),ae=(0,r.VK)((()=>{var e;return(null==ie||null===(e=ie.getOwnerStore())||void 0===e?void 0:e.getDisplayName(f))??""}),[f,ie]),le=(0,r.VK)((()=>{if(ie&&(0,z.Xd)(ie)){const e=ie.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();if(e&&"filter"!==e.type)return e.pointer}}),[ie]),se=(0,r.VK)((()=>((null==ie?void 0:ie.getActionStores())??[]).filter((e=>e.isDefined()))),[ie]),ce=function(e){const{actionStores:t,automationStore:o,loadingStatus:n,mode:i}=e;return(0,r.VK)((()=>"create"===i?"edit":"resolved"===n&&o&&t?(0,z.i1)({automationStore:o,actionStores:t})?"edit":(0,z.qM)({automationStore:o})?"readonly_with_delete":"readonly":"readonly"),[i,n,o,t])}({automationStore:ie,actionStores:se,loadingStatus:"resolved",mode:g.mode}),de="readonly_with_delete"===ce||"edit"===ce&&!A,ue="edit"===ce,pe=(0,r.VK)((()=>{if(!ie||!V)return!1;const e=V.pointer,t=ie.getCreatedByPointer();return!(!e||!t)&&p.dr.isEqual(e,t)}),[ie,V]),Se=(0,P.X)({automationStore:ie,collectionStore:B}),ve=(0,P.X)({automationStore:q,collectionStore:B}),xe=function(e){const{contextStore:t}=e,[o,i]=(0,n.useState)([]),a=(0,r.VK)((()=>t?(0,H.uV)(t.context.automationStore,t.context.type):void 0),[t]);return(0,r.VK)((()=>{a?(0,z.P$)({automationAvailabilityContext:a}).then((e=>i(function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}(e))),(()=>i([]))):o.length>0&&i([])}),[o.length,a]),o}({contextStore:Se}),Ce=(0,r.VK)((()=>!!(0,h.$K)(ie)&&function(e){if(!(0,z.Xd)(e))return!1;const t=e.getTriggerStore().getKeyStore("event").getValue();return(null==t?void 0:t.pagesAdded)||"none"!==(null==t?void 0:t.pagePropertiesEdited.type)}(ie)),[ie]),be=(0,r.VK)((()=>!!(0,h.$K)(ie)&&function(e){return e.getActionIds().length>0}(ie)),[ie]),ke=0===xe.length,Me=(0,r.VK)((()=>!(!ie||!B)&&z.vM({automationStore:ie,collectionStore:B})),[ie,B]),je=(0,r.VK)((()=>!!(B&&ie&&Se)&&z.qk({automationContextStore:Se,automationStore:ie,collectionStore:B})),[Se,ie,B]),_e=(0,r.VK)((()=>!!(B&&q&&ve)&&z.qk({automationContextStore:ve,automationStore:q,collectionStore:B})),[B,ve,q]),Ae=M?oe:(0,Jo.B)({automationStorePointer:null==ie?void 0:ie.pointer,defaultRecordCache:b.defaultRecordCache.inMemoryRecordCache,inMemoryRecordCache:T,userId:F}),Te=(0,n.useMemo)((()=>({type:"eventTriggers"})),[]),Pe=(0,n.useMemo)((()=>({type:"eventActions",availableActions:xe})),[xe]);!function(e){const{automationStore:t,collectionStoreId:o,eventTracker:i}=e,[a,s]=(0,n.useState)(!1),c=(0,r.VK)((()=>(null==t?void 0:t.getActionIds().length)??0),[t]),d=(0,r.VK)((()=>{if(!t||!(0,z.Xd)(t))return 0;const e=t.getTriggerStore().getKeyStore("event");let o=0;e.getKeyStore("pagesAdded").getValue()&&o++;const n=e.getKeyStore("pagePropertiesEdited").getValue();return"any"===(null==n?void 0:n.type)?o++:"some"===(null==n?void 0:n.type)&&(o+=n.some.length),o}),[t]);(0,n.useEffect)((()=>{i&&o&&!a&&t&&((0,l.nC)(i,{automation_id:t.id,automation_total_actions:c,automation_total_triggers:d,collection_id:o}),en.default.logEvent("automation_configure_view","true"),s(!0))}),[i,o,a,c,d,null==t?void 0:t.id,t])}({automationStore:ie,collectionStoreId:R,eventTracker:C});const Ve=(0,r.VK)((()=>!(!ue||!be)&&(!K||!ke)),[ue,be,ke,K]),Ie=z.EE({automationStore:ie,currentUserId:F,inMemoryRecordCache:T}),Ke=(0,n.useCallback)((()=>{B&&ie&&Ae&&("create"===y?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i,intl:r}=e;Xo.aO({automationStore:t,collectionStore:n,environment:i,intl:r}),x.oV({label:(0,I.jsx)(S.FormattedMessage,{id:"automations.editAutomationView.createdConfirmation",defaultMessage:"{automationName} created",values:{automationName:t.getName()}})}),v.z$({collectionSettingsStore:o})}({automationStore:ie,collectionSettingsStore:t,collectionStore:B,environment:b,intl:f}):"update"===y?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i}=e;Xo.hY({automationStore:t,collectionStore:n,environment:i}),x.oV({label:(0,I.jsx)(S.FormattedMessage,{id:"automations.editAutomationView.updatedConfirmation",defaultMessage:"{automationName} updated",values:{automationName:t.getName()}})}),v.z$({collectionSettingsStore:o})}({automationStore:ie,collectionSettingsStore:t,collectionStore:B,environment:b}):(0,h.t1)(y))}),[ie,t,B,b,Ae,f,y]),Be=(0,n.useCallback)((()=>{ie&&B&&Xo.j3({automationStore:ie,collectionStore:B,environment:b})}),[B,b,ie]),Re=(0,n.useCallback)((()=>{ie&&B&&Xo.$K({automationStore:ie,collectionStore:B,environment:b})}),[B,b,ie]),De=(0,n.useCallback)((async()=>{ie&&B&&!A&&await Xo.SC({intl:f,environment:b,existingAutomationStore:ie,collectionStore:B,triggerType:"event",onDelete:()=>{1===$?v.wl({collectionSettingsStore:t,item:{type:"main"}}):v.z$({collectionSettingsStore:t})}})}),[$,ie,t,B,b,f,A]),We=(0,n.useCallback)((async()=>{await Xo.hL({automationName:re,hasPendingChanges:Ae})&&(0===$?v.wl({collectionSettingsStore:t,item:{type:"main"}}):v.z$({collectionSettingsStore:t}))}),[$,re,t,Ae]),Ee=(0,n.useCallback)((async()=>{await Xo.hL({automationName:re,hasPendingChanges:Ae})&&v.E3({collectionSettingsStore:t})}),[re,t,Ae]);!function(e){const{hasPendingChanges:t,onClick:o}=e;(0,n.useEffect)((()=>{async function e(e){const n=e.target;if(t&&e.eventPhase===Event.CAPTURING_PHASE&&n instanceof Element){if((0,tn.jM)(n)||(0,tn.yT)(n))return;e.stopPropagation(),e.preventDefault(),await o()}}return window.addEventListener("click",e,{capture:!0}),()=>{window.removeEventListener("click",e,{capture:!0})}}),[t,o])}({hasPendingChanges:Ae,onClick:Ee});const Ne=(0,n.useCallback)((async()=>{await Xo.hL({automationName:re,hasPendingChanges:Ae})&&(v.wl({collectionSettingsStore:t,item:{type:"main"}}),v.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}}),v.H4({collectionSettingsStore:t,item:{type:"deletedProperties",timelineViewTab:"timeline"}}))}),[re,t,Ae]),Le=(0,n.useCallback)((async e=>{await Xo.hL({automationName:re,hasPendingChanges:Ae})&&(v.wl({collectionSettingsStore:t,item:{type:"main"}}),v.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}}),v.H4({collectionSettingsStore:t,item:{type:"property",formatKey:W,property:e}}))}),[re,t,W,Ae]),He=(0,r.VK)((()=>e=>{if(Ie(e),R&&D&&ie)if("update_trigger"===e.type||"remove_trigger"===e.type){const t=function(e){const{action:t,automationId:o,collectionStoreId:n,schema:i}=e;let r;if("page_added"===t.trigger.type)r={type:"page"};else if("any_page_property_edited"===t.trigger.type)r={condition:"any",type:"property"};else if("property_changed"===t.trigger.type){const e=i[t.trigger.property];if(!e)return;r={condition:"some",property_types:[e.type],type:"property"}}else(0,h.t1)(t.trigger);return{automation_id:o,automation_trigger:r,collection_id:n}}({action:e,automationId:U,collectionStoreId:R,schema:D});if(!t)return;"remove_trigger"===e.type?(0,l.Ey)(C,t):"update_trigger"===e.type&&function(e,t){if(!(0,z.Xd)(t))return!0;const o=t.getTriggerStore().getKeyStore("event");if("page_added"===e.type&&!0===o.getKeyStore("pagesAdded").getValue())return!1;if("any_page_property_edited"===e.type&&"any"===o.getKeyStore("pagePropertiesEdited").getKeyStore("type").getValue())return!1;if("property_changed"===e.type){const t=o.getKeyStore("pagePropertiesEdited").getValue();if("some"===(null==t?void 0:t.type)&&t.some.some((t=>t.property===e.property)))return!0}return!0}(e.trigger,ie)&&(0,l.nK)(C,t)}else if("update_action"===e.type||"remove_action"===e.type){const t=function(e){const{action:t,automationId:o,collectionStoreId:n,schema:i}=e;let r;if("slack_notification"===t.action.type)r={type:"slack_notification"};else{if("update_pages"!==t.action.type)return;var a;r={property_types:((null===(a=t.action.config)||void 0===a?void 0:a.properties)??[]).map((e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.type})).filter(h.$K),type:"update_pages"}}return{automation_action:r,automation_action_id:t.action.id,automation_id:o,collection_id:n}}({action:e,automationId:U,collectionStoreId:R,schema:D});if(!t)return;"remove_action"===e.type?(0,l.OK)(C,t):"update_action"===e.type&&function(e,t){return!t.getActionIds().includes(e.id)}(e.action,ie)&&(0,l.A2)(C,t)}}),[U,ie,D,R,C,Ie]),Ue=(0,n.useCallback)((e=>{const t=e.target.value;He({type:"update_name",name:t})}),[He]),ze=(0,n.useCallback)((e=>{He({type:"update_source",pointer:e})}),[He]),$e=(0,n.useCallback)((e=>{_((t=>[...t,e.id]))}),[]),qe=xn({showDeleteEnableDisableOptions:de}),Ge=[],Ye=Ae&&je;if(ue&&Ge.push((0,I.jsx)(L.Z,{mobileStyle:qe.automationCreateMobile,style:qe.automationCreateDesktop,topBorder:!w,children:(0,I.jsx)(Ho.Z,{onClick:Ke,disabled:!Ye,style:qe.automationCreateButton,children:A?(0,I.jsx)(S.FormattedMessage,{id:"collectionSettings.editAutomationView.createButton.label",defaultMessage:"Create"}):(0,I.jsx)(S.FormattedMessage,{id:"collectionSettings.editAutomationView.saveButton.label",defaultMessage:"Save"})})},"save")),de&&Ge.push((0,I.jsx)(L.Z,{disableMobilePadding:!0,topBorder:w||0===Ge.length,children:(0,I.jsx)(we.Z,{desktopIconStyle:qe.automationOptionIconDesktop,icon:d.y,isRed:!0,onClick:De,title:f.formatMessage(yn.deleteButton)})},"delete")),!B||!ie)return null;const Qe=A?f.formatMessage(yn.createAutomationViewMenuTitle):f.formatMessage(yn.editAutomationViewMenuTitle),Xe=Y&&ae&&(0,I.jsx)(ln,{automationStore:ie,collectionStore:B,automationPermissionScope:ce,referencesIncompatibleCollectionViewFilter:Me,onDelete:De});return(0,I.jsx)(zo.Z,{debugName:"CollectionSettingsEditAutomationView",capture:!0,onEsc:Ee,children:(0,I.jsx)(Lo.ZP,{title:Qe,collectionSettingsStore:t,handleBackArrowClick:We,handleClose:Ee,footer:Ge,fullHeight:!0,menuScrollerStyle:qe.menuScroller,children:(0,I.jsxs)(Wo.Z.Provider,{value:{automationContextStore:Se,automationStore:ie,collectionStore:B,disabled:!ue,editorPlacement:{type:"inline"},editorWidth:Lo.nJ,maybePersistedTransactionActions:te,onActionAdded:$e,suppressActionErrors:j,currentDraggingActionId:void 0},children:[Xe,(0,I.jsx)(N.Z,{type:N.i.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:[{key:"automation_name",action:()=>{},render:e=>M?(0,I.jsx)(Sn,{...e,disabled:!ue}):(0,I.jsx)(E.ZP,{style:qe.automationNameInput,...e,value:re??"Loading...",onChange:Ue,disabled:!ue,textWrapperStyle:qe.automationNameText})},{key:"automation_source",action:hn,render:e=>M?(0,I.jsx)(vn,{disabled:!ue,collectionContextStore:o,menuListItemProps:e}):(0,I.jsx)(Ze,{menuListItemProps:e,selectedSourcePointer:le,collectionContextStore:o,onSelect:ze,disabled:!ue})}],render:e=>(0,I.jsx)(L.Z,{...e,disableMobilePadding:Boolean(Xe)})}]}),(0,I.jsxs)("div",{style:qe.wrap,children:[_e&&de&&(0,I.jsx)(gn,{automationId:ie.id,automationOwner:ae,isAutomationPaused:!Q,onPause:Be,onResume:Re}),M?(0,I.jsx)(Oe._v,{areActionsEditable:ue,areTriggersEditable:ue}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("section",{style:qe.automationSection,children:[(0,I.jsxs)("header",{style:qe.automationSectionHeader,children:[(0,I.jsx)("div",{style:qe.automationSectionTitle,children:(0,I.jsx)(S.FormattedMessage,{...yn.triggerTitle})}),(0,I.jsx)("div",{style:{...qe.automationSectionAdd,visibility:Ce&&ue?void 0:"hidden"},children:(0,I.jsx)(ge.ZP,{popupType:k,alignmentToOrigin:ge.vR.End,placementToOrigin:ge.pO.Bottom,renderOrigin:e=>(0,I.jsx)(Uo.Z,{...e,ariaLabel:f.formatMessage(yn.addTriggerAriaLabel),icon:c.R}),render:e=>B&&(0,I.jsx)(st,{automationStore:ie,collectionStore:B,initialState:Te,updateCurrentAutomationState:He,buttonPopupParent:e})})})]}),Ce?(0,I.jsx)(kt,{automationStore:ie,collectionStore:B,updateCurrentState:He,handleNavigateToDeletedProperties:Ne,handleNavigateToEditProperty:Le,disabled:!ue}):(0,I.jsx)(ge.ZP,{popupType:k,renderOrigin:e=>(0,I.jsx)(he.D,{...e,icon:(0,c.R)({height:24,width:12}),title:(0,I.jsx)(S.FormattedMessage,{...yn.addTriggerLabel})}),render:e=>B&&(0,I.jsx)(st,{automationStore:ie,collectionStore:B,initialState:Te,updateCurrentAutomationState:He,buttonPopupParent:e})})]}),(0,I.jsxs)("section",{style:qe.automationSection,children:[(0,I.jsxs)("header",{style:{...qe.automationSectionHeader,...qe.automationSectionHeaderAction},children:[(0,I.jsx)("div",{style:qe.automationSectionTitle,children:(0,I.jsx)(S.FormattedMessage,{...yn.actionTitle})}),(0,I.jsx)("div",{style:{...qe.automationSectionAdd,visibility:Ve?void 0:"hidden"},children:(0,I.jsx)(ge.ZP,{alignmentToOrigin:ge.vR.End,placementToOrigin:ge.pO.Bottom,popupType:k,render:e=>(0,I.jsx)(me,{automationStore:ie,buttonPopupParent:e,collectionStore:B,initialState:Pe,updateCurrentAutomationState:He}),renderOrigin:e=>(0,I.jsx)(Uo.Z,{...e,ariaLabel:f.formatMessage(yn.addActionAriaLabel),icon:c.R})})})]}),be?(0,I.jsx)(Ro,{automationStore:ie,collectionStore:B,handleNavigateToDeletedProperties:Ne,handleNavigateToEditProperty:Le,updateCurrentAutomationState:He,currentUserIsOwner:pe,disabled:!ue}):(0,I.jsx)(fe,{automationStore:ie,collectionStore:B,initialState:Pe,updateCurrentAutomationState:He})]})]})]})]})})})}function Sn(e){let{disabled:t,...o}=e;window.__c={n:"AutomationNameInput"};const{automationStore:i,maybePersistedTransactionActions:a}=(0,Eo.i)(),l=xn({showDeleteEnableDisableOptions:!1}),s=(0,r.VK)((()=>(null==i?void 0:i.getName())??""),[i]),c=(0,n.useCallback)((e=>{const t=e.target.value;a.createAndCommit({userAction:"Automation.updateName",perform:e=>{C.applyOperation({store:i,operation:{path:["properties"],pointer:i.pointer,command:"update",args:{name:t}},transaction:e})}})}),[i,a]);return(0,I.jsx)(E.ZP,{style:l.automationNameInput,...o,value:s??"Loading...",onChange:c,disabled:t,textWrapperStyle:l.automationNameText})}function vn(e){window.__c={n:"AutomationSourceInput"};const{automationStore:t,maybePersistedTransactionActions:o}=(0,Eo.i)(),i=(0,r.VK)((()=>{if(t&&(0,z.Xd)(t)){const e=t.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();if(e&&"filter"!==e.type)return e.pointer}}),[t]),a=(0,n.useCallback)((e=>{const n=e.table===g.v?{pointer:e,type:g.v}:{pointer:e,type:y.n};o.createAndCommit({userAction:"Automation.updateSource",perform:e=>{C.applyOperation({store:t,operation:{path:["trigger","event"],pointer:t.pointer,command:"update",args:{source:n}},transaction:e})}})}),[t,o]);return(0,I.jsx)(Ze,{selectedSourcePointer:i,onSelect:a,...e})}function xn(e){const{showDeleteEnableDisableOptions:t}=e,{isMobile:o}=(0,i.Fy)();return(0,a.yK)((e=>({automationSection:{display:"flex",flexDirection:"column",gap:4},automationSectionAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0},automationSectionHeader:{alignItems:"center",display:"flex",flexDirection:"row"},automationSectionHeaderAction:{background:`linear-gradient(to right, ${e.stroke.regular} 50%, transparent 50%), linear-gradient(to right, ${e.stroke.regular} 50%, transparent 50%)`,backgroundPosition:"20px 0px, 20px bottom",backgroundRepeat:"no-repeat",backgroundSize:"2px 36px, 2px 6px",marginBlockEnd:-4,paddingBlock:"36px 4px",position:"relative"},automationSectionTitle:{color:e.lightTextColor,fontSize:o?14:12,lineHeight:1.3,position:"relative",fontWeight:f.Z.fontWeight.medium},automationCreateMobile:{boxShadow:"none",paddingBlock:"0 12px",paddingInline:12},automationCreateDesktop:{paddingBlock:t?"12px 0":12,paddingInline:12},automationCreateButton:{...o?{minHeight:45}:{},width:"100%"},automationNameInput:{marginBlockEnd:o?void 0:8},automationNameText:{marginInlineStart:12},automationOptionIconDesktop:{marginInlineStart:12},menuScroller:{...o?{}:{marginBlockStart:6}},wrap:{borderTop:`1px solid ${e.regularDividerColor}`,paddingBlockStart:15,paddingBlockEnd:12,paddingInline:12}})),[o,t])}},78243:(e,t,o)=>{o.d(t,{B:()=>a});var n=o(72126),i=o(18844),r=o(97880);function a(e){var t,o;const{automationStorePointer:a,defaultRecordCache:l,inMemoryRecordCache:s,userId:c}=e;if(!a||!c)return!1;const d=l.getRecordModel({pointer:a,userId:c}),u=s.getRecordModel({pointer:a,userId:c});if(!u)return!0;return!((null==d||null===(t=d.getProperties())||void 0===t?void 0:t.name)===(null===(o=u.getProperties())||void 0===o?void 0:o.name))||(!!function(e,t){if((0,r.$K)(e)){if(e.isEventType()&&t.isEventType()||e.isNotificationType()&&t.isNotificationType()){const o=e.getEventConfiguration(),i=t.getEventConfiguration();return!(0,n.Xy)(o,i)}if(e.isRecurrenceType()&&t.isRecurrenceType()){const o=e.getRecurrence(),i=t.getRecurrence();return!(0,n.Xy)(o,i)}return!e.isButtonType()||!t.isButtonType()}if(t.isEventType()||t.isNotificationType()){const e=t.getEventConfiguration();return!1!==e.pagesAdded||"none"!==e.pagePropertiesEdited.type}if(t.isRecurrenceType())return!0;if(t.isButtonType())return!1;if(t.isAssistantType())return!1;(0,r.t1)(t)}(d,u)||!!function(e,t,o){const{defaultRecordCache:a,inMemoryRecordCache:l,userId:s}=o;if((0,r.$K)(e)){const o=e.getActionIds(),c=t.getActionIds();return o.length!==c.length||!(0,n.Xy)(o,c)||c.some((e=>{const o={id:e,spaceId:t.spaceId,table:i.Xj},c=a.getRecordModel({pointer:o,userId:s}),d=l.getRecordModel({pointer:o,userId:s});return!(0,r.$K)(c)||!(0,n.Xy)(c.getConfig(),null==d?void 0:d.getConfig())}))}return t.getActionIds().length>0}(d,u,{defaultRecordCache:l,inMemoryRecordCache:s,userId:c}))}},40863:(e,t,o)=>{o.d(t,{BO:()=>f,Ft:()=>p,Lh:()=>C,YG:()=>m,du:()=>h,y$:()=>y});o(57658);var n=o(30120),i=o(30823),r=o(40506),a=o(53877),l=o(42875),s=o(72126),c=o(59753),d=o(9291),u=o(28020);function p(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const n=t.normalizedSchemaStore.state,i=o.getQuery(n);if(!i||!i.calendar_by)return;const r=t.dateRangeStart.state,s=t.dateRangeEnd.state,c=(0,a.hT)(r,(0,l.r)()),d=(0,a.hT)(s,(0,l.r)());return g({calendarBy:i.calendar_by,dateRangeStartDate:c,dateRangeEndDate:d})}function m(e){const{collectionContextStore:t,startOfDay:o}=e,i=t.collectionViewStore();if(!i)return;const r=t.normalizedSchemaStore.state,s=i.getQuery(r);if(!s||!s.calendar_by)return;const c=n.ou.fromMillis(o).endOf("day").valueOf(),d=(0,a.hT)(o,(0,l.r)()),u=(0,a.hT)(c,(0,l.r)());return g({calendarBy:s.calendar_by,dateRangeStartDate:d,dateRangeEndDate:u})}function g(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:n}=e;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:n,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function y(e){const{collectionContextStore:t,results:o,getRecordValue:n,intl:i}=e,c=t.collectionViewStore(),d=t.normalizedQueryStore.state,p=t.normalizedSchemaStore.state,m=d?d.calendar_by:void 0,g=t.dateRangeStart.state,y=t.dateRangeEnd.state,v=u.AK.state,x=(0,l.r)(),C=t.getCurrentUserId();if(!(c&&d&&m&&p))return;const b=s.oA(o.map((e=>f({blockStore:e,calendarBy:m,schema:p,getRecordValue:n,userId:C,intl:i})))),w={};o.forEach(((e,t)=>{w[e.id]=t}));0===(d.sort||[]).length&&b.sort(((e,t)=>{const o=e.start.valueOf(),n=t.start.valueOf();if(o===n){return w[e.id]-w[t.id]}return o-n}));const k=(0,a.em)(g,v,x),M=(0,a.gQ)(y,v,x);let j=k;const _=[];do{const e=(0,a.gQ)(j.valueOf(),v,x),t={},o=b.filter((t=>(0,r.b8)(j.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:n,start:i,end:r,includeTime:a,timeZone:l}=o,{startColumn:s,columnCount:c}=h({startUnixTimestampMS:i.valueOf(),endUnixTimestampMS:r?r.valueOf():void 0,startOfWeekUnixTimestampMS:j.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),d=S(s,c,t);return{id:n,start:i.valueOf(),end:r?r.valueOf():void 0,row:d,includeTime:a,timeZone:l}}));_.push({start:j.valueOf(),end:e.valueOf(),items:o}),j=(0,a.em)(j.plus({week:1}).plus({hour:25}).valueOf(),v,x)}while(j<M);return _}function h(e){const t=n.ou.fromMillis(e.startUnixTimestampMS),o=e.endUnixTimestampMS?n.ou.fromMillis(e.endUnixTimestampMS):void 0,i=n.ou.fromMillis(e.startOfWeekUnixTimestampMS),r=n.ou.fromMillis(e.endOfWeekUnixTimestampMS),a=t.startOf("day"),l=n.ou.max(i,a),s=Math.ceil(l.diff(i,"days").get("days"));let c=1;if(o){const e=o.endOf("day"),t=n.ou.min(r,e);c=Math.ceil(t.diff(l,"days").get("days"))}return{start:t,end:o,startOfWeek:i,endOfWeek:r,startColumn:s,columnCount:c}}function f(e){const{blockStore:t,calendarBy:o,schema:n,getRecordValue:r,intl:s,userId:d}=e,u=t.getAssociatedCollectionStore(),p=t.getModel();if(!p)return;const m=(0,i.FT)({property:o,schema:n,block:p,getRecordModel:c.om.fromGetRecordValueFn(r),propertyMapping:null==u?void 0:u.getPropertyMapping(),collectionRequestContext:{userId:d,userTimeZone:(0,l.r)(),depth:0,intl:s,visitedProperties:new Set,resultCache:new Map}}).next().value;if("date"!==m.type)return;const g=m.value,y=g&&(0,a.NK)(g,(0,l.r)());if(!g||!y)return;return{id:p.id,start:y.start,end:y.end,includeTime:"datetime"===g.type||"datetimerange"===g.type,timeZone:"datetime"===g.type||"datetimerange"===g.type?g.time_zone:void 0}}function S(e,t,o){let n=0;for(;;){let i=!1;for(let r=0;r<t;r++)v(o,e+r,n)&&(i=!0);if(!i)break;n++}for(let i=0;i<t;i++)x(o,e+i,n);return n}function v(e,t,o){return Boolean(e[o]&&e[o][t])}function x(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}const C=(0,d.defineMessages)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}})},54802:(e,t,o)=>{o.d(t,{EE:()=>Z,EF:()=>z,Li:()=>O,P$:()=>Q,R4:()=>Y,WM:()=>W,Xd:()=>I,cB:()=>U,i1:()=>R,j_:()=>X,qM:()=>D,qk:()=>K,rU:()=>H,sA:()=>q,tk:()=>$,vM:()=>L,wB:()=>B});o(21703),o(57658);var n=o(43261),i=o.n(n),r=o(67294),a=o(86628),l=o(3865),s=o(28751),c=o(23290),d=o(76205),u=o(1274),p=o(73110),m=o(35102),g=o(76218),y=o(72126),h=o(87479),f=o(4615),S=o(149),v=o(98963),x=o(18844),C=o(77420),b=o(6287),w=o(13493),k=o(97880),M=o(77080),j=o(30874),_=o(79797),A=o(35057),T=o(49117),P=o(65183),V=o(33929);function I(e){return e.isTriggerType("event")||e.isTriggerType("notification_event")}function F(e){const{action:t,actionValue:o,automationValue:n}=e;var i,r,a,l,s,c,d;if("create_page"===t.action.type){if(!o||"create_page"===o.type)return function(e){const{actionId:t,automationId:o,collectionPointer:n,properties:i,values:r,spaceId:a,templatePageId:l}=e;return{...G({actionId:t,actionType:"create_page",automationId:o,spaceId:a}),config:{collection:n,properties:i,values:r,template_page_id:l}}}({actionId:t.action.id,automationId:n.id,collectionPointer:(null===(i=t.action.config)||void 0===i?void 0:i.collection)??(null==o||null===(r=o.config)||void 0===r?void 0:r.collection),properties:(null===(a=t.action.config)||void 0===a?void 0:a.properties)??(null==o||null===(l=o.config)||void 0===l?void 0:l.properties),spaceId:n.space_id,values:(null===(s=t.action.config)||void 0===s?void 0:s.values)??(null==o||null===(c=o.config)||void 0===c?void 0:c.values),templatePageId:null===(d=t.action.config)||void 0===d?void 0:d.template_page_id})}else if("update_pages"===t.action.type){var u,p,m,g,y,h;if(!o||"update_pages"===o.type)return function(e){const{actionId:t,automationId:o,properties:n,spaceId:i,target:r,values:a}=e;return{...G({actionId:t,actionType:"update_pages",automationId:o,spaceId:i}),config:{target:r,properties:n,values:a}}}({actionId:t.action.id,automationId:n.id,properties:(null===(u=t.action.config)||void 0===u?void 0:u.properties)??(null==o||null===(p=o.config)||void 0===p?void 0:p.properties),spaceId:n.space_id,target:(null===(m=t.action.config)||void 0===m?void 0:m.target)??(null==o||null===(g=o.config)||void 0===g?void 0:g.target),values:(null===(y=t.action.config)||void 0===y?void 0:y.values)??(null==o||null===(h=o.config)||void 0===h?void 0:h.values)})}else if("slack_notification"===t.action.type){var f,S,v,x;if(!o||"slack_notification"===o.type)return function(e){const{actionId:t,automationId:o,externalBotId:n,spaceId:i,target:r}=e;return{...G({actionId:t,actionType:"slack_notification",automationId:o,spaceId:i}),config:{target:r,external_bot_id:n}}}({actionId:t.action.id,automationId:n.id,externalBotId:(null===(f=t.action.config)||void 0===f?void 0:f.external_bot_id)??(null==o||null===(S=o.config)||void 0===S?void 0:S.external_bot_id),spaceId:n.space_id,target:(null===(v=t.action.config)||void 0===v?void 0:v.target)??(null==o||null===(x=o.config)||void 0===x?void 0:x.target)})}else{if("duplicate_blocks"===t.action.type||"modal_confirmation"===t.action.type||"open_page"===t.action.type||"query_collection"===t.action.type||"complete_sprint"===t.action.type||"assistant"===t.action.type)return;(0,k.t1)(t.action)}}function Z(e){const{automationStore:t,currentUserId:o,inMemoryRecordCache:n}=e;return(0,a.VK)((()=>{const e=null==t?void 0:t.getRole(),i=null==t?void 0:t.getValue(),r=(null==t?void 0:t.getActionStores().map((e=>e.getValue())).filter(k.$K))??[],a=null==t?void 0:t.pointer;return c=>{if(o&&e&&i&&a){if(!(0,l.Vd)(i)&&!(0,l.nl)(i))return i;if("update_name"===c.type){const t=function(e){var t;const{action:o,automationValue:n}=e;return(null===(t=n.properties)||void 0===t?void 0:t.name)!==o.name?{...n,properties:{...n.properties,name:o.name}}:n}({action:c,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_source"===c.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.pointer,i=n.table===b.v?{pointer:n,type:b.v}:{pointer:n,type:w.n};return{...o,trigger:{...o.trigger,event:{...o.trigger.event,source:i}}}}({action:c,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_trigger"===c.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.trigger;if("page_added"===n.type)return o.trigger.event.pagesAdded?o:{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!0}}};if("any_page_property_edited"===n.type)return"any"!==o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"any"}}}}:o;if("property_changed"===n.type){const e="some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[],t=y.cx(e,(e=>e.property===n.property)),i={filter:n.filter,property:n.property},r=-1===t?[...e,i]:e.map((e=>e.property===n.property?i:e));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{some:r,type:"some"}}}}}(0,k.t1)(n)}({action:c,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_action"===c.type){var d;const t=r.find((e=>e.id===c.action.id)),l=F({action:c,actionValue:t,automationValue:i});if(!l)return;if(n.setRecord({pointer:{id:l.id,spaceId:i.space_id,table:x.Xj},userId:o},{role:"editor",value:l}),null===(d=i.action_ids)||void 0===d||!d.includes(l.id)){const t={...i,action_ids:[...i.action_ids??[],l.id]};n.setRecord({pointer:a,userId:o},{role:e,value:t})}n.emitAll()}else if("remove_action"===c.type){const r=c.action.id;n.deleteRecord({pointer:{id:r,spaceId:i.space_id,table:x.Xj},userId:o});const l={...i,action_ids:(i.action_ids??[]).filter((e=>e!==r))};n.setRecord({pointer:a,userId:o},{role:e,value:l}),function(e){const{automationStore:t,newAutomationValue:o,currentUserId:n,inMemoryRecordCache:i}=e,r=t.getParentStore();if((null==r?void 0:r.table)!==b.v)return;const a={automationStore:t,parentPointer:r.getSpaceShardedPointer(),type:"event",persisted:!0,intl:V.default.getIntl(),parentRecordStore:r},l=(0,T.pt)({context:a,automationValue:o});if(S.x.isFail(l))return;const c=(o.action_ids??[]).map((e=>({pointer:{id:e,spaceId:o.space_id,table:x.Xj},userId:n})));for(const u of c){const e=i.getRecordModel(u),t=i.getRecord(u);if(!e||!t||!t.value||"create_page"!==t.value.type&&"update_pages"!==t.value.type)continue;const o=new Set(l.value.actionInputValueTypes[e.id].map((e=>{if(e.kind===p.yp.ContextValue)return e.id;e.kind!==p.yp.ThisRow&&e.kind!==p.yp.Binding&&(0,k.t1)(e)})).filter(k.$K)),n=(0,s.z)(e.type).acceptFormulaVisitor({action:e,visitor:{visitVariableOutsideOfFormula:e=>o.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormula:e=>e.value&&(0,g.UB)(e).some((e=>!o.has(e)))?{type:"replace",value:void 0}:{type:"keep"}}});let r=t.value;for(const i of n)if("update"===i.command)if(1===i.path.length&&"config"===i.path[0]&&Object.keys(i.args).includes("target")&&"update_pages"===r.type)r={...r,config:{target:void 0,properties:[],values:{}}};else if(2===i.path.length&&"config"===i.path[0]&&"values"===i.path[1]){var d;const e=Object.keys(i.args)[0];r={...r,config:{...r.config,values:{...null===(d=r.config)||void 0===d?void 0:d.values,[e]:void 0}}}}i.setRecord(u,{value:r,role:t.role})}}({automationStore:t,newAutomationValue:l,currentUserId:o,inMemoryRecordCache:n}),n.emitAll()}else if("remove_trigger"===c.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.trigger;if("page_added"===n.type)return o.trigger.event.pagesAdded?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!1}}}:o;if("any_page_property_edited"===n.type)return"any"===o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"none"}}}}:o;if("property_changed"===n.type){const e=("some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[]).filter((e=>e.property!==n.property));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:e.length>0?{some:e,type:"some"}:{type:"none"}}}}}(0,k.t1)(n)}({action:c,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else(0,k.t1)(c)}}}),[t,o,n])}function K(e){const{automationContextStore:t,automationStore:o,collectionStore:n}=e,i=n.getSchema(),r=o.getKeyStore("properties").getKeyStore("name").getValue();if(null==r||!r.trim())return!1;const a=o.getTrigger(),l="event"===(null==a?void 0:a.type),s="notification_event"===(null==a?void 0:a.type);if(!l&&!s)return!1;const{pagesAdded:c,pagePropertiesEdited:d,source:u}=a.event;if(void 0===u)return!1;if("some"===d.type&&d.some.some((e=>E({collectionSchema:i,property:e.property})||N({collectionSchema:i,property:e.property,type:"trigger"}))))return!1;if(!c&&("none"===d.type||"some"===d.type&&0===d.some.length))return!1;const p=o.getActionStores().filter((e=>e.isDefined()));return 0!==p.length&&p.every((e=>function(e){const{actionStore:t,automationContextStore:o,collectionStore:n}=e;if(t.isType("slack_notification"))return(0,k.$K)(t.getConfigStore().getKeyStore("external_bot_id").getValue())&&(0,k.$K)(t.getConfigStore().getKeyStore("target").getValue());if(t.isType("update_pages")){const e=t.getConfigStore().getKeyStore("target").getValue(),i=t.getConfigStore().getKeyStore("properties").getValue()??[];if(!(0,k.$K)(e)||0===i.length)return!1;if("collection"===e.type){const t=_.NW.createChildStore(n,e.collection).getSchema();if(i.some((e=>E({property:e,collectionSchema:t})||N({collectionSchema:t,property:e,type:"action"}))))return!1}else if("variable"===e.type){const t=(0,m.MY)(e.id);if("global"===t.source&&"button_page"===t.global){const e=n.getSchema();if(i.some((t=>E({property:t,collectionSchema:e})||N({collectionSchema:e,property:t,type:"action"}))))return!1}else{const t=null==o?void 0:o.compilationResultStore.state;if(!t||S.x.isFail(t))return!1;const n=(0,m.vx)(t.value.valueTypes,e.id),r=n?B(n,o.context.parentRecordStore):void 0;if(!r)return!1;const a=r.getSchema();if(i.some((e=>E({property:e,collectionSchema:a})||N({collectionSchema:a,property:e,type:"action"}))))return!1}}else{if("page"===e.type)return!1;(0,k.t1)(e)}return!0}if(t.isType("create_page")){const e=t.getConfigStore().getKeyStore("collection").getValue();if(!(0,k.$K)(e))return!1;const o=_.NW.createChildStore(n,e).getSchema();return!(t.getConfigStore().getKeyStore("properties").getValue()??[]).some((e=>E({property:e,collectionSchema:o})||N({collectionSchema:o,property:e,type:"action"})))}if(t.isType("assistant"))return!0;throw new Error(`isActionStoreComplete not implemented for ${t.getType()}`)}({actionStore:e,automationContextStore:t,collectionStore:n})))}function B(e,t){let o;return"block"===e.type.type&&e.type.collection?o=_.NW.createChildStore(t,e.type.collection):"array"===e.type.type&&"block"===e.type.of.type&&e.type.of.collection&&(o=_.NW.createChildStore(t,e.type.of.collection)),o}function O(e){const{collectionStore:t}=e;if(!t)return!1;if((t.getFormat().automation_ids??[]).length>=c.ss&&!(0,A.sX)())return!1;const o=t.pointer,n=t.getSpaceId();return(0,u.IC)({targetTriggerType:"event",targetParentPointer:o,targetSpaceId:n}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,h.yY)(i,n)}))}function R(e){const{automationStore:t,actionStores:o}=e,n=t.getMinimumFieldsForPermissions();if(!n)return!1;if(!o.every((e=>e.isDefined())))return!1;const i=o.some((e=>!e.isType("slack_notification")));if(!(0,A.sX)()&&i)return!1;return(0,u.fz)({automationValue:n,actionValues:o.map((e=>({config:e.getConfig(),type:e.getType()})))}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,h.yY)(i,n)}))}function D(e){const{automationStore:t}=e,o=t.getMinimumFieldsForPermissions();if(!o)return!1;return(0,u.bM)(o).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,h.yY)(i,n)}))}function W(e){const{anyOptionCheckState:t,currentFilter:o,propertyId:n,updateCurrentState:i}=e;!0===t?i({type:"update_trigger",trigger:{type:"property_changed",property:n,filter:{operator:"changes_to_any"}}}):!1===t?i({type:"remove_trigger",trigger:{type:"property_changed",property:n,filter:{operator:"changes_to_any"}}}):"partial"===t?i({type:"update_trigger",trigger:{type:"property_changed",property:n,filter:o}}):(0,k.t1)(t)}function E(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function N(e){const{collectionSchema:t,property:o,type:n}=e,i=null==t?void 0:t[o];return!i||("action"===n?!(0,l.SF)(i):!l.Ym[i.type])}function L(e){const{automationStore:t,collectionStore:o}=e;if(!t.isTriggerType("event")&&!t.isTriggerType("notification_event"))return!1;const n=t.getEventConfiguration();if(!n||void 0===n.source||n.source.type===b.v||"filter"===n.source.type)return!1;const i=_.Xr.createChildStore(o,n.source.pointer);return function(e){const t=H(e);return(0,k.$K)(t)}({collectionSchema:o.getSchema(),collectionViewStore:i})}function H(e){var t;const{collectionViewStore:o,collectionSchema:n}=e,i=o.getPropertyFiltersStore().getValue()??[],r=null===(t=o.getQuery(n))||void 0===t?void 0:t.filter,a={operator:"and",filters:(0,d.OH)({propertyFilters:i,combinatorFilter:r,schema:n})},s=(0,d.SH)(a,(e=>{if((0,d.aN)(e)){const t=n[e.property];return!!t&&!(0,l.TX)(t)}return!1}));if(s)return(0,d.aN)(s)?s.property:(0,d.Mm)(s)?s.timestamp:void 0}function U(e){if("collectionTypedView"===e.contextType)return!1;const t=e.collectionStore();return!!t&&!(t.isSyncedCollection()&&!M.default.checkGate("support_synced_database_automations"))}function z(e){const{collectionSchema:t,propertyIds:o,searchTerm:n}=e;if(!n)return o.slice(0);const r=new Map,a=o.map((e=>{const o=t[e],n=o?`${o.name} ${P.SO[o.type]}`:"";return r.set(e,n),n})),l=i().filter(n,a).map((e=>{let{original:t}=e;return t}));return o.filter((e=>l.includes(r.get(e)??"")))}function $(e){return S.x.isFail(e.compilationResultStore.state)?[]:e.compilationResultStore.state.value.valueTypes}function q(e){const{automationId:t,automationName:o,collectionStore:n,userId:i}=e;return function(e){const{actionIds:t,automationId:o,collectionStore:n,eventConfiguration:i,lastEditedTime:r,properties:a,userId:l}=e,s=Date.now();return{action_ids:t,alive:!0,created_by_id:l,created_by_table:"notion_user",created_time:s,id:o,last_edited_by_id:l,last_edited_by_table:"notion_user",last_edited_time:r??s,parent_id:n.id,parent_table:b.v,properties:a??{},space_id:n.getSpaceId(),status:"active",trigger:{event:i,id:(0,f.ZP)(),type:"event"},version:1}}({actionIds:[],automationId:t,collectionStore:n,eventConfiguration:{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:n.getSpaceShardedPointer(),type:b.v}},properties:{name:o},userId:i})}function G(e){const{actionId:t,actionType:o,automationId:n,spaceId:i}=e;return{alive:!0,id:t??(0,f.ZP)(),parent_id:n,parent_table:v.cv,space_id:i,type:o,version:1}}function Y(e){const t=e.getActionStores().filter((0,k.AO)((e=>e.isType("slack_notification")?{true:e}:{false:e}))),o={};for(const n of t){const e=n.getConfig(),t=null==e?void 0:e.external_bot_id;if(!t)continue;const i=_.Qx.createChildStore(n,{id:t,spaceId:n.getSpaceId(),table:C.cZ}).getCreatedByStore();i&&(o[n.id]=i.getDisplayName(V.default.getIntl()))}return o}async function Q(e){const{automationAvailabilityContext:t}=e;let o=t.automation.getTriggerType();"notification_event"===o&&(o="event");const n=c.Gl[o],i="default_bound"===n.max?c.xZ:n.max;if(t.automationActions.length>=i)return[];const r=(0,s.P)("display"),a=[];for(const l of r)await l.isAvailableForContext(t)&&a.push(l);return a}function X(){const e=(0,a.VK)((()=>j.Z.completeSlackAuthentications.state),[]);return(0,r.useMemo)((()=>0===e.length?{type:"connectToSlackDefault"}:1===e.length?{type:"selectChannelNew"}:{type:"selectWorkspace"}),[e.length])}},25498:(e,t,o)=>{o.d(t,{m:()=>r,w:()=>a});o(57658);var n=o(81491),i=o(98165);const r=[{frequency:"day",interval:1},{frequency:"week",interval:1},{frequency:"month",interval:1},{frequency:"year",interval:1}],a=e=>{const t=i.qA(e)??[],o=[];for(const n of t){if(!("block"===n.table&&!0===n.isTemplate()&&n.getFormat().automation_id&&n.id!==e.id))continue;const t=n.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&o.push(t.getModel())}}return{automationStoresReady:!0,violatesConstraint:(0,n.templateAncestorsViolateRecurrenceNesting)(o)}}},68910:(e,t,o)=>{o.d(t,{L:()=>u});var n=o(14577),i=o(35102),r=o(72126),a=o(149),l=o(6287),s=o(97880),c=o(49117),d=o(79797);class u{constructor(e){this.context=void 0,this.compilationResultStore=new n.Z((()=>(0,c.pt)({context:this.context})),{useDeepEqual:!0,debugName:"compilationResultsStore"}),this.context=e}getAllContextValues(){const e=this.compilationResultStore.state;return a.x.isFail(e)?[]:r.d9(e.value.valueTypes)}getCollectionStore(){const e=this.context;if("button_block"===e.type)return e.pageStore.getAssociatedCollectionStore();if("button_property"===e.type)return e.collectionContextStore.collectionStore();if("event"===e.type)return d.NW.createChildStore(e.parentRecordStore,e.parentPointer);if("recurrence"!==e.type&&"structured_automation"!==e.type)if("assistant"===e.type){if(e.parentPointer.table===l.v)return d.NW.createChildStore(e.parentRecordStore,e.parentPointer)}else(0,s.t1)(e)}getContextValuesForAction(e){const t=this.compilationResultStore.state;return a.x.isFail(t)?[]:t.value.actionInputValueTypes[e]??[]}getValidationErrorsForAction(e){const t=this.compilationResultStore.state;return a.x.isFail(t)?[]:t.value.actionValidationFailures[e]??[]}getContextValueForActionById(e,t){const o=this.getContextValuesForAction(e);return(0,i.vx)(o,t)}}},91738:(e,t,o)=>{o.d(t,{Bh:()=>a,H0:()=>l});var n=o(49085),i=o(72126);class r extends n.default{getInitialState(){return{insertionPoint:void 0,stack:[]}}getCurrentTab(){return i.Z$(this.getState().stack)}getInsertionPoint(){return this.getState().insertionPoint}pushSettingsItem(e){this.update((t=>({...t,stack:[...t.stack,e]})))}popSettingsItem(){this.update((e=>({...e,stack:e.stack.slice(0,e.stack.length-1)})))}replaceSettingsItem(e){this.update((t=>{const o=[...t.stack.slice(0,t.stack.length-1),e];return{...t,stack:o}}))}setInsertionPoint(e){this.update((t=>({...t,insertionPoint:e})))}}class a extends r{}class l extends r{}},36857:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(49085);class i extends n.default{getInitialState(){return{pageId:void 0}}}const r=new i},22109:(e,t,o)=>{o.d(t,{T:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("arrowsUpDown",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M4.11 2.385a.61.61 0 01.48-.211c.191 0 .353.07.486.21L8.03 5.409a.66.66 0 01.2.475c0 .191-.061.347-.182.469a.627.627 0 01-.463.181.59.59 0 01-.451-.187L5.926 5.098l-.72-.844.04 1.219v7.242a.624.624 0 01-.187.469.624.624 0 01-.47.187.636.636 0 01-.468-.187.635.635 0 01-.182-.47V5.474l.041-1.22-.726.845-1.201 1.248a.61.61 0 01-.457.187.627.627 0 01-.463-.181.634.634 0 01-.182-.47.66.66 0 01.2-.474l2.958-3.023zm7.786 10.781a.636.636 0 01-.486.205.665.665 0 01-.486-.205l-2.947-3.035a.64.64 0 01-.206-.475c0-.191.061-.345.182-.463a.634.634 0 01.469-.181c.18 0 .33.06.451.181l1.201 1.248.727.85-.041-1.219V2.824c0-.187.06-.342.181-.463a.636.636 0 01.47-.187.627.627 0 01.65.65v7.248l-.041 1.219.726-.85 1.207-1.248a.6.6 0 01.451-.181c.188 0 .342.06.463.181a.615.615 0 01.182.463.648.648 0 01-.2.475l-2.953 3.035z"})})},65422:(e,t,o)=>{o.d(t,{K:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("boltFilled",{svg:(0,i.jsx)("path",{d:"M0 12.117c0 .38.293.664.703.664h5.518l-2.91 7.91c-.381 1.006.664 1.543 1.318.723l8.877-11.094c.166-.205.254-.4.254-.625 0-.371-.293-.664-.703-.664H7.539l2.91-7.91C10.83.115 9.785-.422 9.131.408L.254 11.492c-.166.215-.254.41-.254.625z"}),viewBox:"0 0 14 22"})},39132:(e,t,o)=>{o.d(t,{c:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("eye",{viewBox:"0 0 32 32",svg:(0,i.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})},1230:(e,t,o)=>{o.d(t,{H:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("insertDown",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M9.55548 13.0343H14.2085C14.5315 13.0343 14.7951 13.2913 14.7951 13.6142C14.7951 13.9372 14.5315 14.1942 14.2085 14.1942H9.55548C9.23254 14.1942 8.9755 13.9372 8.9755 13.6142C8.9755 13.2913 9.23254 13.0343 9.55548 13.0343ZM1.21167 9.67959C1.21167 9.09961 1.52802 8.74371 2.0421 8.74371C2.55617 8.74371 2.87911 9.11279 2.87911 9.65982V10.7868C2.87911 10.945 2.96479 11.0373 3.12956 11.0373H4.70473V10.365C4.70473 9.818 5.26494 9.60709 5.68675 9.94322L7.56509 11.4525C7.84849 11.6766 7.84849 12.0786 7.56509 12.2961L5.68675 13.812C5.25176 14.1679 4.70473 13.9569 4.70473 13.3836V12.7047H2.93184C1.89051 12.7047 1.21167 12.0984 1.21167 11.057V9.67959ZM9.55548 9.58073H14.2085C14.5315 9.58073 14.7951 9.83777 14.7951 10.1607C14.7951 10.4837 14.5315 10.7407 14.2085 10.7407H9.55548C9.23254 10.7407 8.9755 10.4837 8.9755 10.1607C8.9755 9.83777 9.23254 9.58073 9.55548 9.58073ZM1.78506 6.12721H14.2085C14.5315 6.12721 14.7951 6.38425 14.7951 6.70719C14.7951 7.03014 14.5315 7.28717 14.2085 7.28717H1.78506C1.46211 7.28717 1.20508 7.03014 1.20508 6.70719C1.20508 6.38425 1.46211 6.12721 1.78506 6.12721ZM1.78506 2.68028H14.2085C14.5315 2.68028 14.7951 2.93073 14.7951 3.25367C14.7951 3.5832 14.5315 3.83365 14.2085 3.83365H1.78506C1.46211 3.83365 1.20508 3.5832 1.20508 3.25367C1.20508 2.93073 1.46211 2.68028 1.78506 2.68028Z"})})},41490:(e,t,o)=>{o.d(t,{F:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("insertUp",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M9.55566 3.61987H14.2095C14.5325 3.61987 14.7961 3.36279 14.7961 3.03979C14.7961 2.7168 14.5325 2.45972 14.2095 2.45972H9.55566C9.23267 2.45972 8.97559 2.7168 8.97559 3.03979C8.97559 3.36279 9.23267 3.61987 9.55566 3.61987ZM1.21045 6.9751C1.21045 7.55518 1.52686 7.91113 2.04102 7.91113C2.55518 7.91113 2.87817 7.54199 2.87817 6.99487V5.86768C2.87817 5.70947 2.96387 5.61719 3.12866 5.61719H4.7041V6.28955C4.7041 6.83667 5.2644 7.04761 5.68628 6.71143L7.56494 5.2019C7.84839 4.97778 7.84839 4.57568 7.56494 4.35815L5.68628 2.84204C5.25122 2.48608 4.7041 2.69702 4.7041 3.27051V3.94946H2.93091C1.8894 3.94946 1.21045 4.55591 1.21045 5.59741V6.9751ZM9.55566 7.07397H14.2095C14.5325 7.07397 14.7961 6.81689 14.7961 6.4939C14.7961 6.1709 14.5325 5.91382 14.2095 5.91382H9.55566C9.23267 5.91382 8.97559 6.1709 8.97559 6.4939C8.97559 6.81689 9.23267 7.07397 9.55566 7.07397ZM1.78394 10.5281H14.2095C14.5325 10.5281 14.7961 10.271 14.7961 9.948C14.7961 9.625 14.5325 9.36792 14.2095 9.36792H1.78394C1.46094 9.36792 1.20386 9.625 1.20386 9.948C1.20386 10.271 1.46094 10.5281 1.78394 10.5281ZM1.78394 13.9756H14.2095C14.5325 13.9756 14.7961 13.7251 14.7961 13.4021C14.7961 13.0725 14.5325 12.822 14.2095 12.822H1.78394C1.46094 12.822 1.20386 13.0725 1.20386 13.4021C1.20386 13.7251 1.46094 13.9756 1.78394 13.9756Z"})})},53523:(e,t,o)=>{o.d(t,{N:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("repeat",{viewBox:"0 0 16 14",svg:(0,i.jsx)("path",{d:"M1.185 7.317a.689.689 0 00.697-.704v-.601c0-1.19.806-1.942 2.064-1.942H9.23v1.573c0 .328.199.52.527.52a.66.66 0 00.403-.144l2.68-2.236c.253-.212.26-.547 0-.765L10.16.782A.62.62 0 009.757.64c-.328 0-.527.184-.527.52v1.53H4.05C1.875 2.69.48 3.9.48 5.875v.738c0 .397.308.704.705.704zm13.624-.649a.689.689 0 00-.698.704v.608c0 1.19-.806 1.942-2.064 1.942H6.763V8.35c0-.329-.199-.52-.527-.52a.66.66 0 00-.403.144l-2.68 2.242c-.26.212-.26.547 0 .759l2.68 2.242a.66.66 0 00.403.143c.328 0 .527-.191.527-.52v-1.544h5.181c2.174 0 3.569-1.21 3.569-3.179v-.745a.695.695 0 00-.704-.704z"})})},81491:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>m,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>d,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>c,MAX_RECURRENCE_INTERVAL:()=>l,RRULE_WEEKDAYS_MAP:()=>a,getRecurrenceAfter:()=>p,rruleFromRecurrence:()=>s,templateAncestorsViolateRecurrenceNesting:()=>u});var n=o(30120),i=o(84885);const r={day:i.Ci.DAILY,week:i.Ci.WEEKLY,month:i.Ci.MONTHLY,year:i.Ci.YEARLY},a={MO:i.Ci.MO,TU:i.Ci.TU,WE:i.Ci.WE,TH:i.Ci.TH,FR:i.Ci.FR,SA:i.Ci.SA,SU:i.Ci.SU},l=100;function s(e){const{start_date:t,frequency:o,interval:n,weekdays:l,timezone:s,hour:c,minute:d}=e,u="week"===o&&l?l.map((e=>a[e])):void 0;return new i.Ci({freq:r[o],dtstart:new Date(t),interval:n,byweekday:u,tzid:s,byhour:c??0,byminute:d??0,bysecond:0})}const c=1,d=1;function u(e){const t=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)}));return e.length>c||t.length>=d}function p(e){const{recurrence:t,afterDate:o}=e,i=s({...t}).after(new Date(o));if(!i)return;return n.ou.fromJSDate(i).toUTC().setZone("local",{keepLocalTime:!0}).toJSDate()}const m=100}}]);