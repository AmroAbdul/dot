"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9729],{80671:(e,t,n)=>{n.d(t,{Cl:()=>m,Kj:()=>g,jw:()=>_,k2:()=>f,v5:()=>l});n(21703);var o=n(72126),a=n(4615),s=n(19889),r=n(896),i=n(12139),d=n(86572),u=n(80444),c=n(79797),p=n(63423);function f(){p.Z.setState({open:!0,stage:"limit_reached",addOnUpgradeId:(0,a.ZP)(),tax:0})}function l(){p.Z.setState({open:!1})}function m(e){const t=p.Z.state;t.open&&p.Z.setState({...t,stage:"confirm_purchase",coupon:e&&!(0,r.$v)(e)?e:void 0})}function g(){p.Z.setState({open:!0,stage:"cancel_plan",addOnUpgradeId:(0,a.ZP)(),tax:0})}async function _(e){const{environment:t,spaceStore:n,from:a}=e,r=function(){var e;const t=null===(e=u.default.state.currentSpaceStore)||void 0===e?void 0:e.getAdminIds();if(!t||0===t.length)throw new Error("No admins found in the current space");return(0,o.UP)(t)}(),p=n.getName(),f=c.U6.createChildStore(n,{table:s.KJ,id:r});await f.load();const l=f.getEmail();l?d.bf(t,{admin_id:r,admin_email:l,space_name:p,from:a}):i.IE(new Error("Could not get email for admin in sendMemberRequestForAddOn"))}},71487:(e,t,n)=>{n.d(t,{AG:()=>u,yY:()=>d});var o=n(9291),a=n(54642),s=n(47307),r=n(33929);n(80444);const i=(0,o.defineMessages)({invalidCoupon:{id:"applyCoupon.error.invalidCoupon",defaultMessage:"Unable to apply the coupon to your account."}});async function d(e,t){const{customerId:n,offerType:o}=t,r=await a.getCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===o?t.newPlan:void 0,offerType:o});if("failed"===r.type)s.showError(r);else{const e=r.data;if(e.offerType===o)return e.coupon}}async function u(e,t){const{customerId:n,coupon:o,offerType:d}=t;if(!o)return void s.showErrorMessage(r.default.formatMessage(i.invalidCoupon));const u=await a.applyCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===d?t.newPlan:void 0,offerType:d,coupon:o});"failed"===u.type&&s.showError(u)}},74011:(e,t,n)=>{n.r(t),n.d(t,{AddOnDiscountPopup:()=>O});var o=n(67294),a=n(480),s=n(86628),r=n(24405),i=n(92595),d=n(11751),u=n(3791),c=n(896),p=n(9291),f=n(86572),l=n(82530),m=n(37181),g=n(38755),_=n(77907),v=n(80444),S=n(80671),w=n(71487),y=n(70060),P=n(43163),h=n(88893),b=n(35057),A=n(88280),C=n(85893);function O(){window.__c={n:"AddOnDiscountPopup"};const e=(0,a.O7)(),[t,n]=o.useState(void 0);(0,o.useEffect)((()=>{(0,i.exposeDebugValue)("resetAddOnDiscountPopup",(()=>{const{currentUserSettingsStore:t}=v.default.state;t&&l.createAndCommit({userAction:"AddOnDiscountPopup.resetAddOnPromoPopup",environment:e,perform:e=>{m.d2({userSettingsStore:t,transaction:e,data:{seen_ai_discount_popup:!1}})}})}))}),[e]);const{currentUserSettingsStore:O,currentSpaceStore:I}=(0,s.VK)((()=>v.default.state),[]),M=(0,s.VK)((()=>A.subscriptionDataStoreInstance.state),[]);(0,o.useEffect)((()=>{!async function(){var t;if(!I)return;if(!M)return;if(!(0,h.GJ)(M))return;if("unsubscribed_admin"!==M.type&&"subscribed_admin"!==M.type)return;if("stripe"!==(null===(t=M.customerData)||void 0===t?void 0:t.activeSubscriptionPlatform)||!M.customerData.stripe.isSubscribed)return;const o=h.XX(M);if((0,u.de)(null==o?void 0:o.addOns))return;const a=null!=o&&o.customerId?await w.yY(e,{offerType:"add_on_upgrade_flow",customerId:o.customerId}):void 0;(0,c.pp)(a)&&n(a)}()}),[e,I,M]);const D=(0,o.useCallback)((()=>{O&&(l.createAndCommit({userAction:"AddOnDiscountPopup.markSeen",environment:e,perform:e=>{m.d2({userSettingsStore:O,transaction:e,data:{seen_ai_discount_popup:!0}})}}),f.j(e,{name:"add_on_discount_popup_dismissed"}))}),[O,e]),x=(0,o.useCallback)((()=>{t&&(S.k2(),S.Cl(t))}),[t]),E=(0,s.VK)((()=>!(!(0,c.pp)(t)||!(0,y.px)(e,(0,b.zt)())||(0,g.CV)(I))),[t,e,I]),j=(0,r.yK)((e=>({icon:{width:20,height:20,fill:e.accentColors.purple[400]}})),[]);return E?(0,C.jsx)(_.LazyFeatureIntroPopup,{calloutId:"add_on_discount_popup",initialPromo:{icon:d.t,iconStyle:j.icon,header:(0,C.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.header",defaultMessage:"Add unlimited AI for {percentage} off?",values:{percentage:(0,c.pp)(t)?(0,P.o)(t):void 0}}),description:(0,C.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.description",defaultMessage:"Project management is better with Notion AI. Add it on top of your paid plan with half off."})},steps:[],seenFeatureUserSetting:"seen_ai_discount_popup",userSettingsStore:O,allowExternalMouseEvents:!0,onDismiss:D,onTryFeatureClick:x,isUserEligible:E,onPopupSeen:()=>f.j(e,{name:"add_on_discount_popup_seen"}),onLearnMore:()=>{t&&x(),D()},ctaMessage:(0,C.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.purchase.button",defaultMessage:"Claim your deal"})}):null}},43163:(e,t,n)=>{n.d(t,{o:()=>r});n(67294);var o=n(97880),a=n(9291),s=n(85893);function r(e){if("ai_fifty_percent"===e)return(0,s.jsx)(a.FormattedMessage,{id:"addOnUpgrade.confirmation.costSection.specialDiscounts.fiftyPercent",defaultMessage:"50%"});(0,o.t1)(e)}}}]);