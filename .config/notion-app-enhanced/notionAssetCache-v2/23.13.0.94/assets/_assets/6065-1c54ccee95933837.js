"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[6065],{96065:(e,t,s)=>{s.d(t,{Z:()=>ct,s:()=>rt});s(57658),s(21703);var o=s(67294),i=s(83355),a=s(92996),n=s(41892),r=s(6906),l=s(58573),c=s(42853),d=s(90199),p=s(47453),u=s(35840),g=s(54497),m=s(72126),h=s(21202),v=s(97880),S=s(82990),f=s(9291),y=s(88295),x=s(60870),M=s(82530),T=s(37181),j=s(51592),I=s(52275),b=s(61519),w=s(1743),P=s(56940),k=s(68894),Z=s(3386),C=s(16354),A=s(68785),B=s(78140),N=s(89728),O=s(31278),L=s(72495),V=s(14871),F=s(26388),_=s(64369),R=s(45653),E=s(60442),q=s(12457),W=s(28020),K=s(87279),H=s(98742),z=s(44499),D=s(98165),U=s(58239),G=s(18514),Q=s(38755),X=s(95697),Y=s(77907),$=s(80444),J=s(62395),ee=s(88632),te=s(77080),se=s(63334),oe=s(29798),ie=s(49085);class ae extends ie.default{getInitialState(){return{chosenSpaceId:void 0}}getChosenSpaceId(){const{chosenSpaceId:e}=this.state,{currentSpaceStore:t}=$.default.state;return e||(null==t?void 0:t.id)}getChosenSpaceStore(){var e;return null===(e=this.getChosenSpaceViewStore())||void 0===e?void 0:e.getSpaceStore()}getChosenSpaceViewStore(){const{chosenSpaceId:e}=this.state,{currentSpaceViewStore:t,currentUserRootStore:s}=$.default.state;if(!e&&t)return t;if(e&&s){return s.getSpaceViewStores().find((t=>t.getSpaceId()===e))}}}const ne=ae;var re=s(42330),le=s(79797),ce=s(72087),de=s(30765),pe=s(32163),ue=s(43765),ge=s(23586),me=s(75822),he=s(85893);function ve(e){let{query:t,spaceId:s,menuListStore:o,requestStore:i,getAutocompleteItems:a}=e;return(0,he.jsx)(ge.Z,{request:{query:t,spaceId:s},render:(e,s)=>(0,he.jsx)(Se,{sections:s,error:e,menuListStore:o,initialFocus:Boolean(t)?0:void 0}),requestStore:i,debounce:me.vp,performRequest:a})}function Se(e){let{sections:t,error:s,menuListStore:o,initialFocus:i}=e;return s?(0,he.jsx)(L.Z,{children:(0,he.jsx)(ue.Z,{title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Something went wrong.",id:"moveBlockMenu.errorOnMove.label"})})}):t&&0===t.length?(0,he.jsx)(L.Z,{children:(0,he.jsx)(ue.Z,{title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"No results",id:"moveBlockMenu.noResults.label"})})}):(0,he.jsx)(pe.Z,{type:pe.i.Vertical,initialFocus:i,sections:t||[],store:o})}var fe=s(6287),ye=s(15047),xe=s(29369),Me=s(86628),Te=s(24405),je=s(11470),Ie=s(76798),be=s(65598);function we(e){window.__c={n:"MoveToMenuItem"};const{store:t,menuListItemProps:s,hidePath:o}=e,i=(0,Me.VK)((()=>function(e){if((0,be.OY)(e)&&!e.canEdit())return(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.needEditAccess.tooltip",defaultMessage:'You need "Can edit" access to "{parentName}" to move this page',values:{parentName:(0,he.jsx)(Ie.Z,{store:e,shouldWrap:!0})}});if((0,be.Y)(e)&&!e.canAddOrRemoveTopLevelPages())return(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.TeamSidebarLocked.tooltip",defaultMessage:"This teamspace has its sidebar locked. You must be a teamspace owner to move to this teamspace."})}(t)),[t]),a=Boolean(i),n=(0,Te.yK)((e=>({disabledTooltip:{maxWidth:240},recordMenuItem:a?{color:e.mediumTextColor}:{}})),[a]);return(0,he.jsx)(F.ZP,{placement:F.ug.Left,textWrap:!0,style:n.disabledTooltip,disableTooltip:!a,renderTooltip:()=>i,render:e=>(0,he.jsx)(je.Z,{...(0,H.Z)(s,e),disabled:a,store:t,hidePath:o,style:n.recordMenuItem})})}var Pe=s(480),ke=s(86176),Ze=s(75024);function Ce(e){let{spaceStore:t,collectionStore:s,menuListItemProps:o}=e;window.__c={n:"MoveToModalTypedItem"};const i=(0,Pe.O7)(),a=(0,Te.yK)((e=>({caption:{color:e.lightTextColor,fontSize:(0,Ze.yv)(i,"UISmall")}})),[i]);return(0,he.jsx)(je.Z,{caption:(0,he.jsx)("div",{style:a.caption,children:(0,he.jsx)(Ae,{spaceStore:t,collectionStore:s})}),store:s,...o})}function Ae(e){let{spaceStore:t,collectionStore:s}=e;window.__c={n:"PathCaption"};const o=(0,Pe.O7)(),i=(0,Me.VK)((()=>function(e){let{environment:t,spaceStore:s,collectionStore:o}=e;const i=(0,j.tV)({environment:t,spaceStore:s,collectionStore:o});switch(i){case"team":return null;case"private":return(0,he.jsx)(f.FormattedMessage,{id:"moveToHelpers.privatePageCaptionPrefix",defaultMessage:"Private"});case"shared":return(0,he.jsx)(f.FormattedMessage,{id:"moveToHelpers.sharedPageCaptionPrefix",defaultMessage:"Shared"});default:(0,v.t1)(i)}}({environment:o,spaceStore:t,collectionStore:s})),[o,t,s]),a=(0,Me.VK)((()=>(0,ke.L)(s)),[s])&&(0,he.jsx)(ke.Z,{store:s,showFullPathInTooltip:!0});return a&&i?(0,he.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[i,(0,he.jsx)("div",{style:{paddingLeft:4,paddingRight:4},children:"/"}),a]}):a&&!i?a:(0,he.jsx)(he.Fragment,{children:i})}function Be(e){let{spaceStore:t,value:s,showPath:o,isCreateIn:i,onAccept:a}=e;const n=function(e){let{spaceStore:t,value:s}=e;const{type:o}=s;switch(o){case"page":return le.G.createChildStore(t,{table:h.iU,id:s.id});case"collection":return le.NW.createChildStore(t,{table:fe.v,id:s.id});case"space":return le.H2.createChildStore(t,{table:ye.bx,id:s.id});case"team":return le.zX.createChildStore(t,{table:xe.e0,id:s.id});case"space-private-pages":return;default:(0,v.t1)(o)}}({spaceStore:t,value:s});if(n)return(0,z.Hn)()&&n instanceof le.NW?{key:n.id,render:e=>(0,he.jsx)(Ce,{spaceStore:t,collectionStore:n,menuListItemProps:e}),action:()=>a(s)}:{key:n.id,render:e=>(0,he.jsx)(we,{store:n,menuListItemProps:e,hidePath:!!i&&!o}),action:()=>a(s)}}var Ne=s(59054),Oe=s(69327),Le=s(41432),Ve=s(16184),Fe=s(39567),_e=s(73990),Re=s(64921),Ee=s(5210),qe=s(35026),We=s(74016);const Ke=100,He=14,ze=24;function De(e){return(e+1)*He}function Ue(e){window.__c={n:"MoveToOutlinerItem"};const{store:t,spaceStore:s,spaceViewStore:i,depth:a,isAlias:n}=e,r=(0,Pe.O7)(),l=(0,Te.Fg)(),[c,p]=o.useState(!1),u=(0,Te.yK)((e=>({noChildrenLabelItem:{paddingLeft:De(a)+ze,fontSize:14,paddingBottom:6.5,color:e.lightTextColor},outlinerItem:{display:"flex",flexDirection:"row",fontSize:14,height:28,paddingLeft:De(a),color:e.regularTextColor,alignItems:"center"},icon:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,width:22,height:18,marginRight:4,position:"relative"}})),[a]);function g(){const e=re.ZP.state,s=e.isOpen?e.flowId:void 0;p(!c),_e.w6(r,{flowId:s,is_toggled:!c,destination_type:t?t.table:"private_pages"})}const m=(0,Me.VK)((()=>{if(t){const e=(0,he.jsx)("div",{children:(0,Fe.Y)({position:"absolute",width:"50%",height:"50%",right:0,bottom:0})});return t instanceof le.zX?(0,he.jsx)("div",{style:u.icon,children:(0,he.jsx)(We.p,{disabled:!0,store:t,size:18})}):(0,he.jsxs)("div",{style:u.icon,children:[(0,he.jsx)(O.Z,{icon:t instanceof le.G?t.getIcon():void 0,isEmptyPage:t instanceof le.G&&t.isEmptyPage(),title:void 0,size:18,disabled:!0}),n&&e]})}return(0,he.jsx)(R.Z,{size:16,userStore:(0,W.B7)(r),style:{marginLeft:3}})}),[t,u.icon,r,n]),v=(0,Me.VK)((()=>t?t.table===xe.e0?"private"!==t.getTeamAccessLevel()?(0,he.jsx)("div",{style:{maxWidth:"80%"},children:(0,he.jsx)(Ie.Z,{store:t})}):(0,he.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",maxWidth:"80%"},children:[(0,he.jsx)(Ie.Z,{store:t}),(0,Ve.Q)({width:14,height:14,marginLeft:4,fill:l.mediumIconColor})]}):(0,he.jsx)("div",{style:{maxWidth:"80%"},children:(0,he.jsx)(Ie.Z,{store:t})}):(0,he.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:7},children:[(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Private pages",id:"outliner.addToPrivatePages"}),(0,he.jsx)("div",{style:{marginLeft:2},children:(0,d.b)({width:14,height:14,fill:l.mediumIconColor,marginLeft:4})})]})),[t,l.mediumIconColor]),S=(0,Me.VK)((()=>{const e=new Set([Le.Ti.page,Le.Ti.collectionViewPage,Le.Ti.collectionView,Le.Ti.alias]),s=new Set([Le.Ti.factory]);let o=[];return t?t instanceof le.zX?o=t.getTeamPagesStores():t instanceof le.G&&(o=(0,qe.Q2)(t,s,e)):o=i.getPrivatePages(r),o}),[t,i,r]);const y=0!==S.length?(0,he.jsx)(Ge,{spaceStore:s,spaceViewStore:i,itemStores:S,depth:a+1,onAccept:e.onAccept,targets:e.targets}):(0,he.jsx)("div",{style:u.noChildrenLabelItem,children:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"No pages inside",id:"outliner.NoPagesInside.placeholder"})});return(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(Re.Z,{onClick:function(){e.moveToPagesOnly&&(null==t?void 0:t.table)!==h.iU?g():t?t instanceof le.G?e.onAccept({type:"page",id:t.id,spaceId:s.id}):e.onAccept({type:"team",id:t.id,spaceId:s.id}):e.onAccept({type:"space-private-pages",spaceId:s.id})},children:(0,he.jsxs)("div",{style:u.outlinerItem,children:[(0,he.jsx)(Ee.Z,{isSidebar:!0,fill:!0,icon:"chevron",open:c,color:l.mediumIconColor,onClick:g}),m,v]})}),c&&a<Ke&&y]})}function Ge(e){window.__c={n:"MoveToOutliner"};const{spaceStore:t,spaceViewStore:s,itemStores:o,depth:i}=e,a=(0,Me.VK)((()=>{const a=o?m.oA(o.map((o=>{if(o instanceof le.zX&&o.canAddOrRemoveTopLevelPages()||o instanceof le.G&&(0,z.Xk)(o,e.targets)&&o.canEdit()){const a=o instanceof le.G&&o.getType()===Le.Ti.alias,n=a?o.getAliasTargetStore():void 0,r=n instanceof le.G?n:o;return(0,he.jsx)(Ue,{spaceStore:t,spaceViewStore:s,store:r,depth:i,onAccept:e.onAccept,targets:e.targets,isAlias:a,moveToPagesOnly:e.moveToPagesOnly},o.id)}}))):[];return e.addedItems?[...e.addedItems,...a]:a}),[o,e.addedItems,e.moveToPagesOnly,e.targets,e.onAccept,t,s,i]),n=(0,Te.yK)((e=>({sectionHeader:{color:e.mediumTextColor,fontSize:12,fontWeight:S.Z.fontWeight.medium,padding:"12px 14px 4px 14px"}})),[]);return(0,he.jsxs)(w.Z,{debugName:"MoveToOutliner",capture:!0,children:[e.title&&(0,he.jsx)("div",{style:n.sectionHeader,children:(0,he.jsx)(_.Z,{isSmall:!0,children:e.title})}),(0,he.jsx)("div",{children:a})]})}function Qe(e){window.__c={n:"MoveToModal"};const{spaceStore:t,spaceViewStore:s,targets:o,moveToPagesOnly:i}=e,a=(0,Me.VK)((()=>$.default.state.currentUserStore),[]),n=(0,Pe.O7)(),r=(0,f.useIntl)(),l=(0,Te.yK)((()=>({modal:{height:374,maxHeight:"70vh",paddingBottom:12},body:{width:"100%"}})),[]),[c]=(0,Ne.r5)((async()=>t&&a?await(0,X.qX)({environment:n,spaceStore:t,currentUserId:a.id}):[]),[n,t,a]),d=(0,Me.VK)((()=>{if(!c.value)return;const e=s.getTeamsStores().filter((e=>e.canAddOrRemoveTopLevelPages()));return e.length>=7?e:m.mN([...e,...c.value||[]],(e=>e.id)).filter((e=>e.canAddOrRemoveTopLevelPages())).slice(0,7)}),[s,c.value]),p=(0,Me.VK)((()=>Xe({spaceStore:t,targets:o})),[t,o]),u=(0,Me.VK)((()=>s.getWorkspacePages().filter((e=>(0,z.Xk)(e,o)&&e.canEdit()))),[s,o]),g=(0,Me.VK)((()=>{if(Ye({environment:n,targets:o,chosenSpaceStore:t}))return(0,he.jsx)(Ue,{spaceStore:t,spaceViewStore:s,store:void 0,depth:0,onAccept:e.onAccept,targets:e.targets,moveToPagesOnly:i},"MoveToModal private item")}),[n,i,e,t,s,o]);return t&&s?(0,he.jsx)("div",{style:l.modal,children:(0,he.jsx)("div",{style:l.body,children:(0,he.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,he.jsx)(Ge,{spaceStore:t,spaceViewStore:s,itemStores:p,addedItems:[g],moveToPagesOnly:i,depth:0,title:r.formatMessage({defaultMessage:"Suggested",id:"moveToModal.suggestedSection.title"}),onAccept:e.onAccept,targets:e.targets}),d&&d.length>0&&(0,he.jsx)(Ge,{spaceStore:t,spaceViewStore:s,itemStores:d,moveToPagesOnly:i,depth:0,title:r.formatMessage({defaultMessage:"Teamspaces",id:"moveToModal.teamsSection.title"}),onAccept:e.onAccept,targets:e.targets}),u.length>0&&(0,he.jsx)(Ge,{spaceStore:t,spaceViewStore:s,itemStores:u,moveToPagesOnly:i,depth:0,title:r.formatMessage({defaultMessage:"Workspace",id:"moveToModal.workspaceSection.title"}),onAccept:e.onAccept,targets:e.targets})]})})}):null}function Xe(e){let{spaceStore:t,targets:s}=e,o=Oe.Z.getWithoutSubscribing(t.id).map((e=>{let{store:t}=e;return t})).filter((e=>e.pathIsAccessibleAndAlive()&&!s.some((t=>"block"===t.table&&t.id===e.id))));const i=s.filter((e=>"block"===e.getParentTable())).map((e=>e.getParentId())),a=i.length===s.length,n=[...new Set(i)];return a&&1===n.length&&(o=o.filter((e=>e.id!==n[0]))),o.slice(0,7)}function Ye(e){let{environment:t,targets:s,chosenSpaceStore:o}=e;const i=(0,Q.Cx)(o),a=s.every((e=>e.isTopLevelPrivatePage({spaceStore:o,environment:t})));return!i&&!a}var $e=s(84169),Je=s(73063),et=s(43568),tt=s(40215);const st=(0,s(45238).I)("boxedPerson",{viewBox:"0 0 26 25",svg:(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)("path",{d:"M21.719 19.406h-2.004V21.2c0 2.414-1.219 3.633-3.68 3.633H4.27c-2.438 0-3.668-1.219-3.668-3.633V9.34c0-2.413 1.23-3.632 3.668-3.632h2.015V3.914C6.285 1.5 7.515.281 9.953.281H21.72c2.46 0 3.68 1.219 3.68 3.633v11.86c0 2.414-1.22 3.632-3.68 3.632Zm-.024-1.886c1.172 0 1.817-.633 1.817-1.852V4.02c0-1.22-.645-1.852-1.817-1.852H9.988c-1.16 0-1.816.633-1.816 1.852v1.687h7.863c2.461 0 3.68 1.207 3.68 3.633v8.18h1.98Zm-5.683 5.425c1.16 0 1.816-.633 1.816-1.851V9.445c0-1.218-.656-1.851-1.816-1.851H4.305c-1.16 0-1.817.633-1.817 1.851v11.649c0 1.218.657 1.851 1.817 1.851h11.707Z"}),(0,he.jsx)("path",{d:"M10.24 14.855c1.176 0 2.164-1.042 2.164-2.39 0-1.316-1-2.32-2.165-2.32s-2.17 1.02-2.164 2.33c0 1.338.993 2.38 2.164 2.38ZM6.661 19.85h7.15c.6 0 .966-.285.966-.757 0-1.386-1.757-3.287-4.539-3.287-2.787 0-4.538 1.901-4.538 3.287 0 .472.36.757.961.757Z"})]})});function ot(e){window.__c={n:"MoveToModalTypedEmptyState"};const{onClick:t,databaseType:s}=e,o=(0,Pe.O7)(),i=(0,Te.yK)((e=>({modal:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginTop:32,marginBottom:32},icon:{width:20,fill:e.mediumTextColor},title:{marginTop:6,fontWeight:S.Z.fontWeight.semibold,color:e.mediumTextColor},subtitle:{marginTop:2,marginLeft:14,marginRight:14,textAlign:"center"},button:{fontWeight:S.Z.fontWeight.semibold,fontSize:(0,Ze.yv)(o,"UISmall")}})),[o]),a=(0,j.sN)(s),n=(0,j.Q_)(s);return(0,he.jsxs)("div",{style:i.modal,children:[st(i.icon),(0,he.jsx)(_.Z,{isSmall:!0,style:i.title,children:(0,he.jsx)(f.FormattedMessage,{id:"moveToModalTypedEmptyState.title",defaultMessage:"No other {singleItemName} databases",values:{singleItemName:a}})}),(0,he.jsx)(_.Z,{isSmall:!0,isMultiline:!0,style:i.subtitle,children:(0,he.jsx)(f.FormattedMessage,{id:"moveToModalTypedEmptyState.subtitle",defaultMessage:"Try adding {pluralItemName} to another teamspace",values:{pluralItemName:n}})}),(0,he.jsx)(N.Z,{isBlue:!0,onClick:t,style:i.button,children:(0,he.jsx)(f.FormattedMessage,{id:"moveToModalTypedEmptyState.button",defaultMessage:"Move somewhere else"})})]})}function it(e){let{spaceStore:t,spaceViewStore:s,targets:o,menuListStore:i,onAccept:n}=e;window.__c={n:"MoveToModalTyped"};const l=(0,Pe.O7)(),c=(0,Te.yK)((()=>({modal:{maxHeight:"70vh"},loadingShimmer:{padding:16}})),[]),d=(0,Me.VK)((()=>s.getTeamsStores().map((e=>e.id))),[s]),p=(0,tt.F)({environment:l,spaceStore:t,parentStore:t,joinedTeamIds:d,moveToTargets:o,overrideDatabaseType:void 0}),u=(0,Me.VK)((()=>p.success?p.typedDatabases.map((e=>function(e){const{store:t,spaceStore:s,onAccept:o}=e,i={key:t.id,render:e=>(0,he.jsx)(Ce,{spaceStore:s,collectionStore:t,menuListItemProps:e}),action:()=>o({type:"collection",id:t.id,spaceId:s.id})};return i}({store:e,spaceStore:t,onAccept:n}))):[]),[p,t,n]),g=(0,Me.VK)((()=>re.ZP.getTargetsDatabaseType()),[]);if(!p.success)return(0,he.jsx)("div",{style:c.loadingShimmer,children:(0,he.jsx)(et.Z,{paragraphs:[{lineHeight:18,lineMargin:4,sectionWidths:[100],repeat:1,sectionMargin:0},{lineHeight:14,lineMargin:4,sectionWidths:[100,40],repeat:1,sectionMargin:-2}]})});if(!g)throw new Error("Trying to show typed moveTo modal when database type is not available.");if(0===u.length)return(0,he.jsx)(ot,{databaseType:g,onClick:()=>{re.ZP.state.isOpen&&re.ZP.setState({...re.ZP.state,variant:a.br})}});const m=(0,j.sN)(g),h=[{key:"suggested",render:e=>(0,he.jsx)(L.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"{typedItemName} databases",id:"moveToModalTyped.suggestedMenuSection.title",values:{typedItemName:(0,r.Z)(m)}}),right:(0,he.jsx)(at,{typedItemName:m})}),items:u.slice(0,7)}];return(0,he.jsx)("div",{style:c.modal,children:(0,he.jsx)(pe.Z,{initialFocus:0,type:pe.i.Vertical,sections:h||[],store:i})})}function at(e){let{typedItemName:t}=e;window.__c={n:"TypedMoveToTooltip"};const s=(0,Te.yK)((e=>({icon:{width:13,height:13,fill:e.mediumIconColor},iconButton:{height:18,width:18,padding:0,marginTop:-4,marginBottom:-4,marginRight:-4}})),[]),o=(0,f.useIntl)();return(0,Pe.Fy)().isMobile?null:(0,he.jsx)(F.ZP,{placement:F.ug.Bottom,style:{width:220},textWrap:!0,renderTooltip:()=>(0,he.jsx)(f.FormattedMessage,{defaultMessage:"{typedItemName} properties will be kept when moving to these locations",id:"moveTypedMenu.tooltip",values:{typedItemName:m.kC(t)}}),render:e=>(0,he.jsx)(Je.Z,{ariaLabel:o.formatMessage({id:"moveToModalTyped.helpIcon.ariaLabel",defaultMessage:"Help icon for moving typed pages."}),icon:$e.m,iconStyle:s.icon,style:s.iconButton,...e})})}const nt=5,rt=(0,f.defineMessages)({createSubpage:{id:"moveToOrCreateMenu.createSubpage.description",defaultMessage:"Create a new sub-page where your cursor is, inside the current block."},newPageIn:{id:"moveToOrCreateMenu.newPageIn.description",defaultMessage:"Create a new page inside any existing page, then link to it in one go."},turnInto:{id:"moveToOrCreateMenu.turnInto.description",defaultMessage:"Turn blocks into new pages inside any existing database or page."},privatePagesTitle:{defaultMessage:"Private Pages",id:"moveBlockMenu.privatePagesMenuTitle"}});class lt extends i.Z{constructor(){super(...arguments),this.storeTypes={ignoreSelectionAreaStore:se.Z,moveToSpaceMenuStore:ne,requestStore:ce.Z,menuListStore:oe.Z},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_getAutocompleteItems=e=>async function(e,t,s,o,i,n,c,d,p,u,g,S){const{currentUserRootStore:y,mainEditorCurrentBlockStore:M,currentSpaceStore:T}=$.default.state,{query:I}=e,b=g.getChosenSpaceStore();if(!(y&&b&&M&&T))return[];const w=(0,U.lX)({spaceStore:b,currentUserId:t.currentUser.id}),[P,k,Z,C]=await async function(e,t,s,o,i){const a=[],n=[],r=[];let l=[];if(t&&dt()){const n=await Y.deps.searchActions.loader(),l=await n.searchPageIds({environment:i,query:t,limit:20,spaceId:e.id,requireEditPermissions:!1,excludeTemplates:!1,source:"move_to_menu",boostRecentlyViewedPages:!0});for(const t of l.results){const i=le.G.createChildStore(e.getPagesStore(),{table:h.iU,id:t});if((0,z.Xk)(i,s)){const e={blockId:i.id,isEditable:i.canEdit()};ut(i,o)?r.push(e):a.push(e)}}}else{l=(await x.I0(e,e.id)).map((t=>{const s=le.G.createChildStore(e.getPagesStore(),{table:h.iU,id:t});return{blockId:s.id,isEditable:s.canEdit()}})),l=l.filter((t=>{let{blockId:i}=t;const a=le.G.createChildStore(e.getPagesStore(),{table:h.iU,id:i});if((0,z.Xk)(a,s)){const e={blockId:a.id,isEditable:a.canEdit()};return!ut(a,o)||(r.push(e),!1)}}));const t=W.Xb(i);for(const e of t)if((0,z.Xk)(e,s)){const t={blockId:e.id,isEditable:e.canEdit()};ut(e,o)?r.push(t):n.push(t)}}return[a,n,r,l]}(b,I,o,i,t),A=await w;if((0,z.Hn)())return await async function(e,t,s,o,i,n,c,d){const{chosenSpaceStore:p,savedQuickAddParent:u,query:g,blockResults:h,recentPageResults:S}=e,{typedSuggestedMenuSection:y,typedSuggestedResults:x}=await async function(e,t,s,o,i){if(!re.ZP.state.isOpen||re.ZP.state.variant===a.br||!J.n.state)throw new Error("Trying to render section when it's either not open, untyped, or typed but uninitialized (i.e. the typed databases are not fetched yet)");const n=re.ZP.getTargetsDatabaseType(),c=(0,j.sN)(n),{typedDatabases:d}=J.n.state;let p;p=te.default.checkGate("typed_move_to_improved_search")?await async function(e,t,s,o,i){const{databaseType:a,query:n,searchSessionId:r}=e,l=ht(i);if(!l)return[];const c=await Y.deps.searchActions.loader(),d=(await c.searchCollectionsWithRecents({environment:t,query:n,limit:20,databaseType:a,parentStore:l,spaceStore:l,collectionViewBlockStore:void 0,searchSessionId:r})).results,p=d.map((e=>Be({spaceStore:l,value:{type:"collection",id:e,spaceId:l.id},showPath:!0,isCreateIn:s,onAccept:s?o:e=>gt(e,o,t)}))).filter(v.$K);return p}({query:e,databaseType:n?[n]:void 0,searchSessionId:re.ZP.state.flowId},t,s,o,i):function(e,t,s,o){const{query:i,typedDatabases:a}=e,n=ht(o);if(!n||!i||!a)return[];const r=(0,l.ZP)(i,a,(e=>{const t=String(e.getName())||"",s=(0,D.u3)(e);return[t,s instanceof le.zX&&s.getName()||""].join(" ")}));return r.map((e=>Be({spaceStore:n,value:{type:"collection",id:e.id,spaceId:n.id},showPath:!0,isCreateIn:t,onAccept:s}))).filter(v.$K)}({query:e,typedDatabases:d},s,o,i);const u={key:"suggested",render:e=>(0,he.jsx)(L.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"{typedItemName} databases",id:"moveBlockMenu.typedSuggestedSection.title",values:{typedItemName:(0,r.Z)(c)}}),right:(0,he.jsx)(at,{typedItemName:c})}),items:p.slice(0,nt)};return{typedSuggestedMenuSection:u,typedSuggestedResults:d}}(g,t,s,o,c);if(re.ZP.state.isOpen&&"aggregated_type"===re.ZP.state.moveToContext)return[y].filter((e=>e.items.length>0));let M=(0,z.XQ)({recentPageResults:S,blockResults:h,suggestedPages:x});const T=new Set((0,z.qB)(i));T.size>0&&(M=M.filter((e=>!T.has(e.blockId))));const I=m.mN(m.VS(m.oA([St({query:g,savedQuickAddParent:u},n,s,o,c),...M.map((e=>{let{blockId:t}=e;return Be({spaceStore:p,value:{type:"page",id:t,spaceId:p.id},showPath:!g,isCreateIn:s,onAccept:o})}))])),(e=>e.key)),b=m.oA(yt(g,s,o,c,d)).slice(0,nt),w=y.items.length>0,P={key:"teams",render:e=>(0,he.jsx)(L.Z,{...e,desktopStyle:{paddingTop:w?0:6,paddingBottom:6},title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Teamspaces",id:"typedMoveBlockMenu.teamsSection.title"})}),items:b},k=y.items.length>0&&0===P.items.length;return[y,P,{key:"pages",render:e=>(0,he.jsx)(L.Z,{...e,desktopStyle:{paddingTop:k?0:6,paddingBottom:6},title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Pages",id:"typedMoveBlockMenu.pagesSection.title"})}),items:I}].filter((e=>e.items.length>0))}({chosenSpaceStore:b,savedQuickAddParent:A,query:I,blockResults:P,recentPageResults:C},t,i,n,o,c,g,S);if(i)return function(e,t,s,o,i,a,n,r,l,c,d,p,u,g,h){const v=[],S=new Set,y=e=>{if(!e)return!1;const{key:t}=e;return!S.has(t)&&(S.add(t),!0)},x=m.oA([pt({query:t},n,c,d,p,r,u)]);!x.length||Boolean(l)||Boolean(r)||v.push({key:"defaults",render:e=>(0,he.jsx)(L.Z,{...e}),items:x});const M=m.oA([...a.slice(0,5).map((t=>{let{blockId:s}=t;return Be({spaceStore:e,value:{type:"page",id:s,spaceId:e.id},showPath:!Boolean(l)&&!Boolean(r),isCreateIn:u,onAccept:d})})),...s.slice(0,10).map((s=>{let{blockId:o}=s;return Be({spaceStore:e,value:{type:"page",id:o,spaceId:e.id},showPath:!t,isCreateIn:u,onAccept:d})})),...o.slice(0,10).map((s=>{let{blockId:o}=s;return Be({spaceStore:e,value:{type:"page",id:o,spaceId:e.id},showPath:!t,isCreateIn:u,onAccept:d})}))].slice(0,20).filter(y));M.length>0&&v.push({key:"blocks",render:e=>(0,he.jsx)(L.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Suggested",id:"moveBlockMenu.suggestedSection.title"}),topBorder:v.length>0&&!Boolean(l)&&!Boolean(r)}),items:M});const T=m.oA(yt(t,u,d,g,h).filter(y));T.length>0&&(0,X.bq)()&&v.push({key:"teams",render:e=>(0,he.jsx)(L.Z,{...e,isTitleUppercase:!0,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Teamspaces",id:"moveBlockMenu.teamsSection.title"}),topBorder:v.length>0}),items:T});const j=m.oA(i.slice(0,5).map((t=>{let{blockId:s}=t;return Be({spaceStore:e,value:{type:"page",id:s,spaceId:e.id},showPath:!0,isCreateIn:u,onAccept:d})})).filter(y));j.length>0&&v.push({key:"templates",render:e=>(0,he.jsx)(L.Z,{...e,isTitleUppercase:!0,title:r?(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Add from template",id:"moveBlockMenu.addFromTemplate.title"}):(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Move to template",id:"moveBlockMenu.moveToTemplate.title"}),topBorder:v.length>0}),items:j});x.length&&(Boolean(l)||Boolean(r))&&v.push({key:"defaults",render:e=>(0,he.jsx)(L.Z,{...e,topBorder:v.length>0}),items:x});return v}(b,I,P,k,Z,C,t,c,d,o,n,p,i,g,S);return function(e,t,s,o,i,a,n,r,l,c,d,p,u,g,h,v){const S=function(e,t,s,o,i,a,n,r,l){const c=0===e.length&&t?Xe({spaceStore:t,targets:i}):[],d={key:"suggested",render:e=>(0,he.jsx)(L.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Suggested",id:"moveBlockMenu.suggestedSection.title"})}),items:m.oA([ft({query:e,chosenSpaceStore:t},s,o,a,i,n,l),...c.filter((e=>(0,z.Xk)(e,i))).map((e=>Be({spaceStore:t,value:{type:"page",id:e.id,spaceId:t.id},showPath:!1,isCreateIn:r,onAccept:n})))])};return d}(s,e,r,l,c,d,p,u,v),y=[...n.slice(0,3),...o.slice(0,20)],x={key:"pages",render:e=>(0,he.jsx)(L.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Pages",id:"moveBlockMenu.pagesSection.title"})}),items:m.mN(m.VS(m.oA([St({query:s,savedQuickAddParent:t},g,u,p,h),...y.map((t=>{let{blockId:o}=t;return Be({spaceStore:e,value:{type:"page",id:o,spaceId:e.id},showPath:!s,isCreateIn:u,onAccept:p})}))])),(e=>e.key))},M={key:"teams",render:e=>(0,he.jsx)(L.Z,{...e,title:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Teamspaces",id:"moveBlockMenu.teamsSection.title"})}),items:m.oA(yt(s,u,p,h,v)).slice(0,10)};return[S,M,x].filter((e=>e.items.length>0))}(b,A,I,P,0,0,C,t,s,o,u,n,i,c,g,S)}(e,this.environment,this.theme,this.props.targets,this.props.isCreateIn,this.props.onAccept,this.props.isAddTo,this.props.isTurnIntoPage,this.props.parentBlockId,this.props.intl,this.stores.moveToSpaceMenuStore,this.allTargetsAreNavigableStore),this.allTargetsAreNavigableStore=this.createComputedStore((()=>this.props.targets.every((e=>e.isNavigableBlock()))))}renderComponent(){if(!this.props.isAddTo&&!this.props.isCreateIn&&!re.ZP.state.isOpen)return(0,he.jsx)(he.Fragment,{});const{device:e}=this.environment,{autocompleteQuery:t,isAddTo:s,isTurnIntoPage:o}=this.props,{requestStore:i,menuListStore:a}=this.stores,n=!i.state.ready&&t.length>0;let r,l;return r=dt()?e.isPhone?this.renderInputMenuItem(n):(0,he.jsx)(L.Z,{isInput:!0,children:this.renderInputMenuItem(n)}):void 0,l=e.isPhone?{onMouseEnter:this.props.onMouseEnter,menuType:K.og.Modal,title:o?(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Add to another page",id:"moveBlockMenu.mobileNewPageInj.label"}):s?(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Add new page in",id:"moveBlockMenu.mobileAddTo.label"}):(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Move to",id:"moveBlockMenu.mobileMoveTo.label"}),right:(0,he.jsx)(f.FormattedMessage,{defaultMessage:"Done",id:"moveBlockMenu.rightDoneButton.label"}),onClickRight:this.props.onCancel,header:r}:{onMouseEnter:this.props.onMouseEnter,menuType:K.og.Popup,width:this.props.desktopWidth,header:r},(0,he.jsxs)(w.Z,{debugName:"MoveToOrCreateMenu",capture:!0,allowMenuList:!0,allowEsc:!0,allowTabUntab:!1,allowUndo:!1,children:[(0,he.jsx)(Z.Z,{debugName:"MoveToOrCreateMenu",capture:!0,onEsc:this.props.onCancel}),(0,he.jsx)(P.Z,{store:this.stores.ignoreSelectionAreaStore,capture:this.props.captureSelection,ignoreBlockSelection:!1,restoreSelection:this.props.restoreSelection,render:()=>{var e;const t=!Boolean(this.props.autocompleteQuery)&&!this.environment.device.isPhone||(0,z.Hn)()&&!Boolean(this.props.autocompleteQuery);return(0,he.jsx)(B.Z,{...l,footer:this.renderFooter(),children:t?this.renderMoveToModal():(0,he.jsx)(ve,{query:this.props.autocompleteQuery,spaceId:null===(e=ht(this.stores.moveToSpaceMenuStore))||void 0===e?void 0:e.id,menuListStore:a,requestStore:i,getAutocompleteItems:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_getAutocompleteItems})})}})]})}renderMoveToModal(){const e=ht(this.stores.moveToSpaceMenuStore),t=vt(this.stores.moveToSpaceMenuStore);if(!t||!e)return;if((0,z.Hn)())return(0,he.jsx)(it,{spaceStore:e,spaceViewStore:t,onAccept:e=>gt(e,this.props.onAccept,this.environment),targets:this.props.targets,menuListStore:this.stores.menuListStore});const s=(0,Q.Cx)(e);return(0,he.jsx)(Qe,{spaceStore:e,spaceViewStore:t,onAccept:this.props.onAccept,targets:this.props.targets,moveToPagesOnly:!this.allTargetsAreNavigableStore.state||s})}renderFooter(){const{isCreateIn:e,isAddTo:t,intl:s}=this.props,{currentUserRootStore:o,currentSpaceStore:i}=$.default.state,a=this.stores.moveToSpaceMenuStore.getChosenSpaceStore();if(!o||!a||!i)return;if(!(this.allTargetsAreNavigableStore.state&&!i.getDisableMoveToSpace()&&!e&&!t))return null;const n=o.getSpaceViewStores(),r=m.mN(m.oA(n.map((e=>{const t=e.getSpaceStore();return!(0,Q.Cx)(t)&&t}))),(e=>e.id)),l={menuTitle:s.formatMessage({defaultMessage:"Workspaces",id:"moveBlockMenu.spaceSwitcher.menuTitle"}),items:r,selectedItem:a,onSelect:e=>{this.stores.moveToSpaceMenuStore.setState({chosenSpaceId:e.id})},getKey:e=>e.id,renderItem:e=>(0,he.jsx)(I.Z,{...e,checkState:e.value.id===a.id,title:(0,Q.rn)(this.environment,e.value),icon:(0,he.jsx)(O.Z,{icon:(0,Q.Wd)(this.environment,e.value),isEmptyPage:!1,size:20,disabled:!0,title:(0,Q.rn)(this.environment,e.value)})}),renderOrigin:e=>{return(0,he.jsxs)(N.Z,{isSmall:!0,style:{fontWeight:"normal",fontSize:12,flexShrink:1},...e,children:[(0,he.jsx)(O.Z,{disabled:!0,icon:a.getIcon(),isEmptyPage:!1,size:16,title:a.getName(),style:{marginRight:4}}),(0,he.jsx)(de.s,{children:(0,Q.rn)(this.environment,a)}),(0,c.i)((t=this.theme,{width:10,marginLeft:4,fill:t.lightIconColor}))]});var t},width:150};return(0,he.jsxs)("div",{children:[(0,he.jsx)(b.Z,{vertical:!1,size:1}),(0,he.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",padding:"4px"},children:(0,he.jsx)(V.Z,{...l},"space-switcher")})]})}renderInputMenuItemLabel(){const{intl:e,isAddTo:t,isTurnIntoPage:s}=this.props;if(mt(this.stores.moveToSpaceMenuStore))return e.formatMessage({defaultMessage:"Duplicate page…",id:"moveToMenuRenderer.duplicateToSpace.label"});if((0,z.Hn)()){const t=(0,j.sN)(re.ZP.getTargetsDatabaseType());return e.formatMessage({defaultMessage:"Move {typedItemName} to…",id:"moveToMenuRenderer.moveTo.typedLabel"},{typedItemName:t})}return s?e.formatMessage({defaultMessage:"Search page to add in…",id:"moveToMenuRenderer.addNewPageIn.label"}):t?e.formatMessage({defaultMessage:"Search page to add to…",id:"moveToMenuRenderer.addTo.label"}):e.formatMessage({defaultMessage:"Move page to…",id:"moveToMenuRenderer.moveTo.teamLabel"})}renderInputMenuItem(e){const{device:t}=this.environment,{autocompleteQuery:s}=this.props,o=(0,z.Hn)()&&re.ZP.state.isOpen&&re.ZP.state.variant===a.ii&&!J.n.state;return(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(k.ZP,{onCancel:()=>{re.ZP.state.isOpen&&re.ZP.setState({...re.ZP.state,isOpen:!1})},disabled:o,focus:!t.isMobile||void 0,focusAfterAnimation:!0,value:s,onChange:e=>{this.props.onAutocompleteQueryChange(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:this.renderInputMenuItemLabel(),inputLeft:(0,he.jsx)(k.f_,{icon:u.R}),inputRight:(0,he.jsx)(q.Z,{show:e,showDelay:400,showHold:0,render:e=>e&&(0,he.jsx)(A.Z,{style:{marginRight:2}})}),style:{marginBottom:-2}}),mt(this.stores.moveToSpaceMenuStore)&&(0,he.jsxs)(_.Z,{isMultiline:!0,isSecondaryColor:!1,style:{background:this.theme.accentColors.gray[30],marginTop:12,marginLeft:12,marginRight:12,padding:8,borderRadius:6},children:[(0,g.t)({fill:this.theme.accentColors.orange[400],width:14,height:14,marginRight:4,alignSelf:"center",display:"inline-block",verticalAlign:"text-bottom"}),(0,he.jsx)("span",{children:(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.duplicateToSpace.message",defaultMessage:"You can only duplicate pages into another workspace — not move them."})}),(0,he.jsx)(C.Z,{href:(0,G.UY)("guides.duplicateToSpace"),style:{color:this.theme.accentColors.gray[500],fontWeight:S.Z.fontWeight.semibold,marginTop:4},children:(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.duplicateToSpace.learnMoreLink",defaultMessage:"Learn more"})})]})]})}}lt.displayName="MoveToOrCreateMenu";const ct=(0,f.injectIntl)(lt);function dt(){return ee.Z.state.online}function pt(e,t,s,o,i,a,r){if(!a||!r)return;if(e.query)return;const l=$.default.state.mainEditorCurrentBlockStore;if(!l)return;const c=i?le.G.createChildStore(l,{table:h.iU,id:i}):void 0,d=y.gt(c);return d?{key:d.pageStore.id,render:e=>{const o=t=>(0,he.jsx)(I.Z,{...(0,H.Z)(t||{},e),icon:(0,p.R)({width:14}),title:s.length>1?(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.currentPage.pluralAddTitle",defaultMessage:"New sub-pages"}):(0,he.jsx)(f.FormattedMessage,{id:"moveBlockMenu.currentPage.singleAddTitle",defaultMessage:"New sub-page"})});return t.device.isPhone?o():(0,he.jsx)(F.ZP,{renderTooltip:()=>(0,he.jsx)(E.Z,{imageURL:n.Z.images.tooltips.pageMenu.newSubpagePng,imageWidth:140,imageHeight:100,caption:(0,he.jsx)(f.FormattedMessage,{...rt.createSubpage})}),placement:F.ug.Right,delayThreshold:0,render:e=>o(e)})},action:()=>o(d.createInValue)}:void 0}function ut(e,t){return!!t&&e.isTemplate()}function gt(e,t,s){var o;t(e);const i=re.ZP.getTargetsDatabaseType(),a=null===(o=$.default.state.currentSpaceStore)||void 0===o?void 0:o.id;"collection"===e.type&&i&&a&&M.createAndCommit({userAction:"TypedMoveToMenu.handleClick",environment:s,perform:t=>{T.zq({transaction:t,dbType:i,collectionId:e.id})}})}function mt(e){var t;return!!e&&e.getChosenSpaceId()!==(null===(t=$.default.state.currentSpaceStore)||void 0===t?void 0:t.id)}function ht(e){return e.getChosenSpaceStore()??$.default.state.currentSpaceStore}function vt(e){return e.getChosenSpaceViewStore()??$.default.state.currentSpaceViewStore}function St(e,t,s,o,i){const{query:a,savedQuickAddParent:n}=e,r=ht(i);if(r)return t&&!a&&"space"===n.type||"page"===n.type?Be({spaceStore:r,value:n,showPath:!0,isCreateIn:s,onAccept:o}):void 0}function ft(e,t,s,o,i,a,n){var r;const{query:c,chosenSpaceStore:p}=e,u=rt.privatePagesTitle,g=o.formatMessage(u).replace(/<[^>]*>/g,""),m=c?null===(r=(0,l.C6)(c,g))||void 0===r?void 0:r.score:void 0,h=c&&(m||0)>=l.V5;if((!c||h)&&n.state&&(!p||Ye({environment:t,targets:i,chosenSpaceStore:p})))return{key:"private",render:e=>(0,he.jsx)(I.Z,{icon:(0,he.jsx)(R.Z,{size:22,userStore:(0,W.B7)(t)}),title:(0,he.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,he.jsx)("span",{children:(0,he.jsx)(f.FormattedMessage,{...u})}),(0,X.bq)()&&(0,he.jsx)("div",{style:{marginLeft:2},children:(0,d.b)({width:14,height:14,fill:s.mediumIconColor})})]}),...e}),action:()=>{a({type:"space-private-pages"})}}}function yt(e,t,s,o,i){if(e&&!i.state)return[];const a=ht(o),n=vt(o);if(!a||!n)return[];let r=n.getTeamsStores();return e&&(r=(0,l.ZP)(e,r,(e=>e.getName()||""))),r.map((e=>Be({spaceStore:a,value:{type:"team",id:e.id,spaceId:a.id},showPath:!1,isCreateIn:t,onAccept:s}))).filter(v.$K)}},30765:(e,t,s)=>{s.d(t,{s:()=>c});var o=s(67294),i=s(480),a=s(24405),n=s(82990),r=s(26388);var l=s(85893);function c(e){let{children:t,style:s}=e;window.__c={n:"TextOverflowWithTooltip"};const{isSafari:c}=(0,i.Fy)(),d=(0,o.useRef)(null),p=function(e){const[t,s]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{const{current:t}=e;if(!t)return void s(!1);const o="ResizeObserver"in window?new ResizeObserver((e=>{let[t]=e;s(t.target.scrollWidth>t.target.clientWidth)})):void 0;return null==o||o.observe(t),()=>null==o?void 0:o.unobserve(t)}),[]),t}(d),u=(0,a.yK)((()=>({overflowText:{...n.Z.textOverflowStyle,...s}})),[s]);return(0,l.jsx)(r.ZP,{delayThreshold:500,placement:r.ug.Bottom,forceVisibleState:!(c||!p)&&void 0,renderTooltip:()=>p?t:void 0,render:e=>(0,l.jsx)("div",{ref:d,style:u.overflowText,...e,children:t})})}}}]);