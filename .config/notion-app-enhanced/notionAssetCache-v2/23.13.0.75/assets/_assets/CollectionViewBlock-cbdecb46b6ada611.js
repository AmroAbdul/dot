"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3190,5061],{79698:(e,t,o)=>{o.d(t,{j:()=>u});var i=o(9291),r=o(14542),n=o(96809),s=o(47307),l=o(96802),a=o(27153),c=o(82530),d=o(53471);const p=(0,i.defineMessages)({pageCover:{defaultMessage:"Page cover",id:"pageCover.title"},fileTypeCaption:{defaultMessage:"Images wider than {idealImageWidth} pixels work best.",id:"pageCover.fileType.caption"},uploadFailed:{defaultMessage:"Upload failed",id:"pageCover.errorDialogMessage.uploadFailed"},embedTitle:{defaultMessage:"Link",id:"pageCover.embedType.title"},embedPlaceholder:{defaultMessage:"Paste an image link…",id:"pageCover.embedType.placeholder"},embedCaption:{defaultMessage:"Works with any image from the web.",id:"pageCover.embedType.caption"},embedSubmit:{defaultMessage:"Submit",id:"pageCover.embedType.buttonText"}});function u(e){let{environment:t,intl:o,store:i,rect:r}=e;a.$(t,{originGap:3,originRect:r,isSmallWidth:!1,popupWidth:540,maxHeight:485,title:o.formatMessage(p.pageCover),onDelete:()=>{!function(e){let{environment:t,store:o}=e;a.Z(),c.createAndCommit({userAction:"PageCover.handleDelete",environment:t,perform:e=>{l.MF({store:o,transaction:e})}})}({environment:t,store:i})},currentTab:"gallery",tabs:[{type:"gallery",onChange:e=>{let{url:o,position:r}=e;m({environment:t,store:i,url:o,position:r})}},{type:"file",fileUpload:!1,imageUpload:!0,videoUpload:!1,caption:o.formatMessage(p.fileTypeCaption,{idealImageWidth:1500}),onUpload:e=>{a.Z(),d.cT({environment:t,file:e,bucket:"secure",record:i.pointer,onStart:g,onProgress:S,onComplete:e=>{var o;o={environment:t,store:i,url:e},h({...o,position:.5})},onError:()=>{s.showErrorMessage(o.formatMessage(p.uploadFailed))}})}},{type:"embed",title:o.formatMessage(p.embedTitle),inputPlaceholder:o.formatMessage(p.embedPlaceholder),caption:o.formatMessage(p.embedCaption),buttonText:o.formatMessage(p.embedSubmit),onChange:e=>{var o;o={environment:t,store:i,url:e},h({...o,position:.5}),a.Z()}},{type:"unsplash",onChange:e=>{let{url:o,position:r}=e;m({environment:t,store:i,url:o,position:r})}}]})}async function h(e){const{environment:t,store:o,url:i,position:s}=e,{serverCommitResult:a}=c.createAndCommit({userAction:"PageCover.updatePageCover",environment:t,perform:e=>{l.fs({store:o,url:i,position:s||.5,transaction:e})}});await a,n.Z.state.loadingMode===r.NS&&n.Z.setState({loadingMode:r.EP,dataURL:n.Z.state.dataURL,uploadProgress:100})}function m(e){h(e),e.environment.device.isMobile&&a.Z()}function g(e){const{file:t,name:o,size:i}=e;if(a.Z(),n.Z.setState({loadingMode:r.SS,file:t,name:o,size:i}),t.type.indexOf("image")>=0){const e=new FileReader;e.onload=e=>{n.Z.state.loadingMode===r.SS&&n.Z.setState({...n.Z.state,uploadProgress:0,loadingMode:r.NS,dataURL:e.target.result})},e.readAsDataURL(t)}}function S(e){const{progressPercent:t}=e;n.Z.state.loadingMode===r.NS&&n.Z.setState({...n.Z.state,uploadProgress:t})}},59827:(e,t,o)=>{o.d(t,{Q:()=>a});o(67294);var i=o(82990),r=o(52821),n=o(85893);const s={...i.Z.textOverflowStyle,position:"absolute",left:0,right:0,top:0,bottom:0},l={marginLeft:4,fontWeight:i.Z.fontWeight.semibold};function a(e){const{prefix:t,viewName:o,viewType:i}=e;return(0,n.jsxs)("div",{style:{position:"relative",width:"100%"},children:[" ",(0,n.jsxs)("div",{style:s,children:[t,i&&r.aW[i]({marginLeft:8,marginRight:2,width:"1em",display:"inline",verticalAlign:"bottom"}),(0,n.jsx)("span",{style:l,children:o})]})]})}},10912:(e,t,o)=>{o.d(t,{Z:()=>P});o(57658),o(67294);var i=o(83355),r=o(27531),n=o(86628),s=o(24405),l=o(41432),a=o(80951),c=o(95538),d=o(21202),p=o(97880),u=o(10906),h=o(12457),m=o(17311),g=o(35328),S=o(68373),f=o(40971),y=o(12981),v=o(43568),C=o(81865),x=o(35541),b=o(85893);function w(e){return"number"==typeof e}class k extends i.Z{constructor(){super(...arguments),this.renderContentBlock=e=>{const{store:t,renderAdditionalBlocks:o,rendererBlockStyle:i}=this.props,n=S.G.createChildStore(t,{table:d.iU,id:e}),s=n.getType(),l=o&&void 0!==s?(0,x.u)(n):(0,f.h)(n);if(l)return(0,b.jsx)(r.D,{value:this.restrictedContentStore,children:(0,b.jsx)(l,{store:n,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,hideContent:(0,g.BX)(n),style:{fontSize:12,opacity:.8,pointerEvents:"none",...i},isQuickFind:!0,numberedListCounterStore:this.createComputedStore((()=>({depth:0,numberedListBlockIdsWithFormat:this.createNumberedListCounterStore(e)})))})},e)},this.coverStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,{ThemeStore:o}=this.environment,i=(0,u.NU)({rootStore:e,renderAdditionalBlocks:t,theme:o.state.mode});return i.image?i.image:!(this.props.showLoadingShimmer&&0===i.blockIds.length&&!i.isDefined)&&i.blockIds})),this.restrictedContentStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,o=(0,u.wK)(e,t);return o.image?void 0:o.blockIds})),this.numberedLists=this.createComputedStore((()=>{const{store:e}=this.props,t=this.coverStore.state,o=[];if(Array.isArray(t)){let i=0;for(;i<t.length;){let r=t[i],n=S.G.createChildStore(e,{table:d.iU,id:r});if(n.getType()===l.Ti.numberedList){const s=[{blockId:r,idx:1}],a=[{id:r,format:void 0,depth:s.length-1,index:s[0].idx}];for(i+=1;i<t.length&&(r=t[i],n=S.G.createChildStore(e,{table:d.iU,id:r}),n.getType()===l.Ti.numberedList);){{const e=n.getParentId();if(n.getParentId()===s[s.length-1].blockId)s.push({blockId:r,idx:1});else{let t=s[s.length-1].idx;for(;s.length>0&&s[s.length-1].blockId!==e;)t=s[s.length-1].idx,s.pop();s.push({blockId:r,idx:t+1})}a.push({id:r,format:void 0,depth:s.length-1,index:s[s.length-1].idx})}i+=1}o.push(a)}else i+=1}}return o}))}didUpdate(e){this.props.coverFormat.type!==e.coverFormat.type&&this.props.onLoadProxiedImage()}renderComponent(){const{coverFormat:e}=this.props;return"page_cover"===e.type?(0,b.jsx)(O,{store:this.props.store,coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,imageCoverWrapStyle:this.props.imageCoverWrapStyle,coverWidth:this.props.coverWidth,onLoadProxiedImage:this.props.onLoadProxiedImage,style:this.props.style,variant:this.props.variant,coverAspectFormat:this.props.coverAspectFormat,coverPosition:this.props.coverPosition,showEmptyGalleryCover:this.props.showEmptyGalleryCover,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle}):"page_content"===e.type?this.renderPageContent():"property"===e.type?(0,b.jsx)(G,{store:this.props.store,coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,imageCoverWrapStyle:this.props.imageCoverWrapStyle,onLoadProxiedImage:this.props.onLoadProxiedImage,coverWidth:this.props.coverWidth,style:this.props.style,variant:this.props.variant,coverAspectFormat:this.props.coverAspectFormat,coverPosition:this.props.coverPosition,showEmptyGalleryCover:this.props.showEmptyGalleryCover,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle,property:e.property}):void 0}renderPageContent(){const e=this.coverStore.state,t=this.restrictedContentStore.state,o=this.props.renderAdditionalBlocks&&this.props.store.isCollectionView();if(!1===e)return(0,b.jsx)(I,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,loadingShimmerStyle:this.props.loadingShimmerStyle});if(e){if(!Array.isArray(e))return o?(0,b.jsxs)("div",{style:Z(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle),children:[(0,b.jsx)(C.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:M(),render:(e,t)=>{if(t)return(0,b.jsx)(y.Z,{style:{...V(),...N({renderCollectionImage:!0},this.props.variant,this.theme,this.props.coverHeight,this.props.coverSizeFormat),...j(),objectPosition:`center ${100*(1-T(this.props.store,this.props.coverPosition))}%`},placeholderLoadedStyle:{display:"flex",justifyContent:"center",alignItems:"end"},src:t})}}),(0,b.jsx)(L,{variant:this.props.variant}),(0,b.jsx)("div",{style:D(this.theme,this.props.coverContentFadedOverlayStyle)})]}):(0,b.jsxs)("div",{style:F(this.props.coverHeight,this.props.coverSizeFormat,this.props.imageCoverWrapStyle),children:[(0,b.jsx)(C.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:M(this.props.coverWidth,this.props.coverSizeFormat),render:(e,t)=>{if(t)return(0,b.jsx)(y.Z,{style:{...V(this.props.style),...N({renderCollectionImage:!1},this.props.variant,this.theme,this.props.coverHeight,this.props.coverSizeFormat),...j(this.props.coverAspectFormat),objectPosition:`center ${100*(1-T(this.props.store,this.props.coverPosition))}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(L,{variant:this.props.variant})]});if(e.length>0)return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{style:Z(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle),children:[t?e.filter((e=>t.indexOf(e)>=0)).map(this.renderContentBlock):e.map(this.renderContentBlock),this.props.coverContentFadedOverlay&&(0,b.jsx)("div",{style:D(this.theme,this.props.coverContentFadedOverlayStyle)})]})});if(this.props.showEmptyGalleryCover)return(0,b.jsx)(_,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}else if(this.props.showEmptyGalleryCover)return(0,b.jsx)(_,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}createNumberedListCounterStore(e){const t=this.numberedLists.state;for(const o of t)if(o.find((t=>t.id===e)))return o;return[]}}k.displayName="CollectionItemCover";const P=k;function T(e,t){if(w(t))return t;if(e.getFormatStore().isDefined()){const{page_cover_position:t,card_cover_position:o}=e.getFormat();if(w(o))return o;if(w(t))return t}return.5}function V(e){return e||{}}function R(e,t){if(e)return e;switch(t){case"large":return m.Z.card.desktop.large.height;case"small":return m.Z.card.desktop.small.height;case"medium":default:return m.Z.card.desktop.medium.height}}function M(e,t){return e||(0,u.rD)(t)}function j(e){return{objectFit:void 0===e?"cover":e}}function F(e,t,o){return{height:R(e,t),position:"relative",pointerEvents:"none",overflow:"hidden",...o}}function _(e){let{coverHeight:t,coverSizeFormat:o,emptyGalleryCoverStyle:i}=e;return(0,b.jsx)("div",{style:{height:R(t,o),...i}})}function I(e){let{coverHeight:t,coverSizeFormat:o,loadingShimmerStyle:i}=e;return(0,b.jsx)("div",{style:{height:R(t,o),...i},children:(0,b.jsx)(h.Z,{show:!0,showDelay:100,showHold:0,render:e=>e?(0,b.jsx)(v.Z,{paragraphs:[{lineHeight:12,lineMargin:6,sectionWidths:[100,100,50],repeat:1,sectionMargin:0}]}):void 0})})}function B(e,t,o,i){const{ThemeStore:r}=t,n="dark"===r.state.mode;switch(e){case"default":return{};case"gallery":return{background:o.collectionGalleryPreviewCardCover,padding:"8px 8px 0",boxShadow:n?"transparent":`inset 0 -1px 0 0 ${o.regularDividerColor}`,...i};default:(0,p.t1)(e)}}function D(e,t){return{width:"100%",height:40,position:"absolute",bottom:0,left:0,background:`linear-gradient(to bottom, transparent, ${e.accentColors.gray[30]} 100%)`,...t}}function A(e,t){switch(e){case"default":return{border:`1px solid ${t.stroke.regular}`,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomRightRadius:4,borderBottomLeftRadius:4};case"gallery":return{borderRadius:0,borderTopLeftRadius:1,borderTopRightRadius:1};default:(0,p.t1)(e)}}function L(e){let{variant:t}=e;window.__c={n:"ImageBorderComponent"};const o=(0,s.Fg)();switch(t){case"default":return null;case"gallery":return(0,b.jsx)("div",{style:{position:"absolute",left:0,right:0,bottom:0,borderBottom:`1px solid ${o.regularDividerColor}`}});default:(0,p.t1)(t)}return null}function Z(e,t,o,i,r,n,s){return{height:R(i,r),pointerEvents:"none",overflow:"hidden",position:n?"relative":"static",...B(e,t,o,s),...s}}function E(e,t,o,i){return{width:"100%",height:R(o,i),...A(e,t),objectPosition:"center"}}function O(e){let{store:t,coverHeight:o,coverSizeFormat:i,imageCoverWrapStyle:r,coverWidth:l,onLoadProxiedImage:a,style:c,variant:d,coverAspectFormat:p,coverPosition:u,showEmptyGalleryCover:h,emptyGalleryCoverStyle:m}=e;window.__c={n:"PageCoverComponent"};const g=(0,s.Fg)(),S=(0,n.VK)((()=>{var e;return null===(e=t.getCover())||void 0===e?void 0:e.cover}),[t]),f=(0,n.VK)((()=>t.pointer),[t]),v=(0,n.VK)((()=>T(t,u)),[u,t]);return S?(0,b.jsxs)("div",{style:F(o,i,r),children:[(0,b.jsx)(C.Z,{url:S,isAuthenticated:!0,permissionRecord:f,width:M(l,i),onFinishedLoadingProxyUrl:e=>a(e),render:(e,t)=>{if(t)return(0,b.jsx)(y.Z,{style:{...V(c),...E(d,g,o,i),...j(p),objectPosition:`center ${100*(1-v)}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(L,{variant:d})]}):h?(0,b.jsx)(_,{coverHeight:o,coverSizeFormat:i,emptyGalleryCoverStyle:m}):null}function G(e){let{property:t,store:o,coverHeight:i,coverSizeFormat:r,imageCoverWrapStyle:l,onLoadProxiedImage:d,coverWidth:p,style:u,variant:h,coverAspectFormat:m,coverPosition:g,showEmptyGalleryCover:S,emptyGalleryCoverStyle:f}=e;window.__c={n:"PropertyComponent"};const v=(0,s.Fg)(),x=(0,n.VK)((()=>(0,a.g)(o.getPropertyValue(t)).find((e=>(0,c.SR)({url:e.url})))),[t,o]),w=(0,n.VK)((()=>o.pointer),[o]),k=(0,n.VK)((()=>T(o,g)),[g,o]);return x?(0,b.jsxs)("div",{style:F(i,r,l),children:[(0,b.jsx)(C.Z,{onFinishedLoadingProxyUrl:e=>d(e),url:x.url,isAuthenticated:!0,permissionRecord:w,width:M(p,r),render:(e,t)=>{if(t)return(0,b.jsx)(y.Z,{style:{...V(u),...E(h,v,i,r),...j(m),objectPosition:`center ${100*(1-k)}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(L,{variant:h})]}):S?(0,b.jsx)(_,{coverHeight:i,coverSizeFormat:r,emptyGalleryCoverStyle:f}):null}function N(e,t,o,i,r){const{renderCollectionImage:n}=e;return{...E(t,o,i,r),objectPosition:"center center",...n&&{height:void 0,border:`1px solid ${o.lightDividerColor}`,borderBottom:"none",borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},81870:(e,t,o)=>{o.d(t,{Z:()=>d});o(67294);var i=o(480),r=o(24405),n=o(84169),s=o(25888),l=o(73063),a=o(16354),c=o(85893);const d=function(e){window.__c={n:"CollectionMenuHelpButton"};const t=(0,i.O7)(),o=(0,r.Fg)();return(0,c.jsx)(a.Z,{href:e.href,external:!0,onClick:()=>s.Fs(t,{from:e.helpButtonContext}),children:(0,c.jsx)(l.Z,{icon:n.m,style:{height:24,width:24,marginRight:-6,fill:o.mediumIconColor}})})}},91496:(e,t,o)=>{o.d(t,{Z:()=>U});var i=o(67294),r=o(83355),n=o(480),s=o(86628),l=o(24405),a=o(15145),c=o(58573),d=o(47453),p=o(35840),u=o(72126),h=o(9291),m=o(81193),g=o(98834),S=o(8055),f=o(82530),y=o(59827),v=o(66890),C=o(66213),x=o(65273),b=o(92658),w=o(14976),k=o(75079),P=o(84210),T=o(33929),V=o(87279),R=o(18514),M=o(80444),j=o(29798),F=o(68373),_=o(34583),I=o(13401),B=o(81870),D=o(40071),A=o(79131),L=o(68894),Z=o(78140),E=o(28992),O=o(32163),G=o(40721),N=o(72495),z=o(34574),H=o(85893);const K=(0,h.defineMessages)({filterPlaceholder:{id:"collectionPicker.searchBarFilter.text",defaultMessage:"Filter…"}});class W extends r.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:j.Z,templateInputStore:b.Z},this.handleTemplateFilterChange=e=>{const{templateInputStore:t}=this.stores;t.setState({...t.state,inputValue:e.currentTarget.value})},this.renderMenuList=(e,t,o)=>{var r;const{device:n}=this.environment,{canConfigureCollection:s,isOverlay:l}=this.props,{templateInputStore:a}=this.stores,c={key:"create-template",render:(e,t)=>(0,H.jsx)(q,{isOverlay:this.props.isOverlay,locked:this.props.locked,props:e}),action:this.handleNewCollectionTemplateClick},d=null===(r=this.context.collectionContextStore)||void 0===r?void 0:r.defaultPageTemplateStore.state,p={key:"empty",render:(t,o)=>{if(0!==e.length&&""===a.state.inputValue)return(0,H.jsx)(D.Z,{...this.props,templateStore:void 0,isMobile:this.environment.device.isMobile,locked:this.props.locked||!s,draggable:!0,isDefault:void 0===(null==d?void 0:d.id),onCancelClick:this.props.onCancelClick,...t})},action:this.handleEmptyPageContinueClick};return(0,H.jsx)(O.Z,{type:O.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:this.handleEmptyEnter,sections:u.oA([0!==e.length&&{key:"templates",render:t=>{const r=t.children.slice(0,t.children.length-1),s=t.children[t.children.length-1];return(0,H.jsx)(N.Z,{...t,disableDesktopPadding:!this.props.isOverlay,disableMobileBorders:!0,children:(0,H.jsxs)(i.Fragment,{children:[n.isMobile||this.props.locked||!this.props.canConfigureCollection?r.map(((e,t)=>r[t])):(0,H.jsx)(A.ZP,{direction:"vertical",keys:e,disabled:!o,renderKey:(t,o)=>r[e.indexOf(t)],onDrop:this.handleCollectionTemplatesReorder}),s]})})},items:[...t.map((e=>this.renderCollectionTemplatePageMenuItem(e,o))),p]},s?{key:"create-template",render:e=>(0,H.jsx)(N.Z,{topBorder:l,disableDesktopPadding:!l,disableMobileBorders:!0,...e}),items:[c]}:void 0])})},this.renderCollectionTemplatePageMenuItem=(e,t)=>{var o;const{device:r}=this.environment,{collectionStore:n,canConfigureCollection:s,locked:l}=this.props,a=null===(o=this.context.collectionContextStore)||void 0===o?void 0:o.defaultPageTemplateStore.state,c=F.Mz.fromBlockStore(e),d=null!=c&&c.isActive()?c.getRecurrence():void 0;return{key:e.id,render:o=>(0,i.createElement)(D.Z,{...o,key:e.id,isOverlay:this.props.isOverlay,collectionStore:n,canConfigureCollection:s,templateStore:e,isMobile:r.isMobile,locked:l,onCancelClick:this.props.onCancelClick,draggable:t,isDefault:(null==a?void 0:a.id)===e.id,recurrence:d}),action:t=>{_.M_(this.environment)&&this.props.onTemplateClick({templateStore:e,isKeyboard:"keydown"===t.event.type,useCrdt:(0,x.SL)(t.event,"collection_instantiate_template")})}}},this.handleEmptyPageContinueClick=e=>{const{collectionContextStore:t}=this.context;_.M_(this.environment)&&(this.props.onEmptyPageClick(),m.rN(this.environment,{template_name:"empty",is_keyboard:"keydown"===e.event.type,...t&&(0,k.Pn)(t)}))},this.handleEmptyEnter=()=>{const{collectionStore:e}=this.props;var t;_.M_(this.environment)&&(this.props.onEmptyEnter(),m.rN(this.environment,{template_name:"empty",is_keyboard:!0,collection_id:e.id,collection_view_id:null===(t=this.context.collectionContextStore)||void 0===t||null===(t=t.collectionViewStore())||void 0===t?void 0:t.id}))},this.handleNewCollectionTemplateClick=()=>{var e,t;const{collectionStore:o}=this.props,{templateInputStore:i}=this.stores;if(_.M_(this.environment)){var r;const{performResult:e}=f.createAndCommit({userAction:"CollectionTemplatePicker.newPage",environment:this.environment,perform:e=>g.nx({environment:this.environment,collectionStore:o,transaction:e,title:i?i.state.inputValue:void 0})});e&&this.navigateToBlock(e),m.dZ(this.environment,{collection_id:o.id,collection_view_id:null===(r=this.context.collectionContextStore)||void 0===r||null===(r=r.collectionViewStore())||void 0===r?void 0:r.id})}null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t)},this.handleCollectionTemplatesReorder=e=>{const{collectionStore:t}=this.props,{menuListStore:o}=this.stores;o.unsetFocus(),f.createAndCommit({userAction:"CollectionTemplatePicker.handleCollectionTemplatesReorder",environment:this.environment,perform:o=>g.$p({collectionStore:t,newTemplateIds:e,transaction:o})})}}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):S.c4({environment:this.environment,url:e})}renderComponent(){const{device:e}=this.environment,{collectionStore:t,isOverlay:o}=this.props;let i=t.getTemplatePageStores();const{templateInputStore:r}=this.stores;if(!i.every((e=>e.isReady())))return;i=i.filter((e=>e.getAlive()));const n=i.map((e=>e.id));let s=this.renderMenuList(n,i,!0);const l=this.renderInputHeader();if(o){let t;t=e.isMobile?{menuType:V.og.Modal,title:(0,H.jsx)(h.FormattedMessage,{defaultMessage:"Database templates",id:"database.mobileTemplatesMenu.title"}),left:(0,H.jsx)(G.CancelMenuText,{}),onClickLeft:this.props.onCancelClick}:{menuType:V.og.Popup,width:360};let o=i,a=n;return n.length>6&&r.state.inputValue&&(o=(0,c.ZP)(r.state.inputValue,i,(e=>String(e.getProperties().title)??"")),a=o.map((e=>e.id)),s=this.renderMenuList(a,o,!1)),(0,H.jsxs)(Z.Z,{...t,header:(0,H.jsx)($,{collectionStore:this.props.collectionStore}),children:[0===n.length&&(0,H.jsx)(N.Z,{children:(0,H.jsx)("div",{style:{fontSize:14,padding:e.isMobile?"12px 16px":"0 14px 3px 14px",color:this.theme.lightTextColor,wordBreak:"keep-all",...e.isMobile&&{background:this.theme.contentBackground,boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,marginBottom:1}},children:(0,H.jsx)(h.FormattedMessage,{defaultMessage:"Replicate page formats inside this database with templates.",id:"database.emptyTemplatesList.info"})})}),n.length>6?l:void 0,s]})}return s}renderInputHeader(){const{device:e}=this.environment,t=!e.isMobile||void 0;return(0,H.jsx)("div",{style:{margin:e.isMobile?0:"10px 0"},children:(0,H.jsx)(L.ZP,{value:this.stores.templateInputStore.state.inputValue,focusInitial:t,placeholder:T.default.formatMessage(K.filterPlaceholder),showClearButton:!0,inputLeft:(0,H.jsx)(L.f_,{icon:p.R}),onChange:this.handleTemplateFilterChange,style:{...e.isAndroid&&{borderBottom:"none"}}})})}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=M.default.state,o=t?(0,P.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:a.tY.Create}):(0,P.ZP)({store:e,fullyQualified:!1,pageVisitSource:a.tY.Create});this.navigate(o)}}W.displayName="CollectionTemplatePicker",W.contextTypes={...C.wK,...r.w,...v.xm};const U=W;function $(e){let{collectionStore:t}=e;window.__c={n:"Title"};const o=(0,n.O7)(),i=(0,s.VK)((()=>t.getNameStore().getValue()),[t]);if(o.device.isMobile)return null;const r=i?(0,H.jsx)(H.Fragment,{children:(0,w.Xh)(i,t)}):(0,H.jsx)(h.FormattedMessage,{defaultMessage:"Untitled",id:"database.templateList.UntitledDatabaseTitle"});return(0,H.jsx)(E.Z,{style:{marginTop:6},title:(0,H.jsx)(y.Q,{prefix:(0,H.jsx)(h.FormattedMessage,{id:"database.templatesList.templatesFor",defaultMessage:"Templates for"}),viewName:r}),right:(0,H.jsx)(B.Z,{helpButtonContext:"collection_templates_menu",href:(0,R.UY)("guides.databaseTemplates")})})}function q(e){let{props:t,isOverlay:o,locked:i}=e;window.__c={n:"NewButtonMenuItemComponent"};const r=(0,l.Fg)(),s=(0,n.O7)(),a=(0,H.jsx)(h.FormattedMessage,{defaultMessage:"New template",id:"database.templateView.newTemplateButton"});return o?(0,H.jsx)(I.Z,{isBlue:s.device.isDesktop,title:a,...t}):(0,H.jsx)(z.Z,{title:a,icon:(0,d.R)({width:18,fill:r.lightIconColor,marginLeft:1,marginRight:11}),type:"new_template",format:o?"collection-overlay":"page-menu-item",locked:i,...t})}},69201:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>Ig,FULL_SCREEN_PADDING_BOTTOM:()=>Mg,default:()=>Bg});o(21703);var i=o(30120),r=o(67294),n=o(73935),s=o(83355),l=o(1302),a=o(6740),c=o(86628),d=o(49085),p=o(15145),u=o(92996),h=o(3865),m=o(42509),g=o(65422),S=o(49019),f=o(21197),y=o(45363),v=o(58810),C=o(75071),x=o(94110),b=o(15157),w=o(72126),k=o(44615),P=o(21202),T=o(13493),V=o(12139),R=o(82990),M=o(51454),j=o(9291),F=o(50906),_=o(8406),I=o(32441),B=o(54642),D=o(26797),A=o(49865),L=o(5149),Z=o(98834),E=o(32603),O=o(99553),G=o(52989),N=o(8055),z=o(61045),H=o(87531),K=o(24677),W=o(36821),U=o(98104),$=o(82530),q=o(91851),Q=o(40663),Y=o(7801),X=o(34464),J=o(97372),ee=o(24405),te=o(14714),oe=o(75754),ie=o(26999),re=o(10906),ne=o(480),se=o(37989),le=o(56666),ae=o(47453),ce=o(952),de=o(75330),pe=o(75079),ue=o(12534),he=o(77546),me=o(68373),ge=o(34583),Se=(o(57658),o(99036)),fe=o(8848),ye=o(45453),ve=o(9056),Ce=o(37612),xe=o(47307),be=o(92918),we=o(87279),ke=o(93405),Pe=o(78140),Te=o(32163),Ve=o(40721),Re=o(72495),Me=o(9050),je=o(85893);const Fe="color";const _e=function(e){let{parent:t,groupFormat:o,collectionContextStore:i,groupsFormatKey:n,currentGroups:s,groupsLimitStore:l,schema:a}=e;window.__c={n:"CollectionGroupActionMenu"};const d=(0,ne.O7)(),p=(0,j.useIntl)(),{device:u}=d,h=(0,c.VK)((()=>w.oA([Ae(d,o,i,n,s,l,p),Be(d,a,o,i)])),[d,o,i,n,s,l,p,a]),m=(0,r.useCallback)((e=>{"string"==typeof e.key&&e.key.includes(Fe)||t.close()}),[t]);let g;return g=u.isMobile?{menuType:we.og.Modal,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,je.jsx)(Ve.DoneMenuText,{}),onClickRight:t.close}:{menuType:we.og.Popup},(0,je.jsx)(Pe.Z,{...g,children:(0,je.jsx)(Te.Z,{type:Te.i.Vertical,initialFocus:0,sections:h,onAccept:m})})};function Ie(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function Be(e,t,o,i){const r=o.value;if(void 0===r.value)return;const n=t[o.property];if(!n)return;if("select"!==n.type&&"multi_select"!==n.type)return;if(r.type!==n.type)return;const s=(n.options||[]).find((e=>e.value===r.value));if(!s)return;return{key:"collection color section",render:e=>(0,je.jsx)(Re.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:fe.AP.map((r=>({key:`color_${r}`,render:e=>(0,je.jsx)(Me.Z,{...e,color:r,checkState:s.color===r}),action:()=>{!function(e,t,o,i,r){const n=i[o.property];if(!n)return;if(!Se.cu(n))return;const s=r.collectionStore();if(!s)return;const l=o.value;if(l.type!==n.type)return;const a=(n.options||[]).map((t=>t.value===l.value?{...t,color:e}:t)),c={...n,options:a},d={...i,[o.property]:c};$.createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,perform:e=>{de.Rm({environment:t,collectionStore:s,update:{schema:d},transaction:e})}}),F.wd(t,{view_type:Ie(r),action:"group_change_color"})}(r,e,o,t,i)}})))}}function De(e,t,o,i,r,n){xe.showDialog({message:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>async function(e,t,o,i,r,n){const s=t.collectionStore();if(!s)return;const l=i.value;if("relation"===l.type&&(0,te.RA)(l.value)){const e=me.G.createChildStore(s,{id:l.value.id,table:P.iU});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}$.createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,perform:l=>{A.iE({environment:e,collectionStore:s,property:i.property,groupFormat:i,currentGroups:o,groupsFormatKey:r,collectionContextStore:t,transaction:l,intl:n})}}),F.wd(e,{view_type:Ie(t),action:"delete_group"})}(e,t,o,i,r,n)}]})}function Ae(e,t,o,i,r,n,s){const l=[],a=t.value,c=o.permissionScopes.state;(0,te.eF)(t)?l.push({key:"show",render:e=>(0,je.jsx)(ke.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Show",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:ve.g}),action:()=>function(e,t,o,i,r,n){const s={...t,hidden:!1},l=(0,be.nr)(r,s,n.state);$.createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,perform:e=>{A.A6({collectionContextStore:o,newGroups:l,groupsFormatKey:i,transaction:e})}}),F.wd(e,{view_type:Ie(o),action:"show_group"})}(e,t,o,i,r,n)}):l.push({key:"hide",render:e=>(0,je.jsx)(ke.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Hide",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:ye.p}),action:()=>function(e,t,o,i,r){const n={...t,hidden:!0},s=(0,be.ar)(r,n);$.createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,perform:e=>{A.A6({collectionContextStore:o,newGroups:s,groupsFormatKey:i,transaction:e})}}),F.wd(e,{view_type:Ie(o),action:"hide_group"})}(e,t,o,i,r)}),void 0!==a.value&&c.canEditContent&&!c.isSyncedCollection&&"collectionTypedView"!==o.contextType&&l.push({key:"delete",render:e=>(0,je.jsx)(ke.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:Ce.y}),action:()=>De(e,o,r,t,i,s)});return{key:"collection group",render:e=>(0,je.jsx)(Re.Z,{...e}),items:l}}var Le=o(2032),Ze=o(14248),Ee=o(42875),Oe=o(47853),Ge=o(16187),Ne=o(33929),ze=o(98742),He=o(71638),Ke=o(68785);function We(e,t){const{calculating:o,aggregation:i}=e.asyncAggregationStatus.state;return i?o&&(0,w.Xy)(t,i):o}function Ue(e){let{collectionContextStore:t,aggregation:o,children:i}=e;window.__c={n:"AggregationCalculatingIndicator"};const{isCalculating:n,changingType:s}=(0,c.VK)((()=>({isCalculating:We(t,o),changingType:t.asyncAggregationStatus.state.changingType})),[t,o]),l=function(e,t){const o=(0,r.useRef)(e);return(0,r.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(i,n);return n?s?(0,je.jsx)(Ke.Z,{}):(0,je.jsx)("span",{style:{opacity:.5},children:l??i}):(0,je.jsx)(je.Fragment,{children:i})}const $e=(0,j.defineMessages)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating…)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating…)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating…"}});var qe=o(52275),Qe=o(31945),Ye=o(89728),Xe=o(53437),Je=o(26388),et=o(42782);class tt extends s.Z{constructor(){super(...arguments),this.aggregationStore=this.createComputedStore((()=>{const{format:e,groupAggregationKey:t}=this.props;return e[t]||{aggregator:"count"}}),!0),this.reducerStore=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.aggregationStore.state;return{type:"aggregation",filter:(0,Ze.zk)({schema:e,group:t,propertyMapping:void 0,timeZone:(0,Ee.r)()}),aggregation:o}}))}renderComponent(){const{device:e}=this.environment;return(0,je.jsx)(Je.ZP,{renderTooltip:()=>this.renderTooltipText(),render:t=>(0,je.jsx)(Qe.ZP,{popupType:e.isMobile?Qe.Z4.SlideUp:Qe.Z4.Popup,renderOrigin:e=>(0,je.jsx)(Ye.Z,{disabled:this.props.disabled,style:{fontWeight:R.Z.fontWeight.medium,color:this.theme.lightTextColor,height:24},...(0,ze.Z)((0,ze.Z)(t,e),{onClick:ue.Wi}),children:this.renderValue()}),disabled:this.props.disabled,render:e=>(0,je.jsx)(at,{parent:e,collectionContextStore:this.props.collectionContextStore,format:this.props.format,groupAggregationKey:this.props.groupAggregationKey,schema:this.props.schema})})})}renderValue(){const{schema:e,collectionContextStore:t,groupFormat:o}=this.props,i=this.aggregationStore.state,r=this.reducerStore.state;if(r)return(0,je.jsx)(He.Z,{id:`group_aggregation:${(0,te.mD)(o)}`,collectionContextStore:t,reducer:r,groupsPointer:[o],render:o=>{const r=o.state;let n;if((0,Le.pK)(i)){const t=e[i.property];!t||"formula"!==t.type&&"number"!==t.type||(n=t.number_format)}return(0,je.jsx)(Ue,{aggregation:i,collectionContextStore:t,children:r?(0,Ge.Ol)({numberFormat:n,dateFormat:void 0,aggregationType:i.aggregator,userTimeZone:(0,Ee.r)(),value:r.aggregationResult,roundDecimal:5}):"-"})}})}renderTooltipText(){const{schema:e,collectionContextStore:t}=this.props,o=this.aggregationStore.state,i=Ge.VN[(0,Le.OV)(o)],r=We(t,o);if((0,Le.pK)(o)){const t=e[o.property];if(t){const e=t.name;return Ne.default.formatMessage($e.propertyAggregation,{aggregationType:i,propertyName:e,calculating:r})}}return Ne.default.formatMessage($e.aggregationType,{aggregationType:i,calculating:r})}}function ot(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function it(e){let{aggregationType:t,label:o,props:i}=e;const r=Ge.Sn[t];return(0,je.jsx)(Je.ZP,{placement:Xe.GI.Placement.Right,delayThreshold:0,render:e=>(0,je.jsx)(qe.Z,{title:o,...(0,ze.Z)(e,i)}),renderTooltip:()=>(0,je.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[r&&(0,je.jsx)("img",{src:(0,Oe.D)(r),style:{borderRadius:4,width:140,marginTop:4}}),Ge.BG[t]]})},i.key)}function rt(e,t,o,i,r){const n=o.collectionViewStore();n&&(o.isLoading.state||o.loadingDetails.setState({type:"load_aggregation"}),o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:e,changingType:!0}),$.createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,perform:t=>{de.iG({collectionViewStore:n,update:{format:{...i,[r]:e}},transaction:t})}})),F.wd(t,{view_type:ot(o),action:"change_aggregation"})}function nt(e,t,o,i,r){const n=Ge.VN[e];return{key:e,render:t=>(0,je.jsx)(it,{aggregationType:e,label:n,props:t}),action:()=>{rt({aggregator:e},t,o,i,r)}}}function st(e,t,o,i,r,n,s){const{device:l}=o,a=Ge.VN[e],c=w.oA(t.map((t=>function(e,t,o,i,r,n,s){const l=i[e];if(!l)return;const a=l.name;return{key:`${e} ${t}`,render:e=>(0,je.jsx)(it,{aggregationType:t,label:a,props:e}),action:()=>{rt({aggregator:t,property:e},o,r,n,s)}}}(t,e,o,i,r,n,s))));return{key:e+a,render:(e,t)=>(0,je.jsx)(et.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,je.jsx)(qe.Z,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let i;return i=l.isMobile?{menuType:we.og.Modal,title:a,right:l.isPhone?(0,je.jsx)(Ve.DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:we.og.Popup,width:200,...e},(0,je.jsx)(Pe.Z,{...i,children:(0,je.jsx)(Te.Z,{type:Te.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,je.jsx)(Re.Z,{...e}),items:c}],onAccept:t.onAccept})})}}),action:()=>null}}function lt(e,t,o,i,r){const n=[];for(const d of Le.o5)n.push(nt(d,e,t,o,i));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(r);if(s.length>0)for(const d of Le.Sy)"show_unique"!==d&&n.push(st(d,s,e,r,t,o,i));const l=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.O4)(o)}))}(r);if(l.length>0)for(const d of Le.k$)n.push(st(d,l,e,r,t,o,i));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.dN)(o)}))}(r);if(a.length>0)for(const d of Le.f8)n.push(st(d,a,e,r,t,o,i));const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.Mv)(o)}))}(r);if(c.length>0)for(const d of Le.gC)n.push(st(d,c,e,r,t,o,i));return n}function at(e){let{parent:t,collectionContextStore:o,format:i,groupAggregationKey:r,schema:n}=e;window.__c={n:"MenuComponent"};const s=(0,ne.O7)(),{device:l}=s;let a;return a=l.isMobile?{menuType:we.og.Modal,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,je.jsx)(Ve.DoneMenuText,{}),onClickRight:t.close}:{menuType:we.og.Popup,width:200},(0,je.jsx)(Pe.Z,{...a,children:(0,je.jsx)(Te.Z,{type:Te.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,je.jsx)(Re.Z,{...e}),items:lt(s,o,i,r,n)}],onAccept:t.close})})}tt.displayName="CollectionGroupAggregation";var ct=o(26055),dt=o(97880),pt=o(61931),ut=function(e){return e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.IGNORE=2]="IGNORE",e}(ut||{});const ht=ut;var mt=o(34859),gt=o(45589),St=o(53336);const ft=function(e){return e?ht.IGNORE:ht.Top};function yt(e){window.__c={n:"CollectionCompactViewScroller"};const{style:t,children:o}=e,i=(0,c.qz)(void 0,gt.Z),r=(0,c.VK)((()=>0===i.state.scrollTop),[i]),n=(0,ee.yK)((()=>({scroller:{height:"100%",...r?{}:{maskImage:pt.Wx,WebkitMaskImage:pt.Wx},...t}})),[r,t]);return(0,je.jsx)(St.Z,{store:i,type:mt.Z.Y,style:n.scroller,children:o})}var vt=o(45697),Ct=o.n(vt),xt=o(55010),bt=o(4926);function wt(e){const{element:t,container:o}=e,i=function(e){for(;;){const t=Vt(e);if(!t)return e;e=t}}(o),{store:r}=i.stores,{containerMap:n}=r.state,s=n.get(o);s?s.add(t):n.set(o,new Set([t])),r.emit()}function kt(e,t,o,i){return e<-i||e>t?0:e>=t-o-1?t-o+i-1:e+i}function Pt(e,t,o,i){return e-i<0||e>t?0:e<o?o-t:e-t}function Tt(e){const t=[];for(;;){const o=Vt(e);if(!o)break;e=o,t.push(e)}return t}function Vt(e){if(e.context.computedStickyContainer&&!e.props.ignoreAncestorContainer)return e.context.computedStickyContainer}function Rt(e,t){for(const o in t)e.style[o]=t[o]||""}o(95477);class Mt extends s.Z{constructor(){super(...arguments),this.element=void 0}didMount(){const{computedStickyContainer:e}=this.context;e&&wt({element:this,container:e});const t=n.findDOMNode(this);if(t){this.element=t;const e=this.props.getComputedStyle?this.props.getComputedStyle(!1):void 0;e&&Rt(t,e)}}willUnmount(){const{computedStickyContainer:e}=this.context;e&&function(e){const{element:t,container:o}=e,{store:i}=o.stores,{containerMap:r}=i.state,n=r.get(o);n&&n.delete(t),i.emit()}({element:this,container:e}),this.element=void 0}renderComponent(){if(this.props.children)return r.Children.only(this.props.children)}}Mt.displayName="ComputedStickyElement",Mt.contextTypes={computedStickyContainer:Ct().any,...s.w};const jt=Mt;var Ft=o(73063),_t=o(79954),It=o(5210);class Bt extends s.Z{constructor(){super(...arguments),this.handleToggleButtonClick=()=>{const{groupFormat:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);if(!o)return;K.ZH(this.environment);const i=!o.toggleStateStore.state;if(A.uo({environment:this.environment,groupFormat:e,toggleStateStore:o.toggleStateStore,newValue:i,collectionContextStore:t}),!i){const e=n.findDOMNode(this),o=null==e?void 0:e.parentElement;o&&l.default.afterNextFlush((()=>{(0,he.Oc)({el:o,windowHeight:this.environment.WindowSizeStore.state.height,minEdgeDist:50}),t.renderEmitter.emit()}))}},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:i,groupFormat:r}=this.props,s=n.findDOMNode(this);s&&s instanceof Element&&$.createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:this.environment,perform:e=>A.BO({environment:this.environment,collectionContextStore:i,groupsPointer:[r],droppedStores:t,duplicate:o,transaction:e})})}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new me.G(this.environment,{table:P.iU,id:t.id}))}didMount(){var e,t;null===(e=(t=this.props).onMount)||void 0===e||e.call(t)}renderComponent(){var e;const{disabled:t,getComputedStickyStyle:o,groupFormat:i,collectionContextStore:r}=this.props,n=r.groupsStore.getGroupState(i);if(!n)return;const s=n.toggleStateStore.state,l=r.permissionScopes.state,a=r.shouldAllowNewItemCreation(),c=r.isCompactView.state,d=c?"transparent":(null===(e=r.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||void 0;return(0,je.jsx)(jt,{position:ft(c),getComputedStyle:o,children:(0,je.jsxs)("div",{style:Gt(this.props.isInPeekRenderer,this.theme,d,this.props.style),children:[(0,je.jsx)("div",{style:Zt(s,this.props.isFullScreen,this.props.isRootChild,this.props.paddingLeft,this.props.paddingTop,this.props.toggleClosedMarginBottom,this.props.height,this.props.stickyLeft),children:(0,je.jsx)("div",{style:{display:"flex",alignItems:"center",position:this.props.stickyLeft?"sticky":void 0,left:this.props.paddingLeft},children:(0,je.jsxs)(_t.Z,{store:this.selectableBlockStore,canDropOnto:!t&&!s,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[i],style:{display:"flex",alignItems:"center",height:"100%"},children:[this.renderToggleButton(n.toggleStateStore),(0,je.jsx)(Nt,{collectionGroupHeaderProps:this.props}),(0,je.jsx)(Et,{disabled:this.props.disabled,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupFormat:this.props.groupFormat,groupAggregationKey:this.props.groupAggregationKey}),!t&&l.canConfigureBlock&&(0,je.jsx)(Ot,{groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupsFormatKey:this.props.groupsFormatKey,isGroupHoveredStore:this.props.isGroupHoveredStore}),a&&(0,je.jsx)(zt,{collectionGroupHeaderProps:this.props,isGroupHoveredStore:this.props.isGroupHoveredStore})]})})}),this.props.children]})})}renderToggleButton(e){const t=e.state;return(0,je.jsx)(It.Z,{isSidebar:!1,open:t,fill:!0,onClick:this.handleToggleButtonClick,onMouseDown:ue.$0,style:{flexShrink:0}})}}Bt.displayName="CollectionGroupHeader";const Dt=Bt;function At(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function Lt(e){return e||33}function Zt(e,t,o,i,r,n,s,l){return{display:"flex",alignItems:"center",height:Lt(s),paddingTop:r,...l&&{position:"sticky",left:t||o?i:0},...!e&&{marginBottom:n}}}function Et(e){let{disabled:t,format:o,schema:i,collectionContextStore:r,groupFormat:n,groupAggregationKey:s}=e;window.__c={n:"Aggregation"};const l=(0,c.VK)((()=>r.permissionScopes.state.canConfigureBlock),[r]);return(0,je.jsx)(tt,{groupFormat:n,disabled:t||!l,groupAggregationKey:s,format:o,schema:i,collectionContextStore:r})}function Ot(e){let{groupFormat:t,currentGroups:o,format:i,schema:r,collectionContextStore:n,groupsFormatKey:s,isGroupHoveredStore:l}=e;window.__c={n:"ActionButtonComponent"};const a=(0,ne.Fy)(),d=(0,c.VK)((()=>n.groupsLimit),[n]),p=(0,c.VK)((()=>l.state),[l]),[u,h]=(0,se.Z)(),m=(0,ee.yK)((()=>({button:{transition:a.isMobile?void 0:"opacity 100ms ease-in-out",opacity:a.isMobile?void 0:p||h?1:0}})),[a.isMobile,h,p]);return(0,je.jsx)(Qe.ZP,{popupType:a.isMobile?Qe.Z4.SlideUp:Qe.Z4.Popup,renderOrigin:e=>(0,je.jsx)(Ft.Z,{ref:u,icon:le.o,style:m.button,...e}),onClick:ue.Wi,render:e=>(0,je.jsx)(_e,{parent:e,groupFormat:t,currentGroups:o,format:i,schema:r,collectionContextStore:n,groupsFormatKey:s,groupsLimitStore:d})})}function Gt(e,t,o,i){const r=e?t.cardContentBackground:t.contentBackground;return{position:"relative",zIndex:M.sL+2,width:"100%",background:void 0===o?r:o,fontSize:14,...i}}function Nt(e){let{collectionGroupHeaderProps:t}=e;window.__c={n:"ValueComponent"};const o=(0,ne.O7)(),{groupFormat:i,schema:r,disabled:n,currentGroups:s,groupBy:l,collectionContextStore:a}=t,d=(0,c.VK)((()=>a.permissionScopes.state),[a]);return(0,je.jsx)(ct.Z,{groupBy:l,groupFormat:i,currentGroups:s,schema:r,disabled:n||!d.canConfigureCollection||d.isSyncedCollection,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:i}=o,r=i.collectionStore();r&&(A.w$({...e,environment:t,collectionStore:r,...o}),F.wd(t,{view_type:At(i),action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:a})}function zt(e){let{collectionGroupHeaderProps:t,isGroupHoveredStore:o}=e;window.__c={n:"AddButtonComponent"};const i=(0,ne.Fy)(),r=(0,ne.O7)(),n=(0,c.VK)((()=>o.state),[o]),[s,l]=(0,se.Z)(),a=(0,ee.yK)((()=>({button:{transition:i.isMobile?void 0:"opacity 100ms ease-in-out",opacity:i.isMobile?void 0:n||l?1:0}})),[i.isMobile,l,n]);return(0,je.jsx)(Je.ZP,{renderTooltip:()=>(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,je.jsx)(Ft.Z,{ref:s,icon:ae.R,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:i,isFullScreen:r,onGroupHeaderAddItem:n}=t;i.groupsStore.getGroupState(o)&&ge.M_(e)&&(i.searchQuery.state&&de.Ug({searchQuery:"",collectionContextStore:i,isFullScreen:r}),$.createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,perform:r=>{const s=A.IW({environment:e,collectionContextStore:i,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:r,from:"group_header"});s&&(n(s.newStore,s.coercionSucceeded,t),ce.W(e,{from:"group_add_item_top",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,pe.Pn)(i)}))}}))}(r,t),style:a.button,...e})})}var Ht=o(80951);function Kt(e){const{collectionContextStore:t,groupsPointer:o,hasPartialResults:i}=e,r=t.shouldShowSpinner.state,n="load_general"===t.loadingDetails.state.type&&!i||"load_more_blocks"===t.loadingDetails.state.type&&w.Xy(t.loadingDetails.state.group,o);return r&&n}function Wt(e){const{collectionContextStore:t,displayState:o}=e;return t.shouldShowSpinner.state&&0===o.visibleGroups.length}function Ut(e){const{collectionContextStore:t,isForColumnGroups:o}=e,i=o?"load_more_columns":"load_more_groups";return t.isLoading.state&&t.loadingDetails.state.type===i}function $t(e){const{collectionContextStore:t,groupsPointer:o}=e;return t.shouldShowSpinner.state&&"load_more_blocks"===t.loadingDetails.state.type&&w.Xy(t.loadingDetails.state.group,o)}var qt=o(4615),Qt=o(62965),Yt=o(61766),Xt=o(70203);function Jt(e){var t;const{transaction:o,environment:i,collectionContextStore:r,isFullScreen:n,groupsPointer:s,insertAtIndex:l,from:a,transient:c,useCrdt:d}=e,u=null===(t=r.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore;if(!u)return;r.searchQuery.state&&de.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:n});const h=A.IW({environment:i,collectionContextStore:r,groupsPointer:s,insertAtIndex:l,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:a,useCrdt:d});if(!h)return;const m=h.coercionSucceeded,g=h.newStore;if(i.device.isMobile)oe._({environment:i,store:g,pageVisitSource:p.tY.Create});else if(m){const e=g.getBlockTitleStore();K.eP({environment:i,store:g}),U.NX({store:e}),de.Z5({store:g,transient:c})}else ie.CH({environment:i,store:g,peekMode:(0,re.kr)(r.collectionViewStore()),resultsStore:u,collectionContextStore:r,pageVisitSource:p.tY.Create});ce.W(i,{from:a,type:"page",new_page_id:g.id,creating_block_id:g.id,...(0,pe.Pn)(r)})}var eo=o(43250),to=o(52821),oo=o(77556),io=o(65273);const ro=function(e){let{shouldShowSpinner:t,color:o,collectionContextStore:i,isFullScreen:r,groupsPointer:n}=e;window.__c={n:"BoardGroupAddItemButton"};const s=(0,ee.Fg)(),l=(0,ne.O7)(),a=s.lightTextColor;return(0,je.jsxs)(Ye.Z,{icon:e=>(0,ae.R)({...e,fill:o||a}),isLightGray:!0,isLarge:!0,style:{width:"100%",color:o||a},onClick:e=>function(e,t,o,i,r){if("collectionTypedView"===e.contextType)return;if(!ge.M_(i)||!e.collectionStore())return;$.createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:i,perform:n=>{Jt({transaction:n,environment:i,collectionContextStore:e,isFullScreen:t,groupsPointer:o,from:"board_group_add_item_bottom",transient:!1,useCrdt:r})}})}(i,r,n,l,(0,io.SL)(e,"collection_non_table_view")),onMouseDown:ue.$0,children:[(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.boardView.addItemButtonTitle"}),t&&(0,je.jsx)("div",{style:{margin:"0 0 0 auto"},children:(0,je.jsx)(Ke.Z,{style:{width:12,height:12}})})]})};var no=o(6695),so=o(25651),lo=o(95855),ao=o(54497),co=o(6404),po=o(51365),uo=o(96802),ho=o(9953),mo=o(87636),go=o(10912),So=o(97039),fo=o(78030),yo=o(65089),vo=o(44831),Co=o(41137),xo=o(64921),bo=o(3386),wo=o(84076),ko=o(31278),Po=o(97496),To=o(65187),Vo=o(56282),Ro=o(95645),Mo=o(28651),jo=o(49616),Fo=o(77181),_o=o(84210),Io=o(68056),Bo=o(65598),Do=o(80444),Ao=o(19511),Lo=o(96049),Zo=o(22294),Eo=o(88923),Oo=o(27724),Go=o(24666);const No=(0,j.defineMessages)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}});class zo extends Ro.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={mouseStore:Mo.Z,editModeStore:d.default},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:i,handleRepositionClick:r,handleSavePositionClick:n}=e;const{store:s,coverFormat:l,coverAspectFormat:a,collectionContextStore:c}=this.props,{device:d}=this.environment,{isMobile:p}=d,u=this.lastProxiedUrl&&l&&"contain"!==a,h=c.permissionScopes.state,m=s.canEdit()&&("collectionTypedView"===c.contextType||h.canEditContent);if(t&&!this.shouldShowActionButton.state)return;const g=Eo.default.state.open&&Eo.default.state.target.id===s.id,S=re.kr(null==c?void 0:c.collectionViewStore()),f=(0,jo.X9)(S,!1);return(0,je.jsxs)(mo.Z,{isVisible:t,position:"top",children:[u&&!o&&!p&&(0,je.jsx)(xo.Z,{style:Po.ar,onClick:e=>r(e,this.lastProxiedUrl),children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),u&&o&&!p&&(0,je.jsx)(xo.Z,{style:Po.ar,onClick:n,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),u&&o&&!p&&(0,je.jsx)(xo.Z,{style:Po.ar,onClick:i,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),this.shouldShowEditButton.state&&m&&!this.normalizedCardSelectionStore.state&&!h.isSyncedCollection&&(0,je.jsx)(Je.ZP,{renderTooltip:()=>(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:e=>(0,je.jsx)(xo.Z,{style:Po.ar,onClick:()=>{this.handleEditButtonClick("click")},...e,children:(0,so.R)({width:16,height:16})})}),this.normalizedCardSelectionStore.state&&!g&&(0,je.jsx)(Je.ZP,{renderTooltip:()=>f.tooltip,render:e=>(0,je.jsx)(xo.Z,{style:Po.ar,onClick:()=>{this.peekUrl.state&&(N.c4({environment:this.environment,url:this.peekUrl.state}),this.disallowEmptyDelete())},...e,children:f.icon({width:14,height:14})})}),!o&&(0,je.jsx)(Je.ZP,{renderTooltip:()=>(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:e=>(0,je.jsx)(xo.Z,{style:Po.ar,onClick:e=>function(e,t,o,i){K.Ys({environment:t,store:i}),co.Qn({environment:t,stores:Oo.default.state.stores,left:e.clientX,top:e.clientY,showInput:!0,actionSectionGroupKey:"default",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:o}})}(e,this.environment,this.props.collectionContextStore,this.props.store),...e,children:(0,le.o)({width:14,height:14})})})]})},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:i,collectionContextStore:r}=this.props,n=t.getAssociatedCollectionStore();if(!n)return;const s=this.normalizedCardSelectionStore.state,l="gallery"===Yo(this.props.collectionContextStore)?fo.C.GalleryView:fo.C.Board,a=Boolean(r.normalizedFormatStore.state.table_wrap);return(0,je.jsx)(So.Z,{store:t,property:e.property,disabled:o||!t.canEdit(),locked:r.permissionScopes.state.isLocked,format:l,tableWrap:a||Boolean(e.wrap),blockPropertyValueOverlayStore:i,collectionStore:n,showIfEmpty:s,onEnter:this.handleBlockPropertyEsc,onEsc:this.handleBlockPropertyEsc,onBgClick:this.handleBlockPropertyEsc,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e.property)},this.renderFooterIcons=()=>{const{store:e}=this.props,t=Bo.Xp(e,{recursivelyLoadAllDiscussions:!1}),o=this.shouldShowSubitemCountIndicator(),i=t>0;if(i||o)return(0,je.jsxs)("div",{style:this.getFooterIconsContainerStyle(),children:[i&&(0,je.jsxs)("div",{style:this.getDiscussionIndicatorWrapStyle(),children:[(0,lo.z)({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t]}),o&&(0,je.jsx)("div",{style:this.getSubitemCountIndicatorStyle(),children:(0,je.jsx)(Co.B,{blockStore:e,collectionContextStore:this.props.collectionContextStore})})]})},this.handleBlockSpace=()=>{this.handleEditButtonClick("space")},this.handleEditButtonClick=e=>{const{store:t,collectionContextStore:o}=this.props,{editModeStore:i}=this.stores,r=(0,to.JI)(t);K.eP({environment:this.environment,store:t}),U.NX({store:r}),de.Z5({store:t}),e&&F.sd(this.environment,"board_item_edit_mode_enter",{...(0,pe.Pn)(o),block_id:t.id,from:e,view_type:Yo(this.props.collectionContextStore)}),i.setState("existing")},this.handleClick=e=>{this.normalizedCardSelectionStore.state?e.preventDefault():(this.props.handleOpenPeekPage(),this.disallowEmptyDelete())},this.handleTextEnter=()=>{const{store:e,onTextEnter:t,onTextEsc:o,collectionContextStore:i}=this.props,{editModeStore:r}=this.stores;de.MO(),U.ZH(this.environment);e.canEdit()&&i.permissionScopes.state.canEditContent&&("new_empty"===r.state?o(e):"new"===r.state?t(e):K.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextEsc=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:i}=this.stores;de.MO();e.canEdit()&&o.permissionScopes.state.canEditContent&&("new_empty"===i.state?t(e):K.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=this.getShowProperties().map((e=>e.property));o.length>0&&po.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:o[0],format:fo.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleTrackTitlePropertyEdit=()=>{const e=Yo(this.props.collectionContextStore);if(!e)return;const{store:t,collectionContextStore:o}=this.props;_.rv({environment:this.environment,collectionContextStore:o,block_id:t.id,property:"title",property_type:"text",from:e}),this.disallowEmptyDelete()},this.handleTextUntab=()=>{const e=this.getShowProperties().map((e=>e.property)),t=w.dF(e,((e,t)=>qo(e,this.props.schema)));t&&po.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:t,format:fo.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleBlockPropertyEsc=()=>{po.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),K.Ys({environment:this.environment,store:this.props.store}),this.disallowEmptyDelete()},this.handleBlockPropertyTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state,i=this.getShowProperties().map((e=>e.property)),r=o.isOpen?i.findIndex((e=>e===o.property)):-1,n=i.find(((e,t)=>t>r&&qo(e,this.props.schema)))||i.find(((e,t)=>!this.normalizedCardSelectionStore.state&&qo(e,this.props.schema)));n?l.default.afterNextFlush((()=>{po.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:n,format:fo.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&l.default.afterNextFlush((()=>{this.handleEditButtonClick()})),po.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleBlockPropertyUntab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state;if(!o.isOpen)return;const i=this.getShowProperties().map((e=>e.property)),r=i.findIndex((e=>e===o.property)),n=w.dF(i,((e,t)=>t<r&&qo(e,this.props.schema)))||w.dF(i,((e,t)=>!this.normalizedCardSelectionStore.state&&qo(e,this.props.schema)));n?l.default.afterNextFlush((()=>{po.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:n,format:fo.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&l.default.afterNextFlush((()=>{this.handleEditButtonClick()})),po.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleMouseMove=()=>{if(!Lo.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=w.P2(this.handleMouseMove,100),this.handleMouseLeaveDebounced=w.Ds(this.handleMouseLeave,100),this.handleRecordIconChange=async e=>{const{store:t}=this.props,o=t.getIconStore();if(o){const{serverCommitResult:t}=$.createAndCommit({userAction:"PageViewBlock.handleRecordIconChange",environment:this.environment,perform:t=>{ho.sO({store:o,value:e,transaction:t})}});await t}this.disallowEmptyDelete()},this.tryDeleteEmptyOnBlur=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:i}=this.stores;"new_empty"!==i.state||this.normalizedCardSelectionStore.state||o.defaultPageTemplateStore.state||(t(e),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur))},this.normalizedCardSelectionStore=this.createComputedStore((()=>{const e=Ao.Z.state;return e.isActive&&e.store===this.props.store})),this.isItemSelectedStore=this.createComputedStore((()=>Oo.default.state.stores.includes(this.props.store))),this.shouldShowEditButton=this.createComputedStore((()=>{const e=this.isEditingTitle.state,t=Xo(this.props.format,this.props.collectionContextStore),o=this.getShowProperties();return!e&&(this.props.shouldShowTitle||t.length>0&&t.length!==o.length)})),this.isEditingTitle=this.createComputedStore((()=>{var e;const{blockPropertyValueOverlayStore:t}=this.props,o=Go.default.state;return"editing"===o.mode&&(null===(e=(0,Io.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,to.JI)(this.props.store)&&!t.state.isOpen})),this.peekUrl=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=Do.default.state;return re.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.pageUrl=this.createComputedStore((()=>{const{store:e}=this.props;return(0,_o.ZP)({store:e,fullyQualified:!1,pageVisitSource:p.tY.LinkInPage})})),this.shouldShowActionButton=this.createComputedStore((()=>{const{device:e}=this.environment,{isKeyboardMode:t}=Zo.Z.state;return!e.isMobile&&this.canEdit()&&!t})),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered&&!Lo.Z.state)),this.shouldShowParentItemIndicator=()=>(0,Fo.Cr)({collectionContextStore:this.props.collectionContextStore,blockId:this.props.store.id,blockStore:this.props.store}),this.shouldShowSubitemCountIndicator=()=>(0,Fo.wI)({collectionContextStore:this.props.collectionContextStore,blockStore:this.props.store}),this.disallowEmptyDelete=()=>{const{editModeStore:e}=this.stores;"new_empty"===e.state&&(e.setState("new"),Ao.Z.state.isActive&&Ao.Z.setState({...Ao.Z.state,transient:!1}))}}activate(){const e=this.peekUrl.state;e&&(this.props.handleOpenPeekPage(),N.c4({environment:this.environment,url:e}))}UNSAFE_willMount(){var e;const{editModeStore:t}=this.stores,o=Go.default.state,i="editing"===o.mode&&(null===(e=(0,Io.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,to.JI)(this.props.store),r=Ao.Z.state,n=r.isActive&&r.transient;i&&n?t.setState("new_empty"):i?t.setState("new"):t.setState("existing")}didMount(){const{editModeStore:e}=this.stores;super.didMount(),this.normalizedCardSelectionStore.state&&"new_empty"===e.state&&this.normalizedCardSelectionStore.addListener(this.tryDeleteEmptyOnBlur)}willUnmount(){super.willUnmount(),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur)}renderComponent(){const{device:e}=this.environment,{collectionContextStore:t,store:o,coverFormat:i,coverAspectFormat:n,coverWidth:s,coverHeight:l,coverSizeFormat:a,shouldShowTitle:c,colorStyle:d,onShiftEnter:p}=this.props,u=this.pageUrl.state,h=this.peekUrl.state,m=this.mouseIsEntered.state,g=this.normalizedCardSelectionStore.state,S=Yo(this.props.collectionContextStore),f=(0,r.createRef)(),y=(0,je.jsxs)(wo.Z,{ref:f,style:{...ei(d,t,this.theme),position:m?"relative":"static",..."gallery"===S&&{height:"100%"}},innerStyle:{userSelect:g?void 0:"none",WebkitUserSelect:g?void 0:"none",height:"100%",..."board"===S&&{minHeight:40},..."gallery"===S&&{display:"flex",flexDirection:"column"}},hoveredStyle:g?{background:Jo(d,t,this.theme)}:ti(d,t,this.theme),pressedStyle:g?{background:Jo(d,t,this.theme)}:oi(d,t,this.theme),href:u,metaHref:e.isMobile?u:h,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,onClick:this.handleClick,children:[(0,je.jsx)(Vo.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:e=>function(e,t,o){const{imagePosition:i,reset:r}=e;$.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:t,perform:e=>{uo.bf({store:o,coverPosition:i,transaction:e}),r()}})}(e,this.environment,this.props.store),source:S,small:"small"===a,store:this.props.store,renderControl:this.renderControl,render:e=>{let{imagePosition:t}=e;return i&&(0,je.jsx)(go.Z,{variant:"gallery",store:o,coverWidth:s,coverHeight:l,coverFormat:i,coverAspectFormat:n,coverSizeFormat:a,coverPosition:t,showEmptyGalleryCover:"gallery"===S,onLoadProxiedImage:e=>{this.lastProxiedUrl=e}})}}),this.shouldShowParentItemIndicator()&&(0,je.jsx)("div",{style:{paddingRight:4,paddingLeft:8,paddingTop:8,paddingBottom:0,maxWidth:"100%"},children:(0,je.jsx)(vo.O,{blockStore:o,collectionContextStore:this.props.collectionContextStore})}),c&&this.renderTitle(),this.renderProperties(),this.renderFooterIcons()]}),v=this.isItemSelectedStore.state;return(0,je.jsx)(bo.Z,{capture:g,onEsc:()=>{de.MO(),this.disallowEmptyDelete()},onEnter:()=>function(e,t){t&&t(e)}(this.props.store,this.props.onTextEnter),onSpace:this.handleBlockSpace,onTab:this.handleBlockPropertyTab,onUntab:this.handleEditButtonClick,children:(0,je.jsxs)(bo.Z,{capture:v,onShiftEnter:()=>{$.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{p({blocks:Oo.default.state.stores,transaction:e})}})},children:[y,Qo(this.props.store,this.props.collectionContextStore)&&(0,je.jsx)(yo.bZ,{origin:f})]})})}renderTitle(){const{device:e}=this.environment,{store:t,collectionContextStore:o}=this.props,i=(0,to.JI)(t),r=t.hasIcon()||!t.isEmptyPage(),n=t.hasError(),s=t.canEdit()&&o.permissionScopes.state.canEditContent,l=this.normalizedCardSelectionStore.state,a=Yo(this.props.collectionContextStore),c=s?(0,je.jsx)(ko.Z,{disabled:!1,bucket:"secure",style:{...ii(this.props.collectionContextStore),...e.isMobile?Wo:Ko,..."board"===a&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:t.getIcon(),store:t,onChange:this.handleRecordIconChange,size:e.isMobile?24:20,isEmptyPage:t.isEmptyPage()}):(0,je.jsx)(ko.Z,{disabled:!0,bucket:"secure",style:{...ii(this.props.collectionContextStore),...e.isMobile?Wo:Ko},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:t.getIcon(),store:t,size:e.isMobile?24:s?20:18,isEmptyPage:t.isEmptyPage()}),d=(0,je.jsx)(To.Z,{store:i,disabled:!l,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:this.handleTextEnter,onEsc:this.handleTextEsc,onTab:this.handleTextTab,onUntab:this.handleTextUntab,onChange:this.handleTrackTitlePropertyEdit,placeholder:l?Ne.default.formatMessage(No.typeAName):Ne.default.formatMessage(No.untitledBlock),style:{...e.isMobile?$o:Uo,..."board"===a&&{flexGrow:1,padding:2},pointerEvents:l?void 0:"none",cursor:l?"text":void 0,..."gallery"===a&&{whiteSpace:"pre-wrap"}},disableSelectAllBlocks:!0,pasteBehavior:"inline"});return(0,je.jsxs)("div",{style:this.getTitleWrapStyle(),children:[(r||l)&&!n&&c,n&&(0,ao.t)({fill:this.theme.accentColors.orange[500],width:e.isMobile?20:16,marginLeft:e.isMobile?2:4,marginRight:e.isMobile?4:6,paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom"}),d]})}renderProperties(){const e=this.getShowProperties();if(0!==e.length)return(0,je.jsx)("div",{style:ri(this.props.shouldShowTitle,this.props.collectionContextStore),children:e.map(this.renderProperty)})}getShowProperties(){const{store:e,schema:t}=this.props,o=Xo(this.props.format,this.props.collectionContextStore);if(!e.isDefined())return[];return o.filter((o=>{const i=this.normalizedCardSelectionStore.state&&"title"!==o.property;return no.XU({block:e.getModel(),property:o.property,schema:t,getRecordModel:this.props.store.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,Ee.r)(),intl:Ne.default.getIntl()})||i}))}hasNoProperties(){return 0===this.getShowProperties().length}getTitleWrapStyle(){const e=Yo(this.props.collectionContextStore);return{..."gallery"===e&&{width:"100%"},display:"flex",paddingTop:this.shouldShowParentItemIndicator()?4:8,paddingLeft:"board"===e?6:10,paddingRight:10,paddingBottom:"gallery"===e&&this.hasNoProperties()?10:6,position:"relative"}}getDiscussionIndicatorWrapStyle(){return{display:"flex",alignItems:"center",color:this.theme.lightTextColor,fill:this.theme.lightTextColor,fontWeight:R.Z.fontWeight.semibold,fontSize:12,paddingRight:10}}getSubitemCountIndicatorStyle(){return{display:"flex",alignItems:"center",color:this.theme.lightTextColor,fontWeight:R.Z.fontWeight.semibold}}getFooterIconsContainerStyle(){return{display:"flex",alignItems:"center",paddingLeft:10,paddingRight:10,paddingBottom:8,..."gallery"===Yo(this.props.collectionContextStore)&&{paddingTop:this.hasNoProperties()&&!this.props.shouldShowTitle?8:0}}}}zo.displayName="CollectionViewCardItem";const Ho=zo,Ko={float:"left",marginTop:2,marginRight:4,marginLeft:-2},Wo={float:"left",marginTop:0,marginRight:4,marginLeft:-2},Uo={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:R.Z.fontWeight.medium,width:"auto"},$o={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:R.Z.fontWeight.medium,width:"auto"};function qo(e,t){const o=t[e];return Boolean(o&&!Se.uk.includes(o.type))}function Qo(e,t){var o,i,r;return!(e.getSpaceId()!==(null===(o=Do.default.state.currentSpaceStore)||void 0===o?void 0:o.id))&&((null===(i=t.collectionViewStore())||void 0===i?void 0:i.getFormat().app_config_uri)===u.g3&&e.getFormat().app_config_uri===u.z3&&"sprint_board"===(null===(r=Do.default.state.mainEditorCurrentBlockStore)||void 0===r?void 0:r.getFormat().special_page_for_pm_launch))}function Yo(e){const t=e.collectionViewStore();return null==t?void 0:t.getType()}function Xo(e,t){return(("board"===Yo(t)?e.board_properties:e.gallery_properties)||[]).filter((e=>e.visible))}function Jo(e,t,o){return"board"===Yo(t)?(null==e?void 0:e.cardBackgroundColor)||o.boardItemDefaultBackground:o.collectionGalleryPreviewCardBackground}function ei(e,t,o){const i=Yo(t),r=t.isCompactView.state;return{...r?{boxShadow:o.homeShadow.card.base}:{boxShadow:e?o.selectTypeBoardBoxShadow:o.lightBoxShadow},borderRadius:"board"===i?4:r?6:3,background:Jo(e,t,o),overflow:"hidden",transition:"background 100ms ease-out",..."board"===i&&{marginBottom:ln}}}function ti(e,t,o){return t.isCompactView.state?{background:Jo(e,t,o),boxShadow:o.homeShadow.card.hovered}:{background:(null==e?void 0:e.cardHoveredBackgroundColor)||o.cardHoveredBackground}}function oi(e,t,o){return t.isCompactView.state?{background:Jo(e,t,o),boxShadow:o.homeShadow.card.hovered}:{background:(null==e?void 0:e.cardPressedBackgroundColor)||o.cardPressedBackground}}function ii(e){return{..."board"===Yo(e)&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}}}function ri(e,t){const o=Yo(t),i=t.isCompactView.state;return{paddingTop:e?0:8,paddingBottom:10,..."board"===o&&{lineHeight:1.5,paddingBottom:4,display:"flex",flexDirection:"column"},..."gallery"===o&&i&&{display:"flex",flexWrap:"wrap"}}}const ni=function(e){let{store:t,disabled:o,isFirstItem:i,isLastItem:r,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:p,numberedListCounterStore:u,bulletedListFormatStore:h,format:m,schema:g,coverFormat:S,coverAspectFormat:f,coverSizeFormat:y,shouldShowTitle:v,colorStyle:C,onTextEnter:x,onTextEsc:b,onShiftEnter:w,blockPropertyValueOverlayStore:k,isLast:P,handleOpenPeekPage:T,collectionContextStore:V}=e;return(0,je.jsx)(Ho,{store:t,disabled:o,isFirstItem:i,isLastItem:r,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:p,numberedListCounterStore:u,bulletedListFormatStore:h,format:m,schema:g,coverFormat:S,coverAspectFormat:f,coverSizeFormat:y,coverHeight:void 0,coverWidth:void 0,shouldShowTitle:v,colorStyle:C,onTextEnter:x,onTextEsc:b,onShiftEnter:w,blockPropertyValueOverlayStore:k,isLast:P,handleOpenPeekPage:T,collectionContextStore:V})};var si=o(34232),li=o(66213),ai=o(73744),ci=o(17504);class di extends d.default{getInitialState(){return{}}}const pi=di;const ui=function(e){let{store:t,disabled:o,isFirstItem:i,isLastItem:r,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:p,numberedListCounterStore:u,bulletedListFormatStore:h,format:m,schema:g,coverFormat:S,coverAspectFormat:f,coverSizeFormat:y,coverHeight:v,coverWidth:C,shouldShowTitle:x,onTextEnter:b,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:P,isLast:T,handleOpenPeekPage:V,collectionContextStore:R}=e;return(0,je.jsx)(Ho,{store:t,disabled:o,isFirstItem:i,isLastItem:r,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:p,numberedListCounterStore:u,bulletedListFormatStore:h,format:m,schema:g,coverFormat:S,coverAspectFormat:f,coverSizeFormat:y,coverHeight:v,coverWidth:C,shouldShowTitle:x,colorStyle:void 0,onTextEnter:b,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:P,isLast:T,handleOpenPeekPage:V,collectionContextStore:R})};var hi=o(18245),mi=o(76205),gi=o(59054),Si=o(40745),fi=o(95371),yi=o(37524),vi=o(97004),Ci=o(73807),xi=o(20144),bi=o(92973),wi=o(28020),ki=o(48543),Pi=o(55367);function Ti(e){window.__c={n:"CollectionGroupResultsItem"};const{store:t,resultProps:o,resultComponent:i,collectionContextStore:n,canDrag:s,canDrop:a,getItemSelectableStyle:d,belowDropZoneMargin:p,analyticsName:u,disabled:h,direction:m,onSelectableEnter:g,disableScrollToRevealHorizontal:S,touchDragOnly:f,isLast:y,groupsPointer:v,toggleButton:C,subitemPath:x,disableSelectable:b,itemSelectableHaloStyle:w,passesFilter:k,onSelectableInsertRow:P,blockPropertyValueOverlayStore:T,dropzoneGap:V}=e,R=(0,ne.O7)(),M=(0,c.VK)((()=>t.canEdit()),[t]),F=(0,c.VK)((()=>t.getAssociatedCollectionStore()),[t]),_=(0,c.VK)((()=>"collectionTypedView"===n.contextType),[n]),I=(0,c.VK)((()=>{const e=n.groupsStore.getGroupState(v);return null==e?void 0:e.resultsStore}),[n,v]),B=(0,c.VK)((()=>re.Sc(t)),[t]),D=(0,c.VK)((()=>{const e=Ao.Z.state;return e.isActive&&e.store===t}),[t]),L=(0,c.VK)((()=>!h&&M&&!(0,wi.aT)(t.id,n.isInPeekRenderer.state)),[h,M,t,n]),Z=(0,c.VK)((()=>e.shouldShowHoverMenu&&L),[e.shouldShowHoverMenu,L]),E=m!==Fi.Vertical&&a,G=m!==Fi.Vertical&&a,N=m===Fi.Vertical&&a,z=(0,c.VK)((()=>n.getAnalyticsFromOverride()),[n]),H=(0,c.VK)((()=>n.isCompactView.state),[n]),K=(0,ee.yK)((e=>({haloStyle:{...re.pB(B,e),...w}})),[w,B]),W=(0,r.useCallback)((e=>{const{insertStores:o,transaction:i}=e;return F?A.$T({environment:R,collectionStore:F,collectionContextStore:n,groupsPointer:v,insertStores:o,store:t,before:!1,transaction:i}):[]}),[F,n,R,v,t]),U=(0,r.useCallback)((e=>{const{insertStores:o,transaction:i}=e;return F?A.$T({environment:R,collectionStore:F,collectionContextStore:n,groupsPointer:v,insertStores:o,store:t,before:!0,transaction:i}):[]}),[F,n,R,v,t]),q=(0,r.useCallback)((e=>{const{droppedDirection:o,duplicate:i}=e;if(!F)return[];const r=hi.default.mark("collections.drop_item_lag");hi.default.measureAfterNextFlush(r,{environment:R,getData:()=>pe.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const s=o!==Pi.vh.Onto?(0,be.F6)({stores:e.droppedStores,collectionContextStore:n}):e.droppedStores;0===s.length&&_?xe.showErrorMessage((0,je.jsx)(j.FormattedMessage,{...be.nX.unsupportedGroupAction})):$.createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:R,perform:e=>{!A.by({environment:R,collectionStore:_?void 0:F,targetStore:t,droppedDirection:o,collectionContextStore:n,groupsPointer:v,droppedStores:s,duplicate:i,transaction:e,subitemPath:x})&&_&&xe.showErrorMessage((0,je.jsx)(j.FormattedMessage,{...be.nX.unsupportedGroupAction}))}})}),[F,n,R,v,_,t,x]),Q=(0,r.useCallback)((e=>{const{files:o,droppedDirection:i}=e;if(!F)return[];const r=hi.default.mark("collections.drop_item_lag");hi.default.measureAfterNextFlush(r,{environment:R,getData:()=>pe.yr({collectionContextStore:n,is_native_drop:!0,is_empty:!1})}),$.createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:R,perform:e=>{A.tQ({environment:R,collectionStore:F,targetStore:t,droppedDirection:i,collectionContextStore:n,groupsPointer:v,files:o,transaction:e})}})}),[F,n,R,v,t]),Y=(0,r.useCallback)((e=>o=>{let{transaction:i}=o;if(!F)return[];const r=A.yk({environment:R,collectionContextStore:n,groupsPointer:v,store:t,before:"above"===e,collectionStore:F,transaction:i,subitemPath:x,subitemInsertDirection:"below"});ce.W(R,{...pe.Pn(n),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==r?void 0:r.id,creating_block_id:null==r?void 0:r.id}),r&&P&&P(t,r),r&&T&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{po.bA({isNewBlock:!0,environment:R,blockPropertyValueOverlayStore:T,store:r,property:"title",format:fo.C.Table,collectionContextStore:n})}))}))}),[F,T,n,R,v,P,t,x]),X=(0,r.useCallback)((()=>{const t=n.collectionViewStore();hi.default.mark("collections.open_item_page_lag"),e.handleOpenPeekPage&&e.handleOpenPeekPage(),O.Xd({collectionContextStore:n,resultsStore:I});const o=null==t?void 0:t.getType();if(o){const e=null==t?void 0:t.getFormat().collection_peek_mode,i=e||ki.Ls[o];bi.hy(R,{is_peek:!0,from:o,peek_mode:i})}}),[n,R,e,I]),J=(0,c.VK)((()=>d?d(y):void 0),[d,y]);(0,r.useEffect)((()=>{n.onItemMount()}),[n]);const te=r.createElement(i,{handleOpenPeekPage:X,collectionContextStore:n,...o,store:t,key:t.id,isLast:y,toggleButton:C,subitemPath:x,passesFilter:k});return b?te:(0,je.jsx)(_t.Z,{style:J,store:t,analyticsFromOverride:z,canSelect:L,shouldShowHalo:!D&&!H,shouldForceRenderSelectionHalo:B,haloStyle:K.haloStyle,canDrag:s,canDropBelow:N,canDropLeft:E,canDropRight:G,canNativeDropBelow:N&&!_,canNativeDropLeft:E&&!_,canNativeDropRight:G&&!_,canDropOnto:a,canTriggerContextMenu:L,showBlockMenuInput:!0,shouldShowHoverMenu:Z,shouldShowCommentMenu:!1,onSelectableDrop:q,onNativeDrop:Q,onInsertBelow:W,onInsertAbove:U,onRemove:e=>function(e,t,o,i,r){const{transaction:n}=e;r.length>0&&A.BN({store:o,transaction:n,groupsPointer:r,collectionContextStore:i,environment:t});A.Od({store:o,transaction:n})}(e,R,t,n,v),canInsertAbove:a,canInsertBelow:a,onInsertRowBelow:Y("below"),onInsertRowAbove:Y("above"),belowDropZoneMargin:p,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:u,shouldShowDropZone:a,dropzoneGap:V,onEnter:g,className:eo.K4T,disableScrollToRevealHorizontal:S,touchDragOnly:f,groupsPointer:v,children:te})}const Vi=r.memo(Ti,Qt.Z),Ri=function e(t){window.__c={n:"CollectionGroupResultsNestedItem"};const{store:o,collectionContextStore:i,subitemPath:n,titleColumnIndex:s,nestedCreateSubitemButton:l,getItemSelectableStyle:a}=t,{currentSubitemFormatStoreForUiDisplay:d,subitemExpandedStore:p,subitemTreeStore:u}=i,h=(0,c.VK)((()=>re.Bm({store:o,collectionContextStore:i})),[i,o]),m=(0,c.VK)((()=>n&&n.length>0?n:(0,fi.DY)(u.state.children,(e=>e.value.store===o))),[n,u,o],{useDeepEqual:!0}),g=m?(0,Fo.Af)(m.map((e=>e.value.store))):"",S=(0,c.VK)((()=>p.state.get(g)),[p,g]),f=Boolean(null==S?void 0:S.isExpanded),y=(0,ne.O7)(),v=(0,c.VK)((()=>{const e=d.state;if(!e||!h)return;const t=h.getSchema()[e.property];return void 0!==t&&(0,Se.p_)(t)?t:void 0}),[d,h]),C=(0,c.VK)((()=>{var e;return v&&"relation"===v.type&&(0,Se.F0)(v)===(null===(e=i.collectionStore())||void 0===e?void 0:e.id)&&v.property}),[i,v]),x=(0,c.VK)((()=>{var e;return null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType()}),[i]),b=(0,c.VK)((()=>{const e=!C||x&&(0,Fo.Av)(x)?void 0:{property:C,filter:{operator:"is_empty"}};return!(!d.state||!h)&&(0,Fo.kC)({store:o,collectionStore:h,subitemFormat:d.state,subitemPathKey:g,collectionContextStore:i,propertyFilters:[...e&&C?[{id:C,filter:e}]:[],...i.currentPropertyFiltersStore.state],combinatorFilter:i.currentCombinatorFilterStore.state,currentUserId:y.currentUser.id}).length>0}),[i,x,d,y.currentUser.id,C,h,g,o]),w=(0,c.VK)((()=>{var e;if(!d.state||!h)return!1;const t=null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType();return b||f||y.device.isMobile||"timeline"===t}),[d,y.device.isMobile,h,b,f,i]),k=(0,c.VK)((()=>xi.Z.getState().hoveredStore===o),[o]),P=(0,c.VK)((()=>{const e=(0,vi.m1)({collectionContextStore:i,collectionStore:h,environment:y});if(e)return(0,mi.q)(e)}),[i,h,y]),T=(0,r.useCallback)((()=>{const e=p.state;if(f)e.delete(g),F.a_(y,{...(0,pe.Pn)(i),depth:(null==m?void 0:m.length)||0}),p.emit();else{e.set(g,{isExpanded:!0,limit:20}),F._k(y,{...(0,pe.Pn)(i),depth:(null==m?void 0:m.length)||0});const t=d.state;P&&e&&v&&t?(0,Fo.fd)({blockStore:o,subitemExpandedStore:p,subitemFormat:t,propertySchema:v,compiledFilter:P,pathKey:g,forceStoresToLoad:!1,visitedIds:new Set}).then((()=>{p.emit()})):p.emit()}}),[P,p,f,g,i,d,y,m,o,v]),V=(0,c.VK)((()=>{const e=u.state;return e&&m?(0,Fo.Ns)(e).value.store===o:t.isLast}),[u,t.isLast,o,m]),R=(0,Ci._)(),M=(0,c.VK)((()=>{var e;const t=o.getModel(),i=o.getRecordModel;if(!P||!t)return!0;const r=null===(e=o.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return P({block:t,getRecordModel:i,propertyMapping:r,formulaTimeoutTimestampMs:Date.now()+R,resultCache:new Map})}),[o,P,R]),j=(0,c.VK)((()=>a&&!M?()=>({...a?a(V):{},...M?{}:{opacity:.5}}):a),[a,M,V]);(0,gi.r5)((async()=>{const e=o.getModel();await o.load();const t=o.getRecordModel,i=d.state;if(!w||!e||!P||!v||!t||!i||M)return;(0,Fo.xb)({store:o,subitemFormat:i,propertySchema:v}).length>0||(await(0,Fo.fd)({blockStore:o,subitemExpandedStore:p,subitemFormat:i,propertySchema:v,compiledFilter:P,pathKey:g,forceStoresToLoad:!0,visitedIds:new Set}),p.emit())}),[w,P,d,M,g,o,p,v]);const _=(0,ee.Fg)(),I=(0,je.jsx)(Vi,{...t,passesFilter:M,isLast:V,getItemSelectableStyle:j,subitemPath:m,toggleButton:(w||k)&&(0,je.jsx)(It.Z,{isSidebar:!1,open:f,fill:!0,onClick:T,color:b||f?_.regularIconColor:_.mediumIconColor,disabled:m&&m.length>=Fo.F0})});if(!f||!m||0===m.length||m.length>=Fo.F0)return I;const B=m[m.length-1].children;return(0,je.jsxs)(je.Fragment,{children:[I,B.map((o=>{const i=o.value.store;return(0,r.createElement)(e,{...t,key:i.id,store:i,subitemPath:[...m,o]})})),h&&l&&l({store:o,parentStore:h,subitemPath:m,indentLevel:m.length,titleColumnIndex:s}),S&&B.length>0&&B.length===S.limit&&(0,je.jsx)(Mi,{collectionContextStore:t.collectionContextStore,pathKey:g,titleColumnIndex:s,limit:S.limit,indentLevel:m.length})]})},Mi=r.memo((function(e){window.__c={n:"NestedTableLoadMoreButton"};const{collectionContextStore:t,pathKey:o,titleColumnIndex:i,limit:n,indentLevel:s}=e,l=(0,r.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:n+20}),e.emit()}),[t,n,o]),a=(0,ne.O7)(),d=(0,c.VK)((()=>re.fk({environment:a,collectionContextStore:t})),[t,a]),p=(0,c.VK)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),u=(0,ee.yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:8+(0,yi.f2)({columnIndex:0,titleColumnIndex:i,shouldShowBulkActionsToolbar:d,indentLevel:s+1,isSubitemToggleOnTitleColumn:p}),fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[s,d,i,p]);return(0,je.jsxs)(xo.Z,{onClick:l,onMouseDown:ue.$0,style:u.button,children:[(0,Si.M)(u.icon),(0,je.jsx)("span",{style:u.label,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})})]})})),ji=r.memo(Ri);let Fi=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});class _i extends s.Z{constructor(){super(...arguments),this.instanceCollectionViewBlockStore=void 0,this.handleEmptyDroppableDrop=e=>{const{droppedDirection:t,duplicate:o}=e,{collectionContextStore:i,groupsPointer:r}=this.props,n=this.emptyDroppableIntoStore.state,s=i.collectionViewBlockStore();if(!s)return;const l=hi.default.mark("collections.drop_item_lag");hi.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>pe.yr({collectionContextStore:i,is_native_drop:!1,is_empty:!0})});const a="collectionTypedView"===i.contextType,c=(0,be.F6)({stores:e.droppedStores,collectionContextStore:i});0===c.length&&a?xe.showErrorMessage(Ne.default.formatMessage(be.nX.unsupportedGroupAction)):$.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:this.environment,perform:e=>{!A.by({environment:this.environment,collectionStore:n,targetStore:s,droppedDirection:t,collectionContextStore:i,groupsPointer:r,droppedStores:c,duplicate:o,transaction:e})&&a&&xe.showErrorMessage(Ne.default.formatMessage(be.nX.unsupportedGroupAction))}})},this.handleEmptyDroppableNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:i,groupsPointer:r}=this.props,n=this.emptyDroppableIntoStore.state;if(!n)return;const s=i.collectionViewBlockStore();if(!s)return;const l=hi.default.mark("collections.drop_item_lag");hi.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>pe.yr({collectionContextStore:i,is_native_drop:!0,is_empty:!0})}),$.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:this.environment,perform:e=>{A.tQ({environment:this.environment,collectionStore:n,targetStore:s,droppedDirection:o,collectionContextStore:i,groupsPointer:r,files:t,transaction:e})}})},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t,loadContentCover:o}=this.props,i=e.groupsStore.getGroupState(t);if(!i)return;const r=i.currentLimit.state,n=e.normalizedSchemaStore.state,s=w.oA(t.map((e=>(0,Ze.Ko)({schema:n,propertyMapping:void 0,group:e,timeZone:(0,Ee.r)()}))));return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:r,loadContentCover:o}})),this.resultStores=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return(null==o?void 0:o.resultsStore.state)??[]})),this.emptyDroppableIntoStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return"collectionTypedView"===e.contextType?void 0:e.collectionStore()}))}getNode(){return super.getNode()}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.instanceCollectionViewBlockStore=new me.G(this.environment,t.pointer))}didMountOrUpdate(){this.props.collectionContextStore.renderEmitter.emit()}renderComponent(){const{emptyDroppableStyle:e,direction:t}=this.props,o=this.props.emptyDroppableSize||"none",i=t===Fi.Vertical;return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:{...i?{height:o}:{width:o},...e},children:this.renderEmptyDroppable()}),this.resultStores.state.map(((e,t,o)=>(0,je.jsx)(Di,{store:e,isLast:t===o.length-1,...this.props},e.id))),this.renderReducerRequest()]})}renderReducerRequest(){const{collectionContextStore:e,groupsPointer:t,disableRequest:o}=this.props;if(o)return;const i=this.resultsReducerStore.state;if(!i)return;const r=e.groupsStore.getGroupState(t);return r?(0,je.jsx)(He.Z,{id:t.length>0?`results:${(0,te.KW)(t)}`:"collection_group_results",reducer:i,groupsPointer:t,collectionContextStore:e,resultStore:r.reducerResultStore}):void 0}renderEmptyDroppable(){const{collectionContextStore:e,disabled:t,analyticsName:o,direction:i,onSelectableEnter:r,canDrop:n,groupsPointer:s}=this.props;if(this.instanceCollectionViewBlockStore){const l=i!==Fi.Vertical&&(!t&&0===this.resultStores.state.length),a=i===Fi.Vertical&&!t,c="collectionTypedView"===e.contextType,d=e.isCompactView.state;return(0,je.jsx)(_t.Z,{store:this.instanceCollectionViewBlockStore,canSelect:!1,canEditText:!1,shouldShowHalo:!d,canDrag:!1,canDropLeft:n&&l,canNativeDropLeft:n&&l&&!c,canDropBelow:n&&a,canNativeDropBelow:n&&a&&!c,canTriggerContextMenu:!1,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.handleEmptyDroppableDrop,onNativeDrop:this.handleEmptyDroppableNativeDrop,analyticsName:o,shouldShowDropZone:n,onEnter:r,groupsPointer:s,style:i===Fi.Vertical?void 0:{width:"100%",height:"100%"}})}}}_i.displayName="CollectionGroupResults";const Ii=_i;function Bi(e){window.__c={n:"ResultComponent"};const{isLast:t,collectionContextStore:o,dropzoneGap:i,resultProps:n,resultComponent:s,groupsPointer:l,shouldShowHoverMenu:a,canDrag:d,disabled:p,format:u,getItemSelectableStyle:h,handleOpenPeekPage:m,belowDropZoneMargin:g,analyticsName:S,direction:f,onSelectableEnter:y,canDrop:v,disableScrollToRevealHorizontal:C,touchDragOnly:x,blockPropertyValueOverlayStore:b,onSelectableInsertRow:w,disableSelectable:k,titleColumnIndex:P,nestedCreateSubitemButton:T,itemSelectableHaloStyle:V}=e,R=(0,c.VK)((()=>re.Bm({store:e.store,collectionContextStore:o})),[o,e.store]),M=(0,r.useMemo)((()=>[]),[]);return R?(0,je.jsx)(ji,{getItemSelectableStyle:h,itemSelectableHaloStyle:V,store:e.store,canDrag:d,resultProps:n,resultComponent:s,collectionContextStore:o,groupsPointer:l,shouldShowHoverMenu:a,canDrop:v&&!p,format:u,handleOpenPeekPage:m,belowDropZoneMargin:g,analyticsName:S,disabled:p,direction:f,dropzoneGap:i,onSelectableEnter:y,disableScrollToRevealHorizontal:C,touchDragOnly:x,isLast:t,subitemPath:M,titleColumnIndex:P,blockPropertyValueOverlayStore:b,onSelectableInsertRow:w,disableSelectable:k,nestedCreateSubitemButton:T}):null}const Di=r.memo(Bi),Ai=r.memo((function(e){let{collectionContextStore:t,groupFormat:o,format:i,schema:n,disabled:s,store:l,blockPropertyValueOverlayStore:a,collectionGalleryViewStore:d,isSingleColumn:p}=e;const u=(0,ne.O7)(),h=(0,r.useMemo)((()=>o?[o]:[]),[o]),m=(0,c.VK)((()=>t.permissionScopes.state),[t.permissionScopes]),g=(0,c.VK)((()=>l.canEdit()&&("collectionTypedView"===t.contextType||m.canEditContent)),[t,m.canEditContent,l]),S=(0,r.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();K.eP({environment:u,store:e}),U.NX({store:o}),de.Z5({store:e})}}),[u]),f=(0,r.useCallback)((e=>{const o=t.collectionStore(),i=e.getTitleStore();if(!i)return;Xt.QaF(i.getValue())?K.Ys({environment:u,store:e}):o&&$.createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:u,perform:t=>{A.Od({store:e,transaction:t})}})}),[t,u]),y=(0,r.useMemo)((()=>p?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[p]),{gallery_cover:v,gallery_cover_aspect:C,gallery_cover_size:x}=i,b=!s&&g&&!m.isSyncedCollection,{coverHeight:w,coverWidth:k}=(0,c.VK)((()=>d.state),[d]),P=(0,r.useMemo)((()=>({format:i,schema:n,onTextEnter:f,onTextEsc:f,onShiftEnter:S,disabled:s,coverFormat:v,coverAspectFormat:C,coverSizeFormat:x,coverHeight:w,coverWidth:k,shouldShowTitle:to.K8(i,"gallery"),blockPropertyValueOverlayStore:a,collectionContextStore:t})),[a,t,w,k,C,v,x,s,i,S,f,n]);return(0,je.jsx)(Ii,{collectionContextStore:t,groupsPointer:h,format:i,canDrag:b,onSelectableEnter:S,resultProps:P,resultComponent:ui,canDrop:!0,disabled:s,shouldShowHoverMenu:!1,direction:p?Fi.Vertical:Fi.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:y,loadContentCover:v&&"page_content"===v.type})}));var Li=o(49902);const Zi=(0,j.injectIntl)((function(e){const{limit:t}=e;return(0,je.jsx)(j.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}));const Ei=(0,j.injectIntl)((function(e){window.__c={n:"FirstLoadLimitSelectMenu"};const t=(0,ne.O7)(),{device:o}=t,{currentLimit:i,onAccept:r,onClose:n,showTitle:s}=e,l=[{key:0,render:e=>(0,je.jsx)(Re.Z,{enableActionSheetTitle:!0,title:s&&(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:w.oA(no.jk.map(((e,t)=>({key:t,render:t=>(0,je.jsx)(qe.Z,{...t,disabled:!1,title:(0,je.jsx)(Zi,{limit:e}),checkState:w.Xy(i,e)}),action:()=>r(e)}))))}];let a;return a=o.isMobile?{menuType:we.og.ActionSheet}:{menuType:we.og.Popup,width:200},(0,je.jsx)(Pe.Z,{...a,children:(0,je.jsx)(Te.Z,{type:Te.i.Vertical,sections:l,onAccept:n,initialFocus:void 0})})}));const Oi=function(e){let{format:t,collectionContextStore:o}=e;window.__c={n:"FirstLoadLimitActionButton"};const i=(0,ne.O7)(),{device:r}=i;return(0,je.jsx)(Qe.ZP,{popupType:r.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,renderOrigin:e=>(0,je.jsx)(Ft.Z,{icon:le.o,style:{marginLeft:4,marginRight:4},...e}),alignmentToOrigin:Qe.vR.End,placementToOrigin:Qe.pO.Bottom,originGap:8,render:e=>(0,je.jsx)(Ni,{parent:e,format:t,collectionContextStore:o})})};function Gi(e){return(0,no.rx)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}function Ni(e){let{parent:t,format:o,collectionContextStore:i}=e;window.__c={n:"PopupComponent"};const r=(0,ne.O7)();return(0,je.jsx)(Ei,{currentLimit:Gi(o),onAccept:e=>function(e,t,o){const i=t.collectionViewStore();if(!i)return;const r=i.getType();r&&($.createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,perform:t=>{uo.FH({stores:[i],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),F.wd(o,{view_type:r,action:"set_first_load_limit"}))}(e,i,r),onClose:t.close,showTitle:!0})}const zi=function(e){let{style:t,store:o,format:i,collectionContextStore:r,groupsPointer:n,incrementLimitsInRelatedGroups:s,isFullScreen:l}=e;window.__c={n:"CollectionGroupLoadMoreButton"};const a=(0,ee.Fg)(),d=(0,ne.O7)(),u=(0,c.VK)((()=>r.groupsStore.getGroupState(n)),[r,n]),h=(0,c.VK)((()=>$t({collectionContextStore:r,groupsPointer:n})),[r,n]),m=(0,c.VK)((()=>r.isCompactView.state),[r]),g=(0,c.VK)((()=>o.canEdit()),[o]);return u?m?(0,je.jsx)(xo.Z,{onClick:e=>function(e,t,o){e.metaKey||e.ctrlKey?oe._({environment:t,store:o,pageVisitSource:p.tY.PersonalHomeTileTasks,openInNew:"tab"}):oe._({environment:t,store:o,pageVisitSource:p.tY.PersonalHomeTileTasks})}(e,d,o),onMouseDown:ue.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,paddingLeft:8,marginBottom:8,...t},children:(0,je.jsx)("div",{style:{color:a.lightTextColor},children:(0,je.jsx)(j.FormattedMessage,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})}):(0,je.jsxs)(xo.Z,{onClick:e=>function(e,t,o,i,r,n){const s=o.groupsStore.getGroupState(i);if(!s)return;const l=s.reducerResultStore.state;(0,ue.Wi)(e),K.ZH(t),l&&A.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:s.groupsPointer,incrementLimitsInRelatedGroups:r}});Li.j({name:"collection_load_more"}),F.uD(t)}(e,d,r,n,s,l),onMouseDown:ue.$0,disabled:h,hoveredStyle:h?{background:a.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,...t},children:[(0,Si.M)(Hi(a)),(0,je.jsx)("div",{style:{color:a.lightTextColor},children:(0,je.jsx)(j.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),h?(0,je.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,je.jsx)(Ke.Z,{style:{width:12,height:12}})}):g&&(0,je.jsx)(Oi,{collectionContextStore:r,format:i})]}):null};function Hi(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}class Ki extends d.default{getInitialState(){return!1}}const Wi=Ki;class Ui extends d.default{getInitialState(){}}const $i=Ui;class qi extends d.default{getInitialState(){return{containerMap:new Map}}}const Qi=qi;class Yi extends s.Z{constructor(){super(...arguments),this.element=void 0,this.scrollableAncestor=void 0,this.resizingAncestor=void 0,this.callbackQueued=!1,this.resizeObserver=new ResizeObserver((()=>{this.handleScroll()})),this.storeTypes={store:Qi},this.handleScroll=()=>{this.callbackQueued||(this.callbackQueued=!0,window.requestAnimationFrame((()=>{this.callbackQueued=!1,this.mutateDOM((()=>{!function(e){const{environment:t,container:o}=e,{device:i}=t,{store:r}=o.stores,{containerMap:n}=r.state,s=Array.from(n.keys()).sort(((e,t)=>{if(e.element&&t.element)return(0,xt.Z)(e.element,t.element);throw new Error("Element not found")})),l=new Map;for(const a of s){const{element:e,scrollableAncestor:t}=a,o=n.get(a);if(!e||!t||!o)continue;const r=Tt(a).reduce(((e,t)=>e+(l.get(t)||0)),0),s=t.getBoundingClientRect(),c=e.getBoundingClientRect(),d=s.height,p=Math.floor(s.top-c.top),u=Math.floor(s.top+d-c.top),h=Math.floor(c.height)+(a.props.isFullScreen&&!i.isSafari?bt.Z.state:0),m=Array.from(o.values()).sort(((e,t)=>{if(e.element&&t.element)return(0,xt.Z)(e.element,t.element);throw new Error("Element not found")}));let g=r,S=0;for(const i of m){if(!i.element)continue;const e=i.element.getBoundingClientRect(),t=g+e.height;i.props.position===ht.Top&&(S+=e.height);const o=kt(p,h,t,r),n=Pt(u,h,t,S);if(i.props.position===ht.Top){const e=0!==o,t=i.props.getComputedStyle?i.props.getComputedStyle(e):void 0;e?(i.element.style.transform=`translate3d(0, ${o}px, 0)`,i.element.style.bottom=""):(i.element.style.transform="",i.element.style.bottom=""),t&&Rt(i.element,t)}else if(i.props.position===ht.Bottom){const e=0!==n,t=i.props.getComputedStyle?i.props.getComputedStyle(e):void 0;if(e?(i.element.style.transform=`translate3d(0, ${n}px, 0)`,i.element.style.top=""):(i.element.style.transform="",i.element.style.top=""),t)for(const o in t)i.element.style[o]=t[o]||""}g=t}l.set(a,g)}}({environment:this.environment,container:this})}))})))},this.handleResizeThrottled=w.P2(this.handleScroll,100)}didMount(){!function(e){const{container:t,parentContainer:o}=e,i=o?o.stores.store:t.stores.store;i.state.containerMap.has(t)||i.state.containerMap.set(t,new Set),i.emit()}({container:this,parentContainer:Vt(this)}),(0,he.Gf)(this.environment)&&this.attachEvents()}willUnmount(){!function(e){const{container:t,parentContainer:o}=e,i=o?o.stores.store:t.stores.store;i.state.containerMap.delete(t),i.emit()}({container:this,parentContainer:Vt(this)}),(0,he.Gf)(this.environment)&&this.removeEvents(),this.element=void 0,this.scrollableAncestor=void 0}getChildContext(){return{...this.context,computedStickyContainer:this}}renderComponent(){if(this.props.children)return this.props.children}attachEvents(){const e=Vt(this),t=n.findDOMNode(this);if(t){this.element=t;const o=(0,he.VW)(t);o&&(this.scrollableAncestor=o,e||((0,ai.lj)(o,"scroll",this.handleScroll),(0,ai.lj)(window,"resize",this.handleResizeThrottled),this.resizeObserver.observe(this.element)));const i=(0,he.Ez)(this.element);i&&(this.resizingAncestor=i,this.resizeObserver.observe(this.resizingAncestor))}this.props.renderEmitter&&this.props.renderEmitter.addListener(this.handleScroll)}removeEvents(){this.scrollableAncestor&&((0,ai.ZV)(this.scrollableAncestor,"scroll",this.handleScroll),(0,ai.ZV)(window,"resize",this.handleResizeThrottled),this.element&&this.resizeObserver.unobserve(this.element)),this.resizingAncestor&&this.resizeObserver.unobserve(this.resizingAncestor),this.props.renderEmitter&&this.props.renderEmitter.removeListener(this.handleScroll)}}Yi.displayName="ComputedStickyContainer",Yi.contextTypes={computedStickyContainer:Ct().any,...s.w},Yi.childContextTypes={computedStickyContainer:Ct().any,...s.w};const Xi=Yi,Ji=d.default.createClass(!1);function er(e){let{renderGroup:t,groupFormat:o,groupsDisplayState:i,disabled:n,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:d,collectionContextStore:p,onGroupHeaderAddItem:u,renderHeader:h,getGroupStyle:m,stickyLeft:g,ignoreAncestorStickyContainer:S,paddingLeft:f,isFullScreen:y,index:v,isRootChild:C,isInPeekRenderer:x,groupBy:b,isLast:w}=e;window.__c={n:"CollectionGroup"};const k=(0,ne.O7)();(0,r.useEffect)((()=>{A.V$({environment:k,collectionContextStore:p,groupFormat:o})}),[]);const P=(0,c.qz)(void 0,Ji),[T,V,R,M,j,F]=(0,c.VK)((()=>{const e=p.groupsStore.getGroupState(o),r=e?e.toggleStateStore:null,c=!!r&&r.state?t(o):null,S={groupFormat:o,currentGroups:i.currentGroups,disabled:n,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:d,collectionContextStore:p,isFullScreen:y,isInPeekRenderer:x,onGroupHeaderAddItem:u,stickyLeft:g,index:v,paddingLeft:f,isRootChild:C,groupBy:b,isGroupHoveredStore:P},k=h?h(S):(0,je.jsx)(Dt,{...S});return[e,r,p.renderEmitter,m&&r?m({groupFormat:o,...i,index:v,isLast:w,toggleStateStore:r}):void 0,c,k]}),[p,n,a,m,l,b,o,i,s,v,y,x,w,C,u,f,t,h,d,g,P]),_=(0,r.useCallback)((()=>{P.setState(!0)}),[P]),I=(0,r.useCallback)((()=>{P.setState(!1)}),[P]);return T&&V?(0,je.jsx)(Xi,{ignoreAncestorContainer:S,renderEmitter:R,isFullScreen:y,children:(0,je.jsxs)("div",{style:{width:"100%",position:"relative",...M},onMouseEnter:_,onMouseLeave:I,children:[F,j]})}):null}er.displayName="CollectionGroup";const tr=r.memo(er);var or=o(51592);class ir extends s.Z{constructor(){super(...arguments),this.reducerStore=this.createComputedStore((()=>{const{aggregation:e,schema:t,groupFormat:o}=this.props;if(e){return{type:"aggregation",filter:(0,Ze.zk)({schema:t,group:o,propertyMapping:void 0,timeZone:(0,Ee.r)()}),aggregation:e}}}))}renderComponent(){const{device:e}=this.environment;return(0,je.jsx)(Je.ZP,{renderTooltip:()=>(0,je.jsx)(nr,{aggregation:this.props.aggregation,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore}),render:t=>(0,je.jsx)(Qe.ZP,{popupType:e.isMobile?Qe.Z4.SlideUp:Qe.Z4.Popup,renderOrigin:e=>(0,je.jsx)(Ye.Z,{disabled:this.props.disabled,style:{fontWeight:R.Z.fontWeight.regular,color:this.props.color||this.theme.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0},...(0,ze.Z)(t,e),children:this.renderValue()}),disabled:this.props.disabled,render:e=>(0,je.jsx)(pr,{parent:e,onChange:this.props.onChange,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema})})})}renderValue(){const{schema:e,aggregation:t,collectionContextStore:o,groupFormat:i}=this.props,r=this.reducerStore.state;if(t&&r)return(0,je.jsx)(He.Z,{id:`board:${(0,te.mD)(i)}`,collectionContextStore:o,reducer:r,groupsPointer:[i],render:o=>{const i=o.state;let r;if((0,Le.pK)(t)){const o=e[t.property];!o||"formula"!==o.type&&"number"!==o.type||(r=o.number_format)}return(0,je.jsx)(Ue,{aggregation:t,collectionContextStore:this.props.collectionContextStore,children:i?(0,Ge.Ol)({numberFormat:r,dateFormat:void 0,aggregationType:t.aggregator,userTimeZone:(0,Ee.r)(),value:i.aggregationResult,roundDecimal:5}):"-"})}})}}ir.displayName="BoardAggregation";const rr=ir;function nr(e){let{aggregation:t,schema:o,collectionContextStore:i}=e;window.__c={n:"TooltipText"};const r=(0,c.VK)((()=>!!t&&We(i,t)),[i,t]);if(t){const e=Ge.VN[(0,Le.OV)(t)];if((0,Le.pK)(t)){const i=o[t.property];if(i){const t=i.name;return(0,je.jsx)(je.Fragment,{children:Ne.default.formatMessage($e.propertyAggregation,{aggregationType:e,propertyName:t,calculating:r})})}}return(0,je.jsx)(je.Fragment,{children:Ne.default.formatMessage($e.aggregationType,{aggregationType:e,calculating:r})})}return(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function sr(e){let{aggregationType:t,label:o,props:i}=e;const r=Ge.Sn[t];return(0,je.jsx)(Je.ZP,{placement:Xe.GI.Placement.Right,delayThreshold:0,render:e=>(0,je.jsx)(qe.Z,{title:o,...(0,ze.Z)(e,i)}),renderTooltip:()=>(0,je.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[r&&(0,je.jsx)("img",{src:(0,Oe.D)(r),style:{borderRadius:4,width:140,marginTop:4}}),Ge.BG[t]]})})}function lr(e,t,o,i){o.isLoading.state||o.loadingDetails.setState({type:"load_aggregation"}),o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),_.wd({environment:i,collectionContextStore:o,action:"board_change_aggregation"}),Li.j({name:"collection_change_aggregation"})}function ar(e,t,o,i){const r=Ge.VN[e];return{key:e,render:t=>(0,je.jsx)(sr,{aggregationType:e,label:r,props:t}),action:()=>{lr({aggregator:e},t,o,i)}}}function cr(e,t,o,i,r,n){const{device:s}=o,l=Ge.VN[e],a=w.oA(t.map((t=>function(e,t,o,i,r,n){const s=o[e];if(!s)return;const l=s.name;return{key:`${e} ${t}`,render:e=>(0,je.jsx)(sr,{aggregationType:t,label:l,props:e}),action:()=>{lr({aggregator:t,property:e},i,r,n)}}}(t,e,i,r,n,o))));return{key:e+l,render:(e,t)=>(0,je.jsx)(et.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,je.jsx)(qe.Z,{...e,ref:t,title:l}),renderExtension:(e,o)=>{let i;return i=s.isMobile?{menuType:we.og.Modal,title:l,right:(0,je.jsx)(Ve.DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:we.og.Popup,width:200,...e},(0,je.jsx)(Pe.Z,{...i,children:(0,je.jsx)(Te.Z,{type:Te.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,je.jsx)(Re.Z,{...e}),items:a}],onAccept:t.onAccept})})}}),action:()=>null}}function dr(e,t,o,i){const r=[];for(const c of Le.o5)r.push(ar(c,t,o,e));const n=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(n.length>0)for(const c of Le.Sy)"show_unique"!==c&&r.push(cr(c,n,e,i,t,o));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.O4)(o)}))}(i);if(s.length>0)for(const c of Le.k$)r.push(cr(c,s,e,i,t,o));const l=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.dN)(o)}))}(i);if(l.length>0)for(const c of Le.f8)r.push(cr(c,l,e,i,t,o));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Le.Mv)(o)}))}(i);if(a.length>0)for(const c of Le.gC)r.push(cr(c,a,e,i,t,o));return r}function pr(e){let{parent:t,onChange:o,collectionContextStore:i,schema:r}=e;window.__c={n:"MenuComponent"};const n=(0,ne.O7)(),{device:s}=n;let l;return l=s.isMobile?{menuType:we.og.Modal,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,je.jsx)(Ve.DoneMenuText,{}),onClickRight:t.close}:{menuType:we.og.Popup,width:200},(0,je.jsx)(Pe.Z,{...l,children:(0,je.jsx)(Te.Z,{type:Te.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,je.jsx)(Re.Z,{...e}),items:dr(n,o,i,r)}],onAccept:t.close})})}class ur extends s.Z{constructor(){super(...arguments),this.handleAddItemClick=()=>{const{device:e}=this.environment;if(!ge.M_(this.environment))return;const{format:t,groupFormat:o,onAddItem:i,collectionContextStore:r,isFullScreen:n}=this.props;if("collectionTypedView"===r.contextType)return;const s=Boolean(t.collection_group_by);r.searchQuery.state&&de.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:n});const l=r.collectionStore(),a=r.groupsStore.getGroupState(o);if(!l||!a)return;const c=a.resultsStore;$.createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:this.environment,perform:t=>{const n=A.IW({environment:this.environment,collectionContextStore:r,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"board_group_header"});if(!n)return;const l=n.coercionSucceeded,a=n.newStore;if(e.isMobile){const e=(0,_o.ZP)({store:a,pageVisitSource:p.tY.Create});this.navigate(e)}else if(l&&!s){const e=a.getBlockTitleStore();K.eP({environment:this.environment,store:a}),U.NX({store:e}),de.Z5({store:a})}else ie.CH({environment:this.environment,store:a,peekMode:(0,re.kr)(r.collectionViewStore()),resultsStore:c,collectionContextStore:r,pageVisitSource:p.tY.Create});i&&i(a),ce.W(this.environment,{from:"board_group_add_item_top",type:"page",new_page_id:a.id,creating_block_id:a.id,...(0,pe.Pn)(r)})}})},this.colorStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o,collectionContextStore:i}=this.props;return(0,be.II)({environment:this.environment,groupFormat:e,schema:t,format:o,collectionContextStore:i,theme:this.theme})})),this.isHoveredStore=this.createComputedStore((()=>(0,te.ZH)(this.props.hoveredGroupStore.state,this.props.groupFormat)))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}renderComponent(){const{disabled:e,collectionContextStore:t}=this.props,o=t.permissionScopes.state,i=t.shouldAllowNewItemCreation();return(0,je.jsxs)("div",{style:this.getStyle(),onMouseMove:()=>{return e=this.props.hoveredGroupStore,t=this.props.groupFormat,void(e.state!==t&&e.setState(t));var e,t},children:[(0,je.jsx)(Sr,{boardGroupHeaderProps:this.props}),this.renderAggregation(),(0,je.jsx)("div",{style:{flexGrow:1}}),!e&&o.canConfigureBlock&&this.renderActionButton(),i&&this.renderAddButton()]})}renderAggregation(){const{disabled:e,query:t,schema:o,collectionContextStore:i,groupFormat:r}=this.props,n=t.aggregations?t.aggregations[0]:void 0,s=i.permissionScopes.state;return(0,je.jsx)(rr,{groupFormat:r,disabled:e||!s.canConfigureBlock,aggregation:n,schema:o,collectionContextStore:i,color:this.getTextColor(),onChange:e=>function(e,t,o,i){const r=t.collectionViewStore(),n={...o,aggregations:e?[e]:[]};r&&$.createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:i,perform:e=>{de.iG({collectionViewStore:r,update:{query2:n},transaction:e})}})}(e,this.props.collectionContextStore,this.props.query,this.environment)})}renderActionButton(){const{device:e}=this.environment;return(0,je.jsx)(Qe.ZP,{popupType:e.isMobile?Qe.Z4.SlideUp:Qe.Z4.Popup,renderOrigin:e=>(0,je.jsx)(Ft.Z,{icon:le.o,iconStyle:{fill:this.getTextColor()},style:this.getIconButtonStyle(),...e}),render:e=>(0,je.jsx)(gr,{parent:e,groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore})})}renderAddButton(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri,i=(0,or.sN)(o);return(0,je.jsx)(Je.ZP,{renderTooltip:()=>(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Create new {newItemName}",values:{newItemName:i},id:"database.boardView.actions.addNewItem.tooltip"}),render:e=>(0,je.jsx)(Ft.Z,{icon:ae.R,onClick:this.handleAddItemClick,style:this.getIconButtonStyle(),iconStyle:{fill:this.getTextColor()},...e})})}getStyle(){const{hidden:e,format:t,collectionContextStore:o}=this.props,{device:i}=this.environment,r=hr(t),n=this.colorStore.state,s=Boolean(t.collection_group_by),l=o.isCompactView.state,a=l?dn:ln,c=l?pn:an;return{display:"flex",alignItems:"center",fontSize:14,width:r,paddingLeft:a,paddingRight:a,marginRight:2*cn,marginBottom:e?4:0,boxSizing:"content-box",flexShrink:0,cursor:"pointer",...this.props.isPopup&&{padding:i.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:r},...n&&!e&&{backgroundColor:this.props.isInPeekRenderer?n.peekBackgroundColor:n.backgroundColor,...s?{borderRadius:c}:{borderTopLeftRadius:c,borderTopRightRadius:c}}}}getTextColor(){const e=this.colorStore.state;return!this.props.hidden&&e?e.textColor:this.theme.lightTextColor}getIconButtonStyle(){const{hidden:e}=this.props;if(!e)return{transition:"opacity 100ms ease-in-out",opacity:this.isHoveredStore.state?1:0}}}function hr(e){return(0,re.rD)(e.board_cover_size)}ur.displayName="BoardGroupHeader",ur.contextTypes={...li.wK,...s.w};const mr=ur;function gr(e){let{parent:t,groupFormat:o,currentGroups:i,format:r,schema:n,collectionContextStore:s}=e;const l=s.boardColumnsLimitStore;return(0,je.jsx)(_e,{parent:t,groupFormat:o,currentGroups:i,format:r,schema:n,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:l})}function Sr(e){let{boardGroupHeaderProps:t}=e;window.__c={n:"ValueComponent"};const{groupFormat:o,schema:i,disabled:r,currentGroups:n,format:s,groupBy:l,collectionContextStore:a}=t,d=(0,ne.O7)(),p=hr(s),u=(0,c.VK)((()=>a.permissionScopes.state),[a]);return(0,c.VK)((()=>a.groupsStore.getGroupState(o)),[a,o])?(0,je.jsx)(ct.Z,{groupBy:l,groupFormat:o,currentGroups:n,schema:i,disabled:r||!u.canConfigureBlock,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:i}=o,r=i.collectionStore();r&&(A.w$({...e,environment:t,groupsFormatKey:"board_columns",collectionStore:r,...o}),_.wd({environment:t,collectionContextStore:i,action:"rename_group"}))}(e,d,t),style:{maxWidth:p-70},collectionContextStore:a}):null}var fr=o(42853);function yr(e){window.__c={n:"CollectionHiddenGroupsButton"};const t=(0,c.VK)((()=>e.hiddenGroupsVisible.state),[e.hiddenGroupsVisible]);return(0,je.jsx)(Ye.Z,{onClick:function(){e.hiddenGroupsVisible.setState(!e.hiddenGroupsVisible.state)},onMouseDown:ue.$0,style:{height:30,marginBottom:4,...e.style},icon:e=>(0,fr.i)({...e,...t&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,je.jsx)(j.FormattedMessage,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}function vr(e){window.__c={n:"CollectionGroupsBoardHiddenGroupsButton"};const t=(0,c.VK)((()=>e.columnsDisplayState.visibleGroups.length*(hr(e.format)+2*ln+2*cn)),[e.columnsDisplayState.visibleGroups,e.format]);return(0,je.jsx)("div",{style:{display:"flex",minWidth:t},children:(0,je.jsx)(yr,{...e})})}function Cr(e){let{type:t,visibleGroups:o,hiddenGroups:i,total:r,groupsLimitStore:n,schema:s,collectionContextStore:l,style:a}=e;window.__c={n:"CollectionGroupsLoadMoreButton"};const d=(0,ne.O7)(),p=(0,ee.Fg)(),u=(0,c.VK)((()=>l.normalizedFormatStore.state),[l]),h=(0,c.VK)((()=>Ut({collectionContextStore:l,isForColumnGroups:"board"===t})),[l,t]),m=(0,c.VK)((()=>"board"===t?(0,be.II)({environment:d,groupFormat:void 0,schema:s,format:u,collectionContextStore:l,theme:p}):void 0),[l,d,u,s,p,t]),g=(0,ee.yK)((e=>({hovered:{background:e.whiteButtonBackground},dots:{width:14,fill:e.mediumTextColor,marginLeft:4,marginTop:1,..."default"===t?{marginRight:8}:{}},..."board"===t?{button:{background:null==m?void 0:m.backgroundColor,color:e.mediumTextColor,fontWeight:R.Z.fontWeight.medium,paddingLeft:8,paddingRight:8,height:33,marginRight:2*cn,borderRadius:an,width:90,...a}}:{}})),[m,a,t]),S=Math.min(be.kW,r-i.length-o.length);return"default"===t?(0,je.jsxs)(Ye.Z,{onClick:()=>function(e,t,o){o.setState(o.state+be.kW),t.loadingDetails.setState({type:"load_more_groups"}),_.tf(e)}(d,l,n),onMouseDown:ue.$0,disabled:h,hoveredStyle:h?g.hovered:{},style:{display:"flex",alignItems:"center",fontSize:14,borderRadius:4,height:30,marginTop:4,marginBottom:4,paddingLeft:2,paddingTop:2,paddingBottom:2,paddingRight:8,...a},children:[(0,le.o)(g.dots),(0,je.jsx)(j.FormattedMessage,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:S}}),h&&(0,je.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,je.jsx)(Ke.Z,{style:{width:12,height:12}})})]}):(0,je.jsxs)(Ye.Z,{onClick:()=>function(e,t,o){o.setState(o.state+be.kW),t.loadingDetails.setState({type:"load_more_columns"}),_.tf(e)}(d,l,n),onMouseDown:ue.$0,disabled:h,hoveredStyle:h?g.hovered:{},style:g.button,children:[(0,je.jsx)("span",{style:{flexGrow:1},children:(0,je.jsx)(j.FormattedMessage,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:S}})}),h?(0,je.jsx)("div",{style:{marginLeft:4},children:(0,je.jsx)(Ke.Z,{style:{width:12,height:12}})}):(0,le.o)(g.dots)]})}const xr=r.memo(Cr,Qt.Z);var br=o(65742);function wr(e){window.__c={n:"CollectionGroupsTimelineItemAddGroupButton"};const{format:t,isFullScreen:o,paddingLeft:i,isRootChild:r}=e,n=(0,ne.O7)(),s=(0,c.VK)((()=>(0,br.C1)({environment:n,format:t,isFullScreen:o,isRootChild:r})),[n,t,o,r]),l=(0,c.VK)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),a=(0,c.VK)((()=>(0,br.fj)({environment:n,isRootChild:r,isFullScreen:o,format:t})?br.Qw:i),[n,t,o,r,i]);return s||l?null:(0,je.jsx)("div",{style:{width:"100%",height:wn+kn,display:"flex"},children:(0,je.jsx)(Vn,{type:"default",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",left:e.isFullScreen?a:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function kr(e){window.__c={n:"CollectionGroupsTimelineItemHiddenGroupsButton"};const{format:t,isFullScreen:o,isRootChild:i,paddingLeft:r}=e,n=(0,ne.O7)(),s=(0,c.VK)((()=>(0,br.C1)({environment:n,format:t,isFullScreen:o,isRootChild:i})),[n,t,o,i]),l=(0,c.VK)((()=>(0,br.fj)({environment:n,isRootChild:i,isFullScreen:o,format:t})?br.Qw:r),[n,t,o,i,r]);return s?null:(0,je.jsx)("div",{style:{width:"100%",height:34,display:"flex"},children:(0,je.jsx)(yr,{...e,style:{position:"sticky",left:o?l:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Pr(e){window.__c={n:"CollectionGroupsTimelineItemLoadMoreButton"};const{format:t,isFullScreen:o,isRootChild:i}=e,r=(0,ne.O7)(),n=(0,c.VK)((()=>(0,br.C1)({environment:r,format:t,isFullScreen:o,isRootChild:i})),[r,t,o,i]),s=(0,c.VK)((()=>(0,br.fj)({environment:r,isRootChild:i,isFullScreen:o,format:t})?br.Qw:e.paddingLeft),[r,t,o,i,e.paddingLeft]);return n?null:(0,je.jsx)("div",{style:{width:"100%",height:38,display:"flex"},children:(0,je.jsx)(xr,{type:"default",visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:e.groupsLimitStore,schema:e.schema,collectionContextStore:e.collectionContextStore,style:{position:"sticky",left:o?s:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}var Tr=o(39192),Vr=o(36596);function Rr(){window.__c={n:"TableGroupShimmer"};const e=(0,ee.yK)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,je.jsxs)("div",{style:e.container,children:[(0,je.jsxs)("div",{style:e.groupContainer,children:[(0,je.jsx)("div",{style:e.iconContainer,children:(0,Tr.P)(e.icon)}),(0,je.jsx)(Vr.Z,{style:e.groupShimmer})]}),(0,je.jsxs)("div",{style:e.rowsContainer,children:[(0,je.jsxs)("div",{style:e.rowContainer,children:[(0,je.jsxs)("div",{style:e.firstColumn,children:[(0,je.jsx)(Vr.Z,{style:e.circleShimmer}),(0,je.jsx)(Vr.Z,{style:e.rowShimmerShort})]}),(0,je.jsx)("div",{style:e.column,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmerShort})}),(0,je.jsx)("div",{style:e.column,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmerShort})}),(0,je.jsx)("div",{style:e.column,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmerShort})})]}),(0,je.jsxs)("div",{style:e.rowContainer,children:[(0,je.jsxs)("div",{style:e.firstColumn,children:[(0,je.jsx)(Vr.Z,{style:e.circleShimmer}),(0,je.jsx)(Vr.Z,{style:e.rowShimmerLong})]}),(0,je.jsx)("div",{style:e.column,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmer})}),(0,je.jsx)("div",{style:e.column,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmer})}),(0,je.jsx)("div",{style:e.column,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmer})})]}),(0,je.jsxs)("div",{style:e.lastRowContainer,children:[(0,je.jsxs)("div",{style:e.firstColumn,children:[(0,je.jsx)(Vr.Z,{style:e.circleShimmer}),(0,je.jsx)(Vr.Z,{style:e.rowShimmerLong})]}),(0,je.jsx)("div",{style:e.column,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmer})}),(0,je.jsx)("div",{style:e.column,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmer})}),(0,je.jsx)("div",{style:e.column,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmer})})]})]})]})}function Mr(e){const{isFullScreen:t}=e,o=t?2:1,i=w.DZ(o,(e=>(0,je.jsx)(Rr,{},e)));return(0,je.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:i})}function jr(e){window.__c={n:"GalleryItemShimmer"};const t=e.minHeight||Xr,o=(0,ee.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,je.jsx)(Vr.Z,{style:o.card})}function Fr(e){window.__c={n:"GalleryGroupShimmer"};const{width:t}=e,o=(0,ne.O7)(),i=(0,c.VK)((()=>o.WindowSizeStore.state.width<=Yr),[o]),r=(0,ee.yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${i?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,i]);return(0,je.jsxs)("div",{style:r.container,children:[(0,je.jsxs)("div",{style:r.groupContainer,children:[(0,je.jsx)("div",{style:r.iconContainer,children:(0,Tr.P)(r.icon)}),(0,je.jsx)(Vr.Z,{style:r.groupShimmer})]}),(0,je.jsxs)("div",{style:r.itemsContainer,children:[(0,je.jsx)(jr,{}),(0,je.jsx)(jr,{}),(0,je.jsx)(jr,{})]})]})}function _r(e){const{isFullScreen:t,galleryCoverSize:o}=e,i=t?2:1,r=(0,re.rD)(o),n=w.DZ(i,(e=>(0,je.jsx)(Fr,{width:r},e)));return(0,je.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:n})}var Ir=o(66890);function Br(e){window.__c={n:"ListItemShimmer"};const{widthPercentage:t}=e,o=(0,Ir.DK)(),i=(0,c.VK)((()=>null==o?void 0:o.isCompactView.state),[o]),r=(0,ee.yK)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:i?12:16,height:i?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,i]);return(0,je.jsx)("div",{style:r.rowContainer,children:(0,je.jsxs)("div",{style:r.column,children:[(0,je.jsx)(Vr.Z,{style:r.circleShimmer}),(0,je.jsx)(Vr.Z,{style:r.rowShimmer})]})})}function Dr(){window.__c={n:"ListGroupShimmer"};const e=(0,ee.yK)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=["50%","30%","40%"].map(((e,t)=>(0,je.jsx)(Br,{widthPercentage:e},t)));return(0,je.jsxs)("div",{style:e.container,children:[(0,je.jsxs)("div",{style:e.groupContainer,children:[(0,je.jsx)("div",{style:e.iconContainer,children:(0,Tr.P)(e.icon)}),(0,je.jsx)(Vr.Z,{style:e.groupShimmer})]}),(0,je.jsx)("div",{style:e.rowsContainer,children:t})]})}function Ar(e){const{isFullScreen:t}=e,o=t?2:1,i=w.DZ(o,(e=>(0,je.jsx)(Dr,{},e)));return(0,je.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:i})}function Lr(){window.__c={n:"TimelineTableGroupsShimmer"};const e=(0,ee.yK)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,je.jsxs)("div",{style:e.rowsContainer,children:[(0,je.jsx)("div",{style:e.rowContainer,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmerShort})}),(0,je.jsx)("div",{style:e.rowContainer,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmer})})]})}function Zr(e){window.__c={n:"GroupsShimmer"};const{viewType:t,isFullScreen:o,galleryCoverSize:i}=e;if(!(0,si.Z)(!0,0,100))return null;switch(t){case"table":return(0,je.jsx)(Mr,{isFullScreen:o});case"list":return(0,je.jsx)(Ar,{isFullScreen:o});case"gallery":return(0,je.jsx)(_r,{isFullScreen:o,galleryCoverSize:i});case"timeline":return(0,je.jsx)(Lr,{});case"calendar":case"board":default:return null}}const Er=new Set(["timeline_dropzone_groups","timeline_table_groups"]),Or=new Set(["timeline_item_groups","timeline_table_groups"]),Gr=new Set(["timeline_table_groups"]);function Nr(e){window.__c={n:"CollectionGroupsFunctional"};const{collectionContextStore:t}=e,o=(0,ne.O7)(),i=(0,c.VK)((()=>t.collectionViewBlockStore()),[t]),n=(0,c.VK)((()=>t.permissionScopes.state),[t.permissionScopes]),s=(0,c.VK)((()=>t.normalizedFormatStore.state),[t.normalizedFormatStore]),l=(0,c.VK)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t]),a=null==s?void 0:s.app_config_uri,d=null==s?void 0:s.collection_group_by,p=null==s?void 0:s.board_columns_by,u=(0,c.VK)((()=>t.groupsLimit.state),[t]),h=(0,c.VK)((()=>t.boardColumnsLimitStore.state),[t]),m=(0,c.VK)((()=>t.normalizedSchemaStore.state),[t.normalizedSchemaStore]),g=(0,c.VK)((()=>{if(d)return(0,te.Qq)({schema:m,groupBy:d})}),[d,m]),S=(0,c.VK)((()=>t.relativeVariableStore.state),[t.relativeVariableStore]),f=(0,c.VK)((()=>t.remoteRequestStore.state),[t.remoteRequestStore]),y=(0,c.VK)((()=>{if(d&&s&&!Er.has(e.type))return(0,be.ej)({groupBy:d,schema:m,format:s,filter:null==f?void 0:f.loader.filter,groupsFormatKey:te.Uh,limit:u})}),[s,d,u,e.type,f,m]),v=(0,c.qz)(void 0,$i),C=(0,c.qz)(void 0,Wi),x=(0,c.VK)((()=>C.state),[C]),b=(0,c.SI)((()=>{if(!i)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const e=v.state,t=e?e.results:void 0,o=(0,be.Cz)({groupBy:d,schema:m,schemaGroups:g,formatGroups:(null==s?void 0:s[te.Uh])||[],reducerResults:t,getRecordModel:i.getRecordModel,relativeVariableResult:S,viewAppConfigUri:a}),r=o.filter((e=>!(0,te.eF)(e))).slice(0,u),n=o.filter((e=>(0,te.eF)(e))),l=e?e.total:0;return{currentGroups:[...r,...n],visibleGroups:r,hiddenGroups:n,total:l}}),[i,s,d,u,v,S,m,g,a],{useDeepEqual:!0}),w=(0,c.VK)((()=>b.state),[b]),k=(0,c.VK)((()=>{if(!i||!p)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const e=v.state,t=e?e.results:void 0,o=(0,be.Cz)({groupBy:d,schema:m,schemaGroups:g,formatGroups:(null==s?void 0:s.board_columns)||[],reducerResults:t,getRecordModel:i.getRecordModel,relativeVariableResult:S,viewAppConfigUri:a}),r=o.filter((e=>!(0,te.eF)(e))).slice(0,h),n=o.filter((e=>(0,te.eF)(e))),l=e?e.total:0;return{currentGroups:[...r,...n],visibleGroups:r,hiddenGroups:n,total:l}}),[h,i,s,d,p,v,S,m,g,a],{useDeepEqual:!0}),P=r.useCallback((()=>{s&&A.$D({environment:o,format:s,groupsFormatKey:te.Uh,collectionContextStore:t,currentGroups:b.state.currentGroups})}),[s,o,b,t]);r.useEffect((()=>{if(!Er.has(e.type))return b.addListener(P),()=>{b.removeListener(P)}}),[b,P,e.type]);const T=(0,c.VK)((()=>w.hiddenGroups.slice(0,be.ew)),[w.hiddenGroups]),V=(0,c.VK)((()=>!Or.has(e.type)&&Wt({collectionContextStore:t,displayState:w})),[t,w,e.type]),R=(0,c.VK)((()=>{const{visibleGroups:e}=w;return 0===e.length&&!t.shouldShowSpinner.state||e.length>0}),[t,w]),M=(0,c.VK)((()=>{const{total:e,hiddenGroups:o}=w;return u<e-o.length&&R||Ut({collectionContextStore:t,isForColumnGroups:!1})}),[R,t,w,u]),j=(0,c.VK)((()=>!e.disabled&&!n.isLocked&&n.canConfigureBlock&&!V&&d&&(0,te.Wz)(d,n.canConfigureCollection)&&"collectionTypedView"!==t.contextType&&!(0,Ht.wl)(d.property)&&R),[R,t,n.canConfigureBlock,n.canConfigureCollection,n.isLocked,e.disabled,d,V]);if(!s)return null;const F=(0,je.jsxs)("div",{style:{position:"relative"},children:[(0,je.jsx)(Hr,{groups:w.visibleGroups,groupBy:d,groupsDisplayState:w,format:s,schema:m,type:e.type,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem}),V&&(0,je.jsx)(Zr,{viewType:l,isFullScreen:e.isFullScreen,galleryCoverSize:s.gallery_cover_size}),M&&(0,je.jsx)(Kr,{type:e.type,collectionContextStore:e.collectionContextStore,schema:m,format:s,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:w}),T.length>0&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ur,{type:e.type,format:s,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,columnsDisplayState:k,hiddenGroups:T,hiddenGroupsVisible:C}),x&&(0,je.jsx)(Hr,{groups:T,groupBy:d,groupsDisplayState:w,format:s,schema:m,type:e.type,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem})]}),j&&(0,je.jsx)(Wr,{type:e.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:m,format:s,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:w,groupBy:d})]});return y?(0,je.jsx)(He.Z,{id:e.type,reducer:y,collectionContextStore:e.collectionContextStore,resultStore:v,render:()=>F}):F}const zr=r.memo(Nr,Qt.Z);function Hr(e){window.__c={n:"Groups"};const t=(0,c.VK)((()=>e.collectionContextStore.groupsStore.getGroupState),[e.collectionContextStore.groupsStore]),o=(0,c.VK)((()=>e.collectionContextStore.isInPeekRenderer.state),[e.collectionContextStore]);return(0,je.jsx)(je.Fragment,{children:e.groups.map(((i,r)=>t&&e.groupBy?(0,je.jsx)(tr,{collectionContextStore:e.collectionContextStore,groupsDisplayState:e.groupsDisplayState,groupFormat:i,groupBy:e.groupBy,disabled:e.disabled,groupsFormatKey:te.Uh,groupAggregationKey:te.dQ,format:e.format,schema:e.schema,isInPeekRenderer:o,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,getGroupStyle:e.getGroupStyle,ignoreAncestorStickyContainer:Gr.has(e.type),index:r,isLast:r===e.groups.length-1},(0,te.mD)(i)):null))})}function Kr(e){window.__c={n:"LoadMoreGroupsButton"};const t=(0,c.VK)((()=>e.collectionContextStore.groupsLimit),[e.collectionContextStore]);return"timeline_dropzone_groups"===e.type?null:"timeline_item_groups"===e.type?(0,je.jsx)(Pr,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:t,visibleGroups:e.groupsDisplayState.visibleGroups,hiddenGroups:e.groupsDisplayState.hiddenGroups,total:e.groupsDisplayState.total,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,je.jsx)("div",{style:{display:"flex"},children:(0,je.jsx)(xr,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:t,visibleGroups:e.groupsDisplayState.visibleGroups,hiddenGroups:e.groupsDisplayState.hiddenGroups,total:e.groupsDisplayState.total,style:e.stickyLeft?{position:"sticky",left:e.paddingLeft}:void 0})})}function Wr(e){window.__c={n:"AddGroupButton"};const t=(0,ne.O7)(),o=(0,c.VK)((()=>e.collectionContextStore.groupsLimit),[e.collectionContextStore]),i=r.useCallback(((e,t,o,i,r)=>{const n=o.collectionStore();n&&A.tH({update:e,collectionContextStore:o,groupsFormatKey:te.Uh,collectionStore:n,environment:t,groupBy:i,schema:r})}),[]);return"timeline_dropzone_groups"!==e.type&&e.groupBy?"timeline_item_groups"===e.type?(0,je.jsx)(wr,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,onAccept:o=>{e.groupBy&&i(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):(0,je.jsx)(Vn,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,paddingLeft:e.paddingLeft,stickyLeft:!0,onAccept:o=>{e.groupBy&&i(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):null}function Ur(e){return"board_collection_groups"===e.type?(0,je.jsx)(vr,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisible:e.hiddenGroupsVisible,format:e.format,columnsDisplayState:e.columnsDisplayState}):"timeline_dropzone_groups"===e.type?null:"timeline_item_groups"===e.type?(0,je.jsx)(kr,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisible:e.hiddenGroupsVisible,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,je.jsx)("div",{style:{display:"flex"},children:(0,je.jsx)(yr,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisible:e.hiddenGroupsVisible,style:{marginTop:10,...e.stickyLeft?{position:"sticky",left:e.paddingLeft}:{}}})})}var $r=o(43145),qr=o(17311);function Qr(e){window.__c={n:"GalleryShimmer"};const{hasPartialResults:t}=e;if(!(0,si.Z)(!0,0,100))return null;const o=e.coverHeight??qr.Z.card.desktop.medium.height,i=t?void 0:o+40,r=t?1:3,n=w.DZ(r,(e=>(0,je.jsx)(jr,{minHeight:i},e)));return(0,je.jsx)(je.Fragment,{children:n})}const Yr=480,Xr=40;class Jr extends s.Z{constructor(){super(...arguments),this.storeTypes={collectionGalleryViewStore:pi},this.selectableContainer=null,this.renderGroup=e=>{const{store:t,format:o,disabled:i,collectionContextStore:r,schema:n,blockPropertyValueOverlayStore:s,isFullScreen:l}=this.props,{collectionGalleryViewStore:a}=this.stores,c=this.isSingleColumnStore.state,d=this.isReady.state,p=e?[e]:[],u=r.groupsStore.getGroupState(p);if(!u)return;const h=u.reducerResultStore.state,m=void 0!==e,g=void 0!==h&&(null==h?void 0:h.blockIds.length)>0,S=Kt({collectionContextStore:r,groupsPointer:p,hasPartialResults:g}),f=re.VM({collectionContextStore:r,reducerResult:h,isFullScreen:l}),y=r.permissionScopes.state,v=y.isSyncedCollection,C=t.canEdit()&&("collectionTypedView"===r.contextType||y.canEditContent),x=d&&!i&&C&&!v&&(g||!S);return(0,je.jsxs)("div",{style:{paddingBottom:e?16:void 0},children:[(0,je.jsxs)("div",{style:this.getGroupWrapStyle(),children:[(0,je.jsx)(Ai,{collectionContextStore:r,groupFormat:e,format:o,schema:n,disabled:i,store:t,blockPropertyValueOverlayStore:s,collectionGalleryViewStore:a,isSingleColumn:c}),S&&(0,je.jsx)(Qr,{hasGroups:m,hasPartialResults:g,coverHeight:a.state.coverHeight}),x&&this.renderAddItemButton(p)]}),f&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,je.jsx)(zi,{groupsPointer:p,store:t,collectionContextStore:r,format:o,isFullScreen:l,incrementLimitsInRelatedGroups:!1})]})]})},this.handleResize=()=>{const{collectionGalleryViewStore:e}=this.stores,t=this.getGalleryCardCoverHeight(),o=this.getGalleryCardActualWidth();e.state.coverHeight!==t&&this.setCardCoverHeight(t),e.state.coverWidth!==o&&this.setCardCoverWidth(o)},this.handleResizeDebounced=(0,w.Ds)(this.handleResize,1e3),this.handleResizeThrottled=(0,w.P2)(this.handleResize,100),this.handleAddItemClick=(e,t)=>{if(!ge.M_(this.environment))return;const{collectionContextStore:o}=this.props,i=o.groupsStore.getGroupState(e);i&&$.createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:this.environment,perform:r=>{const{mainEditorCurrentBlockStore:n}=Do.default.state,s=A.IW({environment:this.environment,collectionContextStore:o,groupsPointer:e,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:r,from:"gallery",useCrdt:t});if(!s)return;const l=re.mb({store:s.newStore,mainEditorCurrentBlockStore:n,collectionContextStore:o})??(0,_o.ZP)({store:s.newStore,pageVisitSource:p.tY.Create});this.navigate(l),O.Xd({collectionContextStore:o,resultsStore:i.resultsStore}),ce.W(this.environment,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,pe.Pn)(o)})}})},this.onGroupHeaderAddItem=e=>{!function(e,t,o){t.device.isMobile?oe._({environment:t,store:e,pageVisitSource:p.tY.Create}):ie.CH({environment:t,store:e,peekMode:re.kr(o.collectionViewStore()),resultsStore:void 0,collectionContextStore:o,pageVisitSource:p.tY.Create})}(e,this.environment,this.props.collectionContextStore)},this.isSingleColumnStore=this.createComputedStore((()=>this.environment.WindowSizeStore.state.width<=Yr)),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}didUpdate(e){(e.format||{}).gallery_cover_size!==(this.props.format||{}).gallery_cover_size&&(this.setCardCoverHeight(),this.setCardCoverWidth())}didMount(){this.setCardCoverWidth(),this.setCardCoverHeight(),(0,ai.lj)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,ai.lj)(window,"orientationchange",this.handleResizeDebounced)}willUnmount(){(0,ai.ZV)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,ai.ZV)(window,"orientationchange",this.handleResizeDebounced)}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:i,paddingRight:r,isFullScreen:n,collectionContextStore:s}=this.props,l=re.az(s,n),a=t.collection_group_by,c=s.isCompactView.state;return(0,ci.Z)((t=>(0,je.jsxs)("div",{style:{paddingBottom:o,paddingLeft:i,paddingRight:r,minWidth:this.props.minWidth},className:eo.sbt,children:[(0,je.jsx)(_t.Z,{store:e,shouldShowHalo:!n&&!c,canSelect:!n,analyticsName:"gallery",...t,ref:e=>this.selectableContainer=e,children:a?this.renderGroups(a):this.renderGroup(void 0)}),!l&&(0,je.jsx)($r.Z,{onChange:e=>function(e,t,o,i){var r;const n=o.isLoading.state,s=null===(r=function(e){var t;return null===(t=e.groupsStore.getGroupState([]))||void 0===t?void 0:t.reducerResultStore}(o))||void 0===r?void 0:r.state;e<oo.Z.incrementScrollOffset&&s&&!n&&null!=s&&s.hasMore&&A.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})))}renderGroups(e){const{store:t,format:o,collectionContextStore:i,schema:r,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,be.hJ)()?(0,je.jsx)(zr,{type:"gallery_groups",store:t,collectionContextStore:i,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderGroup,getGroupStyle:e=>on(e,this.theme),renderHeader:e=>(0,je.jsx)(rn,{args:e}),onGroupHeaderAddItem:this.onGroupHeaderAddItem}):(0,je.jsx)(Mn,{store:t,id:"gallery_groups",groupBy:e,groupsFormatKey:te.Uh,groupAggregationKey:te.dQ,format:o,schema:r,collectionContextStore:i,disabled:n,isFullScreen:s,renderGroup:this.renderGroup,onGroupHeaderAddItem:this.onGroupHeaderAddItem,renderHeader:e=>(0,je.jsx)(rn,{args:e}),getGroupStyle:e=>on(e,this.theme),paddingLeft:l,isRootChild:a,isInPeekRenderer:c})}renderAddItemButton(e){return(0,je.jsx)(xo.Z,{onClick:t=>this.handleAddItemClick(e,(0,io.SL)(t,"collection_non_table_view")),onMouseDown:ue.$0,style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,borderRadius:4,boxShadow:"dark"===this.theme.mode?`${this.theme.darkDividerColor} 0px 0px 0px 1px inset`:`${this.theme.regularDividerColor} 0px 0px 0px 1px inset`,minHeight:Xr},children:(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:-6},children:[(0,ae.R)((t=this.theme,{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor})),(0,je.jsx)("div",{style:{color:this.theme.lightIconColor},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.galleryView.addItemButtonTitle"})})]})});var t}setCardCoverHeight(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverHeight:e||this.getGalleryCardCoverHeight()})}setCardCoverWidth(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverWidth:e||tn(this.props.format)})}getGalleryCardActualWidth(){if(this.selectableContainer){const e=this.selectableContainer.getNode();if(e){const t=e.querySelector(`.${eo.K4T}`);if(t)return t.offsetWidth}}return tn(this.props.format)}getGalleryCardCoverHeight(){return this.getGalleryCardActualWidth()*(9/16)}getGroupWrapStyle(){const e=this.props.format.collection_group_by,t=this.isSingleColumnStore.state,o=this.props.collectionContextStore.isCompactView.state;return{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${t?"100%":`${tn(this.props.format)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:e?1:16,paddingBottom:4,...o?{paddingLeft:8,paddingRight:8}:{}}}}Jr.displayName="CollectionGalleryView",Jr.contextTypes={...li.wK,...s.w};const en=Jr;function tn(e){const t=e.gallery_cover_size;return re.rD(t)}function on(e,t){return 0===e.index?{}:{borderTop:`1px solid ${t.tableDividerColor}`}}function rn(e){let{args:t}=e;window.__c={n:"GroupHeaderComponent"};const o=(0,ee.Fg)(),i=(0,c.VK)((()=>t.collectionContextStore.isCompactView.state),[t.collectionContextStore]);return(0,je.jsx)(Dt,{...t,height:i?to.yZ:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,o)})}function nn(e){window.__c={n:"BoardItemShimmer"};const t=e.minHeight||Xr,o=(0,ee.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,je.jsx)(Vr.Z,{style:o.card})}function sn(){window.__c={n:"BoardShimmer"};return(0,si.Z)(!0,0,100)?(0,je.jsx)(nn,{}):null}const ln=5,an=5,cn=5,dn=8,pn=8;function un(e,t){return t?0:e?8:12}class hn extends s.Z{constructor(){super(...arguments),this.isReady=this.createComputedStore((()=>{const{groupsPointer:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);return Boolean(null==o?void 0:o.reducerResultStore.state)})),this.colorStore=this.createComputedStore((()=>{const{groupsPointer:e,schema:t,format:o,collectionContextStore:i}=this.props,r=w.Z$(e);return(0,be.II)({environment:this.environment,groupFormat:r,schema:t,format:o,collectionContextStore:i,theme:this.theme})}))}renderComponent(){var e;const{store:t,groupsPointer:o,collectionContextStore:i,disabled:r,format:n,schema:s,blockPropertyValueOverlayStore:l,isFullScreen:a,anyGroupHasResults:c}=this.props,d=i.groupsStore.getGroupState(o);if(!d)return;const p=this.isReady.state,u=function(e){return e?e.board_cover:void 0}(this.props.format),h=(0,re.az)(i,a),m=d.reducerResultStore.state,g=i.permissionScopes.state,S=!r&&p&&i.shouldAllowNewItemCreation(),f=!r&&!g.isSyncedCollection,y=(0,re.VM)({reducerResult:m,collectionContextStore:i,isFullScreen:a}),v=Boolean(n.collection_group_by),C=!c&&v&&Kt({collectionContextStore:i,groupsPointer:o,hasPartialResults:c}),x=c&&i.shouldShowSpinner.state&&"load_general"===i.loadingDetails.state.type;return(0,je.jsxs)("div",{style:this.getStyle(),onMouseDown:e=>function(e,t){const{device:o}=t,{target:i}=e;!o.isMobile&&i instanceof HTMLElement&&(0,ue.ZP)({event:e,context:ue.Af.EditorMouseDown,callback:()=>{e.preventDefault(),G.AI({environment:t,target:i,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onClick:vn,className:eo.GfL,onMouseMove:()=>function(e,t){const o=w.Z$(e);o&&t.state!==o&&t.setState(o)}(this.props.groupsPointer,this.props.hoveredGroupStore),children:[(0,je.jsx)(Ii,{collectionContextStore:i,groupsPointer:o,format:n,canDrag:f,onSelectableEnter:e=>Cn(e,this.props.groupsPointer,this.props.collectionContextStore,this.props.isFullScreen,this.environment),resultProps:{format:n,schema:s,onTextEnter:e=>function(e,t,o,i,r,n){if(!ge.M_(n)||!o.collectionStore())return xn(e,o,r,t,n);const s=yn(t,o);if(!s)return;const l=s.state.findIndex((t=>t===e))+1;$.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:n,perform:e=>{Jt({transaction:e,environment:n,collectionContextStore:o,isFullScreen:i,groupsPointer:t,insertAtIndex:l,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}})}(e,this.props.groupsPointer,this.props.collectionContextStore,this.props.isFullScreen,this.props.store,this.environment),onShiftEnter:e=>Cn(e,this.props.groupsPointer,this.props.collectionContextStore,this.props.isFullScreen,this.environment),coverFormat:u,coverAspectFormat:gn(this.props.format),coverSizeFormat:Sn(this.props.format),shouldShowTitle:to.K8(this.props.format,"board"),colorStyle:this.colorStore.state,onTextEsc:e=>xn(e,this.props.collectionContextStore,this.props.store,this.props.groupsPointer,this.environment),disabled:r,blockPropertyValueOverlayStore:l,collectionContextStore:i},canDrop:!0,resultComponent:ni,disabled:r,direction:Fi.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:v?ln:3,analyticsName:"board",loadContentCover:u&&"page_content"===u.type}),C&&(0,je.jsx)(sn,{}),y&&(0,je.jsx)(zi,{groupsPointer:o,store:t,collectionContextStore:i,format:n,isFullScreen:a,incrementLimitsInRelatedGroups:!0}),S&&(0,je.jsxs)(je.Fragment,{children:[y&&(0,je.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,je.jsx)(ro,{groupsPointer:o,collectionContextStore:i,isFullScreen:a,color:null===(e=this.colorStore.state)||void 0===e?void 0:e.textColor,shouldShowSpinner:x})]}),!h&&(0,je.jsx)($r.Z,{onChange:e=>function(e,t,o,i,r){const n=t.isLoading.state,s=t.groupsStore.getGroupState(i),l=null==s?void 0:s.reducerResultStore.state;e<oo.Z.incrementScrollOffset&&!n&&l&&l.hasMore&&(A.ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:l.blockIds.length,groupsPointer:i,incrementLimitsInRelatedGroups:!1}}),t.loadingDetails.setState({type:"load_general"}))}(e,this.props.collectionContextStore,this.props.isFullScreen,this.props.groupsPointer,this.environment)})]})}getStyle(){const{format:e,collectionContextStore:t}=this.props,o=this.isReady.state,i=this.colorStore.state,r=Boolean(e.collection_group_by),n=t.isCompactView.state,s=n?dn:ln,l=n?pn:an;return{flex:"none",paddingLeft:s,paddingRight:s,paddingBottom:s,marginRight:2*cn,boxSizing:"content-box",width:fn(this.props.format),height:r?void 0:"max-content",...i&&o&&{backgroundColor:this.props.isInPeekRenderer?i.peekBackgroundColor:i.backgroundColor,...r?{borderRadius:l}:{borderBottomLeftRadius:l,borderBottomRightRadius:l}}}}}hn.displayName="BoardGroupResults";const mn=(0,j.injectIntl)(hn);function gn(e){return e?e.board_cover_aspect:void 0}function Sn(e){return e?e.board_cover_size:void 0}function fn(e){const t=e.board_cover_size;return(0,re.rD)(t)}function yn(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function vn(e){(0,ue.ZP)({event:e,context:ue.Af.EditorClick,callback:()=>{}})}function Cn(e,t,o,i,r){const{blocks:n,transaction:s}=e;if(0===n.length)return;const l=n[0];if(!ge.M_(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation())return;const a=yn(t,o);if(!a)return;Jt({transaction:s,environment:r,collectionContextStore:o,isFullScreen:i,groupsPointer:t,insertAtIndex:a.state.findIndex((e=>e===l))+1,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}function xn(e,t,o,i,r){const n=t.collectionStore(),s=e.getTitleStore();if(!s)return;if(Xt.QaF(s.getValue()))K.Ys({environment:r,store:e});else if(n){const n=yn(i,t);if(!n)return;const s=n.state.findIndex((t=>t===e))-1,l=t.collectionViewStore(),a=t.collectionViewBlockStore();if(l&&a&&F.sG(r,{...(0,pe.Pn)(t),block_id:o.id}),$.createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:r,perform:t=>{A.Od({store:e,transaction:t})}}),s>=0){const e=n.state[s];K.Ys({environment:r,store:e})}}}var bn=o(68500);const wn=28,kn=4,Pn=(0,j.defineMessages)({iconAriaLabel:{defaultMessage:"Add a group",id:"database.collectionAddGroupButton.ariaLabel"}});function Tn(e){let{type:t,style:o,groupBy:i,currentGroups:n,schema:s,groupsLimitStore:l,collectionContextStore:a,parentStore:d,onAccept:p,paddingLeft:u,stickyLeft:h}=e;window.__c={n:"CollectionAddGroupButton"};const m=(0,ne.O7)(),g=(0,ee.Fg)(),S=(0,c.qz)(void 0,Yt.Z),f=s[i.property],y=(0,c.VK)((()=>(0,be.II)({environment:m,groupFormat:void 0,schema:s,format:a.normalizedFormatStore.state,collectionContextStore:a,theme:g})),[a,m,s,g]),v=(0,ee.yK)((e=>({plusIcon:{fill:e.mediumTextColor},iconButton:{width:35,background:null==y?void 0:y.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:ln,paddingBottom:ln,marginRight:cn,borderRadius:an,height:33,...o}})),[y,o]),C=(0,r.useCallback)((e=>{!function(e){let{schema:t,groupBy:o,currentGroups:i,groupsLimitStore:r,collectionContextStore:n,onAccept:s,environment:l,buttonPopupStore:a,update:c}=e;const{newGroupValue:d}=c,p=t[o.property],u=r.state;if(!p||!(0,te.LG)(p))return;if(_.wd({environment:l,collectionContextStore:n,action:"board_add_group"}),a.reset(),Se.cu(p)){if(p.type!==d.type)return;if(void 0===d.value)return;const e=p.options||[],r={id:(0,qt.ZP)(),value:d.value,color:(0,Se.TL)(e)},n=[...e,r],l={...p,options:n},a={...t,[o.property]:l},c={property:o.property,value:d,hidden:!1};return void s({newGroups:(0,be.nr)(i,c,u),newSchema:a})}if("person"===p.type||"relation"===p.type||(0,te.HB)(p.type)){const e={property:o.property,value:d,hidden:!1};return void s({newGroups:(0,be.nr)(i,e,u),newPage:c.newPage})}if((0,te.A1)(p.type)||"status"===p.type||"number"===p.type||"created_by"===p.type||"last_edited_by"===p.type||"formula"===p.type||"checkbox"===p.type||"location"===p.type)return;(0,dt.t1)(p.type)}({schema:s,groupBy:i,currentGroups:n,groupsLimitStore:l,collectionContextStore:a,onAccept:p,environment:m,buttonPopupStore:S,update:e})}),[S,a,n,m,i,l,p,s]),x=(0,r.useCallback)((()=>{!function(e){e.reset()}(S)}),[S]),b=(0,r.useCallback)((()=>(0,je.jsx)(bn.Z,{groupFormat:void 0,groupBy:i,currentGroups:n,schema:s,onChange:C,onClose:x,parentStore:d})),[n,i,C,x,d,s]);return f&&(0,te.LG)(f)?(0,je.jsx)(Qe.ZP,{render:b,buttonPopupStore:S,popupType:m.device.isMobile?Qe.Z4.SlideUp:Qe.Z4.Popup,renderOrigin:e=>"default"===t?(0,je.jsx)(Ye.Z,{isLightGray:!0,icon:ae.R,style:{display:"flex",height:wn,marginTop:12,marginBottom:kn,width:"max-content",position:h?"sticky":void 0,left:h&&u?u:0,...o},...e,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"})}):(0,je.jsx)(Ft.Z,{ariaLabel:Ne.default.formatMessage(Pn.iconAriaLabel),icon:e=>(0,ae.R)({...e,...v.plusIcon}),style:v.iconButton,...e})}):null}const Vn=r.memo(Tn,Qt.Z);class Rn extends s.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:d.default.createClass(void 0),hiddenGroupsVisible:d.default.createClass(!1)},this.renderResult=e=>{var t,o,i;const{disabled:r,collectionContextStore:n,groupBy:s,isFullScreen:l,shouldSurpressShimmer:a,format:c}=this.props,d=n.groupsLimit.state,p=e.hiddenGroups.slice(0,be.ew),u=n.permissionScopes.state,h=!a&&Wt({collectionContextStore:n,displayState:e}),m=null===(t=n.collectionViewStore())||void 0===t?void 0:t.getType(),{visibleGroups:g,hiddenGroups:S,total:f}=e,y=0===g.length&&!n.shouldShowSpinner.state||g.length>0,v=d<f-S.length&&y||Ut({collectionContextStore:n,isForColumnGroups:!1}),C=!r&&!u.isLocked&&u.canConfigureBlock&&!h&&(0,te.Wz)(s,u.canConfigureCollection)&&"collectionTypedView"!==n.contextType&&!(0,Ht.wl)(s.property)&&y,x=null===(o=(i=this.props).renderGroupsLoadMoreButton)||void 0===o?void 0:o.call(i,{visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:this.props.collectionContextStore.groupsLimit,type:"default",schema:this.props.schema,collectionContextStore:n});return(0,je.jsxs)("div",{style:{position:"relative"},children:[this.renderGroups(e.visibleGroups),h&&(0,je.jsx)(Zr,{viewType:m,isFullScreen:l,galleryCoverSize:c.gallery_cover_size}),v&&(0,je.jsx)(jn,{loadMoreButtonOverride:x,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,displayState:e,style:this.props.stickyLeft?{position:"sticky",left:this.props.paddingLeft}:void 0}),p.length>0&&(0,je.jsxs)(je.Fragment,{children:[this.renderHiddenGroupsButton(p),this.stores.hiddenGroupsVisible.state&&this.renderGroups(p)]}),C&&this.renderAddGroupButton()]})},this.renderGroup=(e,t,o)=>{const{renderGroup:i,disabled:r,groupsFormatKey:n,groupAggregationKey:s,format:l,schema:a,collectionContextStore:c,isFullScreen:d,onGroupHeaderAddItem:p,renderHeader:u,getGroupStyle:h,stickyLeft:m,ignoreAncestorStickyContainer:g,paddingLeft:S,isRootChild:f,groupBy:y,isInPeekRenderer:v}=this.props,C=t===o.length-1;if(c.groupsStore.getGroupState(e))return(0,je.jsx)(tr,{groupBy:y,groupFormat:e,groupsDisplayState:this.groupsDisplayStateStore.state,disabled:r,groupsFormatKey:n,groupAggregationKey:s,format:l,schema:a,collectionContextStore:c,isFullScreen:d,isRootChild:f,renderGroup:i,onGroupHeaderAddItem:p,renderHeader:u,getGroupStyle:h,stickyLeft:m,ignoreAncestorStickyContainer:g,paddingLeft:S,index:t,isLast:C,isInPeekRenderer:v},(0,te.mD)(e))},this.handleGroupsChange=()=>{const{format:e,groupsFormatKey:t,collectionContextStore:o}=this.props,i=this.groupsDisplayStateStore.state.currentGroups;A.$D({environment:this.environment,format:e,groupsFormatKey:t,collectionContextStore:o,currentGroups:i})},this.handleGroupsChangeDebounced=w.Ds(this.handleGroupsChange,5e3),this.reducerStore=this.createComputedStore((()=>{const{groupBy:e,disableReducerRequest:t,schema:o,format:i,groupsFormatKey:r,collectionContextStore:n}=this.props,s=n.remoteRequestStore.state;if(!t)return(0,be.ej)({groupBy:e,schema:o,format:i,filter:null==s?void 0:s.loader.filter,groupsFormatKey:r,limit:n.groupsLimit.state})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{schema:e,groupBy:t}=this.props;return(0,te.Qq)({schema:e,groupBy:t})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupBy:t,groupsFormatKey:o,format:i,schema:r,collectionContextStore:n}=this.props,s=n.groupsLimit.state,l=n.collectionViewBlockStore();if(!l)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const a=this.schemaGroupsStore.state,c=this.stores.reducerResultStore.state,d=c?c.results:void 0,p=c?c.total:0,u=(0,be.Cz)({groupBy:t,schema:r,formatGroups:i[o]||[],schemaGroups:a,reducerResults:d,getRecordModel:l.getRecordModel,relativeVariableResult:n.relativeVariableStore.state,viewAppConfigUri:null===(e=n.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),h=u.filter((e=>!(0,te.eF)(e))).slice(0,s),m=u.filter((e=>(0,te.eF)(e)));return{currentGroups:[...h,...m],visibleGroups:h,hiddenGroups:m,total:p}}),!0)}UNSAFE_willMount(e){const{disableReducerRequest:t}=this.props;t||this.groupsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.groupsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}renderComponent(){const e=this.reducerStore.state,t=this.groupsDisplayStateStore.state;return e?(0,je.jsx)(He.Z,{id:this.props.id,reducer:e,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderResult(t)}):this.renderResult(t)}renderGroups(e){return e.map(this.renderGroup)}renderHiddenGroupsButton(e){const{renderHiddenGroupsButton:t}=this.props;return t?t({hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e}):(0,je.jsx)("div",{style:{display:"flex"},children:(0,je.jsx)(yr,{style:{marginTop:10,...this.props.stickyLeft?{position:"sticky",left:this.props.paddingLeft}:{}},hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e})})}renderAddGroupButton(){const{schema:e,groupBy:t,renderAddGroupButton:o,collectionContextStore:i,paddingLeft:r}=this.props,n=this.groupsDisplayStateStore.state.currentGroups;return o?o({groupBy:t,schema:e,currentGroups:n,onAccept:e=>Fn(e,this.environment,this.props.collectionContextStore,this.props.groupsFormatKey,this.props.groupBy,this.props.schema),groupsLimitStore:i.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:i}):(0,je.jsx)(Vn,{groupBy:t,schema:e,currentGroups:n,onAccept:e=>Fn(e,this.environment,this.props.collectionContextStore,this.props.groupsFormatKey,this.props.groupBy,this.props.schema),groupsLimitStore:i.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:i,paddingLeft:r,stickyLeft:!0})}}Rn.displayName="CollectionGroups";const Mn=Rn;function jn(e){let{displayState:t,loadMoreButtonOverride:o,collectionContextStore:i,schema:r,style:n}=e;const{groupsLimit:s}=i;return o?(0,je.jsx)(je.Fragment,{children:o}):(0,je.jsx)("div",{style:{display:"flex"},children:(0,je.jsx)(xr,{visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:s,type:"default",schema:r,collectionContextStore:i,style:n})})}function Fn(e,t,o,i,r,n){const s=o.collectionStore();s&&A.tH({update:e,collectionContextStore:o,groupsFormatKey:i,collectionStore:s,environment:t,groupBy:r,schema:n})}class _n extends d.default{getInitialState(){return{}}}const In=_n;var Bn=o(1742);function Dn(e){window.__c={n:"CollectionNestedCreateSubitemButton"};const t=(0,ne.O7)(),{store:o,collectionContextStore:i,disabled:n,groupsPointer:s,collectionStore:l,subitemPath:a,indentLevel:d,onSubitemCreate:p}=e,u=(0,c.VK)((()=>(0,re.fk)({environment:t,collectionContextStore:i})),[i,t]),h=(0,c.VK)((()=>{var e;return"timeline"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())}),[i]),m=(0,c.VK)((()=>{var e;return"title"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[i]),g=(0,c.VK)((()=>(0,yi.f2)({columnIndex:0,titleColumnIndex:0,shouldShowBulkActionsToolbar:u,indentLevel:d+1,isSubitemToggleOnTitleColumn:m})),[d,m,u]),S=(0,ee.yK)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:g,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...h&&{borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:g+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[g,h,e.styles]),f=(0,c.VK)((()=>{const e=i.permissionScopes.state,t=l.isSyncedCollection();return!n&&e.canEditContent&&!t}),[i,n,l]),y=(0,r.useCallback)((()=>{$.createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,perform:e=>{const r=A.yk({environment:t,collectionContextStore:i,groupsPointer:s,store:o,before:!1,collectionStore:l,transaction:e,subitemPath:a,subitemInsertDirection:"into",from:"cvb_new_subitem"});r&&p(r)}}),F.JE(t,{...(0,pe.Pn)(i)})}),[i,t,s,l,o,a,p]);return f?(0,je.jsx)(xo.Z,{onClick:y,onMouseDown:ue.$0,style:S.newRowButton,children:(0,je.jsxs)("span",{style:S.newRowContainer,children:[(0,ae.R)(S.newIcon),(0,je.jsx)("span",{style:S.newText,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})}):null}var An=o(73959),Ln=o(73819),Zn=o(68709),En=o(97180),On=o(23063),Gn=o(3072),Nn=o(29376),zn=o(4023);function Hn(e){window.__c={n:"TableAggregation"};const{disabled:t,property:o,schema:i,collectionContextStore:n,groupFormat:s,isHovered:l,aggregation:a,onChange:d}=e,p=(0,ne.O7)(),u=(0,j.useIntl)(),{isMobile:h}=(0,ne.Fy)(),[m,g]=(0,r.useState)(void 0),S=(0,c.VK)((()=>{if(!a)return;return{type:"aggregation",filter:s?(0,Ze.zk)({schema:i,propertyMapping:void 0,group:s,timeZone:(0,Ee.r)()}):void 0,aggregation:a}}),[i,s,a]),f=(0,r.useCallback)((e=>{if(e){const t={aggregator:e,property:o};d(o,t),g(t),F.wd(p,{view_type:"table",action:"table_change_aggregation"}),Li.j({name:"collection_change_aggregation"})}else d(o,void 0),F.wd(p,{view_type:"table",action:"table_remove_aggregation"})}),[p,d,o]),y=(0,ee.yK)((()=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto"}})),[]),v=(0,c.VK)((()=>We(n,a)),[n,a]);return(0,r.useEffect)((()=>{m&&!We(n,m)&&(0,w.Xy)(a,m)&&g(void 0)}),[v,m,n,a]),(0,je.jsx)(Qe.ZP,{popupType:h?Qe.Z4.SlideUp:Qe.Z4.Popup,disabled:t,renderOrigin:e=>S?(0,je.jsx)(He.Z,{id:`table:${(0,te.mD)(s)}:${o}:${S.aggregation.aggregator}`,collectionContextStore:n,reducer:S,groupsPointer:s?[s]:void 0,render:r=>(0,je.jsx)(Je.ZP,{alignment:zn.v.End,disableTooltip:!v,renderTooltip:()=>u.formatMessage($e.aggregationCalculating),render:n=>(0,je.jsx)(xo.Z,{disabled:t,style:y.buttonStyle,...(0,ze.Z)(n,e),children:(0,je.jsx)(Kn,{resultStore:r,aggregation:a,schema:i,property:o})})})}):(0,je.jsx)(xo.Z,{disabled:t,style:y.buttonStyle,...e,children:(0,je.jsx)(Wn,{disabled:t,isHovered:l})}),render:e=>{let{close:t}=e;return(0,je.jsx)(Gn.Z,{property:o,schema:i,onChange:f,onClose:t,source:"tableAggregation"})}})}function Kn(e){window.__c={n:"TableAggregationButtonContent"};const{aggregation:t,resultStore:o,schema:i,property:n}=e,s=(0,Ir.Y$)(),l=(0,ee.yK)((e=>({valueStyle:{display:"flex",alignItems:"center",height:"100%",fontSize:14},aggregationTypeNameStyle:{fontSize:10,textTransform:"uppercase",letterSpacing:1,color:e.mediumTextColor,marginTop:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}})),[]),a=(0,c.VK)((()=>o.state),[o]),d=(0,r.useMemo)((()=>{if(!t)return;let e=Ge.v6[(0,Le.OV)(t)];return(0,Le.en)(t.aggregator)&&(e=t.aggregator.groupName in En.ZA?En.ZA[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),p=i[n],u=(0,c.VK)((()=>{if(p&&("formula"===p.type||"number"===p.type))return p.number_format;if("rollup"===(null==p?void 0:p.type)&&p.relation_property&&p.target_property&&"number"===p.target_property_type){if(i[p.relation_property]){var e;const t=(0,Nn.ny)(s,i[p.relation_property]),o=null==t||null===(e=t.getModel())||void 0===e?void 0:e.getNormalizedSchema(),r=null==o?void 0:o[p.target_property];if("number"===(null==r?void 0:r.type))return r.number_format}}}),[p,i,s]);return d?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("span",{style:l.aggregationTypeNameStyle,children:d},"type"),(0,je.jsx)("span",{style:l.valueStyle,children:t&&(0,je.jsx)(Ue,{aggregation:t,collectionContextStore:s,children:a?(0,Ge.Ol)({numberFormat:u,dateFormat:void 0,aggregationType:t.aggregator,value:null==a?void 0:a.aggregationResult,userTimeZone:(0,Ee.r)(),roundDecimal:5}):void 0})},"value")]}):null}function Wn(e){let{disabled:t,isHovered:o}=e;window.__c={n:"TableAggregationCalculatePlaceholder"};const i=(0,ee.yK)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{marginBottom:2,color:e.lightTextColor},chevronIcon:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),{isMobile:r}=(0,ne.Fy)();return t||!o&&!r?null:(0,je.jsx)(On.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>(0,je.jsxs)("div",{style:i.placeholderWrapper,children:[(0,je.jsx)("span",{style:i.placeholderText,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),(0,fr.i)(i.chevronIcon)]})})}const Un=r.memo((function(e){let{collectionContextStore:t,disabled:o,groupFormat:i,isFullScreen:n,isInPeekRenderer:s,query:l,schema:a,showHoverActionsStore:d,showPropertyFormats:p,showRightActionsSpacer:u,style:h}=e;window.__c={n:"TableAggregationRow"};const m=(0,ne.O7)(),g=(0,ee.Fg)(),[S,f]=(0,r.useState)(!1),y=(0,c.VK)((()=>t.frozoneStore.state.frozenIndex),[t.frozoneStore]),{unfrozenIndexAddendum:v,frozenPropertyFormats:C,unfrozenPropertyFormats:x}=(0,c.VK)((()=>{const e=p;let t=[],o=e;const i=(0,re.bW)(y);return void 0!==y&&(t=e.slice(0,i),o=e.slice(i)),{unfrozenIndexAddendum:i,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[y,p]),b=(0,c.VK)((()=>t.isCompactView.state),[t]),w=(0,c.VK)((()=>{var e;return{display:"flex",position:"absolute",background:b?void 0:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(s?g.cardContentBackground:g.contentBackground),zIndex:M.RJ,fontSize:14,height:ra+(n?bt.Z.state:0)+1,minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,...h}}),[t,n,s,h,g,b]),k=(0,c.VK)((()=>void 0!==y&&(0,yi.oc)({environment:m,collectionContextStore:t,isPhone:m.device.isPhone,theme:g})),[y,m,t,g]),P=(0,r.useCallback)((()=>{f(!0)}),[f]),T=(0,r.useCallback)((()=>{f(!1)}),[f]),V=(0,r.useCallback)((e=>e?{borderTop:`1px solid ${g.tableDividerColor}`}:{borderTop:void 0}),[g]);function R(e,r){return(0,je.jsx)($n,{propertyFormat:e,index:r,groupFormat:i,disabled:o,mouseEntered:S,showHoverActionsStore:d,collectionContextStore:t,schema:a,query:l},e.property)}return(0,je.jsx)(jt,{position:b?ht.IGNORE:ht.Bottom,getComputedStyle:V,children:(0,je.jsx)(Zn.p,{allowSelectionWithin:!1,style:w,onMouseMove:P,onMouseLeave:T,onMouseDown:Qn,children:(0,je.jsx)("div",{style:{display:"flex",paddingRight:!o&&u?32:0},children:(0,je.jsxs)("div",{style:{display:"flex"},children:[void 0!==y&&(0,je.jsx)("div",{style:{...k,display:"flex"},children:C.map(R)}),x.map(((e,t)=>R(e,t+v)))]})})})})}),Qt.Z),$n=r.memo((function(e){var t;let{propertyFormat:o,index:i,groupFormat:n,disabled:s,mouseEntered:l,showHoverActionsStore:a,collectionContextStore:d,query:p,schema:u}=e;window.__c={n:"TableAggregationWrapper"};const h=(0,ne.O7)(),m=(0,c.VK)((()=>(0,re.fk)({environment:h,collectionContextStore:d})),[h,d]),g=(0,c.VK)((()=>a.state),[a]),S=(0,r.useCallback)(((e,t)=>{const o=d.collectionViewStore();if(!o)return;let i=p.aggregations?[...p.aggregations]:[];const r=(p.aggregations||[]).findIndex((t=>t.property===e));i=r<0?w.oA([...i,t]):w.oA(i.map(((e,o)=>r===o?t:e)));const n={...p,aggregations:i};!d.isClientModeEnabled.state&&t&&d.asyncAggregationStatus.setState({calculating:!0,aggregation:t,changingType:!0}),$.createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:h,perform:e=>{de.iG({collectionViewStore:o,update:{query2:n},transaction:e})}})}),[d,p,h]);return(0,je.jsx)("div",{style:{display:"flex",width:void 0!==o.width?o.width+(0===i&&m?yi.Xx:0):void 0},children:(0,je.jsx)(Hn,{groupFormat:n,disabled:s,isHovered:(l||0===i&&!n&&g)&&!s,aggregation:null===(t=p.aggregations)||void 0===t?void 0:t.find((e=>e.property===o.property)),property:o.property,collectionContextStore:d,schema:u,onChange:S})})})),qn=Un;function Qn(e){(0,ue.ZP)({event:e,context:ue.Af.EditorMouseDown,callback:()=>{}})}function Yn(e){window.__c={n:"TableEmptyPlaceholder"};const{collectionContextStore:t,shouldShowAddRowButton:o,paddingLeft:i,handleAddRowClick:r}=e,n=(0,c.VK)((()=>Boolean(t.currentCombinatorFilterStore.state||t.currentPropertyFiltersStore.state.length>0)),[t]),s=(0,ee.yK)((e=>({button:{display:"flex",alignItems:"center",height:ia+1,width:"100%",paddingLeft:na,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:e.contentBackground,left:0,right:0,textAlign:"center",borderBottom:`1px solid ${e.tableDividerColor}`},buttonInner:{color:e.lightTextColor,position:"sticky",left:i+na}})),[i]);return(0,je.jsx)(xo.Z,{className:eo.Gcz,onClick:r,onMouseDown:ue.$0,disabled:!o,style:s.button,children:o?(0,je.jsx)("span",{style:s.buttonInner,children:n?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,je.jsx)("span",{style:s.buttonInner,children:n?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})}var Xn=o(46283),Jn=o(87085),es=o(73060),ts=o(79131),os=o(25962),is=o(84939);function rs(e){window.__c={n:"FrozenColumnDivider"};const{passesFilter:t,isScrolled:o,isCheckbox:i,isShimmerRow:n}=e,s=(0,r.useCallback)((e=>"dark"===e.mode?"transparent":t?`linear-gradient(to right, ${(0,is.Fq)(fe.se[e.mode].gray,.15)},\n\t\t\t\t${(0,is.Fq)(fe.se[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,is.Fq)(fe.se[e.mode].gray,.35)},\n\t\t\t\t${(0,is.Fq)(fe.se[e.mode].gray,.2)},  transparent)`),[t]),l=(0,ee.yK)((e=>({border:{position:"absolute",top:-1,right:0,width:2,height:n?35:"calc(100% + 2px)",background:t?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-3,width:3,height:n?34:"100%",background:s(e)}})),[n,t,s]);return(0,je.jsxs)(je.Fragment,{children:[i&&!o?null:(0,je.jsx)("div",{style:l.border}),(0,je.jsx)(On.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,je.jsx)("div",{style:l.shadow})})]})}function ns(e){window.__c={n:"MultiSelectCheckbox"};const{checkedState:t,onClick:o,checkboxType:i,collectionContextStore:n,passesFilter:s,disabled:l,frozoneProps:a}=e,d=(0,ne.O7)(),p=(0,c.qz)(void 0,Mo.Z),u=(0,c.VK)((()=>p.state.mouseEntered),[p]),h=(0,r.useRef)(null);(0,r.useEffect)((()=>{h.current&&(h.current.indeterminate="indeterminate"===t)}),[t]);const m=(0,c.VK)((()=>Pi.ZP.state.isDragging),[]),g=(0,r.useCallback)((e=>{l||(o(e),_.Ac({environment:d,collectionContextStore:n,checkbox_type:i}))}),[l,i,n,d,o]),S=(0,c.VK)((()=>!1===t&&!u||m?null!=a&&a.shouldShowStickyMultiSelectColumn?.4:0:1),[t,m,u,null==a?void 0:a.shouldShowStickyMultiSelectColumn]),f=(0,ee.yK)((e=>({multiSelectCheckbox:{background:null==a?void 0:a.frozenStyles.background,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=a&&a.isCollectionViewBlockSelected?fe.ZP.blueWithAlpha(.14):void 0,height:"100%"}})),[null==a?void 0:a.frozenStyles.background,null==a?void 0:a.isCollectionViewBlockSelected]);return(0,je.jsx)(On.Z,{isVisible:!0,animationStyle:{opacity:S>0?1:0},render:()=>(0,je.jsxs)("div",{style:f.multiSelectCheckbox,onMouseEnter:()=>{p.enter()},onMouseLeave:()=>{p.exit()},children:[(0,je.jsx)("div",{style:f.multiSelectCheckboxInner,children:(0,je.jsx)(On.Z,{isVisible:!0,animationStyle:{opacity:S},render:()=>(0,je.jsx)("label",{style:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:l?void 0:"pointer",zIndex:1},onClick:ue.Wi,onMouseDown:ue.$0,children:(0,je.jsx)("div",{style:{width:`${yi.bu}px`,height:yi.bu-1+"px",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,je.jsx)("input",{type:"checkbox",style:{width:yi.tA,height:yi.tA,cursor:l?void 0:"pointer",position:"relative",right:"2px"},ref:h,checked:!0===t,onChange:g,disabled:l})})})})}),(null==a?void 0:a.shouldFreezeMultiSelectColumn)&&(0,je.jsx)(rs,{passesFilter:s,isCheckbox:!0,isScrolled:!0})]})})}var ss=o(18514),ls=o(81415),as=o(84169);function cs(e){window.__c={n:"LearnMoreLink"};const{href:t,style:o}=e,i=(0,ee.yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return(0,je.jsxs)("a",{href:t,target:"_blank",style:{...i.default,...o},children:[(0,as.m)({width:14,marginRight:4}),(0,je.jsx)(j.FormattedMessage,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}var ds=o(71424);function ps(e){window.__c={n:"WikiPropertiesOnboardingTooltip"};const{origin:t,propertyType:o}=e,i=(0,ne.O7)();return(0,je.jsx)(ls.U,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,je.jsx)(j.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,je.jsx)(j.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,je.jsx)(j.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,dt.t1)(o)}}(),content:function(){switch(o){case"owner":return(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,je.jsx)("span",{style:{fontWeight:R.Z.fontWeight.semibold},children:e})}});case"verification":return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,je.jsx)(cs,{href:(0,ss.UY)("guides.wikis"),style:{color:fe.ZP.uiLightGray}})]});case"tags":return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,je.jsx)(cs,{href:(0,ss.UY)("guides.databaseProperties"),style:{color:fe.ZP.uiLightGray}})]});default:(0,dt.t1)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,dt.t1)(o)}}(),onCloseClick:()=>{es.nX(i)},onPrimaryButtonClick:()=>es.Rg(i),onBackButtonClick:()=>es.FO(i),shouldDismissUponOutsideClick:!0,pointerLength:ds.EZ,pointerOffset:ds.FD,style:{width:ds.G5}})}class us extends d.default{getInitialState(){return{}}}const hs=us;var ms=o(33125),gs=o(34078),Ss=o(74817),fs=o(97820),ys=o(43224),vs=o(19124),Cs=o(67695),xs=o(39068),bs=o(79362),ws=o(8597),ks=o(88437),Ps=o(44643),Ts=o(44495),Vs=o(16184),Rs=o(20669),Ms=o(4635),js=o(23903),Fs=o(79310),_s=o(59753),Is=o(34993),Bs=o(16956),Ds=o(80402),As=o(44866),Ls=o(34517),Zs=o(17095),Es=o(27871),Os=o(71214),Gs=o(30905),Ns=o(28992),zs=o(74420),Hs=o(86825),Ks=o(42402),Ws=o(83212);class Us extends s.Z{constructor(){super(...arguments),this.storeTypes={propertyTypeButtonPopupStore:Yt.Z,inputStore:d.default.createClass(""),showPropertyDescriptionStore:d.default.createClass(!1)},this.handlePropertyNameSubmit=e=>{if(this.shouldShowDuplicateError())return;const{property:t,collectionContextStore:o}=this.props,i=o.collectionStore();if(!i)return;const r=i.getSchema()[t];(null==r?void 0:r.name)!==e&&($.createAndCommit({userAction:"TableHeaderCell.handlePropertyNameSubmit",environment:this.environment,perform:o=>{Bs.Bv({collectionStore:i,property:t,name:e,transaction:o})}}),_.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"rename"}))},this.isRightmostFrozen=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.frozoneStore.state.frozenIndex;return Boolean(this.props.columnIndex===t)})),this.canFreezeThisColumn=this.createComputedStore((()=>{const{collectionContextStore:e,columnIndex:t}=this.props,{frozenIndex:o,scrollerWidth:i}=e.frozoneStore.state,r=this.props.collectionContextStore.collectionViewStore();if(void 0===o)return!1;return t>((null==r?void 0:r.getTableMaxFrozenColumnIndex(i,e.normalizedFormatStore.state))??-1)}))}UNSAFE_willMountOrUpdate(e){const{property:t,schema:o,collectionContextStore:i}=e,r=o[t];if(r&&"relation"===r.type){const e=Nn.ny(i,r);null==e||e.load()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:we.og.ActionSheet}:{menuType:we.og.Popup,minWidth:220};const o=this.getMenuSections(this.props.parent);return(0,je.jsx)(Pe.Z,{...t,children:(0,je.jsx)(Te.Z,{type:Te.i.Vertical,initialFocus:void 0,sections:w.oA(o.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,je.jsx)(Re.Z,{...e,topBorder:0!==t}),items:e}})))})})}shouldShowDuplicateError(){const{property:e,schema:t}=this.props,{inputStore:o}=this.stores,i=o.state,r=Object.keys(t).find((o=>{var r;return o!==e&&(null===(r=t[o])||void 0===r?void 0:r.name)===i}));return Boolean(r)}getMenuSections(e){var t;const{property:o,schema:i,collectionContextStore:r,formatKey:n,allowHidingTitle:s,format:l,intl:a}=this.props,{environment:c,theme:d}=this,{device:p}=c,u=i[o],h=r.permissionScopes.state,m=r.isCompactView.state,g=r.settingsStore,S=r.collectionViewStore(),y=r.collectionStore();if(!S||!u)return[];const v=(0,Ht.wl)(o),C=Boolean((null===(t=qs(this.props.format,this.props.formatKey,this.props.property))||void 0===t?void 0:t.wrap)||S.getFormat().table_wrap)&&"timeline"!==S.getType(),x=r.databaseType,b=Boolean(y&&x&&Q.cR((0,Ls.appConfigs)(),x,o,y)),k="title"===u.type,P=[];if(v&&"person"===u.type){const e=[];P.push(e),e.push({key:"synced_person",render:e=>(0,je.jsx)(Ns.Z,{...e,title:u.name||"",icon:(0,Ts.D)({width:14}),caption:(0,je.jsx)("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",minWidth:300,maxWidth:350},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"People synced from external sources may require additional set up. Visit <helpcenterlink>the help center</helpcenterlink> for more information.",id:"database.tableHeaderCell.syncedPersonPropertyCaption",values:{helpcenterlink:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,je.jsx)(Ks.Z,{href:(0,ss.UY)("guides.syncedContent"),children:t})}}})})}),action:()=>{}})}if(h.canConfigureCollection&&!v){const t=[],i=Boolean(this.stores.showPropertyDescriptionStore.state);if(P.push(t),t.push({key:"rename",render:t=>(0,je.jsxs)(Re.Z,{children:[(0,je.jsx)(Os.I,{...t,initialValue:u.name||"",placeholder:Ne.default.formatMessage(Ss.sY.inputPlaceholder),focusInitial:!0,inputStore:this.stores.inputStore,onBlur:this.handlePropertyNameSubmit,onSubmit:t=>{this.handlePropertyNameSubmit(t),e.close()},iconButton:{icon:e=>(0,je.jsx)(xs.ZP,{type:u.type,icon:u.icon,size:16,theme:d,style:e}),iconStyle:{fill:bs.Lr[d.mode].gray},enforceIconColor:"gray",onSubmit:(e,t)=>function(e,t,o,i,r){const n=t.collectionStore();if(!n)return;$.createAndCommit({userAction:"TableHeaderCell.handlePropertyIconSubmit",environment:o,perform:t=>{Bs.OK({collectionStore:n,property:e,icon:i,transaction:t})}}),_.$q({environment:o,collectionContextStore:t,property:e,icon:i,from:"table",action:"change_icon"})}(this.props.property,this.props.collectionContextStore,this.environment,e)},inputRightButton:(0,je.jsx)(Zs.l,{description:u.description,showTooltip:!i,onClick:()=>this.stores.showPropertyDescriptionStore.setState(!i),addDescriptionText:a.formatMessage(ys.aB.addPropertyDescriptionTooltip),editDescriptionText:a.formatMessage(ys.aB.editPropertyDescriptionTooltip)})}),this.shouldShowDuplicateError()&&(0,je.jsx)(Ss.mJ,{propertyName:this.stores.inputStore.state,styles:p.isMobile?{paddingBottom:5,paddingLeft:16,paddingRight:16,margin:0,boxShadow:`inset 0 -1px 0 ${d.regularDividerColor}`}:{}})]}),action:()=>{_.wd({environment:this.environment,collectionContextStore:r,action:"table_header_rename"}),de.n1({collectionContextStore:r}),e.close()}}),i&&t.push({key:"description",render:e=>(0,je.jsx)(Re.Z,{...e,desktopStyle:{paddingTop:0},title:p.isMobile?a.formatMessage(Es.k.descriptionHeader):void 0,children:(0,je.jsx)(Es.i,{initialDescription:u.description,handleSaveDescription:e=>function(e,t,o,i){var r;const n=o.collectionStore(),s=null==n||null===(r=n.getSchema())||void 0===r?void 0:r[i];if(!n||void 0===s||e===s.description)return;$.createAndCommit({userAction:"CollectionSettingsProperty.handleDescriptionChange",environment:t,perform:o=>{de.xO({environment:t,collectionStore:n,update:{[i]:{...s,description:e}},transaction:o})}}),_.$q({environment:t,collectionContextStore:o,property:i,from:"view_properties",action:"set_description"})}(e,this.environment,this.props.collectionContextStore,this.props.property),disableAutoSection:!0})}),action:w.ZT}),t.push({key:"edit_property",render:e=>(0,je.jsx)(Je.ZP,{placement:Je.ug.Left,render:t=>(0,je.jsx)(qe.Z,{disabled:void 0===y,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:(0,Ms.W)({width:14}),...(0,ze.Z)(e,t)}),style:{whiteSpace:"normal"},renderTooltip:()=>(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{y&&(_.wd({environment:this.environment,collectionContextStore:r,action:"table_header_edit"}),de.n1({collectionContextStore:r}),e.close(),L.r$({collectionContextStore:r,collectionSettingsStore:g}),L.H4({collectionSettingsStore:g,item:{type:"properties",timelineViewTab:"table"}}),L.H4({collectionSettingsStore:g,item:{type:"property",formatKey:n,property:o}}))}}),y&&(0,vs.Zt)(this.environment)&&(0,Se.qQ)(u)&&("text"===u.type||(0,vs.KZ)())){const i=(0,Se.q3)(u),s=no.De(y.getFormat(),o),l=s.isRunning||!y||!(0,vs.mX)(c,Ws.Z.getMode(c,y),y);i?t.push({key:"fill_all_pages",render:e=>(0,je.jsx)(Je.ZP,{placement:Je.ug.Left,renderTooltip:()=>(0,je.jsx)(Gs.qQ,{collectionStore:y,propertySchema:u}),render:t=>(0,je.jsx)(qe.Z,{titleStyle:{color:l?d.lightTextColor:void 0},disabled:l,icon:(0,je.jsx)(Gs.Xh,{updateAiInferencesTaskStatus:s,iconStyle:{marginLeft:-1,marginRight:-1},progressIconStyle:{marginTop:4,marginLeft:0,marginRight:-3}}),title:(0,je.jsx)(Gs.ZP,{updateAiInferencesTaskStatus:s}),caption:void 0!==s.numPagesFilled&&void 0!==s.numPagesRequested&&(0,je.jsx)(Gs.Y7,{updateAiInferencesTaskStatus:s}),...(0,ze.Z)(e,t)})}),action:async()=>{await As.autofillPropertyForCollection({environment:c,collectionStore:y,propertySchema:u,property:o})}}):t.push({key:"autofill_with_ai",render:e=>(0,je.jsx)(qe.Z,{disabled:void 0===y,title:(0,je.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Set up AI autofill",id:"database.tableHeaderCell.autofillWithAI"}),(0,je.jsx)(zs.Z,{style:{display:"inline-block"}})]}),icon:(0,Rs.y)({width:14,fill:d.aiPurpleColor}),...e}),action:()=>{y&&(e.close(),L.r$({collectionContextStore:r,collectionSettingsStore:g}),L.H4({collectionSettingsStore:g,item:{type:"properties",timelineViewTab:"table"}}),L.H4({collectionSettingsStore:g,item:{type:"property",formatKey:n,property:o}}),"text"===u.type&&L.H4({collectionSettingsStore:g,item:{type:"propertyAiAutofill",propertySchema:u,property:o}}))}})}}if(h.canConfigureBlock&&((0,Ht.bA)(u)||(0,Ht.Kf)(u))){const t=[];P.push(t),(0,Ht.bA)(u)&&(t.push({key:"sort_asc",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Sort ascending",id:"database.tableHeaderCell.sortAscending"}),icon:(0,ws.Z)({width:14})}),action:()=>{_.wd({environment:this.environment,collectionContextStore:r,action:"table_header_sort_asc"}),e.close(),function(e,t,o,i){$s(!0,e,t,o,i)}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment)}}),t.push({key:"sort_desc",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Sort descending",id:"database.tableHeaderCell.sortDescending"}),icon:(0,Si.M)({width:14})}),action:()=>{_.wd({environment:this.environment,collectionContextStore:r,action:"table_header_sort_desc"}),e.close(),function(e,t,o,i){$s(!1,e,t,o,i)}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment)}})),(0,Ht.Kf)(u)&&t.push({key:"filter",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Filter",id:"database.tableHeaderCell.filter"}),icon:(0,f.Q)({width:14})}),action:()=>{"collectionVirtualView"!==r.contextType&&(_.wd({environment:this.environment,collectionContextStore:r,action:"table_header_filter"}),e.close(),function(e,t,o,i){const r=t.currentPropertyFiltersStore.state,n=t.collectionViewBlockStore(),s=(null==n?void 0:n.getRecordModel)??_s.om.constant(void 0);let l=r.find((t=>{let{filter:o}=t;return o.property===e}));if(!l){const n=(0,vi.H_)({property:e,schema:o,getRecordModel:s});if(!n)return;const a={id:(0,qt.ZP)(),filter:n};t.filtersBarOpen.setState(!0),Is.iU({environment:i,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:[...r,a]}}}),l=a}if(!l)return;const a=t.getFilterBarItemSettingsStore(l);L.wl({collectionSettingsStore:a,item:{type:"filter"}}),de.n1({collectionContextStore:t})}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment))}})}const T=[];if(P.push(T),(s||"title"!==u.type)&&h.canConfigureBlock&&T.push({key:"hide",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Hide in view",id:"database.tableHeaderCell.hideInView"}),icon:(0,Ps.L)({width:22,marginLeft:-4,marginRight:-4})}),action:()=>{_.wd({environment:this.environment,collectionContextStore:r,action:"table_header_hide"}),e.close(),function(e,t,o,i,r,n){const s=e.collectionViewStore();if(!s)return;const l=(o[i]||[]).map((e=>e.property===t?{...e,visible:!1}:e)),a={...o,[i]:l};$.createAndCommit({userAction:"TableHeaderCell.updatePropertyFormat",environment:n,perform:t=>{de.iG({collectionViewStore:s,update:{format:a},transaction:t}),Ds.oz({environment:n,collectionContextStore:e,currentIndex:r,entrypoint:"TableHeaderCell",transaction:t,propertyAction:"hide"})}})}(this.props.collectionContextStore,this.props.property,this.props.format,this.props.formatKey,this.props.columnIndex,this.environment)}}),h.canConfigureBlock&&!m){const e=this.canFreezeThisColumn.state;T.push({key:"freeze_column",render:t=>(0,je.jsx)(Je.ZP,{placement:Je.ug.Left,disableTooltip:!e,renderTooltip:e=>(0,je.jsx)(j.FormattedMessage,{...e,defaultMessage:"Insufficient space to freeze columns",id:"database.tableHeaderCell.freezePropertyTooltip",description:"If the width of the frozen columns is wider than the screen, show the user this tooltip warning."}),render:o=>(0,je.jsx)(qe.Z,{...t,...o,disabled:e,buttonStyle:{color:e?this.theme.text.quaternary:void 0},title:this.isRightmostFrozen.state?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"{numberFrozenColumns, plural, one {Unfreeze column} other {Unfreeze columns}}",values:{numberFrozenColumns:this.props.columnIndex+1},id:"database.tableHeaderCell.unfreezeColumns"}):(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Freeze up to column",id:"database.tableHeaderCell.freezeUpToColumn"}),icon:this.isRightmostFrozen.state?(0,Fs.A)({width:14}):(0,js.P)({width:12,margin:"0px 1px"})})}),action:()=>{!function(e,t,o){$.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:o,perform:i=>{Ds.oz({environment:o,collectionContextStore:e,currentIndex:t,transaction:i,entrypoint:"TableHeaderCell",propertyAction:"toggle"})}})}(this.props.collectionContextStore,this.props.columnIndex,this.environment)}})}if(!to.Tr.includes(u.type)||(0,Se.dx)(u)||!h.canConfigureCollection||v||k||T.push({key:"duplicate",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.tableHeaderCell.duplicateProperty"}),icon:(0,ks.a)({width:14})}),action:async()=>{_.wd({environment:this.environment,collectionContextStore:r,action:"table_header_duplicate"}),e.close(),await async function(e,t,o,i,r,n){const s=qs(r,o,e),l=t.collectionStore(),a=t.collectionViewStore(),c=t.normalizedFormatStore.state[o]||[],d=null==l?void 0:l.getSpaceId();if(!(l&&a&&d&&s))return;const p=l.getSchema(),u=p[e];if(!u)return;const h=await(0,re.xy)({environment:n,schema:p,property:e,properties:c,parentStore:l,spaceId:d});if(!h)return;$.createAndCommit({userAction:"TableHeaderCell.handleDuplicate",environment:n,perform:e=>{de.xO({environment:n,collectionStore:l,update:{[h.newProperty]:h.newPropertySchema},transaction:e}),Ds.oz({environment:n,collectionContextStore:t,currentIndex:i,entrypoint:"TableHeaderCell",transaction:e,propertyAction:"duplicate"}),h.automationUpdate&&de.Ki({environment:n,collectionStore:l,update:h.automationUpdate,transaction:e}),o&&uo.FH({stores:[a],update:{[o]:h.newProperties},transaction:e})}}),_.wd({environment:n,collectionContextStore:t,action:"duplicate_property",original_view_type:null==a?void 0:a.getType(),property_type:u.type})}(this.props.property,this.props.collectionContextStore,this.props.formatKey,this.props.columnIndex,this.props.format,this.environment)}}),to.Tr.includes(u.type)&&h.canConfigureCollection&&!v&&!k&&T.push({key:"delete",render:e=>(0,je.jsx)(Je.ZP,{placement:Je.ug.Left,disableTooltip:!b,renderTooltip:e=>(0,or.A7)(x,e),render:t=>(0,je.jsx)(qe.Z,{...e,...t,disabled:b,disabledFeedback:b,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),caption:this.environment.device.isMobile&&b?(0,or.A7)(x):null,icon:b?(0,je.jsx)("div",{...t,children:(0,Vs.Q)({width:14})}):(0,Ce.y)({width:14})})}),action:async()=>{e.close(),await async function(e,t,o,i,r,n){await Bs.TI({environment:r,collectionContextStore:e,property:t,handleDeleteAccept:()=>function(e,t,o,i,r){const n=o.collectionStore();if(!n)return;const s=n.getSchema()[e];$.createAndCommitAsync({environment:r,userAction:"TableHeaderCell.handleDeleteAccept",waitForServerCommit:!1,perform:async s=>{await Bs.yV({environment:r,collectionStore:n,schema:t,property:e,transaction:s}),Ds.oz({environment:r,collectionContextStore:o,currentIndex:i,entrypoint:"TableHeaderCell",transaction:s,propertyAction:"delete"})}}),s&&_.y9({environment:r,collectionContextStore:o,property_type:s.type,from:"table_column",property:e})}(t,o,e,i,r),theme:n,from:"table_column"})}(this.props.collectionContextStore,this.props.property,this.props.schema,this.props.columnIndex,this.environment,this.theme)}}),h.canConfigureBlock&&"timeline"!==S.getType()){const e=[];P.push(e),e.push({key:"wrap_cell",render:e=>(0,je.jsx)(Hs.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Wrap column",id:"database.tableHeaderCell.wrapColumn"}),on:C}),action:()=>{Ds.K4({currentValue:C,environment:this.environment,property:o,collectionViewStore:S,format:l,formatKey:n}),_.wd({environment:this.environment,collectionContextStore:r,action:"table_header_wrap_column"})}})}return P}}function $s(e,t,o,i,r){if(!i[t])return;const n=[{property:t,direction:e?"ascending":"descending"}];o.filtersBarOpen.setState(!0),Is.iU({environment:r,collectionContextStore:o,temporaryState:{...o.temporaryState.state,sorts:{value:n}}}),de.n1({collectionContextStore:o})}function qs(e,t,o){var i;return null===(i=e[t])||void 0===i?void 0:i.find((e=>e.property===o))}Us.displayName="TableHeaderCellMenu";const Qs=(0,j.injectIntl)(Us);const Ys={fontSize:14},Xs=r.memo((function(e){let{allowHidingTitle:t,collectionContextStore:o,columnIndex:i,disableCellRightBorder:n,disabled:s,format:l,formatKey:a,isLast:d,paddingTop:p,property:u,renderSpacer:h,schema:m,width:g}=e;const S=(0,r.useRef)(null);(0,ms.c)(Cs.Z,(()=>({collectionContextStore:o,property:u,getNode:()=>S.current})),[o,u]);const f=(0,ne.O7)(),y=(0,ne.Fy)(),[v,C]=(0,r.useState)(!1),x=(0,c.VK)((()=>o.permissionScopes.state),[o.permissionScopes]),b=(0,c.qz)(void 0,Yt.Z),{isRightMostFrozenColumn:w,isScrolled:k}=(0,c.VK)((()=>{const{frozenIndex:e,isScrolled:t}=o.frozoneStore.state;return{isRightMostFrozenColumn:e===i,isScrolled:t}}),[o.frozoneStore,i]),P=(0,ee.yK)((e=>({div:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:g,borderRight:n?void 0:`1px solid ${e.tableDividerColor}`},description:{color:e.mediumInvertedTextColor},aiUpdate:{color:e.mediumInvertedTextColor}})),[g,n]),T=(0,r.useCallback)((()=>{U.ZH(f),K.ZH(f),de.wG()}),[f]),V=(0,r.useCallback)((e=>{y.isMobile||(e.preventDefault(),(0,ue.ZP)({event:e,context:ue.Af.EditorContextMenu,callback:()=>{T(),b.setState({open:!0})}}))}),[y,b,T]),R=(0,r.useCallback)((e=>{C(e)}),[C]),M=m[u];return M?(0,je.jsx)("div",{ref:S,style:P.div,className:eo.VMO,onContextMenu:V,children:(0,je.jsx)(Qe.ZP,{popupType:y.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,disabled:!x.canConfigureBlock,originGap:1,alignmentToOrigin:Qe.vR.Start,buttonPopupStore:b,renderOrigin:e=>(0,je.jsx)(Je.ZP,{renderTooltip:e=>{const t=(0,Se.qQ)(M)&&("text"===M.type||(0,vs.KZ)())&&(0,Se.q3)(M);return(0,je.jsxs)("div",{...e,style:ys.F6,children:[(0,je.jsx)("div",{children:M.name}),void 0!==(null==M?void 0:M.description)&&M.description.length>0?(0,je.jsx)("div",{style:P.description,children:M.description}):null,t&&t.auto_update_on_edit&&(0,je.jsx)("div",{style:P.aiUpdate,children:(0,je.jsx)(j.FormattedMessage,{...Ss.sY.keptUpToDateWithNotionAITooltip})})]})},delayThreshold:v?0:500,placement:Je.ug.Right,render:t=>{var o;return(0,je.jsxs)(xo.Z,{style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:p},disabled:s,...(0,ze.Z)(t,e),children:[h&&h(d),(0,je.jsx)(fs.Z,{propertySchema:M,showIcon:!0,badge:(0,je.jsxs)(je.Fragment,{children:[!(null===(o=M.description)||void 0===o||!o.length)&&!y.isMobile&&(0,je.jsx)(gs.Z,{setIsHovered:R}),(0,je.jsx)(fs.o,{propertySchema:M})]}),style:Ys,property:u}),w&&(0,je.jsx)(rs,{passesFilter:!0,isScrolled:Boolean(k)})]})}}),render:e=>(0,je.jsx)(Qs,{allowHidingTitle:t,collectionContextStore:o,columnIndex:i,format:l,formatKey:a,property:u,schema:m,parent:e}),onClick:T})}):null}));var Js=o(35011),el=o(6685),tl=o(58299);const ol={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1};class il extends s.Z{constructor(){super(...arguments),this.resizeStartLeftFormat=void 0,this.storeTypes={mouseStore:Mo.Z,resultStore:d.default.createClass(void 0)},this.handleDragStart=e=>{e.preventDefault(),this.resizeStartLeftFormat=this.props.leftFormat,this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!0})},this.handleDragMove=e=>{const t=this.getNewFormat(e);t&&this.props.onTemporaryResize(t)},this.handleDragEnd=e=>{const t=this.getNewFormat(e);t&&this.props.onAccept(t),this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1})},this.handleDragCancel=()=>{this.props.onCancel(),this.resizeStartLeftFormat=void 0,this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1})},this.handleDoubleClick=()=>{const e=this.stores.resultStore.state?this.stores.resultStore.state.blockIds:[],t=w.oA(e.map((e=>{const t=tl.Z.findBlockPropertyValueByBlockId(e,this.props.leftFormat.property),o=null==t?void 0:t.getNode();if(o)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const i=getComputedStyle(e);for(let s=0;s<i.length;s++){const e=i[s],o=i.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const r=t.querySelectorAll("*");for(const s of r)s.style&&(s.style.pointerEvents="none",s.style.width="auto");document.body.appendChild(t);const n=t.getBoundingClientRect();return t.remove(),null!=n&&n.width?Math.ceil(n.width)+1:void 0}(o)})));if(this.props.leftFormat.width){const e={...this.props.leftFormat,width:Math.min(800,Math.max(Math.max(...t),nl(this.props.propertySchema,this.props.leftFormat)))};this.props.onAccept(e)}}}renderComponent(){const{device:e}=this.environment,{mouseEntered:t,mousePressed:o}=this.stores.mouseStore.state,i=(o||t)&&!e.isPhone;return(0,je.jsx)("div",{style:ol,onMouseMove:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}),onMouseLeave:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1}),children:(0,je.jsx)(el.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>{return(0,je.jsx)("div",{style:i?(t=this.props.height,{...sl(t),background:fe.ZP.blueWithAlpha(.8)}):sl(this.props.height),onDoubleClick:this.handleDoubleClick,...e});var t}})})}getNewFormat(e){if(this.resizeStartLeftFormat&&this.resizeStartLeftFormat.width){const t=Math.max(this.resizeStartLeftFormat.width+e.diffX,nl(this.props.propertySchema,this.props.leftFormat));return{...this.resizeStartLeftFormat,width:t}}}}il.displayName="TableHeaderResizer";const rl=il;function nl(e,t){if("checkbox"===(null==e?void 0:e.type)||"status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return 32;var o;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,Js.mm)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return 32;return"auto_increment_id"===(null==e?void 0:e.type)?64:100}function sl(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:fe.ZP.blueWithAlpha(0),cursor:"col-resize"}}const ll={display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"};class al extends s.Z{constructor(){super(...arguments),this.storeTypes={tableHeaderRowStore:hs,resultStore:d.default.createClass(void 0)},this.propertyRef=r.createRef(),this.renderHeaderRowCells=(e,t,o)=>{var i,r,n,s;const{device:l}=this.environment,{store:a,collectionContextStore:c,schema:d,query:p,resultStore:h,disabled:m,formatKey:g,disableCellRightBorder:S,renderSpacer:f,allowHidingTitle:y,paddingTop:v,showRightActions:C}=this.props,x=ul(this.props.format,this.props.tableStore),b=this.props.showPropertyFormats[t],w=t===o.length-1,k=es.B1(),P=(null===(i=c.collectionStore())||void 0===i?void 0:i.getFormat().app_config_uri)===u.GZ&&a.isCollectionViewPageWithContent()&&a.id===(null===(r=c.collectionViewBlockStore())||void 0===r?void 0:r.id),T=P&&e===Xn.k.Owner&&"owner"===k,V=P&&"verification"===(null===(n=d[e])||void 0===n?void 0:n.type)&&"verification"===k,R=P&&"multi_select"===(null===(s=d[e])||void 0===s?void 0:s.type)&&"tags"===k,M=!l.isMobile&&(T||V||R),j=S||w&&!pl(m,C),F=(0,yi.vf)({environment:this.environment,propertyFormat:b}),I=(0,je.jsxs)(je.Fragment,{children:[M&&(0,je.jsx)(ps,{origin:this.propertyRef,propertyType:k}),b&&F&&(0,je.jsx)(Xs,{format:x,schema:d,query:p,property:e,width:F,collectionViewBlockStore:a,collectionContextStore:c,disabled:m,formatKey:g,isLast:w,disableCellRightBorder:j,allowHidingTitle:y,renderSpacer:f,paddingTop:v,columnIndex:t,groupsPointer:this.groupsPointerStore.state}),!m&&!l.isPhone&&(0,je.jsx)(rl,{leftFormat:b,onTemporaryResize:e=>function(e,t,o,i){t.setState({...t.state,temporaryFormat:ml(e,o,i,t)})}(e,this.props.tableStore,this.props.formatKey,this.props.format),onAccept:e=>function(e,t,o,i,r,n){const s=t.collectionViewStore();if(!s)return;const l=ul(i,r),a=hl(o,i,r).map((t=>t.property===e.property?e:t)),c={...l,[o]:a};$.createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:n,perform:e=>{de.iG({collectionViewStore:s,update:{format:c},transaction:e})}}),r.setState({...r.state,temporaryFormat:void 0}),_.wd({environment:n,collectionContextStore:t,action:"table_resize_columns"})}(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),onCancel:()=>{var e;(e=this.props.tableStore).setState({...e.state,temporaryFormat:void 0})},height:this.props.height,propertySchema:d[e],resultStore:h})]});return(0,je.jsx)("div",{style:{display:"flex",position:"relative"},ref:M?this.propertyRef:void 0,children:I},e)},this.shouldShowMultiSelectCheckboxStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,re.fk)({environment:this.environment,collectionContextStore:e})})),this.groupsPointerStore=this.createComputedStore((()=>{const{groupFormat:e}=this.props;return e?[e]:[]}),!0),this.showPropertiesStore=this.createComputedStore((()=>this.props.showPropertyFormats.map((e=>e.property))),!0)}renderComponent(){const{disabled:e,showRightActions:t,disableHorizontalEdgeScroll:o,collectionContextStore:i,frozoneProps:r}=this.props,n=i.permissionScopes.state,s=null==r?void 0:r.frozenIndex,l=(0,re.bW)(s),a=null==r?void 0:r.frozenStyles.left,c={...this.shouldShowMultiSelectCheckboxStore.state?{...null==r?void 0:r.frozenStyles,left:yi.Xx+(a??0)}:null==r?void 0:r.frozenStyles},d=this.showPropertiesStore.state.slice(0,l),p=this.showPropertiesStore.state.slice(l),u=pl(e,t)?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(yl,{collectionContextStore:this.props.collectionContextStore}),(0,je.jsx)(vl,{collectionContextStore:this.props.collectionContextStore})]}):null,h=this.shouldShowMultiSelectCheckboxStore.state&&(0,je.jsx)(cl,{groupsPointer:this.groupsPointerStore.state,collectionContextStore:i,frozoneProps:r}),m=i.isCompactView.state,g=ft(m);return e||!n.canConfigureBlock?(0,je.jsx)(jt,{position:g,children:(0,je.jsxs)("div",{className:eo.kUP,style:Sl(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.disableTopBorder),children:[h,(0,je.jsxs)("div",{style:ts.l8,children:[(0,je.jsx)("div",{style:{display:"flex",...c},children:d.map(((e,t)=>this.renderHeaderRowCells(e,t,this.showPropertiesStore.state)))}),p.map(((e,t)=>this.renderHeaderRowCells(e,t+l,this.showPropertiesStore.state)))]}),u,this.props.children]})}):(0,re.Ql)(s)?(0,je.jsx)(jt,{position:g,children:(0,je.jsxs)("div",{className:eo.kUP,style:Sl(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.disableTopBorder),children:[h,(0,je.jsx)(os.Z,{style:{display:"flex"},direction:"horizontal",keys:this.showPropertiesStore.state,sectionedKeys:{frozen:d,unfrozen:p},sectionStyles:{frozen:{display:"flex",...c},unfrozen:{display:"flex"}},renderKey:this.renderHeaderRowCells,onDrop:e=>fl(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),disableHorizontalEdgeScroll:o}),u,this.props.children]})}):(0,je.jsx)(jt,{position:g,children:(0,je.jsxs)("div",{className:eo.kUP,style:{...Sl(this.props.collectionContextStore,this.props.isInPeekRenderer,this.props.height,this.props.minWidth,this.theme,this.props.disableTopBorder)},children:[h,(0,je.jsx)(ts.ZP,{direction:"horizontal",keys:this.showPropertiesStore.state,renderKey:this.renderHeaderRowCells,onDrop:e=>fl(e,this.props.collectionContextStore,this.props.formatKey,this.props.format,this.props.tableStore,this.environment),disableHorizontalEdgeScroll:o}),u,this.props.children]})})}}function cl(e){window.__c={n:"GroupSelectCheckbox"};const{groupsPointer:t,collectionContextStore:o,frozoneProps:i}=e,n=(0,ne.O7)(),s=(0,r.useCallback)((()=>(0,Fo.A7)(t[0],o).filter((e=>e.canEdit()))),[o,t]),l=(0,c.VK)((()=>0===s().length),[s]),a=(0,c.VK)((()=>{const e=s(),t=e.length;if(0===t)return!1;const o=Oo.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")}),[s]),d=(0,r.useCallback)((e=>{var t;const i=s(),r=Oo.default.state.stores,l=(0,yi.vg)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:r;!1===a||"indeterminate"===a?K.Z5({environment:n,stores:w.G0(l,i)}):!0===a&&K.Z5({environment:n,stores:w.zu(l,...i)}),e.stopPropagation()}),[a,o,n,s]),p=(0,c.VK)((()=>({...null==i?void 0:i.frozenStyles,...-1===(null==i?void 0:i.frozenIndex)?{background:void 0}:{}})),[null==i?void 0:i.frozenIndex,null==i?void 0:i.frozenStyles]);return(0,je.jsx)("div",{style:p,children:(0,je.jsx)(ns,{passesFilter:!0,checkedState:a,onClick:d,checkboxType:"group",collectionContextStore:o,frozoneProps:i?{...i,isCollectionViewBlockSelected:!1}:void 0,disabled:l})})}al.displayName="TableHeaderRow";const dl=(0,j.injectIntl)(al);function pl(e,t){return!e&&t}function ul(e,t){const{temporaryFormat:o}=t.state;return o||e}function hl(e,t,o){return ul(t,o)[e]||[]}function ml(e,t,o,i){const r=ul(o,i),n=hl(t,r,i).map((t=>t.property===e.property?e:t));return{...r,[t]:n}}function gl(e){(0,ue.ZP)({event:e,context:ue.Af.EditorMouseDown,callback:()=>{}})}function Sl(e,t,o,i,r,n){var s;const l=e.collectionViewStore();if(!l)return{};const a=e.isCompactView.state?void 0:(null===(s=e.inheritedBlockColorStore.state)||void 0===s?void 0:s.background)||(t?r.cardContentBackground:r.contentBackground);return{display:"flex",position:"absolute",background:a,zIndex:M.bF,height:o-1,color:r.mediumTextColor,borderTop:n?void 0:`1px solid ${r.tableDividerColor}`,boxShadow:`\n            -3px 0 0 ${a},\n            0 1px 0 ${r.tableDividerColor}\n        `,minWidth:i,left:"timeline"===l.getType()?void 0:0,right:"timeline"===l.getType()?void 0:0}}function fl(e,t,o,i,r,n){const s=t.collectionViewStore();if(!s)return;const l={...ul(i,r),[o]:w.MR(hl(o,i,r),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0}))};$.createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:n,perform:e=>{de.iG({collectionViewStore:s,update:{format:l},transaction:e})}}),_.wd({environment:n,collectionContextStore:t,action:"table_reorder_columns"})}function yl(e){let{collectionContextStore:t}=e;window.__c={n:"AddColumnButtonComponent"};const o=(0,ee.Fg)(),i=(0,ne.O7)();return(0,je.jsx)(xo.Z,{style:{display:"flex",justifyContent:"flex-start",width:32},onMouseDown:gl,onClick:()=>function(e,t){const o=e.collectionStore();o&&(U.ZH(t),K.ZH(t),de.wG(),_.wd({environment:t,collectionContextStore:e,action:"click_new_property"}),L.wl({collectionSettingsStore:e.settingsStore,item:{type:"propertyType",propertyTypes:(0,to.TP)({isSyncedCollection:o.isSyncedCollection(),collectionContextStore:e,environment:t}),onAccept:(o,i,r)=>{Jn.PW({environment:t,collectionContextStore:e,propertyType:o,propertyName:i,selectOptions:r,from:"table"})}}}))}(t,i),className:eo.V6y,children:(0,je.jsx)("div",{style:ll,children:(0,ae.R)({width:12,fill:o.mediumIconColor})})})}function vl(e){let{collectionContextStore:t}=e;window.__c={n:"ConfigureColumnsButtonComponent"};const o=(0,ee.Fg)(),i=(0,ne.O7)();return(0,je.jsx)(xo.Z,{style:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32},onMouseDown:gl,onClick:()=>function(e,t){L.r$({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),_.wd({environment:t,collectionContextStore:e,action:"click_table_header_dot_menu"}),L.H4({collectionSettingsStore:e.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})}(t,i),className:eo.V6y,children:(0,je.jsx)("div",{style:ll,children:(0,le.o)({width:12,fill:o.mediumIconColor})})})}function Cl(e){const{children:t,isCollectionViewBlockSelected:o,shouldFreeze:i}=e;return i?(0,je.jsx)(On.Z,{enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},isVisible:!0,render:()=>(0,je.jsx)("div",{style:{display:"flex",background:o?fe.ZP.blueWithAlpha(.14):void 0},children:t})},"halo"):(0,je.jsx)(je.Fragment,{children:t})}var xl=o(86486),bl=o(59183);function wl(e,t){window.__c={n:"TableRow"};const{disabled:o,store:i,groupFormat:n,collectionContextStore:s,propertyFormats:l,showRightActionsSpacer:a,disableTableWrap:d,frozoneProps:p,passesFilter:u,shouldShowMultiSelectCheckbox:h,...m}=e,{handleOpenPeekPage:g}=e,S=(0,r.useRef)(null),f=(0,ne.O7)(),y=(0,c.VK)((()=>!o&&i.canEdit()),[o,i]),v=(0,c.VK)((()=>(0,Fo.A7)(n,s).findIndex((e=>e===i))),[s,n,i]),C=(0,c.VK)((()=>{const e=s.collectionViewBlockStore();return!(!e||s.isFullScreen.state)&&(0,An.sY)(e)}),[s]),x=null==p?void 0:p.frozenIndex,b=void 0!==x,w=(0,c.VK)((()=>{const{collectionContextStore:t,groupFormat:o}=e,i=bl.Z.state,r=t.collectionViewBlockStore();if(!r)return!1;if(!i.isActive||!(0,bl.N)(i.selectionKey,{collectionViewBlockStore:r,groupFormat:o}))return!1;const{selection:n}=i,{start:s}=n;return void 0!==x&&v===s.row&&s.col<=x}),[e,x,v]),k=(0,c.VK)((()=>re.bW(x)),[x]),P=(0,r.useMemo)((()=>b?{...null==p?void 0:p.frozenStyles,...w?{zIndex:M.mK}:{zIndex:M.IK},...-1===x?{background:void 0}:{}}:{}),[x,null==p?void 0:p.frozenStyles,b,w]),[T,V]=(0,r.useMemo)((()=>b?[l.slice(0,x+1),l.slice(x+1)]:[[],l]),[x,l,b]),R=(0,c.VK)((()=>{var e;return Boolean(!d&&(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue()))}),[s,d]),j=(0,c.VK)((()=>{var e;return Boolean("timeline"===(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getType())||!R&&!l.some((e=>e.wrap)))}),[s,l,R]),F=(0,c.VK)((()=>{const e=s.permissionScopes.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[s.permissionScopes]),_=(0,je.jsxs)(r.Fragment,{children:[(0,je.jsx)("div",{className:eo.zwY,style:{display:"flex"},ref:S,children:(0,je.jsxs)("div",{style:{display:"flex"},children:[(0,je.jsx)("div",{style:b?P:{},children:(0,je.jsx)(Cl,{isCollectionViewBlockSelected:C,shouldFreeze:-1!==x,children:(0,je.jsxs)(je.Fragment,{children:[h&&(0,je.jsx)(Vl,{store:i,passesFilter:Boolean(u),frozoneProps:p,canEdit:y}),(0,je.jsx)(kl,{store:i,canEdit:y,propertyFormats:T,shouldSetCellHeight:j,indexAddendum:0,rowIndex:v,disabled:o,groupFormat:n,disableTableWrap:d,isLocked:F,isCollectionViewBlockSelected:C,passesFilter:Boolean(u),shouldShowMultiSelectCheckbox:h,frozoneProps:p,...m})]})})}),(0,je.jsx)(kl,{store:i,canEdit:y,propertyFormats:V,shouldSetCellHeight:j,indexAddendum:k,rowIndex:v,disabled:o,groupFormat:n,disableTableWrap:d,isLocked:F,isCollectionViewBlockSelected:C,passesFilter:!0,shouldShowMultiSelectCheckbox:h,frozoneProps:p,...m})]})}),a&&!F&&(0,je.jsx)(Rl,{})]});return(0,Ln.ez)(i,t,(0,r.useMemo)((()=>({renderedType:"table_row",getNode:()=>S.current,getBlockStore:()=>i,activate(){const{mainEditorCurrentBlockStore:e}=Do.default.state,t=re.mb({store:i,mainEditorCurrentBlockStore:e,collectionContextStore:s,fullyQualified:!1});t&&(g(),N.c4({environment:f,url:t}))}})),[s,f,g,i]),_)}function kl(e){window.__c={n:"TableRowValues"};const{blockPropertyValueOverlayStore:t,propertyFormats:o,store:i,disableTableWrap:r,shouldSetCellHeight:n,indexAddendum:s,frozoneProps:l,...a}=e,d=(0,Ir.Y$)(),p=(0,c.VK)((()=>d.collectionViewStore()),[d]),u=(0,c.VK)((()=>i.getAssociatedCollectionStore()),[i]),h=(0,c.VK)((()=>!!p&&Boolean(!r&&p.getFormatStore().getKeyStore("table_wrap").getValue())),[p,r]),m=(0,c.VK)((()=>{const e=xl.default.state;return Boolean(e.isOpen&&e.currentStore===i)}),[i]),g=(0,c.VK)((()=>!t.state.isOpen&&Oo.default.state.stores.length>0&&Oo.default.state.stores[0].id===i.id),[i.id,t]),S=(0,c.VK)((()=>d.currentSubitemFormatStoreForUiDisplay.state),[d.currentSubitemFormatStoreForUiDisplay]),f=(0,c.VK)((()=>"title"===(null==p?void 0:p.getFormat().table_subitem_toggle_column)),[p]),y=(0,c.VK)((()=>d.frozoneStore.state.frozenIndex),[d]);return(0,je.jsx)(je.Fragment,{children:o.map(((e,r)=>(0,je.jsx)(Pl,{index:r+(s??0),store:i,propertyFormat:e,isLastColumn:r===o.length-1,isRightMostFrozenColumn:y===r+(s??0),collectionViewStore:p,collectionStore:u,tableWrap:h,shouldSetCellHeight:n,isShowingHoverMenu:m,shouldCaptureKeyboard:g,subitemFormat:S,isSubitemToggleOnTitleColumn:f,blockPropertyValueOverlayStore:t,isScrolled:(null==l?void 0:l.isScrolled)??!1,...a},e.property)))})}const Pl=e=>{window.__c={n:"TableRowValue"};const{propertyFormat:t,index:o,canEdit:i,isLastColumn:n,isRightMostFrozenColumn:s,store:l,schema:a,disabled:d,disableCellBorderRight:p,disableLastCellBorderRight:u,subitemPath:h,onShiftEnter:m,tableWrap:g,subitemFormat:S,isShowingHoverMenu:f,shouldCaptureKeyboard:y,isLocked:v,toggleButton:C,onPropertyClick:x,titleColumnIndex:b,isSubitemToggleOnTitleColumn:k,onPropertyTab:P,onPropertyUntab:T,onPropertyEnter:V,onPropertyEsc:R,onPropertyBgClick:M,onPropertyContextMenu:j,collectionViewStore:F,collectionStore:_,blockPropertyValueOverlayStore:I,shouldSetCellHeight:B,onOpenProperty:D,disableHorizontalEdgeScroll:A,handleOpenPeekPage:L,groupFormat:Z,rowIndex:E,isCollectionViewBlockSelected:O,passesFilter:G,isScrolled:N,shouldShowMultiSelectCheckbox:z}=e,{property:H,wrap:K}=t,W=(0,ne.O7)(),U=(0,c.VK)((()=>(0,yi.vf)({environment:W,propertyFormat:t})),[W,t]),$=(0,Ir.Y$)(),q=(null==h?void 0:h.length)??0,Q=S&&(0,yi.lO)({columnIndex:o,titleColumnIndex:b,isSubitemToggleOnTitleColumn:k}),Y=(0,r.useMemo)((()=>{if(void 0!==U)return Q?U-(0,yi.lZ)({columnIndex:o,indentLevel:q,titleColumnIndex:b,isSubitemToggleOnTitleColumn:k}):U}),[q,o,k,Q,b,U]),X=(0,r.useMemo)((()=>Q&&(0,je.jsx)(Tl,{subitemFormat:S,toggleButton:C,subitemPath:h,shouldShowMultiSelectCheckbox:z,propertyIndex:o})),[Q,S,h,C,z,o]),J=(0,r.useCallback)((()=>x(l,H,a)),[x,H,a,l]),te=d||!i,oe=(0,c.VK)((()=>{const e=bl.Z.state,t=$.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,bl.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:Z}))return!1;const{selection:i}=e,{start:r,end:n}=i,s=E===r.row||E===n.row||w.Z2(E,r.row,n.row),l=o===r.col||o===n.col||w.Z2(o,r.col,n.col);return s&&l}),[$,Z,o,E]),ie=(0,c.VK)((()=>{const e=bl.Z.state,t=$.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,bl.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:Z}))return!1;const{selection:i}=e,{start:r}=i;return E===r.row&&o===r.col}),[$,Z,o,E]),re=(0,c.VK)((()=>{const e=$.frozoneStore.state.frozenIndex;return void 0!==e&&o<=e}),[$,o]),se=(0,ee.yK)((e=>{const t=O?e.tableFrozenSelectedDividerColor:e.tableDividerColor;return{tableCell:{display:"flex",width:U||void 0,position:"relative",borderRight:p||s||n&&u?"none":`1px solid ${t}`,boxShadow:re?`0 -1px 0 ${t}`:void 0},tableSelectionOverlay:{background:oe?fe.ZP.blueWithAlpha(.07):void 0,borderRadius:ie?3:void 0,boxShadow:ie?e.outlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,...0===o&&z?{width:"calc(100% + 8px)",left:-8}:{width:"100%",left:0}},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:U||void 0}}}),[O,p,u,s,n,re,oe,ie,U,o,z]),le=(0,je.jsxs)(bo.Z,{capture:y,onShiftEnter:m,children:[(0,je.jsx)(So.Z,{collectionStore:_,store:l,property:H,disabled:te,locked:v,width:Y,format:fo.C.Table,forceMouseEntered:"title"===H&&i?f:void 0,tableWrap:Boolean(g||K),isLast:n,indentLevel:0===o&&h?h.length:void 0,onTab:P,onUntab:T,onEnter:V,onClick:J,onEsc:R,onBgClick:M,onContextMenu:j,collectionViewStore:F,shouldSetCellHeight:B,onOpenProperty:D,blockPropertyValueOverlayStore:I,disableHorizontalEdgeScroll:A,handleOpenPeekPage:L,propertyIndex:o,shouldShowMultiSelectCheckbox:z},H),s&&(0,je.jsx)(rs,{passesFilter:G,isScrolled:N})]});return(0,je.jsxs)("div",{className:eo.mWS,"data-row-index":E,"data-col-index":o,style:se.tableCell,children:[Q&&X,(0,je.jsx)("div",{style:se.propertyValueContainer,children:le}),oe&&(0,je.jsx)("div",{style:se.tableSelectionOverlay})]})};function Tl(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:i,propertyIndex:r}=e,n=(null==o?void 0:o.length)??0,s=Math.max((n-1)*Fo.Hw,0)+Fo.gY;return t?(0,je.jsxs)("div",{style:{paddingTop:4,display:"flex",...0===r&&i?{marginLeft:-8,marginRight:4}:{}},children:[(0,je.jsx)("div",{style:{width:s}}),t]}):(0,je.jsx)("div",{style:{minWidth:s+Fo.Hw,...0===r&&i?{marginLeft:-8,marginRight:4}:{}}})}const Vl=r.memo((e=>{window.__c={n:"RowSelectCheckbox"};const{store:t,passesFilter:o,canEdit:i,frozoneProps:n}=e,s=(0,Ir.Y$)(),l=(0,ne.O7)(),a=(0,c.VK)((()=>Oo.default.state.stores.includes(t)),[t]),d=(0,r.useCallback)((e=>{var o;(0,yi.vg)({collectionViewBlockId:null===(o=s.collectionViewBlockStore())||void 0===o?void 0:o.id})?K.Z5({environment:l,stores:[t]}):K.Ys({environment:l,store:t,toggle:!0}),e.stopPropagation()}),[s,l,t]);return(0,je.jsx)(ns,{checkedState:a,onClick:d,checkboxType:"single_row",collectionContextStore:s,frozoneProps:n,passesFilter:o,disabled:!i})}));function Rl(){return(0,je.jsx)("div",{style:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}})}const Ml=r.memo(r.forwardRef(wl),Qt.Z);var jl=o(12137),Fl=o(55061),_l=o(11302),Il=o(12714),Bl=o(39865),Dl=o(11368),Al=o(24646);const Ll=function(e){window.__c={n:"FrozenColumnRepositioner"};const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:i,xForFirstCellInRow:n,showPropertyFormats:s,frozenSectionWidth:l}=e,a=(0,ne.O7)(),d=(0,Ir.DK)(),p=(0,r.useRef)(null),u=(0,r.useRef)(null),[h,m]=r.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[g,S]=r.useState(0),[f,y]=r.useState(0),v=(0,c.VK)((()=>t.state.isRepositioning||h.isMouseDown),[t,h.isMouseDown]),C=(0,c.VK)((()=>t.state.newFrozenIndex),[t]),x=(0,c.VK)((()=>!!d&&(0,re.fk)({environment:a,collectionContextStore:d})),[a,d]),b=(0,c.VK)((()=>null==d?void 0:d.frozoneStore.state.isScrolled),[d]),k=(0,c.VK)((()=>!b&&-1===o&&x?-4:0),[o,b,x]),P=(0,c.VK)((()=>h.isEntered||v),[h.isEntered,v]),T=(0,c.VK)((()=>t.state.newFrozenColumnXPosition),[t]),V=(0,r.useContext)(Dl.Ue),F=(0,c.VK)((()=>null==V?void 0:V.horizontalScroller),[V]),_=(0,r.useCallback)((()=>{var e,t,o;if(!F||!p.current)return 0;const i=(null===(e=p.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,r=null===(t=F.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(eo.kUP);return(r&&r.length>0?null===(o=r[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-i}),[F]),I=(0,r.useCallback)((()=>{var e,t,o,i,r;if(!F||!p.current)return 0;const n=(null===(e=p.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,s=null===(t=F.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(eo.zwY),l=s&&s.length>0?null===(o=s[s.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(i=F.scrollerEl())||void 0===i?void 0:i.getElementsByClassName(eo.Gcz),c=a&&a.length>0?null===(r=a[a.length-1].getBoundingClientRect())||void 0===r?void 0:r.bottom:0;return Math.max(l,c)-n}),[F]),B=(0,c.VK)((()=>{var e;const t=null===(e=p.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==l?new DOMRect(t.x+l+h.x+10,t.y+h.y+10,3,3):void 0}),[l,h]),D=(0,c.VK)((()=>{const e=(null==d?void 0:d.frozoneStore.state.scrollerLeftOffset)??0,t=(0,Al.Wk)(a),o=Math.max(t-e,0);return d&&(0,yi.iZ)(a,d)?o:0}),[d,a]),A=(0,r.useCallback)((e=>{if(void 0===o||void 0===i||void 0===l||null===p.current||null===u.current)return;const r=p.current.getBoundingClientRect(),a=e.clientX-r.x;if(null==d||d.frozoneStore.setState({...null==d?void 0:d.frozoneStore.state,tryShowHiddenFrozenColumn:a<42}),!P)return;const c=_();S(c);const h=I();y(h);const g=2+l,f=Math.max(a-g,-g),C=e.clientY-r.y-14,x=r.bottom-r.top-14+h,w=v?c:-14,k=Math.max(Math.min(C,x),w);if(m((e=>({...e,x:v?f:0,y:k}))),v){const e=s,r=u.current.getBoundingClientRect();let c=a,d=n,p=-1,h=d,m=Math.abs(d-c);for(let t=0;t<e.length&&!(t>i);t++){const i=e[t];d+=(null==i?void 0:i.width)??0,b&&t===o+1&&(c-=r.x);const n=Math.abs(d-c);n<m&&(m=n,h=d,p=t)}t.setState({...t.state,newFrozenIndex:p,newFrozenColumnXPosition:h-l-1})}}),[o,i,l,null==d?void 0:d.frozoneStore,P,_,I,v,s,n,t,b]);(0,r.useEffect)((()=>{const e=w.P2((e=>{A(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[A]);const L=(0,r.useCallback)((e=>{v||(A(e.nativeEvent),m((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[v,A]),Z=(0,r.useCallback)((e=>{v||m((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[v]),E=(0,r.useCallback)((e=>{m((e=>({...e,isMouseDown:!0})))}),[]),O=(0,r.useCallback)((e=>{v&&m((e=>({...e,isEntered:!0})))}),[v]),G=(0,r.useCallback)((e=>{m((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),N=(0,r.useCallback)((e=>{v&&m((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[v]),z=void 0!==C&&void 0!==o&&C<=o,H=(0,ee.yK)((e=>({repositionerContainer:{zIndex:M.hc,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:v?"grabbing":"grab",pointerEvents:v?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:D,height:"100%"},tooltipContainer:{position:"absolute",left:l??0,zIndex:M.xP,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:v?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:v?h.x-1:-1,top:v?g:0,width:2,height:v?`calc(100% + ${f-g}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:v?g:0,width:1,height:v?`calc(100% + ${f-g}px`:"100%",background:e.accentColors.blue[300]},frozenGhostColumn:{left:T,opacity:v&&z?1:0},unfrozenGhostColumn:{left:(l??0)+(T??0),opacity:P&&v&&!z?1:0},tooltipDraggable:{position:"absolute",left:v?h.x-2:-2,top:h.y,width:4,height:28,background:e.accentColors.blue[400],borderRadius:4},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...R.Z.textOverflowStyle}})),[v,D,l,h,g,f,P,T,z]);return(0,je.jsx)("div",{className:eo.wXs,style:H.repositionerContainer,onMouseEnter:O,onMouseLeave:G,onMouseUp:N,children:(0,je.jsxs)("div",{style:H.repositionerOutsideStickyWrapper,ref:u,children:[(0,je.jsx)("div",{style:H.repositionerInsideStickyWrapper,ref:p,children:(0,je.jsx)(Je.ZP,{renderTooltip:()=>v&&void 0!==C&&C!==o?(0,je.jsx)(j.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:C+1}}):(0,je.jsx)(j.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:v||void 0,placement:zn.u.Right,originRect:B,render:e=>(0,je.jsx)(On.Z,{isVisible:!0,animationStyle:{translateX:k,opacity:P?1:0},render:()=>(0,je.jsxs)("div",{...e,style:H.tooltipContainer,children:[(0,je.jsx)("div",{style:H.tooltipOrigin,onMouseEnter:L,onMouseLeave:Z,onMouseDown:E}),(0,je.jsx)("div",{style:{...H.ghostColumnBase,...H.frozenGhostColumn}}),(0,je.jsx)("div",{style:H.tooltipColumn}),(0,je.jsx)("div",{style:H.tooltipDraggable})]})})})}),(0,je.jsx)("div",{style:{...H.ghostColumnBase,...H.unfrozenGhostColumn}})]})})};var Zl=o(4708),El=o(39500),Ol=o(77907),Gl=o(95802),Nl=o(80796),zl=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}(zl||{});class Hl extends s.Z{constructor(){super(...arguments),this.rowsWrapEl=null,this.observer=void 0,this.storeTypes={dragAndFillStore:d.default.createClass(void 0),frozenColumnRepositionStore:d.default.createClass({isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0})},this.handleDragStart=e=>{if(e.preventDefault(),function(e){let t=e;for(;null!==t;){if(t.classList.contains(eo.wXs))return!0;t=t.parentElement}return!1}(e.target))this.stores.frozenColumnRepositionStore.setState({isRepositioning:!0,newFrozenIndex:this.frozenIndex.state,newFrozenColumnXPosition:void 0}),this.scrollToStart(),Nl.Z.setState({...Nl.Z.state,disableHorizontalEdgeScroll:!0,disableVerticalEdgeScroll:!0});else{const t=this.normalizedTableSelectionStore.state;if(t&&$l(this.props.disabled,this.props.collectionContextStore)&&function(e){let t=e;for(;null!==t;){if(t.classList.contains(eo.JR_))return!0;t=t.parentElement}return!1}(e.target))return void this.stores.dragAndFillStore.setState({...t})}de.wG()},this.handleDragMove=e=>{if(this.stores.frozenColumnRepositionStore.state.isRepositioning);else if(El.X9()){var t;const o=Ul(e.target);if(!o)return;const i=this.stores.dragAndFillStore.state,r=(null==i?void 0:i.start)??(null===(t=this.normalizedTableSelectionStore.state)||void 0===t?void 0:t.start)??o;if(!r)return;const n=o;if(this.stores.dragAndFillStore.state&&r.col!==n.col)return;this.setSelection({selection:{start:r,end:n},shouldNormalize:!0})}},this.handleDragEnd=()=>{this.repositionFrozenColumns(),this.dragAndFillCells()},this.handleDragCancel=()=>{this.stores.dragAndFillStore.reset(),this.stores.frozenColumnRepositionStore.reset(),de.wG()},this.handleLeft=e=>{e.preventDefault&&e.preventDefault(),Zo.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Ds.e2({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:"shiftKey"in e&&e.shiftKey||!1,columnCount:this.props.showPropertyFormats.length}),this.updateSelectionScroll(zl.Left))},this.handleRight=e=>{e.preventDefault&&e.preventDefault(),Zo.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Ds.FC({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,columnCount:this.props.showPropertyFormats.length,rowCount:this.allRowsStore.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(zl.Right))},this.handleUp=e=>{e.preventDefault&&e.preventDefault(),Zo.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Ds.zJ({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(zl.Up))},this.handleDown=e=>{e.preventDefault&&e.preventDefault(),Zo.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Ds.DI({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,rowCount:this.allRowsStore.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(zl.Down))},this.handleEnter=e=>{e.preventDefault&&e.preventDefault(),Zo.Z.setKeyboardMode(!0);const{schema:t}=this.props,o=this.normalizedTableSelectionStore.state;if(!o)return;const i=this.allRowsStore.state,r=i[o.start.row],n=this.props.showPropertyFormats[o.start.col].property,s=t[n];if(s&&!this.props.disabled)if(Se.uk.includes(s.type)){if("checkbox"===s.type){const e=r.getPropertyStore(n),t=Ht.Ml(e.getValue()),s=i.slice(o.start.row,o.end.row+1);$.createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:this.environment,perform:e=>{for(const o of s)ho.sO({store:o.getPropertyStore(n),value:Ht._I(!t),transaction:e})}})}}else po.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:r,property:n,format:fo.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,collectionContextStore:this.props.collectionContextStore}),de.wG()},this.handleTab=e=>{e.preventDefault(),Zo.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Ds.FC({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,columnCount:this.props.showPropertyFormats.length,rowCount:this.allRowsStore.state.length,shiftKey:!1}),this.updateSelectionScroll(zl.Right))},this.handleUntab=e=>{e.preventDefault(),Zo.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Ds.e2({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:!1,columnCount:this.props.showPropertyFormats.length}),this.updateSelectionScroll(zl.Left))},this.handleEsc=e=>{const{device:t}=this.environment;if(t.isMobile)return;e.preventDefault(),Zo.Z.setKeyboardMode(!0);const o=this.normalizedTableSelectionStore.state;if(de.wG(),o){const e=(0,yi.AV)(o),t=this.allRowsStore.state.slice(e.minRow,e.maxRow+1);K.Z5({environment:this.environment,stores:t})}},this.handleMoveTo=e=>{e.preventDefault&&e.preventDefault(),Zo.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(de.wG(),t){const e=(0,yi.AV)(t),o=this.allRowsStore.state.slice(e.minRow,e.maxRow+1);if(0===o.length)return;K.Z5({environment:this.environment,stores:o});const i=Gl.C.getRectFromStore(o[0]);_l.bA({environment:this.environment,blocks:o,originRect:i,moveToContext:"action_menu"})}},this.handleDelete=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state;t&&!this.props.disabled&&$.createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:this.environment,perform:e=>{Ds.NE({selection:t,schema:o,currentPropertyFormats:this.props.showPropertyFormats,currentRows:this.allRowsStore.state,transaction:e})}})},this.handleCut=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state,i=this.props.collectionContextStore.collectionViewBlockStore();i&&t&&!this.props.disabled&&$.createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:this.environment,perform:r=>{Ds.nA({selectionKey:{collectionViewBlockStore:i,groupFormat:this.props.groupFormat},schema:o,selection:t,currentPropertyFormats:this.props.showPropertyFormats,currentRows:this.allRowsStore.state,event:e,transaction:r})}})},this.handleCopy=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state,i=this.props.collectionContextStore.collectionViewBlockStore();i&&t&&Ds.qn({selectionKey:{collectionViewBlockStore:i,groupFormat:this.props.groupFormat},schema:o,selection:t,currentPropertyFormats:this.props.showPropertyFormats,currentRows:this.allRowsStore.state,event:e})},this.handlePaste=e=>{const{collectionContextStore:t,groupFormat:o,schema:i,showPropertyFormats:r,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:s}=this.props,l=this.normalizedTableSelectionStore.state,a=this.props.collectionContextStore.collectionViewBlockStore();a&&l&&!this.props.disabled&&$.createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:this.environment,perform:c=>{Ds.j0({environment:this.environment,collectionContextStore:t,selectionKey:{collectionViewBlockStore:a,groupFormat:o},selection:l,currentPropertyFormats:r,currentRows:this.allRowsStore.state,event:e,transaction:c,schema:i,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:s})}})},this.handleCommandEnter=e=>{const{device:t}=this.environment,o=this.normalizedTableSelectionStore.state;if(t.isMobile||!o)return;const{collectionContextStore:i}=this.props,r=this.allRowsStore.state[o.start.row],{mainEditorCurrentBlockStore:n}=Do.default.state,s=re.mb({store:r,mainEditorCurrentBlockStore:n,collectionContextStore:i,fullyQualified:!1});s&&this.navigate(s)},this.handleShiftEnter=()=>{const{device:e}=this.environment;if(e.isMobile)return;const t=this.normalizedTableSelectionStore.state;if(!t)return;if(!ge.M_(this.environment))return;const{collectionContextStore:o,groupFormat:i}=this.props;if(!o.shouldAllowNewItemCreation())return;const r=this.allRowsStore.state,n=r[t.start.row],s=o.subitemTreeStore.state,a=(0,fi.DY)(s.children,(e=>e.value.store===n)),c="table_selection_overlay_shift_enter";if(a){const e=a?(0,Fo.Af)(a.map((e=>e.value.store))):"",s=o.subitemExpandedStore.state.get(e),d=Boolean(null==s?void 0:s.isExpanded),u=[...a].splice(0,a.length-1),h=u?(0,Fo.Af)(u.map((e=>e.value.store))):"",m=o.subitemExpandedStore.state.get(h),g=Boolean(null==m?void 0:m.isExpanded);if(d||g)$.createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:this.environment,perform:e=>{const t=o.collectionStore();if(!t)return;const r=A.yk({environment:this.environment,collectionContextStore:o,groupsPointer:i?[i]:[],store:n,before:!1,collectionStore:t,transaction:e,subitemPath:a,subitemInsertDirection:g&&!d?"below":"into",from:c});r&&this.props.blockPropertyValueOverlayStore&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{po.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:r,property:"title",format:fo.C.Table,collectionContextStore:o})}))}))}});else{const e={col:t.end.col,row:o.currentViewHasSort()?r.length:t.end.row+1};$.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:this.environment,perform:t=>{const r=A.IW({environment:this.environment,collectionContextStore:o,groupsPointer:i?[i]:[],insertAtIndex:e.row,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:c});if(r&&!r.coercionSucceeded){const e=i?[i]:[],t=o.groupsStore.getGroupState(e);ie.CH({environment:this.environment,store:r.newStore,peekMode:re.kr(o.collectionViewStore()),resultsStore:null==t?void 0:t.resultsStore,collectionContextStore:o,pageVisitSource:p.tY.Create})}}}),l.default.afterNextFlush((()=>{this.setSelection({selection:{start:e,end:e},shouldNormalize:!1})}))}}else{const e={col:t.end.col,row:o.currentViewHasSort()?r.length:t.end.row+1};$.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:this.environment,perform:t=>{const r=A.IW({environment:this.environment,collectionContextStore:o,groupsPointer:i?[i]:[],insertAtIndex:e.row,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:c});if(r&&!r.coercionSucceeded){const e=i?[i]:[],t=o.groupsStore.getGroupState(e);ie.CH({environment:this.environment,store:r.newStore,peekMode:re.kr(o.collectionViewStore()),resultsStore:null==t?void 0:t.resultsStore,collectionContextStore:o,pageVisitSource:p.tY.Create})}}}),l.default.afterNextFlush((()=>{this.setSelection({selection:{start:e,end:e},shouldNormalize:!1})}))}this.updateSelectionScroll(zl.Down),po.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})},this.handleDuplicate=e=>{const{device:t}=this.environment;if(t.isMobile)return;const o=this.normalizedTableSelectionStore.state;o&&o.start.col===o.end.col&&!this.props.disabled&&ge.M_(this.environment)&&(e.preventDefault(),$.createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:this.environment,perform:e=>{this.copyValuesToSelectionFromStart({transaction:e,selection:o,start:o.start})}}))},this.handleCommandShiftEnter=e=>{const{device:t}=this.environment;if(t.isMobile)return;const o=this.normalizedTableSelectionStore.state;if(o){const e=this.allRowsStore.state[o.start.row],t=(0,_o.ZP)({store:e,fullyQualified:!1,pageVisitSource:p.tY.LinkInPage});Il.D({environment:this.environment,url:t})}},this.handleKeypress=e=>{if(!e.key||e.metaKey||e.ctrlKey)return;e.preventDefault(),Zo.Z.setKeyboardMode(!0);const{schema:t}=this.props,o=this.normalizedTableSelectionStore.state;if(!o)return;const i=this.allRowsStore.state[o.start.row],r=this.props.showPropertyFormats[o.start.col].property,n=t[r];n&&!this.props.disabled&&Se.ub.includes(n.type)&&e.key&&1===e.key.length&&(po.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:i,property:r,format:fo.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,insertChar:e.key,collectionContextStore:this.props.collectionContextStore}),de.wG())},this.handlePropertyTab=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(e.isOpen){const{store:t,property:o}=e,i=this.getCellPositionOfStore(t,o),r=this.props.showPropertyFormats,n={col:Math.min(i.col+1,r.length-1),row:i.row};this.setSelection({selection:{start:n,end:n},shouldNormalize:!0}),this.updateSelectionScroll(zl.Right),po.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})}},this.handlePropertyUntab=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(e.isOpen){const{store:t,property:o}=e,i=this.getCellPositionOfStore(t,o),r={col:Math.max(i.col-1,0),row:i.row};this.setSelection({selection:{start:r,end:r},shouldNormalize:!0}),this.updateSelectionScroll(zl.Left),po.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})}},this.handlePropertyEnter=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(!e.isOpen)return;const{store:t,property:o}=e,i=this.getCellPositionOfStore(t,o),r={col:i.col,row:i.row+1};l.default.afterNextFlush((()=>{ql(this.props.blockPropertyValueOverlayStore,this.environment)&&this.setSelection({selection:{start:r,end:r},shouldNormalize:!0})})),this.updateSelectionScroll(zl.Down),po.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})},this.handlePropertyClick=(e,t,o)=>{var i;const{device:r}=this.environment;if("checkbox"!==(null===(i=o[t])||void 0===i?void 0:i.type)||r.isMobile)de.wG();else{const o=this.getCellPositionOfStore(e,t);this.setSelection({selection:{start:o,end:o},shouldNormalize:!0})}},this.dismissPropertyOverlay=e=>{const{device:t}=this.environment,o=this.props.blockPropertyValueOverlayStore.state;if(o.isOpen){const{store:i,property:r}=o,n=this.getCellPositionOfStore(i,r);t.isMobile?de.wG():ql(this.props.blockPropertyValueOverlayStore,this.environment)&&this.setSelection({selection:{start:n,end:n},shouldNormalize:!0}),this.updateSelectionScroll(zl.Down),po.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),null==e||e(o)}},this.handlePropertyBgClick=()=>{this.dismissPropertyOverlay()},this.handlePropertyEsc=()=>{this.dismissPropertyOverlay((e=>{const{isNewBlock:t,store:o}=e;t&&o.isEmptyTitle()&&o.isEmptyPage()&&$.createAndCommit({userAction:"TableSelectionOverlay.handlePropertyEsc",environment:this.environment,perform:e=>{Bl.y8({environment:this.environment,blocks:[o],transaction:e}),e.postSubmitCallbacks.push((e=>{if(!e){const e=this.props.collectionContextStore.collectionStore(),t=this.props.collectionContextStore.collectionViewBlockStore();F.dh(this.environment,{analyticsName:"delete",from:"collection_esc_shortcut",block_id:o.id,block_type:"page",collection_id:null==e?void 0:e.id,collection_view_id:null==t?void 0:t.id})}}))}})}))},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyOpenProperty=e=>{!function(e,t,o,i,r){const n=t.state;if(n.isOpen){const{store:s}=n;po.bA({environment:r,blockPropertyValueOverlayStore:t,store:s,property:e,format:fo.C.Table,disableHorizontalEdgeScroll:o,collectionContextStore:i})}}(e,this.props.blockPropertyValueOverlayStore,Boolean(this.props.disableHorizontalEdgeScroll),this.props.collectionContextStore,this.environment)},this.handlePropertyContextMenu=e=>{const{collectionContextStore:t}=this.props;e.preventDefault();const o=this.allRowsStore.state,i=this.normalizedTableSelectionStore.state,r=Ul(e.target);let n=!1;if(i&&r){const s=Math.min(i.start.row,i.end.row),l=Math.max(i.start.row,i.end.row);if(r.row>=s&&r.row<=l){const i=o.slice(s,l+1);i.length>0&&(K.Z5({environment:this.environment,stores:i}),K.Ys({environment:this.environment,store:i[0]}),co.Qn({environment:this.environment,stores:Oo.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"default",showInput:!0,analyticsFrom:t.getAnalyticsFromOverride()??"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:t}}),n=!0)}}if(!n&&r){const i=o[r.row];i&&(K.Ys({environment:this.environment,store:i}),co.Qn({environment:this.environment,stores:Oo.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"default",showInput:!0,analyticsFrom:t.getAnalyticsFromOverride()??"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:t}}))}},this.handleRowSelectableEnter=e=>{const t=this.allRowsStore.state,o=e.blocks.map((e=>t.indexOf(e))),i=w.VV(o)||0,r=w.Fp(o)||0;i>=0&&r>=0&&this.setSelection({selection:{start:{col:0,row:i},end:{col:0,row:r}},shouldNormalize:!0})},this.handleRowsWrapMount=e=>{this.rowsWrapEl=e},this.handleRowsObserverChange=()=>{this.selectionStartRectStore.recompute()},this.allRowsStore=this.createComputedStore((()=>{const{groupFormat:e,collectionContextStore:t}=this.props;return(0,Fo.A7)(e,t)})),this.normalizedTableSelectionStore=this.createComputedStore((()=>{const e=bl.Z.state,t=this.props.collectionContextStore.collectionViewBlockStore();if(!t)return;const{groupFormat:o}=this.props;if(!e.isActive||!(0,bl.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:o}))return;const{selection:i}=e;return this.normalizeTableSelection(i)}),!0),this.selectionStartRectStore=this.createComputedStore((()=>{const e=this.normalizedTableSelectionStore.state;if(e)return this.getCellRect(e.start)}),!0),this.frozenIndex=this.createComputedStore((()=>this.props.collectionContextStore.frozoneStore.state.frozenIndex)),this.maxFrozenIndex=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=e.frozoneStore.state.scrollerWidth;return null==t?void 0:t.getTableMaxFrozenColumnIndex(o,e.normalizedFormatStore.state)})),this.frozenSectionWidthStore=this.createComputedStore((()=>{const e=this.frozenIndex.state;if(void 0!==e){let t=Ql(this.props.collectionContextStore,this.environment);const{showPropertyFormats:o}=this.props,i=o;for(let r=0;r<=e&&!(r>=i.length);r++){const e=i[r];e.width&&(t+=e.width)}return t-1}}),!0),this.multiSelectCheckedStore=this.createComputedStore((()=>{const e=function(e,t){const o=t?[t]:[];return(0,Fo.A7)(o[0],e)}(this.props.collectionContextStore,this.props.groupFormat),t=e.length;if(0===t)return!1;const o=Oo.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")})),this.shouldRenderFrozenColumnRepositioner=this.createComputedStore((()=>void 0!==this.frozenIndex.state&&!this.stores.dragAndFillStore.state&&!this.multiSelectCheckedStore.state&&!bl.Z.state.isActive&&void 0===this.props.tableStore.state.temporaryFormat&&this.props.collectionContextStore.permissionScopes.state.canConfigureBlock)),this.renderArgs={onPropertyTab:this.handlePropertyTab,onPropertyUntab:this.handlePropertyUntab,onPropertyEnter:this.handlePropertyEnter,onPropertyClick:this.handlePropertyClick,onPropertyEsc:this.handlePropertyEsc,onPropertyBgClick:this.handlePropertyBgClick,onPropertyContextMenu:this.handlePropertyContextMenu,onOpenProperty:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyOpenProperty,onSelectableEnter:this.handleRowSelectableEnter}}willUnmount(){super.willUnmount(),this.observer&&this.observer.disconnect()}didMount(){super.didMount(),this.rowsWrapEl&&(this.observer=new MutationObserver(this.handleRowsObserverChange),this.observer.observe(this.rowsWrapEl,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}renderComponent(){const{store:e,schema:t,showPropertyFormats:o}=this.props,i=this.normalizedTableSelectionStore.state,r=$l(this.props.disabled,this.props.collectionContextStore)&&i&&(i.start.col===i.end.col&&i.start.row===i.end.row||this.stores.dragAndFillStore.state)?(0,je.jsx)(Kl,{store:e,schema:t,selection:i,dragAndFillStore:this.stores.dragAndFillStore,showPropertyFormats:o,selectionStartRectStore:this.selectionStartRectStore,rowsWrapRect:this.getRowsWrapRect(),frozenIndexStore:this.frozenIndex,currentRowsStore:this.allRowsStore}):null,n=this.shouldRenderFrozenColumnRepositioner.state?(0,je.jsx)(Ll,{frozenColumnRepositionStore:this.stores.frozenColumnRepositionStore,frozenIndex:this.frozenIndex.state,maxFrozenIndex:this.maxFrozenIndex.state,xForFirstCellInRow:Ql(this.props.collectionContextStore,this.environment),showPropertyFormats:o,frozenSectionWidth:this.frozenSectionWidthStore.state}):null,s=this.props.render(this.renderArgs);return(0,je.jsx)(bo.Z,{capture:void 0!==this.normalizedTableSelectionStore.state,onLeft:this.handleLeft,onRight:this.handleRight,onUp:this.handleUp,onDown:this.handleDown,onEnter:this.handleEnter,onTab:this.handleTab,onUntab:this.handleUntab,onEsc:this.handleEsc,onDelete:this.handleDelete,onBackspace:this.handleDelete,onCut:this.handleCut,onCopy:this.handleCopy,onPaste:this.handlePaste,onCommandEnter:this.handleCommandEnter,onShiftEnter:this.handleShiftEnter,onCommandShiftEnter:this.handleCommandShiftEnter,onDuplicate:this.handleDuplicate,onKeypress:this.handleKeypress,onMoveTo:this.handleMoveTo,children:(0,je.jsx)(el.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,render:e=>(0,je.jsxs)("div",{style:{position:"relative",minWidth:this.props.minWidth},...e,ref:this.handleRowsWrapMount,children:[n,r,s]})})})}repositionFrozenColumns(){const{collectionContextStore:e}=this.props;this.stores.frozenColumnRepositionStore.state.isRepositioning&&$.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:this.environment,perform:t=>{Ds.oz({environment:this.environment,collectionContextStore:e,currentIndex:this.stores.frozenColumnRepositionStore.state.newFrozenIndex,transaction:t,entrypoint:"TableSelectionOverlay.FrozenColumnRepositioner"}),this.stores.frozenColumnRepositionStore.reset()}})}dragAndFillCells(){var e;const t=this.stores.dragAndFillStore.state;if(!t)return;const{start:o,end:i}=t;if(o.col!==i.col||o.row!==i.row)return;const{showPropertyFormats:r,schema:n,collectionContextStore:s}=this.props,l=null===(e=n[r[o.col].property])||void 0===e?void 0:e.type;if("verification"===l)return;const a=this.normalizedTableSelectionStore.state;if(!a)return;$.createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:this.environment,perform:e=>{this.copyValuesToSelectionFromStart({transaction:e,selection:a,start:o})}});const c=Math.min(a.start.row,a.end.row),d=Math.max(a.start.row,a.end.row);l&&d!==c&&_.qm({environment:this.environment,collectionContextStore:s,property_type:l,num_rows:d-c}),this.stores.dragAndFillStore.reset()}setSelection(e){const{selection:t,shouldNormalize:o}=e,i=this.props.collectionContextStore.collectionViewBlockStore();i&&(Ds.Z5({environment:this.environment,selectionKey:{collectionViewBlockStore:i,groupFormat:this.props.groupFormat},selection:o?this.normalizeTableSelection(t):t}),this.selectionStartRectStore.recompute())}getCellPositionOfStore(e,t){const o=this.allRowsStore.state;return{col:this.props.showPropertyFormats.findIndex((e=>e.property===t)),row:o.findIndex((t=>e===t))}}getRowsWrapRect(){return this.rowsWrapEl?this.rowsWrapEl.getBoundingClientRect():void 0}updateSelectionScroll(e){const t=this.normalizedTableSelectionStore.state;if(t){let o;o=e===zl.Down?t.start.row>t.end.row?t.start:t.end:e===zl.Up?t.start.row<t.end.row?t.start:t.end:e===zl.Right?t.start.col>t.end.row?t.start:t.end:t.start.col<t.end.row?t.start:t.end;const i=this.allRowsStore.state[o.row],r=this.props.showPropertyFormats[o.col].property,n=tl.Z.findBlockPropertyValue(i,r),s=(null==n?void 0:n.getNode())??null;if(s){const e=this.frozenSectionWidthStore.state??0,o=this.frozenIndex.state,i=this.props.disableHorizontalEdgeScroll||o&&t.start.col<=o&&t.end.col<=o;z.bx({element:s,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:i?void 0:{reveal:"closest",paddingToLeftEdge:e},scrollers:{verticalScroller:null==n?void 0:n.getContextVerticalScroller(),horizontalScroller:null==n?void 0:n.getContextHorizontalScroller()}})}}}scrollToStart(){var e;const{collectionContextStore:t}=this.props;if(!t.frozoneStore.state.isScrolled)return;const o=this.allRowsStore.state[0],i=this.props.showPropertyFormats[0].property,r=tl.Z.findBlockPropertyValue(o,i),n=t.frozoneStore.state.scrollerLeftOffset??0,s=(0,Al.Wk)(this.environment),l=Math.max(s-n,0),a=(0,yi.iZ)(this.environment,t)?l:0;null==r||null===(e=r.getContextHorizontalScroller())||void 0===e||e.scrollTo(void 0,this.props.paddingLeft-a)}copyValuesToSelectionFromStart(e){const{transaction:t,selection:o,start:i}=e,{showPropertyFormats:r}=this.props,n=this.allRowsStore.state,s=r[i.col],l=n[i.row].getPropertyValue(s.property)||[],a=Math.min(o.start.row,o.end.row),c=Math.max(o.start.row,o.end.row);n.slice(a,c+1).forEach((e=>{e.pointer!==n[i.row].pointer&&ho.sO({store:e.getPropertyStore(s.property),value:l,transaction:t})}))}normalizeTableSelection(e){const t=this.props.showPropertyFormats.length,o=this.allRowsStore.state.length;return{start:{col:(0,jl.Z)(e.start.col,0,t-1),row:(0,jl.Z)(e.start.row,0,o-1)},end:{col:(0,jl.Z)(e.end.col,0,t-1),row:(0,jl.Z)(e.end.row,0,o-1)}}}getCellRect(e){const{rowsWrapEl:t}=this;if(!t)return;const{showPropertyFormats:o}=this.props,i=o,r=function(e,t){if(!t)return;const o=Gl.C.findSelectablesFromStore(e),i=o.map((e=>e.getNode())).find((e=>t.contains(e)));if(!i)return;return i.getBoundingClientRect()}(this.allRowsStore.state[e.row],t);if(!r)return;const n=t.getBoundingClientRect(),s=r.height,l=r.top-n.top-1,a=i[e.col].width||0,c=s+1;let d=Ql(this.props.collectionContextStore,this.environment);for(let p=0;p<e.col;p++){const e=i[p];e.width&&(d+=e.width)}return new DOMRect(d-1,l,a+1,c)}}Hl.displayName="TableSelectionOverlay",Hl.contextTypes={...li.wK,...s.w};function Kl(e){var t;window.__c={n:"DragAndFillHandle"};const{store:o,schema:i,selection:r,dragAndFillStore:n,currentRowsStore:s,showPropertyFormats:l,selectionStartRectStore:a,rowsWrapRect:d,frozenIndexStore:p}=e,u=(0,c.VK)((()=>n.state),[n]),h=(0,c.VK)((()=>{const e=(null==u?void 0:u.start)||r.start;return l[e.col]}),[u,r,l]),m=(0,j.useIntl)(),g=(0,c.VK)((()=>{if(!u||!h)return[];const{start:e}=u,t=s.state[e.row].getModel();return t?(0,Fl.v4)({property:h.property,schema:i,block:t,getRecordValue:o.getRecordValue,userTimeZone:(0,Ee.r)(),baseURL:void 0,intl:m}):""}),[s,u,m,h,i,o]),S=h?null===(t=i[h.property])||void 0===t?void 0:t.type:void 0,f=(0,c.VK)((()=>a.state),[a]),y=(0,c.VK)((()=>p.state),[p]),v=(0,c.VK)((()=>void 0!==y&&r.start.col<=y),[y,r]),C=(0,ee.yK)((e=>({dragAndFillContainer:{zIndex:v?M.hc+4:void 0,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:v?"sticky":void 0,left:"0"},tooltipContainer:{position:"absolute",left:f?f.left+f.width-5:void 0,zIndex:M.IK},tooltipOrigin:{position:"absolute",left:0,top:f?f.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:f?f.bottom-5:void 0,width:9,height:9,border:`2px solid ${fe.ZP.blueWithAlpha(.57)}`,transform:u?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...R.Z.textOverflowStyle}})),[v,f,u]);if(!f)return null;if(!S||Se.ZY(S)||"rollup"===S||"formula"===S||"verification"===S)return null;let x;return d&&(x=new DOMRect(f.x+d.x+f.width-4,f.y+d.y+f.height-4,7,7)),(0,je.jsx)(Je.ZP,{renderTooltip:()=>{const e=(0,je.jsx)(j.FormattedMessage,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"});return u?(0,je.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[e,(0,je.jsx)("div",{style:C.tooltipText,children:g})]}):e},delayThreshold:300,forceVisibleState:!!u||void 0,originRect:x,placement:zn.u.Right,render:e=>(0,je.jsx)("div",{...e,className:eo.JR_,style:C.dragAndFillContainer,children:(0,je.jsx)("div",{style:C.dragAndFillOutsideStickyWrapper,children:(0,je.jsx)("div",{style:C.dragAndFillInsideStickyWrapper,children:(0,je.jsxs)("div",{style:C.tooltipContainer,children:[(0,je.jsx)("div",{style:C.tooltipOrigin}),(0,je.jsx)("div",{style:C.tooltipCircle})]})})})})})}function Wl(e){window.__c={n:"TableSelectionOverlayWithDeps"};const{value:t}=(0,Ol.useDependency)(Ol.deps.markdownLinkifyIt),{value:o}=(0,Ol.useDependency)(Ol.deps.tinyMceMicrosoftWordPasteFilter);return(0,je.jsx)(Hl,{...e,markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:o})}function Ul(e){let t=e;for(;null!==t&&!t.classList.contains(eo.mWS);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function $l(e,t){const o=t.permissionScopes.state;return!e&&o.canEditContent}function ql(e,t){if(!(0,Zl.zq)(t))return!0;const o=e.state;return!o.isOpen||0===o.additionalStores.length}function Ql(e,t){return(0,re.fk)({environment:t,collectionContextStore:e})?yi.Xx:0}function Yl(e){window.__c={n:"TableShimmer"};const{isFullScreen:t,hasGroups:o,propertyWidths:i,hasPartialResults:r,hasSearchQuery:n,frozoneProps:s}=e,l=(0,ne.O7)(),a=(0,ee.Fg)(),d=(0,ne.Fy)().isPhone,p=(0,Ir.DK)(),u=(0,si.Z)(!0,0,100),h=(0,c.VK)((()=>Boolean(null==p?void 0:p.normalizedFormatStore.state.hide_table_vertical_lines)),[p]),m=(0,c.VK)((()=>!!p&&(0,re.fk)({environment:l,collectionContextStore:p})),[p,l]),g=s.isScrolled,S=s.frozenIndex,f=void 0!==S,y=(0,c.VK)((()=>{if(!p)return!1;const e=p.collectionViewBlockStore();return!!e&&(0,An.sY)(e)}),[p]),v=(0,c.VK)((()=>p?(0,yi.oc)({environment:l,collectionContextStore:p,isPhone:d,theme:a}):{}),[p,l,d,a]),C=(0,ee.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...v,...-1===S?{background:void 0}:{}},multiselectCheckbox:{display:"flex",flexDirection:"row",pointerEvents:"none",cursor:"pointer",...v},rowContainer:{display:"flex",alignItems:"flex-start",padding:f?void 0:"0px 16px",borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:f?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:h?void 0:`1px solid ${e.tableDividerColor}`}})),[v,S,f,h]);if(!u||!p)return null;const x=i.map(((e,t)=>(0,je.jsx)("div",{style:{...C.column,width:e},children:(0,je.jsx)(Vr.Z,{style:{...C.rowShimmer,width:.6*(e-16)}})},t)));let b=null,w=[];if(f&&void 0!==S){const e=x.slice(0,S+1);b=(0,je.jsxs)("div",{style:C.frozenColumnsContainer,children:[(0,je.jsxs)(Cl,{isCollectionViewBlockSelected:y,shouldFreeze:-1!==S,children:[m&&(0,je.jsx)("div",{style:{width:32,height:31}}),e]}),e.length>0?(0,je.jsx)(rs,{passesFilter:!0,isShimmerRow:!0,isScrolled:g}):null]}),w=x.slice(S+1,x.length)}else w=x;let k=1;o||r||n||(k=t?10:3);const P=[...Array(k)].map(((e,t)=>(0,je.jsxs)("div",{style:C.rowContainer,children:[b,w]},t)));return(0,je.jsx)("div",{style:C.container,children:(0,je.jsx)("div",{style:C.rowsContainer,children:P})})}const Xl=r.memo((function(e){window.__c={n:"TableGroupResults"};const{groupFormat:t,store:o,format:i,schema:n,query:s,collectionContextStore:a,showHoverActionsStore:d,isFullScreen:u,isInPeekRenderer:h,disabled:m,blockPropertyValueOverlayStore:g,minWidth:S,paddingBottom:f,paddingLeft:y,tableStore:v}=e,C=(0,ne.O7)(),x=(0,ne.Fy)(),b=(0,r.useContext)(li.ZO),w=(0,c.VK)((()=>{const e=t?[t]:[];return a.groupsStore.getGroupState(e)}),[t,a]),k=(0,c.VK)((()=>{const e=function(e,t){const o=ea(e,t);return o&&o.table_properties?o.table_properties:[]}(i,v).filter((e=>e.visible));return x.isMobile?e.slice(0,20):e}),[x.isMobile,i,v],{useDeepEqual:!0}),P=(0,c.VK)((()=>null==w?void 0:w.reducerResultStore.state),[w]),T=(0,c.VK)((()=>void 0!==P),[P]),V=(0,c.VK)((()=>a.permissionScopes.state),[a]),M=(0,Ln.PE)(e.store,e.disabled),_=(0,c.VK)((()=>!!M&&(!V.isSyncedCollection&&V.canEditContent)),[M,V]),I=(0,c.VK)((()=>Boolean(T&&_&&a.shouldAllowNewItemCreation())),[_,a,T]),B=(0,c.VK)((()=>k.reduce(((e,t)=>e+(t.width||0)),0)+(V.canEditContent?32:0)),[k,V]),D=(0,c.VK)((()=>k.map((e=>e.width||no.Nx))),[k]),L=(0,c.VK)((()=>k.findIndex((e=>"title"===e.property))),[k]),Z=(0,c.VK)((()=>{const e=t?[t]:[],o=(0,Fo.A7)(e[0],a);return Oo.default.state.stores.filter((e=>o.includes(e))).length>0}),[t,a]),E=(0,c.VK)((()=>{const{device:e,ThemeModeStore:t}=C,{isScrolled:o,frozenIndex:i,tryShowHiddenFrozenColumn:r}=a.frozoneStore.state;if(void 0===i)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const n=(0,fe.gh)({theme:t.state}),s={...(0,yi.oc)({environment:C,collectionContextStore:a,isPhone:e.isPhone,theme:n}),display:"flex",...o&&-1===i&&{height:"calc(100% + 1px)",borderBottom:`1px solid ${n.tableDividerColor}`}},l=Boolean(o&&-1===i),c=Boolean(l&&(r||Z)),d=a.collectionViewBlockStore(),p=!!d&&(0,An.sY)(d);return{isScrolled:Boolean(o),frozenIndex:i,frozenStyles:s,shouldFreezeMultiSelectColumn:l,shouldShowStickyMultiSelectColumn:c,isCollectionViewBlockSelected:p}}),[Z,a,C],{useDeepEqual:!0}),O=(0,c.VK)((()=>re.VM({collectionContextStore:a,reducerResult:P,isFullScreen:u})),[a,u,P]),G=(0,r.useMemo)((()=>t?[t]:[]),[t]),z=(0,r.useMemo)((()=>void 0!==P&&P.blockIds.length>0),[P]),H=(0,c.VK)((()=>""!==a.searchQuery.state),[a]),W=(0,c.VK)((()=>Kt({collectionContextStore:a,groupsPointer:G,hasPartialResults:z})),[a,G,z]),U=(0,c.VK)((()=>a.viewIsFlushToTopbar()),[a]),q=(0,c.VK)((()=>Boolean(a.normalizedFormatStore.state.hide_table_vertical_lines)),[a]),Q=(0,c.VK)((()=>{const e=a.collectionViewStore();return _&&x.isMobile&&!(null!=e&&e.isSyncedCollection())}),[_,a,x.isMobile]),Y=(0,c.VK)((()=>$t({collectionContextStore:a,groupsPointer:G})),[a,G]),X=(0,c.VK)((()=>ea(i,v)),[i,v]),J=(0,r.useCallback)((()=>{if(!w)return;const e=a.collectionStore();if(!e||!a.shouldAllowNewItemCreation())return;const t=Oo.default.state.stores[0];if(!t)return;const o=a.subitemTreeStore.state,i=(0,fi.DY)(o.children,(e=>e.value.store===t));if(!i)return;const r=i?(0,Fo.Af)(i.map((e=>e.value.store))):"",n=a.subitemExpandedStore.state.get(r);Boolean(null==n?void 0:n.isExpanded)&&$.createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:C,perform:o=>{const r=A.yk({environment:C,collectionContextStore:a,groupsPointer:w.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:i,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});r&&g&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{po.bA({isNewBlock:!0,environment:C,blockPropertyValueOverlayStore:g,store:r,property:"title",format:fo.C.Table,collectionContextStore:a})}))}))}})}),[g,a,C,w]),te=(0,r.useCallback)((e=>{const o=new Bn.sA(C,"handleAddRowClick"),i=t?[t]:[],r=a.groupsStore.getGroupState(i);ge.M_(C)&&r?(a.searchQuery.state&&de.Ug({searchQuery:"",collectionContextStore:a,isFullScreen:u}),$.createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:C,perform:i=>{const n=A.IW({environment:C,collectionContextStore:a,groupsPointer:t?[t]:[],shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"table_group_results",tracker:o,useCrdt:(0,io.SL)(e,"collection_table_view")});if(!n)return;const s=n.newStore;if(x.isMobile){const e=(0,_o.ZP)({store:s,fullyQualified:!1,pageVisitSource:p.tY.Create});b?b(e):N.c4({environment:C,url:e})}else{l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{n.coercionSucceeded?po.bA({isNewBlock:!0,environment:C,blockPropertyValueOverlayStore:g,store:s,property:"title",format:fo.C.Table,collectionContextStore:a}):ie.CH({environment:C,store:s,peekMode:re.kr(a.collectionViewStore()),resultsStore:r.resultsStore,collectionContextStore:a,pageVisitSource:p.tY.Create})}))}))}));const e=a.currentSubitemFormatStoreForCollection.state;ce.W(C,{from:e?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:s.id,creating_block_id:s.id,...(0,pe.Pn)(a)})}}})):o.fail("invalid_state")}),[g,a,x.isMobile,C,t,u,b]),oe=(0,r.useCallback)((e=>{const o=a.groupsStore.getGroupState(t);if(!o)return;const i=o.reducerResultStore.state;(0,ue.Wi)(e),K.ZH(C),i&&A.ID({collectionContextStore:a,environment:C,incrementLimitArgs:{isFullScreen:u,currentResultCount:i.blockIds.length,groupsPointer:o.groupsPointer,incrementLimitsInRelatedGroups:!1}}),Li.j({name:"collection_load_more"}),F.uD(C)}),[a,C,t,u]),se=(0,c.VK)((()=>{var e;return null===(e=a.inheritedBlockColorStore.state)||void 0===e?void 0:e.background}),[a]),le=(0,ee.yK)((e=>({iconStyle:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},loadMoreButton:{display:"flex",alignItems:"center",height:ia+1,width:"100%",paddingLeft:na,paddingBottom:2,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${e.tableDividerColor}`,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...Y?{background:e.whiteButtonBackground}:{}},loadMoreButtonInner:{display:"flex",alignItems:"center",color:e.lightTextColor,position:"sticky",left:na},addRowButton:{borderBottom:`1px solid ${e.tableDividerColor}`,display:"flex",alignItems:"center",height:ia,width:"100%",paddingLeft:8,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:se||(h?e.cardContentBackground:e.contentBackground),left:0,right:0},addRowButtonInner:{display:"inline-flex",alignItems:"center",position:"sticky",left:8,color:e.lightTextColor},aggregationRow:{...!T&&{opacity:0,pointerEvents:"none",left:0,right:0}},aggregationRowPlaceholder:{height:ra}})),[se,h,Y,T]);if(!w)return null;const he=T&&!W&&0===(null==P?void 0:P.blockIds.length),me=Boolean(t),Se=U&&!me;return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(dl,{store:o,format:X,groupFormat:t,schema:n,query:s,collectionContextStore:a,isInPeekRenderer:h,minWidth:S,paddingBottom:f,blockPropertyValueOverlayStore:g,resultStore:w.reducerResultStore,showPropertyFormats:k,showRightActions:V.canConfigureCollection&&V.canConfigureBlock,allowHidingTitle:!1,tableStore:v,formatKey:"table_properties",disabled:m||!V.canConfigureCollection&&!V.canConfigureBlock,disableTopBorder:!Se,disableCellRightBorder:!Se||q,height:oa,frozoneProps:E}),(0,je.jsx)("div",{style:{height:oa}}),(0,je.jsx)(Wl,{store:o,format:X,schema:n,query:s,collectionContextStore:a,minWidth:S,blockPropertyValueOverlayStore:g,showPropertyFormats:k,disabled:!_,groupFormat:t,tableStore:v,paddingLeft:y,render:e=>(0,je.jsx)(Jl,{args:e,store:o,collectionContextStore:a,collectionViewFormat:X,blockPropertyValueOverlayStore:g,groupFormat:t,propertyFormats:k,schema:n,canDrag:Q,disabled:m,titleColumnIndex:L,onShiftEnter:J,frozoneProps:E})}),W&&(0,je.jsx)(Yl,{isFullScreen:u,hasGroups:void 0!==t,propertyWidths:D,hasPartialResults:z,hasSearchQuery:H,frozoneProps:E}),he&&(0,je.jsx)(Yn,{collectionContextStore:a,shouldShowAddRowButton:I,handleAddRowClick:te,paddingLeft:y}),(0,je.jsx)("div",{style:{width:B}}),O&&(0,je.jsx)(xo.Z,{onMouseDown:ue.$0,onClick:oe,disabled:Y,hoveredStyle:le.loadMoreButtonHovered,style:le.loadMoreButton,children:(0,je.jsxs)("span",{style:le.loadMoreButtonInner,children:[(0,Si.M)(le.iconStyle),(0,je.jsx)(j.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"}),Y?(0,je.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,je.jsx)(Ke.Z,{style:{width:12,height:12}})}):_&&(0,je.jsx)(Oi,{collectionContextStore:a,format:i})]})}),I&&(0,je.jsx)(xo.Z,{onClick:te,onMouseDown:ue.$0,style:le.addRowButton,className:eo.tfM,children:(0,je.jsxs)("span",{style:le.addRowButtonInner,children:[(0,ae.R)(le.iconStyle),(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.tableView.addRowButton"})]})}),(0,je.jsx)(qn,{groupFormat:t,disabled:m||!V.canConfigureBlock,schema:n,query:s,collectionContextStore:a,isInPeekRenderer:h,isFullScreen:u,showPropertyFormats:k,showRightActionsSpacer:V.canConfigureCollection,showHoverActionsStore:d,style:le.aggregationRow}),(0,je.jsx)("div",{style:le.aggregationRowPlaceholder})]})}),Qt.Z),Jl=r.memo((function(e){window.__c={n:"TableSelectionOverlayInner"};const t=(0,ne.O7)(),{args:o,store:i,collectionContextStore:n,collectionViewFormat:s,blockPropertyValueOverlayStore:a,groupFormat:d,propertyFormats:p,schema:u,canDrag:h,disabled:m,titleColumnIndex:g,onShiftEnter:S,frozoneProps:f}=e,y=(0,r.useMemo)((()=>d?[d]:[]),[d]),v=(0,c.VK)((()=>n.permissionScopes.state),[n.permissionScopes]),C=(0,c.VK)((()=>Boolean(n.normalizedFormatStore.state.hide_table_vertical_lines)),[n.normalizedFormatStore]),x=(0,c.VK)((()=>re.fk({environment:t,collectionContextStore:n})),[n,t]),b=(0,c.VK)((()=>i.isLocked()),[i]),w=(0,ee.yK)((e=>({itemSelectableHalo:{borderRadius:0,zIndex:M.IK}})),[]),k=(0,ee.Fg)(),P=(0,r.useCallback)((()=>({display:"flex",height:"calc(100% + 2px)",borderBottom:`1px solid ${k.tableDividerColor}`})),[k.tableDividerColor]),T=(0,r.useCallback)((e=>{const{store:o,parentStore:i,subitemPath:r,indentLevel:s}=e;if(i)return(0,je.jsx)(Dn,{store:o,collectionStore:i,subitemPath:r,indentLevel:s,collectionContextStore:n,disabled:m,groupsPointer:y,onSubitemCreate:e=>{a&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{po.bA({isNewBlock:!0,environment:t,blockPropertyValueOverlayStore:a,store:e,property:"title",format:fo.C.Table,collectionContextStore:n})}))}))}})}),[a,n,m,t,y]),V=(0,r.useMemo)((()=>({schema:u,collectionContextStore:n,propertyFormats:p,onPropertyTab:o.onPropertyTab,onPropertyUntab:o.onPropertyUntab,onPropertyEnter:o.onPropertyEnter,onPropertyClick:o.onPropertyClick,onPropertyEsc:o.onPropertyEsc,onPropertyBgClick:o.onPropertyBgClick,onPropertyContextMenu:o.onPropertyContextMenu,onOpenProperty:o.onOpenProperty,disabled:m,blockPropertyValueOverlayStore:a,showRightActionsSpacer:v.canConfigureCollection,disableCellBorderRight:C,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:!v.canConfigureCollection||b,disableTableWrap:!1,onShiftEnter:S,titleColumnIndex:g,groupFormat:d,frozoneProps:f,shouldShowMultiSelectCheckbox:x})),[o.onOpenProperty,o.onPropertyBgClick,o.onPropertyClick,o.onPropertyContextMenu,o.onPropertyEnter,o.onPropertyEsc,o.onPropertyTab,o.onPropertyUntab,a,n,m,C,S,v.canConfigureCollection,p,u,g,d,f,x,b]);return(0,je.jsx)(Ii,{collectionContextStore:n,groupsPointer:y,format:s,canDrag:h,resultProps:V,canDrop:!0,resultComponent:Ml,disabled:m,direction:Fi.Vertical,getItemSelectableStyle:P,itemSelectableHaloStyle:w.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:o.onSelectableEnter,blockPropertyValueOverlayStore:a,titleColumnIndex:g,nestedCreateSubitemButton:T})}),Qt.Z);function ea(e,t){const{temporaryFormat:o}=t.state;return o||e}const ta={position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums"},oa=34,ia=32,ra=32,na=8;class sa extends Ro.Z{constructor(){super(...arguments),this.storeTypes={tableStore:In},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=(e,t,o)=>function(e,t,o,i,r){!function(e,t,o,i){if(i.device.isMobile)oe._({environment:i,store:e,pageVisitSource:p.tY.Create});else{const{groupFormat:r}=t,n=r?[r]:[],s=o.groupsStore.getGroupState(n);ie.CH({environment:i,store:e,peekMode:re.kr(o.collectionViewStore()),resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:o,pageVisitSource:p.tY.Create})}}(e,o,r,i)}(e,0,o,this.environment,this.props.collectionContextStore),this.viewSettingsSidebarOpen=this.createComputedStore((()=>{var e;return this.props.collectionContextStore.settingsStore.state.open&&"sidebar"===(null===(e=this.props.viewSettingsPlacementStore)||void 0===e?void 0:e.state)}))}renderPersisted(){const{store:e,paddingBottom:t,paddingLeft:o,paddingRight:i,isFullScreen:r,collectionContextStore:n,format:s}=this.props,l=re.az(n,r),a=s.collection_group_by,c=n.isCompactView.state;return(0,ci.Z)((s=>{const d=(0,je.jsx)(_t.Z,{store:e,shouldShowHalo:!r&&!c,canSelect:!r,analyticsName:"table",style:{position:"relative"},...s,children:a?this.renderGroups(a):(0,je.jsx)(da,{store:this.props.store,format:this.props.format,schema:this.props.schema,query:this.props.query,collectionContextStore:this.props.collectionContextStore,showHoverActionsStore:this.props.showHoverActionsStore,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,disabled:this.props.disabled,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,minWidth:this.props.minWidth,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,tableStore:this.stores.tableStore,groupFormat:void 0})});return(0,je.jsxs)("div",{style:{...ta,paddingBottom:t,paddingLeft:o,paddingRight:i+(this.viewSettingsSidebarOpen.state?J.nJ+20:0)},className:eo._so,children:[a?d:(0,je.jsx)(Xi,{renderEmitter:n.renderEmitter,isFullScreen:r,children:d}),!l&&(0,je.jsx)($r.Z,{onChange:e=>function(e,t,o,i){const r=t.isLoading.state,n=t.groupsStore.getGroupState([]),s=null==n?void 0:n.reducerResultStore.state;e<oo.Z.incrementScrollOffset&&s&&!r&&s.hasMore&&(t.infiniteScrollLongTaskObserver.observe(),A.ID({collectionContextStore:t,environment:i,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}(e,this.props.collectionContextStore,this.props.isFullScreen,this.environment)})]})}))}renderGroups(e){const{store:t,format:o,collectionContextStore:i,schema:r,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,be.hJ)()?(0,je.jsx)(zr,{type:"table_groups",store:t,collectionContextStore:i,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!0,renderGroup:e=>(0,je.jsx)(da,{store:this.props.store,format:this.props.format,schema:this.props.schema,query:this.props.query,collectionContextStore:this.props.collectionContextStore,showHoverActionsStore:this.props.showHoverActionsStore,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,disabled:this.props.disabled,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,minWidth:this.props.minWidth,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,tableStore:this.stores.tableStore,groupFormat:e}),getGroupStyle:e=>aa(e,this.props.collectionContextStore,this.theme),renderHeader:e=>(0,je.jsx)(ca,{args:e,isInPeekRenderer:this.props.isInPeekRenderer}),onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem}):(0,je.jsx)(Mn,{store:t,id:"table_groups",groupBy:e,groupsFormatKey:te.Uh,groupAggregationKey:te.dQ,format:o,schema:r,collectionContextStore:i,disabled:n,isFullScreen:s,renderGroup:e=>(0,je.jsx)(da,{store:this.props.store,format:this.props.format,schema:this.props.schema,query:this.props.query,collectionContextStore:this.props.collectionContextStore,showHoverActionsStore:this.props.showHoverActionsStore,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,disabled:this.props.disabled,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,minWidth:this.props.minWidth,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,tableStore:this.stores.tableStore,groupFormat:e}),renderHeader:e=>(0,je.jsx)(ca,{args:e,isInPeekRenderer:this.props.isInPeekRenderer}),onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,paddingLeft:l,getGroupStyle:e=>aa(e,this.props.collectionContextStore,this.theme),isRootChild:a,isInPeekRenderer:c,stickyLeft:!0})}}sa.displayName="Table";const la=(0,j.injectIntl)(sa);function aa(e,t,o){const i=t.viewIsFlushToTopbar();if(0===e.index&&!i)return{};return t.shouldShowSpinner.state&&e.index>0?{}:{borderTop:`1px solid ${o.tableDividerColor}`}}function ca(e){let{args:t,isInPeekRenderer:o}=e;window.__c={n:"GroupHeaderComponent"};const{collectionContextStore:i}=t,r=(0,ee.Fg)(),n=(0,c.VK)((()=>i.isCompactView.state),[i]);return(0,je.jsx)(Dt,{...t,height:n?to.yZ:42,paddingTop:8,toggleClosedMarginBottom:8,getComputedStickyStyle:e=>function(e,t,o){return{boxShadow:e?`0 -1px 0 ${t?o.cardContentBackground:o.contentBackground}`:void 0}}(e,o,r)})}function da(e){let{groupFormat:t,store:o,format:i,schema:r,query:n,collectionContextStore:s,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:d,disabled:p,blockPropertyValueOverlayStore:u,minWidth:h,paddingBottom:m,paddingLeft:g,tableStore:S}=e;window.__c={n:"GroupResultsComponent"};const f=(0,c.qz)(S,In);return(0,c.VK)((()=>s.groupsStore.getGroupState(t?[t]:[])),[s,t])?(0,je.jsx)(Xl,{tableStore:f,groupFormat:t,store:o,format:i,schema:r,query:n,collectionContextStore:s,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:d,disabled:p,blockPropertyValueOverlayStore:u,minWidth:h,paddingBottom:m,paddingLeft:g}):null}var pa=o(9999),ua=o(39567),ha=o(76798),ma=o(44862);const ga=function(e){const{store:t,titleStyle:o,actionButton:i,collectionContextStore:r}=e;return(0,je.jsxs)("div",{children:[(0,je.jsxs)("div",{style:{display:"flex"},children:[(0,je.jsx)(ha.Z,{store:t,style:o}),i]}),(0,je.jsx)(ma.Z,{collectionStore:t,collectionContextStore:r})]})};var Sa=o(19987),fa=o(50627),ya=o(85720);const va=(0,j.defineMessages)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"}});class Ca extends s.Z{constructor(){super(...arguments),this.isEditingName=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return!1;const o=t.getNameStore();return Boolean((0,ya.J5)(o))})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>{const{store:e}=this.props,t=Eo.default.state;return(0,re.Ks)(e)||!(0,re.en)(e)&&t.open&&t.isClosing}))}renderComponent(){var e;const{collectionContextStore:t,isFullScreen:o,canEdit:i}=this.props,r=t.collectionStore(),n=t.permissionScopes.state,s=t.collectionViewBlockStore();if(!r||!s)return;const l=Boolean((null===(e=r.getParentBlockStore())||void 0===e?void 0:e.id)===s.id),a=Boolean(r.isSyncedCollection()),c=this.isEditingName.state,d=this.isInFrameWhenSidePeekOpen.state,{WindowSizeStore:p}=this.environment,u=Math.min(fa.zL,p.state.width),h=(l||c)&&n.canConfigureCollection&&!a;return(0,je.jsxs)("div",{style:{...(o||d)&&(0,he.eA)(this.environment)&&{position:"sticky",left:0},paddingTop:8,boxSizing:d?"content-box":void 0,width:d?u:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[h?(0,je.jsx)(Fa,{collectionContextStore:this.props.collectionContextStore,showHoverActionsStore:this.props.showHoverActionsStore}):(0,je.jsx)(ja,{collectionContextStore:this.props.collectionContextStore,showHoverActionsStore:this.props.showHoverActionsStore}),a&&(0,je.jsx)("div",{style:{display:"flex"},children:(0,je.jsx)(Sa.Z,{canEdit:i,store:s,buttonStyle:{margin:0}})})]})}}Ca.displayName="CollectionViewBlockSource";const xa=(0,j.injectIntl)(Ca);function ba(){return{fontWeight:R.Z.fontWeight.bold,fontSize:22}}function wa(e){const t=e.collectionStore();if(!t)return;const o=t.getParentBlockStore();return o?(0,_o.ZP)({store:o,fullyQualified:!1,pageVisitSource:p.tY.Breadcrumb}):void 0}function ka(e){const t=e.collectionStore();if(!t)return 22;return t.isSyncedCollection()?58:22}function Pa(e,t){return{width:24,height:t?24:16,fill:e.regularIconColor}}function Ta(e){let{parent:t,collectionContextStore:o}=e;window.__c={n:"ActionsPopupComponent"};const i=(0,ee.Fg)(),r=(0,ne.O7)(),n=(0,c.VK)((()=>o.permissionScopes.state),[o]),s=(0,c.VK)((()=>o.collectionStore()),[o]),l=(0,c.VK)((()=>null==s?void 0:s.isSyncedCollection()),[s]);if(!s)return null;const a=w.oA([{key:"view",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,pa.J)(Pa(i))}),action:e=>{const i=wa(o);if(!i)return null;const n=ai.DJ(e.event);N.c4({environment:r,url:i,openInNew:n}),n||t.close(),_.wd({environment:r,collectionContextStore:o,action:"click_source_view"})}},n.canConfigureCollection&&!l&&{key:"edit_name",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,so.R)(Pa(i))}),action:()=>{U.mT({environment:r,store:s.getNameStore(),canSelectAllBlocks:!1}),t.close(),_.wd({environment:r,collectionContextStore:o,action:"click_source_edit_title"})}}]),d={key:"show_title",render:e=>(0,je.jsx)(qe.Z,{...e,icon:(0,Ps.L)(Pa(i,!0)),title:(0,je.jsx)(j.FormattedMessage,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{const e=o.collectionViewStore();if(!e)return null;$.createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:r,perform:t=>{uo.FH({stores:[e],update:{hide_linked_collection_name:!0},transaction:t})}}),t.close(),_.wd({environment:r,collectionContextStore:o,action:"click_source_hide_title"})}};return(0,je.jsx)(Te.Z,{type:Te.i.Vertical,sections:w.oA([{key:"actions",render:e=>(0,je.jsx)(Re.Z,{...e}),items:a},n.canConfigureBlock&&{key:"show_title",render:e=>(0,je.jsx)(Re.Z,{...e,topBorder:!0}),items:[d]}]),initialFocus:void 0})}function Va(e){let{showHoverActionsStore:t,collectionContextStore:o}=e;window.__c={n:"ActionButtonComponent"};const i=(0,ne.O7)(),r=(0,c.VK)((()=>t.state),[t]);return(0,je.jsx)(On.Z,{isVisible:!0,animationStyle:{opacity:r?1:0},render:()=>(0,je.jsx)("div",{style:{display:"flex",alignItems:"center",marginLeft:4},children:(0,je.jsx)(Qe.ZP,{popupType:i.device.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,render:e=>(0,je.jsx)(Ta,{parent:e,collectionContextStore:o}),renderOrigin:e=>(0,je.jsx)(Ft.Z,{icon:le.o,...e}),style:{width:240},originGap:4})})})}function Ra(e){K.ZH(e)}function Ma(e){let{disabled:t,collectionContextStore:o}=e;window.__c={n:"IconComponent"};const i=(0,ee.Fg)(),r=(0,ne.O7)(),n=(0,c.VK)((()=>o.collectionStore()),[o]),s=(0,c.VK)((()=>o.collectionViewBlockStore()),[o]),l=(0,c.VK)((()=>null==n?void 0:n.getIcon()),[n]),a=(0,c.VK)((()=>{var e;return Boolean((null==n||null===(e=n.getParentBlockStore())||void 0===e?void 0:e.id)===(null==s?void 0:s.id))}),[n,s]),d=(0,c.VK)((()=>ka(o)),[o]),p=(0,c.VK)((()=>function(e){return{width:ka(e),height:ka(e),marginRight:4}}(o)),[o]),u=(0,c.VK)((()=>null==s?void 0:s.getType()),[s]);return n&&s?l?(0,je.jsxs)("div",{style:{position:"relative",width:d+2,height:d+2,marginRight:4},children:[t?(0,je.jsx)(ko.Z,{disabled:!0,bucket:"secure",store:n,icon:l,isEmptyPage:!1,style:p,size:d}):(0,je.jsx)(ko.Z,{disabled:!1,bucket:"secure",store:n,icon:l,isEmptyPage:!1,style:p,size:d,iconLoggingData:{recordTable:n.table,source:"inline_collection",block_type:u,collection_id:n.id},onChange:e=>function(e,t,o){const i=o.collectionStore();if(!i)return;const r=i&&i.getIconStore();r&&$.createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:t,perform:t=>{ho.sO({store:r,value:e,transaction:t})}})}(e,r,o)}),!a&&(0,ua.Y)({position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===i.mode?i.regularTextColor:"#3E3C38",stroke:"dark"===i.mode?i.sidebarBackground:"white",strokeWidth:"dark"===i.mode?"1.85px":"1.5px"})]}):a?null:(0,je.jsx)("div",{style:{width:20,marginRight:4},children:(0,pa.J)({width:20})}):null}function ja(e){let{collectionContextStore:t,showHoverActionsStore:o}=e;window.__c={n:"LinkButtonComponent"};const i=(0,ne.O7)(),r=(0,c.VK)((()=>t.collectionStore()),[t]),n=(0,c.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,c.VK)((()=>wa(t)),[t]);return r&&n?(0,je.jsxs)(wo.Z,{style:{width:"max-content",maxWidth:"100%",marginRight:4,...R.Z.textOverflowStyle},innerStyle:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:4},href:s,onClick:()=>function(e,t){_.wd({environment:e,collectionContextStore:t,action:"click_collection_name_link_button"})}(i,t),children:[(0,je.jsx)(Ma,{collectionContextStore:t,disabled:!0}),(0,je.jsx)(ga,{actionButton:(0,je.jsx)(Va,{showHoverActionsStore:o,collectionContextStore:t}),store:r,collectionContextStore:t,titleStyle:ba()})]}):null}function Fa(e){let{collectionContextStore:t,showHoverActionsStore:o}=e;window.__c={n:"NameInputComponent"};const i=(0,ne.O7)(),r=(0,c.VK)((()=>t.collectionStore()),[t]),n=(0,c.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,c.VK)((()=>null==r?void 0:r.getNameStore()),[r]);return r&&n&&s?(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4},children:[(0,je.jsx)(Ma,{collectionContextStore:t,disabled:!1}),(0,je.jsx)(To.Z,{store:s,style:{...ba(),marginRight:4},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:Ne.default.formatMessage(va.titlePlaceholder),onEnter:()=>Ra(i),onEsc:()=>Ra(i),onClick:()=>function(e,t){_.wd({environment:e,collectionContextStore:t,action:"click_collection_name_input"})}(i,t),disableShiftEnter:!0,pasteBehavior:"inline"}),(0,je.jsx)(Va,{showHoverActionsStore:o,collectionContextStore:t})]}):null}var _a=o(3943),Ia=(o(52262),o(24506),o(38297)),Ba=o(45953),Da=o(56518);const Aa=new(o(53809).D)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function La(e,t){let{lastActionWasCut:o,valuePromise:i}=t;const r=(0,Da.tt)(e);Aa.setState({eventId:r,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const n=await i;if(!n)return void Aa.setState({});const{recordMaps:s,...l}=n;Aa.setState({eventId:r,waitingForCopy:!1,lastActionWasCut:o,value:{...l,recordMapsJson:Oa(s)}})}function Za(e){const t=Aa.getState(),o=(0,Da.tt)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:i,value:r,lastActionWasCut:n}=t;return i?new Promise((e=>{Aa.addListener(function(e,t){return function o(i){const r=i.getState();if(!r)return void i.removeListener(o);const{waitingForCopy:n,value:s,lastActionWasCut:l}=r;n||r.eventId!==e||(i.removeListener(o),t(s?{lastActionWasCut:l||!1,value:{...s,recordMaps:Ea(s.recordMapsJson)}}:void 0))}}(o,e))})):r?Promise.resolve({lastActionWasCut:n||!1,value:{...r,recordMaps:Ea(r.recordMapsJson)}}):Promise.resolve(void 0)}function Ea(e){return new Map(e.map((e=>{let[t,o]=e;return[t,Ba.Ak.create(o)]})))}function Oa(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson({allowVersionDowngrade:!1})]}))}var Ga=o(80560),Na=o(30188),za=o(54532),Ha=o(79978),Ka=o(42858),Wa=o(58202);function Ua(){window.__c={n:"CollectionViewKeyboardArea"};const e=(0,ne.O7)(),t=(0,Ir.Y$)(),{value:o}=(0,Ol.useDependency)(Ol.deps.markdownLinkifyIt),{value:i}=(0,Ol.useDependency)(Ol.deps.tinyMceMicrosoftWordPasteFilter),n=(0,c.VK)((()=>{var e;const o=Oo.default.state.stores.filter((e=>Wa.R.findBlockFromStore(e))).at(0),i=null==o?void 0:o.getModel();if(!o||!i)return!1;const r=(0,Ia.ky)({block:i,getRecordModel:o.getRecordModel});return!!r&&r.id===(null===(e=t.collectionStore())||void 0===e?void 0:e.id)}),[t]),s=r.useCallback((t=>{Ga.JG({event:t,environment:e,markdownLinkifyIt:o});const i=Oo.default.state.stores;La(t,{lastActionWasCut:!1,valuePromise:$a(e).then((t=>{for(const i of t)F.dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0});const o=t.length>0;for(const r of i)F.dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:r.id,block_type:r.getType(),isBulk:o});return qa({environment:e,subitems:t})}))})}),[e,o]),a=r.useCallback((async t=>{Ga.JG({event:t,environment:e,markdownLinkifyIt:o});const i=Oo.default.state.stores,r=$a(e),n=$a(e).then((t=>{for(const i of t)F.dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0});const o=t.length>0;for(const r of i)F.dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:r.id,block_type:r.getType(),isBulk:o});return qa({environment:e,subitems:t})}));await La(t,{lastActionWasCut:!0,valuePromise:n});const s=Oo.default.getState().stores,l=await r;await Na.VP({blocks:s,subitems:l,environment:e,canUndo:!0,skipConfirmation:!0})}),[e,o]),d=r.useCallback((async r=>{var n,s,a,c;const d=await Za(r);if(Aa.setState({...Aa.getState(),lastActionWasCut:!1}),!d){const t=Oo.default.state.stores[0];return $.createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,perform:t=>{Ga.v({environment:e,event:r,disableEmbedMenu:!0,transaction:t,onPasteFiles:Ga.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:i})}}),void F.dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:!1})}const p=t.collectionViewBlockStore();if(!p)return;const u=t.collectionStore();if(!u)return;const{recordMaps:h,subitemFormat:m,childRelationSchema:g,parentRelationSchema:S}=d.value;if(!(h&&m&&g&&S))return;const f=[...h.entries()].map((e=>{let[t]=e;return me.G.createChildStore(u,{table:P.iU,id:t})}));await Promise.all(f.map((e=>e.load())));const y=Oo.default.getState().stores,v=!(d.lastActionWasCut&&function(e,t){const o=t.map((t=>me.G.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(u,f));let C=[],x=Fo.JR(t),b=null===(n=x)||void 0===n?void 0:n.parentRelationProperty,w=null===(s=x)||void 0===s?void 0:s.childRelationSchema,k=null===(a=x)||void 0===a?void 0:a.parentRelationSchema,T=null===(c=x)||void 0===c?void 0:c.subitemFormat;const V=t.permissionScopes.state.canConfigureCollection;for(const t of f)F.dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:d.value.isBulk});if($.createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,perform:n=>{if(!T&&V){Na.Bb({transaction:n,collectionContextStore:t,environment:e})&&(x=Fo.JR(t),x&&(b=x.parentRelationProperty,w=x.childRelationSchema,k=x.parentRelationSchema,T=x.subitemFormat))}if(!(b&&w&&k&&T))return void Ga.v({environment:e,event:r,disableEmbedMenu:!0,transaction:n,onPasteFiles:Ga.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:i});const s=v?Na.R2({blocks:f,environment:e,transaction:n,recordMaps:h,migrateSubitemFormat:{from:m,to:T},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:g,parentRelationSchema:S},analyticsFrom:d.lastActionWasCut?"cut":"copy"}):Na.cI({blocks:f,transaction:n,from:m,to:T,environment:e,subitemRelationSchema:w,relationPropertyCollectionId:u.id,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:i,subitemFormat:r,collectionContextStore:n,transaction:s}=e,l=n.collectionStore();if(!l)return;const a=o.at(-1),c=Fo.qb(i,r);if(0===c.length)return;if(a){const e=Fo.nK(n,a),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof me.G&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),a);c.forEach((e=>{Na.Cz({environment:t,block:e,collectionStore:l,subitemFormat:r,transaction:s}),o&&Ha.hE({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:r.inverse,inverse:r.property},transaction:s,position:{type:"after"}})}))}else c.forEach((e=>{Na.Cz({environment:t,block:e,collectionStore:l,subitemFormat:r,transaction:s})}))}({environment:e,selectedBlocks:y,blocksToInsert:s,subitemFormat:T,collectionContextStore:t,transaction:n}),Ka.is({environment:e,blocks:s,selection:y,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:!0}),C=s}}),!(b&&w&&k&&T))return;const R=Fo.T2({blocks:C,parentRelationProperty:b,parentRelationSchema:k,collectionViewBlockStore:p});l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{K.Z5({environment:e,stores:R})}))}))}),[t,e,o,i]);return(0,je.jsx)(bo.Z,{capture:n,onCopy:s,onCut:a,onPaste:d})}function $a(e){const t=Oo.default.getState().stores;return Na.xr({environment:e,blocks:t})}function qa(e){let{subitems:t,environment:o}=e;const i=Oo.default.getState().stores,r=i.at(0);if(!r)return;const n=(0,Fo.g0)(r);if(!n)return;const s=[...i,...t],l=w.oA(s.map((e=>{const t=za.K8(o,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0});return t&&[e.id,t]}))),a=new Map(l),{subitemFormat:c,childRelationSchema:d,parentRelationSchema:p}=n;return{recordMaps:a,subitemFormat:c,childRelationSchema:d,parentRelationSchema:p,isBulk:t.length>0}}var Qa=o(80503);var Ya=o(36488),Xa=o(68641),Ja=o(60709);class ec extends s.Z{constructor(){super(...arguments),this.storeTypes={placementStore:d.default.createClass(void 0),headerRectStore:d.default.createClass(void 0),shouldScrollIntoViewStore:d.default.createClass(!1)},this.lastPlacement=void 0,this.justOpened=!1,this.renderMenu=e=>{const{collectionContextStore:t}=this.props;if(!this.stores.shouldScrollIntoViewStore.state)return(0,je.jsx)(Y.P,{context:Xa.HV.ViewSettings,collectionContextStore:t,collectionSettingsStore:t.settingsStore,fullHeight:e})},this.sidebarLayoutStore=this.createComputedStore((()=>{const e=this.props.headerSizeObserver.rect.state,t=this.environment.WindowSizeStore.state.height,o=e.height-40;return{maxHeight:t-(e.top+40),moveUp:o}}))}UNSAFE_willMountOrUpdate(e){const{collectionContextStore:t,overridePlacement:o}=e,i=oc(this.props.collectionContextStore),r=this.stores.placementStore.state;i&&!r&&this.props.headerSizeObserver.recompute();const n=this.props.headerSizeObserver.rect.state;if(i&&!r&&n){const e=function(e,t,o,i){if(!oc(t))return;if(i)return i;const r=(null==e?void 0:e.width)||0;return o.device.isMobile||Eo.default.isSidePeekOpen()||!(t.isFullScreen.state||r>600)||t.isCompactView.state?"popup":"sidebar"}(n,this.props.collectionContextStore,this.environment,o);this.stores.placementStore.setState(e),this.justOpened=!0,this.lastPlacement=e}else this.justOpened=!1;i||this.stores.placementStore.setState(void 0),this.justOpened&&(!t.isFullScreen.state&&"popup"!==this.stores.placementStore.state||Eo.default.isSidePeekOpen())&&this.stores.shouldScrollIntoViewStore.setState(!0)}didMountOrUpdate(){const{collectionContextStore:e}=this.props,{shouldScrollIntoViewStore:t}=this.stores;if(t.state){const o=e.collectionViewBlockStore();if(o){const t=Wa.R.findCollectionViewBlockFromStore(o);if(t){const o=t.getNode();if(o){const t=o.getBoundingClientRect(),i=this.environment.WindowSizeStore.state.height-t.bottom,r=t.top;(i<J.j9||r<Qa.Aj||e.isInPeekRenderer.state)&&((0,he.Wr)(o,{edgeDist:0,animate:!1}),this.props.headerSizeObserver.recompute())}}}t.setState(!1)}}renderComponent(){const{paddingRight:e,collectionContextStore:t}=this.props,o=oc(this.props.collectionContextStore),i=this.lastPlacement,r=t.isFullScreen.state,n=t.viewIsFlushToTopbar(),s=function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(this.props.collectionContextStore),l=("timeline"===s||"table"===s)&&n;if(i){if("sidebar"===i){const t=this.sidebarLayoutStore.state;if(!t)return;const{maxHeight:i,moveUp:n}=t;return(0,je.jsx)(On.Z,{isVisible:o,enterAnimationStyle:{opacity:0,translateX:12},animationStyle:{opacity:1,translateX:0},exitAnimationStyle:{opacity:0,translateX:12},render:()=>(0,je.jsx)(Ya.Z,{capture:o,allowMobileAutoScroll:!0,allowUndo:!0,render:t=>(0,je.jsx)("div",{style:{position:"absolute",top:(l?1:0)-n,right:-e,height:`calc(100% + ${n}px)`,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,borderLeft:`1px solid ${this.theme.tableDividerColor}`,paddingRight:e,zIndex:M.Nm,...r&&{height:i},...!r&&{maxHeight:i}},className:eo.Dkf,...(0,ze.Z)({onMouseDown:e=>{return t=e,o=this.environment,void(0,ue.ZP)({event:t,context:ue.Af.EditorMouseDown,callback:()=>{U.ZH(o)}});var t,o}},t),children:(0,je.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,je.jsx)("div",{style:{boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`},children:this.renderMenu(!0)}),(0,je.jsx)("div",{style:{width:e}})]})})})})}return(0,je.jsx)(Xe.ZP,{popupType:this.environment.device.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,open:o,placementToOrigin:Ja.Iw.Bottom,alignmentToOrigin:Ja.lU.End,style:{marginTop:-1},origin:(0,je.jsx)("div",{}),render:this.renderMenu,onDismiss:e=>function(e,t){(0,ue.ZP)({event:e,context:ue.Af.CollectionSettingsClick,callback:()=>{L.E3({collectionSettingsStore:t.settingsStore})}})}(e,this.props.collectionContextStore),originRect:this.props.headerSizeObserver.rect.state,keepFocus:!0,trapFocus:!0})}}}ec.displayName="CollectionViewSettingsPopup";const tc=(0,j.injectIntl)(ec);function oc(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}var ic=o(78454);function rc(e){window.__c={n:"WikiHomeOnboardingTooltip"};const{origin:t}=e,o=(0,ne.O7)();return(0,je.jsx)(ls.U,{origin:t,placementToOrigin:"bottom",header:(0,je.jsx)(j.FormattedMessage,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{es.Rg(o)},shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:ds.EZ,pointerOffset:ds.rK,style:{width:ds.G5}})}function nc(e){window.__c={n:"WikiViewsOnboardingTooltip"};const{origin:t}=e,o=(0,ne.O7)();return(0,je.jsx)(ls.U,{origin:t,placementToOrigin:"right",header:(0,je.jsx)(j.FormattedMessage,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,je.jsx)("span",{style:{fontWeight:R.Z.fontWeight.semibold},children:e})}}),onCloseClick:()=>{es.Rg(o)},pointerPosition:"50%",pointerLength:ds.EZ,pointerOffset:ds.FD,shouldDismissUponOutsideClick:!0,style:{width:ds.G5}})}let sc;class lc{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;sc||(sc=document.createElement("div"),sc.style.position="absolute",sc.style.left="0",sc.style.top="0",sc.style.pointerEvents="none",sc.style.opacity="0",document.body.appendChild(sc)),w.M6(this.style,((e,t)=>{sc&&(sc.style[t]=e)})),sc.textContent=e;const o=sc.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}var ac=o(77794),cc=o(20616),dc=o(13401),pc=o(73657),uc=o(68894),hc=o(29798),mc=o(17215),gc=o(14976),Sc=o(55964),fc=o(27714),yc=o(53470);function vc(e){let{collectionViewStore:t,collectionContextStore:o,onClose:i}=e;window.__c={n:"CollectionViewActionMenu"};const r=(0,ne.O7)(),n=(0,j.useIntl)(),s=(0,ee.yK)((e=>({svgIcon:{width:24,height:16,fill:e.regularIconColor},svgIconPadded:{width:24,height:24,fill:e.regularIconColor}})),[]),l=(0,c.VK)((()=>{var e;const t=null===(e=o.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!t&&(0,wi.qG)(t)}),[o]),a=(0,c.VK)((()=>function(e){let{collectionViewStore:t,collectionContextStore:o,onClose:i,environment:r,intl:n,styles:s,isMyTasks:l}=e;const a=o.permissionScopes.state,c=o.collectionViewStore(),d=o.collectionViewBlockStore();if(!c||!d)return[];const p=c.id===t.id,u=t.getAppConfigUri(),h=u&&(0,Q.xB)(u),m=!l&&!h,g=[];if(g.push([]),a.canConfigureBlock){if(g[0].push({key:"rename",render:e=>(0,je.jsx)(Je.ZP,{placement:Je.ug.Left,disableTooltip:m,render:t=>(0,je.jsx)(qe.Z,{...e,disabled:!m,disabledFeedback:!0,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,yc.H)(s.svgIcon),...t}),renderTooltip:()=>(0,je.jsx)(j.FormattedMessage,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view can’t be renamed."})}),action:()=>{_.wd({environment:r,collectionContextStore:o,action:"view_action_menu_rename"}),null==i||i(!0),p||de.f8({environment:r,collectionContextStore:o,collectionViewId:t.id,isFullScreen:o.isFullScreen.state,isRootChild:o.isRootChild.state,isInPeekRenderer:o.isInPeekRenderer.state}),L.r$({collectionContextStore:o,collectionSettingsStore:o.settingsStore,selectViewNameInitial:!0})}}),"page"===t.getType())return g;g[0].push({key:"edit",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,Ms.W)(s.svgIcon)}),action:()=>{_.wd({environment:r,collectionContextStore:o,action:"view_action_menu_edit"}),null==i||i(!0),p||de.f8({environment:r,collectionContextStore:o,collectionViewId:t.id,isFullScreen:o.isFullScreen.state,isRootChild:o.isRootChild.state,isInPeekRenderer:o.isInPeekRenderer.state}),L.r$({collectionContextStore:o,collectionSettingsStore:o.settingsStore})}})}g.push([]),g[1].push({key:"copyLink",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,fc.N)(s.svgIcon)}),action:async()=>{_.wd({environment:r,collectionContextStore:o,action:"view_action_menu_copy_link"}),await L.Ol({environment:r,collectionContextStore:o,collectionViewStore:t}),null==i||i(!1)}});t.getFormat().hide_linked_collection_name&&a.canConfigureBlock&&g[1].push({key:"showDatabaseTitle",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}),icon:(0,Sc.N)(s.svgIconPadded)}),action:()=>{_.wd({environment:r,collectionContextStore:o,action:"click_source_show_title"}),$.createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:r,perform:e=>{uo.FH({stores:[t],update:{hide_linked_collection_name:!1},transaction:e})}}),null==i||i(!1)}});g.push([]),a.canConfigureBlock&&!l&&g[2].push({key:"duplicate",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,ks.a)(s.svgIcon)}),action:()=>{_.wd({environment:r,collectionContextStore:o,action:"view_action_menu_duplicate"}),L.zt({environment:r,collectionContextStore:o,collectionViewStore:t,collectionSettingsStore:o.settingsStore,intl:n}),null==i||i(!0)}});a.canConfigureBlock&&!l&&g[2].push({key:"delete",render:e=>(0,je.jsx)(qe.Z,{...e,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,Ce.y)(s.svgIcon)}),action:async()=>{_.wd({environment:r,collectionContextStore:o,action:"view_action_menu_delete"});await L.TT({environment:r,collectionContextStore:o,collectionViewStore:t,collectionSettingsStore:o.settingsStore,from:"view_action_menu"})&&(null==i||i(!1))}});return g}({collectionViewStore:t,collectionContextStore:o,onClose:i,environment:r,intl:n,styles:s,isMyTasks:l})),[o,t,r,n,l,i,s]);return(0,je.jsx)(Te.Z,{type:Te.i.Vertical,initialFocus:void 0,sections:w.oA(a.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,je.jsx)(Re.Z,{...e,topBorder:0!==t}),items:e}})))})}const Cc=r.memo(vc,Qt.Z);var xc=o(68155);function bc(e){window.__c={n:"CollectionViewSelectItem"};const{collectionContextStore:t,collectionViewStore:o,menuListItemProps:i,onClose:r}=e,{device:n}=(0,ne.O7)(),s=(0,ee.yK)((e=>({tooltipMessage:{color:e.mediumInvertedTextColor}})),[]),l=(0,j.useIntl)(),a=(0,c.qz)(void 0,Yt.Z),[d,p,u,h,m,g]=(0,c.VK)((()=>[o.getName(),o.getType(),o.getFormat().collection_view_icon,o.getFormat().description,t.collectionStore(),t.permissionScopes.state.canConfigureBlock]),[o,t]);if(void 0===p)return null;const S=e=>{a.setState({open:!1}),e&&r()},f=()=>{const t=n.isMobile?{menuType:we.og.ActionSheet}:{menuType:we.og.Popup,width:220};return(0,je.jsx)(Pe.Z,{...t,children:(0,je.jsx)(Cc,{...e,onClose:S})})},y=()=>{if(g)return(0,je.jsx)(Qe.ZP,{popupType:n.isMobile?Qe.Z4.SlideUp:Qe.Z4.Popup,renderOrigin:e=>(0,je.jsx)(Ft.Z,{icon:le.o,ariaLabel:l.formatMessage({id:"collectionViewSelectItem.viewSettings.ariaLabel",defaultMessage:"Database view settings"}),...e}),render:f,buttonPopupStore:a})};return(0,je.jsx)(Je.ZP,{renderTooltip:e=>(0,je.jsxs)("div",{...e,style:ys.F6,children:[(0,je.jsx)("div",{children:(0,re.Cc)({collectionViewName:d,collectionViewType:p})}),void 0!==m&&(0,je.jsx)("div",{style:s.tooltipMessage,children:h||(0,je.jsx)(j.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:to.Bh[p],collection:(0,gc.Xh)(m.getName(),m)||(0,mc.Q2)(l)}})})]}),placement:zn.u.Left,render:e=>(0,je.jsx)(qe.Z,{title:(0,je.jsx)(xc.Z,{collectionViewType:p,collectionViewName:d}),icon:(0,je.jsx)(cc.F,{color:"regular",viewIcon:u,viewType:p}),showDragHandle:!n.isMobile&&g,right:y(),rightStyle:{marginRight:8},...(0,ze.Z)(e,i)})})}bc.displayName="CollectionViewSelectItem";var wc=o(88833);const kc=(0,j.defineMessages)({suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.collectionViewSuggestedViews.suggestedTitle"}});function Pc(e,t){const o=(0,ne.O7)(),i=(0,c.VK)((()=>Do.default.state.currentSpaceViewStore),[]),n=(0,c.VK)((()=>e.collectionViewBlockStore()),[e]),s=(0,c.VK)((()=>e.collectionStore()),[e]),l=(0,c.VK)((()=>{var e;if(!s)return;const t=null===(e=s.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,Q.YB)((0,Ls.appConfigs)(),t):void 0}),[s]),a=r.useCallback((r=>{if(!n||!l||!i)return;const s=n.getParentStore();if(!s||"block"!==s.table&&"space"!==s.table&&"team"!==s.table)return;if(1!==r.dependencies.length)return;const a=r.dependencies[0];$.createAndCommit({userAction:"CollectionViewSuggestedViews.createView",environment:o,perform:c=>{var d;wc.applyFeatures({environment:o,spaceViewStore:i,appParentStore:s,appUri:l.uri,features:[{type:"simple",featureUri:r.uri}],appCollectionViewBlockStores:[n],createOrModify:"modify",transaction:c});const p=((null===(d=n.getFormat())||void 0===d?void 0:d.app_uri_map)??{})[a.uri];de.f8({environment:o,collectionContextStore:e,collectionViewId:p,isFullScreen:e.isFullScreen.state,isRootChild:e.isRootChild.state,isInPeekRenderer:e.isInPeekRenderer.state}),t()}}),_.xb({environment:o,collectionContextStore:e,view_type:a.value.type,view_config_uri:r.uri})}),[n,l,i,o,e,t]);return{renderSuggestedView:r.useCallback((e=>({key:e.uri,render:t=>(0,je.jsx)(Je.ZP,{placement:Je.ug.Left,render:o=>((e,t)=>{var o;const i=e.dependencies[0],r=(0,je.jsx)(cc.F,{color:"regular",viewIcon:null===(o=i.value.format)||void 0===o?void 0:o.collection_view_icon,viewType:i.value.type});return(0,je.jsx)(qe.Z,{title:i.value.name?i.value.name:"New View",icon:r,...t})})(e,{...t,...o,onMouseEnter:e=>{var i,r;null===(i=o.onMouseEnter)||void 0===i||i.call(o,e),null===(r=t.onMouseEnter)||void 0===r||r.call(t,e)}}),renderTooltip:()=>e.description}),action:()=>{a(e)}})),[a])}}function Tc(e){window.__c={n:"CollectionViewSuggestedViews"};const t=(0,ne.O7)().device,o=(0,ee.yK)((e=>({showMoreLabel:{color:e.mediumTextColor}})),[]),i=e.suggestedViews,{renderSuggestedView:n}=Pc(e.collectionContextStore,e.onClose),[s,l]=(0,r.useState)(!1),{collectionContextStore:a,onClose:d,onNewEmptyViewClick:p}=e,u=(0,c.VK)((()=>a.permissionScopes.state),[a]),h=(null==i?void 0:i.map((e=>n(e))))??[],m={key:"showMore",render:e=>(0,je.jsx)(qe.Z,{...e,style:o.showMoreLabel,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Show more...",id:"collectionViewSuggestedViews.showMore.label"})}),action:()=>{l(!0)}},g=(0,je.jsx)(Te.Z,{type:Te.i.Vertical,initialFocus:0,sections:[{key:"suggested_views",render:e=>(0,je.jsx)(Re.Z,{...e}),items:s||h.length<=5?h:[...h.slice(0,5),m]}]}),S=u.canConfigureBlock&&(0,je.jsx)(Re.Z,{topBorder:!0,children:(0,je.jsx)(dc.Z,{title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New empty view",id:"database.collectionViewSuggestedViews.newEmptyViewTitle"}),onClick:()=>{p("CollectionViewSuggestedViews2.handleNewEmptyViewClick"),d()},focused:!1})});return(0,je.jsx)(Ya.Z,{capture:!0,allowEsc:!0,render:e=>{let o;return o=t.isMobile?{menuType:we.og.Modal,title:Ne.default.formatMessage(kc.suggestedSectionTitle),right:(0,je.jsx)(Ve.DoneMenuText,{}),onClickRight:d,...e}:{menuType:we.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e},(0,je.jsxs)(Pe.Z,{...o,children:[h.length&&(0,je.jsx)(Re.Z,{title:!t.isMobile&&Ne.default.formatMessage(kc.suggestedSectionTitle),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:2,marginBottom:2},style:{paddingBottom:0},children:g}),S]})}})}class Vc extends s.Z{constructor(){super(...arguments),this.initialMenuListFocus=0,this.storeTypes={menuListStore:hc.Z,viewFilterQueryStore:d.default.createClass("")},this.renderViewsSection=e=>{if(this.isDraggable()){const t=this.getFilteredViewStores().map((e=>e.id));return(0,je.jsx)(Re.Z,{...e,children:(0,je.jsx)(ts.ZP,{direction:"vertical",keys:t,renderKey:o=>e.children[t.indexOf(o)],onDrop:this.handleViewsDrop})})}return(0,je.jsx)(Re.Z,{...e})},this.handleViewsDrop=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore();o&&($.createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:this.environment,perform:t=>{de.Wu({collectionViewBlockStore:o,newViewIds:e,transaction:t})}}),this.stores.menuListStore.reset())},this.handleViewFilterQueryChange=e=>{this.stores.viewFilterQueryStore.setState(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.filterView=e=>(0,re.D)(e,this.stores.viewFilterQueryStore.state)}UNSAFE_willMount(e){var t,o;const{collectionContextStore:i}=e,r=null===(t=i.collectionViewStore())||void 0===t?void 0:t.id,n=((null===(o=i.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===r));n>=0&&(this.initialMenuListFocus=n),this.stores.viewFilterQueryStore.setState("")}renderComponent(){var e;const{intl:t,collectionContextStore:o,onClose:i,onAddViewClick:r}=this.props,{device:n}=this.environment,s=o.permissionScopes.state,l=(0,wi.qG)((null==o||null===(e=o.collectionViewBlockStore())||void 0===e?void 0:e.id)??""),a=(0,je.jsx)(dc.Z,{title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),onClick:()=>function(e,t){e("CollectionViewSelect2.handleCreateButtonClick"),t()}(this.props.onAddViewClick,this.props.onClose),focused:!1});return(0,je.jsx)(Ya.Z,{capture:!0,allowEsc:!0,render:e=>{var c,d;let p;p=n.isMobile?{menuType:we.og.Modal,title:(0,je.jsx)(jc,{collectionContextStore:this.props.collectionContextStore}),right:(0,je.jsx)(Ve.DoneMenuText,{}),onClickRight:this.props.onClose,...e}:{menuType:we.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e};const u=s.canConfigureBlock&&!l&&(0,je.jsx)(Re.Z,{topBorder:!0,children:this.props.suggestedViews&&this.props.suggestedViews.length?(0,je.jsx)(Qe.ZP,{popupType:this.environment.device.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,alignmentToOrigin:Qe.vR.Center,placementToOrigin:Qe.pO.Right,renderOrigin:e=>(0,je.jsx)(dc.Z,{title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),focused:!1,...e}),render:()=>(0,je.jsx)(Tc,{collectionContextStore:o,suggestedViews:this.props.suggestedViews??[],onClose:i,onNewEmptyViewClick:r})}):a});return(0,je.jsxs)(Pe.Z,{...p,header:!n.isMobile&&!(null!==(c=o.collectionViewBlockStore())&&void 0!==c&&c.isCollectionViewPageWithContent())&&(0,je.jsx)(uc.ZP,{value:this.stores.viewFilterQueryStore.state,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:this.handleViewFilterQueryChange,placeholder:t.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})}),footer:!n.isMobile&&u,children:[(0,je.jsx)(Re.Z,{title:!n.isMobile&&!(null!==(d=o.collectionViewBlockStore())&&void 0!==d&&d.isCollectionViewPageWithContent)&&(0,je.jsx)(jc,{collectionContextStore:this.props.collectionContextStore}),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:0,marginBottom:0},children:this.renderMenuList()}),this.stores.viewFilterQueryStore.state&&0===this.getFilteredViewStores().length&&(0,je.jsx)(pc.Z,{caption:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),n.isMobile&&u]})}})}renderMenuList(){const e=this.getFilteredViewStores();if(e.length>0)return(0,je.jsx)(Te.Z,{type:Te.i.Vertical,initialFocus:this.initialMenuListFocus,sections:[{key:"views",render:this.renderViewsSection,items:e.map((e=>({key:e.id,render:t=>(0,je.jsx)(Fc,{collectionContextStore:this.props.collectionContextStore,onClose:this.props.onClose,collectionViewStore:e,props:t}),action:t=>{let{event:o}=t;!function(e,t,o,i,r,n,s,l,a){const c=o.collectionViewStore();c&&i({currentCollectionViewStore:c,newCollectionViewStore:e,openInNew:a});(function(e,t,o,i,r,n,s){de.f8({environment:n,collectionContextStore:t,collectionViewId:e.id,openInNew:s,isFullScreen:o,isRootChild:i,isInPeekRenderer:r}),_.wd({environment:n,collectionContextStore:t,action:"click_view_in_dropdown",new_view_type:e.getType(),new_view_id:e.id})})(e,o,r,n,s,t,a),a||l()}(e,this.environment,this.props.collectionContextStore,this.props.onViewClick,this.props.isFullScreen,this.props.isRootChild,this.props.isInPeekRenderer,this.props.onClose,ai.DJ(o))}})))}],store:this.stores.menuListStore})}getFilteredViewStores(){return Mc(this.props.collectionContextStore).filter(this.filterView)}isDraggable(){return function(e,t){const o=e.permissionScopes.state,{device:i}=t;return!i.isMobile&&o.canConfigureBlock}(this.props.collectionContextStore,this.environment)&&""===this.stores.viewFilterQueryStore.state}}Vc.displayName="CollectionViewSelect";const Rc=(0,j.injectIntl)(Vc);function Mc(e){var t;return(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getCollectionViewStores())||[]}function jc(e){let{collectionContextStore:t}=e;window.__c={n:"MenuTitle"};const o=(0,c.VK)((()=>Mc(t)),[t]);return(0,je.jsx)(j.FormattedMessage,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:o.length}})}function Fc(e){let{collectionViewStore:t,props:o,collectionContextStore:i,onClose:r}=e;return(0,je.jsx)(bc,{collectionContextStore:i,collectionViewStore:t,onClose:r,menuListItemProps:o})}var _c=o(60310),Ic=o(16732),Bc=o(26991);const Dc=r.memo((function(e){let{collectionViewStore:t,collectionContextStore:o,onViewClick:i,disabled:n}=e;window.__c={n:"CollectionViewTab"};const s=(0,ne.O7)(),l=(0,ee.Fg)(),[a,d]=(0,r.useState)(!1),p=(0,r.useCallback)((e=>{e.preventDefault(),(0,ue.ZP)({event:e,context:ue.Af.EditorContextMenu,callback:()=>{d(!0)}})}),[]),h=(0,r.useCallback)((e=>{const r=o.collectionViewStore();if(!r)return;const n=ai.DJ(e);i({currentCollectionViewStore:r,newCollectionViewStore:t,openInNew:n}),r.id===t.id?d(!0):function(e,t,o,i){de.f8({environment:o,collectionContextStore:t,collectionViewId:e,openInNew:i,isFullScreen:t.isFullScreen.state,isRootChild:t.isRootChild.state,isInPeekRenderer:t.isInPeekRenderer.state})}(t.id,o,s,n),_.wd({environment:s,collectionContextStore:o,action:"click_view_tab",new_view_type:t.getType(),new_view_id:t.id})}),[s,o,t,i]),m=(0,r.useCallback)((()=>{d(!1)}),[]),g=(0,r.useCallback)((()=>{let e;return e=s.device.isPhone?{menuType:we.og.Modal,right:(0,je.jsx)(Ve.DoneMenuText,{}),onClickRight:m}:{menuType:we.og.Popup,minWidth:220},(0,je.jsx)(Pe.Z,{...e,children:(0,je.jsx)(Cc,{collectionContextStore:o,collectionViewStore:t,onClose:m})})}),[o,t,s,m]),S=(0,c.VK)((()=>o.collectionViewStore()),[o]),f=(0,c.VK)((()=>o.collectionViewBlockStore()),[o]),y=(0,c.VK)((()=>null==t?void 0:t.getFormat().collection_view_icon),[t]),v=(0,c.VK)((()=>null==t?void 0:t.getType()),[t]),C=(0,c.VK)((()=>t.isDefined()),[t]),x=(0,c.VK)((()=>{var e;return(null===(e=o.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||"none"}),[o.inheritedBlockColorStore]),b=(0,r.useRef)(null),w=(0,c.VK)((()=>{var e;return(null==f?void 0:f.getSpaceId())!==(null===(e=Do.default.state.currentSpaceStore)||void 0===e?void 0:e.id)}),[f]),k=(0,c.VK)((()=>{var e;return t.getFormat().app_config_uri===u.g3&&"sprint_board"===(null===(e=Do.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().special_page_for_pm_launch)&&!w}),[t,w]),P=(0,c.VK)((()=>!!f&&(0,wi.aT)(f.id,o.isInPeekRenderer.state)),[o,f]);if(!C||!S||!f)return null;const T=S.id===t.id;return(0,je.jsx)(Xe.ZP,{popupType:s.device.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,alignmentToOrigin:Xe.ZP.Alignment.Start,open:a,render:g,onDismiss:m,origin:(0,je.jsxs)("div",{className:eo.rTm,style:{display:"flex",alignItems:"center",background:x,height:"100%",...T&&!P&&{borderBottom:`2px solid ${l.regularTextColor}`,paddingTop:2}},onContextMenu:p,children:[k&&(0,je.jsx)(yo.FF,{origin:b}),(0,je.jsx)(Ac,{collectionViewStore:t,render:e=>(0,je.jsxs)(Ye.Z,{"aria-selected":T,role:"tab",ref:b,style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:R.Z.fontWeight.medium,color:T?l.regularTextColor:l.mediumTextColor,maxWidth:Ec},hovered:a,onClick:h,disabled:n,...e,children:[(0,je.jsx)(cc.F,{color:T?"regular":"light",viewIcon:y,viewType:v,style:{marginRight:6}}),(0,je.jsx)("span",{style:{...R.Z.textOverflowStyle,marginTop:1},children:(0,je.jsx)(Zc,{collectionContextStore:o,collectionViewStore:t})})]},t.id)})]})})}));function Ac(e){window.__c={n:"CollectionViewTabTooltip"};const t=(0,ee.Fg)(),o=(0,j.useIntl)(),{collectionViewStore:i,render:r,disableTooltip:n}=e,s=(0,c.VK)((()=>i.getCollectionStore()),[i]),l=(0,c.VK)((()=>null==s?void 0:s.getModel()),[s]),a=(0,c.VK)((()=>i.getFormat().description),[i]),d=(0,c.VK)((()=>i.getModel()),[i]);return d?(0,je.jsx)(Je.ZP,{placement:Je.ug.Bottom,alignment:Je.v2.Start,delayThreshold:500,render:r,disableTooltip:n,renderTooltip:e=>(0,je.jsxs)("div",{...e,style:ys.F6,children:[(0,je.jsx)("div",{children:(0,re.Cc)({collectionViewName:d.getName(),collectionViewType:d.getType()})}),s&&l&&(0,je.jsx)("div",{style:{color:t.mediumInvertedTextColor},children:a||(0,je.jsx)(j.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:to.Bh[d.getType()],collection:(0,gc.Xh)(s.getName(),s)||l.getEmptyTitlePlaceholder({intl:o})}})})]})}):null}function Lc(e,t,o){var i;const r=e.collectionStore();if(!r)return t.getName();const n=r.getPropertyMapping(),s=t.getName(),l=null==n?void 0:n[u.Es.TaskToSprintRelation];if(!o||!l||s!==Ne.default.formatMessage(Ic.sY.tasksCurrentSprintV2ViewName))return t.getName();const a=o[l];if(!a||"relation"!==a.type||!a.collection_pointer)return t.getName();const c=null===(i=(0,Bc.As)(e,"current",a.collection_pointer,r))||void 0===i?void 0:i.getBlockTitleStore().getValue();return c?`${Ne.default.formatMessage(Ic.sY.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function Zc(e){window.__c={n:"CollectionViewTabTitle"};const{collectionViewStore:t,collectionContextStore:o}=e,i=(0,j.useIntl)(),[r,n]=(0,c.VK)((()=>{const e=o.settingsStore.state;return[e.open,w.Z$(e.stack)]}),[o.settingsStore]),s=(0,c.VK)((()=>o.collectionViewBlockStore()),[o]),l=(0,c.VK)((()=>o.collectionViewStore()),[o]),a=(0,c.VK)((()=>t.getCollectionStore()),[t]),d=(0,c.VK)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===u.g3&&null!=a&&a.isDefined()?{name:Lc(o,t,a.getSchema()),type:t.getType()}:s&&(0,wi.qG)(s.id)?{name:i.formatMessage(_c.CN.assignedToMeView),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,a,s,o,i]);return!d||l&&l.id===t.id&&r&&n&&("duplicateExistingView"===n.type||"createViewSource"===n.type||"createView"===n.type)?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,je.jsx)(xc.Z,{collectionViewName:d.name,collectionViewType:d.type})}const Ec=220,Oc=r.memo((function(e){window.__c={n:"CollectionViewTabBar"};const{collectionContextStore:t,showHoverActionsStore:o,isPlaceholderExternalCollectionStore:i,onViewClick:n,disabled:s}=e,l=(0,r.useRef)(new ac.E({throttleMs:200})),a=(0,r.useRef)(new Map),d=(0,r.useRef)(null),p=(0,r.useRef)(null),h=(0,c.VK)((()=>o.state),[o]),m=(0,c.VK)((()=>t.permissionScopes.state),[t]),g=(0,ne.O7)(),S=(0,ee.Fg)();(0,r.useEffect)((()=>{const e=l.current;return()=>{e.destroy()}}),[l]);const f=(0,r.useCallback)((e=>{const t=e.getName(),o=e.getType();if(!o)return 0;let i=a.current.get(e.id);i||(i=new lc({style:{fontSize:`${R.Z.fontSize.UIRegular.desktop}px`,fontWeight:R.Z.fontWeight.medium}}),a.current.set(e.id,i));const r=(0,re.Cc)({collectionViewName:t,collectionViewType:o}),n=i.measure(r);return Math.min(40+n.width,Ec)}),[a]),y=(0,c.VK)((()=>{const e=Nc(t),o=t.collectionViewStore();if(!o)return;const r=Math.max(100,Gc(t,i)?105:0);let n=l.current.rect.state.width-r;const s=[],a=f(o);if(!(a<n))return s;s.push(o),n-=a;for(const t of e)if(t.id!==o.id){const e=f(t);if(!(e<n))break;s.push(t),n-=e}const c=s.filter((e=>e.id!==o.id)),d=e.findIndex((e=>e.id===o.id));return c.splice(d,0,o),c}),[t,i,f,l]),v=(0,c.VK)((()=>{var e;const{device:o}=g,r=Nc(t),n=(null==y?void 0:y.length)||0,s=r.length-n,l=(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent())||o.isPhone||y&&(0===n||1===n&&r.length>1)||t.isCompactView.state?"dropdown":s>0?"someTabsNotVisible":"allTabsVisible",a=t.isFullScreen.state||h;return{showMoreViewsButton:"someTabsNotVisible"===l||"dropdown"===l,showAddViewButton:Gc(t,i)&&"allTabsVisible"===l,addViewButtonAnimatedIn:a,viewSelectState:l,moreViewsCount:s}}),[t,g,i,h,y]),C=(0,r.useCallback)((e=>{e&&l.current.observe(e)}),[l]),x=(0,c.VK)((()=>{const e=t.collectionStore(),o=t.collectionViewBlockStore();if(!e||!o)return;const i=e.getFormat().app_config_uri,r=i?(0,Q.YB)((0,Ls.appConfigs)(),i):void 0;return r?(0,Q.AG)(r,e,o):void 0}),[t]),b=(0,r.useCallback)((()=>{if(y&&"dropdown"!==v.viewSelectState)return m.canConfigureBlock?(0,je.jsx)(ts.ZP,{direction:"horizontal",keys:y.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>{const o=y.find((t=>t.id===e));if(o)return(0,je.jsx)(zc,{collectionContextStore:t,onViewClick:n,disabled:s,collectionViewStore:o})},onDrop:e=>function(e,t,o){const i=o.collectionViewBlockStore();if(!i)return;$.createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:t,perform:t=>{de.Wu({collectionViewBlockStore:i,newViewIds:e,transaction:t})}})}(e,g,t)}):y.map((e=>(0,je.jsx)(zc,{collectionContextStore:t,onViewClick:n,disabled:s,collectionViewStore:e},e.id)))}),[t,m.canConfigureBlock,s,g,n,v.viewSelectState,y]),w=(0,r.useCallback)((e=>{var o;const{device:i}=g,r=function(e){return e.collectionViewStore()}(t);if(!r)return;if(!r.isDefined())return;const n=(null===(o=t.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===u.GZ&&"page"===r.getType();if("dropdown"===v.viewSelectState){const o=r.getType(),l=r.getFormat().collection_view_icon,a=t.isCompactView.state;return(0,je.jsxs)(je.Fragment,{children:[!i.isMobile&&n&&"home"===es.B1()&&(0,je.jsx)(rc,{origin:d}),(0,je.jsx)(Ac,{collectionViewStore:r,disableTooltip:a,render:i=>(0,je.jsxs)(Ye.Z,{ref:d,style:{display:"flex",alignItems:"center",fontSize:s?R.Z.fontSize.UISmall.desktop:R.Z.fontSize.UIRegular.desktop,fontWeight:R.Z.fontWeight.semibold,color:s?S.mediumTextColor:S.regularTextColor,maxWidth:Ec,paddingRight:s?0:void 0},disabled:s,...e,children:[(0,je.jsx)(cc.F,{color:s?"lightGray":"regular",viewType:o,viewIcon:l,style:{marginRight:s?8:6},size:s?14:void 0}),(0,je.jsx)("span",{style:{...R.Z.textOverflowStyle,marginRight:6,marginTop:1},children:(0,je.jsx)(Zc,{collectionContextStore:t,collectionViewStore:r})}),!s&&(0,fr.i)({marginTop:2,width:10,height:10,fill:S.lightIconColor,marginRight:6})]})})]})}return"someTabsNotVisible"===v.viewSelectState?(0,je.jsx)(Ye.Z,{style:{display:"flex",alignItems:"center",fontSize:R.Z.fontSize.UIRegular.desktop,color:S.mediumTextColor},...e,children:(0,je.jsx)("span",{style:{marginTop:1},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:v.moreViewsCount}})})}):void 0}),[t,s,g,d,v,S]),k=(0,r.useCallback)(((e,o)=>{var i;const{device:r}=g,s=t.isFullScreen.state,l=t.isRootChild.state,a=t.isInPeekRenderer.state,c=(null===(i=t.collectionStore())||void 0===i?void 0:i.getFormat().app_config_uri)===u.GZ;return(0,je.jsxs)(je.Fragment,{children:[!r.isMobile&&"views"===es.B1()&&c&&(0,je.jsx)(nc,{origin:p}),(0,je.jsx)("div",{ref:p,children:(0,je.jsx)(Rc,{collectionContextStore:t,onAddViewClick:e=>Hc(e,g,t),suggestedViews:o,onClose:e.close,isFullScreen:s,isRootChild:l,isInPeekRenderer:a,onViewClick:n})})]})}),[t,g,n,p]);return(0,je.jsxs)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",flexGrow:1},ref:C,children:[b(),v.showMoreViewsButton&&(0,je.jsx)(Qe.ZP,{popupType:g.device.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,render:e=>k(e,x),renderOrigin:e=>w(e),onClick:()=>function(e,t){_.wd({environment:e,collectionContextStore:t,action:"click_views_dropdown"})}(g,t)}),v.showAddViewButton&&(0,je.jsx)(On.Z,{isVisible:!0,animationStyle:{opacity:v.addViewButtonAnimatedIn?1:0},render:()=>x&&x.length?(0,je.jsx)(Qe.ZP,{popupType:Qe.Z4.Popup,alignmentToOrigin:ic.v2.Center,render:e=>(0,je.jsx)(Kc,{collectionContextStore:t,parent:e,suggestedViews:x}),renderOrigin:e=>(0,je.jsx)(Ft.Z,{className:eo.rVO,icon:ae.R,...e})},"suggested-views"):(0,je.jsx)(Ft.Z,{className:eo.rVO,icon:ae.R,onClick:()=>Hc("CollectionViewTabBar.handleAddViewClick",g,e.collectionContextStore)})})]})}));function Gc(e,t){var o;const i=e.permissionScopes.state,r=null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.id,n=r&&(0,wi.qG)(r);return i.canConfigureBlock&&!t.state&&!n}function Nc(e){var t;return(null===(t=function(e){return e.collectionViewBlockStore()}(e))||void 0===t?void 0:t.getCollectionViewStores())||[]}function zc(e){let{collectionViewStore:t,collectionContextStore:o,onViewClick:i,disabled:r}=e;return(0,je.jsx)(Dc,{collectionContextStore:o,collectionViewStore:t,onViewClick:i,disabled:r},t.id)}function Hc(e,t,o){$.createAndCommit({userAction:e,environment:t,perform:e=>{de.ME({environment:t,collectionContextStore:o,transaction:e})}}),_.xb({environment:t,collectionContextStore:o,view_type:"table"})}function Kc(e){let{parent:t,suggestedViews:o,collectionContextStore:i}=e;window.__c={n:"SuggestedViewsPopupComponent"};const r=(0,ne.O7)();return(0,je.jsx)(Tc,{collectionContextStore:i,suggestedViews:o,onClose:t.close,onNewEmptyViewClick:e=>Hc(e,r,i)})}var Wc=o(92650),Uc=o(12457),$c=o(97978),qc=o(70764),Qc=o(54802),Yc=o(2688),Xc=o(94841),Jc=o(58421),ed=o(88632),td=o(77080),od=o(30874),id=o(77144),rd=o(19671),nd=o(85844),sd=o(13023),ld=o(29026),ad=o(97058),cd=o(71644);function dd(e){window.__c={n:"BoardGroupsShimmer"};const{isFullScreen:t,boardCoverSize:o,showGroupHeader:i,areColumnsColored:r}=e,n=e.numBoardColumns||3,s=t?480:360,l=function(e){const t=ln+ln;return(0,re.rD)(e)+t}(o),a=(0,ee.yK)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:10},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%"},group:{marginTop:r?20:8,marginRight:10,width:"100%",minWidth:l}})),[l,r]),c=w.DZ(n,(e=>(0,je.jsxs)("div",{style:a.group,children:[i&&(0,je.jsx)(Vr.Z,{style:a.groupHeader}),(0,je.jsx)(nn,{minHeight:s})]},e)));return(0,je.jsx)("div",{style:a.container,children:c})}var pd=o(24098);class ud extends d.default{getInitialState(){return{searchQuery:"",limit:ud.defaultLimit}}}ud.defaultLimit=20,ud.loadMoreScrollOffset=200,ud.loadMoreIncrement=20;const hd=ud;var md=o(72087),gd=o(43765),Sd=o(3553);const fd={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:4},yd=(0,j.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}});class vd extends s.Z{constructor(){super(...arguments),this.createdStores=new Set,this.storeTypes={buttonPopupStore:Yt.Z,boardHiddenGroupStore:hd,requestStore:md.Z},this.renderPopup=()=>{const{device:e}=this.environment,{groupFormat:t,schema:o,currentGroups:i,collectionContextStore:r,groupBy:n}=this.props;let s;s=e.isMobile?{menuType:we.og.Modal,title:(0,je.jsx)(ct.Z,{groupBy:n,groupFormat:t,currentGroups:i,schema:o,disabled:!0,isHiddenGroup:!0,collectionContextStore:r}),left:(0,je.jsx)(Qe.ZP,{popupType:Xe.kQ.SlideUp,renderOrigin:e=>(0,je.jsx)("div",{...e,children:(0,le.o)({width:18,height:18,color:this.theme.lightTextColor})}),render:e=>(0,je.jsx)(Vd,{parent:e,groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore})}),right:(0,je.jsx)(Ve.DoneMenuText,{}),onClickRight:this.handlePopupClose,header:this.renderHeader()}:{menuType:we.og.Popup,header:this.renderHeader(),width:(0,re.rD)(wd(this.props.format))+20};const l=this.reducerStore.state;if(l)return(0,je.jsx)(Sd.Z,{store:this.selectableBlockStore,isDefaultContainer:!0,droppable:!0,render:e=>{let{selectableEvents:o}=e;return(0,je.jsxs)(Pe.Z,{...s,...o,children:[(0,je.jsx)(He.Z,{id:`board_hidden_group:${(0,te.mD)(t)}`,reducer:l,groupsPointer:[t],collectionContextStore:r,resultStore:kd(this.props.collectionContextStore,this.props.groupFormat),render:this.renderResults}),(0,je.jsx)($r.Z,{onChange:this.handleScrollOffsetChange})]})}})},this.renderResults=()=>{var e,t;const{device:o}=this.environment,{groupFormat:i,disabled:r,format:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:a}=this.props,c=null===(e=kd(this.props.collectionContextStore,this.props.groupFormat))||void 0===e?void 0:e.state,d=null===(t=Pd(this.props.collectionContextStore,this.props.groupFormat))||void 0===t?void 0:t.state;return c&&d?0===d.length?(0,je.jsx)(Re.Z,{children:(0,je.jsx)(gd.Z,{title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,je.jsx)("div",{style:{padding:o.isMobile?"8px 16px":"6px 14px 8px"},children:(0,je.jsx)(Ii,{collectionContextStore:s,groupsPointer:[i],format:n,canDrag:!r,onSelectableEnter:e=>Rd(e,this.props.groupFormat,this.props.collectionContextStore,this.props.isFullScreen,this.environment),disableRequest:!0,resultProps:{format:n,schema:l,disabled:r,coverFormat:xd(this.props.format),coverAspectFormat:bd(this.props.format),coverSizeFormat:wd(this.props.format),shouldShowTitle:to.K8(this.props.format,"board"),colorStyle:void 0,blockPropertyValueOverlayStore:a,onTextEnter:e=>function(e,t,o,i,r){const n=Pd(t,i);if(!n)return;if(!ge.M_(r)||!t.collectionStore())return Md(e,t,i,r);const s=n.state.findIndex((t=>t===e))+1;$.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:r,perform:e=>{Jt({transaction:e,environment:r,collectionContextStore:t,isFullScreen:o,groupsPointer:[i],insertAtIndex:s,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}})}(e,this.props.collectionContextStore,this.props.isFullScreen,this.props.groupFormat,this.environment),onTextEsc:e=>Md(e,this.props.collectionContextStore,this.props.groupFormat,this.environment),onShiftEnter:e=>Rd(e,this.props.groupFormat,this.props.collectionContextStore,this.props.isFullScreen,this.environment),collectionContextStore:s},resultComponent:ni,handleOpenPeekPage:Eo.default.isSidePeekOpen()?void 0:this.handlePopupClose,canDrop:!0,disabled:r,shouldShowHoverMenu:!1,direction:Fi.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,je.jsx)(Re.Z,{children:(0,je.jsx)(gd.Z,{title:(0,je.jsx)(Ke.Z,{})})})},this.handlePopupClose=()=>{this.stores.buttonPopupStore.setState({open:!1})},this.handleSearchInputChange=e=>{this.stores.boardHiddenGroupStore.setState({searchQuery:e.target.value,limit:hd.defaultLimit}),Td(this.environment)},this.handleSearchClearButtonClick=()=>{this.stores.boardHiddenGroupStore.reset(),Td(this.environment)},this.handleButtonPopupClick=()=>{this.stores.boardHiddenGroupStore.reset(),Td(this.environment)},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:i,groupFormat:r}=this.props,s=n.findDOMNode(this);s&&s instanceof Element&&$.createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:this.environment,perform:e=>A.BO({environment:this.environment,collectionContextStore:i,groupsPointer:[r],droppedStores:t,duplicate:o,transaction:e})})},this.handleBoardGroupHeaderAddItem=e=>{this.createdStores.add(e)},this.handleScrollOffsetChange=e=>{var t;const{collectionContextStore:o}=this.props,{boardHiddenGroupStore:i}=this.stores,r=i.state,n=null===(t=kd(this.props.collectionContextStore,this.props.groupFormat))||void 0===t||null===(t=t.state)||void 0===t?void 0:t.blockIds,s=o.isLoading.state;e<hd.loadMoreScrollOffset&&!s&&n&&r.limit<=n.length&&i.setState({...r,limit:r.limit+hd.loadMoreIncrement})},this.reducerStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o}=this.props,{boardHiddenGroupStore:i}=this.stores,{searchQuery:r,limit:n}=i.state,s=(0,Ze.zk)({schema:t,group:e,propertyMapping:void 0,timeZone:(0,Ee.r)()});if(!s)return;return{type:"results",filter:s,limit:n,searchQuery:r,loadContentCover:Boolean(o&&o.board_cover&&"page_content"===o.board_cover.type)}}))}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new me.G(this.environment,{table:P.iU,id:t.id}))}renderComponent(){const{device:e}=this.environment,{groupBy:t,groupFormat:o,disabled:i,query:r,schema:n,currentGroups:s,collectionContextStore:l}=this.props,a=r.aggregations?r.aggregations[0]:void 0;return(0,je.jsx)(_t.Z,{store:this.selectableBlockStore,canDropOnto:!i,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,je.jsx)(Qe.ZP,{popupType:e.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,renderOrigin:e=>(0,je.jsxs)(xo.Z,{style:fd,...e,children:[(0,je.jsx)(ct.Z,{groupBy:t,groupFormat:o,currentGroups:s,schema:n,disabled:!0,isHiddenGroup:!0,collectionContextStore:l}),(0,je.jsx)(rr,{groupFormat:o,aggregation:a,schema:n,collectionContextStore:l,disabled:!0,onChange:e=>function(e,t,o,i){const r=t.collectionViewStore(),n={...o,aggregations:e?[e]:[]};r&&$.createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:i,perform:e=>{de.iG({collectionViewStore:r,update:{query2:n},transaction:e})}})}(e,this.props.collectionContextStore,this.props.query,this.environment)})]},(0,te.mD)(o)),render:this.renderPopup,buttonPopupStore:this.stores.buttonPopupStore,onClick:this.handleButtonPopupClick})})}renderHeader(){const{device:e}=this.environment,{groupFormat:t,disabled:o,format:i,schema:n,query:s,currentGroups:l,collectionContextStore:a,isFullScreen:c,hoveredGroupStore:d,groupBy:p,isInPeekRenderer:u}=this.props,{searchQuery:h}=this.stores.boardHiddenGroupStore.state;return(0,je.jsxs)(r.Fragment,{children:[!e.isMobile&&(0,je.jsx)(mr,{groupBy:p,currentGroups:l,groupFormat:t,query:s,schema:n,format:i,collectionContextStore:a,disabled:o||Boolean(h),hidden:!0,isPopup:!0,onAddItem:this.handleBoardGroupHeaderAddItem,isFullScreen:c,hoveredGroupStore:d,isInPeekRenderer:u},(0,te.mD)(t)),(0,je.jsx)("div",{style:{margin:e.isMobile?0:"6px 0"},children:(0,je.jsx)(pd.Z,{capture:!0,render:t=>(0,je.jsx)(uc.ZP,{value:h,placeholder:Ne.default.formatMessage(yd.searchPlaceholder),autoFocus:!e.isMobile,showClearButton:!0,onChange:this.handleSearchInputChange,onClearButtonClick:this.handleSearchClearButtonClick,...t})})})]})}}vd.displayName="BoardHiddenGroup";const Cd=vd;function xd(e){return e?e.board_cover:void 0}function bd(e){return e?e.board_cover_aspect:void 0}function wd(e){return e?e.board_cover_size:void 0}function kd(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function Pd(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function Td(e){Oo.default.state.stores.length>0&&K.ZH(e)}function Vd(e){let{parent:t,groupFormat:o,currentGroups:i,format:r,schema:n,collectionContextStore:s}=e;window.__c={n:"ActionButtonPopupComponent"};const l=(0,c.VK)((()=>s.collectionStore()),[s]),a=s.boardColumnsLimitStore;return l?(0,je.jsx)(_e,{parent:t,groupFormat:o,currentGroups:i,format:r,schema:n,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:a}):null}function Rd(e,t,o,i,r){const{blocks:n,transaction:s}=e,l=o.groupsStore.getGroupState(t);if(!l)return;const a=l.resultsStore;if(n.length>0&&a.state.length>0){const e=n[0];if(!ge.M_(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation())return;Jt({transaction:s,environment:r,collectionContextStore:o,isFullScreen:i,groupsPointer:[t],insertAtIndex:a.state.findIndex((t=>t===e))+1,from:"board_group_enter_add_item",transient:!0,useCrdt:!1})}}function Md(e,t,o,i){const r=t.collectionStore(),n=e.getTitleStore();if(Xt.QaF(null==n?void 0:n.getValue()))return void K.Ys({environment:i,store:e});if(!r)return;const s=Pd(t,o);if(!s)return;const l=s.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),c=t.collectionViewBlockStore();if(a&&c&&F.sG(i,{...(0,pe.Pn)(t),block_id:e.id}),$.createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:i,perform:t=>{A.Od({store:e,transaction:t})}}),l>=0){const e=s.state[l];K.Ys({environment:i,store:e})}}function jd(e){window.__c={n:"CollectionViewErrorInlineButton"};const t=(0,ee.yK)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,je.jsx)(xo.Z,{style:t.button,onClick:e.onClick,children:e.children})}const Fd=function(e){window.__c={n:"CollectionViewError"};const{collectionContextStore:t,title:o,description:i,icon:r,style:n}=e,s=(0,c.VK)((()=>t.settingsStore.state.open),[t.settingsStore]),l=(0,ee.yK)((e=>({wrapper:{paddingTop:8,minHeight:250,display:"flex",alignItems:"center",justifyContent:"center",...n},innerWrapper:{paddingLeft:16,paddingRight:s?J.nJ+16:16},title:{fontSize:17,fontWeight:R.Z.fontWeight.medium,color:e.lightTextColor,textAlign:"center",marginBottom:-2},description:{margin:"0 auto",fontSize:14,color:e.lightTextColor},button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[s,n]);return(0,je.jsx)("div",{style:l.wrapper,children:(0,je.jsxs)("div",{style:l.innerWrapper,children:[r,(0,je.jsx)("div",{style:l.title,children:o}),i?(0,je.jsx)("div",{style:l.description,children:i}):void 0]})})};class _d extends Ro.Z{constructor(e){super(e),this.storeTypes={groupsResultStore:d.default.createClass(void 0),hoveredGroupStore:d.default.createClass(void 0),subgroupsMountedStore:d.default.createClass(!1),lastColumnsBy:d.default.createClass(void 0),lastGroupBy:d.default.createClass(void 0)},this.hiddenGroupsContainerRef=void 0,this.hiddenGroupsHeaderRef=void 0,this.hiddenGroupsHeaderLastOffset=void 0,this.renderGroupHeader=(e,t)=>{const{schema:o,collectionContextStore:i,format:r,query:n,disabled:s,isFullScreen:l}=this.props;if(Bd(e,this.props.collectionContextStore)&&r.board_columns_by)return(0,je.jsx)(mr,{currentGroups:t,groupFormat:e,query:n,schema:o,format:r,groupBy:r.board_columns_by,collectionContextStore:i,hoveredGroupStore:this.stores.hoveredGroupStore,disabled:s,hidden:!1,isPopup:!1,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:l},(0,te.mD)(e))},this.subGroupMinWidth=()=>{const{format:e}=this.props;return this.columnsDisplayStateStore.state.visibleGroups.length*(hr(e)+2*ln+2*cn)},this.renderBoardHiddenGroupsButton=e=>(0,je.jsx)("div",{style:{display:"flex",minWidth:this.subGroupMinWidth()},children:(0,je.jsx)(yr,{...e})}),this.renderSubGroupHeader=e=>{const{collectionContextStore:t}=this.props,o=t.isCompactView.state;return(0,je.jsx)(Dt,{...e,height:o?to.yZ:36,getComputedStickyStyle:e=>o?{}:function(e,t,o){return{background:t?o.cardContentBackground:o.contentBackground,boxShadow:e?`0 1px 0 ${t?o.cardContentBackground:o.contentBackground}`:void 0}}(e,this.props.isInPeekRenderer,this.theme),style:{...e.style,minWidth:this.subGroupMinWidth()},onMount:()=>this.stores.subgroupsMountedStore.setState(!0)})},this.renderHiddenGroup=e=>{const{collectionContextStore:t,query:o,schema:i,format:r,disabled:n,blockPropertyValueOverlayStore:s,isFullScreen:l,isInPeekRenderer:a}=this.props,c=this.columnsDisplayStateStore.state.currentGroups;if(!Bd(e,this.props.collectionContextStore)||!r.board_columns_by)return;const d=t.permissionScopes.state;return(0,je.jsx)(Cd,{query:o,schema:i,format:r,groupFormat:e,groupBy:r.board_columns_by,currentGroups:c,collectionContextStore:t,disabled:n||!this.canEdit()||!d.canEditContent,blockPropertyValueOverlayStore:s,isFullScreen:l,hoveredGroupStore:this.stores.hoveredGroupStore,isInPeekRenderer:a},(0,te.mD)(e))},this.handleGroupReorder=(e,t)=>{const{collectionContextStore:o}=this.props,i=this.columnsDisplayStateStore.state.currentGroups,r=i.filter((t=>e.indexOf((0,te.mD)(t))<0)),n=i.filter((t=>e.indexOf((0,te.mD)(t))>=0)),s=w.MR(n,(t=>{const o=e.indexOf((0,te.mD)(t));return o>=0?o:1/0})),l=t?[...r,...s]:[...s,...r];$.createAndCommit({userAction:"Board.handleGroupReorder",environment:this.environment,perform:e=>{A.A6({collectionContextStore:o,newGroups:l,groupsFormatKey:"board_columns",transaction:e})}}),_.wd({environment:this.environment,collectionContextStore:o,action:t?"board_reorder_hidden_groups":"board_reorder_groups"})},this.handleGroupsChange=()=>{const{format:e,collectionContextStore:t}=this.props,o=this.columnsDisplayStateStore.state.currentGroups;A.$D({environment:this.environment,format:e,groupsFormatKey:"board_columns",collectionContextStore:t,currentGroups:o})},this.handleGroupsChangeDebounced=w.Ds(this.handleGroupsChange,5e3),this.handleMouseLeave=()=>{this.stores.hoveredGroupStore.setState(void 0)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=e=>function(e,t,o){!function(e,t,o){const{device:i}=o;i.isMobile?oe._({environment:o,store:e,pageVisitSource:p.tY.Create}):ie.CH({environment:o,store:e,peekMode:re.kr(t.collectionViewStore()),resultsStore:void 0,collectionContextStore:t,pageVisitSource:p.tY.Create})}(e,o,t)}(e,this.environment,this.props.collectionContextStore),this.subgroupsOnChangeStore=this.createComputedStore((()=>{var e,t;const{collectionContextStore:o}=this.props,i=o.collectionViewStore();if(!i)return;const r=null==i||null===(e=i.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),n=null==i||null===(t=i.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue();w.Xy(r,this.stores.lastGroupBy.state)&&w.Xy(n,this.stores.lastColumnsBy.state)||this.stores.subgroupsMountedStore.setState(!1),this.stores.lastGroupBy.setState(r),this.stores.lastColumnsBy.setState(n)})),this.anyVisibleGroupHasResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t,format:o,schema:i}=this.props,r=this.columnsDisplayStateStore.state,{visibleGroups:n}=r,s=o.collection_group_by,l=t.collectionViewBlockStore(),a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=void 0!==l?(0,be.Cz)({groupBy:s,schema:i,formatGroups:o.collection_groups||[],schemaGroups:this.schemaGroupsStore.state,reducerResults:c,getRecordModel:l.getRecordModel,relativeVariableResult:t.relativeVariableStore.state,viewAppConfigUri:null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}):[];if(0===d.length){if(void 0!==s)return!1;for(const e of n){const o=t.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}}else for(const p of d)for(const e of n){const o=[p,e],i=t.groupsStore.getGroupState(o);if(null!=i&&i.reducerResultStore.state)return!0}return!1})),this.schemaGroupsStore=this.createComputedStore((()=>{const{format:e,schema:t}=this.props,o=e.board_columns_by;if(o)return(0,te.Qq)({schema:t,groupBy:o})}),!0),this.groupsReducerStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,i=o.remoteRequestStore.state,r=e.board_columns_by;if(r)return(0,be.ej)({groupBy:r,schema:t,format:e,filter:null==i?void 0:i.loader.filter,groupsFormatKey:"board_columns",limit:o.boardColumnsLimitStore.state})})),this.columnsDisplayStateStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,i=e.board_columns_by;if(!i)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const r=o.collectionViewBlockStore();if(!r)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const n=o.collectionViewStore(),s=o.boardColumnsLimitStore.state,l=this.schemaGroupsStore.state,a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=a?a.total:0,p=(0,be.Cz)({groupBy:i,schema:t,formatGroups:e.board_columns||[],schemaGroups:l,reducerResults:c,getRecordModel:r.getRecordModel,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null==n?void 0:n.getFormat().app_config_uri}),u=p.filter((e=>!(0,te.eF)(e))).slice(0,s),h=p.filter((e=>(0,te.eF)(e)));return{currentGroups:[...u,...h],visibleGroups:u,hiddenGroups:h,total:d}}),!0),this.disableBoardColorColumnsStore=this.createComputedStore((()=>{const{schema:e,format:t,collectionContextStore:o}=this.props;return!Boolean((0,be.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t,collectionContextStore:o,theme:this.theme}))})),this.hiddenGroupsContainerRef=r.createRef(),this.hiddenGroupsHeaderRef=r.createRef(),this.hiddenGroupsHeaderLastOffset=0}UNSAFE_willMount(){this.columnsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}UNSAFE_willUnmount(){this.columnsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}UNSAFE_willMountOrUpdate(e){const{format:t,store:o,collectionContextStore:i}=e,r=i.collectionStore();r&&(!t.board_columns_by&&o.isDefined()&&r.isDefined()&&function(e,t,o){const{collectionContextStore:i,schema:r}=e,n=i.collectionStore(),s=i.permissionScopes.state;if(!n)return;const l=i.collectionViewStore();if(!l||!s.canConfigureBlock)return;$.createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:o,perform:e=>{let a,c=re.Se(r);if(!c&&s.canConfigureCollection){c=(0,cd.ZP)();a={[c]:{name:t.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}if(!c)return;const d=(a||r)[c];d&&(0,te.LG)(d)&&(uo.FH({stores:[l],update:{board_columns_by:(0,te.fw)(c,d,"collectionTypedView"===i.contextType)},transaction:e}),ho.sW({store:l,data:{type:"board"},transaction:e}),a&&de.xO({environment:o,collectionStore:n,update:a,transaction:e}))}})}(e,this.props.intl,this.environment),l.default.afterNextFlush((()=>this.updateHiddenGroupsHeaderOffset())))}renderPersisted(){const{format:e,collectionContextStore:t,isFullScreen:o,paddingLeft:i,paddingRight:r,paddingBottom:n}=this.props,s=t.permissionScopes.state,l=t.settingsStore;return e.board_columns_by?this.renderBoard():(0,je.jsx)(Fd,{collectionContextStore:t,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:s.canConfigureBlock?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,je.jsx)(jd,{onClick:()=>{L.r$({collectionContextStore:t,collectionSettingsStore:l}),L.H4({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:i,paddingRight:r,paddingBottom:o?void 0:n}})}renderBoard(){const{store:e,format:t,isFullScreen:o,collectionContextStore:i}=this.props,r=this.columnsDisplayStateStore.state,{visibleGroups:n,hiddenGroups:s}=r,l=t.collection_group_by,a=this.anyVisibleGroupHasResultsStore.state,c=this.stores.subgroupsMountedStore.state;this.subgroupsOnChangeStore.state;const d=i.shouldShowSpinner.state&&!c&&!a,p=i.isCompactView.state;return this.renderBoardColumnsReducerRequest((()=>(0,ci.Z)((c=>{return(0,je.jsx)(Xi,{isFullScreen:o,renderEmitter:i.renderEmitter,children:(0,je.jsx)("div",{style:(h=this.props.paddingLeft,m=this.props.paddingRight,{marginLeft:h,marginRight:m,float:"left",minWidth:"100%"}),className:eo.EGJ,...c,children:(0,je.jsxs)(_t.Z,{style:(u=this.props.paddingBottom,{display:"flex",position:"relative",flexGrow:1,paddingBottom:u}),store:e,shouldShowHalo:!o&&!p,canSelect:!o,onMouseDown:e=>function(e,t){const{device:o}=t,{target:i}=e;!o.isMobile&&i instanceof HTMLElement&&(0,ue.ZP)({event:e,context:ue.Af.EditorMouseDown,callback:()=>{e.preventDefault(),G.AI({environment:t,target:i,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),analyticsName:"board",onMouseLeave:this.handleMouseLeave,children:[this.renderHeader(r),d&&(0,je.jsx)(dd,{isFullScreen:o,numBoardColumns:n.length,boardCoverSize:t.board_cover_size,areColumnsColored:!this.disableBoardColorColumnsStore.state,showGroupHeader:!0}),n.length>0&&(0,je.jsxs)("div",{children:[(0,je.jsx)("div",{style:{height:34+un(this.disableBoardColorColumnsStore.state,p)}}),l?this.renderBoardColumnsForGroups(l,n,a):this.renderBoardColumnsForGroup(void 0,n,a)]}),Dd(r,this.props.collectionContextStore)&&(0,je.jsx)("div",{style:{width:90,marginLeft:cn,marginRight:cn}}),Ad(r,this.props.format,this.props.collectionContextStore)&&(0,je.jsx)("div",{style:{width:35,marginLeft:cn,marginRight:cn}}),s.length>0&&this.renderHiddenGroups(s)]})})});var u,h,m}))))}renderBoardColumnsReducerRequest(e){const{collectionContextStore:t}=this.props,o=this.groupsReducerStore.state;return o?(0,je.jsx)(He.Z,{id:"board_columns",reducer:o,collectionContextStore:t,resultStore:this.stores.groupsResultStore,render:e}):e()}renderHeader(e){const{format:t,isFullScreen:o,isRootChild:i,collectionContextStore:r}=this.props,{hiddenGroups:n,visibleGroups:s,currentGroups:l}=e;if(0===s.length&&0===n.length)return;const a=s.map((e=>(0,te.mD)(e))),c=t.board_columns_by;if(!c)return;const d=(0,te.mu)(c),p=r.permissionScopes.state,u="manual"===d.type&&p.canConfigureBlock,h=(0,be.qW)({device:this.environment.device,isFullScreen:o,isRootChild:i}),m=r.isCompactView.state;return(0,je.jsx)(jt,{position:ft(m),children:(0,je.jsxs)("div",{style:this.getHeaderStyle(),children:[h&&(0,je.jsx)("div",{style:Od(this.props.isInPeekRenderer,this.theme,m)}),u?(0,je.jsx)(ts.ZP,{direction:"horizontal",keys:a,renderKey:(e,t)=>this.renderGroupHeader(s[t],l),onDrop:e=>this.handleGroupReorder(e,!1)}):a.map(((e,t)=>this.renderGroupHeader(s[t],l))),Dd(e,this.props.collectionContextStore)&&(0,je.jsx)(Ld,{collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,displayState:e}),Ad(e,this.props.format,this.props.collectionContextStore)&&this.renderAddGroupButton(),n.length>0&&(0,je.jsx)("div",{style:Ed(this.props.isInPeekRenderer,this.theme,m),ref:this.hiddenGroupsHeaderRef,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})})]})})}renderHiddenGroups(e){const{device:t}=this.environment,{collectionContextStore:o}=this.props,i=this.canEdit()&&!t.isMobile&&!o.permissionScopes.state.isLocked,r=e.slice(0,be.ew),n=r.map((e=>(0,te.mD)(e)));return(0,je.jsx)("div",{style:this.getHiddenGroupsWrapStyle(),ref:this.hiddenGroupsContainerRef,children:r.length>0&&(i?(0,je.jsx)(ts.ZP,{direction:"vertical",keys:n,renderKey:(e,t)=>this.renderHiddenGroup(r[t]),onDrop:e=>this.handleGroupReorder(e,!0)}):(0,je.jsx)("div",{children:r.map(this.renderHiddenGroup)}))})}renderAddGroupButton(){const{format:e,schema:t,collectionContextStore:o}=this.props;if(!e.board_columns_by)return;if("collectionTypedView"===o.contextType)return;const i=this.columnsDisplayStateStore.state.currentGroups;return(0,je.jsx)(Vn,{groupBy:e.board_columns_by,schema:t,currentGroups:i,onAccept:e=>function(e,t,o,i,r){const n=t.collectionStore();if(!n)return;const s=i.board_columns_by;if(!s)return;A.tH({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:n,schema:o,groupBy:s,environment:r})}(e,this.props.collectionContextStore,this.props.schema,this.props.format,this.environment),groupsLimitStore:o.boardColumnsLimitStore,parentStore:this.props.store,type:"board",collectionContextStore:o})}renderBoardColumnsForGroups(e,t,o){const{store:i,format:r,collectionContextStore:n,schema:s,disabled:l,isFullScreen:a,paddingLeft:c,isRootChild:d,isInPeekRenderer:p}=this.props;return(0,be.hJ)()?(0,je.jsx)(zr,{type:ad.M9,store:i,collectionContextStore:n,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:c,stickyLeft:!this.environment.device.isMobile,renderGroup:e=>this.renderBoardColumnsForGroup(e,t,o),getGroupStyle:Zd,renderHeader:this.renderSubGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem}):(0,je.jsx)(Mn,{store:i,id:ad.M9,groupBy:e,groupsFormatKey:te.Uh,groupAggregationKey:te.dQ,format:r,schema:s,collectionContextStore:n,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:c,renderGroup:e=>this.renderBoardColumnsForGroup(e,t,o),renderHeader:this.renderSubGroupHeader,renderHiddenGroupsButton:this.renderBoardHiddenGroupsButton,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,stickyLeft:!this.environment.device.isMobile,getGroupStyle:Zd,isInPeekRenderer:p})}renderBoardColumnsForGroup(e,t,o){return(0,je.jsx)("div",{style:ts.l8,children:t.map(((i,r)=>{const n=r===t.length-1;return this.renderGroupResults(e?[e,i]:[i],n,o)}))})}renderGroupResults(e,t,o){const{store:i,collectionContextStore:r,isFullScreen:n,query:s,schema:l,format:a,disabled:c,blockPropertyValueOverlayStore:d}=this.props,{hiddenGroups:p}=this.columnsDisplayStateStore.state,u=0!==p.length;if(!r.groupsStore.getGroupState(e))return;const h=r.permissionScopes.state,m=this.canEdit()&&("collectionTypedView"===r.contextType||h.canEditContent);return(0,je.jsx)(mn,{store:i,hoveredGroupStore:this.stores.hoveredGroupStore,query:s,schema:l,format:a,groupsPointer:e,collectionContextStore:r,isFullScreen:n,isInPeekRenderer:this.props.isInPeekRenderer,disabled:c||!m,isLast:t&&!u,blockPropertyValueOverlayStore:d,anyGroupHasResults:o},(0,te.KW)(e))}getHeaderStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props,i=t.isCompactView.state,r=i?"transparent":(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),n=un(this.disableBoardColorColumnsStore.state,i);return{position:"absolute",background:r,height:34+n,paddingTop:n,zIndex:M.LN,display:"flex",boxShadow:`-3px 0 0 ${r}`,minWidth:"100%"}}getHiddenGroupsWrapStyle(){const e=this.props.collectionContextStore.isCompactView.state;return{width:220,flexShrink:0,marginTop:34+un(this.disableBoardColorColumnsStore.state,e),marginLeft:12}}updateHiddenGroupsHeaderOffset(){var e;if("function"==typeof this.hiddenGroupsHeaderRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current)return;const t=(this.getHiddenGroupsHeaderOffset()||0)+this.hiddenGroupsHeaderLastOffset;this.hiddenGroupsHeaderLastOffset=t,this.hiddenGroupsHeaderRef.current.style.left=`${t}px`}getHiddenGroupsHeaderOffset(){var e,t;if("function"==typeof this.hiddenGroupsHeaderRef||"function"==typeof this.hiddenGroupsContainerRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current||null===(t=this.hiddenGroupsContainerRef)||void 0===t||!t.current)return;const o=this.hiddenGroupsHeaderRef.current.getBoundingClientRect().left;return this.hiddenGroupsContainerRef.current.getBoundingClientRect().left-o+8}}_d.displayName="Board";const Id=(0,j.injectIntl)(_d);function Bd(e,t){return t.groupsStore.getGroupState([e])}function Dd(e,t){const{visibleGroups:o,hiddenGroups:i,total:r}=e,n=0===o.length&&!t.shouldShowSpinner.state||o.length>0,s=Ut({collectionContextStore:t,isForColumnGroups:!0}),l=t.boardColumnsLimitStore.state<r-i.length;return n&&l||s}function Ad(e,t,o){const{visibleGroups:i}=e,r=t.board_columns_by,n=o.permissionScopes.state,s=0===i.length&&!o.shouldShowSpinner.state||i.length>0;return n.canConfigureBlock&&r&&(0,te.Wz)(r,n.canConfigureCollection)&&!n.isSyncedCollection&&s}function Ld(e){let{displayState:t,collectionContextStore:o,schema:i}=e;const r=o.boardColumnsLimitStore;return(0,je.jsx)(xr,{visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:r,type:"board",schema:i,collectionContextStore:o})}function Zd(e){return{marginTop:4,...e.isLast&&{paddingBottom:12}}}function Ed(e,t,o){return{position:"relative",width:220,flexShrink:0,display:"flex",alignItems:"center",fontSize:14,color:t.lightTextColor,...o?{}:{background:e?t.cardContentBackground:t.contentBackground},marginLeft:20}}function Od(e,t,o){return{height:"calc(100% + 17px)",...o?{}:{background:e?t.cardContentBackground:t.contentBackground},width:20,marginLeft:-20,marginTop:-17}}var Gd=o(13991),Nd=o(40506),zd=o(7057),Hd=o(53877),Kd=o(2585),Wd=o(5257),Ud=o(40863),$d=o(71574),qd=o(86615),Qd=o(28451),Yd=o(63296),Xd=o(92083),Jd=o(84437),ep=o(35599);const tp=(0,j.defineMessages)({defaultTitle:{id:"openInNotionCalendarOnboardingTooltip.header",defaultMessage:"Get Notion Calendar"},defaultContent:{id:"openInNotionCalendarOnboardingTooltip.content",defaultMessage:"View any Notion database with calendar and timeline views with your Google Calendar events"},connectCalendarTitle:{id:"openInNotionCalendarOnboardingTooltip.connectCalendarTitle",defaultMessage:"Connect Calendar"},successTitle:{id:"openInNotionCalendarOnboardingTooltip.success.header",defaultMessage:"Successfully connected"},successContent:{id:"openInNotionCalendarOnboardingTooltip.success.content",defaultMessage:"You can now view any database with calendar and timeline views in Notion Calendar"}});function op(e){let{variant:t,origin:o,onCloseClick:i,onConnectCalendarClick:r}=e;window.__c={n:"OpenInNotionCalendarTooltip"};const n=(0,ee.yK)((e=>({tooltip:{width:233},content:{opacity:1},contentInner:{display:"flex",flexDirection:"column",gap:14},contentMessage:{opacity:.8,color:e.regularInvertedTextColor},footer:{display:"flex",alignItems:"center",gap:12},primaryButton:{display:"flex",alignItems:"center",height:24,padding:"0 12px",marginLeft:"auto",borderRadius:4,background:"#FFF",color:"#1D1B16",fontSize:12,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},primaryButtonHover:{background:"rgba(255,255,255,0.9)"},primaryButtonPressed:{background:"rgba(255,255,255,0.8)"}})),[]);return(0,je.jsx)(ls.U,{origin:o,placementToOrigin:"bottom",header:(0,je.jsx)(j.FormattedMessage,{..."success"===t?tp.successTitle:tp.defaultTitle}),content:(0,je.jsxs)("div",{style:n.contentInner,children:[(0,je.jsx)("div",{style:n.contentMessage,children:(0,je.jsx)(j.FormattedMessage,{..."success"===t?tp.successContent:tp.defaultContent})}),"default"===t&&(0,je.jsx)("div",{style:n.footer,children:(0,je.jsx)(xo.Z,{style:n.primaryButton,hoveredStyle:n.primaryButtonHover,pressedStyle:n.primaryButtonPressed,onClick:r,children:(0,je.jsx)(j.FormattedMessage,{...tp.connectCalendarTitle})})})]}),contentStyle:n.content,onCloseClick:i,shouldDismissUponOutsideClick:!0,pointerPosition:"33%",style:{...n.tooltip}})}function ip(e){let{collectionContextStore:t}=e;window.__c={n:"OpenInNotionCalendarButton"};const o=(0,r.useRef)(null),[i,n]=(0,r.useState)(!1),[s,l]=(0,r.useState)(!1),a=(0,ne.O7)(),d=(0,c.VK)((()=>Do.default.state.currentSpaceStore),[]),p=(0,c.VK)((()=>Do.default.state.currentUserSettingsStore),[]),u=(0,c.VK)((()=>(0,$d.tE)()),[]),h=(0,c.VK)((()=>t.isFullScreen.state),[t]),m=(0,c.VK)((()=>{var e;if(!h)return!1;if(!td.default.checkGate("notion_calendar"))return!1;if(!p)return!1;if(!od.Z.state.loaded)return!1;return!Xd.Z.state.open&&(!!Do.default.state.inAppCalloutStore.canShow("open_in_calendar_tooltip")&&(!Eo.default.state.open&&(!s&&(!(null!==(e=p.getSettings())&&void 0!==e&&e.seen_open_in_calendar_tooltip)||i))))}),[h,p,i,s]),g=(0,r.useCallback)((()=>{const e=t.collectionViewStore(),o=t.collectionStore(),i=null==o?void 0:o.getParentBlockStore();e&&o&&i&&d&&(qd.QK(a,{is_calendar_connected:u,collection_id:o.id,collection_view_id:e.id,collection_view_block_id:i.id}),Jd.sh({environment:a,collectionViewStore:e,spaceStore:d,from:"openInCalendarButton"}))}),[a,t,d,u]),S=(0,r.useCallback)((()=>{i?l(!0):p&&Jd.Bm({environment:a,userSettingsStore:p,transactionUserAction:"OpenInCalendarTooltip.dismiss"})}),[a,i,p]),f=(0,r.useCallback)((()=>{n(!0),p&&Jd.Bm({environment:a,userSettingsStore:p,transactionUserAction:"OpenInCalendarTooltip.connectCalendar"}),g(),requestAnimationFrame((()=>{l(!1)}))}),[a,p,g]),y=(0,ee.yK)((e=>({button:{marginRight:8,paddingRight:12,fontSize:14,fontWeight:500,height:26},calendarIcon:{marginLeft:4},calendarIconSvg:{fill:e.timelineRed}})),[]);return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Yd.Z,{ref:o,style:y.button,iconStyle:y.calendarIconSvg,icon:e=>(0,je.jsx)(ep.Z,{style:{...e,...y.calendarIcon}}),onClick:g,children:(0,je.jsx)(j.FormattedMessage,{id:"openInNotionCalendarButton.label",defaultMessage:"Open in Calendar"})}),m&&(0,je.jsx)(Qd.P,{calloutId:"open_in_calendar_tooltip",children:(0,je.jsx)(op,{variant:i||u?"success":"default",origin:o,onCloseClick:S,onConnectCalendarClick:f})})]})}function rp(e){window.__c={n:"MaybeOpenInNotionCalendarButton"};const t=(0,ne.O7)();return(0,c.VK)((()=>(0,$d.ZH)({environment:t})),[t])?(0,je.jsx)(ip,{...e}):null}var np=o(15723),sp=o(17746),lp=o(50628),ap=o(53876);class cp extends Ro.Z{activate(){const e=function(e,t){const{mainEditorCurrentBlockStore:o}=Do.default.state;return re.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}(this.props.store,this.props.collectionContextStore);e&&(this.props.handleOpenPeekPage(),N.c4({environment:this.environment,url:e}))}didMount(){this.props.collectionContextStore.onItemMount()}renderComponent(){return(0,je.jsx)(pp,{...this.props})}}cp.displayName="CalendarItem";const dp=cp;function pp(e){window.__c={n:"CalendarItemFn"};const{store:t,row:o,schema:i,format:r,disabled:n,calendarBy:s,collectionContextStore:l,includeTime:a,resultsStore:d,handleOpenPeekPage:p,blockPropertyValueOverlayStore:u,calendarStore:h}=e,m=(0,ne.O7)(),g=i[s],S=(0,c.VK)((()=>!n&&"date"===(null==g?void 0:g.type)&&!l.permissionScopes.state.isSyncedCollection),[l.permissionScopes,n,null==g?void 0:g.type]),{start:f,end:y,startOfWeek:v,endOfWeek:C,startColumn:x,columnCount:b}=(0,Ud.du)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),k=(0,c.VK)((()=>{const e=r.calendar_properties?r.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[],o=e.filter((e=>no.XU({block:t.getModel(),property:e,schema:i,getRecordModel:t.getRecordModel,userId:m.currentUser.id,userTimeZone:(0,Ee.r)(),intl:Ne.default.getIntl()})));return o.concat(w.e5(e,o))}),[m.currentUser.id,r.calendar_properties,i,t]),P=(0,c.VK)((()=>(0,Fo.ls)({collectionContextStore:l})),[l]);if(!g||!Se.Lt(g))return null;const T=k.length+1+(P?1:0),V=f<v,R=void 0!==y&&y>C;return(0,je.jsxs)(up,{store:t,row:o,numRows:T,columnCount:b,startIsBeforeStartOfWeek:V,endIsAfterEndOfWeek:R,startColumn:x,disabled:n,isEditableDate:S,calendarBy:s,resultsStore:d,handleOpenPeekPage:p,children:[P&&(0,je.jsx)("span",{style:{paddingRight:4,paddingLeft:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,je.jsx)(vo.O,{blockStore:t,collectionContextStore:l})}),(0,je.jsx)(hp,{store:t,collectionContextStore:l,disabled:n,start:f,startOfWeek:v,end:y,endOfWeek:C,includeTime:a,columnCount:b,propertySchema:g}),(0,je.jsx)(gp,{store:t,sortedProperties:k,startIsBeforeStartOfWeek:V,disabled:n,blockPropertyValueOverlayStore:u}),S&&(0,je.jsx)(Sp,{store:t,start:f,startOfWeek:v,end:y,endOfWeek:C,calendarBy:s,calendarStore:h})]})}function up(e){window.__c={n:"CalendarItemWrapper"};const{store:t,children:o,columnCount:i,row:n,numRows:s,startColumn:l,disabled:a,isEditableDate:d,calendarBy:u,resultsStore:h,handleOpenPeekPage:m,startIsBeforeStartOfWeek:g,endIsAfterEndOfWeek:S}=e,f=(0,ne.O7)(),y=(0,Ir.Y$)(),v=(0,c.VK)((()=>re.Sc(t)),[t]),C=s*ap.ch+2*Vp+2*Rp,x=Tp+C*n,b=(0,c.VK)((()=>xi.Z.state.hoveredStore===e.store),[e.store]),w=(0,ee.yK)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:g?0:6,paddingRight:S?0:6,width:S?`calc(100% / 7 * ${i} - 1px)`:`calc(100% / 7 * ${i})`,left:`calc(100% / 7 * ${l})`,height:C,top:x},haloStyle:{...re.pB(v,e),borderRadius:5,marginTop:2,marginBottom:2,marginLeft:g?0:5,marginRight:S?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomLeftRadius:4,borderBottomRightRadius:4,boxShadow:e.lightBoxShadow,...S&&{borderTopRightRadius:0,borderBottomRightRadius:0},...g&&{borderTopLeftRadius:0,borderBottomLeftRadius:0}},linkBoxHoveredStyle:{opacity:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[i,S,C,v,l,g,x]),k=(0,r.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?D.QG({environment:f,collectionStore:o,collectionContextStore:y,store:t,insertStores:e.insertStores,calendarBy:u,transaction:e.transaction,results:h.state}):[]}),[u,y,f,h,t]),P=(0,r.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&A.Od({store:t,transaction:o})}),[t]),[T,V]=(0,c.VK)((()=>{const{mainEditorCurrentBlockStore:e}=Do.default.state,o=re.mb({store:t,mainEditorCurrentBlockStore:e,collectionContextStore:y,fullyQualified:!1});return[(0,_o.ZP)({store:t,fullyQualified:!1,pageVisitSource:p.tY.LinkInPage}),o]}),[y,t]),R=(0,c.VK)((()=>y.isCompactView.state),[y]);return(0,je.jsx)(_t.Z,{store:t,style:w.selectable,canSelect:!a,shouldShowHalo:!R,shouldForceRenderSelectionHalo:v,haloStyle:w.haloStyle,canTriggerContextMenu:!a,showBlockMenuInput:!0,canDrag:d,onInsertAbove:k,onInsertBelow:k,onRemove:P,canInsertAbove:d,canInsertBelow:d,analyticsName:"calendar",shouldShowDropZone:!0,className:eo.K4T,children:(0,je.jsx)(wo.Z,{style:w.linkBoxStyle,hoveredStyle:w.linkBoxHoveredStyle,pressedStyle:w.linkBoxHoveredStyle,innerStyle:w.linkBoxInnerStyle,onClick:m,href:T,metaHref:V,hovered:b,children:o})},t.id)}function hp(e){window.__c={n:"CalendarItemTitleRow"};const{store:t,collectionContextStore:o,disabled:n,start:s,startOfWeek:l,end:a,endOfWeek:d,includeTime:p,columnCount:u,propertySchema:h}=e,m=(0,ne.O7)(),g=s<l,S=a&&a>d,f=(0,c.VK)((()=>(0,Fo.wI)({collectionContextStore:o,blockStore:t})),[o,t]),y="time_format"in h?h.time_format:Nd.c_,[v,C,x]=(0,c.VK)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),b=(0,r.useCallback)((e=>{const o=t.getIconStore();o&&$.createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:m,perform:t=>{ho.sO({store:o,value:e,transaction:t})}})}),[m,t]),w=(0,ee.yK)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...g&&{paddingLeft:12},...S&&{paddingRight:11},width:p?100/u+"%":"100%"},titleInner:{display:"flex",alignItems:"center",height:24},titleTextStyle:{flexGrow:1,fontSize:14,fontWeight:R.Z.fontWeight.semibold},recordIconStyle:{flexShrink:0,marginRight:4,marginTop:2},iconWarningStyle:{marginLeft:1,marginRight:5,width:10,fill:e.accentColors.orange[500]},subitemCountIndicatorContainer:{paddingLeft:8,paddingRight:4,fontWeight:R.Z.fontWeight.regular,color:e.mediumTextColor,display:"flex",alignItems:"center"},timeStyle:{color:e.mediumTextColor,flexShrink:0,fontSize:10,marginLeft:4,height:14},endTimeStyle:{marginLeft:"auto",paddingLeft:4,marginRight:4,color:e.mediumTextColor,fontSize:10,whiteSpace:"nowrap",marginTop:-1},endTimeAbsoluteStyle:{position:"absolute",right:4,top:6}})),[u,S,p,g]),k=p&&a&&i.Xp.fromDateTimes(l,d).contains(a)&&s.day!==a.day,P=!(void 0===v&&C||x);return(0,je.jsx)("div",{style:w.titleContainer,children:(0,je.jsxs)("div",{style:w.titleInner,children:[P&&(n?(0,je.jsx)(ko.Z,{disabled:!0,icon:v,isEmptyPage:C,size:14,style:w.recordIconStyle}):(0,je.jsx)(ko.Z,{disabled:!1,store:t,bucket:"secure",icon:v,isEmptyPage:C,size:14,style:w.recordIconStyle,onChange:b})),x&&(0,ao.t)(w.iconWarningStyle),(0,je.jsx)(ha.Z,{style:w.titleTextStyle,store:t,enableHover:!0}),(0,je.jsx)(mp,{store:t}),f&&(0,je.jsx)("div",{style:w.subitemCountIndicatorContainer,children:(0,je.jsx)(Co.B,{blockStore:t,collectionContextStore:o})}),p&&i.Xp.fromDateTimes(l,d).contains(s)&&(0,je.jsx)("div",{style:w.timeStyle,children:(0,zd.xE)({dateTime:s,humanReadable:!1,timeFormat:y})}),k&&(0,je.jsx)("div",{style:{...w.endTimeStyle,...u>1?w.endTimeAbsoluteStyle:void 0},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"ends {endTime}",id:"calendarItem.endsTime.message",values:{endTime:(0,zd.xE)({dateTime:a,humanReadable:!1,timeFormat:y})}})})]})})}function mp(e){window.__c={n:"DiscussionIndicator"};const{store:t}=e,o=(0,ee.Fg)(),i=(0,c.VK)((()=>Bo.Xp(t,{recursivelyLoadAllDiscussions:!1})),[t]);return 0===i?null:(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",color:o.mediumTextColor,fontSize:12,marginLeft:4,flexShrink:0},children:[(0,lo.z)({width:12,height:12,marginRight:4,fill:o.mediumIconColor}),i]})}function gp(e){window.__c={n:"CalendarItemPropertiesRows"};const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:i,disabled:r,blockPropertyValueOverlayStore:n}=e,s=(0,Ir.Y$)(),l=(0,c.VK)((()=>s.permissionScopes.state.isLocked),[s.permissionScopes]),[a,d]=(0,c.VK)((()=>[re.Bm({store:t,collectionContextStore:s}),s.collectionViewStore()]),[t,s]);return a?(0,je.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...i&&{paddingLeft:12}},children:o.map((e=>(0,je.jsx)(So.Z,{store:t,property:e,disabled:r,locked:l,format:fo.C.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n,collectionStore:a,collectionViewStore:d},e)))}):null}function Sp(e){window.__c={n:"CalendarItemDraggables"};const{store:t,calendarStore:o,start:i,startOfWeek:n,end:s,endOfWeek:l,calendarBy:a}=e,c=(0,ne.O7)(),d=(0,ee.yK)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),p=(0,r.useCallback)((e=>{D.td({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:a})}),[o,a]),u=(0,r.useCallback)((()=>{$.createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:c,perform:e=>{D.fX({environment:c,transaction:e,calendarStore:o,calendarBy:a})}})}),[a,o,c]),h=(0,r.useCallback)((()=>{D.cQ({calendarStore:o})}),[o]),m=i>n&&(0,je.jsx)(el.Z,{render:e=>(0,je.jsx)("div",{style:d.leftDragHandle,...e}),onDraggableDragStart:()=>{D.f$({calendarStore:o,target:t,direction:sp.t.Left})},onDraggableDragMove:p,onDraggableDragEnd:u,onDraggableDragCancel:h}),g=(!s||s&&s<l)&&(0,je.jsx)(el.Z,{render:e=>(0,je.jsx)("div",{style:d.rightDragHandle,...e}),onDraggableDragStart:e=>{D.f$({calendarStore:o,target:t,direction:sp.t.Right})},onDraggableDragMove:p,onDraggableDragEnd:u,onDraggableDragCancel:h});return(0,je.jsxs)(je.Fragment,{children:[m,g]})}const fp={height:28,width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",color:fe.ZP.white,background:fe.ZP.red,marginLeft:"auto",marginRight:"auto"},yp={height:28,display:"flex",alignItems:"center",justifyContent:"center"},vp={width:"100%",height:44,borderRadius:4},Cp={position:"absolute",fontSize:14,top:4,right:10,height:24,lineHeight:"24px",textAlign:"right",transition:"color 100ms ease-out"},xp={position:"relative",display:"flex"},bp={},wp={height:74},kp={height:66},Pp={position:"relative",paddingLeft:1,height:"100%"},Tp=30,Vp=2,Rp=3;class Mp extends Ro.Z{constructor(){super(...arguments),this.headerEl=void 0,this.root=void 0,this.verticalScrollableAncestor=void 0,this.storeTypes={calendarStore:sp.Z,resultStore:d.default.createClass(void 0)},this.handleHeaderMount=e=>{this.headerEl=e},this.handleScroll=()=>{if(!this.headerEl)return;if(!Ip(this.props.collectionContextStore,this.props.isFullScreen,this.environment))return;const{calendarStore:e}=this.stores,t=e.state,o=this.headerEl.getBoundingClientRect();let i=[];t.dayStoreMap.forEach(((e,t)=>{i.push({store:e,timestamp:t})})),i=w.MR(i,(e=>{let{timestamp:t}=e;return t}));const r=i.find((e=>{let{store:t}=e;const i=Gl.C.getRectFromStore(t);return Boolean(i&&i.top<=o.top+o.height&&i.top+i.height>=o.top+o.height)}));if(r){const o=(0,Hd.kl)((0,Hd.Xz)({date:(0,Hd.V7)(r.timestamp,wi.AK.state),daysToAdd:1}));o!==t.startingMonth&&e.setState({...e.state,startingMonth:o})}},this.handleScrollThrottled=w.P2(this.handleScroll,100),this.handleMouseMove=e=>{const{calendarStore:t}=this.stores,o=t.state;if(!o.isDragging&&!Lo.Z.state){const i=this.findHoveredDay(e.clientX,e.clientY);o.hoveredDay!==i&&t.setState({...o,hoveredDay:i})}},this.handleMouseMoveThrottled=w.P2(this.handleMouseMove,50),this.handleTodayClick=()=>{const e=Fp(this.props.collectionContextStore),t="month"===e?(0,Hd.IS)((0,Hd.kl)(Date.now()),wi.AK.state):(0,Hd.IS)(Date.now(),wi.AK.state);this.setNewCalendarStart(t,e)},this.handleOpenPeekPage=()=>{const{collectionContextStore:e}=this.props;hi.default.mark("collections.open_item_page_lag");const t=e.collectionViewStore();O.Xd({collectionContextStore:e,resultsStore:this.sortedResultsStore});const o=null==t?void 0:t.getFormat().collection_peek_mode,i=o||ki.Ls.calendar;bi.hy(this.environment,{is_peek:!0,from:"calendar",peek_mode:i})},this.startOfWeekSettingStore=this.createComputedStore((()=>{const{currentUserSettingsStore:e}=Do.default.state;if(!e)return 0;const t=e.getSettings();return null!=t&&t.start_day_of_week?t.start_day_of_week:0}),!0),this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,Ud.Ft)({collectionContextStore:e})}),!0),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return[];const o=this.stores.resultStore.state;return o?o.blockIds.map((e=>me.G.createChildStore(t,{id:e,table:P.iU}))):[]}),!0),this.weeksStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=Ne.default.getIntl();return(0,Ud.y$)({collectionContextStore:e,results:this.resultsStore.state,getRecordValue:this.getRecordValue,intl:t})}),!0),this.sortedResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return o&&(null===(e=this.weeksStore.state)||void 0===e?void 0:e.flatMap((e=>e.items.map((e=>me.G.createChildStore(o,{table:P.iU,id:e.id}))))))||[]}),!0),this.isMyTasks=this.createComputedStore((()=>(0,wi.qG)(this.props.store.id))),this.getRecordValue=this.props.store.getRecordValue}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const{collectionContextStore:t}=e;this.handleMount(t),wi.AK.addListener((()=>{this.handleMount(this.props.collectionContextStore)}))}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e),Lo.Z.state&&(this.stores.calendarStore.state.isDragging||this.stores.calendarStore.setState({...this.stores.calendarStore.state,hoveredDay:void 0}));const{query:t}=e;t.calendar_by||function(e,t,o){const{schema:i}=e,r=t.permissionScopes.state,n=Ne.default.getIntl(),s=t.collectionStore();if(!s)return;const l=t.collectionViewStore();if(!l||!r.canConfigureBlock)return;$.createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:o,perform:e=>{let t,a=re.PD(i);if(!a&&r.canConfigureCollection){a=(0,cd.ZP)();t={[a]:{name:n.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}de.Es({collectionViewStore:l,update:{calendar_by:a},transaction:e}),ho.sW({store:l,data:{type:"calendar"},transaction:e}),t&&de.xO({environment:o,collectionStore:s,update:t,transaction:e})}})}(e,this.props.collectionContextStore,this.environment)}didMountOrUpdate(){this.handleScrollThrottled(),this.root||(this.root=n.findDOMNode(this),this.root&&(this.verticalScrollableAncestor=(0,he.VW)(this.root),this.verticalScrollableAncestor&&ai.lj(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),ai.lj(this.root,"mousemove",this.handleMouseMoveThrottled)))}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&ai.ZV(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),this.root&&ai.ZV(this.root,"mousemove",this.handleMouseMoveThrottled)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}renderPersisted(){const{device:e}=this.environment,{store:t,paddingBottom:o,paddingLeft:i,paddingRight:r,query:n,schema:s,collectionContextStore:l,isFullScreen:a}=this.props,{calendar_by:c}=n;if(!c)return(0,je.jsx)(_p,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight});const d=s[c];if(!d||!Se.Lt(d))return(0,je.jsx)(_p,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight});const p=this.reducerStore.state;if(!p)return;const u=Fp(l),h=l.isCompactView.state;return(0,ci.Z)((n=>(0,je.jsx)(He.Z,{id:"calendar_results",resultStore:this.stores.resultStore,collectionContextStore:l,reducer:p,render:()=>(0,je.jsx)(Xi,{isFullScreen:a,children:(0,je.jsx)($r.Z,{onChange:e=>function(e,t,o,i){const r=t.isLoading.state,n=Ip(t,o,i);if(e<oo.Z.incrementScrollOffset&&!r&&n){const e=t.dateRangeStart.state,o=t.dateRangeEnd.state,i=(0,Hd.V7)((0,Hd._)({date:o,monthsToAdd:2}),wi.AK.state);de.t5({dateRangeStart:e,dateRangeEnd:i,collectionContextStore:t})}}(e,this.props.collectionContextStore,this.props.isFullScreen,this.environment),children:(0,je.jsx)("div",{style:{paddingBottom:o,paddingLeft:i,paddingRight:r,minWidth:this.props.minWidth,height:"100%"},className:eo.c7X,children:(0,je.jsxs)(_t.Z,{style:Pp,store:t,shouldShowHalo:!a&&!h,canSelect:!a,onMouseDown:e=>function(e,t,o){const{device:i}=o,{target:r}=e;!i.isPhone&&r instanceof HTMLElement&&(0,ue.ZP)({event:e,context:ue.Af.EditorMouseDown,callback:()=>{e.preventDefault(),G.AI({environment:o,target:r,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[t],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}(e,this.props.store,this.environment),analyticsName:"calendar",...n,children:[this.renderHeader(this.getCurrentlyViewedMonth(),u),h?(0,je.jsx)(yt,{style:{height:"calc(100% - 66px)"},children:this.renderCalendarBody()}):(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:e.isPhone?wp:kp}),this.renderCalendarBody()]})]})})})})})))}renderHeader(e,t){const{device:o}=this.environment,{collectionContextStore:i}=this.props,r=Ne.default.getIntl(),n=i.isCompactView.state;return(0,je.jsx)(jt,{position:ft(n),children:(0,je.jsxs)("div",{style:o.isPhone?(s=this.theme,{position:"absolute",left:0,right:0,background:s.contentBackground,zIndex:M.VT}):Bp(this.props.collectionContextStore,this.props.isInPeekRenderer,this.theme),ref:this.handleHeaderMount,children:[(0,je.jsxs)("div",{style:{display:"flex",height:42,alignItems:"center",marginBottom:2},children:[(0,je.jsx)("div",{style:{fontWeight:R.Z.fontWeight.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:o.isPhone?16:14},children:this.getHeaderText(t,e,Gd.SP)}),(0,je.jsx)("div",{style:{flexGrow:1}}),(0,je.jsx)(rp,{collectionContextStore:i}),(0,je.jsx)(Ft.Z,{ariaLabel:r.formatMessage({id:"database.calendarView.previousMonthButton.label",defaultMessage:"Previous Month"}),mobileFeedback:o.isMobile,icon:Kd.f,onClick:()=>this.handleCalendarClick("left",i)}),(0,je.jsx)(Ye.Z,{isSmall:!0,onClick:this.handleTodayClick,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Today",id:"database.calendarView.todayButton.label"})}),(0,je.jsx)(Ft.Z,{ariaLabel:r.formatMessage({id:"database.calendarView.nextMonthButton.label",defaultMessage:"Next Month"}),mobileFeedback:o.isMobile,icon:Wd.o,onClick:()=>this.handleCalendarClick("right",i)})]}),(0,je.jsx)("div",{style:{display:"flex",marginTop:o.isPhone?8:0,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`},className:eo.GNl,children:(0,zd.kv)(wi.AK.state,Gd.SP).map((e=>{let[t,o]=e;return(0,je.jsx)("div",{style:Dp(this.theme),children:o},t)}))})]})});var s}renderCalendarBody(){var e,t;const{device:o}=this.environment,{query:i,schema:r,collectionContextStore:n}=this.props,{calendar_by:s}=i;if(!s)return null;const l=r[s];if(!l)return null;const a=(void 0===(null===(e=this.stores.resultStore.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=this.stores.resultStore.getState())||void 0===t?void 0:t.blockIds.length))&&Kt({collectionContextStore:n,groupsPointer:[],hasPartialResults:!1}),c=Fp(n),d=this.weeksStore.state;return(0,je.jsx)("div",{style:o.isPhone?bp:(p=this.theme,{boxShadow:`-1px 0 0 ${p.tableDividerColor}`,marginTop:1,overflow:"hidden"}),children:d&&d.map((e=>o.isPhone?this.renderMobileWeek(e.start,e.items,s,c,a):this.renderWeek(e.start,e.end,e.items,s,l,c,a)))});var p}renderWeek(e,t,o,i,r,n,s){const{collectionContextStore:l,format:a,schema:c,blockPropertyValueOverlayStore:d}=this.props,p=l.collectionViewStore();if(!p)return;const u=this.canEditCalendar(),{calendarStore:h}=this.stores,m=h.state,g=[...Array(7).keys()].map((t=>this.renderDay(t,(0,Hd.Xz)({date:e,daysToAdd:t}),i,r,n,s))),S=[];let f=0;for(const w of o){const o=me.G.createChildStore(p,{table:P.iU,id:w.id});m.isDragging&&m.target===o&&m.temporaryValue||S.push((0,je.jsx)(dp,{collectionContextStore:l,store:o,startOfWeek:e,endOfWeek:t,start:w.start,end:w.end,row:w.row,includeTime:w.includeTime,format:a,schema:c,calendarBy:i,disabled:!u,calendarStore:h,blockPropertyValueOverlayStore:d,resultsStore:this.resultsStore,handleOpenPeekPage:this.handleOpenPeekPage},o.id)),w.row>f&&(f=w.row)}const y=m.isDragging&&m.temporaryValue&&(0,Hd.Y_)(m.temporaryValue,(0,Ee.r)());if(m.isDragging&&m.temporaryValue&&y&&(0,Nd.b8)(e,t,y.start,y.end)){const{target:r,temporaryValue:n}=m,s=o.find((e=>e.id===r.id));S.push((0,je.jsx)(dp,{collectionContextStore:l,store:r,startOfWeek:e,endOfWeek:t,start:y.start,end:y.end,row:s?s.row:0,includeTime:"datetime"===n.type||"datetimerange"===n.type,format:a,schema:c,calendarBy:i,disabled:!u,calendarStore:h,blockPropertyValueOverlayStore:d,resultsStore:this.resultsStore,handleOpenPeekPage:this.handleOpenPeekPage},r.id))}const v=(a.calendar_properties?a.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).length+1+((0,Fo.ls)({collectionContextStore:l})?1:0),C="week"===n?372:124,x=ap.ch*v+2*Vp+2*Rp,b=Math.max((f+1)*x+Tp+4,C);return(0,je.jsxs)("div",{style:{...xp,height:b},children:[g,S]},e.toString())}renderDay(e,t,o,i,r,n){const{store:s,collectionContextStore:l}=this.props,{calendarStore:a}=this.stores,{dayStoreMap:c}=a.state,d=Ne.default.getIntl(),p=a.state,u="date"===i.type,h=l.shouldAllowNewItemCreation();let m=c.get(t);m||(m=new me.G(this.environment,s.pointer,{userId:s.userId,inMemoryRecordCache:s.inMemoryRecordCache}),c.set(t,m));const g=!p.isDragging&&p.hoveredDay===t,S=(0,Hd.Bn)({firstDate:t,secondDate:this.getCurrentlyViewedMonth()}),f=(0,Hd.Y3)(t),y=(0,Hd.LY)(t),v=!S&&!f&&"week"!==r,C=d.formatMessage({defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"});return(0,je.jsxs)(_t.Z,{style:y?(x=this.props.isInPeekRenderer,b=this.theme,{...Ap(b),background:x?b.cardSidebarBackground:b.sidebarBackground}):Ap(this.theme),store:m,canDropOnto:this.canEditCalendar()&&u,onSelectableDrop:e=>{$.createAndCommit({userAction:"Calendar.renderDay",environment:this.environment,perform:i=>{const r=l.collectionStore();if(!r&&"collectionTypedView"!==l.contextType)return;const n=hi.default.mark("collections.drop_item_lag");hi.default.measureAfterNextFlush(n,{environment:this.environment,getData:()=>pe.yr({collectionContextStore:l,is_native_drop:!1,is_empty:!1})}),D.JN({...e,environment:this.environment,startOfDay:t,calendarBy:o,collectionStore:r,collectionContextStore:l,results:this.resultsStore.state,transaction:i})}})},onDoubleClick:()=>{if(this.canEditCalendar()&&ge.M_(this.environment)&&h){const e=this.createBlockInDay(t,o);ce.W(this.environment,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,pe.Pn)(l)})}},analyticsName:"calendar_day",shouldShowDropZone:!0,children:[g&&(u||f)&&h&&this.canEditCalendar()&&(0,je.jsx)(Je.ZP,{renderTooltip:()=>C,render:e=>(0,je.jsx)(Ft.Z,{ariaLabel:C,icon:ae.R,showShadow:!0,hasBackground:!0,style:{position:"absolute",top:6,left:6,width:20,height:20},onClick:()=>{if(ge.M_(this.environment)){const e=this.createBlockInDay(t,o);ce.W(this.environment,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,pe.Pn)(l)})}},...(0,ze.Z)(e,{onMouseDown:ue.$0})})}),(0,je.jsx)("div",{style:{...f?Lp(this.theme):Cp,...v&&{color:this.theme.lightTextColor}},className:n?`${eo.irE} notion-shimmer-text animation-delay-${e} notion-shimmer-calendar-transition`:`${eo.irE} notion-shimmer-calendar-transition`,children:1!==(0,Hd.TE)(t)||f?(0,Hd.TE)(t):`${new Intl.DateTimeFormat(d.locale,{month:"short",day:"numeric"}).format(new Date(t))} `})]},t.toString());var x,b}renderMobileWeek(e,t,o,i,r){const n=[...Array(7).keys()].map((n=>{const s=(0,Hd.Xz)({date:e,daysToAdd:n});return this.renderMobileDay(n,s,(0,Hd.us)(s),t,o,i,r)}));return(0,je.jsx)("div",{style:(s=this.theme,{display:"flex",boxShadow:`0 -1px 0 ${s.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}),children:n},e.toString());var s}renderMobileDay(e,t,o,i,r,n,s){const{collectionContextStore:l,query:a,format:c,schema:d,blockPropertyValueOverlayStore:p}=this.props,u=this.canEditCalendar(),h=i.find((e=>(0,Nd.b8)(t,o,e.start,e.end?e.end:void 0))),m=(0,Hd.TE)(t),g=(0,Hd.Bn)({firstDate:t,secondDate:this.getCurrentlyViewedMonth()}),S=(0,Hd.Y3)(t),f=!g&&!S&&"week"!==n;return(0,je.jsx)(Qe.ZP,{popupType:Qe.Z4.SlideUp,renderOrigin:t=>{return(0,je.jsxs)(xo.Z,{style:vp,...t,children:[(0,je.jsx)("div",{style:{...S?fp:yp,...f&&{color:this.theme.lightTextColor}},className:s?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${e}`:"notion-shimmer-calendar-transition",children:m}),h&&(0,je.jsx)("div",{style:(o=this.theme,{width:8,height:8,background:o.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"})})]});var o},render:e=>(0,je.jsx)(Ol.LazyMobileCalendarDayMenu,{collectionContextStore:l,initialStartOfDay:t,format:c,schema:d,query:a,calendarBy:r,disabled:!u,onDismiss:e.close,blockPropertyValueOverlayStore:p,resultsStore:this.resultsStore})},m.toString())}handleCalendarClick(e,t){const o=(0,Hd.V7)(t.dateRangeStart.state,wi.AK.state),i=Fp(this.props.collectionContextStore);if("month"===i){const t="left"===e?-1:1,r=(0,Hd.IS)((0,Hd.kl)((0,Hd._)({date:o,monthsToAdd:t})),wi.AK.state);this.setNewCalendarStart(r,i)}else{const o="left"===e?-7:7,r=(0,Hd.IS)((0,Hd.Xz)({date:t.dateRangeStart.state,daysToAdd:o}),wi.AK.state);this.setNewCalendarStart(r,i)}}handleMount(e){const t=e.collectionViewStore();if(!t)return;const o=this.startOfWeekSettingStore.state;if(void 0===o)return;const i=Fp(e),r=sp.Z.getLocalDateRangeStart({collectionViewId:t.id,currentUserId:this.environment.currentUser.id}),n=(0,Hd.IS)(r,o),s=(0,Hd.IS)((0,Hd.kl)(r),o),l="month"===i?s:n;this.stores.calendarStore.setState({...this.stores.calendarStore.state,startingMonth:s.valueOf()}),this.setNewCalendarStart(l,i)}getHeaderText(e,t,o){var i;const r=(0,zd.Yx)(t,"month_year_long",o);if("month"===e)return r;const n=null===(i=this.weeksStore)||void 0===i||null===(i=i.state)||void 0===i?void 0:i[0];if(void 0===n)return"";if((0,Hd.Bn)({firstDate:n.start,secondDate:n.end}))return r;return`${(0,zd.Yx)(n.start,(0,Hd.Xh)({firstDate:n.start,secondDate:n.end})?"month_short":"month_year_short",o)} - ${(0,zd.Yx)(n.end,"month_year_short",o)}`}setDateRange(e,t){const{collectionContextStore:o}=this.props,{calendarStore:i}=this.stores;de.t5({dateRangeStart:e,dateRangeEnd:t,collectionContextStore:o}),i.setState({...i.state,startingMonth:(0,Hd.kl)((0,Hd.V7)(e,wi.AK.state))})}findHoveredDay(e,t){K.Ch();const{dayStoreMap:o}=this.stores.calendarStore.state,{selectableRectMap:i}=lp.Z.state,r=Array.from(o.keys()),n=Array.from(o.values());for(const[s,l]of i.entries())if(l&&np.uh(l,e,t)&&n.indexOf(s.props.store)>=0)return r.find((e=>o.get(e)===s.props.store))}createBlockInDay(e,t){const{collectionContextStore:o}=this.props,{mainEditorCurrentBlockStore:i}=Do.default.state,{performResult:r}=$.createAndCommit({userAction:"Calendar.createBlockInDay",environment:this.environment,perform:r=>{const n=this.isMyTasks.state,s=A.IW({environment:this.environment,collectionContextStore:o,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:r,from:n?"home_tasks":"calendar"});if(!s)return;D.xD({type:"timestamp",environment:this.environment,store:s.newStore,propertyId:t,timestampMs:e,transaction:r});const l=re.mb({store:s.newStore,mainEditorCurrentBlockStore:i,collectionContextStore:o,overridePeekMode:n?"center_peek":void 0,showMoveTo:n})??(0,_o.ZP)({store:s.newStore,pageVisitSource:p.tY.Create});return this.navigate(l),O.Xd({collectionContextStore:o,resultsStore:void 0}),s.newStore}});return r}setNewCalendarStart(e,t){const{collectionContextStore:o}=this.props,i=o.collectionViewStore();if(!i)return;const r=Ip(this.props.collectionContextStore,this.props.isFullScreen,this.environment),n=wi.AK.state,s=(0,Hd.V7)(e,n),l=(0,Hd.IS)(e,n);if(sp.Z.setLocalDateRangeStart({collectionViewId:i.id,dateRangeStart:"month"===t?s:l,currentUserId:this.environment.currentUser.id}),"month"===t){const t=r?(0,Hd.V7)((0,Hd._)({date:s,monthsToAdd:1}),n):(0,Hd.V7)((0,Hd.RN)(s),n);this.setDateRange(e,t),this.verticalScrollableAncestor&&r&&(this.verticalScrollableAncestor.scrollTop=0)}else"week"===t&&this.setDateRange(e,s)}canEditCalendar(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&(e.canEditContent||"collectionTypedView"===this.props.collectionContextStore.contextType)}getCurrentlyViewedMonth(){const e=this.props.collectionContextStore.dateRangeStart.state;return Ip(this.props.collectionContextStore,this.props.isFullScreen,this.environment)||!e?this.stores.calendarStore.state.startingMonth:(0,Hd.kl)((0,Hd.V7)(e,wi.AK.state))}}Mp.displayName="Calendar",Mp.contextTypes={...li.wK,...s.w};const jp=Mp;function Fp(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_view_range").getValue())??"month"}function _p(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:i,paddingLeft:r,paddingRight:n}=e;window.__c={n:"MissingDateProperty"};const s=t.settingsStore,l=(0,c.VK)((()=>t.permissionScopes.state.canConfigureBlock),[t]);return(0,je.jsx)(Fd,{collectionContextStore:t,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:l?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,je.jsx)(jd,{onClick:()=>{L.r$({collectionContextStore:t,collectionSettingsStore:s}),L.H4({collectionSettingsStore:s,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:n,paddingBottom:o?void 0:i}})}function Ip(e,t,o){const{device:i}=o,r="month"===Fp(e);return t&&!i.isMobile&&r}function Bp(e,t,o){var i;if(e.isCompactView.state)return{};return{position:"absolute",left:0,right:0,background:(null===(i=e.inheritedBlockColorStore.state)||void 0===i?void 0:i.background)||(t?o.cardContentBackground:o.contentBackground),zIndex:M.VT}}function Dp(e){return{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,height:24,color:e.lightTextColor}}function Ap(e){return{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default"}}function Lp(e){return{position:"absolute",fontSize:14,top:4,right:4,height:24,width:24,lineHeight:"24px",borderRadius:"100%",textAlign:"center",color:fe.ZP.white,background:e.calendarTodayBackground}}var Zp=o(6776);function Ep(e){const{environment:t,newStore:o,previousStore:i}=e;K.eP({environment:t,store:o}),de.Z5({store:o}),Zp.Z.setState({store:o,editMode:"new",previousStore:i})}class Op extends Ro.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:Mo.Z},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:i,collectionContextStore:r}=this.props,n=re.Bm({store:t,collectionContextStore:r});if(n)return(0,je.jsx)(So.Z,{store:t,property:e,disabled:o||!t.canEdit(),locked:r.permissionScopes.state.isLocked,format:fo.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:n,collectionViewStore:r.collectionViewStore(),showIfEmpty:this.isEditing.state||r.isCompactView.state,onBgClick:()=>Xp(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store),onEnter:()=>Xp(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store),onEsc:()=>Xp(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store),onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,onClick:()=>$p(this.props.store)},e)},this.handleMouseMove=()=>{if(!Lo.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=w.P2(this.handleMouseMove,100),this.handleMouseLeaveDebounced=w.Ds(this.handleMouseLeave,100),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered)),this.isEditing=this.createComputedStore((()=>{const e=Ao.Z.state;return Boolean(e.isActive&&e.store.id===this.props.store.id)})),this.newItemEditMode=this.createComputedStore((()=>{const e=Zp.Z.state;return e.store&&e.store.id===this.props.store.id?e.editMode:void 0})),this.newItemPreviousStore=this.createComputedStore((()=>{const e=Zp.Z.state;return e.store&&e.store.id===this.props.store.id?e.previousStore:void 0})),this.handleTitleTab=()=>{Qp(Wp(this.getNonEmptyProperties(),this.props.schema),this.props.blockPropertyValueOverlayStore,this.props.store,this.props.collectionContextStore,this.environment)},this.handleTitleUntab=()=>{Qp(Kp(this.getNonEmptyProperties(),this.props.schema),this.props.blockPropertyValueOverlayStore,this.props.store,this.props.collectionContextStore,this.environment)},this.handleBlockPropertyTab=()=>{qp(this.findNextOpenableProperty(),this.props.store,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.environment)},this.handleBlockPropertyUntab=()=>{qp(this.findPreviousOpenableProperty(),this.props.store,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.environment)},this.shouldCaptureKeyboard=this.createComputedStore((()=>Oo.default.state.stores.length>0&&Oo.default.state.stores[0].id===this.props.store.id))}activate(){const e=zp(this.props.store,this.props.collectionContextStore);e&&(this.props.handleOpenPeekPage(),N.c4({environment:this.environment,url:e}))}didMount(){super.didMount(),this.isEditing.state&&"new"===this.newItemEditMode.state&&U.NX({store:this.props.store.getBlockTitleStore()})}willUnmount(){super.willUnmount(),Zp.Z.reset(),Ao.Z.reset()}renderComponent(){const{device:e}=this.environment,{showProperties:t}=this.props,o=e.isPhone&&this.props.showProperties.length>0,i=(0,je.jsx)(Up,{collectionContextStore:this.props.collectionContextStore,toggleButton:this.props.toggleButton,subitemPath:this.props.subitemPath});return o?(0,je.jsxs)("div",{style:{display:"flex"},children:[i,(0,je.jsxs)(wo.Z,{href:Hp(this.props.store),metaHref:zp(this.props.store,this.props.collectionContextStore),external:!1,style:(n=this.theme,{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${n.tableDividerColor}`}),innerStyle:{paddingRight:4,marginTop:10,marginBottom:10},children:[(0,je.jsx)("div",{style:{display:"flex",alignItems:"center"},children:this.renderTitle()}),(0,je.jsx)("div",{style:{display:"flex",alignItems:"center",paddingLeft:6,marginTop:4},children:t.map(this.renderProperty)})]})]}):(0,je.jsx)(bo.Z,{capture:this.shouldCaptureKeyboard.state,onShiftEnter:this.props.onShiftEnter,children:(0,je.jsxs)("div",{style:{display:"flex"},children:[i,(0,je.jsxs)(wo.Z,{href:Hp(this.props.store),metaHref:zp(this.props.store,this.props.collectionContextStore),altHref:zp(this.props.store,this.props.collectionContextStore),onClick:()=>Yp(this.props.store,this.props.handleOpenPeekPage),external:!1,style:(r=this.isEditing.state?"multi":"single",{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:4,..."single"===r?{height:30}:{minHeight:30}}),innerStyle:{display:"flex",alignItems:"center",paddingRight:4,userSelect:this.isEditing.state?void 0:"none",WebkitUserSelect:this.isEditing.state?void 0:"none"},hoveredStyle:{background:this.isEditing.state?"transparent":this.theme.buttonHoveredBackground},pressedStyle:{background:this.isEditing.state?"transparent":this.theme.buttonPressedBackground},onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,children:[this.renderTitle(),t.map(this.renderProperty)]})]})});var r,n}renderTitle(){const{store:e,disabled:t,collectionContextStore:o,blockPropertyValueOverlayStore:i}=this.props,r=re.Bm({store:e,collectionContextStore:o});if(!r)return;const{isSyncedCollection:n}=o.permissionScopes.state;return(0,je.jsx)(So.Z,{store:e,property:n?" title":"title",disabled:t||!e.canEdit(),locked:o.permissionScopes.state.isLocked,format:fo.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:r,collectionViewStore:o.collectionViewStore(),forceMouseEntered:this.mouseIsEntered.state&&!(0,wi.aT)(this.props.collectionViewBlockStore.id,o.isInPeekRenderer.state),handleOpenPeekPage:()=>Yp(this.props.store,this.props.handleOpenPeekPage),onTab:this.handleTitleTab,onUntab:this.handleTitleUntab})}findPreviousOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),i=t.isOpen?o.findIndex((e=>e===t.property)):-1,r=w.dF(o,((e,t)=>t<i&&Np(e,this.props.schema)));return r||(this.isEditing.state?"title":Kp(o,this.props.schema))}findNextOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),i=t.isOpen?o.findIndex((e=>e===t.property)):-1,r=o.find(((e,t)=>t>i&&Np(e,this.props.schema)));return r||(this.isEditing.state?"title":Wp(o,this.props.schema))}getNonEmptyProperties(){const{store:e,schema:t,showProperties:o}=this.props;return e.isDefined()?o.filter((o=>{const i="title"!==o&&this.isEditing.state;return!Ht.wV({property:o,schema:t,block:e.getModel(),getRecordModel:e.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,Ee.r)(),intl:Ne.default.getIntl()})||i})):[]}}Op.displayName="CollectionListViewItem";const Gp=Op;function Np(e,t){const o=t[e];return Boolean(o&&!Se.uk.includes(o.type))}function zp(e,t){const{mainEditorCurrentBlockStore:o}=Do.default.state;return re.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}function Hp(e){return(0,_o.ZP)({store:e,fullyQualified:!1,pageVisitSource:p.tY.LinkInPage})}function Kp(e,t){return w.dF(e,(e=>Np(e,t)))}function Wp(e,t){return e.find((e=>Np(e,t)))}function Up(e){let{collectionContextStore:t,toggleButton:o,subitemPath:i}=e;window.__c={n:"ToggleButton"};const r=(0,c.VK)((()=>t.currentSubitemFormatStoreForUiDisplay.state),[t]),n=(null==i?void 0:i.length)??0;if(!r)return null;const s=Math.max((n-1)*Fo.Hw,0)+Fo.gY;return o?(0,je.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,je.jsx)("div",{style:{width:s}}),o]}):(0,je.jsx)("div",{style:{minWidth:s+Fo.Hw}})}function $p(e){de.IH({store:e})}function qp(e,t,o,i,r){if(o.state.isOpen){if("title"===e){po.xv({environment:r,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();K.eP({environment:r,store:t}),U.NX({store:e})}else e?(po.xv({environment:r,blockPropertyValueOverlayStore:o}),po.bA({environment:r,blockPropertyValueOverlayStore:o,store:t,property:e,format:fo.C.ListView,collectionContextStore:i})):po.xv({environment:r,blockPropertyValueOverlayStore:o});$p(t)}}function Qp(e,t,o,i,r){e&&po.bA({environment:r,blockPropertyValueOverlayStore:t,store:o,property:e,format:fo.C.ListView,collectionContextStore:i}),$p(o)}function Yp(e,t){$p(e),t()}function Xp(e,t,o){po.xv({environment:e,blockPropertyValueOverlayStore:t}),K.Ys({environment:e,store:o}),$p(o)}function Jp(){return{marginTop:1,marginBottom:1,borderRadius:4}}const eu=r.memo((function(e){let{groupFormat:t,store:o,format:i,disabled:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:a}=e;const d=(0,ne.O7)(),p=(0,r.useMemo)((()=>t?[t]:[]),[t]),u=(0,r.useMemo)((()=>(i.list_properties?i.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[i]),{permissionScopes:h}=(0,c.VK)((()=>({permissionScopes:s.permissionScopes.state})),[s]),m=(0,c.VK)((()=>s.groupsStore.getGroupState(p)),[p,s]),g=(0,c.VK)((()=>!n&&o.canEdit()&&h.canEditContent&&!h.isSyncedCollection),[n,o,h]),S=(0,r.useCallback)((()=>{if(!m)return;const e=s.collectionStore();if(!e||!s.shouldAllowNewItemCreation())return;const t=Oo.default.state.stores[0];if(!t)return;const o=s.subitemTreeStore.state,i=(0,fi.DY)(o.children,(e=>e.value.store===t));if(!i)return;const r=i?(0,Fo.Af)(i.map((e=>e.value.store))):"",n=s.subitemExpandedStore.state.get(r),l=Boolean(null==n?void 0:n.isExpanded);$.createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:d,perform:o=>{const r=A.yk({environment:d,collectionContextStore:s,groupsPointer:m.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:i,subitemInsertDirection:l?"into":"below",from:"list_selection_overlay_shift_enter"});r&&Ep({environment:d,newStore:r,previousStore:t})}}),F.sd(d,"list_item_edit_mode_enter",{...(0,pe.Pn)(s),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[s,d,m]),f=(0,r.useCallback)(((e,t)=>{Ep({environment:d,newStore:t,previousStore:e})}),[d]),y=(0,r.useMemo)((()=>({schema:l,collectionViewBlockStore:o,showProperties:u,disabled:n,blockPropertyValueOverlayStore:a,collectionContextStore:s,onShiftEnter:S})),[a,s,n,S,l,u,o]),v=(0,r.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:i,indentLevel:r}=e;if(o)return(0,je.jsx)(Dn,{store:t,collectionStore:o,subitemPath:i,indentLevel:r,collectionContextStore:s,disabled:n,groupsPointer:p,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{de.Z5({store:e,transient:!1}),Zp.Z.setState({store:e,editMode:"new",previousStore:void 0})}})}),[s,n,p]);return m?(0,je.jsx)(Ii,{collectionContextStore:s,groupsPointer:p,format:i,canDrag:g,resultProps:y,canDrop:!0,resultComponent:Gp,disabled:n,shouldShowHoverMenu:!0,direction:Fi.Vertical,analyticsName:"list",getItemSelectableStyle:Jp,emptyDroppableSize:0,onSelectableInsertRow:f,nestedCreateSubitemButton:v}):null}));function tu(e){window.__c={n:"ListShimmer"};const{isFullScreen:t,hasGroups:o,hasPartialResults:i,hasSearchQuery:r,overrideNumShimmerRows:n}=e,s=(0,Ir.DK)(),l=(0,c.VK)((()=>null==s?void 0:s.isCompactView.state),[s]);if(!(0,si.Z)(!0,0,100))return null;let a=1;void 0!==n?a=n:o||i||r||(a=t?10:3);const d=a>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],p=w.DZ(a).map((e=>(0,je.jsx)(Br,{widthPercentage:e<d.length?d[e]:void 0},e)));return(0,je.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:l?8:3},children:p})}const ou=r.memo((function(e){window.__c={n:"CollectionListView"};const t=(0,ne.O7)(),o=(0,ee.Fg)(),{store:i,schema:n,format:s,paddingBottom:l,paddingLeft:a,paddingRight:d,isFullScreen:u,isRootChild:h,isInPeekRenderer:m,minWidth:g,disabled:S,collectionContextStore:f}=e,y=(0,c.VK)((()=>re.az(f,u)),[f,u]),v=s.collection_group_by,C=(0,c.VK)((()=>null==f?void 0:f.isCompactView.state),[f]),x=(0,c.VK)((()=>"collectionVirtualView"===(null==f?void 0:f.contextType)),[f]),b=(0,c.VK)((()=>(0,be.hJ)()),[]),w=(0,r.useCallback)(((e,o,i)=>{!function(e,t,o,i,r){if(i.device.isMobile)oe._({environment:i,store:e,pageVisitSource:p.tY.Create});else if(t)Ep({environment:i,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],s=r.groupsStore.getGroupState(n);ie.CH({environment:i,store:e,peekMode:re.kr(r.collectionViewStore()),resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:r,pageVisitSource:p.tY.Create})}}(e,o,i,t,f)}),[t,f]),k=(0,r.useCallback)((t=>b?(0,je.jsx)(zr,{type:"list_groups",store:i,collectionContextStore:f,disabled:S,isFullScreen:u,isRootChild:h,paddingLeft:a,stickyLeft:!1,renderGroup:t=>(0,je.jsx)(au,{...e,groupFormat:t}),getGroupStyle:e=>nu(e,o),renderHeader:e=>(0,je.jsx)(su,{args:e}),onGroupHeaderAddItem:w}):(0,je.jsx)(Mn,{store:i,id:"list_groups",groupBy:t,groupsFormatKey:te.Uh,groupAggregationKey:te.dQ,format:s,schema:n,collectionContextStore:f,disabled:S,isFullScreen:u,renderGroup:t=>(0,je.jsx)(au,{...e,groupFormat:t}),renderHeader:e=>(0,je.jsx)(su,{args:e}),getGroupStyle:e=>nu(e,o),onGroupHeaderAddItem:w,paddingLeft:a,isRootChild:h,isInPeekRenderer:m})),[f,S,s,u,b,m,h,w,a,e,n,i,o]);return(0,ci.Z)((o=>(0,je.jsxs)("div",{style:{paddingBottom:l,paddingLeft:a,paddingRight:d,minWidth:g},className:eo.nM$,children:[(0,je.jsx)(_t.Z,{store:i,shouldShowHalo:!u&&!C,canSelect:!u,analyticsName:"list",style:iu(s,C,x),...o,children:v?k(v):(0,je.jsx)(au,{...e,groupFormat:v})}),!y&&(0,je.jsx)($r.Z,{onChange:e=>function(e,t,o,i){const r=o.isLoading.state,n=o.groupsStore.getGroupState([]);if(!n)return;if("collectionVirtualView"===o.contextType)return;const s=n.reducerResultStore.state;e<oo.Z.incrementScrollOffset&&s&&!r&&s.hasMore&&A.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,t,f,u)})]})))}));function iu(e,t,o){return{display:"flex",flexDirection:"column",paddingTop:e.collection_group_by||t||o?void 0:8,paddingBottom:4}}function ru(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}function nu(e,t){return 0===e.index?{}:{borderTop:`1px solid ${t.tableDividerColor}`}}function su(e){let{args:t}=e;window.__c={n:"GroupHeaderComponent"};const{collectionContextStore:o}=t,i=(0,ee.Fg)(),r=(0,c.VK)((()=>o.isCompactView.state),[o]);return(0,je.jsx)(Dt,{...t,height:r?to.yZ:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,i)})}function lu(e,t,o,i,r){if(!ge.M_(t))return;if(!o.collectionStore())return;const n=o.currentSubitemFormatStoreForUiDisplay.state;$.createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:t,perform:s=>{o.collectionStore()&&function(e){var t;const{transaction:o,environment:i,results:r,collectionContextStore:n,isFullScreen:s,groupsPointer:l,insertAtIndex:a,from:c,useCrdt:d}=e;n.searchQuery.state&&de.Ug({searchQuery:"",collectionContextStore:n,isFullScreen:s});const u=null===(t=n.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!u)return;let h;a>0&&(h=r[a]);const m=A.IW({environment:i,collectionContextStore:n,groupsPointer:l,insertAtIndex:a,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:c,useCrdt:d});if(!m)return;const g=m.coercionSucceeded,S=m.newStore;i.device.isMobile?oe._({environment:i,store:S,pageVisitSource:p.tY.Create}):g?Ep({environment:i,newStore:S,previousStore:h}):ie.CH({environment:i,store:S,peekMode:(0,re.kr)(n.collectionViewStore()),resultsStore:u,collectionContextStore:n,pageVisitSource:p.tY.Create}),ce.W(i,{from:c,type:"page",new_page_id:S.id,creating_block_id:S.id,...(0,pe.Pn)(n)})}({transaction:s,environment:t,results:e.resultsStore.state,collectionContextStore:o,isFullScreen:i,groupsPointer:e.groupsPointer,insertAtIndex:e.resultsStore.state.length,from:n?"list_view_add_parent_item_bottom":"list_view_add_item_bottom",useCrdt:r})}})}const au=r.memo((function(e){let{store:t,format:o,schema:i,disabled:n,groupFormat:s,isFullScreen:l,collectionContextStore:a,blockPropertyValueOverlayStore:d}=e;window.__c={n:"RenderGroup"};const p=(0,ee.Fg)(),u=void 0!==s,h=(0,r.useMemo)((()=>s?[s]:[]),[s]),m=(0,c.VK)((()=>a.groupsStore.getGroupState(h)),[a,h]),g=(0,c.VK)((()=>null==m?void 0:m.reducerResultStore.state),[m]),S=(0,c.VK)((()=>a.groupsStore.anyGroupHasResults()),[a]),f=(0,c.VK)((()=>{const e=a.permissionScopes.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[a]),y=(0,c.VK)((()=>S&&!n&&t.canEdit()&&f.canEditContent&&!f.isSyncedCollection),[n,S,f.canEditContent,f.isSyncedCollection,t]),v=(0,c.VK)((()=>""!==a.searchQuery.state),[a]),C=(0,c.VK)((()=>a.isCompactView.state),[a]),x=(0,c.VK)((()=>void 0!==g&&(null==g?void 0:g.blockIds.length)>0),[g]),b=(0,c.VK)((()=>Kt({collectionContextStore:a,groupsPointer:h,hasPartialResults:x})),[a,h,x]),w=(0,c.VK)((()=>re.VM({collectionContextStore:a,reducerResult:g,isFullScreen:l})),[a,g,l]);return m?(0,je.jsxs)("div",{style:{paddingBottom:s?C?8:16:void 0},children:[(0,je.jsx)(eu,{groupFormat:s,store:t,format:o,disabled:n,collectionContextStore:a,schema:i,blockPropertyValueOverlayStore:d}),b&&(0,je.jsx)(tu,{isFullScreen:l,hasGroups:u,hasPartialResults:x,hasSearchQuery:v,overrideNumShimmerRows:C&&!x?6:void 0}),w&&(0,je.jsx)(zi,{groupsPointer:h,store:t,collectionContextStore:a,format:o,isFullScreen:l,incrementLimitsInRelatedGroups:!1}),y&&(0,je.jsxs)(je.Fragment,{children:[w&&(0,je.jsx)("div",{style:{width:"100%",borderTop:s?void 0:`1px solid ${p.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,je.jsx)(cu,{collectionContextStore:a,isFullScreen:l,groupState:m})]})]}):null}));function cu(e){let{groupState:t,collectionContextStore:o,isFullScreen:i}=e;window.__c={n:"AddItemButtonComponent"};const r=(0,ee.Fg)(),n=(0,ne.O7)();return(0,je.jsxs)(xo.Z,{onClick:e=>lu(t,n,o,i,(0,io.SL)(e,"collection_non_table_view")),onMouseDown:ue.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,fontSize:14},children:[(0,ae.R)(ru(r)),(0,je.jsx)("div",{style:{color:r.lightTextColor},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.listView.addItemButtonTitle"})})]})}var du=o(2005),pu=o(59827);class uu extends d.default{getInitialState(){return{query:"",limit:20}}}const hu=uu;var mu=o(81870),gu=o(11470);const Su=(0,j.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}}),fu=d.default.createClass(void 0);function yu(e){let{collectionStore:t,collectionViewType:o,collectionViewName:i,property:n,noDateTotal:s,collectionContextStore:l,onClose:a,onAddPage:d}=e;window.__c={n:"CollectionNoDateMenu"};const p=(0,ne.O7)(),u=(0,c.qz)(void 0,hu),h=(0,c.qz)(void 0,fu),m=(0,c.VK)((()=>u.state.query),[u]),g=(0,c.VK)((()=>h.state),[h]),S=(0,c.VK)((()=>{const{query:e,limit:t}=u.state;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[n,u]),f=(0,r.useCallback)((e=>{u.setState({query:e.target.value,limit:xu})}),[u]),y=(0,r.useCallback)((e=>{const t=u.state.limit,o=l.isLoading.state;e<Cu&&g&&g.hasMore&&!o&&u.setState({...u.state,limit:t+xu})}),[l,g,u]),v=(0,r.useCallback)((()=>{const e="calendar"===o?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Click to add to the calendar",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"});return g?g&&0===g.blockIds.length?(0,je.jsx)(Re.Z,{title:e,children:(0,je.jsx)(gd.Z,{title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,je.jsx)(Te.Z,{type:Te.i.Vertical,sections:[{key:"results",render:t=>(0,je.jsx)(Re.Z,{...t,title:e}),items:ku(g.blockIds,t,n,d,p)}],initialFocus:m?0:void 0}):(0,je.jsx)(Re.Z,{title:e,loading:!0,children:(0,je.jsx)(gd.Z,{title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Loading…",id:"collectionNoDateMenu.loading.message"})})})}),[t,o,g,p,d,n,m]);return(0,je.jsxs)(du.Tp,{title:(0,je.jsx)(bu,{noDateTotal:s,collectionViewType:o,collectionViewName:i}),onCancel:a,helpButton:(0,je.jsx)(mu.Z,{helpButtonContext:"collection_no_date_menu",href:(0,ss.UY)("guides.databaseCalendar")}),desktopWidth:450,children:[(0,je.jsx)(Re.Z,{isInput:!0,children:(0,je.jsx)(uc.ZP,{placeholder:Ne.default.formatMessage(Su.searchPlaceholder),focus:!p.device.isMobile||void 0,focusAfterAnimation:!0,value:m,onChange:f})}),(0,je.jsx)(He.Z,{id:"no_date_results",reducer:S,collectionContextStore:l,render:v,resultStore:h}),(0,je.jsx)($r.Z,{onChange:y})]})}const vu=r.memo(yu,Qt.Z),Cu=200,xu=20;function bu(e){let{noDateTotal:t,collectionViewType:o,collectionViewName:i}=e;window.__c={n:"Title"};return(0,ne.O7)().device.isMobile?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Pages with no date",id:"collectionNoDateMenu.mobileMenuTitle"}):(0,je.jsx)(pu.Q,{prefix:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"{noDateTotal, plural, one {{noDateTotal} page with no date in} other {{noDateTotal} pages with no date in}}",id:"collectionNoDateMenu.pagesWithNoDateInPrefix",values:{noDateTotal:t}}),viewType:o,viewName:(0,je.jsx)(xc.Z,{collectionViewName:i,collectionViewType:o})})}function wu(e){let{props:t,store:o,url:i}=e;window.__c={n:"MenuListItemComponent"};const r=(0,ne.O7)(),{device:n}=r;return(0,je.jsx)(gu.Z,{...t,store:o,hidePath:!0,right:(0,je.jsx)(wo.Z,{href:i,innerStyle:{display:"flex",alignItems:"center",borderRadius:4,paddingLeft:n.isMobile?8:6,paddingRight:n.isMobile?8:6,height:n.isMobile?44:22},onClick:()=>{F.tM(r)},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"View",id:"collectionNoDateMenu.view.button.label"})},o.id),dontShrinkRight:!0})}function ku(e,t,o,i,r){const n=e.map((e=>me.G.createChildStore(t,{table:P.iU,id:e}))).filter((e=>!Ht.Gl(e.getPropertyStore(o).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:t}=Do.default.state;if(!t)return;const o=(0,_o.ZP)({store:t,peekViewBlockId:e.id,pageVisitSource:p.tY.LinkInPage});return{key:e.id,render:t=>(0,je.jsx)(wu,{props:t,store:e,url:o}),action:()=>{i(e),F.ze(r)}}}));return w.oA(n)}var Pu=o(65669),Tu=o(63087),Vu=o(29477),Ru=o(36054);class Mu{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.isServerQueryCollectionRequired=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabled.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const i=Boolean(e&&(0,Ru.P9)(Tu.y,e)&&e.hasMore);if(o&&!i)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;return!!(0,dt.qP)(r.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,Ru.P9)(Tu.y,e)&&!e.hasMore)},this.throttledRefetch=(0,Pu.Z)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;this.reset(),o?this.throttledRefetch({src:e}):_.bW(this.environment),t&&await de.fI({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=td.default.getEligibleGroup({experimentId:"collection_client_refetch_throttle_time_ms",defaultGroup:"control"}),o="control"===t?1e3:parseInt(t);await Promise.all([de.dj(this.environment,this.collectionContextStore,e),(0,Vu.Vs)(o)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:i,isCollectionTypeChange:r}=e;if((0,Ru.P9)(Tu.y,o)&&null!=o&&o.blockIdToVersion&&(0,dt.qP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequired(o,r),!i)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}}var ju=o(91007),Fu=o(70475),_u=o(62967),Iu=o(43664);class Bu extends d.default{getInitialState(){return{textStoresBeingEdited:[],lastBlockPropertyValueOverlayCloseTime:void 0}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===Xt.QaF(o)}))}}const Du=Bu;var Au=o(13966);function Lu(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const Zu=(0,j.defineMessages)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function Eu(e){window.__c={n:"CollectionsBulkActionsToolbar"};const t=(0,Ir.Y$)(),{marginLeft:o}=e,i=(0,ne.O7)(),n=(0,c.qz)(void 0,Du),s=(0,r.useRef)(null),[l,a]=(0,r.useState)(!1),d=(0,c.VK)((()=>n.state.lastBlockPropertyValueOverlayCloseTime),[n]),p=(0,c.VK)((()=>Oo.default.state.stores.filter((e=>Wa.R.findBlockFromStore(e)))),[d]),u=p.length,h=(0,c.VK)((()=>n.getNumberOfTextStoresBeingEdited()),[n]),m=(0,c.VK)((()=>{var e;return!!(0,re.fk)({environment:i,collectionContextStore:t})&&(h>0||p.length>=1&&(0,re.v_)(p,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id))}),[t,i,h,p]),g=(0,ee.yK)((e=>({inner:{position:"absolute",top:1,left:0+(o??0),display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.lightBoxShadow,height:32},outer:{position:"sticky",top:0,left:0,zIndex:M.mJ,visibility:l?"visible":"hidden"},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...Lu(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[l,o]);return(0,je.jsx)(On.Z,{isVisible:m,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},onAnimationEnd:e=>{e||a(!1)},render:()=>(0,je.jsx)(pd.Z,{capture:!0,render:e=>(0,je.jsx)("div",{ref:s,...e,style:g.outer,children:(0,je.jsx)(Zn.p,{allowSelectionWithin:!1,children:(0,je.jsxs)("div",{style:g.inner,children:[(0,je.jsx)(Ou,{selectedItemCount:u,collectionsBulkActionsToolbarStore:n}),(0,je.jsx)(Nu,{collectionsBulkActionsToolbarStore:n,selectedItems:p,marginLeft:o,setIsReadyToRender:a,outerContainerRef:s}),(0,je.jsx)(Je.ZP,{renderTooltip:()=>(0,je.jsx)("div",{children:Ne.default.formatMessage(Zu.delete)}),render:e=>(0,je.jsx)(Ft.Z,{...e,ariaLabel:Ne.default.formatMessage(Zu.delete),icon:()=>(0,Ce.y)(g.trashButtonIcon),style:g.trashButton,hoveredStyle:g.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{F.dh(i,{analyticsName:_u.RE.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page"}),await Ka.Qw({environment:i,blocks:p})}}),placement:Je.ug.Top}),(0,je.jsx)(Au.Z,{store:p[0],fadeIn:!1,style:g.blockActionMenuButton,hoveredStyle:g.blockActionMenuButton,iconStyle:g.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0}})]})})})})})}function Ou(e){window.__c={n:"SelectedItemCountWidget"};const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,i=(0,ne.O7)(),r=(0,c.VK)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),n=(0,c.VK)((()=>r>0?r:o),[r,o]),s=(0,ee.yK)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...Lu(e)}})),[]);return(0,je.jsx)(xo.Z,{style:s.button,onClick:()=>K.ZH(i),children:(0,je.jsx)(j.FormattedMessage,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:n}})})}const Gu=["title","rollup","formula","button"];function Nu(e){window.__c={n:"EditPropertyButtons"};const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:i,marginLeft:n,setIsReadyToRender:s}=e,l=(0,Ir.Y$)(),a=(0,c.VK)((()=>l.normalizedSchemaStore.state),[l]),d=(0,r.useRef)(null),p=(0,c.VK)((()=>l.databaseType===u.Fi&&i.some((e=>e.getPropertyValue(Fu.C.MeetingNoteToCalendarEventRelation)))),[l,i]),h=(0,c.VK)((()=>{var e;const t=l.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=l.collectionStore();if((0,Ht.LC)(null==t?void 0:t.getModel(),e.property))return!p;const o=a[e.property];return e.visible&&o&&!Gu.includes(o.type)&&(0,to.Sb)({propertySchema:o,property:e.property,blockStores:i,collectionSchema:a})})))??[]}),[l,a,i,p]).slice(0,6),m=(0,r.useRef)([]),[g,S]=(0,r.useState)(6),[f,y]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{m.current.length>0&&m.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[m]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:i,marginLeft:n,setIsReadyToRender:s,setShowIconsOnly:l,setHiddenButtonsIndex:a}=e;(0,r.useEffect)((()=>{const e=w.Ds((()=>{var e,r,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,p=((null===(r=t.current)||void 0===r?void 0:r.getBoundingClientRect().width)??window.innerWidth)-(n??0),u=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,h=d-150;let m=i.current.findIndex((e=>e.rightEdge>h));m=-1!==m?m:6;let g=i.current.findIndex(((e,t)=>u+32*t>h));g=-1!==g?g:6;const S=m<2||p<=450;l(S),a(S?g:m),s(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[n,t,i,o,a,s,l])}({propertyButtonsContainerRef:d,propertyButtonRefs:m,outerContainerRef:t,marginLeft:n,setIsReadyToRender:s,setHiddenButtonsIndex:S,setShowIconsOnly:y}),(0,je.jsx)("div",{ref:d,style:{display:"flex"},children:h.map(((e,t)=>{var i;let n=null===(i=m.current[t])||void 0===i?void 0:i.element;if(!n){const e=r.createRef();m.current[t]={element:e,rightEdge:0},n=e}const s=t>=g;return(0,je.jsx)("div",{ref:n,children:(0,je.jsx)(zu,{collectionsBulkActionsToolbarStore:o,schema:a,property:e.property,isHidden:s,showIconsOnly:f},e.property)},e.property)}))})}function zu(e){window.__c={n:"EditPropertyButton"};const{property:t,schema:o,collectionsBulkActionsToolbarStore:i,isHidden:n,showIconsOnly:s}=e,l=(0,Ir.Y$)(),a=o[t],d=(0,ne.O7)(),p=(0,c.VK)((()=>!(l.permissionScopes.state.canEditContent||"collectionTypedView"===l.contextType)),[l]),u=(0,ee.yK)((e=>({button:{display:n?"none":"flex",padding:8,...Lu(e)}})),[n]),h=(0,r.useRef)(null),m=(0,c.qz)(void 0,Mo.Z),g=(0,r.useCallback)((async e=>{var o,r;if(!h.current)return;const n=Oo.default.state.stores;e.stopPropagation(),e.preventDefault();const s=null===(o=h.current)||void 0===o?void 0:o.getBoundingClientRect(),a=n[0].getAssociatedCollectionStore();l&&s&&a&&await Iu.z({environment:d,store:n[0],additionalStores:n.slice(1),property:t,rect:s,format:fo.C.Table,collectionStore:a,blockPropertyValueOverlayStore:wi._H(),collectionContextStore:l,statusSetCheckbox:"checkbox"===(null===(r=l.getPropertyFormat(t))||void 0===r?void 0:r.statusShowAs),mouseStore:m,preventClearSelection:!0,collectionsBulkActionsToolbarStore:i})}),[h,l,d,t,m,i]),S=(0,ee.Fg)();return a?(0,je.jsx)(Je.ZP,{renderTooltip:()=>a.name,render:e=>(0,je.jsx)(xo.Z,{...e,ariaLabel:a.name,ref:h,style:u.button,disabled:p,onClick:g,children:(0,je.jsx)(fs.Z,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:a,hideName:s,showIcon:!0,property:t,iconStyle:{fill:S.regularTextColor}})}),disableTooltip:!s,placement:Je.ug.Top}):null}var Hu=o(10214),Ku=o(30806),Wu=o(5933),Uu=o(85740),$u=o(32662),qu=o(5233);function Qu(e){window.__c={n:"CollectionTasksEmptyState"};const t=(0,ne.O7)(),o=(0,ne.MO)(),i=(0,c.VK)((()=>e.collectionContextStore.collectionStoresStore.state.length>0),[e.collectionContextStore.collectionStoresStore]),n=(0,c.VK)((()=>(0,re.PI)(e.collectionContextStore)),[e]),s=(0,c.VK)((()=>e.collectionContextStore.isCompactView.state),[e.collectionContextStore]),l=(0,ee.yK)((e=>({container:{width:"100%",height:s?pt.WB-4:void 0,paddingTop:s?void 0:120,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:14,color:e.lightTextColor},desktopInner:{width:800,minWidth:800,padding:32},icon:(0,pt.jO)(e)})),[s]),a=(0,r.useCallback)((()=>i?(0,je.jsx)(Uu.Z,{isBlue:!0,onClick:o=>{(0,Ku.Aq)({environment:t,from:e.from}),e.onAddTaskClick(o)},icon:e=>(0,ae.R)(e),children:n}):o?null:(0,je.jsx)(Uu.Z,{isBlue:!0,onClick:()=>{(0,Ku.Aq)({environment:t,from:e.from}),Wu.Z.setState(!0)},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Don't see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[i,o,n,t,e]);return(0,je.jsxs)("div",{style:l.container,children:[(0,je.jsx)(qu.Z,{from:e.from}),(0,Hu.K)(l.icon),(0,je.jsx)($u.Z,{size:16}),(0,je.jsx)(j.FormattedMessage,{defaultMessage:"All tasks assigned to you will appear here.",id:"tasksEmptyState.noTasks.title"}),(0,je.jsx)($u.Z,{size:16}),a()]})}var Yu=o(91496),Xu=o(54281),Ju=o(64815),eh=o(96310),th=o(35431),oh=o(92595);class ih extends th.Z{findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}}const rh=new ih;(0,oh.exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",rh);var nh=o(20294),sh=o(53465),lh=o(43350);const ah={position:"absolute",left:0,top:0,zIndex:M.Gt,width:"100%",height:"100%",pointerEvents:"none"};function ch(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+12,o.top=o.top-15)),o):o}function dh(e){window.__c={n:"CollectionTimelineRelationArrow"};const{startItem:t,endItem:o,endRelationPointer:i,timelineState:n,disabled:s,isFullScreen:a,isRootChild:d,relationType:p,isUserDrawnTemp:u,isNewSubitemPlaceholder:h,renderEmitter:m}=e,g=(0,Ir.Y$)(),S=(0,ne.O7)(),f=(0,nh.k)(),[y,v]=(0,r.useState)(!1),C=(0,ee.Fg)(),[x,b]=(0,r.useState)(null),[w,k]=(0,r.useState)(null),P=(0,r.useCallback)((e=>{b(e.state)}),[]),T=(0,r.useCallback)((e=>{k(e.state)}),[]),V=(0,r.useCallback)((()=>{l.default.afterNextFlush((()=>{f()}))}),[f]);(0,r.useEffect)((()=>(b(t.stores.node.state),k(o?o.stores.node.state:null),t.stores.node.addListener(P),null==o||o.stores.node.addListener(T),null==m||m.addListener(V),g.filtersBarOpenStore.addListener(V),()=>{t.stores.node.removeListener(P),null==o||o.stores.node.removeListener(T),null==m||m.removeListener(V),g.filtersBarOpenStore.removeListener(V)})),[t,o,m,P,T,V,g.filtersBarOpenStore]);const R=(0,c.VK)((()=>Pi.ZP.state.isDragging&&Pi.ZP.state.draggedStores.includes(t.props.store)),[t]),j=(0,c.VK)((()=>o&&Pi.ZP.state.isDragging&&Pi.ZP.state.draggedStores.includes(o.props.store)),[o]),F=(0,c.VK)((()=>{const e=Pi.ZP.state;return e.isDragging?e.currentY-e.startY:0}),[]),_=x&&x.getBoundingClientRect().y+(R?F:0),I=(0,c.VK)((()=>{const e=t.itemPositionStore.state;return _&&e?{left:e.left,right:"subitem"===p?e.left+12:e.right,top:"subitem"===p?_+15:_}:void 0}),[p,t.itemPositionStore,_]),B=w&&w.getBoundingClientRect().y+(j?F:0),D=(0,c.VK)((()=>{const e=B&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:B}:void 0;return"subitem"===p?ch({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,B,p,t.itemPositionStore]),A=(0,c.VK)((()=>t.dateValueStore.state),[t]),L=(0,c.VK)((()=>null==o?void 0:o.dateValueStore.state),[o]),Z=(0,c.VK)((()=>void 0!==n.dragState.state),[n]),E=(0,c.VK)((()=>void 0!==n.drawState.state),[n]),O=(0,c.VK)((()=>n.hoveredItem.state),[n.hoveredItem]),G=y&&!Z&&!E,N=(0,r.useCallback)((()=>{i&&!s&&Xu.IL({dependency:{store:t.props.store,relationPointer:i},collectionContextStore:g,environment:S,timelineState:n,isFullScreen:a,isRootChild:d})}),[t,s,i,g,S,n,a,d]),z=(0,r.useCallback)((()=>{v(!0)}),[v]),H=(0,r.useCallback)((()=>{v(!1)}),[v]),K=(0,r.useCallback)((e=>{if(D)return(0,je.jsx)(ph,{topOffset:e,endPosition:D,handleCloseButtonClick:N})}),[D,N]),W=O===t.props.store,U=o&&O===o.props.store,$=W||U||G||"subitem"===p?1:.7;let q,Q=!0;"subitem"===p?(q=C.collectionUnsetDependencyArrow,Q=!1):A&&L&&(q=A<=L?C.collectionValidDependencyArrow:C.collectionInvalidDependencyArrow);const Y=(0,ee.yK)((()=>({svgStyle:{zIndex:"dependency"===p&&(G||U)?M.Gt:M.wx}})),[p,G,U]);return I?u?(0,je.jsx)(uh,{startPosition:I,timelineState:n}):h?(0,je.jsx)(hh,{startPosition:I,timelineState:n}):t!==o&&D?(0,je.jsx)(mh,{startPosition:I,endPosition:D,strokeOpacity:$,strokeColorOverride:q,svgStyle:Y.svgStyle,cornerRadiusOverride:"subitem"===p?8:void 0,relationType:p,handleMouseMove:z,handleMouseLeave:H,renderChildren:Q&&G?K:void 0}):null:null}function ph(e){window.__c={n:"RemoveDependencyButton"};const{topOffset:t,endPosition:o,handleCloseButtonClick:i}=e,r=(0,ee.yK)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,je.jsx)(je.Fragment,{children:(0,je.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:i,children:(0,sh.X)(r.icon)})})}function uh(e){window.__c={n:"UserDrawnTempDependencyArrow"};const{startPosition:t,timelineState:o}=e,i=(0,c.VK)((()=>{const e=o.drawState.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawState]);return i?(0,je.jsx)(mh,{startPosition:t,endPosition:i,strokeOpacity:1,relationType:"dependency"}):null}function hh(e){var t;window.__c={n:"NewSubitemPlaceholderArrow"};const{startPosition:o,timelineState:i}=e,r=(0,ee.Fg)(),n=(0,c.VK)((()=>i.dateRangePlaceholder.state),[i.dateRangePlaceholder]),s=(0,c.VK)((()=>null!=n&&n.active?n.date:void 0),[n]),l=null!=n&&n.active?null===(t=n.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,a=l?l[l.length-1].children.length:0,d=o.top+33*a+15+5,p=(0,c.VK)((()=>{const e=(0,br.HZ)({timelineState:i,dateValue:s,placeholderDate:s,subitemPlaceholderDate:void 0}),t=d&&e?{...e,top:d}:void 0;return ch({startItemPosition:o,value:t})}),[s,d,o,i]);return p?(0,je.jsx)(mh,{startPosition:o,endPosition:p,strokeOpacity:1,strokeColorOverride:r.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function mh(e){window.__c={n:"RelationArrowBase"};const{startPosition:t,endPosition:o,strokeColorOverride:i,cornerRadiusOverride:n,strokeOpacity:s,relationType:l,svgStyle:a,handleMouseMove:d,handleMouseLeave:p}=e,u=(0,Ir.Y$)(),h=(0,ee.Fg)(),[m,g]=(0,r.useState)(0),S=t.right,f=t.top+15-m,y=o.left-3,v=o.top+15-m,C=(0,c.VK)((()=>{if(i)return i;return(0,br.H5)(u)&&t.right&&o.left?t.right<o.left?h.collectionValidDependencyArrow:h.collectionInvalidDependencyArrow:h.collectionUnsetDependencyArrow}),[u,o.left,t.right,i,h]);return(0,je.jsx)("svg",{style:{...ah,...a},ref:e=>{e&&g(e.getBoundingClientRect().top)},children:(0,je.jsx)(lh.Z,{startPoint:{x:S,y:f},endPoint:{x:y,y:v},style:{stroke:C,strokeWidth:br.lf,strokeOpacity:s},useRightAngles:"subitem"===l,showArrowHead:"dependency"===l&&!e.renderChildren,cornerRadiusOverride:n,handleMouseMove:d,handleMouseLeave:p,children:e.renderChildren&&e.renderChildren(m)})})}function gh(e){window.__c={n:"CollectionTimelineDependenciesOverlay"};const{timelineState:t,disabled:o,isReady:i,isFullScreen:n,isRootChild:s,renderEmitter:l}=e,a=(0,Ir.Y$)(),d=(0,r.useCallback)((()=>{t.drawState.setState(void 0)}),[t.drawState]),p=(0,c.VK)((()=>a.collectionViewBlockStore()),[a]),u=(0,c.VK)((()=>a.settingsStore.state.open),[a]);if((0,r.useEffect)((()=>{var e;!u&&null!==(e=t.drawState.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&d()}),[u,t.drawState,d]),!i||!p)return null;const h=rh.findCollectionTimelineViewItems(p);return(0,je.jsx)(je.Fragment,{children:h.map((e=>{const{store:i,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,te.Hd)(c):"noGroup";return(0,je.jsxs)(r.Fragment,{children:[(0,je.jsx)(Sh,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"dependency"},`${i.id}-${d}-${i.key}-dependency`),(0,je.jsx)(Sh,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"subitem"},`${i.id}-${d}-${i.key}-subitem`)]},`${i.id}-${d}-${i.key}`)}))})}function Sh(e){window.__c={n:"CollectionTimelineRelationAnnotationItem"};const{startItem:t,timelineState:o,disabled:i,isFullScreen:n,isRootChild:s,relationType:l,renderEmitter:a}=e,{store:d,schema:p}=t.props,u=(0,Ir.Y$)(),h=(0,c.VK)((()=>"dependency"===l?o.drawState.state:void 0),[o.drawState,l]),m=(0,c.VK)((()=>(null==h?void 0:h.startStore)===d),[d,h]),g=(0,c.VK)((()=>m&&!(null!=h&&h.tryToCompleteDrawnArrow)),[h,m]),S=(0,c.VK)((()=>{if("dependency"===l)return m&&h?h.temporaryDependencyRelationPointers:(0,br.YE)(u,d,p);if("subitem"===l){return td.default.checkGate("collection_level_subitems_setting")?(0,br.ph)(u,d,p):(0,br.WD)(u,d,p)}return[]}),[l,m,h,u,d,p]),f=(0,c.VK)((()=>u.collectionViewBlockStore()),[u]),y=(0,c.VK)((()=>{var e;const i=o.dateRangePlaceholder.state;if("subitem"!==l||null==i||!i.active||!i.newTimelineItemProps)return;const r=i.newTimelineItemProps.subitemPath;return(r?null===(e=r[r.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?i:void 0}),[l,t.props.store,o.dateRangePlaceholder]);if(!f)return null;const v=rh.findCollectionTimelineViewItems(f);return(0,je.jsxs)(je.Fragment,{children:[S.map((e=>{if(d.id===e.id)return null;const c=v.filter((t=>t.props.store.id===e.id));return(0,je.jsx)(r.Fragment,{children:c.map((r=>{const c=r.props.store,d=r.props.groupFormat;return(0,je.jsx)(dh,{startItem:t,endItem:r,endRelationPointer:e,timelineState:o,disabled:i,isFullScreen:n,isRootChild:s,renderEmitter:a,relationType:l},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===l&&g&&(0,je.jsx)(dh,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"dependency"}),"subitem"===l&&y&&(0,je.jsx)(dh,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"subitem"})]})}var fh=o(7525);const yh=function(e){let{zoomLevel:t,onChange:o}=e;window.__c={n:"CollectionTimelineViewZoomLevelButtonPopup"};const i=(0,ee.Fg)(),r=(0,ne.O7)(),{device:n}=r;return(0,je.jsx)(Qe.ZP,{popupType:n.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,renderOrigin:e=>(0,je.jsxs)(Ye.Z,{isSmall:!0,isGray:!0,...e,children:[(0,je.jsx)(vh,{zoomLevel:t}),(0,fr.i)({width:10,marginLeft:4,fill:i.mediumIconColor})]}),originGap:8,render:e=>(0,je.jsx)(Ch,{parent:e,zoomLevel:t,onChange:o})})};function vh(e){let{zoomLevel:t}=e;return"hours"===t?(0,je.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,je.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,je.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,je.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,je.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,je.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,je.jsx)(j.FormattedMessage,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):void(0,dt.t1)(t)}function Ch(e){let{parent:t,zoomLevel:o,onChange:i}=e;window.__c={n:"ZoomLevelMenuComponent"};const r=(0,ne.O7)(),{device:n}=r,s=[{key:"calendar by section",render:e=>(0,je.jsx)(Re.Z,{...e}),items:no.H.map((e=>({key:e,render:t=>(0,je.jsx)(qe.Z,{...t,title:(0,je.jsx)(vh,{zoomLevel:e})}),action:()=>{i(e),t.close()}})))}];return(0,je.jsx)(Ya.Z,{capture:!0,allowEsc:!0,render:e=>{let i;return i=n.isMobile?{menuType:we.og.Modal,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,je.jsx)(Ve.DoneMenuText,{}),onClickRight:t.close,...e}:{menuType:we.og.Popup,width:180,...e},(0,je.jsx)(Pe.Z,{...i,children:(0,je.jsx)(Te.Z,{type:Te.i.Vertical,sections:s,initialFocus:no.H.indexOf(o)})})}})}class xh extends s.Z{constructor(){super(...arguments),this.currentScrolledSecondaryDisplayUnitStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,paddingLeft:o,showTable:r,isFullScreen:n}=this.props,s=e.zoomLevel.state,{primaryDisplayUnit:l,secondaryDisplayUnit:a}=br.BJ[s],c=e.scrollLeft.state,{startTimestamp:d}=e.currentRange.state;if(void 0!==c){const e=d+(0,br.x2)(s,c+t+(!r&&n?o:0));return(0,br.DS)(i.ou.fromMillis(e),l).startOf(a).valueOf()}}))}renderComponent(){var e;const{timelineState:t,showTable:o,isFullScreen:i,isRootChild:r,isReady:n,collectionContextStore:s,isInPeekRenderer:l}=this.props,{device:a}=this.environment,c=t.zoomLevel.state,{secondaryDisplayUnit:d}=br.BJ[c],p=this.currentScrolledSecondaryDisplayUnitStore.state,u=(0,br.d$)({environment:this.environment,isFullScreen:i,isRootChild:r}),h=s.permissionScopes.state,m=!o&&u&&h.canConfigureBlock,g=(null===(e=s.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(l?this.theme.cardContentBackground:this.theme.contentBackground),S=l?this.theme.cardContentBackgroundTransparent:this.theme.contentBackgroundTransparent;return(0,je.jsx)(jt,{position:ht.Top,children:(0,je.jsxs)("div",{style:kh(this.props.timelineState),children:[p&&(0,je.jsxs)("div",{style:Ph(this.props.scrollerLeftOffset,this.props.paddingLeft,this.props.isFullScreen,this.props.showTable,g,this.environment),children:[m&&(0,je.jsx)(Je.ZP,{render:e=>(0,je.jsx)(Ye.Z,{isSmall:!0,onClick:()=>function(e,t,o,i,r,n){const s=i.collectionViewStore();if(!s)return;$.createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,perform:e=>{const o=(0,br.YP)(t,!0);uo.FH({stores:[s],update:o,transaction:e})}}),F.CB(e,{...(0,br.Ii)({environment:e,collectionContextStore:i,timelineState:o,isFullScreen:r,isRootChild:n}),show:!0})}(this.environment,this.props.format,this.props.timelineState,this.props.collectionContextStore,this.props.isFullScreen,this.props.isRootChild),style:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:a.isIOS?0:1,height:22,fill:this.theme.lightIconColor},...e,children:(0,fh.t)({width:14})}),renderTooltip:()=>(0,je.jsx)(j.FormattedMessage,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,je.jsx)("span",{style:{paddingLeft:m||this.environment.device.isPhone?0:i||o?16:2},children:(0,br.qG)(p,d)}),!n&&!o&&(0,je.jsx)(wh,{}),(0,je.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${g} 20%, ${S} 100%)`}})]}),(0,je.jsxs)("div",{style:Th(this.props.paddingRight,g),children:[(0,je.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${g} 20%, ${S} 100%)`}}),(0,je.jsx)(rp,{collectionContextStore:s}),(0,je.jsx)(yh,{zoomLevel:c,onChange:e=>function(e,t,o,i,r,n){Xu.Nf({timelineState:o,environment:t,zoomLevel:e,centerTimestamp:(0,br.al)(o)}),F.zI(t,(0,br.Ii)({environment:t,collectionContextStore:i,timelineState:o,isFullScreen:r,isRootChild:n}))}(e,this.environment,this.props.timelineState,this.props.collectionContextStore,this.props.isFullScreen,this.props.isRootChild)}),(0,je.jsx)(Ye.Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,i,r,n,s){const l=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,br.xI)({environment:e,paddingLeft:o,format:i,isFullScreen:r,isRootChild:n}),d=(a-c)/2,p=(0,br.al)(t)-(0,br.x2)(l,d);Xu.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:p}),F.Al(e,{...(0,br.Ii)({environment:e,collectionContextStore:s,timelineState:t,isFullScreen:r,isRootChild:n}),type:"left"})}(this.environment,this.props.timelineState,this.props.paddingLeft,this.props.format,this.props.isFullScreen,this.props.isRootChild,this.props.collectionContextStore),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,Kd.f)({width:12,fill:this.theme.mediumIconColor})}),(0,je.jsx)(Ye.Z,{isSmall:!0,onClick:()=>function(e,t,o,i,r,n,s){const l=t.zoomLevel.state,a=(0,br.bK)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:i});Xu.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:a}),F.H6(e,(0,br.Ii)({environment:e,collectionContextStore:r,timelineState:t,isFullScreen:n,isRootChild:s}))}(this.environment,this.props.timelineState,this.props.paddingLeft,this.props.format,this.props.collectionContextStore,this.props.isFullScreen,this.props.isRootChild),children:(0,je.jsx)(j.FormattedMessage,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,je.jsx)(Ye.Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,i,r,n,s){const l=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,br.xI)({environment:e,paddingLeft:o,format:i,isFullScreen:r,isRootChild:n}),d=(a-c)/2,p=(0,br.al)(t)+(0,br.x2)(l,d);Xu.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:p}),F.Al(e,{...(0,br.Ii)({environment:e,collectionContextStore:s,timelineState:t,isFullScreen:r,isRootChild:n}),type:"right"})}(this.environment,this.props.timelineState,this.props.paddingLeft,this.props.format,this.props.isFullScreen,this.props.isRootChild,this.props.collectionContextStore),style:{paddingLeft:4,paddingRight:4},children:(0,Wd.o)({width:12,fill:this.theme.mediumIconColor})})]})]})})}}xh.displayName="CollectionTimelineViewControlBar";const bh=xh;function wh(){return(0,je.jsx)(Uc.Z,{show:!0,showDelay:400,showHold:0,render:e=>e?(0,je.jsx)(Ke.Z,{style:{marginLeft:8,marginTop:1}}):void 0})}function kh(e){const{outerSizeObserver:t}=e;return{position:"sticky",left:0,width:t.rect.state.width,zIndex:M.Qm,height:0}}function Ph(e,t,o,i,r,n){return{position:"absolute",top:1,left:0,paddingLeft:o&&!i?e+t:e,display:"flex",alignItems:"center",height:32,paddingTop:6+(n.device.isMobile?2:0),background:r,fontSize:14,fontWeight:R.Z.fontWeight.medium}}function Th(e,t){return{position:"absolute",top:1,right:0,paddingRight:e,display:"flex",alignItems:"center",height:32,paddingTop:7,background:t}}var Vh=o(97439);const Rh=function(e){let{isGrouped:t,format:o,collectionContextStore:i,isFullScreen:r,isRootChild:n,timelineState:s}=e;window.__c={n:"CollectionTimelineViewHideTableButton"};const l=(0,ee.Fg)(),a=(0,ne.O7)(),{device:c}=a;return(0,je.jsx)(Je.ZP,{render:e=>(0,je.jsx)(Ye.Z,{isSmall:!0,onClick:()=>function(e,t,o,i,r,n){const s=o.collectionViewStore();if(!s)return;$.createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,perform:e=>{const o=(0,br.YP)(t,!1);uo.FH({stores:[s],update:o,transaction:e})}}),F.CB(e,{...(0,br.Ii)({environment:e,collectionContextStore:o,timelineState:n,isFullScreen:i,isRootChild:r}),show:!1})}(a,o,i,r,n,s),style:{position:"absolute",top:t?c.isIOS?3:4:c.isIOS?7:8,right:t?6:8,zIndex:M.MC,fill:l.lightIconColor},...e,children:(0,Vh.D)({width:14})}),renderTooltip:()=>(0,je.jsx)(j.FormattedMessage,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};var Mh=o(24211);function jh(e){window.__c={n:"TimelineShimmerWrapper"};const{shouldShowShimmer:t,children:o}=e,i=(0,si.Z)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,je.jsx)("div",{className:i,style:{height:"100%"},children:o})}const Fh=22,_h=32;class Ih extends s.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()},this.activeRangeStore=this.createComputedStore((()=>{const{collectionContextStore:e,timelineState:t,query:o,schema:i,intl:r}=this.props,n=e.collectionStore();if(!n)return;const s=t.dragState.state,l=t.zoomLevel.state,a=t.hoveredItem.state,c=t.dateRangePlaceholder.state,{activeRangeType:d}=br.BJ[l];if(!d)return;let p;if(s)p=s.temporaryValues.map((e=>(0,br.XO)(e,"day")));else if(c.active)p=[(0,br.XO)(c.date,"day")];else{const{stores:t}=Oo.default.state,s=t.filter((e=>e.getAssociatedCollectionId()===n.id)),l=w.jj(w.oA([...s,a]));p=w.oA(l.map((t=>{const n=(0,br.bk)({store:t,query:o,schema:i,userId:e.getCurrentUserId(),intl:r});if(n)return(0,br.XO)(n,"day")})))}const u=w.F(p,(e=>{let{start:t}=e;return t.valueOf()})),h=w.UT(p,(e=>{let{end:t}=e;return t.valueOf()}));return u&&h?{start:u.start.valueOf(),end:h.end.valueOf()}:void 0}),!0)}UNSAFE_willMount(e){super.UNSAFE_willMount(e)}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){const{collectionContextStore:e,timelineState:t}=this.props,o=t.zoomLevel.state,r=br.BJ[o],{primaryDisplayUnit:n,activeRangeType:s}=r,l=(0,br.ST)(n),a=i.ou.now(),c=l?a.startOf("minute"):a.startOf("day"),d=a.startOf("minute"),{device:p}=this.environment,u=!e.groupsStore.anyGroupHasNonEmptyResults()&&Kt({collectionContextStore:e,groupsPointer:[],hasPartialResults:!1});return(0,je.jsx)(jt,{position:ht.Top,children:(0,je.jsxs)("div",{style:Lh(this.props.collectionContextStore,this.props.isInPeekRenderer,this.theme),children:[(0,je.jsx)("div",{style:{height:32,position:"relative",overflow:"hidden"},children:!p.isPhone&&(0,je.jsx)(Wh,{timelineState:this.props.timelineState})}),(0,je.jsxs)("div",{style:{height:_h,position:"relative",overflow:"hidden"},children:[(0,je.jsx)(jh,{shouldShowShimmer:u,children:(0,je.jsx)(Kh,{timelineState:this.props.timelineState,nowTimeStartOfPrimaryDisplayUnit:c})}),"highlight_days"===s&&this.renderActiveRange(),(0,je.jsx)(Uh,{timelineState:this.props.timelineState,time:c}),"display_range"===s&&this.renderActiveRange()]}),(0,je.jsx)(Gh,{timelineState:this.props.timelineState,time:d})]})})}renderActiveRange(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state,n=br.BJ[t],{activeRangeType:s}=n,l=this.activeRangeStore.state;if(l){const e=(0,br.DS)(i.ou.fromMillis(l.start),"day"),n=(0,br.e$)(t,e.valueOf()-o);if("highlight_days"===s){const s=[];let a=i.ou.fromMillis(Math.max(e.valueOf(),(0,br.DS)(i.ou.fromMillis(o),"day").valueOf()));for(;a.valueOf()<l.end&&a.valueOf()<r;){s.push(a);a=(0,br.Ip)(a,"day")}const c=(0,br.e$)(t,a.valueOf()-o)-n+8,d=s.map(((e,t)=>(0,je.jsx)(Oh,{timelineState:this.props.timelineState,time:e,accent:0===t||t===s.length-1},`${e.toString()}-${t}`)));return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:{position:"absolute",top:0,left:n-4,width:c,marginTop:3,height:Fh,background:this.theme.timelineDarkerBackground,borderRadius:11}}),d]})}{const r=(0,br.DS)(i.ou.fromMillis(l.end),"day"),s=(0,br.cK)(i.ou.fromMillis(l.end),"day"),a=(0,br.e$)(t,r.valueOf()-o)-n+8;return(0,je.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:n-4,minWidth:a,marginTop:3,height:Fh,background:this.theme.timelineDarkerBackground,borderRadius:11,paddingLeft:6,paddingRight:6},children:(0,je.jsx)(zh,{start:e,end:e.valueOf()!==s.valueOf()?s:void 0,rangeWidth:a})})}}}}Ih.displayName="CollectionTimelineViewTimeBar";const Bh=(0,j.injectIntl)(Ih);function Dh(e,t,o){const i=o.zoomLevel.state,{startTimestamp:r}=o.currentRange.state,{primaryDisplayUnit:n,primaryDisplayUnitAlignment:s}=br.BJ[i],l=(0,br.DS)(e,n),a=(0,br.Ip)(e,n),c=(0,br.e$)(i,l.valueOf()-r),d=(0,br.e$)(i,e.valueOf()-r),p=(0,br.e$)(i,a.valueOf()-r)-c,u=t?4:0;return{left:("range_start"===s?d-p/2:d)-u,width:p+2*u}}function Ah(e,t,o,i,r){const n=e.setLocale(Gd.SP),s=(0,br.xJ)(),l=i?r.regularTextColor:r.lightTextColor,a=i?r.regularTextColor:r.mediumTextColor,c=i?r.mediumTextColor:r.lightTextColor,d=n.toFormat("t").startsWith(n.toFormat("a"));if("fifteen_minutes"===o){if(s)return(0,je.jsx)("span",{style:{color:l},children:n.toFormat("H:mm")});{const e=(0,je.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:n.toFormat("h:mm")}),t=(0,je.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:n.toFormat("a")});return d?(0,je.jsxs)(je.Fragment,{children:[t,e]}):(0,je.jsxs)(je.Fragment,{children:[e,t]})}}if("hour"===o){if(s)return(0,je.jsx)("span",{style:{color:l},children:n.toFormat("H:mm")});{const e=(0,je.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:n.toFormat("h")}),t=(0,je.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:n.toFormat("a")});return d?(0,je.jsxs)(je.Fragment,{children:[t,e]}):(0,je.jsxs)(je.Fragment,{children:[e,t]})}}if("day"===o||"week"===o)return"week"===t||"bi_week"===t?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("span",{style:{color:c,paddingRight:3},children:n.toFormat("ccccc")}),(0,je.jsx)("span",{style:{color:a,padding:"2px 7px"},children:n.toFormat("d")})]}):(0,je.jsx)("span",{style:{color:l},children:n.toFormat("d")});(0,dt.t1)(o)}function Lh(e,t,o){var i;return{position:"absolute",left:0,top:0,width:"100%",background:(null===(i=e.inheritedBlockColorStore.state)||void 0===i?void 0:i.background)||(t?o.cardContentBackground:o.contentBackground),borderTop:e.viewIsFlushToTopbar()?`1px solid ${o.tableDividerColor}`:"1px solid transparent",borderBottom:`1px solid ${o.tableDividerColor}`}}function Zh(e){return{color:e.regularTextColor,fontSize:12}}function Eh(e){return{background:e.timelineRed,width:22,height:22,borderRadius:11,position:"absolute",left:"calc(50% - 11px)",top:"calc(50% - 11px)"}}function Oh(e){let{time:t,accent:o,timelineState:i}=e;window.__c={n:"PrimaryIndicatorComponent"};const r=(0,ee.Fg)(),n=(0,c.VK)((()=>i.zoomLevel.state),[i]),{primaryDisplayUnit:s}=br.BJ[n],{left:l,width:a}=(0,c.VK)((()=>Dh(t,!1,i)),[t,i]);return(0,je.jsx)("div",{style:{position:"absolute",top:0,left:l,width:a,height:28,display:"flex",alignItems:"start",lineHeight:"28px"},children:(0,je.jsx)("div",{style:{fontSize:12,margin:"0 auto"},children:Ah(t,n,s,o,r)})})}function Gh(e){let{time:t,timelineState:o}=e;window.__c={n:"NowCircleComponent"};const i=(0,ee.Fg)(),r=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n}=(0,c.VK)((()=>o.currentRange.state),[o]),s=Math.floor((0,br.e$)(r,t.valueOf()-n));return(0,je.jsx)("div",{style:{position:"absolute",left:s-3.5+.5,top:Math.floor(61),width:7,height:7,background:i.timelineRed,borderRadius:"100%"}})}function Nh(e){let{time:t,timelineState:o,intl:i}=e;window.__c={n:"SecondaryIndicatorComponent"};const r=(0,ee.Fg)(),n=(0,ne.O7)(),s=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:l}=(0,c.VK)((()=>o.currentRange.state),[o]),{secondaryDisplayUnit:a}=br.BJ[s],d=(0,br.e$)(s,t.valueOf()-l);return(0,je.jsx)("div",{style:{position:"absolute",top:0,left:d,height:_h,color:r.regularTextColor,fontSize:14,fontWeight:R.Z.fontWeight.medium,verticalAlign:"middle",paddingTop:6+(n.device.isMobile?2:0),display:"flex",alignItems:"center"},children:(0,br.EW)((0,Mh.E2)(i),t.valueOf(),a)},d)}function zh(e){let{start:t,end:o,rangeWidth:i}=e;window.__c={n:"ActiveDisplayRangeIndicatorComponent"};const r=(0,ee.Fg)();return t&&o?i>=110?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:Zh(r),children:(0,zd.Yx)(t.valueOf(),"month_day",Gd.SP)}),(0,je.jsx)("div",{style:{flexGrow:1}}),(0,je.jsx)("div",{style:Zh(r),children:(0,zd.Yx)(o.valueOf(),"month_day",Gd.SP)})]}):(0,je.jsxs)("div",{style:Zh(r),children:[(0,zd.Yx)(t.valueOf(),"month_day",Gd.SP)," – ",t.month===o.month?(0,zd.Yx)(o.valueOf(),"day",Gd.SP):(0,zd.Yx)(o.valueOf(),"month_day",Gd.SP)]}):(0,je.jsx)("div",{style:Zh(r),children:(0,zd.Yx)(t.valueOf(),"month_day",Gd.SP)})}function Hh(e,t,o,i){const r=e.setLocale(Gd.SP),n=(0,br.ST)(o),s=(0,br.xJ)();return n?s?(0,je.jsx)("span",{style:{color:i.timelineRed},children:r.toFormat("H:mm")}):(0,je.jsx)("span",{style:{color:i.timelineRed,paddingRight:3},children:r.toFormat("t")}):"week"===t||"bi_week"===t?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("span",{style:{color:i.lightTextColor,paddingRight:3},children:r.toFormat("ccccc")}),(0,je.jsxs)("div",{style:{position:"relative"},children:[(0,je.jsx)("div",{style:Eh(i)}),(0,je.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})]}):(0,je.jsxs)("div",{style:{position:"relative"},children:[(0,je.jsx)("div",{style:Eh(i)}),(0,je.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})}function Kh(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;window.__c={n:"PrimaryIndicatorsComponent"};const r=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n,endTimestamp:s}=(0,c.VK)((()=>o.currentRange.state),[o]),l=br.BJ[r],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:d}=l,p=d||0,u=(0,c.VK)((()=>Dh(t,!1,o)),[t,o]),h=u.left+p,m=u.left+u.width-p,g=[];let S=(0,br.DS)(i.ou.fromMillis(n),a);const f=(0,c.VK)((()=>Dh(S,!1,o)),[S,o]);for(;S.valueOf()<s;){const e=f.left+p,t=f.left+f.width-p;void 0!==d&&(h>=e&&h<=t||m>=e&&m<=t)||g.push((0,je.jsx)(Oh,{timelineState:o,time:S,accent:!1},S.valueOf()));const i=(0,br.Ip)(S,a);S=i}return(0,je.jsx)(je.Fragment,{children:g})}function Wh(e){let{timelineState:t}=e;window.__c={n:"SecondaryIndicatorsComponent"};const o=(0,j.useIntl)(),r=(0,c.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:n,endTimestamp:s}=(0,c.VK)((()=>t.currentRange.state),[t]),l=br.BJ[r],{primaryDisplayUnit:a,secondaryDisplayUnit:d}=l,p=[];let u=(0,br.DS)(i.ou.fromMillis(n),d);for(;u.valueOf()<s;){p.push((0,je.jsx)(Nh,{timelineState:t,intl:o,time:u},u.valueOf()));const e=(0,br.Ip)(u,d);u=(0,br.xP)(e,a)}return(0,je.jsx)(je.Fragment,{children:p})}function Uh(e){let{time:t,timelineState:o}=e;window.__c={n:"NowIndicatorComponent"};const i=(0,ee.Fg)(),r=(0,c.VK)((()=>o.zoomLevel.state),[o]),{primaryDisplayUnit:n}=br.BJ[r],{left:s,width:l}=(0,c.VK)((()=>Dh(t,!0,o)),[t,o]);return(0,je.jsx)("div",{style:{position:"absolute",top:0,left:s,width:l,height:28,display:"flex",alignItems:"center",fontWeight:500},children:(0,je.jsx)("div",{style:{fontSize:12,margin:"0 auto",display:"flex"},children:Hh(t,r,n,i)})},s)}class $h extends s.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()}}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){return(0,je.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,je.jsx)(Jh,{timelineState:this.props.timelineState}),(0,je.jsx)(em,{timelineState:this.props.timelineState}),(0,je.jsx)(Xh,{timelineState:this.props.timelineState})]})}}$h.displayName="TimelineBackground";const qh=$h;function Qh(e){let{start:t,timelineState:o}=e;window.__c={n:"WeekendIndicatorComponent"};const i=(0,ee.Fg)(),r=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n}=(0,c.VK)((()=>o.currentRange.state),[o]),s=t.plus({day:2}).startOf("day"),l=(0,br.e$)(r,t.valueOf()-n),a=(0,br.e$)(r,s.valueOf()-n);return(0,je.jsx)("div",{style:{position:"absolute",left:l,width:a-l,height:"100%",background:i.timelineDarkerBackground}},t.valueOf())}function Yh(e){let{time:t,timelineState:o}=e;window.__c={n:"VerticalDividerComponent"};const i=(0,ee.Fg)(),r=(0,c.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n}=(0,c.VK)((()=>o.currentRange.state),[o]),s=(0,br.e$)(r,t-n);return(0,je.jsx)("div",{style:{position:"absolute",left:s,height:"100%",borderRight:`1px solid ${i.regularDividerColor}`}},t)}function Xh(e){let{timelineState:t}=e;window.__c={n:"NowVerticalDividerComponent"};const o=(0,ee.Fg)(),r=(0,c.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:n}=(0,c.VK)((()=>t.currentRange.state),[t]),s=i.ou.now().startOf("minute"),l=Math.floor((0,br.e$)(r,s.valueOf()-n));return(0,je.jsx)("div",{style:{position:"absolute",left:l,height:"100%",borderRight:`1px solid ${o.timelineRed}`}})}function Jh(e){let{timelineState:t}=e;window.__c={n:"WeekendIndicatorsComponent"};const o=(0,c.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:r,endTimestamp:n}=(0,c.VK)((()=>t.currentRange.state),[t]),{showWeekendIndicators:s}=br.BJ[o];if(!s)return null;let l=(0,br.DS)(i.ou.fromMillis(r),"day");const a=[];for(;l.valueOf()<n;){6===l.weekday&&a.push((0,je.jsx)(Qh,{timelineState:t,start:l},l.valueOf()));l=(0,br.Ip)(l,"day")}return(0,je.jsx)(je.Fragment,{children:a})}function em(e){let{timelineState:t}=e;window.__c={n:"VerticalDividersComponent"};const o=(0,c.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:r,endTimestamp:n}=(0,c.VK)((()=>t.currentRange.state),[t]),{verticalDividerUnit:s}=br.BJ[o];if(!s)return null;const l=[];let a=(0,br.DS)(i.ou.fromMillis(r),s);for(;a.valueOf()<n;){l.push((0,je.jsx)(Yh,{timelineState:t,time:a.valueOf()}));a=(0,br.Ip)(a,s)}return(0,je.jsx)(je.Fragment,{children:l})}const tm=function(e){let{store:t,collectionContextStore:o,groupFormat:i}=e;window.__c={n:"CollectionTimelineViewDroppableRow"};const r=(0,ne.O7)(),n=(0,c.VK)((()=>om(t)),[t]);return(0,je.jsx)(_t.Z,{store:t,style:{width:"100%",height:eh.Z+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:n?im(n,r,t,o,i):void 0,onInsertAbove:n?rm(n,r,t,o,i):void 0,onSelectableDrop:e=>function(e,t,o,i,r){const{droppedDirection:n,droppedStores:s,duplicate:l}=e,a=om(o);if(!a)return;const c=i.subitemTreeStore.state,d=(0,fi.DY)(c.children,(e=>e.value.store===o)),p=hi.default.mark("collections.drop_item_lag");hi.default.measureAfterNextFlush(p,{environment:t,getData:()=>pe.yr({collectionContextStore:i,is_native_drop:!1,is_empty:!1})}),$.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,perform:e=>{A.by({environment:t,collectionStore:a,targetStore:o,droppedDirection:n,collectionContextStore:i,groupsPointer:r?[r]:[],droppedStores:s,duplicate:l,transaction:e,subitemPath:d})}})}(e,r,t,o,i),onNativeDrop:e=>function(e,t,o,i,r){const{files:n,droppedDirection:s}=e,l=om(r);if(!l)return;const a=o.collectionViewBlockStore(),c=hi.default.mark("collections.drop_item_lag");hi.default.measureAfterNextFlush(c,{environment:t,getData:()=>pe.yr({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),a&&$.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,perform:e=>{A.tQ({environment:t,collectionStore:l,targetStore:a,droppedDirection:s,collectionContextStore:o,groupsPointer:i?[i]:[],files:n,transaction:e})}})}(e,r,o,i,t),onRemove:e=>function(e,t){const{transaction:o}=e;if(!om(t))return;A.Od({store:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function om(e){return e.getAssociatedCollectionStore()}function im(e,t,o,i,r){return n=>{const{insertStores:s,transaction:l}=n;return A.$T({environment:t,collectionStore:e,collectionContextStore:i,groupsPointer:r?[r]:[],insertStores:s,store:o,before:!1,transaction:l})}}function rm(e,t,o,i,r){return n=>{const{insertStores:s,transaction:l}=n;return A.$T({environment:t,collectionStore:e,collectionContextStore:i,groupsPointer:r?[r]:[],insertStores:s,store:o,before:!0,transaction:l})}}class nm extends s.Z{constructor(){super(...arguments),this.instanceStore=void 0}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.instanceStore=new me.G(this.environment,e.store.pointer)}renderComponent(){const{device:e}=this.environment,{groupFormat:t,canEdit:o,disabled:i,format:r,collectionContextStore:n}=this.props,s=n.groupsStore.getGroupState(t);if(!s)return;const l=n.permissionScopes.state,a=n.collectionViewStore(),c=o&&l.canEditContent&&!l.isSyncedCollection&&e.isMobile&&!(null!=a&&a.isSyncedCollection());return(0,je.jsxs)(je.Fragment,{children:[this.renderEmptyDroppable(),(0,je.jsx)(Ii,{collectionContextStore:n,groupsPointer:s.groupsPointer,format:r,canDrag:c,disableRequest:!0,resultProps:{groupFormat:t,collectionContextStore:n,isLast:!1,handleOpenPeekPage:w.ZT},canDrop:!0,resultComponent:tm,disabled:i,direction:Fi.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:lm})]})}renderEmptyDroppable(){if(this.instanceStore){const{canEdit:e}=this.props;return(0,je.jsx)(_t.Z,{store:this.instanceStore,shouldShowDropZone:e,canDropBelow:e,canNativeDropBelow:e,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,i){const{droppedDirection:r,droppedStores:n,duplicate:s}=e,l=o.collectionStore();if(!l)return;const a=o.groupsStore.getGroupState(t);if(!a)return;const c=o.collectionViewBlockStore(),d=hi.default.mark("collections.drop_item_lag");hi.default.measureAfterNextFlush(d,{environment:i,getData:()=>pe.yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),c&&$.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:i,perform:e=>{A.by({environment:i,collectionStore:l,targetStore:c,droppedDirection:r,collectionContextStore:o,groupsPointer:a.groupsPointer,droppedStores:n,duplicate:s,transaction:e})}})}(e,this.props.groupFormat,this.props.collectionContextStore,this.environment),onNativeDrop:e=>function(e,t,o,i){const{files:r,droppedDirection:n}=e,s=t.collectionStore();if(!s)return;const l=t.collectionViewBlockStore(),a=hi.default.mark("collections.drop_item_lag");hi.default.measureAfterNextFlush(a,{environment:i,getData:()=>pe.yr({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),l&&$.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:i,perform:e=>{A.tQ({environment:i,collectionStore:s,targetStore:l,droppedDirection:n,collectionContextStore:t,groupsPointer:o?[o]:[],files:r,transaction:e})}})}(e,this.props.collectionContextStore,this.props.groupFormat,this.environment),analyticsName:"timeline",style:{width:"100%"}})}}}nm.displayName="TimelineDropzoneSelectableGroupResults";const sm=nm;function lm(e){return(0,je.jsx)("div",{style:{width:"100%",height:eh.Z+1}})}var am=o(62193),cm=o(42239);function dm(e){window.__c={n:"TimelineItemDependencyDrawHandle"};const{store:t,schema:o,timelineState:i,dateValueStore:n,collectionContextStore:s,isFullScreen:l,isRootChild:a}=e,d=(0,r.useRef)(null),[p,u]=(0,r.useState)(!1),h=(0,ne.O7)(),m=(0,c.VK)((()=>{const e=i.drawState.state;if(e)return e.startStore===t}),[t,i.drawState]),g=(0,c.VK)((()=>!m&&i.hoveredItem.state===t&&!Lo.Z.state),[m,t,i.hoveredItem]),S=(0,c.VK)((()=>(0,br.H5)(s)),[s]),f=(0,r.useCallback)((e=>{if(e.preventDefault(),!i.scrollLeft.state||!d.current)return;const r=(0,he.VW)(d.current);Xu.J4({timelineState:i,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:s,verticalScroller:r}),u(!1)}),[s,o,t,i]),y=(0,r.useCallback)((e=>{if(!d.current)return;const t=(0,he.VW)(d.current);Xu.mz({timelineState:i,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[i]),v=(0,r.useCallback)((()=>{$.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:h,perform:e=>{Xu.$o({timelineState:i,environment:h,transaction:e,collectionContextStore:s,isFullScreen:l,isRootChild:a})}})}),[h,i,s,l,a]),C=(0,r.useCallback)((e=>{Xu.x({timelineState:i,environment:h})}),[h,i]),x=(0,r.useCallback)((()=>{u(!0)}),[u]),b=(0,r.useCallback)((()=>{u(!1)}),[u]),w=(0,ee.yK)((e=>({draggableStyle:{position:"absolute",top:0,right:-24,width:24,height:"100%",zIndex:1},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:S?e.collectionValidDependencyArrow:e.collectionUnsetDependencyArrow,strokeWidth:br.lf},svgCircleFill:{color:e.white}})),[S]),k=(0,r.useCallback)((e=>{if(!n.state)return;return(0,je.jsx)("div",{ref:d,style:w.draggableStyle,...e,children:g&&(0,je.jsx)(je.Fragment,{children:(0,je.jsx)("div",{style:w.draggableSvgStyle,children:(0,je.jsxs)("svg",{style:{width:22,height:30},onMouseMove:x,onMouseLeave:b,children:[(0,je.jsx)(lh.Z,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},style:w.svgPathStyle,showArrowHead:p}),(0,je.jsx)("circle",{cx:p?10+br.S7:10,cy:14,r:p?br.S7:br.Wk,style:w.svgPathStyle,fill:w.svgCircleFill.color})]})})})})}),[n,b,x,g,w.draggableStyle,w.draggableSvgStyle,w.svgCircleFill.color,w.svgPathStyle,p]);return(0,je.jsx)(el.Z,{render:k,onDraggableDragStart:f,onDraggableDragMove:y,onDraggableDragEnd:v,onDraggableDragCancel:C})}const pm={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},um={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};class hm extends s.Z{constructor(){super(...arguments),this.storeTypes={hovered:d.default.createClass(!1)},this.renderDraggableInner=e=>{const{type:t,timelineState:o,dateValueStore:i}=this.props,r="left"===t,n=i.state,s=o.zoomLevel.state,l=this.isActiveStore.state;var a;if(n)return(0,je.jsx)("div",{style:r?um:pm,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,...e,children:l&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:r?(a=this.theme,{position:"absolute",left:Math.ceil(3.5)+1,top:6,borderRadius:3,width:3,bottom:6,background:a.regularTextColor}):gm(this.theme)}),(0,je.jsx)("span",{style:r?{fontSize:12,position:"absolute",right:12,textAlign:"right",width:200,lineHeight:`${eh.Z}px`,pointerEvents:"none"}:{fontSize:12,position:"absolute",left:12,width:200,lineHeight:`${eh.Z}px`,pointerEvents:"none"},children:(0,je.jsx)("span",{style:{background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,padding:4,borderRadius:4},children:r?(0,br.yk)(n,s):(0,br.fc)(n,s)})})]})})},this.handleMouseMove=()=>{this.stores.hovered.setState(!0)},this.handleMouseLeave=()=>{this.stores.hovered.setState(!1)},this.isActiveStore=this.createComputedStore((()=>{const{store:e,type:t,timelineState:o}=this.props,i=this.stores.hovered.state,r=o.dragState.state;return r?r.stores[0]===e&&("left"===t?r.type===br.px.LeftResizer:r.type===br.px.RightResizer):i&&!Lo.Z.state}))}renderComponent(){return(0,je.jsx)(el.Z,{render:this.renderDraggableInner,onDraggableDragStart:e=>function(e,t,o,i,r,n,s,l){e.preventDefault(),Xu.f$({timelineState:i,store:o,startX:e.startX,type:"left"===t?br.px.LeftResizer:br.px.RightResizer,query:r,schema:n,intl:s,environment:l})}(e,this.props.type,this.props.store,this.props.timelineState,this.props.query,this.props.schema,this.props.intl,this.environment),onDraggableDragMove:e=>function(e,t){Xu.td({timelineState:t,currentX:e.currentX})}(e,this.props.timelineState),onDraggableDragEnd:()=>{return e=this.props.timelineState,t=this.props.query,o=this.props.schema,i=this.props.intl,r=this.props.collectionContextStore,n=this.props.isFullScreen,s=this.props.isRootChild,l=this.props.type,a=this.environment,$.createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:a,perform:n=>{Xu.fX({timelineState:e,collectionContextStore:r,query:t,schema:o,intl:i,environment:a,transaction:n})}}),void F.ne(a,{...(0,br.Ii)({environment:a,collectionContextStore:r,timelineState:e,isFullScreen:n,isRootChild:s}),type:l});var e,t,o,i,r,n,s,l,a},onDraggableDragCancel:e=>{return t=this.props.timelineState,o=this.environment,void Xu.cQ({timelineState:t,environment:o});var t,o}})}}hm.displayName="TimelineItemResizer";const mm=hm;function gm(e){return{position:"absolute",left:Math.floor(.5),top:6,borderRadius:3,width:3,bottom:6,background:e.regularTextColor}}const Sm=(0,j.defineMessages)({typeAName:{defaultMessage:"Type a name…",id:"timelineItem.itemName.placeholder"}});var fm=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}(fm||{});class ym extends s.Z{constructor(){super(...arguments),this.propertiesWrapEl=r.createRef(),this.renderProperty=(e,t)=>{const{showProperties:o,store:i,disabled:r,blockPropertyValueOverlayStore:n,clonedStore:s}=this.props,l=t===o.length-1,a=null==i?void 0:i.getAssociatedCollectionStore();if(a){if("title"===e)return this.renderTitle(l);if(i&&s)return(0,je.jsx)(So.Z,{store:s,property:e,disabled:r||!i.canEdit(),locked:!1,format:fo.C.Timeline,tableWrap:!1,isLast:l,blockPropertyValueOverlayStore:n,enablePointerEventsForInteractiveTypes:!0,collectionStore:a,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e)}},this.handleDateRangeButtonMouseMove=()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state;(Lo.Z.state||o)&&!this.isDrawingDependencyStore.state||this.environment.device.isPhone||t.hoveredItem.setState(e)},this.handleDateRangeButtonMouseLeave=()=>{const{timelineState:e}=this.props,t=e.dragState.state;(Lo.Z.state||t)&&!this.isDrawingDependencyStore.state||e.hoveredItem.setState(void 0)},this.handleAnimationStateChange=()=>{const{current:e}=this.propertiesWrapEl,t=this.animationStateStore.state;e&&t&&(e.style.position=t.position===fm.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)},this.pageURLStore=this.createComputedStore((()=>{const{store:e}=this.props;if(e)return(0,_o.ZP)({store:e,fullyQualified:!1,pageVisitSource:p.tY.LinkInPage})})),this.peekURLStore=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=Do.default.state;if(e&&o)return re.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.isHoveredStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props;return t.hoveredItem.state===e})),this.isDrawingDependencyStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.drawState.state;return o&&o.startStore!==e})),this.editingTitleStore=this.createComputedStore((()=>{var e;const{store:t}=this.props,o=Go.default.state;if("editing"!==o.mode)return!1;const i=null===(e=(0,Io.QY)(o.multiSelection))||void 0===e?void 0:e.store;return t&&i&&i===t.getBlockTitleStore()})),this.animationStateStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,itemPositionStore:o}=this.props,i=o.state;if(i){const{left:o,right:r}=i,n=r-o;if(!((0,br.Tp)(this.environment)&&n>50))return{position:fm.Absolute,left:o};{const i=e.scrollLeft.state;if(void 0!==i){const e=i+t-o+21;if(e<0)return{position:fm.Absolute,left:o};if(e>n)return{position:fm.Absolute,left:r};if(e>0)return{position:fm.Sticky,left:t+21}}}}})),this.passesFilterStore=this.createComputedStore((()=>{var e,t;const o=this.props.parentStore,i=(0,vi.m1)({collectionContextStore:this.props.collectionContextStore,collectionStore:o,environment:this.environment}),r=null===(e=this.props.store)||void 0===e?void 0:e.getModel(),n=null===(t=this.props.store)||void 0===t?void 0:t.getRecordModel;if(!i||!r||!n)return!0;const s=td.default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs");return(0,mi.q)(i)({block:r,getRecordModel:n,propertyMapping:null==o?void 0:o.getPropertyMapping(),formulaTimeoutTimestampMs:Date.now()+s,resultCache:new Map})})),this.shouldShowHighlightHalo=this.createComputedStore((()=>!!this.props.store&&re.Sc(this.props.store))),this.isMyTasksStore=this.createComputedStore((()=>{const e=this.props.collectionContextStore.collectionViewBlockStore();return!!e&&(0,wi.qG)(e.id)}))}didMount(){super.didMount(),this.animationStateStore.addListener(this.handleAnimationStateChange),this.handleAnimationStateChange()}willUnmount(){super.willUnmount(),this.animationStateStore.removeListener(this.handleAnimationStateChange)}UNSAFE_willUpdate(){this.animationStateStore.enqueueRecompute()}renderComponent(){const{itemPositionStore:e,store:t,timelineState:o,query:i,schema:r,dateValueStore:n,disabled:s,isDraggingViaTimelineItemStore:l,collectionContextStore:a,isFullScreen:c,isRootChild:d,intl:p}=this.props,u=e.state;if(!u)return;const h=(0,br.H5)(a),{left:m,right:g,maskPercent:S}=u,f=this.isHoveredStore.state,y=this.pageURLStore.state,v=this.peekURLStore.state,C=!s&&(null==t?void 0:t.canEdit()),x=this.environment.device.isPhone,b=C&&!x&&(h||a.permissionScopes.state.canConfigureBlock)&&!this.isMyTasksStore.state,w=a.currentSubitemFormatStoreForUiDisplay.state?42:10,k=Math.max(g-m,w)+1,P=l.state,T=(0,je.jsx)(xm,{collectionContextStore:this.props.collectionContextStore,toggleButton:this.props.toggleButton,itemPositionStore:this.props.itemPositionStore}),V=this.passesFilterStore.state,R=a.isCompactView.state;return t&&!u.isPlaceholder?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsxs)(_t.Z,{style:bm(m,k,P,u,V,this.props.isInPeekRenderer,this.theme),haloStyle:this.getHaloStyle(),className:eo.ovr,store:t,canSelect:!0,shouldShowHalo:!R,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,canDrag:C,analyticsName:"timeline",onDraggableDragStart:wm,onDraggableDragMove:e=>function(e,t,o,i,r,n,s){if(!t)return;o.dragState.state||Xu.f$({timelineState:o,store:t,startX:e.startX,type:br.px.ItemDrag,query:i,schema:r,intl:n,environment:s});Xu.td({timelineState:o,currentX:e.currentX})}(e,this.props.store,this.props.timelineState,this.props.query,this.props.schema,this.props.intl,this.environment),onDraggableDragEnd:()=>function(e,t,o,i,r,n){$.createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:n,perform:s=>{Xu.fX({timelineState:e,collectionContextStore:t,query:o,schema:i,intl:r,environment:n,transaction:s})}})}(this.props.timelineState,this.props.collectionContextStore,this.props.query,this.props.schema,this.props.intl,this.environment),onDraggableDragCancel:()=>function(e,t){Xu.cQ({timelineState:e,environment:t})}(this.props.timelineState,this.environment),canTriggerContextMenu:C,getGhostElement:km,disableScrollToReveal:!0,onMouseMove:this.handleDateRangeButtonMouseMove,onMouseLeave:this.handleDateRangeButtonMouseLeave,showBlockMenuInput:!0,children:[T,(0,je.jsx)(wo.Z,{style:{width:"100%",height:"100%",borderRadius:4},innerStyle:{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:4},onClick:this.props.handleOpenPeekPage,href:y,metaHref:v,hovered:f,ignoreLocalHoverState:!0}),b&&this.props.store&&(0,je.jsx)(dm,{store:this.props.store,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,schema:this.props.schema,timelineState:this.props.timelineState,dateValueStore:this.props.dateValueStore,collectionContextStore:this.props.collectionContextStore}),C&&!x&&(0,je.jsx)(mm,{type:"left",store:t,query:i,schema:r,timelineState:o,dateValueStore:n,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:d,intl:p,resultStore:this.props.resultStore}),C&&!x&&(0,je.jsx)(mm,{type:"right",store:t,query:i,schema:r,timelineState:o,dateValueStore:n,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:d,intl:p,resultStore:this.props.resultStore})]}),this.renderProperties(S,P,V)]}):(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:bm(m,k,P,u,V,this.props.isInPeekRenderer,this.theme),className:eo.ovr}),this.renderProperties(S,P,V)]})}renderProperties(e,t,o){const{showProperties:i}=this.props;return(0,je.jsx)("div",{style:this.getPropertiesWrapStyle(e,t,o),children:(0,je.jsx)("div",{style:Cm(this.props.collectionContextStore,this.props.toggleButton),ref:this.propertiesWrapEl,className:eo.z_z,children:i.map(this.renderProperty)})})}renderTitle(e){var t;const{store:o}=this.props,i=o?o.getIcon():void 0,r=null==o?void 0:o.hasError(),n=!o||o.isEmptyPage(),s=this.editingTitleStore.state,{parentStore:l,collectionContextStore:a}=this.props,c=a.currentSubitemFormatStoreForUiDisplay.state,d=c&&l?null===(t=l.getSchema()[c.property])||void 0===t?void 0:t.name:"";return(0,je.jsxs)("div",{style:{display:"flex",marginRight:e?0:10,fontSize:14,fontWeight:R.Z.fontWeight.medium,alignItems:"center"},children:[i&&!r&&(0,je.jsx)(ko.Z,{disabled:!0,icon:i,isEmptyPage:n,size:20,style:{marginLeft:2,marginRight:6}}),r&&(0,ao.t)({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:this.theme.accentColors.orange[500]}),o&&!s&&(0,je.jsx)(ha.Z,{style:{whiteSpace:"nowrap",maxWidth:400},store:o}),s&&o&&(0,je.jsx)(To.Z,{store:o.getBlockTitleStore(),style:{whiteSpace:this.environment.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:()=>Pm(this.props.store,this.environment),onEsc:()=>Pm(this.props.store,this.environment),onTab:w.yR,placeholder:Ne.default.formatMessage(Sm.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline"}),o&&(0,Fo.Cr)({collectionContextStore:a,blockId:o.id,blockStore:o})&&(0,je.jsx)("div",{style:{paddingTop:2,paddingLeft:4},children:(0,je.jsx)(vo.O,{blockStore:o,collectionContextStore:a})}),o&&(0,Fo.wI)({collectionContextStore:a,blockStore:o})&&(0,je.jsx)("div",{style:{paddingTop:2,paddingLeft:8,color:this.theme.lightTextColor},children:(0,je.jsx)(Co.B,{blockStore:o,collectionContextStore:a})}),!o&&(0,je.jsx)("span",{children:l&&d?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:d}}):(0,je.jsx)(j.FormattedMessage,{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})})]},"title")}getPropertiesWrapStyle(e,t,o){return{width:"100%",WebkitMaskImage:e<1&&this.isHoveredStore.state?`linear-gradient(90deg, rgba(0,0,0,1) ${100*e}%, rgba(0,0,0,0.4) ${100*e}%)`:void 0,pointerEvents:"none",...t&&{display:"none"},zIndex:M.ov,opacity:o?1:.5}}getHaloStyle(){return{borderRadius:4,...re.pB(this.shouldShowHighlightHalo.state,this.theme)}}}ym.displayName="TimelineItemDateRange";const vm=ym;function Cm(e,t){const o=e.currentSubitemFormatStoreForUiDisplay.state;return{display:"flex",height:eh.Z-2+1,paddingLeft:o&&t?24:6,width:800,overflow:"hidden"}}function xm(e){let{collectionContextStore:t,toggleButton:o,itemPositionStore:i}=e;window.__c={n:"ToggleButton"};const r=(0,c.VK)((()=>t.currentSubitemFormatStoreForUiDisplay.state),[t]),n=(0,c.VK)((()=>i.state),[i]);return!r||!o||null!=n&&n.isExistingSubitemPlaceholder?null:(0,je.jsx)("span",{style:{zIndex:1,paddingTop:3},children:o})}function bm(e,t,o,i,r,n,s){const l=s.mode;return{position:"absolute",left:e,marginTop:1,marginBottom:1,width:t,height:eh.Z-2,borderRadius:4,display:"flex",...i.isExistingSubitemPlaceholder?void 0:{..."light"===l?{background:i.isPlaceholder?s.buttonHoveredBackground:s.contentBackground,boxShadow:i.isPlaceholder?void 0:s.buttonBoxShadow}:{background:n?s.calendarItemBackground:s.popoverBackground,boxShadow:i.isPlaceholder?void 0:s.lightBoxShadow}},...i.isPlaceholder&&{cursor:"crosshair"},...o&&{display:"none"},...!r&&{opacity:.5},zIndex:M.ov}}function wm(e){e.preventDefault()}function km(e){const t=Gl.C.findSelectablesFromStore(e),o=w.oA(t.map((e=>e.getNode()))),i=w.oA(o.map((e=>e.closest(`.${eo.o4s}`))))[0];if(i){const e=cm.eN(i),t=e.cloned.querySelector(`.${eo.ovr}`),o=e.cloned.querySelector(`.${eo.z_z}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map(cm.eN)}function Pm(e,t){e&&K.Ys({environment:t,store:e})}var Tm=o(31505),Vm=o(39301),Rm=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(Rm||{});class Mm extends s.Z{constructor(){super(...arguments),this.lastVisibilityState=Rm.NotDefined,this.buttonRef=r.createRef(),this.wrapRef=r.createRef(),this.arrowButtonHovered=d.default.createValue(!1),this.handleIsVisibleChange=()=>{const e=this.buttonRef.current,t=this.wrapRef.current;if(e&&t){const o=this.isVisibleStore.state,i=o===Rm.VisibleInItem||o===Rm.VisibleOutOfItem;e.style.opacity=""+(i?1:0),e.style.transform=`scale(${i?1:.3})`,t.style.pointerEvents=o===Rm.VisibleOutOfItem?"":"none";this.lastVisibilityState!==Rm.NotDefined&&o!==Rm.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),this.lastVisibilityState=o}},this.handleClick=()=>{const{store:e,type:t,timelineState:o,dateValueStore:i,paddingLeft:r,format:n,collectionContextStore:s,isFullScreen:l,isRootChild:a}=this.props,c=i.state,d=o.zoomLevel.state,{snapUnit:p}=br.BJ[d],u=(0,br.x2)(d,200);if(c)if("left"===t){const{start:e}=(0,br.XO)(c,p),t=(0,br.GK)({timestamp:e.valueOf(),environment:this.environment,timelineState:o,paddingLeft:r,format:n})-u;Xu.Nf({timelineState:o,environment:this.environment,zoomLevel:d,centerTimestamp:t})}else{const{end:e}=(0,br.XO)(c,p),t=(0,br.PF)({timestamp:e.valueOf(),timelineState:o})+u;Xu.Nf({timelineState:o,environment:this.environment,zoomLevel:d,centerTimestamp:t})}this.arrowButtonHovered.setState(!1),K.Ys({environment:this.environment,store:e}),F.gw(this.environment,{...(0,br.Ii)({environment:this.environment,collectionContextStore:s,timelineState:o,isFullScreen:l,isRootChild:a}),type:t})},this.handleMouseOver=()=>{this.environment.device.isPhone||Lo.Z.state||this.arrowButtonHovered.setState(!0)},this.handleMouseOut=()=>{this.environment.device.isPhone||this.arrowButtonHovered.setState(!1)},this.isVisibleStore=this.createComputedStore((()=>{const{type:e,timelineState:t,scrollerLeftOffset:o,itemPositionStore:i,isDraggingViaTimelineItemStore:r}=this.props,n=i.state;if(n){const{left:i,right:s}=n;if(r.state)return Rm.Hidden;const l=t.scrollLeft.state;if(void 0!==l){if("left"===e){const e=l+o;if(e-s>0)return Rm.VisibleOutOfItem;if(e-i>0)return Rm.VisibleInItem}else{const{outerSizeObserver:e}=t,o=l+e.rect.state.width;if(i-o>0)return Rm.VisibleOutOfItem;if(s-o>0)return Rm.VisibleInItem}return Rm.Hidden}}return Rm.NotDefined}))}didMount(){super.didMount(),this.isVisibleStore.addListener(this.handleIsVisibleChange),this.handleIsVisibleChange()}willUnmount(){super.willUnmount(),this.isVisibleStore.removeListener(this.handleIsVisibleChange)}UNSAFE_willUpdate(){this.isVisibleStore.enqueueRecompute()}renderComponent(){const{type:e}=this.props,t=this.arrowButtonHovered.state,o="left"===e?Tm.Y:Vm.n;return(0,je.jsxs)("div",{style:Fm(this.props.type,this.props.scrollerLeftOffset,this.props.timelineState),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:ue.$0,onClick:this.handleClick,ref:this.wrapRef,children:[(0,je.jsx)("div",{style:this.getArrowStyle(),ref:this.buttonRef,children:o({height:6,fill:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground})}),t&&(0,je.jsx)(Im,{dateValueStore:this.props.dateValueStore,timelineState:this.props.timelineState,isInPeekRenderer:this.props.isInPeekRenderer})]})}getArrowStyle(){const{type:e}=this.props;return{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:this.arrowButtonHovered.state?this.theme.regularIconColor:this.theme.mediumIconColor,borderRadius:4,border:`1px solid ${this.theme.contentBackground}`,..."left"===e&&{marginLeft:8,marginRight:4},..."right"===e&&{marginRight:8,marginLeft:4}}}}Mm.displayName="TimelineScrollArrow";const jm=Mm;function Fm(e,t,o){const{outerSizeObserver:i}=o;return{position:"sticky",left:"left"===e?t:i.rect.state.width-220,width:220,height:oa-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===e?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis",zIndex:M.fQ}}function _m(e,t){return{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:e?t.peekTimelineBackground:t.timelineBackground,pointerEvents:"none"}}function Im(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:i}=e;window.__c={n:"DateRangeComponent"};const r=(0,ee.Fg)(),n=(0,c.VK)((()=>t.state),[t]),s=(0,c.VK)((()=>o.zoomLevel.state),[o]);return n?(0,je.jsx)("span",{style:_m(i,r),children:(0,br._Q)(n,s)}):null}class Bm extends s.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.dateRangeRef=r.createRef(),this.storeTypes={node:d.default.createClass(null)},this.handleMouseMove=e=>{const{timelineState:t,store:o,groupFormat:r,disabled:n,query:s,schema:l}=this.props,a=t.dragState.state,c=t.drawState.state,{horizontalScroller:d}=t,p=t.scrollLeft.state,u=t.zoomLevel.state,h=t.currentRange.state,{snapUnit:m,getDateRangePlaceholderDuration:g}=br.BJ[u];if(!c&&Lo.Z.state||a||Am(this.props.store,this.props.query,this.props.schema,this.environment)||!d||void 0===p||n)return;const S=d.getBoundingClientRect(),f=p+(e.clientX-S.left),y=(0,br.x2)(u,f),v=i.ou.fromMillis(h.startTimestamp+y),C=(0,br.DS)(v,m),x=(0,br.DS)(g(v),m),b=(0,Hd.hT)(C.valueOf(),(0,Ee.r)()),w=(0,br.AZ)({startValue:b,snapUnit:m,desiredStart:C,desiredEnd:x});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:this.parentCollectionStore.state,groupFormat:r,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:s,schema:l}})},this.handleClick=e=>{const{store:t,query:o,schema:i,timelineState:r,groupFormat:n,collectionContextStore:s}=this.props,l=r.dateRangePlaceholder.state,a=s.groupsStore.getGroupState(n);if(a)if(l.active){const{date:e}=l;$.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:r=>{Xu.oP({environment:this.environment,store:t,query:o,schema:i,date:e,transaction:r})}}),r.dateRangePlaceholder.setState({active:!1})}else{const{timelineState:o,collectionContextStore:i}=this.props,{horizontalScroller:r}=o,n=o.scrollLeft.state,s=this.itemPositionStore.state,l=this.dateRangeRef.current;if(!r||void 0===n||!s||!l)return;const c=r.getBoundingClientRect(),d=n+(e.clientX-c.left),u=l.propertiesWrapEl.current;if(!u)return;const h=u.lastElementChild;if(!h)return;const m=n+(h.getBoundingClientRect().right-c.left);d>s.right&&d<=m&&(0,ue.ZP)({event,context:ue.Af.EditorClick,callback:()=>{(0,El.X9)()||ie.CH({environment:this.environment,store:t,openInNew:ai.DJ(e),peekMode:(0,re.kr)(i.collectionViewStore()),resultsStore:a.resultsStore,collectionContextStore:i,pageVisitSource:p.tY.PeekOpen})}})}},this.onRefChange=e=>{this.stores.node.setState(e)},this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,br.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:this.subitemPlaceholderDateStore.state})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.shouldRenderScrollArrowsStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e&&!e.isPlaceholder)})),this.subitemPlaceholderDateStore=this.createComputedStore((()=>{const{subitemPath:e}=this.props,t=(0,fi.ub)(e);if(!t||Boolean(this.dateValueStore.state))return;const o=t.value.store,i=rh.findCollectionTimelineViewItems(o);if(i.length>0){return i[0].dateValueStore.state}})),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,timelineState:t,groupFormat:o}=this.props,i=t.dateRangePlaceholder.state;if(i.active&&i.store===e&&!i.newTimelineItemProps&&(0,te.ZH)(i.groupFormat,o))return i.date})),this.dateValueStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,i=this.placeholderDateStore.state;if(i)return i;if(o){const t=o.stores.indexOf(e);if(t>=0)return o.temporaryValues[t]}return Am(this.props.store,this.props.query,this.props.schema,this.environment)}),!0),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,i=Pi.ZP.state;return Boolean(o&&o.stores.includes(e)&&i.isDragging&&i.draggedStores.includes(e))})),this.parentCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore()))}get registries(){return[rh]}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.clonedStore=e.store.clone()}renderComponent(){var e;const{store:t,timelineState:o,scrollerLeftOffset:i,paddingLeft:r,format:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:p,isFullScreen:u,isRootChild:h,toggleButton:m,groupFormat:g}=this.props,S=this.shouldRenderDateRangeStore.state,f=this.shouldRenderScrollArrowsStore.state,y=null===(e=p.groupsStore.getGroupState(g))||void 0===e?void 0:e.reducerResultStore;if(y)return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsxs)("div",{style:{display:"flex",height:0},children:[f&&(0,je.jsx)(jm,{store:t,type:"left",timelineState:o,scrollerLeftOffset:i,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:r,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:p,isFullScreen:u,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,resultStore:y}),f&&(0,je.jsx)(jm,{store:t,type:"right",timelineState:o,scrollerLeftOffset:i,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:r,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:p,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:u,isRootChild:h,resultStore:y})]}),(0,je.jsx)("div",{style:{display:"flex",height:eh.Z+1,width:"100%",cursor:"default"},onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,ue.ZP)({event:e,context:ue.Af.EditorMouseDown,callback:()=>{e.preventDefault(),G.AI({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onMouseMove:this.handleMouseMove,onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(this.props.timelineState),onClick:this.handleClick,className:eo.o4s,ref:this.onRefChange,children:S&&(0,je.jsx)(vm,{store:t,parentStore:this.parentCollectionStore.state,toggleButton:m,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:s,schema:l,timelineState:o,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:p,isFullScreen:u,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,intl:Ne.default.getIntl(),ref:this.dateRangeRef,resultStore:y,handleOpenPeekPage:this.props.handleOpenPeekPage})})]})}}Bm.displayName="CollectionTimelineViewItem";const Dm=Bm;function Am(e,t,o,i){return(0,br.bk)({store:e,query:t,schema:o,userId:i.currentUser.id,intl:Ne.default.getIntl()})}class Lm extends s.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,br.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:void 0})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>!1)),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,parentStore:t,timelineState:o,groupFormat:i}=this.props,r=o.dateRangePlaceholder.state;if(r.active&&r.store===e&&r.newTimelineItemProps&&r.parentStore===t&&(0,te.ZH)(r.groupFormat,i))return r.date})),this.dateValueStore=this.createComputedStore((()=>{const e=this.placeholderDateStore.state;if(e)return e}),!0)}UNSAFE_willMount(e){super.UNSAFE_willMount(e),e.store&&(this.clonedStore=e.store.clone())}renderComponent(){var e;const{store:t,parentStore:o,timelineState:r,scrollerLeftOffset:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:p,isFullScreen:u,isRootChild:h,toggleButton:m,groupFormat:g}=this.props,S=this.shouldRenderDateRangeStore.state,f=null===(e=p.groupsStore.getGroupState(g))||void 0===e?void 0:e.reducerResultStore,y=!t&&!S&&p.shouldAllowNewItemCreation();if(f)return(0,je.jsx)(je.Fragment,{children:(0,je.jsxs)("div",{style:{display:"flex",height:eh.Z+1,width:"100%",cursor:"default"},onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,ue.ZP)({event:e,context:ue.Af.EditorMouseDown,callback:()=>{e.preventDefault(),G.AI({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onMouseMove:e=>function(e,t,o,r,n,s,l,a,c,d,p,u){var h;const m=t.drawState.state,g=t.dragState.state,{horizontalScroller:S}=t,f=t.scrollLeft.state,y=t.zoomLevel.state,v=t.currentRange.state,{snapUnit:C,getDateRangePlaceholderDuration:x}=br.BJ[y];if(!m&&Lo.Z.state||g||!S||void 0===f||n)return;const b=null===(h=d.groupsStore.getGroupState(r))||void 0===h?void 0:h.resultsStore;if(!b)return;const w=S.getBoundingClientRect(),k=f+(e.clientX-w.left),P=(0,br.x2)(y,k),T=i.ou.fromMillis(v.startTimestamp+P),V=(0,br.DS)(T,C),R=(0,br.DS)(x(T),C),M=(0,Hd.hT)(V.valueOf(),(0,Ee.r)()),j=(0,br.AZ)({startValue:M,snapUnit:C,desiredStart:V,desiredEnd:R});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:p,groupFormat:r,date:j,newTimelineItemProps:{query:s,schema:l,resultsStore:b,isFullScreen:a,canEditTimelineItems:c,subitemPath:u},existingTimelineItemProps:void 0})}(e,this.props.timelineState,this.props.store,this.props.groupFormat,this.props.disabled,this.props.query,this.props.schema,this.props.isFullScreen,this.props.canEditTimelineItems,this.props.collectionContextStore,this.props.parentStore,this.props.subitemPath),onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(this.props.timelineState),onClick:e=>function(e,t,o,i,r,n,s,l,a,c,d,p){const u=r.dateRangePlaceholder.state;if(u.active){const{date:e}=u,h=p?p.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";$.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,perform:r=>{const u=Xu.mg({environment:t,transaction:r,date:e,store:c,parentStore:d,query:o,schema:i,isFullScreen:n,groupFormat:s,canEditTimelineItems:l,collectionContextStore:a,subitemPath:p,from:h});ce.W(t,{from:h,type:"page",new_page_id:null==u?void 0:u.id,creating_block_id:null==u?void 0:u.id,...(0,pe.Pn)(a)})}}),r.dateRangePlaceholder.setState({active:!1})}}(0,this.environment,this.props.query,this.props.schema,this.props.timelineState,this.props.isFullScreen,this.props.groupFormat,this.props.canEditTimelineItems,this.props.collectionContextStore,this.props.store,this.props.parentStore,this.props.subitemPath),className:eo.o4s,children:[S&&(0,je.jsx)(vm,{store:o?void 0:t,parentStore:o,toggleButton:m,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:s,schema:l,timelineState:r,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:p,isFullScreen:u,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,intl:Ne.default.getIntl(),resultStore:f,handleOpenPeekPage:()=>{}}),y&&(0,je.jsx)(Gm,{parentStore:this.props.parentStore,collectionContextStore:this.props.collectionContextStore,paddingLeft:this.props.paddingLeft,isFullScreen:this.props.isFullScreen,showTable:this.props.showTable})]})})}}Lm.displayName="CollectionTimelineViewItemNew";const Zm=Lm;function Em(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function Om(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.mediumIconColor}}function Gm(e){let{parentStore:t,collectionContextStore:o,paddingLeft:i,isFullScreen:r,showTable:n}=e;window.__c={n:"AddRowIndicatorComponent"};const s=(0,ee.Fg)(),l=(0,c.VK)((()=>o.currentSubitemFormatStoreForUiDisplay.state),[o]),a=(0,c.VK)((()=>{var e;return l&&t?null===(e=t.getSchema()[l.property])||void 0===e?void 0:e.name:""}),[l,t]);return(0,je.jsx)("div",{style:Em(i,r,n),children:(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:ia,lineHeight:R.Z.lineHeight.UIRegular.desktop},children:[(0,ae.R)(Om(s)),(0,je.jsx)("span",{style:{color:s.mediumTextColor},children:t&&a?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:a}}):(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}class Nm extends s.Z{constructor(){super(...arguments),this.resultPropsMemo=new am.Uw,this.resultProps=()=>{const{groupFormat:e,disabled:t,query:o,format:i,schema:r,blockPropertyValueOverlayStore:n,collectionContextStore:s,isFullScreen:l,isRootChild:a,showTable:c,canEditTimelineItems:d,scrollerLeftOffsetStore:p,timelineState:u,paddingLeft:h,showTimelinePropertiesStore:m,isInPeekRenderer:g}=this.props,S=s.permissionScopes.state;return this.resultPropsMemo.memo((()=>({disabled:t||!("collectionTypedView"===s.contextType||S.canEditContent),timelineState:u,schema:r,query:o,format:i,scrollerLeftOffset:p.state,paddingLeft:h,showProperties:m.state,blockPropertyValueOverlayStore:n,collectionContextStore:s,isFullScreen:l,showTable:c,isRootChild:a,groupFormat:e,canEditTimelineItems:d,isInPeekRenderer:g,handleOpenPeekPage:()=>Km(this.props.collectionContextStore,this.props.groupFormat,this.environment),isLast:!1})),[t,u,r,o,i,p,S,h,m,n,s,l,c,a,e,d,g,()=>Km(this.props.collectionContextStore,this.props.groupFormat,this.environment)])},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,schema:t,groupFormat:o,query:i,showTable:r}=this.props;if(!i.timeline_by)return;const n=e.groupsStore.getGroupState(o);if(!n)return;const s=n.currentLimit.state,l=w.oA([o&&(0,Ze.Ko)({schema:t,propertyMapping:void 0,group:o,timeZone:(0,Ee.r)()}),!r&&{property:i.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:l.length>0?{operator:"and",filters:l}:void 0,limit:s}}))}renderComponent(){const{store:e,format:t,groupFormat:o,collectionContextStore:i,isFullScreen:r,paddingLeft:n,showTable:s}=this.props,l=i.groupsStore.getGroupState(o);if(!l)return;const a=o?[o]:[],c=this.resultsReducerStore.state,d=l.reducerResultStore.state,p=re.VM({collectionContextStore:i,reducerResult:d,isFullScreen:r});return(0,je.jsxs)(je.Fragment,{children:[c&&(0,je.jsx)(He.Z,{id:a.length>0?`results:${(0,te.KW)(a)}`:"timeline_results",reducer:c,groupsPointer:a,collectionContextStore:i,resultStore:l.reducerResultStore}),this.renderCollectionGroupResults(),p&&(0,je.jsx)("div",{style:{width:"100%"},children:s?(0,je.jsx)("div",{style:{height:33}}):(0,je.jsx)(zi,{style:{position:"sticky",left:r?n:3,width:"max-content",height:33},groupsPointer:a,store:e,collectionContextStore:i,format:t,isFullScreen:r,incrementLimitsInRelatedGroups:!1})}),(0,je.jsx)(zm,{...this.props,store:void 0,indentLevel:0,handleOpenPeekPage:()=>Km(this.props.collectionContextStore,this.props.groupFormat,this.environment)})]})}renderCollectionGroupResults(){const{groupFormat:e,format:t,collectionContextStore:o}=this.props,i=o.groupsStore.getGroupState(e);if(i)return(0,je.jsx)(Ii,{disableSelectable:!0,collectionContextStore:o,groupsPointer:i.groupsPointer,format:t,canDrag:!1,disableRequest:!0,resultProps:this.resultProps(),canDrop:!1,resultComponent:Dm,disabled:!0,direction:Fi.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:e=>function(e,t,o){return(0,je.jsx)(zm,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>Km(o.collectionContextStore,o.groupFormat,t)})}(e,this.environment,this.props)})}}function zm(e){window.__c={n:"AddRowTimelineItem"};const{store:t,parentStore:o,subitemPath:i,timelineState:r,disabled:n,query:s,format:l,schema:a,collectionContextStore:d,blockPropertyValueOverlayStore:p,isFullScreen:u,isRootChild:h,groupFormat:m,paddingLeft:g,showTimelinePropertiesStore:S,scrollerLeftOffsetStore:f,showTable:y,canEditTimelineItems:v,isInPeekRenderer:C,isReady:x,canEdit:b}=e,w=(0,c.VK)((()=>d.groupsStore.getGroupState(m)),[d,m]),k=(0,c.VK)((()=>d.permissionScopes.state),[d.permissionScopes]),P=(0,c.VK)((()=>f.state),[f]),T=(0,c.VK)((()=>S.state),[S]);return w&&x&&b&&!k.isSyncedCollection?(0,je.jsx)(Zm,{store:t,disabled:n||!k.canEditContent,timelineState:r,schema:a,query:s,format:l,scrollerLeftOffset:P,paddingLeft:g,showProperties:T,blockPropertyValueOverlayStore:p,collectionContextStore:d,isFullScreen:u,showTable:y,isRootChild:h,groupFormat:m,canEditTimelineItems:v,isInPeekRenderer:C,parentStore:o,subitemPath:i}):null}Nm.displayName="TimelineItemGroupResults";const Hm=(0,j.injectIntl)(Nm);function Km(e,t,o){const i=e.groupsStore.getGroupState(t);if(!i)return;hi.default.mark("collections.open_item_page_lag");const r=e.collectionViewStore();O.Xd({collectionContextStore:e,resultsStore:i.resultsStore});const n=null==r?void 0:r.getFormat().collection_peek_mode,s=n||ki.Ls.timeline;bi.hy(o,{is_peek:!0,from:"timeline",peek_mode:s})}function Wm(){window.__c={n:"TimelineTableShimmer"};const e=(0,ee.yK)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,je.jsx)("div",{style:e.rowContainer,children:(0,je.jsx)(Vr.Z,{style:e.rowShimmer})})}class Um extends s.Z{constructor(){super(...arguments),this.groupsPointerMemo=new am.Uw,this.groupsPointer=()=>{const{groupFormat:e}=this.props;return this.groupsPointerMemo.memo((()=>e?[e]:[]),[e])},this.renderGroupResults=e=>{const{device:t}=this.environment,{schema:o,disabled:i,collectionContextStore:r,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,groupFormat:c}=this.props,d=r.collectionViewStore();if(!d)return;const p=this.groupsPointer();if(!r.groupsStore.getGroupState(p))return;const u=s.state,h=!l&&t.isMobile&&!d.isSyncedCollection(),m=this.titleColumnIndexStore.state;return(0,je.jsx)(Ii,{collectionContextStore:r,groupsPointer:p,disableRequest:!0,format:a,canDrag:h,resultProps:{schema:o,collectionContextStore:r,propertyFormats:u,onPropertyTab:e.onPropertyTab,onPropertyUntab:e.onPropertyUntab,onPropertyEnter:e.onPropertyEnter,onPropertyClick:e.onPropertyClick,onPropertyEsc:e.onPropertyEsc,onPropertyBgClick:e.onPropertyBgClick,onPropertyContextMenu:e.onPropertyContextMenu,onOpenProperty:e.onOpenProperty,disabled:i,blockPropertyValueOverlayStore:n,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableTableWrap:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:qm,titleColumnIndex:m,groupFormat:c,shouldShowMultiSelectCheckbox:!1},resultComponent:Ml,canDrop:!1,disabled:i,direction:Fi.Vertical,getItemSelectableStyle:()=>({display:"flex",borderBottom:`1px solid ${this.theme.tableDividerColor}`,width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:e.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:n,titleColumnIndex:m,nestedCreateSubitemButton:this.nestedCreateSubitemButton})},this.nestedCreateSubitemButton=e=>{const{collectionContextStore:t,disabled:o}=this.props,{store:i,parentStore:r,subitemPath:n,indentLevel:s}=e;if(r)return(0,je.jsx)(Dn,{store:i,collectionStore:r,subitemPath:n,indentLevel:s,collectionContextStore:t,disabled:o,groupsPointer:this.groupsPointer(),onSubitemCreate:e=>function(e,t,o,i){o&&l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{po.bA({isNewBlock:!0,environment:i,blockPropertyValueOverlayStore:o,store:e,property:"title",format:fo.C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})}))}))}(e,this.props.collectionContextStore,this.props.blockPropertyValueOverlayStore,this.environment)})},this.handleAddRowClick=()=>{const{collectionContextStore:e,isFullScreen:t,groupFormat:o}=this.props,{device:i}=this.environment,r=o?[o]:[],n=e.groupsStore.getGroupState(r);if(!ge.M_(this.environment)||!n)return;e.searchQuery.state&&de.Ug({searchQuery:"",collectionContextStore:e,isFullScreen:t});const s=e.currentSubitemFormatStoreForCollection.state;$.createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:this.environment,perform:t=>{const r=A.IW({environment:this.environment,collectionContextStore:e,groupsPointer:o?[o]:[],shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"timeline_table_group_results"});if(r){if(i.isMobile){const e=(0,_o.ZP)({store:r.newStore,fullyQualified:!1,pageVisitSource:p.tY.Create});this.navigate(e)}else l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{if(r.coercionSucceeded)po.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:r.newStore,property:"title",format:fo.C.Table,collectionContextStore:e,disableHorizontalEdgeScroll:!0});else{const t=o?[o]:[],i=e.groupsStore.getGroupState(t);ie.CH({environment:this.environment,store:r.newStore,peekMode:(0,re.kr)(e.collectionViewStore()),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:e,pageVisitSource:p.tY.Create})}}))}));ce.W(this.environment,{from:s?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:r.newStore.id,creating_block_id:r.newStore.id,...(0,pe.Pn)(e)})}}})},this.titleColumnIndexStore=this.createComputedStore((()=>{const{showTablePropertyFormatsStore:e}=this.props;return e.state.findIndex((e=>"title"===e.property))}))}renderComponent(){const{groupFormat:e,isFullScreen:t,collectionContextStore:o,blockPropertyValueOverlayStore:i,isReady:r,store:n,disabled:s,format:l,schema:a,isInPeekRenderer:c,query:d,showTablePropertyFormatsStore:p,showHoverActionsStore:u}=this.props,h=o.groupsStore.getGroupState(this.groupsPointer());if(!h)return;const m=h.reducerResultStore.state,g=(0,re.VM)({collectionContextStore:o,reducerResult:m,isFullScreen:t}),S=o.shouldShowSpinner.state,f=r&&0===(null==m?void 0:m.blockIds.length)&&!S,y=o.permissionScopes.state;return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Xm,{store:n,format:l,schema:a,query:d,collectionContextStore:o,disabled:s,paddingBottom:this.props.paddingBottom,isInPeekRenderer:c,blockPropertyValueOverlayStore:i,tableStore:this.props.tableStore,showTablePropertyFormats:this.props.showTablePropertyFormatsStore.state,timelineState:this.props.timelineState,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,groupFormat:e}),(0,je.jsx)("div",{style:{height:(0,br.vX)(Boolean(e)),width:0}}),f&&this.renderEmptyTablePlaceholder(),this.renderTableRows(e),S&&(0,je.jsx)(Wm,{}),g&&this.renderLoadMoreButton(),Qm(this.props.collectionContextStore,this.props.isReady,this.props.canEdit)&&this.renderTableAddRowButton(),(0,je.jsx)(qn,{groupFormat:e,style:Ym(this.props.isReady,this.props.groupFormat,this.props.isFullScreen,this.props.paddingLeft),disabled:s||!y.canConfigureBlock,schema:a,query:d,collectionContextStore:o,isInPeekRenderer:c,isFullScreen:t,showPropertyFormats:p.state,showHoverActionsStore:u,showRightActionsSpacer:!1}),(e||t)&&(0,je.jsx)("div",{style:{height:ra,width:0,marginBottom:e?br.y1:void 0}})]})}renderTableRows(e){const{store:t,schema:o,query:i,collectionContextStore:r,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,tableStore:c,paddingLeft:d}=this.props;if(!r.collectionViewStore())return;return r.groupsStore.getGroupState(e)?(0,je.jsx)(Wl,{store:t,format:a,schema:o,query:i,collectionContextStore:r,minWidth:void 0,blockPropertyValueOverlayStore:n,showPropertyFormats:s.state,disabled:!l,disableHorizontalEdgeScroll:!0,groupFormat:e,render:this.renderGroupResults,tableStore:c,paddingLeft:d}):void 0}renderEmptyTablePlaceholder(){const{canEdit:e}=this.props;return(0,je.jsx)(xo.Z,{onClick:this.handleAddRowClick,onMouseDown:ue.$0,disabled:!e,style:{display:"flex",alignItems:"center",height:ia,width:"100%",paddingLeft:8,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:this.theme.contentBackground,left:0,right:0,borderBottom:`1px solid ${this.theme.tableDividerColor}`},children:e?(0,je.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,je.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}renderLoadMoreButton(){const{collectionContextStore:e,format:t,canEdit:o}=this.props,i=this.groupsPointer();if(!e.groupsStore.getGroupState(i))return;const r=$t({collectionContextStore:e,groupsPointer:i});return(0,je.jsxs)(xo.Z,{onMouseDown:ue.$0,onClick:e=>function(e,t,o,i,r){const n=t.groupsStore.getGroupState(o);if(!n)return;const s=n.reducerResultStore.state;(0,ue.Wi)(e),K.ZH(r),s&&A.ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:i,currentResultCount:s.blockIds.length,groupsPointer:n.groupsPointer,incrementLimitsInRelatedGroups:!1}});F.uD(r)}(e,this.props.collectionContextStore,this.props.groupFormat,this.props.isFullScreen,this.environment),disabled:r,hoveredStyle:r?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:ia+1,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,borderBottom:`1px solid ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,Si.M)(Jm(this.theme)),(0,je.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,je.jsx)(j.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),r?(0,je.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,je.jsx)(Ke.Z,{style:{width:12,height:12}})}):o&&(0,je.jsx)(Oi,{collectionContextStore:e,format:t})]})}renderTableAddRowButton(){return(0,je.jsxs)(xo.Z,{onClick:this.handleAddRowClick,style:(e=this.props.isInPeekRenderer,t=this.theme,{borderBottom:`1px solid ${t.tableDividerColor}`,display:"flex",alignItems:"center",height:ia,width:"100%",paddingLeft:8,fontSize:14,lineHeight:R.Z.lineHeight.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}),className:eo.tfM,onMouseDown:ue.$0,children:[(0,ae.R)(Jm(this.theme)),(0,je.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]});var e,t}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}}Um.displayName="TimelineTableGroupResults",Um.contextTypes={...li.wK,...s.w};const $m=(0,j.injectIntl)(Um);function qm(){}function Qm(e,t,o){const i=e.permissionScopes.state;return Boolean(t&&o&&!i.isSyncedCollection)}function Ym(e,t,o,i){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:i},...o&&!t&&{left:i}}}function Xm(e){let{groupFormat:t,store:o,format:i,schema:r,query:n,collectionContextStore:s,disabled:l,paddingBottom:a,isInPeekRenderer:d,blockPropertyValueOverlayStore:p,tableStore:u,showTablePropertyFormats:h,timelineState:m,isFullScreen:g,isRootChild:S}=e;window.__c={n:"TimelineTableGroupResultsHeaderRow"};const f=(0,c.VK)((()=>s.groupsStore.getGroupState(t)),[s,t]),y=(0,c.VK)((()=>s.permissionScopes.state),[s]),v=(0,c.VK)((()=>s.viewIsFlushToTopbar()),[s]);if(!f)return null;const C=Boolean(t);return(0,je.jsx)(dl,{store:o,format:i,schema:r,query:n,collectionContextStore:s,isInPeekRenderer:d,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:p,showPropertyFormats:h,showRightActions:!1,allowHidingTitle:!0,tableStore:u,formatKey:"timeline_table_properties",disabled:l||!y.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,br.vX)(C),paddingTop:C?0:br.Ne-br.pe,disableTopBorder:!v||C,disableCellRightBorder:!0,groupFormat:t,children:!C&&y.canConfigureBlock&&(0,je.jsx)(Rh,{isGrouped:!1,format:i,collectionContextStore:s,timelineState:m,isFullScreen:g,isRootChild:S})})}function Jm(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}class eg extends Ro.Z{constructor(){super(...arguments),this.widthEl=null,this.storeTypes={tableStore:In,hiddenGroupsVisible:d.default.createClass(!1),groupsReducerResultStore:d.default.createClass(void 0)},this.renderTableGroupHeader=e=>{const{format:t,collectionContextStore:o,isFullScreen:i,isRootChild:r}=this.props,n=o.permissionScopes.state;return(0,je.jsxs)(Dt,{...e,height:br.Zn-1,paddingTop:br.xd,toggleClosedMarginBottom:br.xd,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.tableDividerColor}`:void 0}}(e,this.theme),style:rg(e.index,this.props.collectionContextStore,this.theme),children:[0===e.index&&n.canConfigureBlock&&(0,je.jsx)(Rh,{isGrouped:!0,format:t,collectionContextStore:o,timelineState:this.timelineState,isFullScreen:i,isRootChild:r})," "]})},this.renderTableGroupResults=e=>{const{store:t,isFullScreen:o,schema:i,query:r,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,showHoverActionsStore:a,paddingBottom:c,isRootChild:d,disabled:p}=this.props,u=this.isReady.state,h=ig(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment);if(s.groupsStore.getGroupState(e))return(0,je.jsx)($m,{store:t,groupFormat:e,schema:i,query:r,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:this.showTablePropertyFormatsStore,showHoverActionsStore:a,tableStore:this.stores.tableStore,paddingLeft:h,paddingBottom:c,format:this.getCurrentFormat(),isFullScreen:o,isRootChild:d,isReady:u,canEdit:this.canEditCollectionTimeline(),disabled:p&&this.canEditCollectionTimeline()})},this.renderTimelineItemGroupResults=e=>{const{store:t,isFullScreen:o,schema:i,query:r,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,isRootChild:a,disabled:c}=this.props,d=this.isReady.state,p=ig(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment);return(0,je.jsx)(Hm,{store:t,groupFormat:e,schema:i,query:r,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTimelinePropertiesStore:this.showTimelinePropertiesStore,paddingLeft:p,format:this.getCurrentFormat(),isFullScreen:o,isRootChild:a,isReady:d,canEdit:this.canEditCollectionTimeline(),disabled:c,showTable:this.showTableStore.state,canEditTimelineItems:this.canEditTimelineItemsStore.state,scrollerLeftOffsetStore:this.scrollerLeftOffsetStore})},this.renderTimelineItemGroupHeader=e=>{if(this.showTableStore.state)return;const{collectionContextStore:t}=e,o=t.isCompactView.state,i=this.timelineState.outerSizeObserver.rect.state.width;return(0,je.jsx)("div",{style:{position:"sticky",left:0,width:i,height:br.Zn,zIndex:M.sL},children:(0,je.jsx)(Dt,{...e,style:{width:"100%",height:"100%",paddingLeft:this.props.isFullScreen?ig(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},getComputedStickyStyle:e=>function(e,t){return e?{background:t.contentBackground,boxShadow:`0 1px 0 ${t.tableDividerColor}`}:{background:"transparent",boxShadow:void 0}}(e&&!o,this.theme),preventToggleBackground:this.props.isInPeekRenderer})})},this.renderTimelineItemHiddenGroupsButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return(0,je.jsx)("div",{style:{width:"100%",height:34,display:"flex"},children:(0,je.jsx)(yr,{...e,style:{position:"sticky",left:t?ig(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):3,width:"max-content",paddingLeft:4,paddingRight:8}})})},this.renderTimelineAddGroupButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t,collectionContextStore:o}=this.props;return"collectionTypedView"!==o.contextType?(0,je.jsx)("div",{style:{width:"100%",height:wn+kn,display:"flex"},children:(0,je.jsx)(Vn,{...e,style:{position:"sticky",left:t?ig(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):3,width:"max-content",paddingLeft:4,paddingRight:8}})}):void 0},this.renderTimelineGroupsLoadMoreButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return(0,je.jsx)("div",{style:{width:"100%",height:38,display:"flex"},children:(0,je.jsx)(xr,{...e,style:{position:"sticky",left:t?ig(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):3,width:"max-content",paddingLeft:4,paddingRight:8}})})},this.renderRowDropzoneSelectableGroupResults=e=>{const{collectionContextStore:t,store:o,isFullScreen:i,format:r,disabled:n}=this.props;return(0,je.jsx)(sm,{store:o,groupFormat:e,collectionContextStore:t,isFullScreen:i,canEdit:this.canEditCollectionTimeline(),format:r,disabled:n&&this.canEditCollectionTimeline()})},this.handleHorizontalScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,savePreference:o}=e;if(!t)return;const i=t.scrollLeft,r=e.scrollLeft.state;this.environment.device.isIOS&&void 0!==r&&0===i&&r>br.lx?t.scrollLeft=r:(o&&o(),e.scrollLeft.setState(i),(0,br.rr)(this.environment)?this.resetWindowForScrollDebounced():this.resetWindowForScroll())},this.resetWindowForScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o}=e;if(!t)return;const i=e.zoomLevel.state,{startTimestamp:r,endTimestamp:n}=e.currentRange.state,s=t.scrollLeft,l=o.rect.state.width,a=(0,br.e$)(i,n-r),c=(0,br.al)(e);if(s<br.lx){const t=-(0,br.x2)(i,br.Ge);e.currentRange.setState({startTimestamp:r+t,endTimestamp:n+t}),Xu.Nf({timelineState:e,environment:this.environment,zoomLevel:i,centerTimestamp:c})}else if(s+l>a-br.lx){const t=(0,br.x2)(i,br.Ge);e.currentRange.setState({startTimestamp:r+t,endTimestamp:n+t}),Xu.Nf({timelineState:e,environment:this.environment,zoomLevel:i,centerTimestamp:c})}},this.resetWindowForScrollDebounced=w.Ds(this.resetWindowForScroll,200),this.handleWidthElMount=e=>{if(e){this.widthEl=e;const{timelineState:t}=this,{outerSizeObserver:o}=t;o.observe(e);const i=(0,he.xH)(e);i&&(t.horizontalScroller=i,(0,ai.lj)(i,"scroll",this.handleHorizontalScroll),this.scrollToCenteredTimestamp())}},this.handleTimelineElMount=e=>{if(e){const{timelineState:t}=this,{timelineSizeObserver:o}=t;o.observe(e)}},this.scrollToCenteredTimestamp=()=>{const{timelineState:e}=this,{startTimestamp:t,endTimestamp:o}=e.currentRange.state;Xu.KA({timelineState:e,centerTimestamp:(t+o)/2})},this.onGroupHeaderAddItem=(e,t,o)=>{!function(e,t,o,i,r){if(i.device.isMobile)oe._({environment:i,store:e,pageVisitSource:p.tY.Create});else{const{groupFormat:t}=o,n=t?[t]:[],s=r.groupsStore.getGroupState(n);ie.CH({environment:i,store:e,peekMode:re.kr(r.collectionViewStore()),resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:r,pageVisitSource:p.tY.Create})}}(e,0,o,this.environment,this.props.collectionContextStore)},this.showTablePropertyFormatsStore=this.createComputedStore((()=>this.getTimelineTableProperties().filter((e=>e.visible))),!0),this.tableWidthStore=this.createComputedStore((()=>this.showTableStore.state?this.showTablePropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0):0)),this.scrollerLeftOffsetStore=this.createComputedStore((()=>(0,br.xI)({environment:this.environment,paddingLeft:ig(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment),format:this.props.format,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild}))),this.scrollPixelWidthStore=this.createComputedStore((()=>{const{timelineState:e}=this,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:i}=e.currentRange.state;return(0,br.e$)(t,i-o)})),this.showTimelinePropertiesStore=this.createComputedStore((()=>{const{format:e}=this.props;return(e.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))})),this.showTableStore=this.createComputedStore((()=>{const{format:e,isFullScreen:t,isRootChild:o}=this.props;return(0,br.C1)({environment:this.environment,format:e,isFullScreen:t,isRootChild:o})})),this.canEditTimelineItemsStore=this.createComputedStore((()=>{const{query:e,schema:t}=this.props;return re.D2({query:e,schema:t})})),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getTimelineItemGroupStyle=e=>{const t=this.showTableStore.state,o=this.getGroupPaddingState(e);let i=0,r=0;return o.groupHeader&&t&&(i+=br.Zn-1),o.tableHeaderRow&&(i+=br.pe),o.tableEmptyRow&&(i+=ia),o.tableAggregationRow&&(r+=ra),o.hiddenGroupsButton&&t&&(r+=34),o.groupsLoadMoreButton&&t&&(r+=38),o.addGroupButton&&t&&(r+=wn+kn),o.groupPaddingBottom&&(r+=br.y1),o.extraGroupMarginBottom&&(r+=br.xd+1),{paddingTop:i,paddingBottom:r,minHeight:br.Zn,boxShadow:e.index>0&&(!t||o.tableHeaderRow)?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}},this.getRowDropzoneSelectableGroupStyle=e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=this.getGroupPaddingState(e);let o=0,i=0;return t.groupHeader&&(o+=br.Zn),t.tableHeaderRow&&(o+=br.pe),t.tableEmptyRow&&(o+=ia),t.addItemRow&&(i+=eh.Z),t.loadMoreButton&&(i+=33),t.tableAggregationRow&&(i+=ra),t.hiddenGroupsButton&&(i+=34),t.groupsLoadMoreButton&&(i+=38),t.groupPaddingBottom&&(i+=br.y1),t.extraGroupMarginBottom&&(i+=br.xd),t.addGroupButton&&(i+=wn+kn),t.dropZoneSelectableGroupExtraBottomPadding&&(i+=1),{paddingTop:o,paddingBottom:i}}}get registries(){return super.registries.concat(Ju.Z)}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.timelineState=(0,br.Gz)({isFullScreen:e.isFullScreen,isRootChild:e.isRootChild});const{collectionContextStore:t}=e,o=t.collectionViewStore();o&&Xu.j2({timelineState:this.timelineState,environment:this.environment,collectionViewStore:o,collectionContextStore:t})}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{timelineState:t}=this,{query:o,collectionContextStore:i}=e;Lo.Z.state&&t.hoveredItem.setState(void 0);const r=i.collectionStore();r&&!o.timeline_by&&r.isDefined()&&function(e,t,o){const{schema:i}=e,r=t.permissionScopes.state,n=t.collectionStore();if(!n)return;const s=t.collectionViewStore();if(!s||!r.canConfigureBlock)return;const l=(0,j.defineMessages)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});$.createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:o,perform:e=>{let t,a=re.HI(i);if(!a&&r.canConfigureCollection){a=(0,cd.ZP)();t={[a]:{name:Ne.default.formatMessage(l.date),type:"date"}}}de.Es({collectionViewStore:s,update:{timeline_by:a},transaction:e}),ho.sW({store:s,data:{type:"timeline"},transaction:e}),t&&de.xO({environment:o,collectionStore:n,update:t,transaction:e})}})}(e,this.props.collectionContextStore,this.environment)}didMountOrUpdate(){super.didMountOrUpdate();const e=this.timelineState,{collectionContextStore:t,isFullScreen:o,isRootChild:i}=this.props;F.iR(this.environment,(0,br.Ii)({environment:this.environment,collectionContextStore:t,timelineState:e,isFullScreen:o,isRootChild:i}));const r=e.drawState.state;if(null!=r&&r.tryToCompleteDrawnArrow){(0,br.H5)(t)&&$.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:this.environment,perform:r=>{Xu.$o({timelineState:e,environment:this.environment,transaction:r,collectionContextStore:t,isFullScreen:o,isRootChild:i})}})}}willUnmount(){super.willUnmount();const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o,timelineSizeObserver:i}=e;o.destroy(),i.destroy(),e.destroyed=!0,t&&(0,ai.ZV)(t,"scroll",this.handleHorizontalScroll)}customizeEdgeScrollRect(e){const t=this.scrollerLeftOffsetStore.state;return np.iL.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}addBlockToView(e){const{store:t,transaction:o}=e,{collectionContextStore:i}=this.props,r=i.collectionStore();if(r)return Xu.Fv({environment:this.environment,store:t,timelineState:this.timelineState,query:this.props.query,collectionStore:r,collectionContextStore:this.props.collectionContextStore,groupFormat:void 0,transaction:o})}renderPersisted(){const{store:e,isInPeekRenderer:t,paddingRight:o,isFullScreen:i,isRootChild:r,query:n,schema:s,format:l,collectionContextStore:a,disabled:c}=this.props,{timeline_by:d}=n;if(!d)return(0,je.jsx)(og,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom});const p=s[d];if(!p||!Se.Lt(p))return(0,je.jsx)(og,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom});const{timelineState:u}=this,h=this.scrollerLeftOffsetStore.state,m=this.showTableStore.state,g=ig(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment),S=re.az(a,i),f=l.collection_group_by,y=a.viewIsFlushToTopbar(),v=a.isCompactView.state,C=(0,ci.Z)((d=>(0,je.jsx)(Xi,{isFullScreen:i,renderEmitter:a.renderEmitter,children:(0,je.jsx)("div",{style:this.getStyle(m),className:eo.kDE,...d,children:(0,je.jsxs)(_t.Z,{store:e,analyticsName:"timeline",shouldShowHalo:!i&&!v,canSelect:!i,style:v?{height:"100%"}:{},children:[(0,je.jsx)(qh,{timelineState:u,isInPeekRenderer:this.props.isInPeekRenderer}),(0,je.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:br.Ne},ref:this.handleTimelineElMount,children:[f?this.renderTimelineItemGroups(f):this.renderTimelineItemGroupResults(void 0),(0,je.jsx)(gh,{timelineState:u,disabled:c,isReady:this.isReady.state,renderEmitter:a.renderEmitter,isFullScreen:i,isRootChild:r})]}),(0,je.jsx)(Bh,{isInPeekRenderer:t,timelineState:u,query:n,schema:s,scrollerLeftOffset:h,collectionContextStore:a,showTable:m}),(0,je.jsx)(bh,{timelineState:u,isInPeekRenderer:t,paddingLeft:g,paddingRight:!i&&r?8:o,format:l,scrollerLeftOffset:h,isFullScreen:i,isRootChild:r,showTable:m,collectionContextStore:a,isReady:this.isReady.state}),m&&this.renderTable(f,g),(0,je.jsx)("div",{style:{paddingTop:br.Ne,pointerEvents:"none"},children:f?this.renderRowDropzoneSelectableGroups(f):(0,je.jsx)("div",{style:this.getRowDropzoneSelectableGroupStyle(void 0),children:this.renderRowDropzoneSelectableGroupResults(void 0)})}),!S&&(0,je.jsx)($r.Z,{onChange:e=>function(e,t,o,i){const r=o.isLoading.state,n=o.groupsStore.getGroupState([]);if(!n)return;const s=n.reducerResultStore.state;e<oo.Z.incrementScrollOffset&&s&&!r&&s.hasMore&&A.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})})})));return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{ref:this.handleWidthElMount}),!y&&(0,je.jsx)("div",{style:{height:4}}),C]})}renderTable(e,t){const{store:o,isFullScreen:i,collectionContextStore:r}=this.props;return(0,je.jsx)("div",{style:{position:"sticky",left:0,height:0,width:this.tableWidthStore.state,zIndex:M.eU},children:(0,je.jsx)(_t.Z,{style:this.getTableSelectableStyle(t),store:o,shouldShowHalo:!1,canSelect:!i,analyticsName:"timeline",children:e?this.renderTableGroups(e):(0,je.jsx)(Xi,{isFullScreen:i,ignoreAncestorContainer:!0,renderEmitter:r.renderEmitter,children:(0,je.jsx)("div",{children:this.renderTableGroupResults(void 0)})})})})}renderTableGroups(e){const{store:t,format:o,collectionContextStore:i,schema:r,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,be.hJ)()?(0,je.jsx)(zr,{type:"timeline_table_groups",store:t,collectionContextStore:i,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderTableGroupResults,getGroupStyle:()=>({}),renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:this.onGroupHeaderAddItem}):(0,je.jsx)(Mn,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:te.Uh,groupAggregationKey:te.dQ,format:o,schema:r,collectionContextStore:i,disabled:n,isFullScreen:s,renderGroup:this.renderTableGroupResults,renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:this.onGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,ignoreAncestorStickyContainer:!0,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!1})}renderTimelineItemGroups(e){const{store:t,format:o,collectionContextStore:i,schema:r,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,be.hJ)()?(0,je.jsx)(zr,{type:"timeline_item_groups",store:t,collectionContextStore:i,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderTimelineItemGroupResults,getGroupStyle:this.getTimelineItemGroupStyle,renderHeader:this.renderTimelineItemGroupHeader,onGroupHeaderAddItem:this.onGroupHeaderAddItem}):(0,je.jsx)(Mn,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:te.Uh,groupAggregationKey:te.dQ,format:o,schema:r,collectionContextStore:i,disabled:n,isFullScreen:s,renderGroup:this.renderTimelineItemGroupResults,onGroupHeaderAddItem:this.onGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:this.renderTimelineItemGroupHeader,getGroupStyle:this.getTimelineItemGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,renderHiddenGroupsButton:this.renderTimelineItemHiddenGroupsButton,renderAddGroupButton:this.renderTimelineAddGroupButton,renderGroupsLoadMoreButton:this.renderTimelineGroupsLoadMoreButton,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!0})}renderRowDropzoneSelectableGroups(e){const{store:t,format:o,collectionContextStore:i,schema:r,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,be.hJ)()?(0,je.jsx)(zr,{type:"timeline_dropzone_groups",store:t,collectionContextStore:i,disabled:n,isFullScreen:s,isRootChild:a,paddingLeft:l,stickyLeft:!1,renderGroup:this.renderRowDropzoneSelectableGroupResults,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,renderHeader:()=>null,onGroupHeaderAddItem:this.onGroupHeaderAddItem}):(0,je.jsx)(Mn,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:te.Uh,groupAggregationKey:te.dQ,format:o,schema:r,collectionContextStore:i,disabled:n,isFullScreen:s,renderGroup:this.renderRowDropzoneSelectableGroupResults,onGroupHeaderAddItem:this.onGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:()=>null,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,renderHiddenGroupsButton:()=>null,renderAddGroupButton:()=>null,renderGroupsLoadMoreButton:()=>null,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!0})}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.stores.tableStore.state;return t||e}getTimelineTableProperties(){const e=this.getCurrentFormat();return e&&e.timeline_table_properties?e.timeline_table_properties:[]}canEditCollectionTimeline(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&e.canEditContent&&!e.isSyncedCollection}getGroupPaddingState(e){const{groupFormat:t,currentGroups:o,visibleGroups:i,hiddenGroups:r,total:n}=e,{collectionContextStore:s,isFullScreen:l,disabled:a,format:c}=this.props,{hiddenGroupsVisible:d}=this.stores,p=c.collection_group_by,u=this.showTableStore.state,h=s.groupsStore.getGroupState(t),m=Boolean(t&&!(null!=h&&h.toggleStateStore.state)),g=function(e,t,o,i){if(!e)return!0;const r=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<r){const t=i.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(t,m,o,this.props.collectionContextStore),S=null==h?void 0:h.reducerResultStore.state,f=re.VM({collectionContextStore:s,reducerResult:S,isFullScreen:l}),y=t===r[r.length-1],v=t===i[i.length-1],C=i.length<n,x=d.state?y:v,b=s.permissionScopes.state,w=x&&!a&&b.canConfigureBlock&&p&&(0,te.Wz)(p,b.canConfigureCollection),k=S&&0===S.blockIds.length;return{groupHeader:Boolean(t&&(!u||!g)),tableHeaderRow:Boolean(u&&!m&&!g),tableAggregationRow:Boolean(u&&!m),addItemRow:Boolean(this.canEditCollectionTimeline()&&!m),hiddenGroupsButton:Boolean(v&&r.length>0),groupsLoadMoreButton:Boolean(v&&C),loadMoreButton:Boolean(!m&&f),groupPaddingBottom:Boolean(!m),tableEmptyRow:Boolean(u&&!m&&k),extraGroupMarginBottom:Boolean(u&&m),addGroupButton:Boolean(w),dropZoneSelectableGroupExtraBottomPadding:Boolean(!u)}}getStyle(e){const{isFullScreen:t,paddingBottom:o,collectionContextStore:i}=this.props,r=this.scrollPixelWidthStore.state,n=this.isReady.state,s=i.isCompactView.state;return{position:"relative",float:"left",minWidth:"100%",width:r,...s?{}:{background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground},...!t&&!e&&{borderBottom:`1px solid ${this.theme.tableDividerColor}`},...!n&&{minHeight:150},...t&&{paddingBottom:o},height:s?"100%":this.getComputedOuterHeight()}}getTableSelectableStyle(e){const{collectionContextStore:t}=this.props,o=t.isCompactView.state;return{whiteSpace:"nowrap",...o?{}:{background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground},paddingLeft:e,borderRight:`1px solid ${this.theme.tableDividerColor}`,boxShadow:this.theme.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:this.tableWidthStore.state+e+1,height:o?"100%":this.getComputedOuterHeight()}}getComputedOuterHeight(){const{device:e}=this.environment,{paddingBottom:t,isFullScreen:o}=this.props,{timelineSizeObserver:i}=this.timelineState,r=i.rect.state.height||120,n=this.showTableStore.state;return r+t+(o?0:72)+(!o&&n?28:0)+(o&&e.isMobile?72:0)}}eg.displayName="CollectionTimelineView";const tg=eg;function og(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:i}=e;window.__c={n:"MissingDateProperty"};const r=(0,c.VK)((()=>t.permissionScopes.state.canConfigureBlock),[t]),n=t.settingsStore;return(0,je.jsx)(Fd,{collectionContextStore:t,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:r?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,je.jsx)(jd,{onClick:()=>{L.r$({collectionContextStore:t,collectionSettingsStore:n}),L.H4({collectionSettingsStore:n,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:i}})}function ig(e,t,o,i,r){return function(e,t,o,i){return(0,br.fj)({environment:i,isRootChild:e,isFullScreen:t,format:o})}(e,t,o,r)?br.Qw:i}function rg(e,t,o){const i=t.viewIsFlushToTopbar();return 0!==e||i?{borderTop:`1px solid ${o.tableDividerColor}`}:{}}var ng=o(74194),sg=o(14562),lg=o(61679),ag=o(22789),cg=o(31192),dg=o(95691),pg=o(96787),ug=o(77744),hg=o(19977),mg=o(45162),gg=o(82136),Sg=o(15201),fg=o(72711),yg=o(57819),vg=o(16772),Cg=o(97053),xg=o(55217);function bg(e){window.__c={n:"DocumentView"};const{store:t,disabled:o,paddingLeft:i,paddingRight:n,setRef:s}=e,l=(0,ne.O7)(),a=(0,c.VK)((()=>{const e=t.getFormat();return{pageFont:e.page_font,pageSmallText:e.page_small_text}}),[t]),d=(0,c.VK)((()=>(0,fa.CX)(t)),[t]),p=(0,Cg.Nr)(t),u=(0,c.VK)((()=>(0,fa.a_)(t)),[t]),h=(0,c.VK)((()=>t.isLocked()),[t]),{safePaddingLeft:m,safePaddingRight:g}=(0,c.VK)((()=>({safePaddingLeft:l.WindowSizeStore.getSafePaddingLeftCSS(i),safePaddingRight:l.WindowSizeStore.getSafePaddingRightCSS(n)})),[l.WindowSizeStore,i,n]),S=(0,c.VK)((()=>Boolean((0,yg.RR)(vg.default.state))),[]),f=(0,c.VK)((()=>t.getContentStore()),[t]),y=(0,c.VK)((()=>(0,cg.ww)(l.device)),[l.device]),v=d?e=>fg.og(e,t,l):void 0;function C(e,t){return(0,je.jsxs)("div",{style:e,ref:e=>{e&&s(e)},className:eo.QS0,onClick:t,children:[!u&&(0,je.jsx)(xg.Z,{store:f,emptyDroppableStyle:{width:"100%"},disabled:h||o}),p&&(0,je.jsx)(Ke.Z,{})]})}const x=(0,r.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{device:t}=l,o=a.pageFont||cg.em,i=cg.sL[o],r={},n={};let s;if(t.isMobile)s=t.isAndroid?cg.pE:cg.tb;else{s=a.pageSmallText?cg.Pc[o]||cg.ZY:cg.TE[o]||cg.jo}let c={},p={},u={};c={gridTemplateColumns:`${m} calc(100% - ${m} - ${g}) ${g}`},p=S?{paddingBottom:"600px"}:d?{paddingBottom:"15vh"}:{paddingBottom:0},u={...p,paddingLeft:e?0:m,paddingRight:e?0:g};const h=cg.VN[o],f=cg.n5[o]||1.5,y={flexShrink:0,flexGrow:1,display:"grid",gridTemplateColumns:"100%",maxWidth:"100%",width:"100%",...c},v={display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:i,fontSize:s,letterSpacing:h?`${h}em`:void 0,lineHeight:f,zIndex:M.ke,...p},C={flexShrink:0,flexGrow:1,maxWidth:"100%",display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:i,fontSize:s,letterSpacing:h?`${h}em`:void 0,lineHeight:f,width:"100%",zIndex:M.ke,...u};return{wrapper:y,leftPadding:r,body:v,rightPadding:n,nonIOSLayoutBody:C}}),[l,a.pageFont,a.pageSmallText,S,d,m,g])();return y?(0,je.jsxs)("div",{style:x.wrapper,children:[x.leftPadding&&(0,je.jsx)(Zn.p,{allowSelectionWithin:!1,style:x.leftPadding,onClick:v}),C(x.body,v),x.rightPadding&&(0,je.jsx)(Zn.p,{allowSelectionWithin:!1,style:x.rightPadding,onClick:v})]}):C(x.nonIOSLayoutBody,v)}const wg=r.memo(bg,Qt.Z);function kg(e){window.__c={n:"WikiHomeView"};const{store:t,style:o,canEdit:i,padding:n}=e,s=(0,ne.O7)(),l=(0,r.useRef)(null),a=(0,c.VK)((()=>t.isLocked()),[t]),d=(0,c.VK)((()=>Wc.fg(s,t)),[t,s]),p=(0,Cg.Bt)(),u=(0,r.useMemo)((()=>({width:(0,fa.du)(t,gg.S.CollectionPageView,s)})),[t,s]);let h=(0,je.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5,paddingBottom:p},children:[(0,je.jsx)(On.Z,{isVisible:!0,animationStyle:u,render:()=>(0,je.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:(0,je.jsx)(wg,{...e,...n,setRef:e=>{(0,ug.k$)(l,e)}})})}),!s.device.isMobile&&d&&(0,je.jsx)(hg.Z,{pageBlockStore:t,isVisible:d,context:gg.S.CollectionPageView,pageViewBlockAccessor:()=>l.current})]});return(0,mg.Aw)(s)&&(h=(0,je.jsx)(Sg.O,{displayName:"PageContent",style:o,disabled:!i||a,children:h})),h}class Pg extends d.default{getInitialState(){return{stage:"NOT_TRACKING"}}}function Tg(e){window.__c={n:"SetupInitialDatabaseItemsVisibleTracker"};const{collectionContextStore:t,parentMountTime:o}=e,{handleInitialDatabaseRender:i,handleItemMount:n}=function(e,t){const o=(0,ne.O7)(),i=(0,c.qz)(void 0,Pg),n=(0,r.useRef)(0),s=(0,r.useRef)(t),a=(0,r.useCallback)((()=>{"NOT_TRACKING"===i.state.stage&&i.setState({stage:"COUNTING_VISIBLE_ITEMS"})}),[i]),d=(0,r.useCallback)((()=>{if("COUNTING_VISIBLE_ITEMS"===i.state.stage&&(n.current++,1===n.current)){const e=performance.now();l.default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===i.state.stage&&i.setState({stage:"SHOULD_TRACK",endTime:e})}))}}),[i]),p=(0,r.useCallback)((t=>{if("SHOULD_TRACK"===t.state.stage){const i=pe.Pp({collectionContextStore:e,visibleItemsCount:n.current||0});hi.default.measureFromAppStart({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:o,data:i}),s.current&&hi.default.measure({metricName:"collections.initial_mount_to_items_visible",startTime:s.current,endTime:t.state.endTime},{environment:o,data:i}),t.reset(),n.current=0}}),[e,o]);return(0,r.useEffect)((()=>(i.addListener(p),()=>{i.removeListener(p)})),[p,i]),{handleInitialDatabaseRender:a,handleItemMount:d}}(t,o);return t.initialDatabaseItemsVisibleTracker||(t.initialDatabaseItemsVisibleTracker={handleInitialDatabaseRender:i,handleItemMount:n}),null}const Vg=["table","board"],Rg=["timeline"],Mg=180,jg=(0,j.defineMessages)({searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"},openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},openFullscreenPageButtonTooltip:{defaultMessage:"Open as full page",id:"database.collectionViewBlock.openFullscreenPageButton.tooltip"},filterIconButtonTooltip:{defaultMessage:"View and edit filters",id:"database.collectionViewBlock.filterIconButton.tooltip"},sortIconButtonTooltip:{defaultMessage:"View and edit sorts",id:"database.collectionViewBlock.sortIconButton.tooltip"}});class Fg{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let i=!0;this.didEmit||(this.didEmit=!0,i=!1),this.lastValue===t?i=!1:this.lastValue=t,i&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=Yc.ZP.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&Yc.ZP.removeListener(this.listener,this.environment)}}class _g extends Ro.Z{constructor(){super(...arguments),this.isCollectionViewBlock=!0,this.collectionContextStore=new oo.Z(this.environment),this.headerSizeObserver=new ac.E,this.headerEl=null,this.horizontalScrollerEl=null,this.resizeObserver=void 0,this.timelineViewRef=r.createRef(),this.automationsViewRef=r.createRef(),this.parentNode=void 0,this.renderStartTime=void 0,this.subscriptions=new Map,this.collectionTypeChangeSubscription=void 0,this.collectionRefetcher=new Mu(this.collectionContextStore,this.environment),this.syncStateTimeout=void 0,this.switchViewMetric=void 0,this.storeTypes={collectionContextStore:oo.Z,mouseStore:Mo.Z,headerMouseStore:Mo.Z,verticalScrollerStore:gt.Z,focusStore:d.default.createClass(!1),noDateResultStore:d.default.createClass(void 0),tasksResultStore:d.default.createClass(void 0),templateButtonPopupStore:Yt.Z,filterBarSettingsStore:d.default.createClass({open:!1,stack:[]}),createFilterButtonPopupStore:Yt.Z,createFilterSettingsStore:d.default.createClass({open:!1,stack:[]}),filterBarCreateFilterSettingsStore:d.default.createClass({open:!1,stack:[]}),createSortSettingsStore:d.default.createClass({open:!1,stack:[]}),viewSettingsPlacementStore:d.default.createClass(void 0),saveControlMoreActionsButtonPopupStore:Yt.Z},this.renderCreateFilterPopup=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores;return(0,je.jsx)(Y.P,{context:Xa.HV.TopbarFilterPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderCreateSortPopup=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;return(0,je.jsx)(Y.P,{context:Xa.HV.TopbarSortPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderViewSettings=()=>{const e=this.isInPeekRenderer(),t=(0,re.Ks)(this.props.store)?{paddingLeft:0,paddingRight:0}:this.leftRightPadding.state;if(t)return(0,je.jsx)(tc,{collectionContextStore:this.collectionContextStore,headerSizeObserver:this.headerSizeObserver,placementStore:this.stores.viewSettingsPlacementStore,isInPeekRenderer:e,overridePlacement:this.isHomeWidget.state?"popup":void 0,...t})},this.renderTemplatesPopup=()=>{const{collectionContextStore:e}=this,{store:t}=this.props,o=e.collectionStore();if(o){if(ed.Z.state.online){const i=e.permissionScopes.state;return(0,je.jsx)(Yu.Z,{isOverlay:!0,collectionStore:o,canConfigureCollection:i.canConfigureCollection,onEmptyPageClick:this.handleTemplateEmptyPageClick,onEmptyEnter:this.handleTemplateEmptyPageClick,onTemplateClick:this.handleTemplateClick,onCancelClick:this.handleTemplateCancelClick,locked:t.isLocked()})}return(0,je.jsx)("div",{style:{fontSize:14,color:this.theme.mediumTextColor,width:280,padding:8},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"})})}},this.renderNoDatePopup=e=>{const{collectionContextStore:t}=this,o=this.noDateTotal.state,i=t.collectionStore(),r=t.collectionViewStore(),n=this.getNoDateProperty();if(!i||!r||!n)return;const s=r.getType(),l=r.getName();return!r.isDefined()||"timeline"!==s&&"calendar"!==s?void 0:(0,je.jsx)(vu,{collectionStore:i,property:n,onClose:e.close,onAddPage:this.handleNoDateAddPage,collectionViewType:s,collectionViewName:l,collectionContextStore:t,noDateTotal:o})},this.handleRelativeVariableStaleStoreChange=async e=>{if(e.state){const e=this.collectionContextStore,t=e.collectionViewBlockStore(),o=e.collectionViewStore(),i=e.collectionStore();if(!t||!o||!i)return;await de.dj(this.environment,e,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}},this.handleViewAutomationSettingsClick=e=>{(0,ue.ZP)({event:e,context:ue.Af.CollectionAutomationSettingsClick,callback:this.handleViewAutomationSettingsClickInner})},this.handleViewAutomationSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.state.open,i=(0,Jc.n)(t);o&&"automationSettings"===(null==i?void 0:i.type)?L.E3({collectionSettingsStore:t}):(L.r$({collectionContextStore:e,collectionSettingsStore:t}),L.wl({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings"}}))},this.handleViewClick=e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:i}=e;if(t.id!==o.id&&!i){const e=t.getType(),i=o.getType();var r;if(e&&i)this.switchViewMetric={from:e,to:i,metric:hi.default.mark("collections.switch_view_lag"),sizeHintAtStart:null===(r=this.collectionContextStore.remoteResult.state)||void 0===r?void 0:r.sizeHint}}},this.handleFilterClick=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores,o=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0,i=e.currentPropertyFiltersStore.state,r=e.filtersBarOpenStore.state;this.isCompactView.state&&L.wl({collectionSettingsStore:e.settingsStore,item:{type:"filters"}}),r||i.length>0||o?e.filtersBarOpen.setState(!r):L.wl({collectionSettingsStore:t,item:{type:"createFilter"}}),_.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_filter"})},this.handleSortClick=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;this.hasSort.state?this.isCompactView.state?L.wl({collectionSettingsStore:e.settingsStore,item:{type:"sort"}}):(e.filtersBarOpen.setState(!0),L.wl({collectionSettingsStore:e.filterBarSortSettingsStore,item:{type:"sort"}})):L.wl({collectionSettingsStore:t,item:{type:"createSort"}}),_.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_sort"})},this.handleCreateFilterPopupDismiss=()=>{const{createFilterSettingsStore:e}=this.stores;L.E3({collectionSettingsStore:e})},this.handleCreateSortPopupDismiss=()=>{const{createSortSettingsStore:e}=this.stores;L.E3({collectionSettingsStore:e})},this.handleCollectionEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!1})},this.handleCollectionTypeChangeEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!0})},this.handlePageVisibilityChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("page_show")},this.handlePeekViewChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("exit_peek")},this.shouldQueueCollectionEmit=()=>{var e;return!nd.Z.state.isVisible||!(!Eo.default.isCenterPeekOpen()||null!==(e=Eo.default.peekTarget.state)&&void 0!==e&&e.uiContains(this.props.store))},this.shouldRefetch=()=>{if(!Eo.default.isCenterPeekOpen()&&nd.Z.state.isVisible)return!0},this.handleHeaderMount=e=>{e&&this.headerSizeObserver.observe(e),this.headerEl=e},this.handleHorizontalScrollerMount=e=>{var t,o;var i;(null==e||null===(t=e.scrollerEl())||void 0===t?void 0:t.classList.contains(eo.PBs))?this.horizontalScrollerEl=e:this.horizontalScrollerEl=(null==e||null===(i=e.context.scrollerContext)||void 0===i?void 0:i.horizontalScroller)||null;const r=this.collectionContextStore.collectionViewStore();this.resetFrozoneStore(r);const n=null===(o=this.horizontalScrollerEl)||void 0===o?void 0:o.scrollerEl();"undefined"!=typeof ResizeObserver&&n&&(this.resizeObserver=new ResizeObserver(this.handleHorizontalScrollerResizeDebounced),this.resizeObserver.observe(n))},this.handleHorizontalScrollerResize=()=>{var e,t;const o=null===(e=this.horizontalScrollerEl)||void 0===e||null===(e=e.scrollerEl())||void 0===e?void 0:e.getBoundingClientRect().width,i=this.collectionContextStore.frozoneStore.state.scrollerWidth,r=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.getBoundingClientRect().left,n=this.collectionContextStore.frozoneStore.state.scrollerLeftOffset;if(o===i&&r===n)return;if(this.isCompactView.state)return;const s=this.collectionContextStore.collectionViewStore(),l=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,scrollerWidth:o,scrollerLeftOffset:r,frozenIndex:null==s?void 0:s.getTableFrozenColumnIndex(o,l),tryShowHiddenFrozenColumn:!1})},this.handleHorizontalScrollerResizeDebounced=w.Ds(this.handleHorizontalScrollerResize,50),this.handleEditorMouseDown=e=>{const{device:t}=this.environment,{target:o}=e,i=this.getCurrentCollectionViewStore();if(!i||t.isMobile||!(o instanceof HTMLElement))return;const r=this.props.overrideViewType??i.getType();r&&(0,ue.ZP)({event:e,context:ue.Af.EditorMouseDown,callback:()=>{e.preventDefault(),G.AI({environment:this.environment,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===r||"table"===r})}})},this.handleEditorClick=(e,t)=>{(0,ue.ZP)({event:e,context:ue.Af.EditorClick,callback:()=>{if(this.isInPeekRenderer()||O.E5(this.environment),"page"===t&&!El.X9()){const{clientX:t,clientY:o,target:i}=e;l.default.afterNextFlush((()=>{$.createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:this.environment,perform:e=>{U.jh(this.environment,{x:t,y:o,target:i instanceof Element?i:void 0},e)}})}))}}})},this.handleScroll=e=>{var t,o;const i=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.scrollLeft,r=null===(o=this.leftRightPadding.state)||void 0===o?void 0:o.paddingLeft;if(void 0===i||void 0===r)return;const n=i>r;n!==this.collectionContextStore.frozoneStore.state.isScrolled&&(this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,isScrolled:n}),this.handleHorizontalScrollerResize())},this.handleFocusIn=e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,a.E)(t)&&this.stores.focusStore.setState(!0)},this.handleFocusOut=()=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=()=>{Lo.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleHeaderMouseMove=()=>{Lo.Z.state||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleLoadedStoreChange=()=>{if(!this.isLoadedStore.state||!this.componentIsMounted||this.collectionContextStore.wasCreatedThisSession.state||!this.isFullScreen())return;const e=this.environment.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const o=()=>{var e,o,i;return{...pe.vS(this.collectionContextStore),is_push:(null===(e=t)||void 0===e?void 0:e.isPush)??!1,collectionViewType:null===(o=this.collectionContextStore.collectionViewStore())||void 0===o?void 0:o.getType(),initial_route:this.environment.RouterStore.state.initialRoute.name,prefetchCache:null===(i=this.environment.prefetchCache)||void 0===i||null===(i=i.getPrefetchAnalytic("queryCollection"))||void 0===i?void 0:i.type,wasm_sqlite_initialized:id.Z.state.metricData.state.wasm_sqlite_initialized}};var r;id.Z.state.initialRenderCompleted?hi.default.measureAfterNextFlush("navigation_database_render",{environment:this.environment,getData:o}):(E.setInitialRenderCompleted(),hi.default.measureFromAppStartAfterNextFlush("initial_database_render",{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime&&hi.default.measureAfterNextFlush({metricName:"initial_database_render_from_component_mount",startTime:this.renderStartTime},{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime=void 0,null===(r=this.collectionContextStore.initialDatabaseItemsVisibleTracker)||void 0===r||r.handleInitialDatabaseRender(),i.vF.hackyOffsetParsesCorrectly()||$c.j(this.environment,"luxon_hacky_offset_parses_correctly_false"))},this.handleSearchButtonClick=()=>{this.collectionContextStore.searchOpen.setState(!0),_.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_search"})},this.handleSearchQueryChange=e=>{de.Ug({searchQuery:e.target.value,collectionContextStore:this.collectionContextStore,isFullScreen:Boolean(this.props.isFullScreen)}),F.ik(this.environment,{view_type:this.getCurrentViewType()})},this.handleSearchFocus=()=>{Oo.default.reset(),Go.default.reset()},this.handleSearchBlur=()=>{this.collectionContextStore.searchQuery.state||this.handleClearSearch()},this.handleSearchKeyDown=e=>{27===e.keyCode&&this.handleClearSearch()},this.handleClearSearch=()=>{this.collectionContextStore.searchQuery.setState(""),this.collectionContextStore.searchOpen.setState(!1)},this.handleAddItemClick=e=>{var t;if(!this.collectionContextStore.collectionViewBlockStore()||!(0,ge.M_)(this.environment))return;const o=this.isHomeWidget.state,i=this.isMultiSourceView.state,r=this.isMyTasksPage.state,n=this.collectionContextStore.isCompactView.state,s=r?n?"home_tile_tasks":"home_tasks":"cvb_add_item",l=null===(t=this.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.getType();$.createAndCommit({userAction:"CollectionViewBlock.handleAddItemClick",environment:this.environment,perform:t=>{de.NZ({store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,transaction:t,shouldCoerce:!0,showMoveTo:i,peekModeOverride:o?"center_peek":void 0,from:s,useCrdt:(0,io.SL)(e,"table"===l?"collection_table_view":"collection_non_table_view")})}}),_.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_new_item"}),this.projManagementTooltipTourAssignToSomeone()},this.handleTemplatesDropdownClick=()=>{_.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_templates_dropdown"})},this.handleTemplateClick=e=>{$.createAndCommit({userAction:"CollectionViewBlock.handleTemplateClick",environment:this.environment,perform:t=>{const o=de.NZ({transaction:t,store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,shouldCoerce:!1,from:"cvb_template",useCrdt:e.useCrdt});o&&Z.ob({title:"template",environment:this.environment,store:o,templateStore:e.templateStore,isKeyboard:e.isKeyboard,isCreateIn:!1,transaction:t,from:"collection_view_block"})}}),this.projManagementTooltipTourAssignToSomeone(),this.stores.templateButtonPopupStore.reset()},this.handleTemplateEmptyPageClick=()=>{$.createAndCommit({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",environment:this.environment,perform:e=>{de.NZ({transaction:e,store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,shouldCoerce:!1,from:"cvb_template_empty_page",useCrdt:!1})}}),this.stores.templateButtonPopupStore.reset()},this.handleTemplateCancelClick=()=>{this.stores.templateButtonPopupStore.reset()},this.handleSetSourceClick=()=>{const{collectionContextStore:e}=this,t=e.settingsStore;this.isPlaceholderExternalCollectionStore.state?L.NG({collectionSettingsStore:t}):(L.r$({collectionContextStore:e,collectionSettingsStore:t}),_.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_select_data_source"}))},this.handleNoDateAddPage=e=>{const{collectionContextStore:t}=this,o=this.getCollectionStore(),i=this.getCurrentCollectionViewStore(),r=this.timelineViewRef.current;if(!i||!o)return;if(!i.isDefined())return;const{performResult:n}=$.createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:this.environment,perform:n=>"calendar"===i.getType()?D.Fv({environment:this.environment,store:e,collectionStore:o,collectionContextStore:t,startDayOfWeek:wi.AK.state,results:this.getDefaultResults(),transaction:n}):r?r.addBlockToView({store:e,transaction:n}):void 0});n&&K.Z5({environment:this.environment,stores:[n]})},this.handleOpenAsPageClick=()=>{F.Ji(this.environment,{view_type:this.getCurrentViewType()})},this.handleNoDateButtonClick=()=>{_.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_no_date"})},this.initializeSyncStatePolling=async()=>{if(this.isSyncingStore.state){const e=this.getCollectionStore(),t=null==e?void 0:e.getFormat().uri,o=null==e?void 0:e.getFormat().bot_id,i=null==e?void 0:e.id;if(!t||!o||!i)return;await this.pollSyncState({uri:t,botId:o,collectionId:i})}},this.pollSyncState=async e=>{const t=await B.getExternalCollectionSyncState(this.environment,e);if("success"===t.type&&t.data.result){const o=t.data.result,i=this.collectionContextStore.numberChildrenReceived,r=this.collectionContextStore.numberChildrenUnfurled;i.setState(o.numberChildrenReceived),r.setState(o.numberChildrenUnfurled),r.state/i.state<1&&(this.syncStateTimeout=setTimeout((async()=>{await this.pollSyncState(e)}),1e4))}},this.resetCollectionSubscriptions=e=>{const t=Array.from(this.subscriptions.keys()),o=w.e5(t,e),i=w.e5(e,t);for(const n of o){var r;null===(r=this.subscriptions.get(n))||void 0===r||r.unsubscribe(),this.subscriptions.delete(n)}for(const n of i){const e=new Fg(this.environment,(0,k.jY)(n),this.handleCollectionEmit);e.subscribe(),this.subscriptions.set(n,e)}},this.subscribeToTypeChanges=()=>{const e=this.collectionContextStore.contextType,t=this.collectionContextStore.databaseType;if("collectionTypedView"!==e||!t||this.collectionTypeChangeSubscription)return;const o=new Fg(this.environment,(0,k.JY)({spaceId:this.props.store.getSpaceId(),databaseType:t}),this.handleCollectionTypeChangeEmit);o.subscribe(),this.collectionTypeChangeSubscription=o},this.isSyncingStore=this.createComputedStore((()=>{var e;const t=this.getCollectionStore(),o=null==t?void 0:t.isSyncedCollection(),i=!0===(null==t||null===(e=t.getFormat().sync_state)||void 0===e?void 0:e.syncing),r=this.environment.device.isMobile;return Boolean(o&&i&&!r)})),this.canShowPmIntroTooltipStore=this.createComputedStore((()=>{if(this.environment.device.isMobile)return!1;const e=Do.default.state.currentUserSettingsStore,t=Do.default.state.currentSpaceStore;if(!(0,Q.jH)(e,t)&&(!t||t.getCreatedTime()<Q.VL))return!1;if(!this.isTasksDB())return!1;if(this.props.store.pathIsDead())return!1;return!!this.collectionContextStore.permissionScopes.state.canEditContent&&(!!(0,Q.Z0)()&&Do.default.state.inAppCalloutStore.canShow("pm_intro_tooltip"))})),this.isMultiSourceView=this.createComputedStore((()=>"collectionTypedView"===this.collectionContextStore.contextType)),this.isHomeWidget=this.createComputedStore((()=>(0,wi.aT)(this.props.store.id,this.collectionContextStore.isInPeekRenderer.state))),this.isMyTasksPage=this.createComputedStore((()=>(0,wi.qG)(this.props.store.id))),this.isTasksEmpty=this.createComputedStore((()=>!!this.isMyTasksPage.state&&this.collectionContextStore.isEmptyStore.state)),this.isCompactView=this.createComputedStore((()=>this.collectionContextStore.isCompactView.state)),this.isTasksDB=()=>{const e=this.collectionContextStore.collectionViewBlockStore();return(null==e?void 0:e.getFormat().app_config_uri)===u.NB},this.shouldRestrictHeaderWidthForMarginComments=()=>this.isRootOrDirectChild()&&!(0,re._5)(this.props.store)&&this.marginCommentsVisible.state,this.shouldRenderOptions=()=>void 0!==this.collectionContextStore.collectionStore()||"collectionTypedView"===this.collectionContextStore.contextType,this.shouldRestrictWidthForMarginComments=this.createComputedStore((()=>{const e=this.getCurrentCollectionViewStore(),t=this.props.overrideViewType??(null==e?void 0:e.getType());return this.shouldRestrictHeaderWidthForMarginComments()&&t&&(re.bu.has(t)||"timeline"===t&&this.collectionContextStore.collectionStore()&&!(0,br.C1)({environment:this.environment,format:this.collectionContextStore.normalizedFormatStore.state,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild()}))})),this.isPlaceholderExternalCollectionStore=this.createComputedStore((()=>{const e=this.getCollectionStore();return!!e&&(0,m.OY)(e.getValue())})),this.getExternalIntegrationId=this.createComputedStore((()=>{const e=this.getCollectionStore();if(e)return e.getFormat().integration_id})),this.leftRightPadding=this.createComputedStore((()=>{var e;const{store:t,isFullScreen:o,overridePaddingLeft:i,overridePaddingRight:r,renderInLayoutEditorGrid:n}=this.props;if(n)return{paddingLeft:0,paddingRight:0};const s=(0,re.Bs)({environment:this.environment,store:t,isFullScreen:o,sizeObserver:this.headerSizeObserver,viewType:null===(e=this.collectionContextStore.collectionViewStore())||void 0===e?void 0:e.getType()});s&&void 0!==i&&(s.paddingLeft=i),s&&void 0!==r&&(s.paddingRight=r);const l=this.shouldRestrictWidthForMarginComments.state;return s&&l&&(s.paddingRight+=(0,Wc.gC)(this.environment,(0,re.en)(t),this.isInFrameWhenSidePeekOpen.state)),s})),this.isLoadedStore=this.createComputedStore((()=>this.collectionContextStore.isLoaded.state)),this.leftRightMargin=this.createComputedStore((()=>{if(!this.isRootOrDirectChild()||!this.marginCommentsVisible.state||!(0,re._5)(this.props.store)||this.props.store.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};const e=Wc.QB/2;return{marginLeft:e,marginRight:-e}})),this.noDateTotal=this.createComputedStore((()=>{if(this.noDateReducerStore.state){const e=this.stores.noDateResultStore.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}return 0})),this.noDateReducerStore=this.createComputedStore((()=>{const e=this.getNoDateProperty();if(e){return{type:"aggregation",aggregation:{property:e,aggregator:"empty"}}}})),this.hasTasksReducerStore=this.createComputedStore((()=>{if(this.isMyTasksPage.state){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}})),this.hasAppliedFilter=this.createComputedStore((()=>(0,vi.RL)({collectionContextStore:this.collectionContextStore,applySubitemFilter:!1}).length>0)),this.hasSort=this.createComputedStore((()=>{const{collectionContextStore:e}=this;return e.currentSortsStore.state.length>0})),this.showHoverActionsStore=this.createComputedStore((()=>{const{device:e}=this.environment,{mouseStore:t,headerMouseStore:o,focusStore:i,createSortSettingsStore:r,createFilterSettingsStore:n,filterBarCreateFilterSettingsStore:s,saveControlMoreActionsButtonPopupStore:l}=this.stores,{collectionContextStore:a}=this,c=this.isFullScreen(),d=i.state,p=a.settingsStore.state.open,u=a.searchOpen.state,h=r.state.open,m=n.state.open,g=s.state.open,S=a.filterBarSortSettingsStore.state.open,f=Array.from(a.filterBarItemSettingsStoreMap.values()),y=l.state.open,v=f.some((e=>e.state.open));return Boolean(t.state.mouseEntered||o.state.mouseEntered||d||c||this.shouldShowProjManagementTooltipTour()||e.isMobile||p||v||h||m||g||u||y||S)})),this.showCompactDesktopHeaderStore=this.createComputedStore((()=>{const{device:e}=this.environment,t=this.headerSizeObserver.rect.state;return!e.isMobile&&t.width&&t.width<400||this.isCompactView.state})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>(0,re.Ks)(this.props.store))),this.isInPeek=this.createComputedStore((()=>(0,re.en)(this.props.store))),this.shouldRenderCompactViewVerticalScroller=this.createComputedStore((()=>{const e=this.props.overrideViewType??this.getCurrentViewType();return!("collectionVirtualView"===this.collectionContextStore.contextType)&&this.isCompactView.state&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":return!0;case"calendar":return!1;default:return(0,dt.t1)(e)}}(e)}))}insertBlocks(e,t){const o=this.getCollectionStore();if(o)for(const i of e)A.mp({environment:this.environment,store:i,collectionStore:o,collectionContextStore:this.collectionContextStore,shouldCoerce:!0,groupsPointer:[],transaction:t});return[]}handleCreated(){K.ZH(this.environment),l.default.afterNextFlush((()=>{const{collectionContextStore:e}=this,t=e.collectionStore(),o=e.collectionViewBlockStore(),i=e.settingsStore;if(!o)return;const r=o.getCollectionViewSourceCollectionStore();if(this.isPlaceholderExternalCollectionStore.state)L.NG({collectionSettingsStore:i});else if(r)de.W1({environment:this.environment,collectionContextStore:e});else if(t)L.r$({collectionContextStore:e,collectionSettingsStore:i}),(0,X.V)({collectionStore:t,collectionContextStore:e,collectionSettingsStore:i});else{const t=td.default.checkGate("typed_db_creation");L.r$({collectionContextStore:e,collectionSettingsStore:i}),t?L.wl({collectionSettingsStore:i,item:{type:"createTypedDB"}}):L.wl({collectionSettingsStore:i,item:{type:"createViewSource"}})}}))}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.trackRenderTime({isFirstRender:!0}),this.collectionContextStore.isLoaded.addListener(this.handleLoadedStoreChange),this.handleLoadedStoreChange(),this.renderStartTime=performance.now()}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{store:t}=e,o=t.id,{collectionContextStore:i}=this,r=this.collectionContextStore.collectionViewStore(),n=this.collectionContextStore.collectionStore(),s=this.environment.currentUser.id,l=r?r.id:void 0,a=n?n.id:void 0,c=this.getViewStores().map((e=>e.id)),d=this.getDefaultCollectionViewStore(),p=b.Z.get({userId:s,key:oo.Z.getLocalViewPreferenceKey(o)});let u;if(e.viewId&&c.indexOf(e.viewId)>=0?u=e.viewId:r&&c.indexOf(r.id)>=0?u=r.id:p&&c.indexOf(p)>=0?u=p:d&&c.indexOf(d.id)>=0&&(u=d.id),u){const e=me.Xr.createChildStore(t,{table:T.n,id:u}),r=e.getCollectionStore(),n=!r||r.isDefined();e.isDefined()&&n&&(u!==p&&b.Z.set({userId:s,key:oo.Z.getLocalViewPreferenceKey(o),value:u}),(u!==l||r&&r.id!==a)&&de.mc({environment:this.environment,collectionViewBlockStore:t,collectionViewStore:e,collectionStore:r,collectionContextStore:i,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild(),isInPeekRenderer:this.isInPeekRenderer()}),void 0===i.frozoneStore.state.frozenIndex&&this.resetFrozoneStore(e))}const h=i.collectionStore();if(h){h.getTemplatePageStores().map((e=>e.getValue()))}this.isSyncingStore.addListener(this.initializeSyncStatePolling),this.ensureStoreListeners()}UNSAFE_willUpdate(){this.trackRenderTime({isFirstRender:!1})}didMount(){var e,t;super.didMount(),nd.Z.addListener(this.handlePageVisibilityChange),Eo.default.addListener(this.handlePeekViewChange),this.collectionContextStore.relativeVariablesAreStale.addListener(this.handleRelativeVariableStaleStoreChange);const o=this.collectionContextStore.collectionViewStore(),i=this.collectionContextStore.collectionStore();if(o&&i){const e=o.getType();e&&I.es(this.environment,{collection_id:i.id,collection_view_id:o.id,collection_view_block_id:this.props.store.id,type:e,is_full_screen:this.isFullScreen(),is_peek:this.isInPeekRenderer(),peek_mode:Eo.default.state.mode})}if(o&&"collectionTypedView"===this.collectionContextStore.contextType){const e=this.collectionContextStore.databaseType,t=o.getType();e&&t&&I.Wg(this.environment,{collection_view_id:o.id,collection_view_block_id:this.props.store.id,type:t,databaseType:e,is_my_tasks:(0,Xc.Ep)("myTasks")===this.props.store.id})}const r=this.collectionContextStore.sprintSettingsContextStore.state;W.Wu({environment:this.environment,sprintSettingsContext:r}),null===(e=(t=this.props).setCollectionContextStore)||void 0===e||e.call(t,this.collectionContextStore)}didMountOrUpdate(){var e,t;const o=this.getCollectionStore();o?this.resetCollectionSubscriptions([o.id]):this.resetCollectionSubscriptions(this.collectionContextStore.remoteCollectionIds.state);const i=this.collectionContextStore.frozoneStore.state.scrollerWidth,r=null===(e=this.collectionContextStore.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(i,this.collectionContextStore.normalizedFormatStore.state);var s;(void 0===r||this.isCompactView.state||this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,frozenIndex:r}),this.collectionContextStore.remoteCollectionIds.addListener((e=>this.resetCollectionSubscriptions(e.state))),this.subscribeToTypeChanges(),this.parentNode)||(this.parentNode=null===(s=n.findDOMNode(this))||void 0===s?void 0:s.parentElement,this.parentNode&&((0,ai.lj)(this.parentNode,"focusin",this.handleFocusIn),(0,ai.lj)(this.parentNode,"focusout",this.handleFocusOut),(0,ai.lj)(this.parentNode,"mousemove",this.handleMouseMove),(0,ai.lj)(this.parentNode,"mouseleave",this.handleMouseLeave)));const l=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.scrollerEl();l&&(0,ai.lj)(l,"scroll",this.handleScroll)}didUpdate(e){this.trackSwitchViewLag()}willUnmount(){var e,t;super.willUnmount();const{collectionContextStore:o}=this;de.ob({collectionContextStore:o}),this.unsubscribeAll(),this.headerSizeObserver.destroy(),nd.Z.removeListener(this.handlePageVisibilityChange),Eo.default.removeListener(this.handlePeekViewChange),this.collectionContextStore.isLoaded.removeListener(this.handleLoadedStoreChange),this.collectionContextStore.relativeVariablesAreStale.removeListener(this.handleRelativeVariableStaleStoreChange),this.parentNode&&((0,ai.ZV)(this.parentNode,"focusin",this.handleFocusIn),(0,ai.ZV)(this.parentNode,"focusout",this.handleFocusOut),(0,ai.ZV)(this.parentNode,"mousemove",this.handleMouseMove),(0,ai.ZV)(this.parentNode,"mouseleave",this.handleMouseLeave));const i=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();i&&(0,ai.ZV)(i,"scroll",this.handleScroll),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.isSyncingStore.removeListener(this.initializeSyncStatePolling),clearTimeout(this.syncStateTimeout)}renderPersisted(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=this.getCollectionStore(),i=e.normalizedSchemaStore.state,r=e.normalizedQueryStore.state,n=e.normalizedFormatStore.state,s=this.isFullScreen();if(!(t&&i&&r&&n))return;const l=this.props.overrideViewType??t.getType();if(!l)return;if(o&&!o.isDefined())return;if(this.isCollectionViewOfExternalCollectionWithoutExternalObjectId())return(0,je.jsx)(Ir.L1,{value:this.collectionContextStore,children:(0,je.jsx)(Zn.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,onClick:this.handleEditorClick,ref:this.handleHeaderMount,children:(0,je.jsx)(_t.Z,{store:this.props.store,shouldShowHoverMenu:!0,analyticsName:Dg(l),shouldShowHalo:!this.isFullScreen()&&!this.isCompactView.state,canSelect:!this.isFullScreen(),children:(0,je.jsx)(sg.Z,{store:this.props.store,style:{width:"auto"},disabled:!1})})})});const a=(0,Al.$3)(this.environment)-fa.zL,c=this.isInFrameWhenSidePeekOpen.state&&!this.props.isFullScreen&&!(0,re._5)(this.props.store)&&a>0&&!this.isHomeWidget.state,d=this.renderView(o,t,this.props.overrideViewType??l,i,r,n),p=this.isInPeek.state?mt.Z.X:(0,wi.p5)({environment:this.environment,isFullScreen:this.isFullScreen()}),u=this.props.renderInLayoutEditorGrid&&!Rg.includes(l)?d:(0,je.jsx)(St.Z,{type:p,className:eo.x9t,onMouseDown:this.handleEditorMouseDown,preventType:this.isInPeek.state||this.isHomeWidget.state?mt.Z.None:z.Q7(this.environment),onClick:e=>this.handleEditorClick(e,l),style:this.getScrollerStyle(l,n,c?a/2:void 0),ref:this.handleHorizontalScrollerMount,children:d}),h=(0,je.jsx)(yt,{children:u}),m={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state},g=s?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:{position:"sticky",height:0,left:0,zIndex:M.Nm},children:this.renderViewSettings()}),(0,je.jsx)(Zn.p,{allowSelectionWithin:!0,style:{...m,position:"relative"},children:u})]}):(0,je.jsx)(Zn.p,{allowSelectionWithin:!0,style:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state,...c&&{marginLeft:-a/2},height:"calc(100% - 40px)"},children:(0,je.jsxs)("div",{style:{position:"relative",height:"100%"},children:[this.shouldRenderCompactViewVerticalScroller.state?h:u,this.renderViewSettings()]})});return this.props.renderInLayoutEditorGrid?(0,je.jsxs)(Ir.L1,{value:this.collectionContextStore,children:[(0,je.jsx)(Ag,{}),(0,je.jsxs)(lg.cx,{children:[(0,je.jsxs)(lg.bU,{children:[this.renderMultiSelectToolbar(),this.renderHeader(l)]}),Vg.includes(l)?(0,je.jsx)(lg.i2,{children:g}):(0,je.jsx)(lg.bU,{children:g}),(0,je.jsxs)(lg.bU,{children:[this.renderBottomBorderForViewSettings(),(0,je.jsx)(Tg,{collectionContextStore:this.collectionContextStore,parentMountTime:this.renderStartTime})]})]})]}):(0,je.jsxs)(Ir.L1,{value:this.collectionContextStore,children:[(0,je.jsx)(Ag,{}),this.renderMultiSelectToolbar(),this.renderHeader(l),g,this.renderBottomBorderForViewSettings(),(0,je.jsx)(Tg,{collectionContextStore:this.collectionContextStore,parentMountTime:this.renderStartTime})]})}renderHeader(e){var t,o;const{device:i}=this.environment,{store:r,disableHoverMenu:n}=this.props,s=this.isFullScreen(),l=this.noDateReducerStore.state,a=this.hasTasksReducerStore.state,c=this.showHoverActionsStore.state,d=this.showCompactDesktopHeaderStore.state,p=this.leftRightPadding.state,u=(null===(t=this.collectionContextStore.collectionViewBlockStore())||void 0===t?void 0:t.isCollectionViewPageWithContent())&&"page"===(null===(o=this.collectionContextStore.collectionViewStore())||void 0===o?void 0:o.getType()),h=this.shouldShowProjManagementTooltipTour()?(0,je.jsx)(ju.Z,{store:r,origin:this.renderViewSettingsButton(),isFirstTooltip:!1,phase:"click_view_settings"}):this.renderViewSettingsButton();return(0,je.jsxs)(Zn.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,ref:this.handleHeaderMount,children:[p&&(0,je.jsxs)(_t.Z,{store:r,shouldShowCopyLinkButton:r.isLocked(),shouldShowHoverMenu:!n&&this.canEdit()&&!s,analyticsName:Dg(e),children:[i.isPhone?(0,je.jsxs)("div",{style:this.getHeaderStyle(),children:[this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,je.jsx)(On.Z,{isVisible:!0,animationStyle:{opacity:c?1:0},render:()=>(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[this.renderLoadingSpinner(),this.renderFullScreenButton(),h,this.renderAddItemButton()]})})]}):(0,je.jsxs)("div",{style:this.getHeaderStyle(),children:[this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,je.jsx)(On.Z,{isVisible:!0,animationStyle:{opacity:c?1:0},render:()=>(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:2},children:[this.renderLoadingSpinner(),!d&&this.renderLockIndicator(),!d&&this.renderNoDateButton(),"page"!==e&&this.renderFilterButton(),"page"!==e&&this.renderSortButton(),this.renderAutomationSettingsButton(),!d&&"page"!==e&&this.renderSearch(),u&&this.renderPageViewSearch(),this.renderFullScreenButton(),h,this.renderAddItemButton()]})})]}),a&&(0,je.jsx)(He.Z,{id:"tasks_results",collectionContextStore:this.collectionContextStore,reducer:a,resultStore:this.stores.tasksResultStore}),l&&(0,je.jsx)(He.Z,{id:"no_date_count",collectionContextStore:this.collectionContextStore,reducer:l,resultStore:this.stores.noDateResultStore})]}),(0,je.jsxs)("div",{style:this.getHeaderPositioningStyle(),children:[this.renderSource(),this.renderFilterBar()]})]})}renderLockIndicator(){const{device:e}=this.environment,{store:t}=this.props;if(!this.isFullScreen()&&!e.isPhone&&t.canEditCollection())return(0,je.jsx)(ag.Z,{store:t,isMobile:!1,isInlineCollection:!0,disableTooltip:!0,buttonStyle:{marginLeft:4,marginRight:4}})}renderViewTabBar(){return(0,je.jsx)(Oc,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,isPlaceholderExternalCollectionStore:this.isPlaceholderExternalCollectionStore,onViewClick:this.handleViewClick,disabled:this.props.hideHeader||this.isHomeWidget.state})}renderFullScreenButton(){const{store:e}=this.props;if(this.isFullScreen())return;const t=(0,_o.ZP)({store:e,fullyQualified:!1,pageVisitSource:p.tY.Expand}),o=Ne.default.formatMessage(jg.openFullscreenPageButtonTooltip);return(0,je.jsx)(Je.ZP,{renderTooltip:()=>o,render:e=>(0,je.jsx)(Ft.Z,{ariaLabel:o,href:t,onClick:this.handleOpenAsPageClick,icon:v.Z,style:{...this.getTopbarIconButtonStyle()},iconStyle:{fill:this.getTopbarIconButtonStyle().fill,width:16},...e})})}renderAutomationSettingsButton(){const{collectionContextStore:e,automationsViewRef:t}=this,o=this.getCurrentCollectionViewStore(),i=this.props.overrideViewType??(null==o?void 0:o.getType()),r=e.settingsStore,n=r.state.open,s=(0,Jc.n)(r),l=(0,h.Cf)({tab:s}),a=e.aliveAutomationCount.state;if("page"===i||this.isPlaceholderExternalCollectionStore.state||!(0,Qc.cB)(e))return;const c=a>0;return(0,je.jsx)(Je.ZP,{renderTooltip:()=>Ne.default.formatMessage(jg.openAutomationsSettingsButtonTooltip),render:e=>(0,je.jsx)(Ft.Z,{ariaLabel:Ne.default.formatMessage(jg.openAutomationsSettingsButtonAriaLabel),className:eo.RIA,icon:g.K,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:14,fill:c?this.theme.icon.uiBluePrimary:this.theme.mediumTextColor},hovered:n&&l,onClick:this.handleViewAutomationSettingsClick,ref:t,...e})})}renderViewSettingsButton(){return this.isPlaceholderExternalCollectionStore.state?null:(0,je.jsx)(Ol.LazyCollectionViewSettingsButton,{collectionContextStore:this.collectionContextStore,style:this.getTopbarIconButtonStyle()})}renderFilterButton(){const{device:e}=this.environment,{createFilterSettingsStore:t}=this.stores;if(this.shouldRenderOptions()&&!this.isPlaceholderExternalCollectionStore.state)return(0,je.jsx)(Xe.ZP,{popupType:e.isMobile?Qe.Z4.SlideUp:Qe.Z4.Popup,open:t.state.open,origin:this.renderFilterButtonOrigin(),onDismiss:this.handleCreateFilterPopupDismiss,originGap:4,render:this.renderCreateFilterPopup})}renderFilterButtonOrigin(){const e=this.hasAppliedFilter.state;if(this.showCompactDesktopHeaderStore.state){const t=Ne.default.formatMessage(jg.filterIconButtonTooltip),o=0===this.collectionContextStore.collectionStoresStore.state.length;return(0,je.jsx)(Je.ZP,{renderTooltip:()=>t,disableTooltip:o,render:i=>(0,je.jsx)(Ft.Z,{...i,disabled:o,ariaLabel:t,icon:f.Q,iconStyle:{width:14,height:void 0,fill:e?this.theme.icon.uiBluePrimary:this.theme.mediumIconColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleFilterClick})})}return(0,je.jsx)(Ye.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleFilterClick,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"})})}renderSortButton(){const{device:e}=this.environment;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const{createSortSettingsStore:t}=this.stores;return(0,je.jsx)(Xe.ZP,{popupType:e.isMobile?Qe.Z4.SlideUp:Qe.Z4.Popup,open:t.state.open,origin:this.renderSortButtonOrigin(),onDismiss:this.handleCreateSortPopupDismiss,originGap:4,render:this.renderCreateSortPopup})}renderSortButtonOrigin(){const e=this.hasSort.state;if(this.showCompactDesktopHeaderStore.state){const t=Ne.default.formatMessage(jg.sortIconButtonTooltip),o=0===this.collectionContextStore.collectionStoresStore.state.length;return(0,je.jsx)(Je.ZP,{renderTooltip:()=>t,disableTooltip:o,render:i=>(0,je.jsx)(Ft.Z,{...i,disabled:o,ariaLabel:t,icon:x.j,iconStyle:{width:18,height:void 0,fill:e?this.theme.icon.uiBluePrimary:this.theme.mediumIconColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleSortClick})})}return(0,je.jsx)(Ye.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleSortClick,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"})})}renderSearch(){const{collectionContextStore:e}=this;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const t=e.searchOpen.state,o=e.searchQuery.state;return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ft.Z,{icon:S.e,iconStyle:{width:14,height:void 0,fill:this.theme.mediumTextColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleSearchButtonClick}),(0,je.jsx)(On.Z,{isVisible:t,animationStyle:{width:150,opacity:1},enterAnimationStyle:{width:0,opacity:0},exitAnimationStyle:{width:0,opacity:0},render:()=>(0,je.jsx)(Ya.Z,{capture:t,allowEsc:!0,render:e=>(0,je.jsx)("div",{...e,children:(0,je.jsx)("div",{style:{display:"flex",alignItems:"center",overflow:"hidden"},children:(0,je.jsx)(ng.Z,{style:this.getSearchInputStyle(),format:ng.B.Transparent,value:o,onChange:this.handleSearchQueryChange,placeholder:Ne.default.formatMessage(jg.searchInputPlaceholder),focusInitial:t,showClearButton:!0,onFocus:this.handleSearchFocus,onBlur:this.handleSearchBlur,onCancel:this.handleClearSearch,onClick:ue.Wi,onClearButtonClick:this.handleClearSearch,onKeyDown:this.handleSearchKeyDown})})})})})]})}renderPageViewSearch(){var e;const t=this.getCurrentCollectionViewStore();if("page"!==(null==t?void 0:t.getType()))return null;const o=null===(e=this.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return o?(0,je.jsxs)(Ye.Z,{style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:R.Z.fontWeight.medium,color:this.theme.mediumTextColor},onClick:()=>{H.Kf({environment:this.environment,analyticsFrom:"wiki-home-collection-view"}),ld.ZP.updateFilters({ancestors:[o]})},children:[(0,S.e)({width:14,fill:this.theme.mediumIconColor,marginRight:6}),(0,je.jsx)(j.FormattedMessage,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}renderAddItemButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore();if("page"===(this.props.overrideViewType??(null==t?void 0:t.getType()))||this.isPlaceholderExternalCollectionStore.state||!e.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return null;const o=(0,re.PI)(e),i={marginLeft:this.isCompactView.state?4:8,fontSize:14,height:this.isCompactView.state?24:28,...this.isCompactView.state?{marginRight:6,marginTop:4,width:24}:{}},r=this.isCompactView.state?{marginRight:0,marginLeft:-4,width:15}:{},n=e.collectionStoresStore.state,s=!n||0===n.length,l=this.isMultiSourceView.state,a=e=>(0,je.jsx)(dg.Z,{title:this.isCompactView.state?null:o,icon:this.isCompactView.state?C.f:void 0,color:"blue",onClick:this.handleAddItemClick,dropdownEvents:e,style:i,iconStyle:r,className:eo.sqL,disabled:s,disableDropdown:l});return(0,je.jsx)(Qe.ZP,{popupType:this.environment.device.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,render:this.renderTemplatesPopup,originGap:4,onClick:this.handleTemplatesDropdownClick,renderOrigin:e=>this.shouldShowProjManagementTooltipTour()?(0,je.jsx)(ju.Z,{store:this.props.store,origin:a(e),isFirstTooltip:!0,phase:"create_a_task"}):(0,je.jsx)(Je.ZP,{renderTooltip:()=>this.isCompactView.state?o:null,disableTooltip:s,render:t=>this.isCompactView.state?(0,je.jsx)("div",{...t,style:{marginLeft:4,marginRight:4},children:a(e)}):a(e)}),buttonPopupStore:this.stores.templateButtonPopupStore})}renderNoDateButton(){const e=this.noDateTotal.state,{collectionContextStore:t}=this,o=t.permissionScopes.state;if(t.collectionStore()&&0!==e&&o.canEditContent)return(0,je.jsx)(Qe.ZP,{popupType:this.environment.device.isMobile?Xe.kQ.SlideUp:Xe.kQ.Popup,render:this.renderNoDatePopup,onClick:this.handleNoDateButtonClick,renderOrigin:t=>(0,je.jsx)(Ye.Z,{isGray:!0,style:this.getTopbarActionButtonStyle(!1),...t,children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:e}})})})}renderFilterBar(){const{collectionContextStore:e}=this,t=e.filtersBarOpenStore.state,o=e.shouldShowSource.state?8:12,i=this.getCurrentCollectionViewStore();if("page"!==(this.props.overrideViewType??(null==i?void 0:i.getType()))&&!this.isCompactView.state){if(!t){if(!e.getCompleteSprintButtonContext.state)return;return(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:this.environment.device.isPhone?12:8,paddingTop:o},children:[(0,je.jsx)("div",{style:{flex:1}}),(0,je.jsx)(pg.Z,{collectionContextStore:e})]})}return(0,je.jsx)(_a.Z,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,createFilterSettingsStore:this.stores.filterBarCreateFilterSettingsStore,saveControlMoreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}}renderSource(){if(!this.isPlaceholderExternalCollectionStore.state)return this.collectionContextStore.shouldShowSource.state?(0,je.jsx)(xa,{store:this.props.store,collectionContextStore:this.collectionContextStore,isFullScreen:this.isFullScreen(),showHoverActionsStore:this.showHoverActionsStore,canEdit:this.canEdit()}):void 0}renderView(e,t,o,i,r,n){const{store:s}=this.props,{collectionContextStore:l}=this,a=!this.canEdit()||"collectionVirtualView"===l.contextType;"rendered"!==Do.default.state.renderPhase&&Do.default.setState({...Do.default.state,renderPhase:"rendered"});const c=this.isFullScreen(),d=this.isInPeekRenderer(),p=this.getBlockPropertyValueOverlayStore(),u=this.isRootOrDirectChild();let h=this.leftRightPadding.state;if(h){if(!e&&this.collectionContextStore.hasSingleCollection())return this.renderNoSourcePlaceholder(o);if(this.isPlaceholderExternalCollectionStore.state)return this.renderNoSourceExternalCollectionPlaceholder(o);if(this.isTasksEmpty.state)return(0,je.jsx)(Qu,{collectionContextStore:l,onAddTaskClick:this.handleAddItemClick,from:l.isCompactView.state?"home_tile_tasks":"home_tasks"});if("table"===o)return(0,je.jsx)(la,{schema:i,format:n,query:r,store:s,collectionContextStore:l,showHoverActionsStore:this.showHoverActionsStore,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:p,isRootChild:u,viewSettingsPlacementStore:this.stores.viewSettingsPlacementStore},t.id);if("board"===o)return(0,je.jsx)(Id,{schema:i,format:n,query:r,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:p,isRootChild:u},t.id);if("page"===o){const e=t.getFormat().page_pointer;if(!e)return;const o=this.createComputedStore((()=>s.id===e.id?s:me.G.createChildStore(s,{table:e.table,id:e.id}))),i=(0,wi.ui)(this.environment),r=o.state;if(!r.isCollectionView())return;const n=this.canEdit();return(0,je.jsx)(kg,{canEdit:n,disabled:this.props.store.isLocked()||this.props.disabled,padding:{paddingBottom:cg.ZP.paddingBottom(this.environment),paddingLeft:i,paddingRight:i},store:r,style:cg.d$})}return"calendar"===o?(0,je.jsx)(jp,{schema:i,format:n,query:r,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:p,isRootChild:u},t.id):"list"===o?(this.isInFrameWhenSidePeekOpen.state&&!this.isHomeWidget.state&&(h={...h,paddingRight:24}),(0,je.jsx)(ou,{schema:i,format:n,query:r,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:p,isRootChild:u},t.id)):"gallery"===o?(0,je.jsx)(en,{schema:i,format:n,query:r,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:p,isRootChild:u},t.id):"timeline"===o?(0,je.jsx)(tg,{schema:i,format:n,query:r,store:s,collectionContextStore:l,isFullScreen:c,isRootChild:u,isInPeekRenderer:d,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:p,showHoverActionsStore:this.showHoverActionsStore,ref:this.timelineViewRef,...h},t.id):void 0}}renderNoSourcePlaceholder(e){const t=this.isFullScreen(),o=this.collectionContextStore.permissionScopes.state;return(0,je.jsx)(Fd,{collectionContextStore:this.collectionContextStore,title:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:o.canConfigureBlock?(0,je.jsx)(j.FormattedMessage,{defaultMessage:"<button>Select a data source</button> to continue",id:"collectionViewBlock.setSourceButton.title",values:{button:e=>(0,je.jsx)(jd,{onClick:this.handleSetSourceClick,children:e})}}):void 0,icon:(0,y.u)({height:48,fill:this.theme.lightIconColor,margin:"0 auto"}),style:{...this.leftRightPadding.state,paddingBottom:t?void 0:this.getPaddingBottom(e)}})}renderNoSourceExternalCollectionPlaceholder(e){var t;const o=this.isFullScreen(),i=this.collectionContextStore.permissionScopes.state,r=this.collectionContextStore.settingsStore.state.open,n={display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},s=this.getExternalIntegrationId.state,l=od.Z.integrations.state.find((e=>e.id===s)),a=!(this.environment.device.isMobileBrowser&&this.isPlaceholderExternalCollectionStore.state&&!this.isUserAuthenticated());if(l)return(0,je.jsx)("div",{style:{...this.leftRightPadding.state,paddingTop:8,paddingBottom:o?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,je.jsxs)("div",{style:{paddingRight:r?J.nJ:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,je.jsx)(ko.Z,{icon:null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.getIcon(),size:48,disabled:!0,isEmptyPage:!1}),(0,je.jsx)("div",{style:{fontSize:17,fontWeight:R.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2},children:(0,je.jsx)(j.FormattedMessage,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:l.name}})}),i.canConfigureBlock&&(0,je.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:this.theme.lightTextColor},children:a&&(0,je.jsx)(j.FormattedMessage,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:l.name,button:e=>(0,je.jsx)(xo.Z,{style:n,onClick:this.handleSetSourceClick,children:e})}})})]})})}renderLoadingSpinner(){const e=this.collectionContextStore.shouldShowSpinner.state&&!this.isHomeWidget.state;return(0,je.jsx)(Uc.Z,{show:e,...re.Mq,render:e=>e?(0,je.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,je.jsx)(Ke.Z,{style:{width:14,height:14}})}):void 0},"loading-spinner")}renderBottomBorderForViewSettings(){const{collectionContextStore:e}=this;if(e.settingsStore.state.open&&"sidebar"===this.stores.viewSettingsPlacementStore.state)return(0,je.jsx)("div",{style:{...this.leftRightPadding.state,...this.leftRightMargin.state,borderTop:`1px solid ${this.theme.tableDividerColor}`,height:12}})}renderMultiSelectToolbar(){if((0,re.fk)({environment:this.environment,collectionContextStore:this.collectionContextStore})){var e;const t=(null===(e=this.leftRightPadding.state)||void 0===e?void 0:e.paddingLeft)??0,o=this.leftRightMargin.state.marginLeft??0;return(0,je.jsx)(Eu,{marginLeft:t+o})}}unsubscribeAll(){for(const e of this.subscriptions.values())e.unsubscribe();this.collectionTypeChangeSubscription&&this.collectionTypeChangeSubscription.unsubscribe()}resetFrozoneStore(e){var t,o;if(this.isCompactView.state)return;const i=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.stores.store.state.clientWidth,r=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({isScrolled:!1,scrollerWidth:i,scrollerLeftOffset:(null===(o=this.horizontalScrollerEl)||void 0===o||null===(o=o.stores.store.state.clientRect)||void 0===o?void 0:o.left)??0,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(i,r),tryShowHiddenFrozenColumn:!1})}isCollectionViewOfExternalCollectionWithoutExternalObjectId(){var e;const t=null===(e=this.getCollectionStore())||void 0===e?void 0:e.getValue();return Boolean(t&&(0,m.Ev)(t))}isUserAuthenticated(){const e=this.collectionContextStore.collectionStore();if(!e)return!1;const t=e.getFormat().integration_id,o=od.Z.integrations.state.find((e=>e.id===t));return!(!t||!o)&&(0,qc.NP)(t).length>0}getViewStores(){const{store:e}=this.props;return e.getCollectionViewStores()}getCurrentCollectionViewStore(){return this.collectionContextStore.collectionViewStore()}getDefaultCollectionViewStore(){var e;const t=this.getViewStores();if(null!==(e=t[0])&&void 0!==e&&e.isDefined())return t[0]}getCollectionStore(){return this.collectionContextStore.collectionStore()}getMinWidth(){const{store:e}=this.props,{device:t}=this.environment,o=t.isPhone,i=this.isFullScreen(),r=this.getCurrentViewType(),n=("gallery"===r||("calendar"===r||"list"===r)&&i)&&this.isInFrameWhenSidePeekOpen.state,s=(0,Al.ll)(this.environment,this.isInPeekRenderer()),l=Eo.default.state;return this.isHomeWidget.state?void 0:i||this.isRootOrDirectChild()?o?`calc(100% - ${2*(0,wi.ui)(this.environment)}px - ${s}px)`:this.isInPeekRenderer()?`calc(100% - ${2*Eo.PeekModePadding.horizontal[l.mode]}px - ${s}px)`:this.isInFrameWhenSidePeekOpen.state?(0,Al.$3)(this.environment)+(n?(0,Al.vJ)(this.environment):0):i?`calc(100% - ${2*(0,wi.CP)(this.environment)}px - ${s}px)`:(0,re._5)(e)?`calc(100% - ${2*(0,wi.ui)(this.environment)}px - ${s}px)`:fa.zL-2*(0,wi.ui)(this.environment)-s:`calc(100% - ${s}px)`}isInPeekRenderer(){return(0,re.en)(this.props.store)}getBlockPropertyValueOverlayStore(){return this.isInPeekRenderer()?sd.Z:rd.Z}resetLeftScrollAfterFlush(){l.default.afterNextFlush((()=>{var e;const t=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();if(t){t.scrollLeft=0;const e=he.xH(t);e&&(e.scrollLeft=0)}}))}isFullScreen(){return Boolean(this.props.isFullScreen)}getDefaultResults(){const e=this.collectionContextStore.localResultStore.state,t=this.getCollectionStore();if(t&&e&&"reducer"===e.type){const o=w.sE(e.reducerResults,(e=>"results"===e.type));if(o)return o.blockIds.map((e=>me.G.createChildStore(t,{id:e,table:P.iU})))}return[]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.c4({environment:this.environment,url:e})}getCurrentViewType(){var e;const{collectionContextStore:t}=this,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getNoDateProperty(){const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.normalizedQueryStore.state;if(!e||!t)return;const o=e.getType();return"timeline"===o&&t.timeline_by?t.timeline_by:"calendar"===o&&t.calendar_by?t.calendar_by:void 0}ensureStoreListeners(){const{collectionContextStore:e}=this,{store:t}=this.props;e.blockIsPrivateStore.state;for(const o of t.getCollectionViewStores())o.getValue()}getScrollerStyle(e,t,o){const{store:i}=this.props,r=this.isFullScreen(),n=this.isRootOrDirectChild(),s=this.leftRightPadding.state,l=this.getPaddingBottom(e),a=this.collectionContextStore.settingsStore.state.open,c="collectionVirtualView"===this.collectionContextStore.contextType;return{flexGrow:1,flexShrink:0,...i.isLocked()&&{cursor:"default"},..."timeline"===e&&this.collectionContextStore.collectionStore()&&!r&&!(0,br.fj)({environment:this.environment,isFullScreen:r,isRootChild:n,format:t})&&s&&{marginLeft:s.paddingLeft,marginRight:s.paddingRight,marginBottom:l},...a&&!r&&"sidebar"===this.stores.viewSettingsPlacementStore.state&&{minHeight:J.j9},...this.isHomeWidget.state?{paddingRight:this.isMyTasksPage.state?8:void 0,height:this.shouldRenderCompactViewVerticalScroller.state||c?void 0:"100%"}:{},...this.isInFrameWhenSidePeekOpen.state&&"timeline"!==e&&!this.isHomeWidget.state?{position:"sticky",left:0,paddingLeft:void 0===this.collectionContextStore.frozoneStore.state.frozenIndex?0:o,width:(0,Al.$3)(this.environment)}:{},..."page"===e?{zIndex:M.y}:{}}}getPaddingBottom(e){return this.props.isFullScreen?"timeline"===e?96:Mg:"timeline"===e||"gallery"===e?0:bt.Z.state}getHeaderWrapStyle(){const{hideHeader:e}=this.props,t=this.leftRightPadding.state,o=(0,Al.$3)(this.environment),i=(0,re._5)(this.props.store)||this.isFullScreen()?o:Math.min(fa.zL,o),r=this.isInFrameWhenSidePeekOpen.state&&!Eo.default.isSidePeekOpening.state;return{minHeight:40,paddingLeft:null==t?void 0:t.paddingLeft,paddingRight:r?0:null==t?void 0:t.paddingRight,flexShrink:0,...(this.isFullScreen()||r)&&{position:"sticky",zIndex:86,left:0,width:r&&t?i-(t.paddingLeft/2??0):void 0},...this.props.store.isLocked()&&{cursor:"default"},...this.leftRightMargin.state,...e?{opacity:0,height:0,minHeight:void 0,pointerEvents:"none"}:{}}}getHeaderStyle(){const{collectionContextStore:e}=this,t=this.getCurrentViewType(),o=e.viewIsFlushToTopbar();return{display:"flex",alignItems:"center",height:40,boxShadow:("timeline"===t||"table"===t)&&o||this.isCompactView.state?void 0:`inset 0 -1px 0 ${this.theme.tableDividerColor}`,...this.getHeaderPositioningStyle()}}getHeaderPositioningStyle(){const e=this.leftRightPadding.state;return{left:null==e?void 0:e.paddingLeft,width:"100%"}}getSearchInputStyle(){return{fontSize:14,lineHeight:1,paddingRight:4,color:this.theme.regularTextColor,marginBottom:1}}getTopbarActionButtonStyle(e){return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:e?this.theme.blueColor:this.theme.mediumTextColor,fontWeight:R.Z.fontWeight.regular,lineHeight:1,borderRadius:4}}getTopbarIconButtonStyle(){return{display:"flex",alignItems:"center",fontSize:14,padding:6,...this.isHomeWidget.state?{height:24,width:24,color:this.theme.lightTextColor,fill:this.theme.lightIconColor}:{height:28,width:28,color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor},fontWeight:R.Z.fontWeight.regular,lineHeight:1,borderRadius:4}}shouldShowProjManagementTooltipTour(){return this.canShowPmIntroTooltipStore.state}projManagementTooltipTourAssignToSomeone(){const e=Do.default.state.currentUserSettingsStore,t=Do.default.state.currentSpaceStore;e&&t&&q.uR({environment:this.environment,requiredCurrPhase:"create_a_task",nextPhase:"assign_to_someone",currentUserSettingsStore:e,currentSpaceStore:t})}trackRenderTime(e){let{isFirstRender:t}=e;const o=hi.default.mark("collections.collection_view_block_render");hi.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>({...pe.vS(this.collectionContextStore),is_first_render:t})})}trackSwitchViewLag(){if(!this.switchViewMetric)return;const{from:e,to:t,metric:o,sizeHintAtStart:i}=this.switchViewMetric;hi.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>{const o=pe.vS(this.collectionContextStore),{view_type:r,row_count_category:n,...s}=o;return{from:e,to:t,did_trigger_fetch:this.collectionContextStore.isLoading.state,row_count_category:pe.ZO(i),...s}}}),this.switchViewMetric=void 0}}_g.displayName="CollectionViewBlock",_g.contextTypes={...li.wK,...s.w};class Ig extends s.Z{componentDidCatch(e){throw V.vd("collections"),e}renderComponent(){return(0,je.jsx)(_g,{...this.props})}}const Bg=_g;function Dg(e){return"page"===e?"page_view":e}function Ag(){window.__c={n:"KeyboardArea"};return(0,c.VK)((()=>td.default.checkGate("collection_subitem_nested_operations")),[])?(0,je.jsx)(Ua,{}):null}},22789:(e,t,o)=>{o.d(t,{Z:()=>k});o(67294);var i=o(83355),r=o(86628),n=o(24405),s=o(16184),l=o(47020),a=o(3123),c=o(58687),d=o(19889),p=o(7928),u=o(9291),h=o(50906),m=o(96802),g=o(82530),S=o(34700),f=o(92547),y=o(68373),v=o(64921),C=o(26388),x=o(85893);const b={width:16,marginRight:4};class w extends i.Z{constructor(){super(...arguments),this.storeTypes={lockStore:f.Z},this.handleLockClick=()=>{const{store:e}=this.props;g.createAndCommit({userAction:"PageLockTopbarIndicator.handleLockClick",environment:this.environment,perform:t=>{m.Wq({environment:this.environment,store:e,isLocked:!1,transaction:t})}}),this.stores.lockStore.setState({...this.stores.lockStore.state,justUnlocked:!0});const t=this.props.store.getType();if(t){var o;let i;e.isCollectionView()&&(i=e.getCollectionViewCollectionStore()),h.UJ(this.environment,{from:"topbar",block_type:t,locked:!1,collection_id:null===(o=i)||void 0===o?void 0:o.id})}},this.handleUnlockClick=()=>{const{store:e}=this.props;g.createAndCommit({userAction:"PageLockTopbarIndicator.handleUnlockClick",environment:this.environment,perform:t=>{m.Wq({environment:this.environment,store:e,isLocked:!0,transaction:t})}}),this.stores.lockStore.setState({...this.stores.lockStore.state,justUnlocked:!1});const t=this.props.store.getType();if(t){var o;let i;e.isCollectionView()&&(i=e.getCollectionViewCollectionStore()),h.UJ(this.environment,{from:"topbar",block_type:t,locked:!0,collection_id:null===(o=i)||void 0===o?void 0:o.id})}}}renderComponent(){return this.props.isMobile?this.renderMobile():this.renderDesktop()}renderDesktop(){return this.props.store.isLocked()?(0,x.jsx)(C.ZP,{renderTooltip:()=>(0,x.jsx)(T,{store:this.props.store}),disableTooltip:this.props.disableTooltip,render:e=>{return(0,x.jsxs)(v.Z,{style:(t=this.props.isMobile,o=this.environment,i=this.theme,r=this.props.isInlineCollection,n=this.props.buttonStyle,{...P(t,r,n),...(0,S.X)({noDrag:o.device.isElectronMac}),color:i.lightTextColor,fill:i.lightIconColor}),onClick:this.handleLockClick,...e,children:[(0,s.Q)(b),(0,x.jsx)("div",{style:{lineHeight:1},children:(0,x.jsx)(u.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]});var t,o,i,r,n}}):this.stores.lockStore.state.justUnlocked?(0,x.jsxs)(v.Z,{style:(e=this.props.isMobile,t=this.environment,o=this.theme,i=this.props.isInlineCollection,r=this.props.buttonStyle,{...P(e,i,r),...(0,S.X)({noDrag:t.device.isElectronMac}),paddingLeft:5,border:`1px solid ${o.blueColor}`,color:o.blueColor,fill:o.blueColor}),onClick:this.handleUnlockClick,hoveredStyle:{background:this.theme.outlineBlueButtonHoveredBackground},pressedStyle:{background:this.theme.outlineBlueButtonPressedBackground},children:[(0,c.H)(b),(0,x.jsx)("div",{style:{lineHeight:1},children:(0,x.jsx)(u.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]}):void 0;var e,t,o,i,r}renderMobile(){const{WindowSizeStore:e}=this.environment;return this.props.store.isLocked()?(0,x.jsxs)(v.Z,{onClick:this.handleLockClick,mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:e.getSafePaddingLeftCSS(10),paddingRight:e.getSafePaddingRightCSS(14)},children:[(0,l.B)({width:20,marginRight:6}),(0,x.jsx)("div",{children:(0,x.jsx)(u.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]}):this.stores.lockStore.state.justUnlocked?(0,x.jsxs)(v.Z,{onClick:this.handleUnlockClick,mobileFeedback:!0,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:e.getSafePaddingLeftCSS(10),paddingRight:e.getSafePaddingRightCSS(14),color:this.theme.blueColor,fill:this.theme.blueColor},children:[(0,a.j)({height:26,width:32,marginRight:6}),(0,x.jsx)("div",{children:(0,x.jsx)(u.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):void 0}}w.displayName="PageLockTopbarIndicator";const k=w;function P(e,t,o){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginRight:2,height:24,marginTop:e?1:0,marginLeft:e?0:-5,...t&&{marginLeft:e?8:12,marginRight:0},...o}}function T(e){let{store:t}=e;window.__c={n:"TooltipComponent"};const o=(0,n.Fg)(),i=(0,r.VK)((()=>t.getFormat().block_locked_by),[t]),s=(0,u.useIntl)(),l=(0,r.VK)((()=>i&&(0,p.Nz)(s,y.t1.createChildStore(t,{table:d.KJ,id:i}).getModel())),[i,s,t]);return i?(0,x.jsx)("div",{children:(0,x.jsx)(u.FormattedMessage,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,x.jsx)("b",{children:l}),br:(0,x.jsx)("br",{}),prompttext:e=>(0,x.jsx)("span",{style:{color:o.mediumInvertedTextColor},children:e})}})}):null}},71424:(e,t,o)=>{o.d(t,{EZ:()=>r,FD:()=>n,G5:()=>i,rK:()=>s});const i=220,r=24,n=-7,s=-3},34700:(e,t,o)=>{function i(e){return"drag"in e&&e.drag?{WebkitAppRegion:"drag"}:"noDrag"in e&&e.noDrag?{WebkitAppRegion:"no-drag"}:{}}o.d(t,{X:()=>i})},34232:(e,t,o)=>{o.d(t,{Z:()=>r});var i=o(67294);function r(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[n,s]=(0,i.useState)(r),l=(0,i.useRef)(null),a=(0,i.useRef)(null);return(0,i.useLayoutEffect)((()=>{null!==a.current&&window.clearTimeout(a.current),null!==l.current&&window.clearTimeout(l.current),a.current=null,l.current=null,e?0===t?s(!0):l.current=window.setTimeout((()=>{l.current=null,s(!0)}),t):0===o?s(!1):a.current=window.setTimeout((()=>{a.current=null,s(!1)}),o)}),[e,t,o]),n}},35599:(e,t,o)=>{o.d(t,{Z:()=>a});var i=o(67294),r=o(24405),n=o(86432),s=o(63143),l=o(77907);function a(e){window.__c={n:"CalendarDateIcon"};const t=(0,l.useDependency)(l.deps.calendarDateIcons),o=function(){const[e,t]=(0,i.useState)(new Date),o=(0,i.useRef)();return(0,i.useEffect)((()=>{const i=()=>{const o=new Date;o.getDate()!==e.getDate()&&t(o)},r=new Date,n=new Date(r);n.setHours(r.getHours()+1),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);const l=n.getTime()-r.getTime(),a=setTimeout((()=>{i(),o.current=window.setInterval(i,s.U6)}),l);return()=>{clearTimeout(a),clearInterval(o.current)}}),[e]),e}(),a=e.dateNumber??o.getDate(),c=(0,r.yK)((t=>({icon:{width:16,height:16,color:t.mediumIconColor,...e.style}})),[e.style]);return(0,i.useCallback)((e=>{if(e<1||e>31)return(0,n.s)(c.icon);if("resolved"!==t.status)return(0,n.s)(c.icon);const o=`calendarDate${e<10?`0${e}`:`${e}`}Icon`;return(0,t.value[o])(c.icon)}),[c,t])(a)}},14542:(e,t,o)=>{o.d(t,{EP:()=>s,LU:()=>l,NS:()=>n,SS:()=>r,ZP:()=>c});var i=o(49085);const r="loadingLocalImage",n="uploading",s="downloading",l="loaded";class a extends i.default{getInitialState(){return{loadingMode:l}}}const c=a},92547:(e,t,o)=>{o.d(t,{Z:()=>n});var i=o(49085);class r extends i.default{getInitialState(){return{justUnlocked:!1}}}const n=r},96809:(e,t,o)=>{o.d(t,{Z:()=>i});const i=new(o(14542).ZP)},55061:(e,t,o)=>{o.d(t,{$2:()=>ie,Bg:()=>te,P6:()=>_,Qs:()=>D,W9:()=>X,Wy:()=>Q,XW:()=>I,_2:()=>U,_u:()=>Y,c_:()=>J,gt:()=>W,iR:()=>N,jQ:()=>oe,kU:()=>$,oP:()=>L,pF:()=>ee,qJ:()=>F,rn:()=>O,sn:()=>Z,v4:()=>q,xS:()=>B});o(57658);var i=o(9291),r=o(66897),n=o(41432),s=o(15070),l=o(35011),a=o(99036),c=o(80951),d=o(40506),p=o(7057),u=o(6695),h=o(38297),m=o(22808),g=o(72126),S=o(59753),f=o(87479),y=o(82883),v=o(21202),C=o(77420),x=o(6287),b=o(15047),w=o(29369),k=o(19889),P=o(99108),T=o(97880),V=o(7928),R=o(63143),M=o(70693),j=o(4308);const F=(0,i.defineMessages)({defaultPluralizedUserNames:{defaultMessage:"Someone",id:"pushNotification.pluralizedUserNames.defaultLabel"},defaultPermissionGroupName:{defaultMessage:"Deleted group",id:"pushNotification.permissionGroupName.defaultLabel"},defaultPageName:{defaultMessage:"a Notion page",id:"pushNotification.pageName.defaultLabel"},untitledPermissionGroupName:{defaultMessage:"Untitled group",id:"pushNotification.permissionGroupName.untitledLabel"},userEditedPermissionGroup:{defaultMessage:"{userName} edited {permissionGroupName}",id:"pushNotification.userEditedTarget.label"},userDeletedPermissionGroup:{defaultMessage:"{userName} deleted {permissionGroupName}",id:"pushNotification.userDeletedTarget.label"},userCreatedPermissionGroup:{defaultMessage:"{userName} created {permissionGroupName}",id:"pushNotification.userCreatedTarget.label"},unknownAuthor:{defaultMessage:"Unknown author",id:"pushNotification.authorPhrase.unknown"},untitledSpaceName:{defaultMessage:"Untitled",id:"pushNotification.untitledSpaceName.label"},untitledTeamName:{defaultMessage:"Untitled",id:"pushNotification.untitledTeamName.label"},untitledCollectionName:{defaultMessage:"Untitled",id:"pushNotification.untitledCollectionName.placeholder"},untitledBlockTitle:{defaultMessage:"Untitled",id:"pushNotification.untitledBlockTitle.placeholder"},twoUserNames:{defaultMessage:"{firstAuthor} and {secondAuthor}",id:"pushNotification.twoUserNames.label"},threePlusUserNames:{defaultMessage:"{othersCount, plural, one {{firstAuthor} and {othersCount} other} other {{firstAuthor} and {othersCount} others}}",id:"pushNotification.threePlusUserNames.label"},editorPermissionLabel:{defaultMessage:"Full access",id:"pushNotifications.editorPermissionLevel.label"},readerPermissionLabel:{defaultMessage:"Read only",id:"pushNotifications.readerPermissionLevel.label"},editOnlyPermissionLabel:{defaultMessage:"Edit only",id:"pushNotifications.editOnlyPermissionLevel.label"},editPermissionLabel:{defaultMessage:"Edit",id:"pushNotifications.editPermissionLevel.label"},commentOnlyPermissionLabel:{defaultMessage:"Comment only",id:"pushNotifications.commentOnlyPermissionLevel.label"},noAccessPermissionLabel:{defaultMessage:"No access",id:"pushNotifications.noAccessPermissionLevel.label"},publicPermissionRoleLabel:{defaultMessage:"Public ({permissionLevel})",id:"pushNotifications.publicPermissions.label"},userNameWithRole:{defaultMessage:"{userName} ({permissionLevel})",id:"pushNotifications.userPermissionsWithRole.label"},botNameWithRole:{defaultMessage:"{botName} ({permissionLevel})",id:"pushNotifications.botPermissionsWithRole.label"},spaceNameWithRole:{defaultMessage:"{spaceName} ({permissionLevel})",id:"pushNotifications.spacePermissionsWithRole.label"},imageInPushNotification:{defaultMessage:"{imageEmoji} Image",id:"pushNotification.imageInPushNotification.placeholder"},topLevelBlockCreated:{defaultMessage:"{userName} created {targetName} in {spaceName}",id:"pushNotification.userCreatedBlockInSpace.message"},topLevelBlockDeleted:{defaultMessage:"{userName} deleted {targetName} in {spaceName}",id:"pushNotification.userDeletedBlockInSpace.message"},collectionRowCreated:{defaultMessage:"{userName} created {targetName} in {collectionName}",id:"pushNotification.userCreatedRowInCollection.message"},collectionRowDeleted:{defaultMessage:"{userName} deleted {targetName} in {collectionName}",id:"pushNotification.userDeletedRowInCollection.message"},emptyBlockEditedProperty:{defaultMessage:"Empty",id:"pushNotification.emptyBlockPropertyValueEdited.placeholderLabel"},propertyNameAndValueEdited:{defaultMessage:"{propertyName} ({propertyValue})",id:"pushNotification.propertyNameWithEditedValue.notificationSubject"},propertyNameAndValueNotificationBody:{defaultMessage:"{propertyName} ({propertyValue})",id:"pushNotification.propertyNameWithEditedValue.notificationBody"},blockDeletedEditBody:{defaultMessage:"[Deleted] {renderedBlock}",id:"pushNotification.deletedBlock.notificationContents"},blockEditedNotification:{defaultMessage:"{userName} edited {blockName}",id:"pushNotification.blockEdited.notificationSubject"},blockPropertyEditedNotification:{defaultMessage:"{userName} edited {blockName}",id:"pushNotification.blockPropertyEdited.notificationSubject"},mobileBlockPropertyEditedNotification:{defaultMessage:"{userName} edited",id:"pushNotification.mobileBlockPropertyEdited.notificationSubject"},userEditedPermissionsFor:{defaultMessage:"{userName} edited permissions for {targetName}",id:"pushNotifications.permissionsEditedForPageOrSpace.notificationSubject"},userMentionedIn:{defaultMessage:"{userName} mentioned you in {targetName}",id:"pushNotifications.userMentionedInPage.notificationSubject"},mobileUserMentionedIn:{defaultMessage:"{userName} mentioned you",id:"pushNotifications.mobileUserMentionedInPage.notificationSubject"},permissionGroupMentionedIn:{defaultMessage:"{userName} mentioned {groupName} in {targetName}",id:"pushNotifications.groupMentionedInPage.notificationSubject"},userDeletedComment:{defaultMessage:"[Deleted]💬 {commentText}",id:"pushNotifications.userDeletedCommentText.notificationContents"},userCommentedSubject:{defaultMessage:"{userName} commented in {targetName}",id:"pushNotifications.userCommentedSubject.notificationSubject"},mobileUserCommentedSubject:{defaultMessage:"{userName} commented",id:"pushNotifications.mobileUserCommentedSubject.notificationSubject"},userAddedToSpace:{defaultMessage:"{userName} added you to {workspaceName}",id:"pushNotifications.userAddedToSpace.notificationSubject"},userInvitedToSpace:{defaultMessage:"{userName} invited you to {workspaceName}",id:"pushNotifications.userInvitedToSpace.notificationSubject"},userInvitedToSpaceByBot:{defaultMessage:"You have been invited to {workspaceName}",id:"pushNotifications.userInvitedToSpaceByBot.notificationSubject"},userEditedCollectionSubject:{defaultMessage:"{userName} edited {collectionName}",id:"pushNotifications.collectionEdited.notificationSubject"},userCreatedCollectionSubject:{defaultMessage:"{userName} created {collectionName}",id:"pushNotifications.collectionCreated.notificationSubject"},collectionDescriptionDeleted:{defaultMessage:"{userName} deleted the description for {collectionName}",id:"pushNotifications.collectionDescriptionDeleted.notificationSubject"},collectionDescriptionCreated:{defaultMessage:"{userName} added a description for {collectionName}",id:"pushNotifications.collectionDescriptionAdded.notificationSubject"},untitledCollectionView:{defaultMessage:"Untitled",id:"pushNotifications.untitledCollection.label"},collectionViewEditedSubject:{defaultMessage:"{userName} edited view {collectionViewName} in {collectionName}",id:"pushNotifications.collectionViewEdited.notificationSubject"},collectionPropertyEditedUnknown:{defaultMessage:"Unknown",id:"pushNotifications.unknownCollectionPropertyName.label"},collectionPropertyEditedSubject:{defaultMessage:"{userName} edited property {propertyType} in {collectionName}",id:"pushNotifications.collectionPropertyEdited.subject"},reminderSubject:{defaultMessage:"Reminder in {pageName}",id:"pushNotifications.reminderChanged.subject"},pageLockedActivity:{defaultMessage:"{userName} locked {pageName}",id:"pushNotifications.pageLocked.subject"},pageUnlockedActivity:{defaultMessage:"{userName} unlocked {pageName}",id:"pushNotifications.pageUnlocked.subject"},emailEditedActivity:{defaultMessage:"{userName} edited their account settings",id:"pushNotifications.emailAccountSettingsEdited.subject"},emptyPropertyBody:{defaultMessage:"Empty",id:"pushNotifications.emptyPropertyValueInCollection.label"},unknownRelationValueChange:{defaultMessage:"Unknown",id:"pushNotifications.unknownRelationPropertyChanged.label"},unknownAuthorInPropertySchemaChange:{defaultMessage:"Unknown author",id:"pushNotifications.unknownAuthorUpdatedProperty.label"},accessRequestedSubject:{defaultMessage:"{userName} requested access to {pageName}",id:"pushNotifications.accessRequested.subject"},accessRequestResolvedApprovedSubject:{defaultMessage:"Your request to invite {guestEmail} to {pageName} has been approved",id:"pushNotifications.accessRequestResolved.approved.subject"},accessRequestResolvedRejectedSubject:{defaultMessage:"Your request to invite {guestEmail} to {pageName} has been rejected",id:"pushNotifications.accessRequestResolved.subject"},membershipRequestedSubject:{defaultMessage:"{userName} requested to add a new member to {workspaceName}",id:"pushNotifications.membershipRequested.subject"},guestInviteRequestedSubject:{defaultMessage:"{userName} requested to invite a guest to {workspaceName}",id:"pushNotifications.guestInviteRequested.subject"},blockFormatEditPageIconName:{defaultMessage:"Page Icon",id:"pushNotifications.formatChange.pageIcon.label"},pageIconImagePlaceholder:{defaultMessage:"Image",id:"pushNotifications.formatChange.pageIcon.imagePlaceholder"},pageDeletedActivity:{defaultMessage:"{userName} deleted {pageName}",id:"pushNotifications.pageDeleted.subject"},pageRestoredActivity:{defaultMessage:"{userName} restored {pageName}",id:"pushNotifications.pageRestored.subject"},pagePermanentlyDeletedActivity:{defaultMessage:"{userName} permanently deleted {pageName}",id:"pushNotifications.pagePermanentlyDeleted.subject"},userInvitedToTeam:{defaultMessage:"{userName} invited you to {teamName} team",id:"pushNotifications.userInvitedToTeam.notificationSubject"},privateContentTransferred:{defaultMessage:"{author} transferred private content from {fromUserName} to you: {pageName}",id:"pushNotifications.privateContentTransferred.notificationSubject"},verificationExpired:{defaultMessage:"Verification expired for {pageName}",id:"pushNotifications.verificationExpired.notificationSubject"},importSuccessful:{defaultMessage:"Your {importSource} import was successful",id:"pushNotifications.importCompleted.notificationSubject"},importFailed:{defaultMessage:"Your {importSource} import has failed",id:"pushNotifications.importFailed.notificationSubject"},exportCompleted:{defaultMessage:"Your workspace export is ready",id:"pushNotifications.exportCompleted.notificationSubject"}});function _(e){const{activity:t,getRecordValue:o}=e,i=t.getEdits();return g.oA((0,R.cf)(g.xH(i.map((e=>e.authors||[])))).map((e=>{const t=o(e);if(t)return(0,r.LU)({table:e.table,value:t})})))}function I(e,t){const o=e.map((e=>e?(0,r.$4)(t,e):t.formatMessage(F.unknownAuthor)));return function(e,t){if(1===t.length)return t[0];if(2===t.length)return e.formatMessage(F.twoUserNames,{firstAuthor:t[0],secondAuthor:t[1]});if(t.length>2){const o=t.length-1;return e.formatMessage(F.threePlusUserNames,{othersCount:o,firstAuthor:t[0]})}return e.formatMessage(F.defaultPluralizedUserNames)}(t,o)}function B(e){var t;if(g.xb(e))return;const o=e[0];var i;return o.table===k.KJ&&null!==(t=o.asActor)&&void 0!==t&&t.profile_photo?null===(i=o.asActor)||void 0===i?void 0:i.profile_photo:void 0}function D(e){if(!g.xb(e))return e[0].id}function A(e){const{blockValue:t,getRecordValue:o,userTimeZone:i,intl:r}=e,n=S.kk.fromBlock(t),s=S.om.fromGetRecordValueFn(o);return n.getRenderTitleWithEmoji({getRecordModel:s,placeholder:r.formatMessage(F.untitledBlockTitle),userTimeZone:i,intl:r})}function L(e){return E(e).title.replaceAll(/[\r\n]+/g," ")}function Z(e){const{activity:t}=e,o=t.navigable_block_id||t.top_level_block_id||t.collection_row_id;return o||(t.collection_id?t.collection_id:void 0)}function E(e){const{activity:t,getRecordValue:o,pageVisitSource:i,userTimeZone:r,intl:n}=e,s=S.om.fromGetRecordValueFn(o),l=t.navigable_block_id||t.top_level_block_id||t.collection_row_id;if(l){const a=o({table:v.iU,id:l,spaceId:t.space_id});if(a){return{url:S.kk.fromBlock(a).getRenderUrl({getRecordModel:s,baseUrl:e.baseURL,pageVisitSource:i}),title:A({intl:n,blockValue:a,getRecordValue:o,userTimeZone:r})}}return{url:e.baseURL||"/",title:n.formatMessage(F.untitledBlockTitle)}}if(t.collection_id)return z(e);if("permission-group-edited"===t.type){const i=s({table:b.bx,id:t.space_id});return{title:oe(n,J({activity:t,getRecordValue:o})),url:(null==i?void 0:i.getRenderUrl({baseUrl:e.baseURL}))??"/"}}if("user-invited"===t.type){const i=function(e){const{activity:t,getRecordValue:o}=e;if(!t.permission_group_id)return;return te({spaceId:t.space_id,permissionGroupId:t.permission_group_id,getRecordValue:o})}({activity:t,getRecordValue:o}),r=s({table:b.bx,id:t.space_id});if(r&&i)return{title:oe(n,i),url:r.getRenderUrl({baseUrl:e.baseURL})}}else if("team-membership-edited"===t.type){const i=e.baseURL||"/";if(!t.team_id)return{url:i,title:n.formatMessage(F.untitledTeamName)};const r=o({table:w.e0,id:t.team_id}),l=s({table:b.bx,id:t.space_id});return{url:(null==l?void 0:l.getRenderUrl({baseUrl:e.baseURL}))??i,title:(null==r?void 0:r.name)||n.formatMessage(F.untitledTeamName)}}return G(e)}function O(e){return G(e).title}function G(e){const{activity:t,getRecordValue:o,intl:i}=e,r=o({table:b.bx,id:t.space_id});if(r){const t=S.kk.fromSpace(r);return{title:t.getRenderTitleWithEmoji({placeholder:i.formatMessage({defaultMessage:"Untitled",id:"pushNotifications.workspaceName.untitled.placeholder"})}),url:t.getRenderUrl({baseUrl:e.baseURL})}}return{url:e.baseURL||"/",title:i.formatMessage(F.untitledSpaceName)}}function N(e){return z(e).title}function z(e){const{activity:t,getRecordValue:o,pageVisitSource:i,userTimeZone:r,intl:n}=e;if(t.collection_id){const s=o({table:x.v,id:t.collection_id,spaceId:t.space_id});if(s){const t=S.kk.fromCollection(s),o=S.om.fromGetRecordValueFn(e.getRecordValue),l=t.getRenderTitleWithEmoji({getRecordModel:o,placeholder:n.formatMessage(F.untitledCollectionName),userTimeZone:r,intl:n});return{url:t.getRenderUrl({getRecordModel:o,baseUrl:e.baseURL,pageVisitSource:i}),title:l}}return{url:e.baseURL||"/",title:n.formatMessage(F.untitledCollectionName)}}return{url:e.baseURL||"/",title:n.formatMessage(F.untitledCollectionName)}}function H(e){if(e.blockValue.properties)return(0,y.X)({intl:e.intl,textValue:e.blockValue.properties.title,getRecordModel:S.om.fromGetRecordValueFn(e.getRecordValue),userTimeZone:e.userTimeZone})}function K(e,t){const o=(0,f.kD)(t,void 0);return e.formatMessage(o)}function W(e){let{userTimeZone:t,activity:o,getRecordValue:i,pageVisitSource:r,intl:n}=e;const l=o.getEdits();if(l.length){const e=[];l.forEach((t=>{"permission-created"===t.type?e.push(t.permission_data):"permission-deleted"===t.type?e.push({...t.permission_data,role:"none"}):"permission-restriction-created"===t.type||"permission-restriction-deleted"===t.type?(t.permission_data.calculated_changes||[]).forEach((t=>{let[o,i]=t;e.push(i)})):e.push(t.permission_data.after)}));const a=g.oA(e.sort(f._G).map((e=>{if("user_permission"===e.type){const t=i({table:k.KJ,id:e.user_id}),o=(0,V.Nz)(n,t),r=K(n,e.role);return n.formatMessage(F.userNameWithRole,{userName:o,permissionLevel:r})}if("space_permission"===e.type){const s=O({intl:n,activity:o,getRecordValue:i,userTimeZone:t,pageVisitSource:r}),l=K(n,e.role);return n.formatMessage(F.spaceNameWithRole,{spaceName:s,permissionLevel:l})}if("public_permission"===e.type){const t=K(n,e.role);return n.formatMessage(F.publicPermissionRoleLabel,{permissionLevel:t})}if("bot_permission"===e.type){const t=i({table:C.cZ,id:e.bot_id}),o=(0,s.Mh)(t),r=K(n,e.role);return n.formatMessage(F.botNameWithRole,{botName:o,permissionLevel:r})}})));return n.formatList(a,{type:"conjunction",style:"narrow"})}}function U(e){const{intl:t}=e;switch(e.blockValue.type){case n.Ti.text:case n.Ti.header:case n.Ti.subHeader:case n.Ti.subSubHeader:case n.Ti.factory:case n.Ti.equation:case n.Ti.code:return H(e);case n.Ti.toggle:return`▸ ${H(e)}`;case n.Ti.bulletedList:return`• ${H(e)}`;case n.Ti.numberedList:return`1. ${H(e)}`;case n.Ti.quote:return`“${H(e)}”`;case n.Ti.toDo:return(function(e){let{blockValue:t}=e;return c.Ml(t.properties&&t.properties.checked)}(e)?"✓ ":"▢ ")+H(e);case n.Ti.file:case n.Ti.bookmark:return`🔗 ${H(e)}`;case n.Ti.embed:case n.Ti.framer:case n.Ti.whimsical:case n.Ti.mixpanel:case n.Ti.miro:case n.Ti.abstract:case n.Ti.sketch:case n.Ti.excalidraw:case n.Ti.replit:case n.Ti.hex:case n.Ti.deepnote:case n.Ti.tweet:case n.Ti.gist:case n.Ti.maps:case n.Ti.invision:case n.Ti.video:case n.Ti.audio:case n.Ti.image:return t.formatMessage(F.imageInPushNotification,{imageEmoji:"🖼"});case n.Ti.drive:return function(e){const{blockValue:t}=e,o=(0,u.v0)(t);return o&&o.title?o.title:A(e)}(e);case n.Ti.page:case n.Ti.collectionView:case n.Ti.collectionViewPage:return A(e);case n.Ti.tableRow:return function(e){var t;const{blockValue:o,getRecordValue:i,userTimeZone:r,intl:n}=e,s=i({table:o.parent_table,id:o.parent_id,spaceId:o.space_id});if(!s||!o)return;const l=o.properties,a=(null===(t=s.format)||void 0===t?void 0:t.table_block_column_order)||[];return a&&l?a.map((e=>(0,y.X)({textValue:l[e],getRecordModel:S.om.fromGetRecordValueFn(i),userTimeZone:r,intl:n}))).join(", "):void 0}(e)}}function $(e){const{getRecordValue:t,baseURL:o,userTimeZone:i,intl:r}=e,n=t({table:v.iU,id:e.blockId});if(n){if("page"===n.type){const s=(0,h.ky)({block:n,getRecordValue:t});if(s){const o=a.oC(s),i=o[e.property],l=i?i.name:void 0,c=q({property:e.property,schema:o,block:n,getRecordValue:t,userTimeZone:e.userTimeZone,baseURL:e.baseURL,intl:r})||r.formatMessage(F.emptyPropertyBody);return r.formatMessage(F.propertyNameAndValueNotificationBody,{propertyName:l,propertyValue:c})}return U({intl:r,blockValue:n,getRecordValue:t,baseURL:o,userTimeZone:i})}return U({intl:r,blockValue:n,getRecordValue:t,baseURL:o,userTimeZone:i})}}function q(e){const{property:t,schema:o,getRecordValue:i,userTimeZone:n,baseURL:s,intl:u}=e,h=o[t],m=S.kk.fromBlock(e.block);if(!m.getProperties()||!h)return;const g=m.getProperties()[t];if(g){if("formula"===h.type){const e=S.om.fromGetRecordValueFn(i),r=(0,l.py)({schema:o,property:t,blockModel:m,getRecordModel:e,intl:u,userTimeZone:n,depth:0,resultCache:new Map});return d.U3(r)?(0,p.ZV)({allowRelativeDates:!0,intl:u,value:r,userTimeZone:n}):"boolean"==typeof r?r?a.bx:a.HC:(0,R.hj)(r)?r.toString():r}if("person"===h.type)return u.formatList(c.DW({textValue:g,propertySchema:h,blockCreatorPointer:m.getCreatedByPointer()}).map((e=>{const t=i(e),o=(0,r.LU)({table:e.table,value:t});return(0,r.$4)(u,o)})),{type:"conjunction",style:"narrow"});if("created_by"===h.type){const e=m.getCreatedByPointer();if(!e)return u.formatMessage(F.unknownAuthorInPropertySchemaChange);const t=i(e),o=t&&(0,r.LU)({table:e.table,value:t});return o?(0,r.$4)(u,o):u.formatMessage(F.unknownAuthorInPropertySchemaChange)}return"created_time"===h.type?(0,p.Yx)(m.getCreatedTime(),"short",u.locale,n):Q({propertySchema:h,textValue:g,getRecordValue:i,userTimeZone:n,baseURL:s,intl:u})}}function Q(e){const{propertySchema:t,textValue:o,getRecordValue:i,userTimeZone:n,baseURL:s,intl:l}=e;if("title"===t.type||"text"===t.type)return(0,y.X)({intl:l,textValue:o,getRecordModel:S.om.fromGetRecordValueFn(i),userTimeZone:n});if("select"===t.type){const e=t.options||[];return c.Sj(o,e)}if("multi_select"===t.type){const e=t.options||[];return l.formatList(c.uP(o,e),{type:"conjunction",style:"narrow"})}if("checkbox"===t.type)return c.Ml(o)?a.bx:a.HC;if("date"===t.type){const e=c.Gl(o);if(e)return(0,p.ZV)({allowRelativeDates:!0,intl:l,value:e,date_format:t.date_format,time_format:t.time_format,userTimeZone:n})}else{if("person"===t.type)return l.formatList(c.DW({textValue:o,propertySchema:t,blockCreatorPointer:void 0}).map((e=>{const t=i(e),o=(0,r.LU)({table:e.table,value:t});return(0,r.$4)(l,o)})),{type:"conjunction",style:"narrow"});if("relation"===t.type){const e=c.j$({relationValue:c.rq(o),getRecordModel:S.om.fromGetRecordValueFn(i),propertySchema:t});return l.formatList(e.map(i).map((e=>e?A({intl:l,blockValue:e,getRecordValue:i,baseURL:s,userTimeZone:n}):l.formatMessage(F.unknownRelationValueChange))),{type:"conjunction",style:"narrow"})}if("number"===t.type){const e=c.VY(o);if(void 0!==e)return e.toString()}else if("auto_increment_id"===t.type){const e=c.ah(o);if(void 0!==e)return e.toString()}else{if("file"===t.type)return l.formatList(c.g(o).map((e=>e.name||e.url)),{type:"conjunction",style:"narrow"});if("url"===t.type||"phone_number"===t.type||"email"===t.type)return c.zB(o);if("created_by"===t.type)return;if("created_time"===t.type)return;if("formula"===t.type)return;if("rollup"===t.type)return;if("last_edited_by"===t.type)return;if("last_edited_time"===t.type)return;if("last_visited_time"===t.type)return;if("button"===t.type)return;if("status"===t.type)return c.ZG(o,t);if("location"===t.type)return;if("verification"===t.type){const e=c._w(o),t=e?j.WN(e):{type:"none"};if("none"===t.type)return l.formatMessage(j.X3.none);const s=i(t.actorPointer),a=(0,r.LU)({table:t.actorPointer.table,value:s}),d=(0,r.$4)(l,a);return"verified"===t.type&&t.isIndefinite?l.formatMessage(j.X3.verifiedIndefinitely,{actor:d}):l.formatMessage(j.X3.verifiedUntil,{actor:d,datetime:M.nK({dateTime:t.dateTimeRange.end,intl:l,userTimeZone:n,displayInUserTimezone:!1,alwaysIncludeTimezone:!0})})}(0,T.t1)(t)}}}function Y(e){switch(e.formatProperty){case"page_icon":return e.intl.formatMessage(F.blockFormatEditPageIconName);default:return}}function X(e){const{formatProperty:t,block:o,getRecordValue:i,intl:r}=e;switch(t){case"page_icon":const e=S.kk.fromBlock(o).getRenderIcon({getRecordModel:S.om.fromGetRecordValueFn(i)});return e?(0,m.Z)(e.icon)?e.icon:r.formatMessage(F.pageIconImagePlaceholder):r.formatMessage(F.emptyBlockEditedProperty);default:return}}function J(e){const{activity:t,getRecordValue:o}=e;let i=te({spaceId:t.space_id,permissionGroupId:t.permission_group_id,getRecordValue:o});if(!i){const e=t.getEdits(),o=P.hI(e)[0];i="permission-group-changed"===o.type?o.permission_group_data.after:o.permission_group_data}return i}function ee(e){const{activity:t,intl:o,userName:i,targetName:r}=e,n=t.getEdits(),s=P.hI(n)[0];return s?"permission-group-created"===s.type?o.formatMessage(F.userCreatedPermissionGroup,{userName:i,permissionGroupName:r}):"permission-group-deleted"===s.type?o.formatMessage(F.userDeletedPermissionGroup,{userName:i,permissionGroupName:r}):o.formatMessage(F.userEditedPermissionGroup,{userName:i,permissionGroupName:r}):o.formatMessage(F.userEditedPermissionGroup,{userName:i,permissionGroupName:r})}function te(e){const{spaceId:t,permissionGroupId:o,getRecordValue:i}=e,r=i({table:b.bx,id:t});return(r&&r.permission_groups||[]).find((e=>e.id===o))}function oe(e,t){if(t){return[(0,m.Z)(t.icon)?t.icon:void 0,t.name||e.formatMessage(F.untitledPermissionGroupName)].filter(Boolean).join(" ")}return e.formatMessage(F.defaultPermissionGroupName)}function ie(e){switch(e){case"block-property-edited":case"commented":case"permission-group-mentioned":case"reminder":case"user-invited":case"user-mentioned":return!0;case"access-requested":case"access-request-resolved":case"email-edited":case"private-content-transferred":case"team-membership-edited":case"verification-expired":case"export-completed":case"import-completed":return!1;case"block-edited":case"collection-edited":case"collection-property-edited":case"collection-row-created":case"collection-row-deleted":case"collection-view-edited":case"page-deleted":case"page-locked":case"page-permanently-deleted":case"page-restored":case"page-unlocked":case"permission-group-edited":case"permissions-edited":case"top-level-block-created":case"top-level-block-deleted":return!1;default:(0,T.t1)(e)}}}}]);