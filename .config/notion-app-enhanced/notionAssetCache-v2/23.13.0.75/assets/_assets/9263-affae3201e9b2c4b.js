"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9263],{24615:(e,t,n)=>{n.d(t,{K9:()=>w,N2:()=>f,Zr:()=>x,hZ:()=>S,is:()=>v,ls:()=>y});n(57658);var s=n(74229),i=n(77897),a=n(4615),o=n(54642),r=n(74948),l=n(36391),d=n(41747),c=n(80444),u=n(21273),p=n(77080),g=n(57819);function m(e){try{let{environment:t,type:n,context:i,inputs:r}=e;return async function*(){const e=await o.streamCascadeInference(t,{type:n,context:i,inputs:r,aiSessionId:(0,a.ZP)()});if("success"===e.type&&s.H1.is(e.data))for await(const t of e.data){if("error"===t.type)return;yield t.output}}()}catch(t){return Promise.reject(t)}}async function h(e){let{environment:t,type:n,context:s,inputs:i}=e;for await(const a of m({environment:t,type:n,context:s,inputs:i}))return a}function f(e){let{environment:t,blockStore:n}=e;if(d.Z.state.loadingState.pageId===n.id)return;if(!u.Z.isAiContextSuggestionsEnabled())return;const s=p.default.getConfigKey("dev_ai_context","suggestOnPageNavigationProbability");(0,i.aw)(s)&&y({environment:t,blockStore:n,topicType:d.G[d.Z.state.subTab].topicType})}async function y(e){let{environment:t,blockStore:n,topicType:s}=e;const i=c.default.state.currentSpaceStore,o=c.default.state.currentUserStore;if("loading"!==d.Z.state.loadingState.type&&i&&o)try{d.Z.setState({...d.Z.state,loadingState:{type:"loading",pageId:n.id}});const{title:e,content:r}=(0,g.yR)(t,n),l=await h({environment:t,type:s,context:{spaceId:i.id,userId:o.id},inputs:[{title:e,content:r}]});l&&d.Z.setState({...d.Z.state,topics:l.map((e=>({clientId:(0,a.ZP)(),detailLoadingState:"initial",title:e,isExpanded:!1,showHint:!0})))})}finally{d.Z.setState({...d.Z.state,loadingState:{type:"loaded",pageId:n.id}})}}function S(e){let{topic:t,subTopic:n}=e;d.Z.setState({...d.Z.state,topics:[...d.Z.state.topics,{clientId:(0,a.ZP)(),detailLoadingState:"initial",title:`${t}: ${n}`,isExpanded:!0,showHint:!1}]})}async function x(e){let{environment:t,blockStore:n,topicClientId:s}=e;const i=c.default.state.currentSpaceStore,a=c.default.state.currentUserStore;if("loading"!==d.Z.state.loadingState.type&&i&&a)try{d.Z.setTopicDetailLoading(s,"loading");const e=d.Z.getTopicByClientId(s);if(!e)return;const{title:o,content:r}=(0,g.yR)(t,n),l=await h({environment:t,type:"topicBrief",context:{spaceId:i.id,userId:a.id},inputs:[{topic:e.title,title:o,content:r}]});if(!l)return;d.Z.setTopicDetailLoaded(s,l)}catch(o){d.Z.setTopicDetailLoading(s,"initial")}}function v(e){let{topicClientId:t,environment:n}=e;w(),d.Z.setState({...d.Z.state,topics:d.Z.state.topics.map((e=>({...e,isExpanded:e.clientId===t})))}),l.ZP.state.expanded&&l.ZP.state.currentTab===l.gY.AiContext||(l.ZP.setState({...l.ZP.state,currentTab:l.gY.AiContext}),(0,r.setUpdateExpand)({environment:n,isExpanded:!0,from:"topbar"}))}function w(){d.Z.setState({...d.Z.state,topics:d.Z.state.topics.map((e=>({...e,showHint:!1})))})}},70771:(e,t,n)=>{n.d(t,{Cc:()=>p,K7:()=>c,Nt:()=>g,OZ:()=>u});n(21703),n(41432);var s=n(4615),i=(n(71644),n(21202),n(6287),n(13493),n(91644),n(19889),n(70203),n(54642)),a=(n(94419),n(9953)),o=(n(80444),n(98180)),r=n(89912),l=n(44950),d=n(33932);async function c(e){const{environment:t,spaceId:n}=e,s=await i.getSkillsInSpace(t,{spaceId:n});if("success"!==s.type)throw new Error("Failed to fetch skills in space.");const{skillIds:a}=s.data;r.L.setState({...r.L.state,serverSkillIds:new Set(a)})}async function u(e){var t;const{environment:n,clientSkill:i}=e;if(!i.inAppSkillTrigger)return;(0,d.navigateToView)({view:"chat"});const{sessionId:a}=await(0,l.resetAndInitializeAssistantSession)({environment:n,clientSkill:i,skillSettings:{}});if(!(null===(t=o.Z.getSessionContextOrThrow(a).assistantRuntimeStore.state)||void 0===t?void 0:t.evaluator))throw new Error("No evaluator.");i.inAppSkillTrigger.requiresInput||await(0,l.sampleNextAssistantSteps)({environment:n,inferenceId:(0,s.ZP)(),sessionId:a})}function p(e){const{store:t,update:n,transaction:s}=e;a.sW({store:t.getSettingsStore(),data:n,transaction:s})}function g(e){const{store:t,transaction:n}=e;a.sW({store:t,data:{alive:!1},transaction:n})}},60117:(e,t,n)=>{n.r(t),n.d(t,{AiWaitlistAndUpsellModalStore:()=>d,AssistantFullPageChat:()=>Ce,AssistantMenuPopup:()=>Ae,AssistantOriginElement:()=>ue,AssistantUpsellElement:()=>ye,AssistantWriterInProgressContent:()=>b,AssistantWriterPopupRenderer:()=>x,SearchAssistantPane:()=>Te.u,assistantActions:()=>s,assistantAnalyticsActions:()=>i,assistantMenuActions:()=>a,assistantMenuStore:()=>r.d,assistantOriginElementStore:()=>l.N,clientSkillHelpers:()=>o});var s=n(44950),i=n(28344),a=n(33932),o=n(71844),r=n(56206),l=n(40824),d=n(90891),c=(n(67635),n(67294)),u=n(86628),p=n(24405),g=n(9291),m=n(80444),h=n(98180),f=n(67973),y=n(84969),S=n(85893);function x(e){window.__c={n:"AssistantWriterPopupRenderer"};const t=(0,g.useIntl)(),n=(0,u.VK)((()=>m.default.state.currentSpaceStore),[]),s=(0,u.VK)((()=>h.Z.getActiveAssistantConfigurationState()),[]),i=(0,u.VK)((()=>h.Z.getActiveAssistantRuntimeState()),[]),a=(0,u.VK)((()=>{if(i)return i.temporaryClientSteps.findLast((e=>"assistantChat"===e.type))}),[i],{useDeepEqual:!0}),r=(0,u.qz)(void 0,f.d),l=(0,p.yK)((e=>({defaultMessageWrap:{padding:"3px 2px"}})),[]);return n&&s&&i?(0,S.jsxs)(S.Fragment,{children:[i.selectedSkill&&0===i.clientSteps.length&&o.skillDefaultAssistantMessageMap[i.selectedSkill.skillType]&&(0,S.jsx)("div",{style:l.defaultMessageWrap,children:t.formatMessage(o.skillDefaultAssistantMessageMap[i.selectedSkill.skillType])}),a&&(0,S.jsx)(y.m,{clientStep:a,parentStore:n,configurationState:s,fakeSlackUser:void 0,isLatestStep:!0,isQuickSearchMode:!1,renderAsFullPage:!1,priorSearchResultsStep:void 0,citationHoverStore:r,disableWrap:!0})]}):null}var v=n(35245),w=n(54206),k=n(16540);function b(e){window.__c={n:"AssistantWriterInProgressContent"};const t=(0,u.VK)((()=>m.default.state.currentSpaceStore),[]),n=(0,u.VK)((()=>h.Z.getActiveAssistantConfigurationState()),[]),s=(0,u.VK)((()=>h.Z.getActiveAssistantRuntimeState()),[]),i=(0,v.f6)({assistantRuntimeState:s,assistantConfigurationState:n}),a=(0,u.qz)(void 0,f.d);return t&&n&&s?(0,S.jsx)("div",{style:{minHeight:36},children:"searchResults"===(null==i?void 0:i.type)?(0,S.jsx)(k.N,{clientStep:i.step,parentStore:t,configurationState:n,citationHoverStore:a,isQuickSearchMode:!1,renderAsFullPage:!1}):(0,S.jsx)(w.H,{clientStep:{type:"assistantLoading",inferenceId:"hard-coded"},parentStore:t,parentSpaceId:t.id,configurationState:n,isQuickSearchMode:!1,renderAsFullPage:!1,latestStepCitationHoverStore:a})}):null}var C=n(21974),j=n(62073),M=n(480),I=n(5257),A=n(11751),T=n(97880),Z=n(63143),P=n(51454),F=n(82530),R=n(37181),_=n(47449),B=n(16091),V=n(55031),K=n(64921),L=n(91839),E=n(10388),W=n(28020),O=n(79897),H=n(24646),N=n(21273),D=n(4926),U=n(55320),z=n(65147),q=(n(52262),n(30120)),Q=n(2551),G=n(85844);const $=[3,4],Y=4*Z.C0;function J(){const[e,t]=(0,c.useState)(),[n,s]=(0,c.useState)((()=>q.ou.utc())),[i,a]=(0,c.useState)(!1),o=(0,u.VK)((()=>N.Z.showRemindersToUseQnA()),[]);return(0,c.useEffect)((()=>{const e=setTimeout((()=>{a(!0),s(q.ou.utc())}),Y);return()=>clearTimeout(e)}),[]),(0,Q.W)((()=>{s(q.ou.utc())}),5*Z.hM,i&&o),(0,u.VK)((()=>{if(!o)return;if(!i)return;if((0,T.$K)(e))return;if(!G.Z.state.isVisible)return;const s=function(e){const{now:t}=e,{currentUserSettingsStore:n}=m.default.state;if(!n)return;return function(e){const{currentUserSettings:t,now:n}=e;if(!(0,T.$K)(t.last_exposed_to_ai_qna_at))return;const s=t.qna_reminders_shown_at??[],i=s.length,a=$.at(i);if(!(0,T.$K)(a))return;const o=0===i?t.last_exposed_to_ai_qna_at:s[i-1];if(n.diff(q.ou.fromMillis(o),"days").days<a)return;if(i>0){const e=s[i-1];if(t.last_exposed_to_ai_qna_at>=e)return}return{number:i+1,update:{qna_reminders_shown_at:[...s,n.toMillis()]}}}({currentUserSettings:{last_exposed_to_ai_qna_at:n.getSettingsStore().getKeyStore("last_exposed_to_ai_qna_at").getValue(),qna_reminders_shown_at:n.getSettingsStore().getKeyStore("qna_reminders_shown_at").getValue()},now:t})}({now:n});(0,T.$K)(s)&&t(s)}),[o,i,e,n]),e}var X=n(35840),ee=n(24615),te=n(41747),ne=n(2405);function se(e){let{topic:t}=e;window.__c={n:"AiContextTopicButton"};const n=(0,M.O7)(),s=(0,u.VK)((()=>m.default.state.mainEditorCurrentBlockStore),[]),i=(0,c.useCallback)((()=>{s&&(0,ee.is)({topicClientId:t.clientId,environment:n})}),[n,s,t.clientId]),a=ae();return(0,S.jsx)(ne.Z,{title:(0,S.jsx)("div",{children:t.title}),style:a.button,hoveredStyle:a.hoveredButton,pressedStyle:a.pressedButton,icon:X.R,iconStyle:a.icon,onClick:i})}function ie(){window.__c={n:"AiContextTopicHint"};const e=(0,M.O7)(),t=(0,p.Fg)(),n=(0,u.VK)((()=>te.Z.state.topics.filter((e=>e.showHint))),[]),s=(0,c.useCallback)((()=>{(0,ee.K9)()}),[]),i=(0,u.VK)((()=>(0,V.y)(e,{theme:t,rightEdgeDistance:14,isInPeekRenderer:!1,width:0})),[t,e]),a=(0,p.yK)((()=>({container:{...i,height:"auto",width:"auto",display:"flex",flexDirection:"column",alignItems:"end",gap:6,background:"transparent",top:"unset",bottom:60,zIndex:P.hT,borderRadius:0,border:0,boxShadow:"none"}})),[i]),o=ae();return(0,S.jsxs)("div",{style:a.container,children:[n.map((e=>(0,S.jsx)(se,{topic:e},e.title))),n.length>0&&(0,S.jsx)(ne.Z,{title:(0,S.jsx)("div",{children:"Hide"}),style:o.button,hoveredStyle:o.hoveredButton,pressedStyle:o.pressedButton,onClick:s},"hideHints")]})}function ae(){return(0,p.yK)((e=>({button:{width:"auto",maxWidth:"100%",alignItems:"flex-start",borderRadius:16,background:e.whiteButtonBackground,boxShadow:e.lightBoxShadow},hoveredButton:{background:e.whiteButtonHoveredBackground},pressedButton:{background:e.whiteButtonPressedBackground},title:{overflow:"hidden",textOverflow:"ellipsis",width:"100%",flexShrink:1},icon:{fill:e.aiPurpleColor,marginTop:3}})),[])}var oe=n(82990);function re(e){window.__c={n:"AssistantAnimatedNudgeElement"};const{onClick:t,children:n}=e,s=(0,M.O7)(),[i,a]=(0,c.useState)(!1),[o,r]=(0,c.useState)(!1),l=(0,c.useCallback)((()=>{a(!1),r(!1)}),[]),d=(0,c.useCallback)((()=>{l(),window.removeEventListener("mouseup",d)}),[l]),u=(0,c.useCallback)((()=>{a(!0)}),[]),g=(0,c.useCallback)((()=>{a(o),r(!1)}),[o]),m=(0,c.useCallback)((()=>{r(!0),window.addEventListener("mouseup",d)}),[d]),h=(0,c.useCallback)((()=>{r(!1)}),[]),f=function(e){const{environment:t,isHovered:n,isPressed:s}=e,i=pe({rightEdgeDistance:16,isInPeekRenderer:!1,environment:t,alwaysVisible:!0,overrides:e=>({width:void 0,height:45,background:e.whiteButtonBackground})}),[a,o]=(0,c.useState)(!1);return(0,c.useEffect)((()=>{setTimeout((()=>{o(!0)}),2e3)}),[]),(0,p.yK)((e=>({buttonStyle:{...i,cursor:"pointer",overflow:"hidden",userSelect:"none"},shimmerButtonStyle:{display:"flex",alignItems:"center",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundImage:"dark"===e.mode?"linear-gradient(270deg, rgba(255, 255, 255, 0.4) 13.84%, rgba(255, 255, 255, 1) 59.7%, rgba(255, 255, 255, 0.4) 93.89%)":"linear-gradient(270deg, rgba(0, 0, 0, 0.4) 13.84%, rgba(0, 0, 0, 1) 59.7%, rgba(0, 0, 0, 0.4) 93.89%)",backgroundSize:"200% 100%",backgroundRepeat:"no-repeat",...!a&&{background:void 0,backgroundImage:void 0,backgroundSize:void 0,backgroundClip:void 0,WebkitBackgroundClip:void 0,WebkitTextFillColor:void 0},...n&&{background:e.whiteButtonHoveredBackground,backgroundImage:void 0,backgroundSize:void 0,backgroundClip:void 0,WebkitBackgroundClip:void 0,WebkitTextFillColor:void 0},...s&&{background:e.whiteButtonPressedBackground,backgroundImage:void 0,backgroundSize:void 0,backgroundClip:void 0,WebkitBackgroundClip:void 0,WebkitTextFillColor:void 0}},sparklesIcon:{height:22,width:22,padding:"4px 4px"},sparklesWrapper:{borderRadius:"100%",border:"2px solid RGB(182,208,240)",marginRight:8},inner:{display:"flex",alignItems:"center",flexWrap:"nowrap",padding:"10px 10px"},chevronIcon:{height:16,width:15,opacity:.4,marginLeft:8},message:{fontSize:oe.Z.fontSize.UIRegular.desktop,textWrap:"nowrap",fontWeight:500},badge:{position:"absolute",left:"27px",top:"-5px"}})),[n,s,a,i])}({environment:s,isHovered:i,isPressed:o});return(0,S.jsx)(j.E.div,{style:f.buttonStyle,variants:{initial:{width:36},animate:{width:"auto",transition:{ease:[.87,0,.13,1],type:"spring",stiffness:90,damping:16,mass:1}}},initial:"initial",animate:"animate",onMouseMove:u,onMouseLeave:g,onMouseDown:m,onMouseUp:h,onClick:t,children:(0,S.jsx)(j.E.div,{style:f.shimmerButtonStyle,animate:{backgroundPosition:["150% 0","-50% 0"]},transition:{ease:"easeInOut",duration:1.5,repeat:1/0},children:(0,S.jsxs)("div",{style:f.inner,children:[(0,S.jsxs)("div",{style:f.sparklesWrapper,children:[(0,A.t)(f.sparklesIcon),(0,S.jsx)("div",{style:f.badge,children:(0,S.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"11",viewBox:"0 0 10 11",fill:"none",children:(0,S.jsx)("circle",{cx:"5",cy:"5.5",r:"4",fill:"#2383E2",stroke:"white",strokeWidth:"2"})})})]}),(0,S.jsx)(j.E.div,{style:f.message,variants:{initial:{opacity:0},animate:{opacity:1,transition:{ease:[.16,1,.3,1],duration:.75}}},initial:"initial",animate:"animate",children:n}),(0,I.o)(f.chevronIcon)]})})})}const le=(0,g.defineMessages)({reminderToUseQnA:{id:"AssistantOriginElement.reminderToUseQnA",defaultMessage:"Find pages, get instant answers with Q&A"}});function de(e){window.__c={n:"QnaReminderElement"};const{onClick:t,reminderNumber:n,suggestedQuestion:s}=e,a=(0,M.O7)();return(0,c.useEffect)((()=>{i.trackQnaReminderShown(a,{number:n})}),[a,n]),(0,S.jsx)(re,{onClick:t,children:s?(0,S.jsx)(g.FormattedMessage,{defaultMessage:"Ask AI “{suggestedQuestion}”",values:{suggestedQuestion:s},id:"AssistantOriginElement.reminderToUseQnAWithSuggestedQuestion"}):(0,S.jsx)(g.FormattedMessage,{...le.reminderToUseQnA})})}const ce=2*Z.hM;function ue(){window.__c={n:"AssistantOriginElement"};const e=(0,M.O7)(),t=(0,p.Fg)();!function(){const e=(0,M.O7)(),t=(0,u.VK)((()=>m.default.state.mainEditorCurrentBlockStore),[]),n=(0,u.VK)((()=>{var e;return null===(e=m.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),s=(0,u.VK)((()=>{var e;return Boolean(null===(e=h.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.isCurrentlyCommittingHumanStep)}),[]),i=(0,u.VK)((()=>l.N.state.currentState),[]),a=(0,u.VK)((()=>m.default.state.currentUserSettingsStore),[]);(0,c.useEffect)((()=>{let e;return"answerWaitingForUserClick"===i&&(e=setTimeout((()=>{"answerWaitingForUserClick"===l.N.state.currentState&&l.N.setState({...l.N.state,currentState:"default"})}),ce)),()=>clearTimeout(e)}),[i]);const{lastStepLoadingCompletionUnixEpochMs:o,aiWindowLastSeenUnixEpochMs:r}=(0,u.VK)((()=>l.N.state),[]),d=J(),[p,g]=(0,c.useState)(!1);(0,c.useEffect)((()=>{(async()=>{const i=l.N.state.currentState,c=o===-1/0||r>o;if((0,T.$K)(d)&&!p){let s;t&&n&&(s=await(0,_.qC)({environment:e,blockStore:t,reminderNumber:d.number,spaceId:n})),l.N.setState({...l.N.state,currentState:"qnaReminder",reminderNumber:d.number,suggestedQuestion:s}),g(!0),a&&F.createAndCommit({environment:e,userAction:"useApplicableQnaReminder.setNumQnaRemindersShown",perform:e=>{R.d2({userSettingsStore:a,transaction:e,data:d.update})}})}else s||c||"answerLoading"!==i||o===-1/0?s||"qnaReminder"===i||"answerLoading"!==i&&!c?!s||"default"!==i&&"qnaReminder"!==i||l.N.setState({...l.N.state,currentState:"answerLoading"}):l.N.setState({...l.N.state,currentState:"default"}):l.N.setState({...l.N.state,currentState:"answerWaitingForUserClick"})})()}),[e,t,n,r,s,o,d,p,a])}();const n=(0,p.yK)((e=>({faceImg:{width:16,pointerEvents:"none"}})),[]),i=(0,c.useRef)(null),o=(0,u.VK)((()=>{const{currentUserSettingsStore:t,currentSpaceStore:n,mainEditorCurrentBlockStore:s}=m.default.state;return!W.tu.state&&(!!(n&&s&&s.canRead())&&N.Z.isQnATooltipsVisible(e.device,t))}),[e.device]),d=(0,u.VK)((()=>N.Z.isAiContextSuggestionsEnabled()),[]),g=(0,u.VK)((()=>{var e,t;const n=l.N.state;return null!==(e=r.d.state)&&void 0!==e&&e.open||null!==(t=U.default.state)&&void 0!==t&&t.open?{currentState:"default"}:n}),[]),f=(0,c.useCallback)((async()=>{const{currentUserSettingsStore:t}=m.default.state;t&&(0,_.CX)(e,{phase:"complete",transactionUserAction:"AiQnaIntroModal.debug.clickTooltipClose",userSettingsStore:t}),l.N.setState({...l.N.state,currentState:"default"});const n="qnaReminder"===g.currentState;n&&g.suggestedQuestion&&(await(0,s.resetAndInitializeAssistantSession)({environment:e}),await(0,z.AF)({newValue:[[g.suggestedQuestion]],environment:e,currentSkill:void 0,source:"reminder_suggested_question"})),a.openAssistantRightHandSideMenu({environment:e,from:"button",isReminder:n})}),[e,g]),y=(0,u.VK)((()=>(0,V.y)(e,{theme:t,rightEdgeDistance:16,isInPeekRenderer:!1,width:36})),[e,t]),x=(0,c.useMemo)((()=>(0,A.t)({...n.faceImg})),[n.faceImg]);if((0,O.A3)())return null;switch(g.currentState){case"answerLoading":return(0,S.jsx)(ge,{onClick:f,isAnswerReady:!1});case"answerWaitingForUserClick":return(0,S.jsx)(ge,{onClick:f,isAnswerReady:!0});case"qnaReminder":return(0,S.jsx)(de,{onClick:f,reminderNumber:g.reminderNumber,suggestedQuestion:g.suggestedQuestion});case"default":return(0,S.jsxs)(S.Fragment,{children:[o&&(0,S.jsx)(B.ND,{origin:i}),d&&(0,S.jsx)(ie,{}),(0,S.jsx)(K.Z,{ariaLabel:"ai",className:"notion-ai-button",style:{...y,...o?{border:"3px solid #b6cce7"}:{}},hoveredStyle:{background:t.whiteButtonHoveredBackground},pressedStyle:{background:t.whiteButtonPressedBackground},onClick:f,ref:i,children:x})]});default:(0,T.t1)(g)}}function pe(e){const{rightEdgeDistance:t,environment:n,isInPeekRenderer:s,alwaysVisible:i,overrides:a}=e,o=(0,u.VK)((()=>(0,H.ll)(n,s)-(0,H.vJ)(n)),[n,s]),r=(0,u.VK)((()=>t+D.Z.state),[t]),l=(0,u.VK)((()=>(0,V.G)(n,16+D.Z.state)),[n]),d=(0,u.VK)((()=>W.tu.state&&!i?0:1),[i]),{ovalButtonStyle:c}=(0,p.yK)((e=>({ovalButtonStyle:{position:"absolute",bottom:l,right:r,borderRadius:100,fontSize:20,boxShadow:e.lightBoxShadow,zIndex:P.hT,backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",backgroundBlendMode:"overlay, normal",opacity:d,transform:`translateX(-${o}px) translateZ(0)`,transition:`\n\t\t\t\topacity ${E.nk}ms,\n\t\t\t\tcolor ${E.nk}ms,\n\t\t\t\ttransform 200ms\n\t\t\t`,...null==a?void 0:a(e)}})),[o,r,l,d,a]);return c}function ge(e){let{onClick:t,isAnswerReady:n}=e;window.__c={n:"QnaBackgroundProcessingElement"};const s=(0,p.yK)((e=>({sparklesIcon:{height:18,width:18,fill:e.regularIconColor},aiProcessingButtonTopLevelStyle:{display:"flex",alignItems:"center",flexDirection:"row",marginLeft:12.5,marginRight:14,height:52},sparklesIconWrapperStyle:{borderRadius:"100%",background:e.whiteButtonBackground,height:30,width:30,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${e.outlineButtonBorder}`,fill:e.regularIconColor},messagesWrapperStyle:{display:"flex",flexDirection:"column",justifyContent:"center",marginLeft:8},notionAiTitleStyle:{fontSize:12,fontWeight:"500",color:e.lightTextColor},answerReadyStyle:{fontSize:13,fontWeight:"500",color:e.aiPurpleColor,display:"flex",alignItems:"center"},preparingYourAnswerStyle:{fontSize:14,fontWeight:"500",color:e.aiPurpleColor},chevronRightStyle:{height:19,width:15,opacity:.2,marginLeft:"auto"}})),[]),i=pe({rightEdgeDistance:16,isInPeekRenderer:!1,environment:(0,M.O7)(),overrides:e=>({width:278,height:52,background:e.aiPurpleTranslucentRadialGradientBackground})}),[a,o]=(0,C.H)(),[r,l]=(0,C.H)(),d=(0,c.useCallback)((async()=>{await o(a.current,{width:278}),await l(r.current,{display:"block",opacity:1})}),[o,l,a,r]);(0,c.useEffect)((()=>{d()}),[d]);return(0,S.jsx)(j.E.div,{"aria-label":"ai processing",className:"notion-ai-button",onClick:t,style:{...i,cursor:"pointer",overflow:"hidden",flexWrap:"wrap"},variants:{initial:{width:28},animate:{width:278,transition:{type:"spring",stiffness:20,damping:15}}},initial:"initial",animate:"animate",ref:a,children:(0,S.jsxs)("div",{style:s.aiProcessingButtonTopLevelStyle,children:[(0,S.jsx)("div",{style:s.sparklesIconWrapperStyle,children:(0,A.t)(s.sparklesIcon)}),(0,S.jsx)("div",{style:{...s.messagesWrapperStyle,display:"none"},ref:r,children:n?(0,S.jsx)("div",{style:s.answerReadyStyle,children:(0,S.jsx)(g.FormattedMessage,{id:"AssistantOriginElement.answerReady",defaultMessage:"Your answer is ready"})}):(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,S.jsx)("div",{style:s.preparingYourAnswerStyle,children:(0,S.jsx)(g.FormattedMessage,{id:"AssistantOriginElement.notionAiLoadingText",defaultMessage:"Preparing your answer"})}),(0,S.jsx)("div",{style:{marginLeft:6,fontWeight:"500"},children:(0,S.jsx)(L.Z,{})})]})}),(0,I.o)(s.chevronRightStyle)]})})}var me=n(51650),he=n(80736),fe=n(68373);function ye(){window.__c={n:"AssistantUpsellElement"};const e=(0,M.O7)(),t=(0,u.VK)((()=>m.default.state.currentSpaceStore),[]),n=(0,u.VK)((()=>!!he.Z.state.loaded&&he.Z.state.isOnWaitlist),[]),s=(0,u.VK)((()=>{if(!t)return[];if(he.Z.state.loaded&&he.Z.state.isOnWaitlist){const e=t.id;return he.Z.state.aiWaitlistIds.map((n=>fe.Du.createChildStore(t,{id:n,table:me.b,spaceId:e}))).map((e=>e.getUserStore())).filter(T.$K)}return[]}),[t]);c.useEffect((()=>{i.trackQnaUpsellNudgeShown(e)}),[e]);const a=c.useCallback((()=>{const t=n?"waitlist-upsell":"upsell";d.default.setState({open:!0,stage:t}),i.trackQnaUpsellNudgeClick(e)}),[e,n]);return(0,S.jsx)(re,{onClick:a,children:(0,S.jsx)(Se,{isOnWaitlist:n,usersWhoRequestedQna:s})})}function Se(e){window.__c={n:"NudgeMessage"};const{isOnWaitlist:t,usersWhoRequestedQna:n}=e,s=(0,g.useIntl)(),i=(0,M.O7)().currentUser.id,a=(0,u.VK)((()=>n.some((e=>e.id===i))),[n,i]),o=(0,u.VK)((()=>n.map((e=>e.getFullName(s))).filter(T.$K)),[n,s]);if(t){if(a||0===o.length)return(0,S.jsx)(g.FormattedMessage,{id:"assistantUpsellElement.onWaitlist.title",defaultMessage:"Get access to Q&A faster"});if(1===o.length)return(0,S.jsx)(g.FormattedMessage,{id:"assistantUpsellElement.onWaitlist.oneUserRequested.title",defaultMessage:"{userName} requested access to Q&A",values:{userName:o[0]}});if(2===o.length)return(0,S.jsx)(g.FormattedMessage,{id:"assistantUpsellElement.onWaitlist.twoUsersRequested.title",defaultMessage:"{userNameOne} and {userNameTwo} requested access to Q&A",values:{userNameOne:o[0],userNameTwo:o[1]}});{const e=o.length-2;return(0,S.jsx)(g.FormattedMessage,{id:"assistantUpsellElement.onWaitlist.multipleUsersRequested.title",defaultMessage:"{userNameOne},{userNameTwo},{remainder}+ requested access to Q&A",values:{userNameOne:o[0],userNameTwo:o[1],remainder:e.toString()}})}}return(0,S.jsx)(g.FormattedMessage,{id:"assistantUpsellElement.notOnWaitlist.title",defaultMessage:"Request access to Q&A"})}var xe=n(92650),ve=n(89728),we=n(61679),ke=n(17456),be=n(41625);function Ce(e){window.__c={n:"AssistantFullPageChat"};const{route:t}=e,n=Boolean(t.peekViewBlockId),a=(0,M.O7)(),o=(0,u.VK)((()=>(0,H.vJ)(a)+(0,H.Wk)(a)),[a]),r=(0,p.yK)((e=>({wrap:{...n?{width:`calc(100% - ${o}px)`}:{}},chatHistoryAligner:{display:"flex",alignItems:"flex-end",flexDirection:"column"},chatHistoryWrap:{height:"calc(100vh - 16px)",display:"flex",flexDirection:"column",width:"min(100%, 360px)",marginTop:16},layoutContent:{height:"100vh"},newChatButtonText:{color:e.lightTextColor,fontSize:12,display:"flex",alignItems:"center"}})),[n,o]),l=(0,u.VK)((()=>(0,xe.ui)(a,n)),[a,n]);return(0,S.jsx)("div",{style:r.wrap,children:(0,S.jsxs)(we.Ar,{type:"chat",children:[!n&&l>900&&(0,S.jsx)(we.mZ,{children:(0,S.jsx)("div",{style:r.chatHistoryAligner,children:(0,S.jsxs)("div",{style:r.chatHistoryWrap,children:[(0,S.jsxs)("div",{style:{fontSize:16,fontWeight:oe.Z.fontWeight.semibold,display:"flex",alignItems:"center",justifyContent:"space-between",paddingLeft:12,paddingTop:12},children:[(0,S.jsx)(g.FormattedMessage,{id:"assistantMenu.header.askNotionAI.header",defaultMessage:"All chats"}),(0,S.jsx)(ve.Z,{style:r.newChatButtonText,onClick:()=>{!async function(e){await(0,s.resetAndInitializeAssistantSession)({environment:e,makeActiveSession:!0}),(0,i.trackAIChatTranscriptHistoryNewChatCreated)(e)}(a)},isSmall:!0,children:(0,S.jsx)(g.FormattedMessage,{id:"searchAssistantPane.header.newChat.label",defaultMessage:"New chat"})})]}),(0,S.jsx)(ke.p,{renderAsFullPage:!0,variant:"search"})]})})}),(0,S.jsx)(we.bU,{style:r.layoutContent,children:(0,S.jsx)(be.Q,{renderAsFullPage:!0})})]})})}var je=n(31945),Me=n(53437),Ie=n(4023);function Ae(){window.__c={n:"AssistantMenuPopup"};const e=(0,u.VK)((()=>r.d.state.open),[]),[t,n]=(0,c.useState)(),s=(0,M.O7)(),{isMobile:i,isPhone:o}=(0,M.Fy)(),l=(0,u.VK)((()=>{const e=(0,H.ll)(s,!1)-(0,H.vJ)(s);return{bottom:15+D.Z.state,right:15+D.Z.state,xPosition:e}}),[s]);(0,c.useEffect)((()=>{const e=()=>{n(new DOMRect(window.innerWidth-l.right-l.xPosition,window.innerHeight-l.bottom,0,0))};return e(),addEventListener("resize",e),()=>removeEventListener("resize",e)}),[l.right,l.xPosition,l.bottom]);const d=(0,p.yK)((e=>({wrap:{borderRadius:12,boxShadow:e.largeLightBoxShadow}})),[]),g=()=>{a.closeAssistantRightHandSideMenu()};return(0,S.jsx)(Me.ZP,{popupType:i?je.Z4.SlideUp:je.Z4.Popup,forceFullScreenSlideUp:i&&o,alignmentToOrigin:Ie.v.End,alignBoxStyle:{transition:"left 200ms, top 200ms"},originRect:t,disableMouseCapture:!0,preventScaleTransition:!1,preventSlideUpTransition:i,keepFocus:i,popupWrapStyle:d.wrap,isWaxPaper:!0,open:e,slideUpWrapStyle:{...i&&o?{height:"var(--full-viewport-height)"}:{}},render:()=>(0,S.jsx)(be.Q,{showBackButton:i,renderAsFullPage:i,onClose:g}),onDismiss:g})}var Te=n(61719)},2405:(e,t,n)=>{n.d(t,{Z:()=>o});n(67294);var s=n(24405),i=n(64921),a=n(85893);function o(e){window.__c={n:"AssistantActionButton"};const{style:t,icon:n,disabled:o,iconStyle:r,title:l,onClick:d,focused:c,lightGrey:u,...p}=e,g=(m={lightGrey:u},(0,s.yK)((e=>({AssistantActionButton:{display:"flex",alignItems:"center",boxShadow:e.inputBoxShadow,padding:"6px 10px 6px 12px",color:m.lightGrey?e.lightTextColor:e.regularTextColor,fontSize:13,fontWeight:500,borderRadius:24,width:"max-content"},icon:{width:14,height:14,fill:m.lightGrey?e.lightIconColor:e.regularIconColor,marginRight:6}})),[m.lightGrey]));var m;return(0,a.jsxs)(i.Z,{...p,disabled:o,style:{...g.AssistantActionButton,...t},onClick:d,focused:c,...e.tooltipEvents??{},children:[null==n?void 0:n({...g.icon,...r}),l]})}},18707:(e,t,n)=>{n.d(t,{Z:()=>fe});var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(31945),l=n(80444),d=n(65955),c=n(76927),u=n(37612),p=n(9291),g=n(47307),m=n(27153),h=n(9953),f=n(24677),y=n(98104),S=n(82530),x=n(11327),v=n(19471),w=n(9015),k=n(96245),b=n(68709),C=n(42922),j=n(52275),M=n(73063),I=n(28992),A=n(31278),T=n(53336),Z=n(72495),P=n(24006),F=n(26388),R=n(72187),_=n(12534),B=n(98742),V=n(34859),K=n(68910),L=n(42915),E=n(42853),W=n(8808),O=n(89728),H=n(76798),N=n(68373),D=n(85893);function U(e){window.__c={n:"AssistantAutomationParentDropdownButton"};const{automationStore:t,automationContextStore:n,disabled:l}=e,d=(0,i.O7)(),c=(0,o.yK)((e=>({chevronIcon:{width:10,height:10,marginLeft:4,marginTop:2,fill:e.lightIconColor}})),[]),u=(0,a.VK)((()=>t.getParentStore()),[t]),p=(0,a.VK)((()=>u instanceof N.NW?{type:"collection",collection:u.pointer}:u instanceof N.G?{type:"page",page:u.pointer}:void 0),[u]),g=(0,s.useCallback)(((e,n)=>{S.createAndCommit({userAction:"AssistantAutomationParentDropdownButton.handleParentChange",environment:d,perform:n=>{const s="collection"===e.type?e.collection:"page"===e.type?e.page:void 0;if(!s)return;u instanceof N.NW&&(0,L.tt)({transaction:n,collectionStore:u,automationStore:t}),h.sW({store:t,transaction:n,data:{parent_id:s.id,parent_table:s.table}});const i=t.getParentStore();i instanceof N.NW&&(0,L.Mn)({transaction:n,collectionStore:i,automationStore:t})}}),n.close()}),[t,d,u]);return u&&p?(0,D.jsx)(r.ZP,{popupType:d.device.isMobile?r.Z4.SlideUp:r.Z4.Popup,renderOrigin:e=>(0,D.jsxs)(O.Z,{shouldShrink:!0,disabled:l,disabledFeedback:l,...e,children:[(0,D.jsx)(H.Z,{store:u}),(0,E.i)(c.chevronIcon)]}),render:e=>(0,D.jsx)(W.L,{automationContextStore:n,onChange:t=>g(t,e),selectedTarget:p,skipVariables:!0,onClose:e.close})}):null}n(21703);var z=n(13148),q=n(50780),Q=n(47453),G=n(53523),$=n(95855),Y=n(4615),J=n(6287),X=n(97880),ee=n(82990),te=n(95193),ne=n(35294),se=n(78140),ie=n(32163),ae=n(41532);const oe=["chat","recurrence","collection_page_added","collection_page_edited"],re=(0,p.defineMessages)({chatTriggerName:{defaultMessage:"Chat",id:"AssistantAutomationTrigger.chatTriggerName"},recurrenceTriggerName:{defaultMessage:"Repeat",id:"AssistantAutomationTrigger.recurrenceTriggerName"},collectionPageAddedTriggerName:{defaultMessage:"Page added in database",id:"AssistantAutomationTrigger.collectionPageAddedTriggerName"},collectionPageEditedTriggerName:{defaultMessage:"Page properties edited in database",id:"AssistantAutomationTrigger.collectionPageEditedTriggerName"}}),le={chat:re.chatTriggerName,recurrence:re.recurrenceTriggerName,collection_page_added:re.collectionPageAddedTriggerName,collection_page_edited:re.collectionPageEditedTriggerName};function de(e){window.__c={n:"AssistantAutomationTrigger"};const{automationStore:t,automationContextStore:n,disabled:l}=e,d=(0,i.O7)(),c=(0,p.useIntl)(),u=(0,ne.d)(),g=(0,o.yK)((e=>({container:{background:e.contentBackground,borderRadius:5,display:"flex",flexDirection:"column",gap:8,padding:8,marginLeft:12,marginRight:12,marginBottom:8,fontSize:14,boxShadow:e.lightBoxShadow,width:"calc(100% - 24px)"},nameRow:{display:"flex",alignItems:"center"},name:{fontWeight:ee.Z.fontWeight.medium,marginLeft:2},iconWrap:{width:24,height:24,display:"flex",alignItems:"center",borderRadius:4,background:"rgba(35, 131, 226, 0.14)"},icon:{width:14,height:14,fill:e.blueColor,margin:"0 auto"},chevronIcon:{width:10,height:10,marginLeft:4,marginTop:2,fill:e.lightIconColor}})),[]),m=(0,a.VK)((()=>t.getTriggerStore()),[t]),f=(0,a.VK)((()=>m.getValue()),[m]),y=(0,a.VK)((()=>t.getStatus()),[t]),x=(0,a.VK)((()=>t.getProperties()||{}),[t]).assistant_context||[],v=(0,a.VK)((()=>{const e=m.getValue();if(e)return"chat"===e.type?"chat":"recurrence"===e.type?"recurrence":"event"===e.type&&e.event.pagesAdded?"collection_page_added":"event"===e.type&&"any"===e.event.pagePropertiesEdited.type?"collection_page_edited":void 0}),[m]),w=(0,s.useCallback)((e=>{const n=function(e,t){const n=e.getParentPointer(),s=e.getSpacePointer();if(!n||!s)throw new Error("Invalid parent pointer");const i={...n,spaceId:s.id};if("chat"===t)return{id:(0,Y.ZP)(),type:"chat"};if("recurrence"===t)return{id:(0,Y.ZP)(),type:"recurrence",recurrence:(0,ae.defaultRecurrenceConfig)()};if("collection_page_added"===t){if(i.table!==J.v)throw new Error("Invalid parent pointer");return{id:(0,Y.ZP)(),type:"event",event:{source:{type:"collection",pointer:i},pagesAdded:!0,pagePropertiesEdited:{type:"none"}}}}if("collection_page_edited"===t){if(i.table!==J.v)throw new Error("Invalid parent pointer");return{id:(0,Y.ZP)(),type:"event",event:{source:{type:"collection",pointer:i},pagesAdded:!1,pagePropertiesEdited:{type:"any"}}}}(0,X.t1)(t)}(t,e);S.createAndCommit({userAction:"AssistantAutomationTrigger.onTriggerTypeChange",environment:d,perform:e=>{h.sW({store:t,transaction:e,data:{trigger:n}})}})}),[t,d]),k=(0,s.useCallback)((e=>{S.createAndCommit({userAction:"AssistantAutomationTrigger.onTriggerTypeChange",environment:d,perform:n=>{e?(h.sW({store:m,transaction:n,data:{recurrence:e}}),h.sW({store:t,transaction:n,data:{status:"active"}})):h.sW({store:t,transaction:n,data:{status:"disabled"}})}})}),[t,d,m]),b=(0,s.useCallback)((()=>{S.createAndCommit({userAction:"AssistantAutomationTrigger.handleActiveClick",environment:d,perform:e=>{h.sW({store:t,transaction:e,data:{status:"active"===y?"disabled":"active"}})}})}),[t,y,d]),C=(0,s.useCallback)((()=>{S.createAndCommit({userAction:"AssistantAutomationTrigger.handleAddContextClick",environment:d,perform:e=>{const n=t.getPropertiesStore().getKeyStore("assistant_context");S.applyOperation({store:n,operation:{pointer:n.pointer,command:"keyedObjectListAfter",path:n.path,args:{value:{id:(0,Y.ZP)(),name:"New context key",type:"collection_view_block",value:void 0}}},transaction:e})}})}),[t,d]);return v?(0,D.jsxs)("div",{style:g.container,children:[(0,D.jsxs)("div",{style:g.nameRow,children:[(0,D.jsx)("div",{style:g.iconWrap,children:(0,D.jsx)(ce,{triggerType:v,style:g.icon})}),(0,D.jsx)(r.ZP,{alignmentToOrigin:r.vR.Start,disabled:l,originGap:0,placementToOrigin:r.pO.Bottom,popupType:u,render:e=>(0,D.jsx)(ue,{automationStore:t,triggerType:v,onChange:w,parent:e}),renderOrigin:e=>(0,D.jsxs)(O.Z,{shouldShrink:!0,disabled:l,style:g.name,...e,children:[c.formatMessage(le[v]),(0,E.i)(g.chevronIcon)]})}),"recurrence"===(null==f?void 0:f.type)&&(0,D.jsx)(ae.default,{recurrence:f.recurrence,onChange:k,disabled:l,focused:!1,labelOnly:!0})]}),(0,D.jsxs)(Z.Z,{children:[x.map(((e,s)=>(0,D.jsx)(pe,{automationStore:t,automationContextStore:n,contextItem:e,disabled:l},s))),(0,D.jsx)(O.Z,{isGray:!0,disabled:l,icon:Q.R,onClick:C,children:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Add context",id:"AssistantAutomationTrigger.addContextLabel"})})]}),"chat"!==(null==f?void 0:f.type)&&(0,D.jsx)(j.Z,{title:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Active",id:"AssistantAutomationTrigger.activeLabel"}),focused:!1,onClick:b,right:(0,D.jsx)(P.Z,{on:"active"===y,onClick:b})})]}):null}function ce(e){const{triggerType:t,style:n}=e;switch(t){case"chat":return(0,$.z)(n);case"recurrence":return(0,G.N)(n);case"collection_page_added":return(0,Q.R)(n);case"collection_page_edited":return(0,q.E)(n)}}function ue(e){window.__c={n:"TriggerTypeDropdownMenu"};const{automationStore:t,triggerType:n,onChange:s,parent:i}=e,o=(0,p.useIntl)(),r=(0,te.F)({maxWidth:360}),l=(0,a.VK)((()=>oe.filter((e=>function(e,t){const n=e.getParentPointer();if(!n)return!1;return"collection_page_added"!==t&&"collection_page_edited"!==t||n.table===J.v}(t,e)))),[t]).map((e=>({key:e,render:t=>(0,D.jsx)(j.Z,{...t,checkState:n===e,title:o.formatMessage(le[e])}),action:()=>{null==s||s(e),i.close()}})));return(0,D.jsx)(se.Z,{...r,children:(0,D.jsx)(ie.Z,{initialFocus:0,sections:[{key:0,render:e=>(0,D.jsx)(Z.Z,{enableActionSheetTitle:!0,...e}),items:l}],type:ie.i.Vertical})})}function pe(e){window.__c={n:"ExtraContextMenuItem"};const{automationContextStore:t,automationStore:n,contextItem:a,disabled:r}=e,l=(0,i.O7)(),d=(0,o.yK)((e=>({wrap:{display:"flex",alignItems:"center",padding:"4px 8px",borderRadius:4,marginBottom:4,fontSize:14},name:{marginRight:4}})),[]),c=(0,s.useCallback)((e=>{S.createAndCommit({userAction:"AssistantAutomationTrigger.handleNameChange",environment:l,perform:t=>{const s=n.getPropertiesStore().getKeyStore("assistant_context");S.applyOperation({store:s,operation:{pointer:s.pointer,command:"keyedObjectListUpdate",path:s.path,args:{value:{...a,name:e}}},transaction:t})}})}),[l,n,a]),u=(0,s.useCallback)((()=>{S.createAndCommit({userAction:"AssistantAutomationTrigger.handleRemoveClick",environment:l,perform:e=>{const t=n.getPropertiesStore().getKeyStore("assistant_context");S.applyOperation({store:t,operation:{pointer:t.pointer,command:"keyedObjectListRemove",path:t.path,args:{remove:{id:a.id}}},transaction:e})}})}),[l,n,a]);return(0,D.jsxs)(b.p,{allowSelectionWithin:!0,style:d.wrap,children:[(0,D.jsx)(v.bH,{value:a.name,style:d.name,disabled:r,onChange:c}),(0,D.jsx)(ge,{automationStore:n,automationContextStore:t,contextItem:a,disabled:r}),(0,D.jsx)(M.Z,{ariaLabel:"remove",icon:z.U,disabled:r,onClick:u})]})}function ge(e){window.__c={n:"ContextValuePicker"};const{automationStore:t,automationContextStore:n,contextItem:l,disabled:d}=e,c=(0,i.O7)(),u=(0,o.yK)((e=>({chevronIcon:{width:10,height:10,marginLeft:4,marginTop:2,fill:e.lightIconColor}})),[]),g=(0,a.VK)((()=>{if("collection_view_block"===l.type){if(!l.value)return;return N.G.createChildStore(n.context.parentRecordStore,l.value).getCollectionViewSourceCollectionStore()}if("page"===l.type){if(!l.value)return;return N.G.createChildStore(n.context.parentRecordStore,l.value)}(0,X.t1)(l)}),[l,n]),m=(0,a.VK)((()=>{if(g)return g instanceof N.NW?{type:"collection",collection:g.getSpaceShardedPointer()}:g instanceof N.G?{type:"page",page:g.getSpaceShardedPointer()}:void(0,X.t1)(g)}),[g]),h=(0,s.useCallback)(((e,s)=>{"collection"!==e.type&&"page"!==e.type||(S.createAndCommit({userAction:"ContextValuePicker.handleChange",environment:c,perform:s=>{const i=t.getPropertiesStore().getKeyStore("assistant_context");if("collection"===e.type){const t=N.NW.createChildStore(n.context.parentRecordStore,e.collection).getParentPointer();S.applyOperation({store:i,operation:{pointer:i.pointer,command:"keyedObjectListUpdate",path:i.path,args:{value:{...l,type:"collection_view_block",value:t}}},transaction:s})}else"page"===e.type?S.applyOperation({store:i,operation:{pointer:i.pointer,command:"keyedObjectListUpdate",path:i.path,args:{value:{...l,type:"page",value:e.page}}},transaction:s}):(0,X.t1)(e)}}),s.close())}),[t,n,l,c]);return(0,D.jsx)(r.ZP,{popupType:c.device.isMobile?r.Z4.SlideUp:r.Z4.Popup,renderOrigin:e=>(0,D.jsxs)(O.Z,{disabled:d,disabledFeedback:d,...e,children:[g?(0,D.jsx)(H.Z,{store:g}):(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Select a page or database",id:"ContextValuePicker.buttonPlaceholder"}),(0,E.i)(u.chevronIcon)]}),render:e=>(0,D.jsx)(W.L,{automationContextStore:n,onChange:t=>h(t,e),selectedTarget:m,skipVariables:!0,onClose:e.close})})}const me=(0,p.defineMessages)({addIconButtonAriaLabel:{defaultMessage:"Add icon",id:"AssistantAutomationMenu.addIconAriaLabel"},inputPlaceholder:{defaultMessage:"New workflow",id:"AssistantAutomationMenu.placeholder"}});function he(e){window.__c={n:"AssistantAutomationMenu"};const{automationStore:t,onClose:n,disabled:r,spaceId:l}=e,E=(0,i.O7)(),W=(0,p.useIntl)(),O=(0,o.yK)((e=>({header:{display:"flex",alignItems:"center",padding:"12px 12px 8px 12px",gap:6},scroller:{maxHeight:"75vh"},nameInputWrap:{flexGrow:"1"}})),[]),H=(0,a.VK)((()=>t.getNameStore()),[t]),N=(0,a.VK)((()=>{var e;return Boolean(null===(e=t.getProperties())||void 0===e?void 0:e.assistant_auto_confirm)}),[t]),z=(0,a.VK)((()=>{const e=t.getSpaceId(),n=t.getParentPointer();if(e&&n)return{...n,spaceId:e}}),[t]),q=(0,a.VK)((()=>t.getIconStore()),[t]),Q=(0,a.VK)((()=>(null==H?void 0:H.getValue())??""),[H]),G=(0,a.VK)((()=>t.canEdit()),[t]),{maybePersistedTransactionActions:$}=(0,k.$)({automationId:null==t?void 0:t.id,spaceId:l,defaultValue:void 0,persist:!0}),Y=(0,a.VK)((()=>null==q?void 0:q.getValue()),[q]),J=(0,s.useMemo)((()=>{if(z)return new K.L({type:"assistant",persisted:!0,automationStore:t,intl:W,parentRecordStore:t,parentPointer:z})}),[t,W,z]),X=(0,s.useCallback)((e=>{(0,_.ZP)({event:e,context:_.Af.EditorClick,callback:()=>{y.ZH(E),f.ZH(E)}})}),[E]),ee=(0,s.useCallback)(((e,n)=>{t&&S.createAndCommit({userAction:"AssistantAutomationMenu.updateProperty",environment:E,perform:s=>{h.sW({store:t.getPropertiesStore(),transaction:s,data:{[e]:n??null}})}})}),[t,E]),te=(0,s.useCallback)((e=>ee("icon",e)),[ee]),ne=(0,s.useCallback)((e=>ee("name",e)),[ee]),se=(0,s.useCallback)((e=>{m.$(E,{originRect:e.currentTarget.getBoundingClientRect(),originGap:4,popupWidth:R.FZ,popupHeight:R.kX,isSmallWidth:!1,title:W.formatMessage({defaultMessage:"Icon",id:"AssistantAutomationMenu.button.iconHeading"}),currentTab:"icon",tabs:[{type:"icon",onChange:e=>{te(e),m.Z()}},{type:"emoji",onChange:(e,t)=>{te(e),m.Z()}}],onDelete:()=>{te(void 0),m.Z()}})}),[E,te,W]),ie=(0,s.useCallback)((()=>{ee("assistant_auto_confirm",!N)}),[ee,N]),ae=(0,s.useCallback)((async()=>{await g.confirmUserAction({message:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Are you sure you want to delete this workflow?",id:"AssistantAutomationMenu.delete.cancelConfirmation"}),acceptLabel:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Delete",id:"AssistantAutomationMenu.delete.cancelConfirmation.delete"})})&&S.createAndCommit({userAction:"AssistantAutomationMenu.handleDelete",environment:E,perform:e=>{h.sW({store:t,transaction:e,data:{alive:!1}})}})}),[t,E]),oe=(0,s.useCallback)((async()=>{await(0,L.Zq)({environment:E,automationStore:t})}),[t,E]),re=r||!G;if(!J||!t)return null;const le=e=>(0,D.jsx)(M.Z,{ariaLabel:W.formatMessage(me.addIconButtonAriaLabel),style:{width:26,height:26},iconStyle:{width:16,height:16},hasBackground:!0,disabled:re,showShadow:!0,icon:e=>Y?(0,D.jsx)(A.Z,{disabled:!0,isEmptyPage:!1,size:20,icon:{icon:Y,pointer:t.pointer},style:e}):(0,d.o)(e),...(0,B.Z)(e??{},{onClick:se})}),ce=Y?le():(0,D.jsx)(F.ZP,{renderTooltip:()=>(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Add an icon",id:"AssistantAutomationMenu.button.addIcon"}),delayThreshold:300,render:le});return(0,D.jsx)("div",{onClick:X,children:(0,D.jsxs)(w.Z.Provider,{value:{automationContextStore:J,automationStore:t,disabled:!G,editorPlacement:void 0,editorWidth:500,suppressActionErrors:[],maybePersistedTransactionActions:$},children:[(0,D.jsxs)(b.p,{allowSelectionWithin:!0,style:O.header,children:[ce,(0,D.jsx)(v.bH,{onChange:ne,value:Q,disabled:re,placeholder:W.formatMessage(me.inputPlaceholder),wrapStyle:O.nameInputWrap}),(0,D.jsx)(C.Z,{onClick:n,children:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Done",id:"AssistantAutomationMenu.button.done"})})]}),(0,D.jsxs)(T.Z,{style:O.scroller,type:V.Z.Y,children:[(0,D.jsx)(Z.Z,{children:(0,D.jsx)(j.Z,{left:(0,c.p)({width:16}),title:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Test run",id:"AssistantAutomationMenu.testRun"}),focused:!1,onClick:oe})}),(0,D.jsx)(Z.Z,{title:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Trigger",id:"AssistantAutomationMenu.trigger"}),children:(0,D.jsx)(de,{automationStore:t,disabled:re,automationContextStore:J})}),(0,D.jsxs)(Z.Z,{title:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Steps",id:"AssistantAutomationMenu.steps"}),children:[(0,D.jsx)(x.AutomationButtonActionList,{contextStore:J,buttonPlacement:void 0,disabled:re,suppressErrors:[],onActionAdded:e=>{}}),(0,D.jsx)("div",{})]}),(0,D.jsxs)(Z.Z,{children:[(0,D.jsx)(I.Z,{left:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Owned by",id:"AssistantAutomationMenu.ownedBy"}),right:(0,D.jsx)(U,{automationStore:t,automationContextStore:J,disabled:r})}),(0,D.jsx)(j.Z,{title:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Apply edits without confirmation",id:"AssistantAutomationMenu.autoConfirm"}),focused:!1,onClick:ie,right:(0,D.jsx)(P.Z,{on:N,onClick:ie})}),(0,D.jsx)(j.Z,{left:(0,u.y)({width:16}),title:(0,D.jsx)(p.FormattedMessage,{defaultMessage:"Delete",id:"AssistantAutomationMenu.delete"}),focused:!1,onClick:ae})]})]})]})})}function fe(e){window.__c={n:"AssistantAutomationPopup"};const{automationStore:t,renderOrigin:n,buttonPopupStore:s,onClick:d}=e,c=(0,a.VK)((()=>{var e;return null===(e=l.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),u=(0,i.O7)(),p=(0,o.yK)((e=>({headerWrap:{display:"flex",alignItems:"center",margin:"0 4px"},editPopupWrap:{borderRadius:12,boxShadow:e.largeLightBoxShadow,width:500,minHeight:400}})),[]);return(0,D.jsx)(r.ZP,{popupType:u.device.isMobile?r.Z4.SlideUp:r.Z4.Popup,preventScaleTransition:!0,preventOpacityTransition:!0,disableMouseCapture:!0,popupWrapStyle:p.editPopupWrap,renderOrigin:n,onClick:d,render:e=>t&&c&&(0,D.jsx)(he,{automationStore:t,onClose:e.close,disabled:!1,spaceId:c}),buttonPopupStore:s})}},35245:(e,t,n)=>{n.d(t,{R3:()=>Yt,f6:()=>an});n(52262),n(24506);var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(49085),l=n(27328),d=n(41892),c=n(7057),u=n(53877),p=n(42875),g=n(64275),m=n(72126),h=n(70203),f=n(97880),y=n(82990),S=n(9291),x=n(24677),v=n(80402),w=n(993),k=n(98104),b=n(82530),C=n(63594),j=n(73063),M=n(53336),I=n(42402),A=n(37712),T=(n(95477),n(75179)),Z=n(57254),P=n(68657),F=n(34859),R=n(80444),_=n(98180),B=n(69454),V=n(45589),K=n(65147),L=n(60117),E=n(91437),W=n(71844),O=n(67973),H=n(54206),N=n(42899),D=(n(21703),n(26263)),U=n(1302),z=n(83176),q=n(88437),Q=n(47453),G=n(18101),$=n(98519),Y=n(55863),J=n(4615),X=n(80560),ee=n(56518),te=n(21273),ne=n(44950),se=n(28344),ie=n(2405),ae=n(42853),oe=n(35840),re=n(35294),le=n(31945),de=(n(57658),n(74487));const ce=de.object({required:{type:de.literal("everything")},optional:{}}),ue=de.object({required:{type:de.literal("teamspace"),teamId:de.uuid()},optional:{}}),pe=de.object({required:{type:de.literal("page"),pageId:de.uuid()},optional:{}}),ge=(de.union([ce,ue,pe]),{type:"everything"});var me=n(1743),he=n(56940),fe=n(68894),ye=n(3386),Se=n(68785),xe=n(78140),ve=n(72495),we=n(87279),ke=n(34232),be=n(63334),Ce=n(29798),je=n(41432),Me=n(50475),Ie=n(21202),Ae=n(29369),Te=n(68373);const Ze=new Set([je.Ti.page]),Pe=new Set([je.Ti.factory]);function Fe(e){const t=e.getType(),n=e.getModel();return Boolean(t&&Ze.has(t)&&!(0,Me.R5)(n))}function Re(e){const{searchScope:t,currentSpaceStore:n}=e;return"everything"===t.type?{type:"everything"}:"teamspace"===t.type?{type:"teamspace",teamStore:Te.zX.createChildStore(n,{id:t.teamId,table:Ae.e0,spaceId:n.id})}:"page"===t.type?{type:"page",pageStore:Te.G.createChildStore(n,{id:t.pageId,table:Ie.iU,spaceId:n.id})}:(0,f.t1)(t)}function _e(e){const{scopeMenuItem:t,currentSearchScope:n}=e;return"everything"===n.type?t.type===n.type:"teamspace"===n.type?t.type===n.type&&t.teamStore.id===n.teamId:"page"===n.type?t.type===n.type&&t.pageStore.id===n.pageId:void(0,f.t1)(n)}var Be=n(43261),Ve=n.n(Be),Ke=n(18466),Le=n(17215),Ee=n(59054),We=n(52275),Oe=n(32163),He=n(43765),Ne=n(77907),De=n(31278),Ue=n(45653),ze=n(74016),qe=n(85893);function Qe(e){window.__c={n:"AssistantScopedSearchMenuItemIcon"};const{item:t}=e,n=(0,a.VK)((()=>"everything"===t.type?{type:"everything",currentUserStore:R.default.state.currentUserStore}:"teamspace"===t.type?{type:"teamspace",teamStore:t.teamStore}:"page"===t.type?{type:"page",pageStore:t.pageStore,icon:t.pageStore.getIcon(),isEmptyPage:t.pageStore.isEmptyPage()}:(0,f.t1)(t)),[t]),s=(0,o.yK)((()=>({icon:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,width:22,height:18,marginRight:4,position:"relative"}})),[]);return"everything"===n.type?(0,qe.jsx)("div",{style:s.icon,children:(0,qe.jsx)(Ue.Z,{size:16,userStore:n.currentUserStore,style:{marginLeft:3}})}):"teamspace"===n.type?(0,qe.jsx)("div",{style:s.icon,children:(0,qe.jsx)(ze.p,{disabled:!0,store:n.teamStore,size:18})}):"page"===n.type?(0,qe.jsx)("div",{style:s.icon,children:(0,qe.jsx)(De.Z,{icon:n.icon,isEmptyPage:n.isEmptyPage,title:void 0,size:18,disabled:!0})}):(0,f.t1)(n)}var Ge=n(16184),$e=n(76798);function Ye(e){window.__c={n:"AssistantScopedSearchMenuItemTitle"};const{item:t}=e,n=(0,S.useIntl)(),s=(0,a.VK)((()=>R.default.state.mainEditorCurrentBlockStore),[]),i=(0,a.VK)((()=>{if("everything"===t.type)return{type:"everything"};if("teamspace"===t.type)return{type:"teamspace",store:t.teamStore,accessLevel:t.teamStore.getTeamAccessLevel()};if("page"===t.type){var e;const i=t.pageStore;return{type:"page",store:i,isCurrentPage:i.id===(null==s?void 0:s.id),title:(null===(e=i.getModel())||void 0===e?void 0:e.getRenderTitle({getRecordModel:i.getRecordModel,userTimeZone:(0,p.r)(),intl:n}))??(0,Le.Q2)(n)}}return(0,f.t1)(t)}),[t,s,n]),r=(0,o.yK)((e=>({lockIcon:{width:14,height:14,marginLeft:4,fill:e.mediumIconColor},recordTitle:{alignItems:"center",display:"flex",...y.Z.textOverflowStyle,minWidth:0,flex:1,marginRight:12},pageTitle:{...y.Z.textOverflowStyle,minWidth:0},lightText:{color:e.lightTextColor,whiteSpace:"nowrap"},hyphen:{display:"inline-block",marginLeft:4,marginRight:4}})),[]);return"everything"===i.type?(0,qe.jsx)("div",{style:r.recordTitle,children:(0,qe.jsx)(S.FormattedMessage,{id:"assistantScopedSearchMenu.everythingItem.title",defaultMessage:"Everything I can access"})}):"teamspace"===i.type?"private"===i.accessLevel?(0,qe.jsxs)("div",{style:r.recordTitle,children:[(0,qe.jsx)($e.Z,{store:i.store}),(0,Ge.Q)(r.lockIcon)]}):(0,qe.jsx)("div",{style:r.recordTitle,children:(0,qe.jsx)($e.Z,{store:i.store})}):"page"===i.type?i.isCurrentPage?(0,qe.jsx)("div",{style:r.recordTitle,children:(0,qe.jsx)(S.FormattedMessage,{id:"assistantScopedSearchPageMenuItem.currentPage.label",defaultMessage:"<title>{pageTitle}</title><light><spacearound>–</spacearound>Current page</light>",values:{pageTitle:i.title,title:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,qe.jsx)("div",{style:r.pageTitle,children:t})},light:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,qe.jsx)("div",{style:r.lightText,children:t})},spacearound:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,qe.jsx)("div",{style:r.hyphen,children:t})}}})}):(0,qe.jsx)("div",{style:r.recordTitle,children:(0,qe.jsx)($e.Z,{store:i.store})}):(0,f.t1)(i)}const Je=(0,S.defineMessages)({everythingItemTitle:{id:"assistantScopedSearchMenu.everythingItem.title",defaultMessage:"Everything I can access"},teamspaceFuzzyName:{id:"assistantScopedSearchMenu.teamspaceItem.label",defaultMessage:"Teamspace"},pageFuzzyName:{id:"assistantScopedSearchMenu.pageItem.label",defaultMessage:"Page"}});function Xe(e){window.__c={n:"AssistantScopedSearchQueryResults"};const{query:t,teamSpaceMenuItems:n,menuListStore:s,onSelect:o,setIsLoading:r}=e,l=(0,i.O7)(),d=(0,S.useIntl)(),c=(0,a.VK)((()=>R.default.state.currentSpaceStore),[]),[{value:u}]=(0,Ee.r5)((async()=>{if(!c)return;r(!0);const e=await Ne.deps.searchActions.loader(),n=await e.searchPageIds({environment:l,query:t,limit:20,spaceId:c.id,requireEditPermissions:!1,excludeTemplates:!0,source:"assistant_scoped_search_menu",boostRecentlyViewedPages:!0});return r(!1),n.results.map((e=>Te.G.createChildStore(c,{id:e,table:Ie.iU,spaceId:c.id}))).filter(Fe)}),[t,l,c,r]),g=(0,a.VK)((()=>{const e=(u??[]).map(((e,t)=>{const n={type:"page",pageStore:e};return{key:et(n,t),render:e=>(0,qe.jsx)(We.Z,{...e,icon:(0,qe.jsx)(Qe,{item:n}),title:(0,qe.jsx)(Ye,{item:n})}),action:()=>{o(n)}}}));if(e.length>0)return{key:"search results",render:e=>(0,qe.jsx)(ve.Z,{...e,title:(0,qe.jsx)(S.FormattedMessage,{id:"assistantScopedSearchQueryResults.pageResults.section.title",defaultMessage:"Pages"})}),items:e}}),[u,o]),m=[(0,a.VK)((()=>{const e=function(e){const{intl:t,totalScopedMenuItems:n,userSearchQuery:s}=e;if(!s)return n;const i={extract:e=>Ke.Z.withListenerIgnored((()=>{if("everything"===e.type)return t.formatMessage(Je.everythingItemTitle);if("teamspace"===e.type){var n;return`${(null===(n=e.teamStore.getModel())||void 0===n?void 0:n.getRenderTitle())??""} ${t.formatMessage(Je.teamspaceFuzzyName)}`}if("page"===e.type){var s;const{pageStore:n}=e;return`${(null===(s=e.pageStore.getModel())||void 0===s?void 0:s.getRenderTitle({intl:t,userTimeZone:(0,p.r)(),getRecordModel:n.getRecordModel}))??(0,Le.Q2)(t)} ${t.formatMessage(Je.pageFuzzyName)}`}return(0,f.t1)(e)}))};return Ve().filter(s,n,i).map((e=>e.original))}({intl:d,totalScopedMenuItems:n,userSearchQuery:t}).map(((e,t)=>({key:et(e,t),render:t=>(0,qe.jsx)(We.Z,{...t,icon:(0,qe.jsx)(Qe,{item:e}),title:(0,qe.jsx)(Ye,{item:e})}),action:()=>{o(e)}})));if(e.length>0)return{key:"fuzzy results",render:e=>(0,qe.jsx)(ve.Z,{...e,title:(0,qe.jsx)(S.FormattedMessage,{id:"assistantScopedSearchQueryResults.teamResults.section.title",defaultMessage:"Teamspaces"})}),items:e}}),[n,d,t,o]),g].filter(f.$K);return 0===m.length?(0,qe.jsx)(ve.Z,{children:(0,qe.jsx)(He.Z,{title:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"No results",id:"assistantScopeSearchQueryResults.noResults.label"})})}):(0,qe.jsx)(Oe.Z,{type:Oe.i.Vertical,initialFocus:Boolean(t)?0:void 0,sections:m,store:s})}function et(e,t){return"everything"===e.type?`${e.type}_${t.toString()}`:"teamspace"===e.type?`${e.type}_${e.teamStore.id}`:"page"===e.type?`${e.type}_${e.pageStore.id}`:(0,f.t1)(e)}var tt=n(64921),nt=n(5210),st=n(35026);function it(e){window.__c={n:"AssistantScopedSearchOutlinerItem"};const{item:t,onClick:n,showToggle:r}=e,l=e.depth??0,d=(0,o.Fg)(),{isMobile:c}=(0,i.Fy)(),[u,p]=s.useState(!1),g=(0,a.VK)((()=>_.Z.getActiveAssistantConfigurationStore()),[]),m=(0,a.VK)((()=>{var e;return(null==g||null===(e=g.state)||void 0===e?void 0:e.searchScope)??ge}),[g]),h=s.useMemo((()=>_e({scopeMenuItem:t,currentSearchScope:m})),[t,m]),y=s.useCallback((()=>{n(t)}),[n,t]),x=s.useCallback((()=>{p(!u)}),[u,p]),v=function(e){const{depth:t,isMobile:n}=e;return(0,o.yK)((e=>({outlinerItem:{display:"flex",flexDirection:"row",fontSize:14,height:28,paddingLeft:at(t),color:e.regularTextColor,alignItems:"center",...n&&{fontSize:16,height:56,backgroundColor:e.contentBackground,borderBottom:`1px ${e.darkDividerColor} solid`}},noChildrenLabelItem:{paddingLeft:at(t)+24,fontSize:14,paddingBottom:6.5,color:e.lightTextColor,...n&&{paddingBottom:void 0,fontSize:16,height:56,backgroundColor:e.contentBackground,borderBottom:`1px ${e.darkDividerColor} solid`}},checkmarkIcon:{marginRight:12,color:e.lightIconColor,width:14,height:"auto",justifySelf:"right"}})),[t,n])}({depth:l,isMobile:c}),w=s.useMemo((()=>!!r&&("everything"!==t.type&&("teamspace"===t.type||"page"===t.type||(0,f.t1)(t)))),[t,r]),k=(0,a.VK)((()=>"everything"===t.type||"teamspace"===t.type||("page"===t.type?Fe(t.pageStore):(0,f.t1)(t))),[t]),b=(0,a.VK)((()=>"everything"===t.type?[]:"teamspace"===t.type?t.teamStore.getTeamPageStores():"page"===t.type?(0,st.Q2)(t.pageStore,Ze,Pe):(0,f.t1)(t)),[t]);if(!k)return null;const C=0!==b.length?(0,qe.jsx)(qe.Fragment,{children:b.map((e=>(0,qe.jsx)(it,{item:{type:"page",pageStore:e},onClick:e=>n(e),depth:l+1,showToggle:r},e.id)))}):(0,qe.jsx)("div",{style:v.noChildrenLabelItem,children:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"No pages inside",id:"assistantScopedSearchOutlinerItem.NoPagesInside.placeholder"})});return(0,qe.jsxs)(qe.Fragment,{children:[(0,qe.jsx)(tt.Z,{onClick:y,children:(0,qe.jsxs)("div",{style:v.outlinerItem,children:[w&&(0,qe.jsx)(nt.Z,{isSidebar:!1,fill:!0,icon:"chevron",open:u,color:d.mediumIconColor,onClick:x}),(0,qe.jsx)(Qe,{item:t}),(0,qe.jsx)(Ye,{item:t}),h&&(0,$.k)(v.checkmarkIcon)]})}),u&&l<20&&C]})}function at(e){return 14*(e+1)}function ot(e){window.__c={n:"AssistantScopedSearchSuggestedResults"};const{suggestedScopeMenuItems:t,teamSpaceMenuItems:n,onSelect:s}=e,i=(0,o.yK)((()=>({mobileSectionTitleStyle:{lineHeight:"14px"}})),[]);return(0,qe.jsxs)(qe.Fragment,{children:[(0,qe.jsx)(ve.Z,{mobileTitleStyle:i.mobileSectionTitleStyle,title:(0,qe.jsx)(S.FormattedMessage,{id:"assistantScopedSearchSuggestedResults.suggestions.title",defaultMessage:"Suggestions"}),children:t.map(((e,t)=>(0,qe.jsx)(it,{showToggle:!1,item:e,onClick:e=>{s(e)}},`${e.type}_${t}`)))}),(0,qe.jsx)(ve.Z,{mobileTitleStyle:i.mobileSectionTitleStyle,title:(0,qe.jsx)(S.FormattedMessage,{id:"assistantScopedSearchSuggestedResults.teamspaces.title",defaultMessage:"Teamspaces and pages"}),children:n.map(((e,t)=>(0,qe.jsx)(it,{showToggle:!0,item:e,onClick:e=>{s(e)}},`${e.type}_${t}`)))})]})}const rt=(0,S.defineMessages)({inputPlaceholder:{id:"assistantScopedSearchMenu.inputMenuItem.placeholder",defaultMessage:"Find in…"}});function lt(e){window.__c={n:"AssistantScopedSearchMenu"};const{buttonPopupParent:t,onSelect:n,analyticsSource:o}=e,r=(0,i.O7)(),{isPhone:l}=(0,i.Fy)(),[d,c]=s.useState(""),[u,p]=s.useState(!1),g=(0,a.qz)(void 0,Ce.Z),m=(0,a.qz)(void 0,be.Z),h=(0,a.VK)((()=>_.Z.getActiveAssistantConfigurationStore()),[]),y=(0,a.VK)((()=>{var e;return(null==h||null===(e=h.state)||void 0===e?void 0:e.searchScope)??ge}),[h]),x=(0,a.VK)((()=>R.default.state.currentSpaceStore),[]),v=(0,a.VK)((()=>R.default.state.currentSpaceViewStore),[]),w=(0,a.VK)((()=>v?v.getTeamsStores().map((e=>({type:"teamspace",teamStore:e}))):[]),[v]),k=(0,a.VK)((()=>R.default.state.mainEditorCurrentBlockStore),[]),b=(0,a.VK)((()=>{const e=[{type:"everything"}];k&&Fe(k)&&e.push({type:"page",pageStore:k});return e.some((e=>_e({scopeMenuItem:e,currentSearchScope:y})))||!x?e:[...e,Re({searchScope:y,currentSpaceStore:x})]}),[k,x,y]);s.useEffect((()=>(L.assistantAnalyticsActions.trackScopeSearchMenuOpen(r,{from:o}),()=>{L.assistantAnalyticsActions.trackScopeSearchMenuClose(r,{from:o})})),[r,o]);const C=s.useCallback((()=>{t.close()}),[t]),j=s.useCallback((e=>{c(e),g.update((e=>({...e,focus:{section:0,indexLocal:0,indexGlobal:0}})))}),[c,g]),M=s.useCallback((async e=>{let s;if("everything"===e.type?s=e:"teamspace"===e.type?s={type:e.type,teamId:e.teamStore.id}:"page"===e.type?s={type:e.type,pageId:e.pageStore.id}:(0,f.t1)(e),h)h.setSearchScope(s);else{const{sessionId:e}=await(0,ne.resetAndInitializeAssistantSession)({environment:r}),t=_.Z.getSessionContext(e);null==t||t.assistantConfigurationStore.setSearchScope(s)}L.assistantAnalyticsActions.trackScopeSearchToggle(r,{from:o,scope:s}),t.close(),null==n||n()}),[n,h,t,r,o]);let I;const A=(0,qe.jsx)(dt,{onCancel:C,query:d,onChange:j,isLoading:u});let T;return I=l?A:(0,qe.jsx)(ve.Z,{isInput:!0,children:A}),T=l?{menuType:we.og.Modal,right:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"Done",id:"assistantScopedSearch.rightDoneButton.label"}),onClickRight:C,header:I}:{menuType:we.og.Popup,width:300,maxHeight:325,header:I},(0,qe.jsxs)(me.Z,{capture:!0,allowMenuList:!0,allowEsc:!0,allowTabUntab:!1,allowUndo:!1,children:[(0,qe.jsx)(ye.Z,{capture:!0,onEsc:C}),(0,qe.jsx)(he.Z,{store:m,ignoreBlockSelection:!1,capture:!1,restoreSelection:!1,render:()=>(0,qe.jsx)(xe.Z,{...T,children:d?(0,qe.jsx)(Xe,{query:d,teamSpaceMenuItems:w,menuListStore:g,onSelect:M,setIsLoading:p}):(0,qe.jsx)(ot,{suggestedScopeMenuItems:b,teamSpaceMenuItems:w,onSelect:M})})})]})}function dt(e){window.__c={n:"ScopedSearchInputMenuItem"};const{isLoading:t,onCancel:n,query:s,onChange:a}=e,o=(0,S.useIntl)(),{isPhone:r}=(0,i.Fy)(),l=(0,ke.Z)(t,400,0);return(0,qe.jsx)(fe.ZP,{style:{marginBottom:-2},onCancel:n,focus:!r||void 0,focusAfterAnimation:!0,value:s,onChange:e=>{a(e.target.value)},placeholder:o.formatMessage(rt.inputPlaceholder),inputLeft:(0,qe.jsx)(fe.f_,{icon:oe.R}),inputRight:l&&(0,qe.jsx)(Se.Z,{style:{marginRight:2}})})}function ct(e){window.__c={n:"AssistantFeedbackFindInActionButton"};const{onSelect:t}=e,n=(0,re.d)(),s=(0,o.yK)((e=>({buttonContainer:{display:"flex",alignItems:"center"},chevronDown:{fill:e.lightIconColor,width:12,height:"auto",marginLeft:6}})),[]);return(0,qe.jsx)(le.ZP,{popupType:n,placementToOrigin:le.pO.Top,alignmentToOrigin:le.vR.Center,renderOrigin:e=>(0,qe.jsx)(ie.Z,{...e,style:s.buttonContainer,icon:oe.R,title:(0,qe.jsxs)(qe.Fragment,{children:[(0,qe.jsx)(S.FormattedMessage,{id:"assistantFeedback.actionButton.findIn",defaultMessage:"Find in"}),(0,ae.i)(s.chevronDown)]})}),render:e=>(0,qe.jsx)(lt,{buttonPopupParent:e,onSelect:t,analyticsSource:"find_in"})})}function ut(e){window.__c={n:"AssistantFeedbackBar"};const{type:t,renderAsFullPage:n}=e,r=(0,i.O7)(),[l,d]=(0,s.useState)((()=>(0,J.ZP)())),c=(0,a.VK)((()=>C.Z.state),[]),u=(0,a.VK)((()=>te.Z.isXMLAssistantEnabled(void 0)),[]),p=(0,a.VK)((()=>te.Z.showScopedSearch()),[]),g=(0,s.useCallback)((async()=>{const e=_.Z.getActiveSessionId();e&&(ne.saveFeedback({environment:r,inferenceId:l,type:"assistant_accept_edits",sessionId:e}),await ne.commitPreviewAssistantStep({environment:r,sessionId:e}),await ne.applyUncommittedOperations({environment:r,sessionId:e}))}),[r,l]),m=(0,s.useCallback)((async()=>{const e=_.Z.getActiveSessionId();e&&(ne.saveFeedback({environment:r,inferenceId:l,type:"assistant_fix_errors",sessionId:e}),await ne.commitPreviewAssistantStep({environment:r,sessionId:e}))}),[r,l]),h=(0,s.useCallback)((async()=>{const e=_.Z.getActiveSessionId();e&&(ne.saveFeedback({environment:r,inferenceId:l,type:"assistant_undo",sessionId:e}),await ne.commitPreviewAssistantStep({environment:r,sessionId:e}),ne.resetUncommittedOperations({environment:r,sessionId:e}))}),[r,l]),y=(0,s.useCallback)((async()=>{const e=_.Z.getActiveSessionId();if(!e)return;const{assistantRuntimeStore:n}=_.Z.getSessionContextOrThrow(e);if(!n.state)throw new Error("No assistant runtime or configuration context found.");ne.saveFeedback({environment:r,inferenceId:l,type:"assistant_retry",sessionId:e}),"search_result_chat"===t&&p?await ne.retryLastHumanStep({environment:r,sessionId:e}):await ne.retryNextAssistantSteps({environment:r,sessionId:e})}),[r,l,t,p]),x=(0,s.useCallback)((async()=>{const e=_.Z.getActiveSessionId();e&&(ne.saveFeedback({environment:r,inferenceId:l,type:"assistant_retry_with_scoped_search",sessionId:e}),await ne.retryLastHumanStep({environment:r,sessionId:e}))}),[r,l]),v=(0,s.useCallback)((()=>{const e=_.Z.getActiveAssistantRuntimeState(),t=_.Z.getActiveAssistantConfigurationState(),n=null==e?void 0:e.temporaryClientSteps.find((e=>"assistantChat"===e.type||"assistantChatText"===e.type));if(n){if("assistantChatText"===n.type)X.RD({environment:r,stringValue:n.text??"",copiedMessage:X.tq.copiedQnAMessageToClipboard});else if("assistantChat"===n.type){const e=(0,K.me)({environment:r,clientStep:n,citationOrdering:void 0,inMemoryRecordCache:new D.Z({name:"assistantChat.clipboard"})}),t=(0,ee.X4)({rootBlock:{...e[0].pointer,spaceId:e[0].getSpaceId()},blockValues:e.map((e=>e.getValue())).filter(f.$K),getRecordValue:e[0].getRecordValue,isWindows:r.device.isWindows,markdownLinkifyIt:void 0});X.RD({environment:r,stringValue:t.markdown??"",copiedMessage:X.tq.copiedQnAMessageToClipboard})}else(0,f.t1)(n);t&&se.trackQnACopyClick(r,{sessionId:t.sessionId})}}),[r]),w=(0,s.useCallback)((async()=>{const e=_.Z.getActiveSessionId();e&&(b.createAndCommit({userAction:"assistant.createPage",environment:r,perform:t=>{ne.createPageFromAssistantChat({environment:r,sessionId:e,transaction:t})}}),await ne.commitPreviewAssistantStep({environment:r,sessionId:e}),await U.default.afterNextFlush(),await U.default.afterNextFlush(),await ne.updateContextForCurrentPageIfNecessary({environment:r,sessionId:e,autoLoadPage:!0}))}),[r]),k=(0,s.useCallback)((async()=>{const e=_.Z.getActiveSessionId();e&&(b.createAndCommit({userAction:"assistant.insertIntoPage",environment:r,perform:t=>{ne.insertAssistantChatIntoCurrentPage({environment:r,sessionId:e,transaction:t})}}),await ne.commitPreviewAssistantStep({environment:r,sessionId:e}))}),[r]),j=(0,o.yK)((e=>({wrap:{display:"flex",marginTop:8,marginBottom:0,gap:6}})),[]);return(0,qe.jsxs)("div",{style:j.wrap,children:["accept_edits"===t&&(0,qe.jsxs)(qe.Fragment,{children:[(0,qe.jsx)(ie.Z,{icon:$.k,onClick:g,title:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"Accept all",id:"assistant.acceptAllButton"})}),(0,qe.jsx)(ie.Z,{icon:Y.s,onClick:h,title:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"Undo all",id:"assistant.undoAllButton"})})]}),"error"===t&&(0,qe.jsx)(ie.Z,{icon:z.z,onClick:m,title:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"Fix errors",id:"assistant.fixErrorsButton"})}),("chat"===t||"search_result_chat"===t)&&(0,qe.jsxs)(qe.Fragment,{children:[(0,qe.jsx)(ie.Z,{icon:q.a,onClick:v,title:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"Copy",id:"assistant.copyButton"})}),u&&(n?(0,qe.jsx)(ie.Z,{icon:Q.R,onClick:w,title:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"Create page",id:"assistant.createPageButton"})}):(0,qe.jsx)(ie.Z,{icon:Q.R,onClick:k,title:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"Insert",id:"assistant.insertButton"})}))]}),c&&(0,qe.jsxs)(qe.Fragment,{children:[(0,qe.jsx)(ie.Z,{icon:G.b,onClick:y,title:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"Try again",id:"assistant.retryButton"})}),"search_result_chat"===t&&p&&(0,qe.jsx)(ct,{onSelect:x})]})]})}var pt=n(33932),gt=n(70771),mt=n(5175);function ht(e){window.__c={n:"AssistantInlineSkillSection"};const{skillsWrapStyle:t,skillIconStyle:n,clientSkills:a}=e,o=(0,i.O7)(),r=(0,s.useCallback)((async e=>{await(0,gt.OZ)({environment:o,clientSkill:e})}),[o]),l=(0,s.useCallback)((()=>{(0,pt.navigateToView)({view:"skillSwitcher"})}),[]);return(0,qe.jsx)(ve.Z,{desktopTitleStyle:{paddingLeft:2},title:(0,qe.jsx)(S.FormattedMessage,{id:"assistantChat.thingsToTry",defaultMessage:"Things to try"}),children:(0,qe.jsxs)("div",{style:t,children:[m.xH(W.pageChatSections.map((e=>e.skills[0]))).map((e=>{const t=a.find((t=>t.skillType===e));if(t)return(0,qe.jsx)(ie.Z,{icon:W.skillIconMap[t.skillType],iconStyle:n,onClick:async()=>{await r(t)},title:(0,qe.jsx)(mt.Z,{clientSkill:t})},t.key)})),(0,qe.jsx)(ie.Z,{onClick:l,title:"More"})]})})}var ft=n(72263),yt=n(42922),St=n(99622),xt=n(12205),vt=n(80671),wt=n(44041),kt=n(35057),bt=n(88280);function Ct(e){window.__c={n:"AssistantBlueLink"};const t=(0,o.yK)((e=>({assistantBlueLink:{color:e.text.uiBluePrimary,cursor:"pointer",fontWeight:600}})),[]);return(0,qe.jsx)("span",{style:t.assistantBlueLink,onClick:e.onClick,children:e.children})}const jt=(0,S.defineMessages)({requestAccessButton:{id:"AssistantLimitReached.requestAccess.button",defaultMessage:"Request access"},requestAccessMessage:{id:"AssistantLimitReached.requestAccess.message",defaultMessage:"You’ve run out of free AI responses. Request the <bold>Notion AI add-on</bold> from your workspace owner."},requestAccessReceived:{id:"AssistantLimitReached.requestAccess.received",defaultMessage:"Thank you! We received your request."},unavailableMessage:{id:"AssistantLimitReached.unavailable.message",defaultMessage:"You’ve run out of free AI responses. Reach out to your account representative to purchase the Notion AI add-on."},upsellButton:{id:"AssistantLimitReached.upsell.button",defaultMessage:"Get unlimited AI"},upsellMessage:{id:"AssistantLimitReached.upsell.message",defaultMessage:"You’ve run out of free AI responses. Get the <bold>Notion AI add-on</bold> so that I can answer an unlimited number of questions for you!"}});function Mt(e){window.__c={n:"AssistantLimitReached"};const t=(0,xt.J)(),n=(0,St.Y)(bt.subscriptionDataStoreInstance);return n&&t?(0,qe.jsx)(Tt,{...e}):n&&!t?(0,qe.jsx)(It,{...e}):!n&&t?(0,qe.jsx)(At,{...e}):n||t?null:(0,qe.jsx)(It,{...e})}function It(e){window.__c={n:"RequestAccess"};const t=(0,i.O7)(),[n,o]=(0,s.useState)(!1),r=(0,S.useIntl)(),l=Zt(),d=(0,a.VK)((()=>R.default.state.currentSpaceStore),[]),c=(0,s.useCallback)((()=>{d&&((0,vt.jw)({environment:t,spaceStore:d,from:"ai_qna_limit_in_app"}),o(!0))}),[t,d]);if(n)return(0,qe.jsx)("div",{style:l.wrapper,children:(0,qe.jsx)(H.H,{...e,clientStep:{type:"assistantLimitReached",message:r.formatMessage(jt.requestAccessReceived),inferenceId:"hard-coded"}})});const u=r.formatMessage(jt.requestAccessMessage,{bold:e=>(0,qe.jsx)(Ct,{onClick:c,children:e})});return(0,qe.jsxs)("div",{style:l.wrapper,children:[(0,qe.jsx)(H.H,{...e,clientStep:{type:"assistantLimitReached",message:u,inferenceId:"hard-coded"}}),(0,qe.jsxs)(yt.Z,{style:l.button,onClick:c,children:[(0,ft._)(l.icon),r.formatMessage(jt.requestAccessButton)]})]})}function At(e){window.__c={n:"Upsell"};const t=(0,i.O7)(),n=Zt(),a=(0,S.useIntl)(),o=(0,s.useCallback)((()=>{wt.y(t,{from:"ai_qna_limit_in_app",for:(0,kt.zt)(),addOnFeature:"ai"})}),[t]),r=a.formatMessage(jt.upsellMessage,{bold:e=>(0,qe.jsx)(Ct,{onClick:o,children:e})});return(0,qe.jsxs)("div",{style:n.wrapper,children:[(0,qe.jsx)(H.H,{...e,clientStep:{type:"assistantLimitReached",message:r,inferenceId:"hard-coded"}}),(0,qe.jsxs)(yt.Z,{style:n.button,onClick:o,children:[(0,ft._)(n.icon),a.formatMessage(jt.upsellButton)]})]})}function Tt(e){window.__c={n:"Unavailable"};const t=Zt(),n=(0,S.useIntl)();return(0,qe.jsx)("div",{style:t.wrapper,children:(0,qe.jsx)(H.H,{...e,clientStep:{type:"assistantLimitReached",message:n.formatMessage(jt.unavailableMessage),inferenceId:"hard-coded"}})})}function Zt(){return(0,o.yK)((()=>({button:{alignSelf:"flex-start",borderRadius:100,display:"flex",gap:6,marginTop:6,marginBottom:6,padding:"7px 12px"},icon:{width:16,height:16},wrapper:{marginTop:4,display:"flex",flexDirection:"column"}})),[])}var Pt=n(67593),Ft=n(16540),Rt=n(14309),_t=n(16880),Bt=n(84169),Vt=n(25888),Kt=n(89024),Lt=n(26388),Et=n(4023),Wt=n(41625),Ot=n(2108);function Ht(e){window.__c={n:"AssistantSuggestionBar"};const{assistantChatSectionsState:t,handleSubmitSuggestedItem:n}=e,{isMobile:r}=(0,i.Fy)(),[l,d]=(0,s.useState)(void 0),[c,u]=(0,s.useState)(!1),p=(0,Ot.Dw)(),g=(0,a.VK)((()=>{const e=[];if(t.shouldShowSuggestedQuestionsPageSection)for(const t of p)e.push({type:"suggested_question",question:t});return t.shouldShowHelpRedirectBar&&e.push({type:"help_redirect_bar"}),e}),[t,p]),m=(0,s.useMemo)((()=>c?g:g.slice(0,l)),[g,c,l]),h=(0,a.VK)((()=>te.Z.showScopedSearch()),[]),f=(0,s.useRef)(null);(0,s.useEffect)((()=>{if(f&&null!==f.current){var e;const n=f.current.offsetTop,s=null===(e=f.current.firstChild)||void 0===e?void 0:e.offsetHeight;for(let e=0;e<g.length;e++){var t;const i=null===(t=f.current)||void 0===t?void 0:t.children[e];if(!i)continue;const a=i.offsetTop;if(Math.floor((a-n)/s)+1>3){d(e);break}}}}),[g]);const y=0===m.length,x=1===m.length&&m.some((e=>{let{type:t}=e;return"help_redirect_bar"===t})),v=function(e){const{shouldShowScopedSearch:t,hasVerticalMargin:n}=e;return(0,o.yK)((()=>({wrap:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:8},sectionMenuItem:{paddingLeft:t?0:2,...!n&&{marginTop:0,marginBottom:0}}})),[t,n])}({shouldShowScopedSearch:h,hasVerticalMargin:y||!x});return y&&!h?null:r&&h?(0,qe.jsx)(Nt,{}):(0,qe.jsx)(ve.Z,{desktopTitleStyle:v.sectionMenuItem,title:h?(0,qe.jsx)(Nt,{}):x?void 0:(0,qe.jsx)(S.FormattedMessage,{id:"assistantChat.suggested_questions_section_title",defaultMessage:"Ask about"}),children:(0,qe.jsxs)("div",{style:v.wrap,ref:f,children:[m.map(((e,t)=>"suggested_question"===e.type?(0,qe.jsx)(Lt.ZP,{renderTooltip:()=>(0,qe.jsx)("div",{style:{maxWidth:220,whiteSpace:"normal"},children:e.question}),placement:Et.u.Top,render:t=>(0,qe.jsx)(ie.Z,{onClick:()=>n(e.question),title:e.question.length>40?`${e.question.slice(0,40)}...`:e.question,tooltipEvents:e.question.length>40?t:void 0})},`${t}_${e}`):(0,qe.jsx)(Dt,{hasVerticalMargin:x},"-1_help"))),!c&&l&&(0,qe.jsx)(ie.Z,{onClick:()=>u(!0),title:(0,qe.jsx)(S.FormattedMessage,{id:"assistantSuggestionBar.more.title",defaultMessage:"More"}),lightGrey:!0},"More")]})})}function Nt(){window.__c={n:"ScopedSearchToggle"};const e=(0,S.useIntl)(),{isMobile:t}=(0,i.Fy)(),n=(0,a.VK)((()=>R.default.state.currentSpaceStore),[]),s=(0,a.VK)((()=>{const e=_.Z.getActiveAssistantConfigurationState();return(null==e?void 0:e.searchScope)??ge}),[]),r=(0,a.VK)((()=>{if(n){var t;if("everything"===s.type)return null===(t=n.getModel())||void 0===t?void 0:t.getRenderTitle();if("teamspace"===s.type){var i;return null===(i=Te.zX.createChildStore(n,{id:s.teamId,table:Ae.e0,spaceId:n.id}).getModel())||void 0===i?void 0:i.getRenderTitle()}if("page"===s.type){var a;const t=Te.G.createChildStore(n,{id:s.pageId,table:Ie.iU,spaceId:n.id});return null===(a=t.getModel())||void 0===a?void 0:a.getRenderTitle({getRecordModel:t.getRecordModel,userTimeZone:(0,p.r)(),intl:e})}return(0,f.t1)(s)}}),[s,n,e]),l=(0,re.d)(),d=(0,o.yK)((()=>({buttonPopupContainer:{padding:6,borderRadius:4},chevron:{width:10,height:"auto"},mobileButtonPopupContainer:{marginTop:6,width:void 0,maxWidth:"max-content",minWidth:0,...y.Z.textOverflowStyle},mobileTitleContainer:{minWidth:0,flexShrink:1,marginRight:8,...y.Z.textOverflowStyle}})),[]),c=r?(0,qe.jsx)(S.FormattedMessage,{id:"assistantSuggestionBar.scopeSearch.label",defaultMessage:"Ask AI in {scopeTitle}",values:{scopeTitle:r}}):(0,qe.jsx)(S.FormattedMessage,{id:"assistantSuggestionBar.scopeSearch.fallbackLabel",defaultMessage:"Ask AI"});return(0,qe.jsx)(le.ZP,{popupType:l,renderOrigin:e=>t?(0,qe.jsx)(ie.Z,{...e,style:d.mobileButtonPopupContainer,title:(0,qe.jsxs)(qe.Fragment,{children:[(0,qe.jsx)("div",{style:d.mobileTitleContainer,children:c}),(0,_t.R)(d.chevron)]})}):(0,qe.jsx)(tt.Z,{...e,style:d.buttonPopupContainer,children:(0,qe.jsxs)(Kt.jX,{direction:"row",gap:6,children:[(0,qe.jsx)("div",{style:y.Z.textOverflowStyle,children:c}),(0,ae.i)(d.chevron)]})}),render:e=>(0,qe.jsx)(lt,{buttonPopupParent:e,analyticsSource:"main_chat_suggestion_bar"})})}function Dt(e){window.__c={n:"AssistantHelpRedirectBar"};const t=(0,i.O7)(),n=(0,o.yK)((()=>({wrap:{display:"flex",marginTop:e.hasVerticalMargin?8:0,marginBottom:e.hasVerticalMargin?6:0,gap:6}})),[e.hasVerticalMargin]);return(0,qe.jsx)("div",{style:n.wrap,children:(0,qe.jsx)(ie.Z,{icon:e=>(0,Bt.m)({...e,fontWeight:500}),onClick:()=>{Wt.G.update((e=>({...e,open:!0})));const e=_.Z.getActiveAssistantConfigurationState();e&&Vt.Ar(t,{qnaSessionId:e.sessionId,from:"qna_modal_chat"})},title:(0,qe.jsx)(S.FormattedMessage,{defaultMessage:"Get Notion help",id:"AssistantChat.routeToNotionHelp"})})})}var Ut=n(78158),zt=n(98963),qt=n(42915),Qt=n(52284);function Gt(e){window.__c={n:"InlineAutomationSection"};const{spaceStore:t}=e,n=(0,i.O7)(),r=(0,o.yK)((e=>({wrap:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:8},icon:{}})),[]),l=(0,a.VK)((()=>Qt.z.getAutomationIds().slice(0,3).map((e=>Te.Mz.createChildStore(t,{table:zt.cv,id:e,spaceId:t.id})))),[t]),d=(0,s.useCallback)((async e=>{await(0,qt.Zq)({environment:n,automationStore:e})}),[n]),c=(0,s.useCallback)((()=>{(0,pt.navigateToView)({view:"automations"})}),[]);return(0,qe.jsx)(ve.Z,{desktopTitleStyle:{paddingLeft:2},title:(0,qe.jsx)(S.FormattedMessage,{id:"assistantChat.workflows",defaultMessage:"Workflows"}),children:(0,qe.jsxs)("div",{style:r.wrap,children:[l.map((e=>(0,qe.jsx)(Ut.O,{automationStore:e,onClick:async()=>{await d(e)}},e.id))),(0,qe.jsx)(ie.Z,{onClick:c,title:"More"})]})})}const $t=(0,S.defineMessages)({qnaInputPlaceholder:{id:"assistantChat.qnaInputPlaceholder.text",defaultMessage:"Ask a question…"},assistantInputPlaceholder:{id:"assistantChat.assistantInputPlaceholder.text",defaultMessage:"Ask for anything, @mention pages or people…"},qnaAssistantChatText:{id:"assistantChat.qnaWelcomeMessage.text",defaultMessage:"Hi {firstName}! Ask me about anything in {workspaceName}. I’ll find an answer in the pages you have access to."},assistantBetaDisclaimerText:{id:"assistantChat.qnaWelcomeMessage.disclaimerText",defaultMessage:"I’m still in Beta, so please use the 👍 👎 buttons to help me improve."}});function Yt(e){window.__c={n:"AssistantChat"};const{renderAsFullPage:t=!1,onBackspaceOnEmptyInput:n}=e,o=Boolean(e.isQuickSearchMode),r=(0,i.O7)(),{isMobile:d}=r.device,c=(0,s.useRef)(void 0),u=(0,S.useIntl)(),p=(0,a.VK)((()=>_.Z.getActiveAssistantRuntimeState()),[]),f=(0,a.VK)((()=>_.Z.getActiveAssistantConfigurationState()),[]),y=(0,a.VK)((()=>R.default.state.mainEditorCurrentBlockStore),[]),C=(0,a.VK)((()=>R.default.state.currentSpaceStore),[]),Z=(0,a.VK)((()=>(0,l.w_)(r.TabbedRouterStore.state)),[r]),[E,W]=(0,s.useState)(!1),O=null==p?void 0:p.selectedSkill,{store:H}=(0,P.Cl)({initialValue:void 0,onChange:m.yR}),N=(0,Ot.AP)({renderAsFullPage:t,isQuickSearchMode:o}),D=(0,s.useCallback)((()=>{c.current&&(c.current.scrollToBottom(),W(!1))}),[W]),U=(0,s.useCallback)((async(e,t)=>{e&&await(0,K.AF)({environment:r,currentSkill:O,snapToBottom:D,newValue:e,source:t})}),[r,O,D]),z=(0,s.useCallback)(((e,t)=>{const n=c.current;n&&(n.atScrollEnd()?W(!1):W(!0),r.device.isMobile&&"up"===t&&(n.distanceToBottom()??0)>0&&x.ZH({device:r.device}))}),[r]),q=(0,s.useCallback)((()=>{const e=_.Z.getActiveAssistantConfigurationStore();e&&e.state&&e.setState({...e.state,showNotionHelpQuestionWarning:!1})}),[]);(0,s.useEffect)((()=>{if(r.device.isMobileNative){var e,t;Boolean("web"===Z.type&&("nativeTab"===Z.route.name&&"assistant"===Z.route.tab||"nativeTab"===(null===(e=Z.redirectedTo)||void 0===e?void 0:e.route.name)&&"assistant"===(null===(t=Z.redirectedTo)||void 0===t?void 0:t.route.tab)))?Xt(r,H):x.ZH({device:r.device})}}),[r,Z,H]),(0,s.useEffect)((()=>{Xt(r,H)}),[r,H]),(0,s.useEffect)((()=>{const e=_.Z.getActiveAssistantRuntimeStore(),t=null==p?void 0:p.primeTextInput;e&&t&&(b.createAndCommit({userAction:"assistant.primeTextFromSearch",environment:r,perform:e=>{w.sO({environment:r,store:H,value:h.TPx(t),transaction:e})}}),k.Z5({store:H,selection:{startIndex:t.length,endIndex:t.length}}),L.assistantActions.clearPrimedText({assistantRuntimeStore:e}))}),[r,H,null==p?void 0:p.primeTextInput]),(0,s.useEffect)((()=>{c.current&&!E&&c.current.scrollToBottom()}),[null==p?void 0:p.clientSteps,null==p?void 0:p.temporaryClientSteps,E]);const Q=(0,a.qz)(void 0,V.Z),G=on();return C&&(t||y)?(0,qe.jsxs)(qe.Fragment,{children:[(0,qe.jsx)(A.A,{scrollerStore:Q}),null!=f&&f.showNotionHelpQuestionWarning?(0,qe.jsxs)("div",{style:G.helpCenterBlueBar,children:[(0,qe.jsx)("div",{children:(0,qe.jsx)(S.FormattedMessage,{id:"assistantChat.lookingForHelpCenter",defaultMessage:"Looking for the {notionHelpCenter}?",values:{notionHelpCenter:(0,qe.jsx)(I.Z,{external:!0,href:"/help",disableHover:!0,children:(0,qe.jsx)(S.FormattedMessage,{id:"assistantChat.lookingForHelpCenter.notionHelpCenter",defaultMessage:"Notion help center"})})}})}),(0,qe.jsx)(j.Z,{iconStyle:G.helpCenterBlueBarCloseButtonIcon,style:G.helpCenterBlueBarCloseButton,icon:g.D,onClick:q,ariaLabel:"close"})]}):null,(0,qe.jsx)(M.T,{ref:c,type:F.Z.Y,style:G.scroller,onScroll:z,store:Q,children:(0,qe.jsx)(Jt,{assistantChatSectionsState:N,renderAsFullPage:t,isQuickSearchMode:o,currentSpaceStore:C,handleTextSubmit:e=>U(e,"suggested_question")})}),N.isAiEligible?(0,qe.jsx)("div",{style:G.inputWrap,children:(0,qe.jsx)(T.Z,{capture:d,render:()=>(0,qe.jsx)(Pt.H,{isQnA:N.isQnA,store:H,placeholder:N.isQnA?u.formatMessage($t.qnaInputPlaceholder):u.formatMessage($t.assistantInputPlaceholder),onSubmit:e=>U(e,"chat"),onFocus:()=>{v.MO(),d&&B.Z.onShow(D)},disabled:N.hasLockAction,onBackspaceOnEmptyInput:n})})}):null]}):null}function Jt(e){window.__c={n:"AssistantChatScrollerContent"};const{assistantChatSectionsState:t,currentSpaceStore:n,renderAsFullPage:o,isQuickSearchMode:l,handleTextSubmit:g}=e,m=(0,S.useIntl)(),y=(0,i.O7)(),x=(0,Ot.E5)({renderAsFullPage:o}),v=(0,a.VK)((()=>_.Z.getActiveAssistantConfigurationState()),[]),w=Boolean((null==v?void 0:v.sampling)||(null==v?void 0:v.evaluating)),k=(0,a.VK)((()=>_.Z.getActiveAssistantRuntimeState()),[]),b=null==k?void 0:k.selectedSkill,C=(0,a.VK)((()=>{var e;const t=null===(e=_.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.previewingStepObservations.filter((e=>"observation"===e.type&&"error"===e.observationType));return null==t?void 0:t.map((e=>e.value)).join("\n")}),[]),j=(0,s.useMemo)((()=>{if(null==v||!v.startTimestamp)return;const e=(0,u.kT)({date:v.startTimestamp,timezone:(0,p.r)()});return[(0,c.p6)({allowRelativeDates:!0,date:e,dateFormat:"relative",intl:m,shortenDate:!1}),e.toFormat("h:mm a")].join(" ")}),[null==v?void 0:v.startTimestamp,m]),M=an({assistantRuntimeState:k,assistantConfigurationState:v}),I=(0,s.useMemo)((()=>{var e;if(null==k?void 0:k.temporaryClientSteps.some((e=>"assistantCreateAutomation"===e.type)))return"create_workflow";if(C)return t.isQnA?"error_retry_only":"error";if(null==k?void 0:k.temporaryClientSteps.some((e=>"assistantTransaction"===e.type)))return"accept_edits";const n=(null==k?void 0:k.clientSteps)??[];return"assistantShowSearchResults"===(null===(e=n.at(n.length-1))||void 0===e?void 0:e.type)?"search_result_chat":"chat"}),[t.isQnA,C,k]),A=(0,a.qz)(void 0,O.d),T=(0,s.useMemo)((()=>r.default.createValue(!0)),[]),Z=(0,s.useMemo)((()=>r.default.createValue(!1)),[]),P=(0,s.useCallback)((e=>!!t.isLabelerMode||(t.isQnA?"human"===e.type||"assistantChat"===e.type||"assistantChatText"===e.type||"assistantShowSearchResults"===e.type||"assistantFriendlyError"===e.type:"human"===e.type||"assistantChat"===e.type||"assistantChatText"===e.type||"assistantShowSearchResults"===e.type||"assistantTransaction"===e.type||"assistantCreateAutomation"===e.type)),[t.isLabelerMode,t.isQnA]);(0,s.useEffect)((()=>{if(!w){var e;const t=null===(e=_.Z.getActiveAssistantRuntimeStore())||void 0===e?void 0:e.getCombinedSteps().at(-1);if("assistantChat"===(null==t?void 0:t.type)){0===(0,E.M)({clientStep:t,citationOrdering:void 0}).length&&T.setState(!1)}}}),[T,y,w]),(0,s.useEffect)((()=>{M&&(Z.setState(!1),T.setState(!0))}),[Z,T,M]);const F=on();return(0,qe.jsxs)(qe.Fragment,{children:[(0,qe.jsx)("div",{style:{marginTop:"auto"}}),t.shouldRenderFinetunedAssistantIntroMessage&&(0,qe.jsx)(qe.Fragment,{children:(0,qe.jsxs)("div",{style:F.emptyStateWrap,children:[(0,qe.jsx)("div",{style:F.faceImgWrap,children:(0,qe.jsx)("img",{style:F.faceImg,src:d.Z.images.aiFaceLookleftPng})}),(0,qe.jsxs)("div",{style:F.emptyStateText,children:[(0,qe.jsx)("p",{children:(0,qe.jsx)(S.FormattedMessage,{id:"assistantChat.welcomeMessage.title",defaultMessage:"Hi, I’m Notion AI! I can chat with you about anything, find information from the workspace, and read and edit pages."})}),(0,qe.jsx)("p",{children:(0,qe.jsx)(S.FormattedMessage,{id:"assistantChat.welcomeMessage.helpText",defaultMessage:"I’m still in Beta, so please use the 👍 👎 buttons to help me improve."})})]})]})}),t.shouldShowFullPageSkillSection&&(0,qe.jsx)(Rt.s,{clientSkills:x,renderAsFullPage:o,disableKeyboard:!0}),t.shouldShowInlineSkillSection&&(0,qe.jsx)(ht,{clientSkills:x,skillIconStyle:F.skillIcon,skillsWrapStyle:F.skillsWrap}),t.shouldShowFullPageAutomationSection&&(0,qe.jsx)(Ut.F,{renderAsFullPage:o,spaceStore:n}),t.shouldShowInlineAutomationSection&&(0,qe.jsx)(Gt,{spaceStore:n}),j&&(0,f.$K)(k)&&k.clientSteps.length>0&&(0,qe.jsx)("div",{style:F.dateContainer,children:(0,qe.jsx)("div",{style:F.date,children:j})}),t.shouldShowQnaWelcomeHeader&&(0,qe.jsx)(rn,{isQuickSearchMode:l,renderAsFullPage:o}),b&&W.skillDefaultAssistantMessageMap[b.skillType]&&(0,qe.jsx)(H.H,{clientStep:{type:"assistantChatText",inferenceId:"hard-coded",text:m.formatMessage(W.skillDefaultAssistantMessageMap[b.skillType])},parentStore:n,parentSpaceId:n.id,configurationState:v,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:void 0}),(0,qe.jsx)(sn,{clientSteps:[...(null==k?void 0:k.clientSteps)??[],...(null==k?void 0:k.temporaryClientSteps)??[]].filter(P),parentStore:n,parentSpaceId:n.id,configurationState:v,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:A}),M&&("default"===M.type?(0,qe.jsx)(H.H,{clientStep:{type:"assistantLoading",inferenceId:"hard-coded"},parentStore:n,parentSpaceId:n.id,configurationState:v,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:A}):"searchResults"===M.type?(0,qe.jsx)(Ft.N,{clientStep:M.step,parentStore:n,configurationState:v,citationHoverStore:A,isQuickSearchMode:l,renderAsFullPage:o}):(0,f.t1)(M)),t.shouldShowCitationsAtBottom&&(0,qe.jsx)(en,{hoverStore:A,parentStore:n,expandedStore:Z,toggledStore:T,isLoading:t.shouldShowCitationsLoadingDots}),t.shouldShowNonQNAError&&(0,qe.jsx)("div",{style:F.error,children:C}),t.shouldShowAssistantFeedbackButtons&&(0,qe.jsx)(ut,{type:I,renderAsFullPage:o}),t.shouldShowNewChatSuggestions&&(0,qe.jsx)(Ht,{assistantChatSectionsState:t,handleSubmitSuggestedItem:e=>g(h.TPx(e))}),!t.isAiEligible&&(0,qe.jsx)(Mt,{parentStore:n,parentSpaceId:n.id,configurationState:v,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:A})]})}function Xt(e,t){x.ZH({device:e.device}),k.N_({store:t})}function en(e){window.__c={n:"LatestStepCitations"};const{hoverStore:t,parentStore:n,expandedStore:s,toggledStore:i,isLoading:o}=e,{chatStep:r,searchResultsStep:l}=(0,a.VK)((()=>{var e;const t=(null===(e=_.Z.getActiveAssistantRuntimeStore())||void 0===e?void 0:e.getCombinedSteps())??[];if(0===t.length)return{chatStep:void 0,searchResultsStep:void 0};const n=t.slice(-2).reverse().find((0,f.AO)((e=>"assistantShowSearchResults"===e.type?{true:e}:{false:e}))),s=t[t.length-1];return{chatStep:"assistantChat"===s.type?s:void 0,searchResultsStep:n}}),[]),d={hoverStore:t,parentStore:n,expandedStore:s,canExpand:!0,toggledStore:i,isLoading:o};return(0,f.$K)(r)?(0,qe.jsx)(tn,{...d,chatStep:r,searchResultsStep:l}):(0,f.$K)(l)?(0,qe.jsx)(nn,{...d,searchResultsStep:l}):null}function tn(e){window.__c={n:"CitedPagesListWithNumbers"};const{chatStep:t,parentStore:n,searchResultsStep:i,...a}=e,o=(0,s.useMemo)((()=>{const e=(0,E.M)({clientStep:t,citationOrdering:i?(0,K.TT)(i):void 0});return(0,K.Zr)({pageCitationsFromChat:e,parentStore:n,searchResultsStep:i})}),[t,n,i]);return(0,qe.jsx)(N.d,{citations:o,...a})}function nn(e){window.__c={n:"CitedPagesListFromSearch"};const{parentStore:t,searchResultsStep:n,...i}=e,a=(0,s.useMemo)((()=>(0,K.Zr)({pageCitationsFromChat:[],parentStore:t,searchResultsStep:n})),[t,n]);return(0,qe.jsx)(N.d,{citations:a,...i})}function sn(e){const{clientSteps:t,parentStore:n,parentSpaceId:s,configurationState:i,isQuickSearchMode:a,renderAsFullPage:o,latestStepCitationHoverStore:r}=e;return(0,qe.jsx)(qe.Fragment,{children:t.map(((e,t)=>(0,qe.jsx)(H.H,{clientStep:e,parentStore:n,parentSpaceId:s,configurationState:i,isQuickSearchMode:a,renderAsFullPage:o,latestStepCitationHoverStore:r,fakeSlackUser:"human"===e.type?e.fakeUser:void 0},`${(null==i?void 0:i.sessionId)??""}-${t}`)))})}function an(e){const{assistantRuntimeState:t,assistantConfigurationState:n}=e;return(0,a.VK)((()=>{if(!t||!n)return;if(!n.sampling&&!n.evaluating)return;const e=t.temporaryClientSteps.find((0,f.AO)((e=>"assistantChat"===e.type||"assistantTransaction"===e.type||"assistantChatText"===e.type?{true:e}:{false:e})));if(e&&("assistantTransaction"===e.type||!(0,Z.S)(e)))return;const s=t.clientSteps[t.clientSteps.length-1];return s&&"assistantShowSearchResults"===s.type?{type:"searchResults",step:s}:{type:"default"}}),[t,n])}function on(){const{device:e}=(0,i.O7)(),{isMobile:t}=e;return(0,o.yK)((e=>({header:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto",paddingTop:8,paddingLeft:12,paddingRight:12},labeledInput:{display:"flex",gap:8,alignItems:"center"},reset:{color:e.mediumIconColor},toggleSlackMode:{color:e.mediumIconColor},closeButton:{borderRadius:"100%",marginLeft:4},input:{width:void 0,marginLeft:8,marginRight:8},scroller:{flexGrow:1,display:"flex",flexDirection:"column",paddingTop:8,paddingBottom:12,paddingLeft:16,paddingRight:16,WebkitMaskImage:"linear-gradient(black calc(100% - 12px), transparent)"},samplesLabel:{fontSize:t?14:12,marginTop:8,marginBottom:8},inputLabel:{fontSize:t?16:14,color:e.mediumTextColor},previewLabel:{fontSize:t?14:12},editLink:{fontSize:t?16:14,color:e.mediumTextColor,textDecoration:"underline",paddingLeft:8,paddingRight:8},error:{fontSize:t?16:14,color:e.errorText},addCustomInstructionsIcon:{fill:e.aiPurpleColor},suggestionsLabel:{fontSize:t?14:12,color:e.mediumTextColor,marginTop:18,marginBottom:12},faceImgWrap:{width:64,height:64,borderRadius:"100%",background:"white",boxShadow:e.largeLightBoxShadow,overflow:"hidden"},faceImg:{width:64,pointerEvents:"none"},emptyStateText:{marginTop:28,fontSize:16,color:e.regularTextColor,fontFamily:y.Z.baseFontFamily.serif},emptyStateWrap:{marginLeft:8,marginRight:8},inputWrap:{paddingTop:0,paddingBottom:16},skillsCaption:{fontSize:t?14:12,color:e.mediumTextColor,marginBottom:8},skillIcon:{fill:e.aiPurpleColor},skillsWrap:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:8},date:{fontSize:12,color:e.lightTextColor},dateContainer:{display:"flex",justifyContent:"center",marginTop:4,marginBottom:4},helpCenterBlueBar:{backgroundColor:e.blueButtonBackground,fontSize:14,padding:"8px 16px",color:e.regularInvertedTextColor,display:"flex",justifyContent:"space-between",alignItems:"center"},helpCenterBlueBarCloseButton:{width:16,height:16,borderRadius:"100%"},helpCenterBlueBarCloseButtonIcon:{fill:e.regularInvertedTextColor}})),[t])}function rn(e){window.__c={n:"QnAWelcomeHeader"};const{isQuickSearchMode:t,renderAsFullPage:n}=e,s=(0,S.useIntl)(),i=(0,a.VK)((()=>_.Z.getActiveAssistantConfigurationState()),[]),o=(0,a.VK)((()=>R.default.state.mainEditorCurrentBlockStore),[]),r=(0,a.VK)((()=>R.default.state.currentSpaceStore),[]),l=(0,a.VK)((()=>{var e;return null===(e=R.default.state.currentUserStore)||void 0===e?void 0:e.getDisplayName(s)}),[s]),d=(0,a.VK)((()=>C.Z.state),[]),c=(0,a.VK)((()=>null==r?void 0:r.getName()),[r]);if(!r||!c||!n&&!o||!l)return null;if(!d)return null;const u={parentStore:r,parentSpaceId:r.id,configurationState:i,isQuickSearchMode:t,renderAsFullPage:n,latestStepCitationHoverStore:void 0};return(0,qe.jsxs)(qe.Fragment,{children:[(0,qe.jsx)(H.H,{clientStep:{type:"assistantChatText",text:s.formatMessage($t.qnaAssistantChatText,{firstName:l,workspaceName:c}),inferenceId:"hard-coded"},...u}),(0,qe.jsx)(H.H,{clientStep:{type:"assistantChatText",text:s.formatMessage($t.assistantBetaDisclaimerText),inferenceId:"hard-coded"},...u}),!1]})}},17456:(e,t,n)=>{n.d(t,{l:()=>z,p:()=>H});var s=n(43261),i=n.n(s),a=n(67294),o=n(18466),r=n(480),l=n(86628),d=n(24405),c=n(34420),u=n(88421),p=n(59054),g=n(47453),m=n(37612),h=n(72126),f=n(149),y=n(70203),S=n(82990),x=n(9291),v=n(24677),w=n(80402),k=n(98104),b=n(56496),C=n(68785),j=n(31278),M=n(53336),I=n(75179),A=n(68657),T=n(15447),Z=n(16402),P=n(34859),F=n(44950),R=n(28344),_=n(65147),B=n(45891),V=n(60117),K=n(59107),L=n(67593),E=n(2108),W=n(85893);const O=(0,x.defineMessages)({chatHistorySearchPlaceholder:{id:"assistant.chatHistory.placeholder",defaultMessage:"Search or start new chat"},searchOnlyPlaceholder:{id:"assistant.chatHistory.searchOnlyPlaceholder",defaultMessage:"Search"}});function H(e){window.__c={n:"AssistantChatHistory"};const{renderAsFullPage:t,onRestoreChatSession:n,variant:s}=e,i=(0,K.M)();return void 0===i?(0,W.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",flexGrow:1,paddingBottom:20},children:(0,W.jsx)(C.Z,{})}):(0,W.jsx)(D,{childStores:i,renderAsFullPage:t,onRestoreChatSession:n,variant:s})}function N(e){const{migratedStep:t,intl:n}=e,s=t.serializedTranscriptSteps,i=null==s?void 0:s.slice().reverse().find(u.Zn);if(!i)return"";const a=(0,c.xA)({step:i,intl:n});return f.x.isFail(a)?void 0:a.value}function D(e){window.__c={n:"AssistantLoadedChatHistory"};const{renderAsFullPage:t,childStores:n,onRestoreChatSession:s,variant:u}=e,[g,m]=(0,a.useState)(""),S=(0,d.yK)((e=>({wrap:{paddingLeft:12,paddingRight:12,maxHeight:t?void 0:450},textInputWrap:{paddingTop:"search"===u?17:0,paddingBottom:2},noResultsMessage:{paddingTop:30,paddingBottom:30,display:"flex",justifyContent:"center",alignItems:"center",color:e.lightTextColor,fontSize:12}})),[t,u]),b=(0,E.AP)({renderAsFullPage:t,isQuickSearchMode:!1}),{isMobile:C}=(0,r.Fy)(),j=(0,x.useIntl)(),{store:T}=(0,A.Cl)({initialValue:void 0,onChange:h.yR}),Z=function(e,t){const n=(0,l.VK)((()=>h.oA(e.map((e=>{var t;const n=null===(t=e.getChatStepStore())||void 0===t?void 0:t.dangerouslyGetUnmigratedStorageStep();if(n&&f.x.isSuccess(n))return{childStoreId:e.id,value:n.value}})))),[e]),[{value:s}]=(0,p.r5)((async()=>h.oA(await Promise.all(n.map((async e=>{const{childStoreId:t,value:n}=e;if(!n)return;const s=await(0,c.Fd)(n);return!f.x.isFail(s)&&e.value?{childStoreId:t,value:e.value}:void 0}))))),[n]);return(0,a.useMemo)((()=>{const e=new Map;if(!s)return e;for(const{childStoreId:n,value:i}of s)e.set(n,N({migratedStep:i,intl:t})??"");return e}),[t,s])}(n,j),F=(0,a.useMemo)((()=>{const e={extract:e=>o.Z.withListenerIgnored((()=>e.getTitleOrFallback(j)+Z.get(e.id)??""))};return i().filter(g,n,e).map((e=>e.original))}),[n,j,Z,g]),R=(0,r.O7)(),B=(0,a.useCallback)((e=>{(0,_.AF)({newValue:e,environment:R,currentSkill:void 0,shouldForceStartNewSession:!0,source:"transcript"}).then((()=>{V.assistantMenuStore.setState({...V.assistantMenuStore.state,currentView:"chat"})})).catch((()=>{}))}),[R]),K=(0,a.useRef)(void 0),H=(0,a.useCallback)(((e,t)=>{const n=K.current;n&&R.device.isMobile&&"up"===t&&(n.distanceToBottom()??0)>0&&v.ZH({device:R.device})}),[R.device]);return(0,a.useEffect)((()=>{v.ZH({device:R.device}),k.N_({store:T})}),[R,T]),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(I.Z,{capture:C,render:()=>(0,W.jsx)("div",{style:S.textInputWrap,children:(0,W.jsx)(L.H,{hideSubmitIcon:!0,isQnA:b.isQnA,store:T,placeholder:j.formatMessage(O.chatHistorySearchPlaceholder),onSubmit:B,onFocus:()=>{w.MO()},disabled:b.hasLockAction,onBackspaceOnEmptyInput:h.ZT,onTextChange:e=>{m((0,y.Jcv)(e))},textInputOverrideStyles:{borderRadius:4,paddingLeft:8}})})}),0===F.length&&(0,W.jsx)("div",{style:S.noResultsMessage,children:(0,W.jsx)(x.FormattedMessage,{id:"assistant.chatHistory.noResults",defaultMessage:"No results"})}),F.length>0&&(0,W.jsxs)(M.Z,{ref:K,style:S.wrap,type:P.Z.Y,onScroll:H,children:[(0,W.jsx)(U,{items:F,onSelectItem:s}),(0,W.jsx)(Q,{})]})]})}function U(e){window.__c={n:"AssistantChatHistoryGroupedResultItems"};const{items:t,onSelectItem:n}=e,s=(0,l.VK)((()=>h.vM(t,(e=>(0,T._5)(e.getCreatedTime())))),[t]),i=(0,d.yK)((e=>({headerGroupStyle:{fontSize:12,fontWeight:500,color:e.lightTextColor,paddingLeft:8,paddingTop:16,marginBottom:2}})),[]),[o,r]=(0,a.useState)(void 0),c=(0,a.useCallback)((e=>{r(e)}),[]);return(0,W.jsx)(W.Fragment,{children:Object.entries(s).map(((e,t)=>{let[s,r]=e;return(0,W.jsxs)(a.Fragment,{children:[(0,W.jsx)("div",{style:i.headerGroupStyle,children:s}),r.map(((e,t)=>(0,W.jsxs)(a.Fragment,{children:[(0,W.jsx)(G,{store:e,onRestoreChatSession:n,onAfterSessionHovered:c},e.id),t!==r.length-1&&(0,W.jsx)(q,{visible:e.id!==o&&r[t+1].id!==o})]},e.id)))]},s)}))})}async function z(e){const{environment:t,makeActiveSession:n}=e;await(0,F.resetAndInitializeAssistantSession)({environment:t,makeActiveSession:n}),V.assistantMenuStore.setState({...V.assistantMenuStore.state,currentView:"chat"}),(0,R.trackAIChatTranscriptHistoryNewChatCreated)(t)}function q(e){window.__c={n:"Border"};const{visible:t}=e,n=(0,d.yK)((e=>({borderColor:{border:`1px solid ${e.home.cards.verticalDivider}`,visibility:t?"visible":"hidden"}})),[t]);return(0,W.jsx)("div",{style:n.borderColor})}function Q(){window.__c={n:"StartNewChatButtonOption"};const e=(0,r.O7)(),[t,n]=(0,a.useState)(!1),s=(0,d.yK)((e=>({wrapper:{display:"flex",alignItems:"center",paddingTop:10,paddingBottom:10,marginBottom:6,backgroundColor:t?e.hoveredDiscussionBackground:void 0,borderRadius:6,cursor:"pointer"},textWrapper:{fontSize:14,fontWeight:500},startNewChatIcon:{color:e.icon.secondary,height:14,width:14},startNewChatIconWrapper:{marginLeft:16,marginRight:12}})),[t]);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(q,{visible:!0}),(0,W.jsxs)("div",{style:s.wrapper,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[(0,W.jsx)("div",{style:s.startNewChatIconWrapper,children:(0,g.R)(s.startNewChatIcon)}),(0,W.jsx)("div",{style:s.textWrapper,onClick:()=>{z({environment:e,makeActiveSession:!0})},children:(0,W.jsx)(x.FormattedMessage,{id:"assistant.chatHistory.startNewChat",defaultMessage:"Start a new chat"})})]})]})}function G(e){window.__c={n:"AssistantChatHistoryItem"};const{store:t,onRestoreChatSession:n,onAfterSessionHovered:s}=e,i=(0,x.useIntl)(),o=(0,l.VK)((()=>t.getTitleOrFallback(i)),[i,t]),d=(0,r.O7)(),c=(0,K.A)({store:t}),u=(0,l.VK)((()=>t.getCreatedTime()),[t]),p=(0,a.useCallback)((async()=>{if("loading"===c.status||f.x.isFail(c.result))return;if(!c.result.value)return;const e=c.result.value;await(0,B.t)(e,d),V.assistantMenuStore.setState({...V.assistantMenuStore.state,currentView:"chat"}),null==n||n(),(0,R.trackAIChatTranscriptHistoryItemRestored)(d,{sessionId:e.sessionId,stepId:e.id})}),[d,n,c]),g=(0,a.useCallback)((()=>{p()}),[p]),m=(0,a.useCallback)((e=>(e.stopPropagation(),e.preventDefault(),(0,_.If)({sessionId:t.id,environment:d}))),[d,t.id]),h=function(e){const{store:t,intl:n}=e,s=(0,K.A)({store:t});if("loading"===s.status)return{value:void 0};const i=s.result;return f.x.isFail(i)?i:i.value?{value:N({migratedStep:i.value,intl:n})}:{value:void 0}}({store:t,intl:i}),y=(0,l.VK)((()=>t.getImageIfExists()),[t]),S=(0,a.useCallback)((e=>{s(e?t.id:void 0)}),[s,t.id]);let v="";return f.x.isSuccess(h)&&h.value&&(v=h.value),(0,W.jsx)($,{title:o,icon:y,description:v,onSelectHistoryItem:g,onDeleteHistoryItem:m,createdTime:u,onAfterSessionHovered:S})}function $(e){window.__c={n:"AssistantChatHistoryItemRenderer"};const{onSelectHistoryItem:t,title:n,description:s,createdTime:i,onDeleteHistoryItem:o,icon:r,onAfterSessionHovered:c}=e,[u,p]=(0,a.useState)(!1),g=(0,a.useCallback)((e=>{p(e),c(e)}),[c]),m=(0,l.VK)((()=>(0,Z.IS)(i,{useUltraCompactFormat:!0,roundDownYears:!0,useWeeks:!0,useLowercase:!0})),[i]),h=(0,d.yK)((e=>({chatHistoryItemWrapper:{paddingLeft:12,paddingRight:12,cursor:"pointer",backgroundColor:u?e.cardHoveredBackground:void 0,paddingTop:12,paddingBottom:12,borderRadius:6,display:"flex",alignItems:"center",justifyContent:"space-between",overflow:"hidden"},chatHistorySubtitle:{color:e.text.secondary,fontSize:12,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},titleWrap:{display:"flex",alignItems:"center"},title:{fontSize:14,fontWeight:500,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},timestamp:{fontSize:S.Z.fontSize.UISmall.desktop,color:e.text.secondary,paddingLeft:6,flexShrink:0},icon:{marginRight:12,borderRadius:"100%"},trashIcon:{display:"flex",height:14,width:14,color:e.icon.uiRedPrimary},trashIconWrapper:{flexGrow:1,display:"flex",justifyContent:"flex-end",alignItems:"center"},deleteSessionWrapper:{visibility:u?"visible":"hidden"},contentWrap:{display:"flex",flexDirection:"column",maxWidth:r?250:280}})),[u,r]);return(0,W.jsxs)("div",{style:h.chatHistoryItemWrapper,onClick:t,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:[(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[r?(0,W.jsx)(j.Z,{disabled:!0,isEmptyPage:!1,icon:r,size:25,style:h.icon}):(0,W.jsx)(b.Z,{size:25,title:n,style:h.icon}),(0,W.jsxs)("div",{style:h.contentWrap,children:[(0,W.jsxs)("div",{style:h.titleWrap,children:[(0,W.jsx)("div",{style:h.title,children:n}),(0,W.jsx)("div",{style:h.timestamp,children:m})]}),(0,W.jsx)("div",{style:h.chatHistorySubtitle,children:s})]})]}),(0,W.jsx)("div",{style:h.deleteSessionWrapper,children:(0,W.jsx)(Y,{onDeleteHistoryItem:o})})]})}function Y(e){window.__c={n:"DeleteSessionButton"};const{onDeleteHistoryItem:t}=e,[n,s]=(0,a.useState)(!1),i=(0,d.yK)((e=>({trashIconWrapper:{display:"flex",justifyContent:"flex-end",alignItems:"center"},trashIconHover:{backgroundColor:n?"dark"===e.mode?e.buttonHoveredBackground:e.whiteButtonHoveredBackground:void 0,borderRadius:6,padding:"3px 3px"},trashIcon:{display:"flex",height:18,width:18,color:e.icon.tertiary}})),[n]);return(0,W.jsx)("div",{style:i.trashIconWrapper,onClick:t,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:(0,W.jsx)("div",{style:i.trashIconHover,children:(0,m.y)(i.trashIcon)})})}},84969:(e,t,n)=>{n.d(t,{m:()=>k});n(57658);var s=n(67294),i=n(26263),a=n(480),o=n(86628),r=n(49085),l=n(4615),d=n(70203),c=n(44805),u=n(97880),p=n(15201),g=n(55217),m=n(62619),h=n(48588),f=n(65147),y=n(91437),S=n(67973),x=n(46370),v=n(42899),w=n(85893);function k(e){window.__c={n:"AssistantChatMessageRenderer"};const{clientStep:t,parentStore:n,configurationState:k,fakeSlackUser:b,isLatestStep:C,isQuickSearchMode:j,renderAsFullPage:M,priorSearchResultsStep:I,disableWrap:A}=e,T=(0,a.O7)(),Z=(0,s.useMemo)((()=>new i.Z({name:"AssistantChatMessageListRenderer",isSyntheticAssistantData:!0})),[]),P=(0,s.useMemo)((()=>(0,l.ZP)()),[]),F=(0,o.qz)(void 0,S.d),R=e.citationHoverStore??F,_=(0,f.RS)({environment:T,clientStep:t,citationOrdering:I?(0,f.TT)(I):void 0,inMemoryRecordCache:Z,listId:P}),B=(0,s.useMemo)((()=>{const e=(0,y.M)({clientStep:t,citationOrdering:I?(0,f.TT)(I):void 0});return(0,f.Zr)({pageCitationsFromChat:e,parentStore:n,searchResultsStep:I})}),[t,n,I]),V=(0,s.useRef)(null),K=(0,s.useMemo)((()=>r.default.createValue(!1)),[]),L=(0,s.useMemo)((()=>r.default.createValue(!1)),[]);!function(e){const{containerRef:t,citationHoverStore:n}=e,i=(0,o.VK)((()=>{var e;const n=h.Z.state;if(!n||!t.current||!m.r3(t.current,n.token.node))return;const s=n.annotations.find(d.OU5),i=s?null===(e=d.Vv0(s))||void 0===e?void 0:e.blockId:void 0;return i?{pageId:i,tokenNode:n.token.node}:void 0}),[t]),a=(0,s.useRef)([]);(0,s.useEffect)((()=>{n.setState(i?{type:"token",pageId:i.pageId,node:i.tokenNode}:void 0)}),[n,i]),(0,o.VK)((()=>{var e;const s=null===(e=n.state)||void 0===e?void 0:e.pageId,o=(0,u.$K)(i)?void 0:s;for(const t of a.current)t.style.removeProperty("background-color");const r=[];if(o&&t.current){const e=t.current.querySelectorAll(`[${c.JQ}='${o}']`);for(const t of Array.from(e))t instanceof HTMLElement&&t&&(t.style.backgroundColor="#2383e2",r.push(t))}a.current=r}),[n,t,i]),(0,s.useEffect)((()=>()=>{for(const e of a.current)e.style.removeProperty("background-color")}),[])}({containerRef:V,citationHoverStore:R});const E=(0,w.jsx)(p.O,{displayName:"AssistantChatStepContent",disabled:!0,children:(0,w.jsx)(g.Z,{store:_,disabled:!1,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})}),W=(0,w.jsxs)(w.Fragment,{children:[!C&&(0,w.jsx)(v.d,{citations:B,hoverStore:R,canExpand:!0,toggledStore:K,expandedStore:L}),(0,w.jsx)(v.P,{containerRef:V,hoverStore:R,parentStore:n,renderAsFullPage:M,isQuickSearchMode:j})]});return A?(0,w.jsxs)(w.Fragment,{children:[E,W]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(x.J,{ref:V,clientStep:t,configurationState:k,fakeSlackUser:b,forceShowFeedback:C,children:E}),W]})}},54206:(e,t,n)=>{n.d(t,{H:()=>ce});n(67635);var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(3124),l=n(35840),d=n(23867),c=n(97880),u=n(9291),p=n(91839),g=n(76798),m=n(26388),h=n(60682),f=n(57254),y=n(14976),S=n(98180),x=n(77080),v=n(68373),w=n(84969),k=(n(21703),n(18466)),b=n(26263),C=n(46964),j=n(80560),M=n(82530),I=n(15201),A=n(55217),T=n(77907),Z=n(85893);function P(e){window.__c={n:"AssistantChatMessageRendererMarkdown"};const{clientStep:t}=e,n=(0,i.O7)(),{value:a}=(0,T.useDependency)(T.deps.markdownLinkifyIt),o=(0,s.useMemo)((()=>a?k.Z.withListenerIgnored((()=>function(e){const{environment:t,clientStep:n,markdownLinkifyIt:s}=e,i=new b.Z({name:"AssistantChatMessageListRenderer"});return M.createAndCommit({userAction:"AssistantChatMessageRenderer.temporaryListStore",environment:t,canUndo:!1,perform:e=>{const a=function(e){const{environment:t,clientStep:n,transaction:s,markdownLinkifyIt:i}=e,a=new b.Z({name:"AssistantChatMessageRenderer",isSyntheticAssistantData:!0}),o=t.currentUser.id;if(!o)throw new Error("No current user.");const r=e=>{const s=j.Mt({environment:t,text:(0,C.rr)(n.text),transaction:e,inMemoryRecordCache:a,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:void 0});if(!s)return[];for(const t of s)a.setModelAndRole({pointer:t.pointer,userId:o},t.getModel(),"reader");return s};if(a.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache),s)return r(s);return M.createAndCommit({userAction:"AssistantChatMessageRenderer.temporaryListStore",environment:t,perform:r,canUndo:!1}).performResult}({environment:t,clientStep:n,transaction:e,markdownLinkifyIt:s});return j.Lh({environment:t,stores:a,inMemoryRecordCache:i,transaction:e})}}).performResult}({environment:n,clientStep:t,markdownLinkifyIt:a}))):void 0),[t,n,a]);return(0,Z.jsx)(I.O,{displayName:"AssistantChatStepContent",disabled:!0,children:o?(0,Z.jsx)(A.Z,{store:o,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0}):null})}var F=n(46370),R=n(15145),_=n(88891),B=n(37167),V=n(72126),K=n(21202),L=n(82990),E=n(2456),W=n(40971),O=n(61519),H=n(84076),N=n(11335),D=n(84210),U=n(80444),z=n(21273),q=n(61045),Q=n(64921),G=n(29551),$=n(33929),Y=n(62740);const J=(0,u.defineMessages)({updatedBlocks:{id:"assistantGroupedEditsRenderer.updatedBlocks",defaultMessage:"{total, plural, one {Updated Block} other {Updated {total} Blocks}}"},insertedBlocks:{id:"assistantGroupedEditsRenderer.insertedBlocks",defaultMessage:"{total, plural, one {Inserted Block} other {Inserted {total} Blocks}}"},removedBlocks:{id:"assistantGroupedEditsRenderer.removedBlocks",defaultMessage:"{total, plural, one {Removed Block} other {Removed {total} Blocks}}"},updatedPageProperties:{id:"assistantGroupedEditsRenderer.updatedPageProperties",defaultMessage:"{total, plural, one {Update Page Property} other {Update Page Properties}}"},updatedTitle:{id:"assistantGroupedEditsRenderer.updateTitle",defaultMessage:"Updated Page Title"}});function X(e){switch(e.type){case"insertedBlocks":return $.default.formatMessage(J.insertedBlocks,{total:e.blockIds.size});case"removedBlocks":return $.default.formatMessage(J.removedBlocks,{total:e.blockIds.size});case"updatedBlocks":return $.default.formatMessage(J.updatedBlocks,{total:e.blockIds.size});case"updatedProperties":return $.default.formatMessage(J.updatedPageProperties,{total:e.propertyNames.size});case"updatedTitle":return $.default.formatMessage(J.updatedTitle);default:(0,c.t1)(e)}}function ee(e){let{group:t}=e;window.__c={n:"AssistantGroupedEditsRenderer"},(0,s.useEffect)((()=>{Y.Z.setState({...Y.Z.state,edits:t.groupedEdits})}),[t.groupedEdits]);const n=(0,s.useCallback)((e=>{Y.Z.setState({...Y.Z.state,hoveredEditId:e})}),[]),i=(0,s.useCallback)((()=>{Y.Z.setState({...Y.Z.state,hoveredEditId:null})}),[]),a=(0,s.useCallback)((e=>{const n=t.groupedEdits.find((t=>t.editId===e));if(n)switch(n.type){case"insertedBlocks":case"updatedBlocks":q.hl(Array.from(n.blockIds),!0);break;case"removedBlocks":case"updatedProperties":case"updatedTitle":break;default:(0,c.t1)(n)}}),[t.groupedEdits]),r=(0,o.yK)((e=>({container:{padding:"10px 0"},edit:{borderRadius:11,padding:"8px 12px 8px 12px",border:"1px solid",background:e.accentColors.purple[50],color:e.accentColors.purple[600],fontWeight:500,fontSize:14,lineHeight:1.44,width:"auto"}})),[]);return(0,Z.jsxs)(G.Ht,{style:r.container,gap:8,children:[(0,Z.jsx)(u.FormattedMessage,{id:"assistantGroupedEditsRenderer.aiEditsMessage",defaultMessage:"Check out my edits, feel free keep editing and iterating on the changes."}),t.groupedEdits.map(((e,t)=>(0,Z.jsx)(Q.Z,{style:r.edit,onMouseEnter:()=>n(e.editId),onMouseLeave:i,onClick:()=>a(e.editId),children:X(e)},`edit-${t}`)))]})}function te(e){window.__c={n:"AssistantTransactionRenderer"};const{clientStep:t}=e,n=(0,_.rn)(t.operations),i=(0,o.yK)((e=>({divider:{marginTop:6,marginBottom:6},subheader:{color:e.mediumTextColor}})),[]);return(0,Z.jsx)(Z.Fragment,{children:n.map(((e,t)=>(0,Z.jsxs)(s.Fragment,{children:[(0,Z.jsx)(ne,{group:e},t),n[t+1]&&(0,Z.jsx)(O.Z,{style:i.divider,size:1})]},t)))})}function ne(e){window.__c={n:"AssistantTransactionGroupRenderer"};const{group:t}=e,n=(0,i.O7)(),s=(0,o.yK)((e=>({header:{marginTop:4,marginBottom:6,color:e.mediumTextColor},pageTitle:{display:"inline",color:e.regularTextColor,fontWeight:L.Z.fontWeight.semibold,whiteSpace:void 0,overflow:void 0,textOverflow:void 0,textDecoration:"underline"},divider:{marginBottom:6},subheader:{color:e.mediumTextColor,marginBottom:4}})),[]),r=(0,a.VK)((()=>U.default.state.mainEditorCurrentBlockStore),[]),l=(0,a.VK)((()=>U.default.state.currentSpaceStore),[]),d=r||l;if(!l)throw new Error("No current space store");if(!d)throw new Error("No parent store");const p=(null==r?void 0:r.id)!==t.pageId,m=l.id,h=v.G.createChildStore(d,{table:K.iU,id:t.pageId,spaceId:m}),f=(0,a.VK)((()=>z.Z.shouldShowGroupedEdits()&&!p),[p]),y=(0,a.VK)((()=>{const{route:e}=n.RouterStore.state;return"chat"===e.name?(0,B.t)({blockId:h.id,pageVisitSource:R.tY.AIChat}):r&&h.id===r.id?(0,D.ZP)({store:r,pageVisitSource:R.tY.AIChat,fullyQualified:!1}):r?(0,D.ZP)({store:r,pageVisitSource:R.tY.AIChat,fullyQualified:!1,peekViewBlockId:h.id}):(0,D.ZP)({store:h,pageVisitSource:R.tY.AIChat,fullyQualified:!1})}),[r,h,n]),S=(0,a.VK)((()=>{if("updatedPage"!==t.type)return[];const e=h.getAssociatedCollectionStore(),n=null==e?void 0:e.getSchema();return V.oA(Array.from(t.updatedPropertyNames).map((e=>{const t=Object.entries(n||{}).find((t=>{let[,n]=t;return(null==n?void 0:n.name)===e}));if(t)return t[0]})))}),[h,t]);if("updatedPage"===t.type){if(f)return(0,Z.jsx)(ee,{group:t});const{insertedBlockIds:e,updatedBlockIds:n,removedBlockIds:i,updatedTitle:a,updatedPropertyNames:o}=t,r=e.size+n.size+i.size+(a?1:0)+o.size;return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(H.Z,{style:s.header,href:y,children:(0,Z.jsx)("span",{children:t.didCreatePage?(0,Z.jsx)(u.FormattedMessage,{defaultMessage:"Created {page}",id:"assistant.transactionRenderer.createdPage.title",values:{page:(0,Z.jsx)(g.Z,{store:h,style:s.pageTitle})}}):(0,Z.jsx)(u.FormattedMessage,{defaultMessage:"{numEdits, plural, one {1 edit to {page}} other {{numEdits} edits to {page}}}",id:"assistant.transactionRenderer.editedPage.title",values:{numEdits:r,page:(0,Z.jsx)(g.Z,{store:h,style:s.pageTitle})}})})}),a&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{style:s.subheader,children:"Updated title"}),p&&(0,Z.jsx)(ie,{spaceId:m,blockIds:[t.pageId],parentStore:d})]}),S.length>0&&(0,Z.jsxs)(Z.Fragment,{children:[`Updated ${S.length} ${S.length>1?"properties":"property"}`,p&&S.map(((e,t)=>(0,Z.jsx)(se,{pageStore:h,property:e},t)))]}),e.size>0&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{style:s.subheader,children:`Inserted ${e.size} block${e.size>1?"s":""}`}),p&&(0,Z.jsx)(ie,{spaceId:m,blockIds:Array.from(e),parentStore:d})]}),n.size>0&&(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsxs)("div",{style:s.subheader,children:[`Updated ${n.size} block${n.size>1?"s":""}`,p&&(0,Z.jsx)(ie,{spaceId:m,blockIds:Array.from(n),parentStore:d})]})}),i.size>0&&(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsxs)("div",{style:s.subheader,children:[`Removed ${i.size} block${i.size>1?"s":""}`,p&&(0,Z.jsx)(ie,{spaceId:m,blockIds:Array.from(i),parentStore:d})]})})]})}if("removedPage"===t.type)return(0,Z.jsx)(H.Z,{style:s.header,href:y,children:(0,Z.jsx)("span",{children:(0,Z.jsx)(u.FormattedMessage,{defaultMessage:"Deleted {page}",id:"assistant.transactionRenderer.removedPage.title",values:{page:(0,Z.jsx)("span",{style:{fontWeight:L.Z.fontWeight.bold},children:(0,Z.jsx)(g.Z,{store:h,style:s.pageTitle})})}})})});(0,c.t1)(t)}function se(e){window.__c={n:"BlockPropertyRenderer"};const{pageStore:t,property:n}=e,s=(0,a.VK)((()=>t.getAssociatedCollectionStore()),[t]),i=(0,a.VK)((()=>{const e=null==s?void 0:s.getSchema(),t=Object.entries(e||{}).find((e=>{let[t]=e;return t===n}));return null==t?void 0:t[1]}),[s,n]),o=(0,a.VK)((()=>t.getPropertyValue(n)),[t,n]),r=(0,a.VK)((()=>null==s?void 0:s.getSpaceId()),[s]);return s&&i&&r?(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(E.Hq,{labeled:!0,name:i.name,type:i.type,icon:i.icon,style:{marginBottom:6},children:(0,Z.jsx)(N.Z,{propertySchema:i,beforeValue:{value:[],spaceId:r},afterValue:{value:o||[],spaceId:r},rootStore:t})})}):null}function ie(e){window.__c={n:"BlockListRenderer"};const{blockIds:t,parentStore:n,spaceId:i}=e,a=V.d9(t).reverse(),o=(0,s.useMemo)((()=>k.Z.withListenerIgnored((()=>a.map((e=>v.G.createChildStore(n,{table:K.iU,id:e,spaceId:i})))))),[a,n,i]);return(0,Z.jsx)(I.O,{displayName:"AssistantBlockRenderer",disabled:!0,children:o.map(((e,t)=>(0,Z.jsx)(ae,{store:e},t)))})}function ae(e){window.__c={n:"BlockRenderer"};const{store:t}=e,n=(0,a.VK)((()=>(0,W.h)(t)),[t]);return n?(0,Z.jsx)(n,{store:t,disabled:!0,isFirstItem:!1,isLastItem:!1}):null}var oe=n(65422),re=n(28495),le=n(11751);function de(e){var t;window.__c={n:"AssistantWorkflowRenderer"};const{clientStep:n}=e,s=(0,o.yK)((e=>({header:{display:"flex",alignItems:"center",marginTop:4,marginBottom:4,color:e.aiPurpleColor},headerIcon:{width:10,fill:e.aiPurpleColor,marginRight:4},name:{display:"flex",alignItems:"center",fontWeight:500,marginBottom:4},description:{display:"flex",alignItems:"center",marginBottom:8},triggersHeader:{display:"flex",alignItems:"center",marginBottom:4,color:e.mediumTextColor},trigger:{display:"flex",alignItems:"center",marginBottom:4,background:"rgba(0,0,0,0.03)",padding:4,borderRadius:8},stepsHeader:{display:"flex",alignItems:"center",marginBottom:4,color:e.mediumTextColor},step:{display:"flex",alignItems:"center",marginBottom:4,background:"rgba(0,0,0,0.03)",padding:4,borderRadius:8},pageUpdatedTriggerIcon:{width:14,marginRight:6,marginLeft:4},codeStepIcon:{width:14,marginRight:6,marginLeft:4},aiStepIcon:{width:14,marginRight:6,marginLeft:4},humanStepIcon:{width:14,marginRight:6,marginLeft:4}})),[]);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)("div",{style:s.header,children:[(0,oe.K)(s.headerIcon),(0,Z.jsx)(u.FormattedMessage,{id:"AssistantWorkflowRenderer.header",defaultMessage:"Workflow"})]}),(0,Z.jsx)("div",{style:s.name,children:n.automation.name}),(0,Z.jsx)("div",{style:s.description,children:n.automation.description}),(0,Z.jsx)("div",{style:s.stepsHeader,children:(0,Z.jsx)(u.FormattedMessage,{id:"AssistantWorkflowRenderer.stepsHeader",defaultMessage:"Steps"})}),null===(t=n.automation.steps)||void 0===t?void 0:t.map(((e,t)=>"code"===e.type?(0,Z.jsxs)("div",{style:s.step,children:[(0,r._)(s.codeStepIcon),e.description]},t):"prompt"===e.type?(0,Z.jsxs)("div",{style:s.step,children:[(0,le.t)(s.aiStepIcon),e.description]},t):"human"===e.type?(0,Z.jsxs)("div",{style:s.step,children:[(0,re.v)(s.humanStepIcon),e.description]},t):void(0,c.t1)(e.type)))]})}function ce(e){window.__c={n:"AssistantChatStep"};const{clientStep:t,parentStore:n,parentSpaceId:s,fakeSlackUser:k,configurationState:b,isQuickSearchMode:C,renderAsFullPage:j,latestStepCitationHoverStore:M}=e,I=(0,i.O7)(),A=(0,o.Fg)(),T=(0,a.VK)((()=>{const e=S.Z.getActiveAssistantRuntimeStore(),t=(null==e?void 0:e.getCombinedSteps())??[],n=t.findLast((e=>"human"===e.type));if(!n)return;const s=t.indexOf(n);return t.slice(s-1).find((e=>"assistantSearch"===e.type||"assistantLoadPage"===e.type))}),[]),R=(0,a.VK)((()=>{var e;return(null===(e=S.Z.getActiveAssistantRuntimeStore())||void 0===e||null===(e=e.state)||void 0===e?void 0:e.isAiProviderDown)??!1}),[]),_=(0,a.VK)((()=>x.default.getConfigKey("assistant_error_message_override","message")),[]),{isCurrentClientStepLatestStep:B,priorSearchResultsStep:V}=(0,a.VK)((()=>{const e=S.Z.getActiveAssistantRuntimeState(),n=[...(null==e?void 0:e.clientSteps)??[],...(null==e?void 0:e.temporaryClientSteps)??[]],s=n.indexOf(t),i=s-1>=0?n[s-1]:void 0;return{isCurrentClientStepLatestStep:s>=0&&s===n.length-1,priorSearchResultsStep:"assistantShowSearchResults"===(null==i?void 0:i.type)?i:void 0}}),[t]),K=(0,a.VK)((()=>"human"===t.type?{element:(0,Z.jsx)("div",{style:{wordBreak:"break-word"},children:(0,y.IY)({environment:I,textValue:{value:t.text,spaceId:(0,d.C)(s)},parentStore:n,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,theme:A,emojiType:(0,h.e_)(I),katex:I.KatexStore.getKatex(),formulaValueTypes:[]})})}:"assistantLoading"===t.type?{element:(0,Z.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:["assistantSearch"===(null==T?void 0:T.type)?(0,Z.jsx)(u.FormattedMessage,{id:"AssistantChatStep.searching",defaultMessage:"Searching {icon} {keywords}",description:"Placeholder text while the AI is searching. The icon is a magnifying glass.",values:{icon:(0,l.R)({width:12,height:12}),keywords:(0,Z.jsx)("span",{style:{fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",maxWidth:"70%",textTransform:"lowercase",whiteSpace:"nowrap"},children:T.query.questionIntl??T.query.keywords})},children:function(e){return(0,Z.jsx)(Z.Fragment,{children:e.map(((e,t)=>"string"==typeof e?(0,Z.jsx)("span",{children:e},t):e))})}}):"assistantLoadPage"===(null==T?void 0:T.type)?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(u.FormattedMessage,{id:"AssistantChatStep.loadingPage",defaultMessage:"Reading page"})," "]}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(u.FormattedMessage,{id:"AssistantChatStep.thinking",defaultMessage:"Thinking"})," "]}),(0,Z.jsx)("div",{style:{marginLeft:4},children:(0,Z.jsx)(p.Z,{isTriColored:!0})})]})}:"assistantChatText"===t.type?(0,f.S)(t)?{element:null,doNotWrap:!0}:{element:(0,Z.jsx)(P,{clientStep:t})}:"assistantChat"===t.type?(0,f.S)(t)?{element:null,doNotWrap:!0}:{element:(0,Z.jsx)(w.m,{clientStep:t,parentStore:n,configurationState:b,fakeSlackUser:k,isLatestStep:B,isQuickSearchMode:C,renderAsFullPage:j,priorSearchResultsStep:V,citationHoverStore:B?M:void 0}),doNotWrap:!0}:"assistantTransaction"===t.type?{element:(0,Z.jsx)(te,{clientStep:t})}:"assistantFriendlyError"===t.type?{element:(0,Z.jsx)("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",padding:"8px 4px"},children:_||(R?"I'm sorry! We’re experiencing issues with our AI provider. Try again in a few minutes.":"I'm sorry! I wasn't able to complete this query. Please try asking me a different question.")})}:"assistantSearch"===t.type?{element:(0,Z.jsx)(m.ZP,{placement:m.ug.Left,renderTooltip:()=>(0,Z.jsx)("div",{style:{whiteSpace:"pre"},children:JSON.stringify(t.query,null,2)}),delayThreshold:0,render:e=>(0,Z.jsxs)("div",{style:{display:"flex",alignItems:"center"},...e,children:[(0,r._)({width:16,marginRight:4,marginTop:4}),`Search ${t.query.question}`]})})}:"assistantLoadPage"===t.type?{element:(0,Z.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r._)({width:16,marginRight:4,marginTop:4}),"Load page",(0,Z.jsx)("div",{style:{marginLeft:6},children:(0,Z.jsx)(g.Z,{store:v.G.createChildStore(n,t.pointer)})})]})}:"assistantSearchPeople"===t.type?{element:(0,Z.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r._)({width:16,marginRight:4,marginTop:4}),`Search people ${t.search}`]})}:"queryDatabase"===t.type?{element:(0,Z.jsx)(m.ZP,{placement:m.ug.Left,renderTooltip:()=>(0,Z.jsx)("div",{style:{whiteSpace:"pre"},children:JSON.stringify(t.query,null,2)}),delayThreshold:0,render:e=>(0,Z.jsxs)("div",{style:{display:"flex",alignItems:"center"},...e,children:[(0,r._)({width:16,marginRight:4,marginTop:4}),"Query database",(0,Z.jsx)("div",{style:{marginLeft:6},children:(0,Z.jsx)(g.Z,{store:v.NW.createChildStore(n,t.collectionPointer)})})]})})}:"assistantShowSearchResults"===t.type?{element:null,doNotWrap:!0}:"assistantLimitReached"===t.type?{element:(0,Z.jsx)(Z.Fragment,{children:t.message})}:"assistantCreateAutomation"===t.type?{element:(0,Z.jsx)(de,{clientStep:t})}:void(0,c.t1)(t)),[t,I,s,n,A,b,k,B,C,j,V,M,T,R,_]);return K.doNotWrap?K.element:(0,Z.jsx)(F.J,{clientStep:t,configurationState:b,fakeSlackUser:k,forceShowFeedback:B,children:K.element})}},46370:(e,t,n)=>{n.d(t,{J:()=>U,O:()=>D});var s=n(67294),i=n(480),a=n(6740),o=n(24405),r=n(72126),l=n(26388),d=(n(95477),n(86628)),c=n(33676),u=n(97022),p=n(39986),g=n(10498),m=n(24677),h=n(23063),f=n(73063),y=n(21273),S=n(49085);class x extends S.default{getInitialState(){return{}}}const v=new x;var w=n(98180);class k extends S.default{getInitialState(){return{open:!1,inferenceId:void 0}}}const b=new k;var C=n(60117);const j=["incorrect-database-query","should-have-answered-after-loading-page","should-have-searched-after-loading-page","should-have-searched-without-loading-page"];var M=n(82990),I=n(9291),A=n(54642),T=n(42922),Z=n(60458),P=n(36488),F=n(74194),R=n(63296),_=n(53336),B=n(92660),V=n(34859),K=n(80444),L=n(69454),E=n(85893);function W(){window.__c={n:"ReportBadQnAForm"};const{isMobile:e}=(0,i.Fy)(),t=(0,o.yK)((t=>({wrap:{display:"flex",flexDirection:"column",width:e?"min(100%, 600px)":void 0,minHeight:128,maxHeight:e?void 0:"max(calc(100vh - 78px), 300px)"},modalWrap:{width:"32rem",padding:24,fontSize:14,maxWidth:"100%"},modalTitle:{fontSize:16,fontWeight:M.Z.fontWeight.medium},modalWarning:{fontSize:13,color:t.lightTextColor},titleContainer:{marginBottom:12},buttonArea:{display:"flex",justifyContent:"flex-end",marginTop:18,gap:8},scroller:{flexGrow:1,display:"flex",flexDirection:"column",WebkitMaskImage:"linear-gradient(black calc(100% - 12px), transparent)"}})),[e]),n=(0,I.useIntl)(),[a,r]=(0,s.useState)(),[l,c]=(0,s.useState)([]),u=(0,d.VK)((()=>K.default.state.currentSpaceStore),[]),p=(0,i.O7)(),g=(0,d.VK)((()=>y.Z.isXMLAssistantEnabled(void 0)||y.Z.isJSAssistantEnabled()),[]),m=(0,s.useCallback)((()=>{const{inferenceId:e}=b.state,t=null==u?void 0:u.id;e&&t&&(A.saveAssistantFeedback(p,{type:"slackbot_followup_feedback",id:e,notes:a||"",tags:l}),b.reset())}),[null==u?void 0:u.id,p,a,l]),h=(0,s.useRef)(void 0);return(0,E.jsx)(B.Z,{onDismiss:O,style:e?{maxHeight:"100%",display:"flex"}:{},render:()=>(0,E.jsx)(P.Z,{allowMobileAutoScroll:!0,capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:s=>(0,E.jsx)("div",{style:t.wrap,children:(0,E.jsx)(_.Z,{ref:h,type:V.Z.Y,style:t.scroller,...s,children:(0,E.jsxs)("div",{style:t.modalWrap,...s,children:[(0,E.jsxs)("div",{style:t.titleContainer,children:[(0,E.jsx)("div",{style:t.modalTitle,children:(0,E.jsx)(I.FormattedMessage,{id:"BadQnAFeedbackForm.title",defaultMessage:"Give additional feedback on this answer"})}),(0,E.jsx)("div",{style:t.modalWarning,children:(0,E.jsx)(I.FormattedMessage,{id:"BadQnAFeedbackForm.warning",defaultMessage:"The chat transcript and the pages from the search results will be sent to Notion for quality improvement"})})]}),g&&j.map((e=>(0,E.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,E.jsx)(Z.Z,{size:16,checked:l.includes(e),onClick:()=>{l.includes(e)?c(l.filter((t=>t!==e))):c([...l,e])}}),(0,E.jsx)("span",{style:{marginLeft:4},children:e})]},e))),(0,E.jsx)(F.Z,{placeholder:n.formatMessage({id:"BadQnAFeedbackForm.additionalCommentsPlaceholder",defaultMessage:"Add feedback..."}),value:a,onChange:e=>r(e.target.value),focusInitial:!e,onFocus:()=>{e&&L.Z.onShow((()=>{var e;null===(e=h.current)||void 0===e||e.scrollToBottom()}))},inputStyle:{padding:8}}),(0,E.jsxs)("div",{style:t.buttonArea,children:[(0,E.jsx)(R.Z,{onClick:O,children:(0,E.jsx)(I.FormattedMessage,{id:"BadQnAFeedbackForm.cancelButton.label",defaultMessage:"Cancel"})}),(0,E.jsx)(T.Z,{isLarge:!0,onClick:m,children:(0,E.jsx)(I.FormattedMessage,{id:"BadQnAFeedbackForm.reportButton.label",defaultMessage:"Send"})})]})]})})})}),requireOnline:!0,modalStore:b})}function O(){b.update((()=>({open:!1,inferenceId:void 0})))}function H(e){let{configurationState:t,environment:n,isVisible:i,clientStep:a,style:r}=e;window.__c={n:"AssistantFeedbackButtons"};const{inferenceId:l}=a,f=(0,d.VK)((()=>v.state[l]??void 0),[l]),S=(0,d.VK)((()=>y.Z.isXMLAssistantEnabled(void 0)||y.Z.isJSAssistantEnabled()),[]),x=(0,o.yK)((e=>({thumbsUpFeedbackButton:{width:14,height:14,fill:"thumbs_up"===f?e.blueButtonBackground:e.grayButtonHoveredBackground},thumbsDownFeedbackButton:{width:14,height:14,fill:"thumbs_down"===f?e.blueButtonBackground:e.grayButtonHoveredBackground}})),[f]),k=(0,s.useCallback)((()=>{const e=w.Z.getActiveSessionId();e&&(C.assistantActions.saveFeedback({environment:n,inferenceId:l,type:"assistant_thumbs_up",sessionId:e}),v.update((e=>({...e,[l]:"thumbs_up"}))),S&&b.update((()=>({open:!0,inferenceId:l}))))}),[n,l,S]),j=(0,s.useCallback)((()=>{m.ZH({device:n.device});const e=w.Z.getActiveSessionId();e&&(C.assistantActions.saveFeedback({environment:n,inferenceId:l,type:"assistant_thumbs_down",sessionId:e}),v.update((e=>({...e,[l]:"thumbs_down"}))),b.update((()=>({open:!0,inferenceId:l}))))}),[n,l]);return(0,E.jsx)(h.Z,{isVisible:!0,animationStyle:{opacity:i||Boolean(f)?1:0},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:1},render:()=>(0,E.jsxs)("div",{style:{marginTop:"auto",display:"flex",...r},children:[(0,E.jsx)(N,{type:"up",iconHollow:p.P,iconFilled:g.w,onClick:k,style:x.thumbsUpFeedbackButton,feedbackReceived:f}),(0,E.jsx)(N,{type:"down",iconHollow:c.A,iconFilled:u.E,onClick:j,style:x.thumbsDownFeedbackButton,feedbackReceived:f}),(0,E.jsx)(W,{})]})})}function N(e){let{type:t,iconHollow:n,iconFilled:s,feedbackReceived:i,style:a,onClick:o}=e;const r=i===`thumbs_${t}`;return(0,E.jsx)(f.Z,{icon:r?s:n,onClick:r?()=>{}:o,disableBackground:r,iconStyle:{cursor:r?"initial":"pointer",...a},ariaLabel:`Thumbs ${t} feedback on assistant message`})}const D="min(calc(100% - 48px), 512px)",U=(0,s.forwardRef)((function(e,t){window.__c={n:"AssistantChatStepWrapper"};const{children:n,clientStep:d,configurationState:c,fakeSlackUser:u,forceShowFeedback:p}=e,g=(0,i.O7)(),m=g.device.isMobile,h=(0,o.yK)((e=>({wrap:{display:"flex",marginTop:6,marginBottom:6,gap:6},baseMessage:{maxWidth:D,borderRadius:16,padding:"4px 12px",fontSize:m?15:14,whiteSpace:"pre-wrap",overflowWrap:"break-word",position:"relative",lineHeight:1.45},userLabel:{fontSize:12,color:e.mediumTextColor},humanMessage:{backgroundColor:"light"===e.mode?e.cardHoveredBackground:e.accentColors.translucentGray[100],color:e.darkTextColor,padding:"6px 14px",border:"unset"},assistantLoadingMessage:{fontSize:12,color:e.lightTextColor,fontWeight:500,padding:"4px 0 0 6px"},assistantShowSearchResultsMessage:{color:e.mediumTextColor,border:`1px solid ${"light"===e.mode?e.accentColors.gray[75]:e.accentColors.translucentGray[200]}`},assistantMessage:{border:`1px solid ${"light"===e.mode?e.accentColors.gray[75]:e.accentColors.translucentGray[200]}`,backgroundColor:"light"===e.mode?e.contentBackground:e.accentColors.translucentGray[200],color:e.regularTextColor,padding:"2px 10px",boxShadow:"0px 2px 4px 0px rgba(0, 0, 0, 0.04), 0px 0px 6px 0px rgba(0, 0, 0, 0.02)"}})),[m]),[f,y]=(0,s.useState)(!1),S=(0,s.useMemo)((()=>(0,r.Ds)(y,100)),[y]);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(l.ZP,{placement:l.ug.Left,textWrap:!0,style:{maxWidth:240},disableTooltip:!("thought"in d&&d.thought,0),renderTooltip:()=>"thought"in d?`💡 ${d.thought}`:void 0,delayThreshold:500,render:e=>(0,E.jsxs)("div",{ref:t,style:h.wrap,...e,onFocus:t=>{var n;null===(n=e.onFocus)||void 0===n||n.call(e,t),(0,a.E)(t.target)&&S(!0)},onMouseEnter:t=>{var n;null===(n=e.onMouseEnter)||void 0===n||n.call(e,t),S(!0)},onBlur:t=>{var n;null===(n=e.onBlur)||void 0===n||n.call(e,t),S(!1)},onMouseLeave:t=>{var n;null===(n=e.onMouseLeave)||void 0===n||n.call(e,t),S(!1)},children:["human"===d.type&&(0,E.jsx)("div",{style:{flexGrow:1}}),(0,E.jsx)("div",{style:{...h.baseMessage,..."human"===d.type?h.humanMessage:"assistantLoading"===d.type?h.assistantLoadingMessage:"assistantShowSearchResults"===d.type?h.assistantShowSearchResultsMessage:h.assistantMessage},children:n}),("assistantChat"===d.type||"assistantTransaction"===d.type)&&(0,E.jsx)(H,{configurationState:c,environment:g,isVisible:f||p,clientStep:d})]})}),u&&"human"===d.type&&(0,E.jsxs)("div",{style:{display:"flex"},children:[(0,E.jsx)("div",{style:{flexGrow:1}}),(0,E.jsx)("div",{style:h.userLabel,children:u.name})]})]})}))},41625:(e,t,n)=>{n.d(t,{Q:()=>ee,G:()=>X});n(21703);var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(59054),l=n(37652),d=n(1464),c=n(64275),u=n(56666),p=n(63048),g=n(149),m=n(97880),h=n(82990),f=n(9291),y=n(82530),S=n(29286),x=n(31945),v=n(73063),w=n(89728),k=n(26388),b=n(80444),C=n(21273),j=n(98180),M=n(61766),I=n(28344),A=n(42915),T=n(45891),Z=n(33932),P=n(70771),F=n(59107),R=n(87066),_=n(56206),B=n(40824),V=n(18707),K=n(53336),L=n(34859),E=n(78158),W=n(85893);function O(e){const{renderAsFullPage:t,spaceStore:n}=e;return(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(K.Z,{type:L.Z.Y,children:(0,W.jsx)(E.F,{renderAsFullPage:t,spaceStore:n})})})}var H=n(42853),N=n(31278);function D(e){window.__c={n:"AssistantAutomationSwitcherButton"};const{store:t}=e,n=(0,a.VK)((()=>t.state),[t]),i=(0,o.yK)((e=>({button:{flexShrink:1},icon:{marginRight:6},chevronDown:{fill:e.mediumIconColor,width:12,marginLeft:4},name:{...h.Z.textOverflowStyle}})),[]),r=(0,s.useCallback)((()=>{(0,Z.navigateToView)({view:"automations"})}),[]),l=(0,a.VK)((()=>{var e;return null==n||null===(e=n.automationStore)||void 0===e||null===(e=e.getIconStore())||void 0===e?void 0:e.getValue()}),[null==n?void 0:n.automationStore]),d=(0,a.VK)((()=>{var e;return null==n||null===(e=n.automationStore)||void 0===e?void 0:e.getName()}),[null==n?void 0:n.automationStore]);return null!=n&&n.automationStore?(0,W.jsxs)(w.Z,{onClick:r,style:i.button,children:[l&&(0,W.jsx)(N.Z,{disabled:!0,isEmptyPage:!1,size:18,icon:{icon:l,pointer:n.automationStore.pointer},style:i.icon}),(0,W.jsx)("div",{style:i.name,children:d}),(0,H.i)(i.chevronDown)]}):null}var U=n(35245),z=n(17456),q=n(40719),Q=n(80594),G=n(14309),$=n(71844),Y=n(5175);function J(e){window.__c={n:"AssistantSkillSwitcherButton"};const{store:t}=e,n=(0,a.VK)((()=>t.state),[t]),i=(0,o.yK)((e=>({skillIcon:{fill:e.aiPurpleColor},chevronDown:{fill:e.mediumIconColor,width:12,marginLeft:4}})),[]),r=(0,s.useCallback)((()=>{(0,Z.navigateToView)({view:"skillSwitcher"})}),[]);if(null==n||!n.selectedSkill)return null;const{selectedSkill:l}=n;return(0,W.jsxs)(w.Z,{onClick:r,icon:$.skillIconMap[l.skillType],iconStyle:i.skillIcon,children:[(0,W.jsx)(Y.Z,{clientSkill:l}),(0,H.i)(i.chevronDown)]})}const X=new M.Z;function ee(e){window.__c={n:"AssistantMenu"};const{renderAsFullPage:t,showBackButton:n,onClose:l}=e,d=(0,i.O7)(),c=(0,a.VK)((()=>C.Z.isJSAssistantEnabled()),[]),u=(0,a.VK)((()=>j.Z.getActiveAssistantRuntimeState()),[]),p=(0,a.VK)((()=>C.Z.isXMLAssistantEnabled(null==u?void 0:u.selectedSkill)),[u]),g=(0,a.VK)((()=>{var e;return null===(e=b.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),h=(0,a.VK)((()=>_.d.state.currentView),[]);(0,r.r5)((async()=>{g&&p&&!c&&await(0,P.K7)({environment:d,spaceId:g})}),[d,g,p,c]),(0,r.r5)((async()=>{g&&c&&await(0,A.Jl)({environment:d,spaceId:g})}),[d,g,c]);const f=(0,s.useCallback)((()=>{B.N.setAssistantLastViewedTime(),null==l||l();const e=C.Z.isAssistantExperienceQna(),t=j.Z.getActiveAssistantConfigurationState();t&&e&&I.trackQnaClosed(d,{configurationState:t,runtimeState:j.Z.getActiveAssistantRuntimeState(),from:"button"})}),[d,l]),y=(0,o.yK)((e=>({wrap:{display:"flex",flexDirection:"column",width:t?"min(100%, 640px)":375,transition:"height 200ms ease",minHeight:128,height:t?"100%":void 0,maxHeight:t?void 0:"max(calc(100vh - 78px), 300px)"}})),[t]),S={onClose:f,renderAsFullPage:Boolean(t),showBackButton:Boolean(n)};let x;return"chat"===h?x=(0,W.jsx)(te,{...S}):"skillSwitcher"===h?x=(0,W.jsx)(ne,{...S}):"automations"===h?x=(0,W.jsx)(se,{...S}):"chatHistory"===h?x=(0,W.jsx)(ie,{...S}):(0,m.t1)(h),(0,W.jsx)("div",{style:y.wrap,children:x})}function te(e){var t;window.__c={n:"ChatBody"};const{renderAsFullPage:n,showBackButton:s,onClose:r}=e,l=(0,i.O7)(),d=(0,o.yK)((e=>({headerButton:{color:e.mediumIconColor}})),[]),c=(0,a.VK)((()=>C.Z.isJSAssistantEnabled()),[]),p=(0,a.VK)((()=>j.Z.getActiveAssistantRuntimeStore()),[]),g=(0,a.VK)((()=>j.Z.getActiveAssistantRuntimeState()),[]),m=(0,a.VK)((()=>C.Z.isXMLAssistantEnabled(null==g?void 0:g.selectedSkill)),[g]);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(ae,{renderAsFullPage:n,backButtonVariant:s?"closeChat":"none",onClose:r,extraRightAlignedContent:l.device.isMobileNative?void 0:(0,W.jsx)(x.ZP,{buttonPopupStore:X,alignmentToOrigin:x.vR.Start,placementToOrigin:x.pO.Left,popupType:l.device.isMobile?x.Z4.SlideUp:x.Z4.Popup,renderOrigin:e=>(0,W.jsx)(k.ZP,{render:t=>(0,W.jsx)(v.Z,{iconStyle:{width:16,height:16},icon:u.o,ariaLabel:"more",...t,...e}),renderTooltip:()=>(0,W.jsx)(f.FormattedMessage,{id:"assistant.help",defaultMessage:"Help, contact, more..."})}),render:e=>(0,W.jsx)(q.u,{buttonPopupParent:e,onClickViewHistory:()=>{_.d.setState({..._.d.state,currentView:"chatHistory"}),(0,I.trackAiChatTranscriptHistoryOpenHistoryButtonSelected)(l,{from:"assistant_right_side_pane"})}})}),children:[g&&p&&m&&(0,W.jsx)(J,{store:p}),m&&"persisted"===(null==g||null===(t=g.selectedSkill)||void 0===t?void 0:t.type)&&(0,W.jsx)(Q.Z,{clientSkill:g.selectedSkill,renderOrigin:e=>(0,W.jsx)(w.Z,{...e,style:d.headerButton,children:(0,W.jsx)(f.FormattedMessage,{id:"assistantMenu.skillEdit.label",defaultMessage:"Edit"})})}),g&&p&&c&&g.automationStore&&(0,W.jsx)(D,{store:p}),c&&(null==g?void 0:g.automationStore)&&(0,W.jsx)(V.Z,{automationStore:g.automationStore,renderOrigin:e=>(0,W.jsx)(w.Z,{...e,style:d.headerButton,children:(0,W.jsx)(f.FormattedMessage,{id:"assistantMenu.automationEdit.label",defaultMessage:"Edit"})})}),!(null!=g&&g.automationStore)&&(0,W.jsx)(S.Z,{})]}),(0,W.jsx)(U.R3,{renderAsFullPage:Boolean(n)})]})}function ne(e){window.__c={n:"SkillSwitcherBody"};const{renderAsFullPage:t,showBackButton:n,onClose:i}=e,a=(0,o.yK)((()=>({header:{marginLeft:4,fontSize:14}})),[]),r=(0,s.useCallback)((()=>{Z.navigateToView({view:"chat"})}),[]);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(ae,{renderAsFullPage:t,backButtonVariant:n?"closeChat":"none",onClose:i,children:[(0,W.jsx)(v.Z,{icon:l.V,onClick:r,ariaLabel:"back"}),(0,W.jsx)("div",{style:a.header,children:"All skills"})]}),(0,W.jsx)(G.Z,{renderAsFullPage:Boolean(t)})]})}function se(e){window.__c={n:"AutomationsBody"};const{renderAsFullPage:t,showBackButton:n,onClose:r}=e,d=(0,i.O7)(),c=(0,o.yK)((()=>({addWorkflowIcon:{width:14},header:{marginLeft:4,fontSize:14}})),[]),u=(0,a.VK)((()=>b.default.state.currentSpaceStore),[]),[g,m]=(0,s.useState)(void 0),h=(0,s.useCallback)((()=>{Z.navigateToView({view:"chat"})}),[]),f=(0,s.useCallback)((()=>{const{mainEditorCurrentBlockStore:e}=b.default.state;if(!e)throw new Error("mainEditorCurrentBlockStore is undefined");const t=e.getCollectionViewSourceCollectionStore(),n=y.createAndCommit({environment:d,userAction:"createAutomation",perform:n=>(0,A.wv)({environment:d,parent:t||e,transaction:n})}).performResult;m(n)}),[d]);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(ae,{renderAsFullPage:t,backButtonVariant:n?"closeChat":"none",onClose:r,extraRightAlignedContent:(0,W.jsx)(V.Z,{automationStore:g,renderOrigin:e=>(0,W.jsx)(v.Z,{iconStyle:c.addWorkflowIcon,icon:p.C,ariaLabel:"Add workflow",...e}),onClick:f}),children:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(v.Z,{icon:l.V,onClick:h,ariaLabel:"back"}),(0,W.jsx)("div",{style:c.header,children:"Workflows"})]})}),u&&(0,W.jsx)(O,{renderAsFullPage:Boolean(t),spaceStore:u})]})}function ie(e){window.__c={n:"ChatHistoryBody"};const{renderAsFullPage:t,showBackButton:n,onClose:s}=e,r=(0,i.O7)(),l=(0,o.yK)((e=>({newChatButtonText:{color:e.lightTextColor,fontSize:12,display:"flex",alignItems:"center"},chatHistoryTitle:{fontSize:14,fontWeight:h.Z.fontWeight.medium,display:"flex",alignItems:"center",paddingLeft:3}})),[]),d=(0,a.VK)((()=>R.Z.state.previouslyVisitedSessionId),[]);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(ae,{renderAsFullPage:t,backButtonVariant:n?"closeChat":d?"returnToChat":"none",onClose:s,extraRightAlignedContent:(0,W.jsx)(w.Z,{style:l.newChatButtonText,onClick:()=>{(0,z.l)({environment:r,makeActiveSession:!0})},isSmall:!0,children:(0,W.jsx)(f.FormattedMessage,{id:"searchAssistantPane.header.newChat.label",defaultMessage:"New chat"})}),children:(0,W.jsx)("div",{style:l.chatHistoryTitle,children:(0,W.jsx)(f.FormattedMessage,{id:"assistantMenu.header.askNotionAI.header",defaultMessage:"All chats"})})}),(0,W.jsx)(z.p,{variant:"rightSideChat",renderAsFullPage:t})]})}function ae(e){window.__c={n:"HeaderContentWrapper"};const{children:t,onClose:n,extraRightAlignedContent:r,renderAsFullPage:u,backButtonVariant:p}=e,m=Boolean(r||!u),h=(0,o.yK)((()=>({wrap:{display:"flex",alignItems:"center",pointerEvents:"auto",paddingTop:12,paddingLeft:16,paddingRight:16,paddingBottom:12},leftContentWrap:{display:"flex",flexGrow:1,alignItems:"center",overflow:"hidden",marginRight:m?8:0},rightContentWrap:{display:"flex",flexShrink:0,alignItems:"center",gap:8},backwardButton:{borderRadius:"100%",marginRight:6},backwardButtonIcon:{width:32,height:32},closeButton:{borderRadius:"100%",width:22,height:22}})),[m]),f=function(e){const t=(0,i.O7)(),n=(0,F.M)(),a=null==n?void 0:n.find((t=>t.id===e)),o=(0,F.A)({store:a}),r=(0,s.useCallback)((async()=>{if(!o)return;if("loading"===o.status||g.x.isFail(o.result))return;if(!o.result.value)return;const e=o.result.value;await(0,T.t)(e,t),_.d.setState({..._.d.state,currentView:"chat"}),(0,I.trackAIChatTranscriptHistoryItemRestored)(t,{sessionId:e.sessionId,stepId:e.id})}),[t,o]);return(0,s.useCallback)((()=>{a||(0,z.l)({environment:t,makeActiveSession:!0}),r()}),[t,r,a])}((0,a.VK)((()=>R.Z.state.previouslyVisitedSessionId),[]));return(0,W.jsxs)("div",{style:h.wrap,children:[(0,W.jsxs)("div",{style:h.leftContentWrap,children:["closeChat"===p&&(0,W.jsx)(v.Z,{iconStyle:h.backwardButtonIcon,style:h.backwardButton,icon:d.k,onClick:n,disableBackground:!0,isDarkIconColor:!0,ariaLabel:"close"}),"returnToChat"===p&&(0,W.jsx)(v.Z,{iconStyle:{width:17,height:17},style:h.backwardButton,icon:l.V,onClick:f,disableBackground:!0,isDarkIconColor:!0,ariaLabel:"close"}),t]}),m?(0,W.jsxs)("div",{style:h.rightContentWrap,children:[r,!u&&(0,W.jsx)(v.Z,{style:h.closeButton,hovered:!0,icon:c.D,onClick:n,ariaLabel:"close"})]}):null]})}},40719:(e,t,n)=>{n.d(t,{u:()=>U});var s=n(67294),i=n(86628),a=n(97880),o=(n(57658),n(82801),n(13991)),r=n(7057),l=n(80721),d=n(5257),c=n(9291),u=n(19124),p=n(87279),g=n(98180),m=n(7339),h=n(52275),f=n(73063),y=n(78140),S=n(32163),x=n(72495),v=n(86825),w=n(85893);function k(e){window.__c={n:"AssistantDebugPopupMenu"};const{buttonPopupParent:t}=e,n=(0,c.useIntl)(),[k,j]=(0,s.useState)(void 0),M=(0,i.VK)((()=>function(e){const t=[];for(const[i,l]of(0,a.qP)(g.Z.state.sessions)){var n,s;const a=null==l||null===(n=l.assistantConfigurationStore.state)||void 0===n?void 0:n.startTimestamp;t.push({sessionId:i.toString(),skillType:(null==l||null===(s=l.assistantRuntimeStore.state)||void 0===s||null===(s=s.selectedSkill)||void 0===s?void 0:s.skillType)??"general_assistant",timestamp:void 0!==a?(0,r.$b)(a,o.SP,e):void 0})}return t}(n)),[n]),I=(0,s.useCallback)((()=>{const e=b(null==k?void 0:k.sessionId),t=(null==e?void 0:e.getTranscript())??[],n=C(null==k?void 0:k.sessionId);n&&t.push(n);const s=JSON.stringify(t);navigator.clipboard.writeText(s)}),[k]),A=(0,s.useCallback)((()=>{const e=b(null==k?void 0:k.sessionId),t=C(null==k?void 0:k.sessionId),n=null==e?void 0:e.getInferenceInputForEval({skipLastAssistantStep:!0,appendPreviewingStepForDebug:t}),s=JSON.stringify(n);navigator.clipboard.writeText(s)}),[k]),T=(0,s.useCallback)((()=>{const e=b(null==k?void 0:k.sessionId),t=C(null==k?void 0:k.sessionId),n=null==e?void 0:e.getInferenceInputForEval({skipLastAssistantStep:!0,appendPreviewingStepForDebug:t}),s=JSON.stringify(n),i=btoa(encodeURIComponent(s));window.open(`/design/aiJsonRenderer#jsonl=${i}`,"_blank")}),[k]),Z=(0,i.VK)((()=>(0,u.Gw)()),[]),P=(0,s.useCallback)((()=>{m.C.updateLocalOverrideGate("assistant-labeler-mode",Z?"false":"true")}),[Z]),F={key:"debug-data",render:e=>(0,w.jsx)(x.Z,{...e,desktopTitleStyle:{alignItems:"center",paddingLeft:2,marginTop:0},title:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(f.Z,{icon:l.W,ariaLabel:"debug-menu-back-button",onClick:()=>j(void 0),iconStyle:{width:12,height:12}}),null==k?void 0:k.skillType]}),right:null==k?void 0:k.timestamp}),items:[{key:"copy-transcript",render:e=>(0,w.jsx)(h.Z,{...e,title:"Copy transcript"}),action:()=>{I(),t.close()}},{key:"copy-eval",render:e=>(0,w.jsx)(h.Z,{...e,title:"Copy as AssistantInferenceInput"}),action:()=>{A(),t.close()}},{key:"open-in-jsonl-viewer",render:e=>(0,w.jsx)(h.Z,{...e,title:"Open in JSONL viewer"}),action:()=>{T(),t.close()}}]},R=M.map((e=>{let{sessionId:t,skillType:n,timestamp:s}=e;return{key:t,action:()=>{j({sessionId:t,skillType:n,timestamp:s})},render:e=>(0,w.jsx)(h.Z,{...e,title:n,right:(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[s,(0,d.o)({marginLeft:4,width:12})]})})}})),_={key:"sessions",render:e=>(0,w.jsx)(x.Z,{...e}),items:R},B={key:"empty",render:e=>(0,w.jsx)(x.Z,{...e}),items:[{key:"empty-item",action:()=>{},render:e=>(0,w.jsx)(h.Z,{...e,title:"No sessions found"})}]},V={key:"labeler-mode",render:e=>(0,w.jsx)(x.Z,{...e}),items:[{key:"labeler-mode-item",action:()=>{},render:e=>(0,w.jsx)(v.Z,{...e,title:"Labeler Mode",on:Z,onClick:P})}]},K=k?F:R.length>0?_:B;return(0,w.jsx)(y.Z,{menuType:p.og.Popup,width:300,children:(0,w.jsx)(S.Z,{type:S.i.Vertical,initialFocus:0,sections:[K,V]})})}function b(e){var t;if(e)return null===(t=g.Z.getSessionContext(e))||void 0===t||null===(t=t.assistantRuntimeStore)||void 0===t||null===(t=t.state)||void 0===t?void 0:t.evaluator}function C(e){var t;if(!e)return;const n=g.Z.getSessionContextOrThrow(e),{assistantRuntimeStore:s}=n;return null==s||null===(t=s.state)||void 0===t?void 0:t.previewingStep}var j=n(77907),M=n(33932),I=n(87066),A=n(17456),T=n(480),Z=n(24405),P=n(3124),F=n(84169),R=n(95855),_=n(76994),B=n(72126),V=n(98851),K=n(21273);function L(e){window.__c={n:"AssistantOverflowMenu"};const{onSelectGetHelp:t,onSelectSeeHistory:n,onAfterSelectNewChat:s,onSelectDebug:a}=e,o=(0,T.O7)(),r=(0,i.VK)((()=>{const e=g.Z.getActiveAssistantRuntimeState();return!e||0===e.clientSteps.length}),[]),l=(0,i.VK)((()=>K.Z.isChatHistoryEnabled()),[]),d=(0,i.VK)((()=>K.Z.shouldShowDebugHelpers()),[]),c=B.oA([l?{key:"chat history",render:e=>(0,w.jsx)(x.Z,{...e}),items:B.oA([{key:"new chat",action:()=>{(0,A.l)({environment:o,makeActiveSession:!0}),null==s||s()},render:e=>(0,w.jsx)(W,{disabled:r,...e})},{key:"open history items",action:n,render:e=>(0,w.jsx)(O,{...e})}])}:{key:"chat history",render:e=>(0,w.jsx)(x.Z,{...e}),items:B.oA([{key:"new chat",action:()=>{(0,A.l)({environment:o,makeActiveSession:!0}),null==s||s()},render:e=>(0,w.jsx)(W,{disabled:r,...e})}])},{key:"get notion help",render:e=>(0,w.jsx)(x.Z,{topBorder:!0,...e}),items:B.oA([{key:"get notion help",action:t,render:e=>(0,w.jsx)(N,{...e})}])},d&&{key:"debug",render:e=>(0,w.jsx)(x.Z,{topBorder:!0,...e}),items:B.oA([{key:"debug",action:a,render:e=>(0,w.jsx)(H,{...e})}])},{key:"version",render:e=>(0,w.jsx)(x.Z,{...e,topBorder:!0}),items:B.oA([{key:"version",action:()=>{},render:e=>{let{ref:t,...n}=e;return(0,w.jsx)(V.Z,{...n})}}])}]);let u;return u=o.device.isMobile?{menuType:p.og.ActionSheet}:{menuType:p.og.Popup,minWidth:208},(0,w.jsx)(y.Z,{...u,children:(0,w.jsx)(S.Z,{type:S.i.Vertical,initialFocus:void 0,sections:c})})}function E(e){window.__c={n:"OverflowMenuIcon"};const{size:t,iconFunc:n,disabled:s}=e,{iconStyle:i}=(0,Z.yK)((e=>{const n=t??16,i=16-n;return{iconStyle:{width:n,height:n,color:s?e.lightTextColor:e.regularTextColor,fill:s?e.lightTextColor:e.regularTextColor,marginRight:i}}}),[s,t]);return n(i)}const W=s.forwardRef(((e,t)=>{window.__c={n:"ChatHistoryNewChatButton"};const{disabled:n,...s}=e,i=(0,Z.yK)((e=>({newChatText:{color:n?e.lightTextColor:e.regularTextColor}})),[n]);return(0,w.jsx)(h.Z,{...s,ref:t,isTokenTitle:!0,icon:(0,w.jsx)(E,{disabled:n,iconFunc:R.z}),title:(0,w.jsx)("div",{style:i.newChatText,children:(0,w.jsx)(c.FormattedMessage,{defaultMessage:"New chat",id:"helpButton.newChat.menuItem"})}),disabled:n})})),O=s.forwardRef(((e,t)=>(0,w.jsx)(h.Z,{...e,ref:t,isTokenTitle:!0,icon:(0,w.jsx)(E,{iconFunc:_.w}),title:(0,w.jsx)(c.FormattedMessage,{defaultMessage:"See history",id:"helpButton.seeHistory.menuItem"})}))),H=s.forwardRef(((e,t)=>(0,w.jsx)(h.Z,{...e,ref:t,isTokenTitle:!0,icon:(0,P._)({height:16,width:16,paddingTop:4}),title:(0,w.jsx)(c.FormattedMessage,{defaultMessage:"[DEV-ONLY]: Debug",id:"helpButton.debug.menuItem"})}))),N=s.forwardRef(((e,t)=>(0,w.jsx)(h.Z,{...e,ref:t,isTokenTitle:!0,icon:(0,w.jsx)(E,{iconFunc:F.m}),title:(0,w.jsx)(c.FormattedMessage,{defaultMessage:"Get Notion help",id:"helpButton.getHelp.menuItem"})})));var D=n(61719);function U(e){window.__c={n:"OverflowMenuPopupRenderer"};const{buttonPopupParent:t}=e,[n,o]=(0,s.useState)("helpOverflowMenu"),r=(0,i.VK)((()=>g.Z.getActiveSessionId()),[]);switch(n){case"helpOverflowMenu":return(0,w.jsx)(L,{onSelectGetHelp:()=>{o("mainHelpMenu")},onSelectSeeHistory:()=>{e.onClickViewHistory?(t.close(),e.onClickViewHistory()):o("chatHistory"),r&&I.Z.setPreviouslyVisitedSession(r)},onAfterSelectNewChat:()=>{t.close()},onSelectDebug:()=>{o("debug")}});case"chatHistory":return(0,w.jsx)(z,{buttonPopupParent:t});case"mainHelpMenu":return(0,w.jsx)(j.LazyHelpButtonContent,{shouldRenderAsStaticModal:!1,fromForAnalytics:"ai_qna",onAcceptMessageSupport:()=>M.closeAssistantRightHandSideMenu()});case"debug":return(0,w.jsx)(k,{buttonPopupParent:t});default:throw(0,a.t1)(n)}}function z(e){const{buttonPopupParent:t}=e;return(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:D.B,transition:"height 200ms ease",minHeight:128},children:[(0,w.jsx)("div",{style:{marginTop:"auto"}}),(0,w.jsx)(A.p,{renderAsFullPage:!1,onRestoreChatSession:()=>t.close(),variant:"search"})]})}},67593:(e,t,n)=>{n.d(t,{H:()=>b});var s=n(67294),i=n(1302),a=n(480),o=n(86628),r=n(24405),l=n(83065),d=n(15336),c=n(72126),u=n(70203),p=n(993),g=n(98104),m=n(82530),h=n(73063),f=n(65187),y=n(43250),S=n(12534),x=n(28685),v=n(29026),w=n(44950),k=n(85893);function b(e){window.__c={n:"AssistantRichTextInput"};const{isQnA:t,store:n,placeholder:l,disabled:d,onSubmit:h,onFocus:b,onBackspaceOnEmptyInput:j,hideSubmitIcon:M,textInputOverrideStyles:I}=e,A=(0,a.O7)(),{isMobile:T}=(0,a.Fy)(),Z=(0,o.VK)((()=>""===(0,u.Jcv)(n.getValue()).trim()),[n]),[P,F]=s.useState(!1),R=(0,s.useCallback)((e=>{Z||!h||d||P||(h(n.getValue()),m.createAndCommit({userAction:"AssistantRichTextInput.valueChanged",environment:A,perform:e=>{p.sO({environment:A,store:n,value:void 0,transaction:e})}}))}),[d,A,h,n,Z,P]),_=(0,s.useCallback)((e=>{(0,S.ZP)({event:e,context:S.Af.ButtonMouseDown,callback:()=>{!async function(e){const{environment:t,textValueStore:n,setIsUndoing:s}=e;s(!0);const a=await(0,w.rewindActiveAssistantSession)({environment:t});a&&m.createAndCommit({userAction:"AssistantRichTextInput.undoLastHumanStep",environment:t,perform:e=>{p.sO({environment:t,store:n,value:a,transaction:e})}});await i.default.afterNextFlush((()=>{g.NX({store:n})})),s(!1)}({environment:A,textValueStore:n,setIsUndoing:F})}})}),[A,n]),B=(0,s.useCallback)((e=>{!h||Z||P||(h(n.getValue()),m.createAndCommit({userAction:"AssistantRichTextInput.valueChanged",environment:A,perform:e=>{p.sO({environment:A,store:n,value:void 0,transaction:e})}}))}),[h,Z,n,A,P]),V=(0,s.useRef)(),{onTextChange:K}=e,L=(0,s.useCallback)((e=>{e&&e instanceof KeyboardEvent&&"Backspace"===e.key&&!e.repeat&&0===(0,u.VrM)(V.current??[])&&(null==j||j()),V.current=n.getValue(),null==K||K(n.getValue())}),[V,n,j,K]),E=(0,r.yK)((e=>({wrap:{display:"flex",alignItems:"center",flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,backgroundColor:"dark"===e.mode?e.accentColors.translucentGray[100]:"transparent",borderRadius:T?22:16,padding:T?"6px 8px 6px 14px":"4px 8px 4px 14px",minHeight:T?36:void 0,marginLeft:16,marginRight:16,overflow:"hidden",fontSize:T?15:14,...I},placeholder:{opacity:d?.5:1,cursor:"text"}})),[d,T,I]);return(0,k.jsxs)("div",{style:E.wrap,tabIndex:0,...T?{}:{className:y.Wh_},onClick:e=>{if(e.target===e.currentTarget){const t=x.E.findEditableWithStore(n);t&&t.handleClick(e)}},children:[(0,k.jsx)(f.Z,{onEsc:()=>v.ZP.switchToSearchPane(),placeholder:l,disabled:!1,store:n,placeholderStyle:E.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,onEnter:d?c.ZT:B,disableMobileActionBar:!0,disableDateReminderMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMentions:t,onFocus:b,onChange:L}),!M&&(0,k.jsx)(C,{disabled:d??!1,isUndoing:P,storeIsEmpty:Z,handleClickEnter:R,handleClickStop:_})]})}function C(e){window.__c={n:"AssistantIconButton"};const{disabled:t,isUndoing:n,storeIsEmpty:s,handleClickStop:i,handleClickEnter:o}=e,c=(0,a.Fy)().isMobile,u=(0,r.yK)((e=>({icon:{height:c?24:20,width:c?24:20},stopIcon:{fill:e.icon.secondary},button:{pointerEvents:"auto",height:c?24:20,width:c?24:20}})),[c]);return n?(0,k.jsx)(h.Z,{icon:l._,onClick:()=>{},isBlue:!1,disabled:!0,iconStyle:u.icon,style:u.button,ariaLabel:"submit-ai-message"}):t?(0,k.jsx)(h.Z,{icon:d.q,onClick:i,style:u.button,iconStyle:{...u.icon,...u.stopIcon},ariaLabel:"stop-ai-message"}):(0,k.jsx)(h.Z,{icon:l._,onClick:o,isBlue:!s,disabled:s||t,iconStyle:u.icon,style:u.button,ariaLabel:"submit-ai-message"})}},16540:(e,t,n)=>{n.d(t,{N:()=>f});var s=n(67294),i=n(86628),a=n(24405),o=n(21202),r=n(82990),l=n(9291),d=n(91839),c=n(31278),u=n(76798),p=n(68373),g=n(46370),m=n(42899),h=n(85893);function f(e){window.__c={n:"AssistantSearchResultsThinkingMessage"};const{clientStep:t,parentStore:n,configurationState:i,citationHoverStore:a,renderAsFullPage:r,isQuickSearchMode:l}=e,{searchResults:d}=t,c=(0,s.useMemo)((()=>d.map((e=>p.G.createChildStore(n,{table:o.iU,id:e})))),[n,d]),u=(0,s.useRef)(null);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(g.J,{clientStep:t,configurationState:i,fakeSlackUser:void 0,forceShowFeedback:!1,ref:u,children:(0,h.jsx)(y,{searchResultStores:c})}),(0,h.jsx)(m.P,{containerRef:u,hoverStore:a,parentStore:n,isQuickSearchMode:l,renderAsFullPage:r})]})}function y(e){window.__c={n:"ThinkingMessageBody"};const{searchResultStores:t}=e,[n,o]=(0,s.useState)(0),p=(0,a.yK)((e=>({messageWrapper:{display:"flex",marginTop:6,marginBottom:6},currentElementStyle:{marginRight:6,display:"flex",height:21}})),[]);(0,s.useEffect)((()=>{const e=setInterval((()=>{o((e=>e+1))}),800);return()=>clearInterval(e)}),[]);const g=(0,i.VK)((()=>t.map(((e,t)=>(0,h.jsx)("div",{style:p.currentElementStyle,children:(0,h.jsx)(l.FormattedMessage,{id:"AssistantChatStep.searchingText",defaultMessage:"Reading {link}",values:{link:(0,h.jsx)("div",{style:r.Z.textOverflowStyle,children:(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,h.jsx)(c.Z,{disabled:!0,isEmptyPage:e.isEmptyPage(),icon:e.getIcon(),size:20,emojiSize:20,disableShrinking:!0,largeIcon:!0,style:{margin:"0px 4px"}}),(0,h.jsx)(u.Z,{store:e})]})})}})},t)))),[t,p.currentElementStyle]),m=n>=t.length?(0,h.jsx)("div",{style:{...p.currentElementStyle},children:(0,h.jsx)(l.FormattedMessage,{id:"AssistantChatStep.summarize",defaultMessage:"Summarizing"})}):g[n];return(0,h.jsxs)("div",{style:{display:"flex"},children:[(0,h.jsx)("div",{style:{minWidth:50},children:m}),(0,h.jsx)("div",{style:{display:"flex",alignItems:"center",marginLeft:2},children:(0,h.jsx)(d.Z,{isTriColored:!0})})]})}},5175:(e,t,n)=>{n.d(t,{Z:()=>r});n(67294);var s=n(86628),i=n(9291),a=n(71844),o=n(85893);function r(e){window.__c={n:"AssistantSkillName"};const{clientSkill:t}=e,n=(0,i.useIntl)(),r=(0,s.VK)((()=>{if("persisted"===t.type){const e=t.skillStore.getName();if(e)return e}return n.formatMessage(a.skillNameMap[t.skillType])}),[t,n]);return(0,o.jsx)(o.Fragment,{children:r})}},80594:(e,t,n)=>{n.d(t,{Z:()=>P});var s=n(67294),i=n(480),a=n(24405),o=n(31945),r=n(86628),l=n(9291),d=n(54642),c=n(47307),u=n(82530),p=n(19471),g=n(89728),m=n(53336),h=n(72495),f=n(34859),y=n(70771),S=n(71844),x=n(5175),v=n(47043),w=n(15201),k=n(68709),b=n(55217),C=n(3553),j=n(43250),M=n(12534),I=n(85893);const A=(0,l.defineMessages)({instructionSectionTitle:{id:"CustomSkillMenu.instructionSection.title",defaultMessage:"Instructions"}});function T(e){window.__c={n:"CustomSkillMenu"};const{clientSkill:t}=e,{skillStore:n}=t,o=(0,i.O7)(),d=(0,l.useIntl)(),c=(0,a.yK)((e=>({listWrap:{background:e.contentBackground,boxShadow:e.inputBoxShadow,padding:"3px 9px",margin:"0 8px",borderRadius:5,minHeight:64,..."dark"===e.mode?{backgroundColor:e.inputBackground}:{},fontSize:14},emptyPlaceholder:{caretColor:e.mediumTextColor,color:e.lightTextColor,fontSize:14,padding:"5px 0",display:"inline-block"},sectionTitle:{color:e.lightTextColor,fontSize:12}})),[]),p=(0,r.VK)((()=>!n.canEdit()),[n]),g=(0,r.VK)((()=>{if(n.isType("custom"))return n.getInstructionParentStore()}),[n]),m=(0,r.VK)((()=>{if(g)return g.getContentStore()}),[g]),f=(0,s.useCallback)((e=>{(0,M.ZP)({event:e,context:M.Af.EditorClick,callback:()=>{if(!m)return;(m.getValue()||[]).length>0||u.createAndCommit({userAction:"CustomSkillMenu.handleListClick",environment:o,perform:e=>{v.Nj({environment:o,parentStore:m,transaction:e})}})}})}),[o,m]);return(0,I.jsx)(I.Fragment,{children:m&&g&&(0,I.jsx)(h.Z,{title:d.formatMessage(A.instructionSectionTitle),children:(0,I.jsx)(C.Z,{store:g,isDefaultContainer:!0,droppable:!1,render:()=>(0,I.jsx)(k.p,{allowSelectionWithin:!0,children:(0,I.jsx)("div",{style:c.listWrap,onClick:f,className:j.Wh_,children:(0,I.jsx)(w.O,{displayName:"CustomSkillMenuContent",disabled:p,children:(0,I.jsx)(b.Z,{disabled:p,store:m,emptyPlaceholder:(0,I.jsx)("div",{style:c.emptyPlaceholder,children:(0,I.jsx)(l.FormattedMessage,{id:"automations.CustomSkillMenu.emptyPlaceholder",defaultMessage:"Click to edit instructions…"})}),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})})})})},g.id)})})}function Z(e){window.__c={n:"EditSkillMenu"};const{clientSkill:t,onClose:n,onDelete:o}=e,{skillStore:v}=t,w=(0,i.O7)(),k=(0,r.VK)((()=>v.getType()),[v]),b=(0,r.VK)((()=>v.isRenameable()),[v]),C=(0,r.VK)((()=>v.getName()),[v]),[j,M]=s.useState(C),A=s.useCallback((e=>{M(e),u.createAndCommit({userAction:"EditSkillMenu.handleNameChange",environment:w,perform:t=>{(0,y.Cc)({store:v,update:{name:e},transaction:t})}})}),[v,w]),Z=(0,s.useCallback)((async()=>{if(!(await c.confirmUserAction({message:(0,I.jsx)(l.FormattedMessage,{defaultMessage:"Are you sure you want to delete this skill?",id:"EditSkillMenu.delete.cancelConfirmation"}),acceptLabel:(0,I.jsx)(l.FormattedMessage,{defaultMessage:"Delete",id:"EditSkillMenu.delete.cancelConfirmation.delete"})})))return;const e=v.getSpaceId();e&&await d.setPageAssistantPreferences(w,{type:"skill",spaceId:e,skillId:v.id,operation:{type:"clear_channel"}}),u.createAndCommit({userAction:"EditSkillMenu.handleDelete",environment:w,perform:e=>{(0,y.Nt)({store:v,transaction:e})}}),null==o||o(),n()}),[w,v,n,o]),P=(0,a.yK)((e=>({scroller:{maxHeight:"50vh"},skillIcon:{width:16,fill:e.aiPurpleColor,marginRight:4},fromRowWrap:{display:"flex",alignItems:"center",margin:"4px 8px",gap:4,fontSize:14},rowWrap:{display:"flex",alignItems:"center",margin:"0 8px",gap:8,fontSize:14},headerNameWrap:{flexGrow:1},sectionTitle:{color:e.lightTextColor,fontSize:12}})),[]);return(0,I.jsxs)(m.Z,{type:f.Z.Y,style:P.scroller,children:[(0,I.jsx)(h.Z,{children:(0,I.jsxs)("div",{style:P.rowWrap,children:[S.skillIconMap[t.skillType](P.skillIcon),k&&b?(0,I.jsx)(p.bH,{value:j,onChange:A,placeholder:"custom"===k?"Custom skill name":"Skill name"}):(0,I.jsx)("div",{style:P.headerNameWrap,children:(0,I.jsx)(x.Z,{clientSkill:t})}),(0,I.jsx)(g.Z,{onClick:n,isBlue:!0,children:"Done"})]})}),"custom"===k&&(0,I.jsx)(T,{clientSkill:t}),(0,I.jsx)(h.Z,{children:(0,I.jsx)("div",{style:P.rowWrap,children:(0,I.jsx)(g.Z,{onClick:Z,isRed:!0,children:"Delete"})})})]})}function P(e){window.__c={n:"AssistantSkillPopup"};const{clientSkill:t,renderOrigin:n,buttonPopupStore:s,onDelete:r}=e,l=(0,i.O7)(),d=(0,a.yK)((e=>({headerWrap:{display:"flex",alignItems:"center",margin:"0 4px"},editPopupWrap:{borderRadius:12,boxShadow:e.largeLightBoxShadow,width:392}})),[]);return(0,I.jsx)(o.ZP,{popupType:l.device.isMobile?o.Z4.SlideUp:o.Z4.Popup,preventScaleTransition:!0,preventOpacityTransition:!0,popupWrapStyle:d.editPopupWrap,renderOrigin:n,render:e=>t&&(0,I.jsx)(Z,{clientSkill:t,onClose:e.close,onDelete:r}),buttonPopupStore:s})}},14309:(e,t,n)=>{n.d(t,{Z:()=>b,s:()=>C});n(67294);var s=n(480),i=n(86628),a=n(24405),o=n(18442),r=n(72126),l=n(9291),d=n(73063),c=n(32163),u=n(53336),p=n(72495),g=n(98165),m=n(34859),h=n(80444),f=n(21273),y=n(70771),S=n(71844),x=n(2405),v=n(5175),w=n(80594),k=n(85893);function b(e){window.__c={n:"AssistantSkillSwitcher"};const{renderAsFullPage:t}=e,n=(0,i.VK)((()=>(0,S.getFilteredClientSkills)({showCustomSkills:f.Z.showCustomSkills(),hasCurrentPage:!t})),[t]);return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(u.Z,{type:m.Z.Y,children:(0,k.jsx)(C,{clientSkills:n,renderAsFullPage:t,disableKeyboard:!1})})})}function C(e){window.__c={n:"SkillSwitcherMenuList"};const{clientSkills:t,renderAsFullPage:n,disableKeyboard:o}=e,d=(0,s.O7)(),u=(0,l.useIntl)(),m=(0,a.yK)((e=>({skillIcon:{width:16,fill:e.aiPurpleColor,marginRight:4},skillMenuItemWrap:{display:"flex",alignItems:"center",margin:n?"8px 0px":8},settingsButton:{marginLeft:8},sectionTitle:n?{paddingLeft:0}:{}})),[n]),f=(0,i.VK)((()=>{const{mainEditorCurrentBlockStore:e}=h.default.state;if(!e)return[];return(0,g.uJ)(e).map((e=>e.id))}),[]),y=(0,i.VK)((()=>{const e=t.filter((e=>e.inAppSkillTrigger&&"persisted"!==e.type)),n=t.filter((t=>!e.includes(t)&&"persisted"===t.type&&Boolean(t.inAppSkillTrigger)&&f.includes(t.skillStore.getParentId()))),s=t.filter((t=>Boolean(t.inAppSkillTrigger)&&!e.includes(t)&&!n.includes(t)));return{globalSkills:e,pageSkills:n,workspaceSkills:s}}),[f,t]),x=(n?S.globalChatSections:S.pageChatSections).map((e=>{const t=r.oA(e.skills.map((e=>y.globalSkills.find((t=>t.skillType===e)))));return{key:e.key,render:t=>(0,k.jsx)(p.Z,{topBorder:!1,disableMobileBorders:!0,title:u.formatMessage(e.title),desktopTitleStyle:m.sectionTitle,...t}),items:t.map((e=>j({environment:d,clientSkill:e,styles:m})))}})),v=y.pageSkills.map((e=>j({environment:d,clientSkill:e,styles:m}))),w=y.workspaceSkills.map((e=>j({environment:d,clientSkill:e,styles:m})));return(0,k.jsx)(c.Z,{type:c.i.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,disableKeyboard:o,sections:r.oA([...x,v.length>0&&{key:"page",render:e=>(0,k.jsx)(p.Z,{topBorder:!1,disableMobileBorders:!0,title:"From this page",desktopTitleStyle:m.sectionTitle,...e}),items:v},w.length>0&&{key:"workspace",render:e=>(0,k.jsx)(p.Z,{topBorder:!1,disableMobileBorders:!0,title:"Other skills",desktopTitleStyle:m.sectionTitle,...e}),items:w}])})}function j(e){const{environment:t,clientSkill:n,styles:s}=e;return{key:n.key,render:e=>"persisted"===n.type?(0,k.jsx)(w.Z,{clientSkill:n,renderOrigin:t=>(0,k.jsxs)("div",{style:s.skillMenuItemWrap,onMouseEnter:e.onMouseEnter,ref:e.ref,children:[(0,k.jsx)(x.Z,{iconStyle:s.skillIcon,title:(0,k.jsx)(v.Z,{clientSkill:n}),icon:S.skillIconMap[n.skillType],onClick:e.onClick,focused:e.focused}),"persisted"===n.type&&e.focused&&(0,k.jsx)(d.Z,{icon:o.H,ariaLabel:"edit",style:s.settingsButton,...t})]},e.key)}):(0,k.jsx)("div",{style:s.skillMenuItemWrap,onMouseEnter:e.onMouseEnter,ref:e.ref,children:(0,k.jsx)(x.Z,{iconStyle:s.skillIcon,title:(0,k.jsx)(v.Z,{clientSkill:n}),icon:S.skillIconMap[n.skillType],focused:e.focused,onClick:e.onClick})},e.key),action:async()=>{await(0,y.OZ)({environment:t,clientSkill:n})}}}},78158:(e,t,n)=>{n.d(t,{F:()=>x,O:()=>v});n(67294);var s=n(480),i=n(86628),a=n(24405),o=n(18442),r=n(72126),l=n(98963),d=n(73063),c=n(32163),u=n(31278),p=n(72495),g=n(68373),m=n(42915),h=n(52284),f=n(2405),y=n(18707),S=n(85893);function x(e){window.__c={n:"FullPageAutomationSection"};const{spaceStore:t,renderAsFullPage:n}=e,u=(0,i.VK)((()=>h.z.getAutomationIds().map((e=>g.Mz.createChildStore(t,{table:l.cv,id:e,spaceId:t.id})))),[t]),f=(0,s.O7)(),x=(0,a.yK)((e=>({icon:{width:16,marginRight:4},menuItemWrap:{display:"flex",alignItems:"center",margin:n?"8px 0px":8},settingsButton:{marginLeft:8},sectionTitle:n?{paddingLeft:0}:{}})),[n]),w=u.map((e=>function(e){const{environment:t,automationStore:n,styles:s}=e;return{key:n.id,render:e=>(0,S.jsx)(y.Z,{automationStore:n,renderOrigin:t=>(0,S.jsxs)("div",{style:s.menuItemWrap,onMouseEnter:e.onMouseEnter,ref:e.ref,children:[(0,S.jsx)(v,{automationStore:n,onClick:e.onClick,focused:e.focused}),(0,S.jsx)(d.Z,{icon:o.H,ariaLabel:"edit",style:s.settingsButton,...t})]},e.key)}),action:async()=>{await(0,m.Zq)({environment:t,automationStore:n})}}}({environment:f,automationStore:e,styles:x})));return(0,S.jsx)(c.Z,{type:c.i.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,disableKeyboard:!0,sections:r.oA([w.length>0&&{key:"workspace",render:e=>(0,S.jsx)(p.Z,{topBorder:!1,disableMobileBorders:!0,desktopTitleStyle:x.sectionTitle,...e}),items:w}])})}function v(e){window.__c={n:"InlineAssistantAutomationButton"};const{automationStore:t,focused:n,onClick:s}=e,a=(0,i.VK)((()=>{var e;return null===(e=t.getIconStore())||void 0===e?void 0:e.getValue()}),[t]),o=(0,i.VK)((()=>t.getName()),[t]);return(0,S.jsx)(f.Z,{title:o||"New workflow",icon:a?e=>(0,S.jsx)(u.Z,{disabled:!0,isEmptyPage:!1,size:18,icon:{icon:a,pointer:t.pointer},style:e}):void 0,onClick:s,focused:n})}},61719:(e,t,n)=>{n.d(t,{B:()=>P,u:()=>F});var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(80721),l=n(13148),d=n(56666),c=n(9291),u=n(29286),p=n(31945),g=n(73063),m=n(36488),h=n(56940),f=n(78140),y=n(72495),S=n(26388),x=n(33991),v=n(61817),w=n(43250),k=n(34700),b=n(87279),C=n(82063),j=n(98180),M=n(29026),I=n(28344),A=n(35245),T=n(40719),Z=n(85893);const P=375;function F(e){window.__c={n:"SearchAssistantPane"};const t=(0,i.Fy)();return(0,C.Z)(),(0,Z.jsx)(h.Z,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!t.isMobile,render:()=>(0,Z.jsx)(m.Z,{capture:!0,allowMenuList:!0,render:t=>(0,Z.jsx)(R,{...e,ignoreAreaEvents:t})})})}function R(e){window.__c={n:"SearchAssistantPaneInner"};const{ignoreAreaEvents:t,renderAsPage:n,quickSearchMode:m,searchContentPaneType:h,onClose:C}=e,{modalBodyMenuRef:P}=(0,s.useContext)(x.SearchStaticContext),F=(0,i.O7)(),R=(0,a.VK)((()=>null===j.Z||void 0===j.Z?void 0:j.Z.getActiveAssistantConfigurationState()),[]),_=(0,s.useCallback)((()=>{null!=R&&R.sessionId&&I.trackQnaBackToSearch(F,{sessionId:R.sessionId}),M.ZP.update((e=>({...e,mode:"search"})))}),[null==R?void 0:R.sessionId,F]),B=(0,s.useCallback)((()=>{C()}),[C]),V=(0,a.VK)((()=>(0,v.ip)({searchContentPaneType:h,renderAsPage:n,environment:F})),[n,h,F]),K=(0,o.yK)((e=>({header:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto",paddingTop:8,paddingLeft:12,paddingRight:16,paddingBottom:8},body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},scroller:{display:"flex",flexDirection:"column",maxHeight:V.maxHeight,minHeight:V.minHeight},clearButton:{...(0,k.X)({noDrag:Boolean(m)})},headerButton:{color:e.mediumIconColor,...(0,k.X)({noDrag:Boolean(m)})},closeButton:{borderRadius:"100%",marginLeft:6,...(0,k.X)({noDrag:Boolean(m)})},backButton:{marginRight:6,...(0,k.X)({noDrag:Boolean(m)})},seeMoreButton:{borderRadius:"100%",marginRight:6,color:e.v2.text.quaternary,...(0,k.X)({noDrag:Boolean(m)})}})),[V,m]),L=(0,i.Fy)(),E=(0,s.useMemo)((()=>{if(L.isMobile){return{menuType:b.og.Modal,width:n?"100vw":void 0,disableHeaderShadow:!0,disableBottomPadding:!0,bodyScrollerClassName:w.GZn,hideMobileTopbar:!0,renderAsPage:!0,scrollerStyle:{display:"flex",flexDirection:"column",paddingBottom:0},...t}}const e={menuType:b.og.Popup,maxHeight:V.maxHeight,minHeight:V.minHeight,...m?{width:"100vw"}:{},disableScroller:!0,scrollerStyle:K.scroller,...t};return n&&L.isDesktop&&(e.maxWidth="100%"),e}),[L,K,t,V,n,m]);return(0,Z.jsxs)(f.Z,{...E,className:w.Oau,ref:P,children:[(0,Z.jsx)(y.Z,{children:(0,Z.jsxs)("div",{style:K.header,children:[(0,Z.jsx)(g.Z,{icon:r.W,onClick:_,ariaLabel:"back",style:K.backButton}),(0,Z.jsx)(u.Z,{quickSearchMode:m}),(0,Z.jsx)("div",{style:{flexGrow:1}}),(0,Z.jsx)(p.ZP,{onClick:()=>{(0,I.trackAiChatTranscriptHistoryOpenHistoryButtonSelected)(F,{from:"search"})},popupType:F.device.isMobile?p.Z4.SlideUp:p.Z4.Popup,renderOrigin:e=>(0,Z.jsx)(S.ZP,{renderTooltip:()=>(0,Z.jsx)(c.FormattedMessage,{id:"SearchAssistantPane.viewHistoryButton",defaultMessage:"Chat history and help"}),render:t=>(0,Z.jsx)(g.Z,{style:K.seeMoreButton,hovered:!1,icon:d.o,ariaLabel:"see more",...t,...e})}),render:e=>(0,Z.jsx)(T.u,{buttonPopupParent:e})}),(0,Z.jsx)(g.Z,{style:K.closeButton,hovered:!0,icon:l.U,onClick:B,ariaLabel:"close"})]})}),(0,Z.jsx)(A.R3,{renderAsFullPage:n,isQuickSearchMode:m,onBackspaceOnEmptyInput:_})]})}},42899:(e,t,n)=>{n.d(t,{P:()=>F,d:()=>A});var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(15145),l=n(37167),d=n(40745),c=n(17693),u=n(21202),p=n(97880),g=n(82990),m=n(9291),h=n(84076),f=n(91839),y=n(53437),S=n(31278),x=n(76798),v=n(98567),w=n(84210),k=n(98180),b=n(68373),C=n(28344),j=n(33932),M=n(46370),I=n(85893);function A(e){window.__c={n:"CitedPagesList"};const{citations:t,hoverStore:n,toggledStore:r,isLoading:l}=e,d=(0,i.O7)(),c=(0,i.Fy)(),u=e.canExpand&&t.length>4,h=e.canExpand?e.expandedStore:void 0,f=(0,a.VK)((()=>r.state),[r]),y=(0,s.useCallback)((e=>{const t=k.Z.getActiveAssistantConfigurationState();t&&C.trackQnaCitationsToggle(d,{sessionId:t.sessionId,shown:e}),r.setState(e),!e&&(0,p.$K)(h)&&h.setState(!1)}),[d,h,r]),S=(0,a.VK)((()=>!(0,p.$K)(h)||h.state),[h]),x=(0,s.useCallback)((e=>{(0,p.$K)(h)&&h.setState(e)}),[h]);(0,a.VK)((()=>{t.forEach((e=>e.store.getTitleValue()))}),[t]);const v=S?t:t.slice(0,4),w=(0,o.yK)((e=>({wrap:{position:"relative",marginLeft:6,marginBottom:6,display:"flex",fontSize:c.isMobile?g.Z.fontSize.UISmall.mobile:g.Z.fontSize.UISmall.desktop},listWrap:{display:"flex",flexDirection:"column",flexGrow:1,gap:2,maxWidth:M.O,marginLeft:-6,paddingLeft:6,...u&&!S?{WebkitMaskImage:"linear-gradient(180deg, black, rgba(0,0,0,0.99) 80%, transparent)"}:{}}})),[u,c,S]);return 0===v.length?null:(0,I.jsxs)("div",{style:w.wrap,children:[(0,I.jsxs)("div",{style:w.listWrap,children:[(0,I.jsx)(T,{enabled:!l,isLoading:Boolean(l),onClick:()=>{y(!f)},open:f,children:(0,I.jsx)(m.FormattedMessage,{id:"assistantCitationHelpers.numPagesFound",defaultMessage:"{count, plural, one {{count} page found} other {{count} pages found}}",values:{count:t.length}})}),f&&v.map((e=>(0,I.jsx)(P,{citation:e,hoverStore:n},e.store.id)))]}),u&&!S&&f&&(0,I.jsx)(Z,{onClick:()=>{const e=k.Z.getActiveAssistantConfigurationState();e&&C.trackQnaCitationsSeeMoreClick(d,{sessionId:e.sessionId}),x(!0)}})]})}function T(e){window.__c={n:"PageListHeader"};const{enabled:t,onClick:n,children:a,open:r,isLoading:l}=e,{isMobile:d}=(0,i.Fy)(),[u,p]=(0,s.useState)(!1),g=(0,o.yK)((e=>({wrap:{color:e.lightTextColor,fontWeight:500,fontSize:12,padding:"4px 0 2px",display:"flex",alignItems:"center"},content:{padding:"1px 2px",margin:"-1px -2px",cursor:t?"pointer":"default"},icon:{width:11,height:11,marginLeft:4,fill:e.lightIconColor,transform:`rotateZ(${r?0:-90}deg)`,opacity:d||u?1:0,transition:"opacity 0.2s ease, transform 200ms ease-out"},loadingDots:{marginLeft:8}})),[t,r,u,d]);return(0,I.jsxs)("div",{style:g.wrap,children:[(0,I.jsx)("div",{style:g.content,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),onClick:()=>{t&&n()},children:a}),t&&(0,c.A)(g.icon),l&&(0,I.jsx)(f.Z,{isTriColored:!0,styleParentContainer:g.loadingDots})]})}function Z(e){window.__c={n:"ExpandOverlay"};const{onClick:t}=e,n=(0,i.Fy)(),[r,l]=(0,s.useState)(!1),c=(0,a.VK)((()=>r||n.isMobile),[n,r]),u=(0,o.yK)((e=>({wrap:{position:"absolute",left:0,right:0,bottom:0,cursor:"pointer",height:24,display:"flex",justifyContent:"center",alignItems:"flex-end",fontSize:n.isMobile?g.Z.fontSize.UISmall.mobile:g.Z.fontSize.UISmall.desktop,opacity:c?1:0,transition:"opacity 0.2s ease"},label:{display:"flex",gap:2,alignItems:"center",color:e.mediumTextColor,fontWeight:500,fontSize:11,borderRadius:6,padding:"2px 6px",boxShadow:"0px 0px 1px 0px rgba(0, 0, 0, 0.04), 0px 0px 2px 0px rgba(0, 0, 0, 0.06), 0px 4px 8px 0px rgba(0, 0, 0, 0.04)",background:e.whiteButtonBackground},icon:{width:12,height:12,fill:e.mediumIconColor}})),[n,c]);return(0,I.jsx)("div",{style:u.wrap,onClick:t,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:(0,I.jsxs)("div",{style:u.label,children:[(0,I.jsx)("div",{children:(0,I.jsx)(m.FormattedMessage,{id:"assistantCitationHelpers.seeMore",defaultMessage:"See more"})}),(0,d.M)(u.icon)]})})}function P(e){window.__c={n:"CitedPageRow"};const{citation:{number:t,store:n},hoverStore:d}=e,c=(0,i.O7)(),u=(0,a.VK)((()=>{var e;return(null===(e=d.state)||void 0===e?void 0:e.pageId)===n.id}),[d,n]),g=(0,s.useRef)(null),m=(0,o.yK)((e=>({wrap:{display:"flex",position:"relative"},linkBox:{display:"flex",alignItems:"center",gap:4,padding:"0 4px",borderRadius:6,fontWeight:500,fontSize:13,transition:"background 0.2s ease",maxWidth:"95%",marginLeft:-4},linkBoxHoveredStyle:{background:e.accentColors.uiBlue[100]},iconWrap:{position:"relative",marginRight:4,width:14,height:14,flexShrink:0},icon:{position:"absolute",left:0,top:0,transition:"opacity 0.2s ease",opacity:(0,p.$K)(t)&&u?0:1},number:{position:"absolute",left:0,top:0,opacity:u?1:0,transition:"opacity 0.2s ease",zIndex:10},titleWrap:{display:"flex",alignItems:"center",padding:2,minWidth:50}})),[u,t]),f=(0,s.useCallback)((e=>{if(e){if(!g.current)return;d.setState({type:"list",pageId:n.id,node:g.current})}else d.setState(void 0)}),[d,n]),y=(0,a.VK)((()=>n.getIcon()),[n]),v=(0,a.VK)((()=>n.isEmptyPage()),[n]),b=(0,a.VK)((()=>c.RouterStore.state.route),[c]),{metaHref:M,href:A}=(0,a.VK)((()=>{const e=(0,w.ZP)({store:n,fullyQualified:!1,pageVisitSource:r.tY.AIQna});return"page"===b.name||"nativeTab"===b.name&&"assistant"===b.tab||"quickSearch"===b.name?{metaHref:e,href:e}:"chat"===b.name?{metaHref:e,href:(0,l.t)({blockId:n.id,pageVisitSource:r.tY.AIQna})}:{metaHref:void 0,href:void 0}}),[b,n]);return(0,I.jsx)("div",{style:m.wrap,ref:g,children:(0,I.jsx)(h.Z,{href:M,metaHref:A,style:m.linkBox,hovered:u,hoveredStyle:m.linkBoxHoveredStyle,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),onClick:()=>{c.device.isMobileBrowser&&j.closeAssistantRightHandSideMenu(),C.trackQnaResultClicked(c,{clickedPageId:n.id,configurationState:k.Z.getActiveAssistantConfigurationState(),source:"citation_list"})},children:(0,I.jsxs)("div",{style:m.titleWrap,children:[(0,I.jsxs)("div",{style:m.iconWrap,children:[(0,p.$K)(t)&&(0,I.jsx)(_,{number:t,hovered:u,style:m.number}),(0,I.jsx)(S.Z,{disabled:!0,icon:y,isEmptyPage:v,size:14,style:m.icon,useInvertedColors:!1})]}),(0,I.jsx)(x.Z,{store:n})]})})})}function F(e){window.__c={n:"CitationPreviewPopup"};const{containerRef:t,hoverStore:n,parentStore:s,isQuickSearchMode:o}=e,r=(0,i.Fy)(),l=(0,a.VK)((()=>{if(!n.state||!t.current||r.isMobile||o)return;const e=t.current.getBoundingClientRect(),i=e.left>=v.Tq+24;let a;const l=n.state.node.getBoundingClientRect();if(i)a=new DOMRect(e.x,l.y,e.width,l.height);else{if("token"!==n.state.type)return;a=l}return{store:b.G.createChildStore(s,{id:n.state.pageId,table:u.iU}),originRect:a,isFullTooltip:i}}),[t,s,r,o,n]);if((0,p.$K)(l)){const{originRect:e,isFullTooltip:t,store:n}=l;return(0,I.jsx)(y.ZP,{disableMouseCapture:!0,preventCaptureEsc:!0,preventScaleTransition:!0,preventOpacityTransition:!0,popupType:y.ZP.PopupType.Popup,originGap:t?24:8,alignmentToOrigin:y.ZP.Alignment.Start,open:!0,placementToOrigin:t?y.ZP.Placement.Left:y.ZP.Placement.Bottom,originRect:e,useLightBoxShadow:!t,render:()=>t?(0,I.jsx)(v.E5,{store:n}):(0,I.jsx)(R,{store:n})})}return null}function R(e){window.__c={n:"MinimalCitationTooltip"};const{store:t}=e,n=(0,o.yK)((e=>({wrap:{fontSize:g.Z.fontSize.UISmall.desktop,color:e.mediumTextColor,fontWeight:g.Z.fontWeight.regular,fill:e.mediumIconColor,padding:"4px 6px 4px 6px",display:"flex",alignItems:"center",gap:2}})),[]),s=(0,a.VK)((()=>t.getIcon()),[t]),i=(0,a.VK)((()=>t.isEmptyPage()),[t]);return(0,I.jsxs)("div",{style:n.wrap,children:[(0,I.jsx)(S.Z,{disabled:!0,icon:s,isEmptyPage:i,size:14,useInvertedColors:!1}),(0,I.jsx)(x.Z,{store:t})]})}function _(e){window.__c={n:"CitationNumber"};const{number:t,hovered:n,style:s}=e,i=(0,o.yK)((e=>({wrap:{verticalAlign:"middle",cursor:"pointer",transition:"all 100ms ease-in",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:90,padding:"0 4px",fontSize:10,minWidth:14,height:14,fontWeight:g.Z.fontWeight.semibold,color:"dark"===e.mode?"#2f2f2f":"white",backgroundColor:n?"#2383e2":"dark"===e.mode?"#787774":"#acaba9",...s}})),[n,s]),a=(0,m.useIntl)();return(0,I.jsx)("div",{style:i.wrap,children:t.toLocaleString(a.locale)})}},2108:(e,t,n)=>{n.d(t,{AP:()=>y,Dw:()=>x,E5:()=>S});var s=n(67294),i=n(480),a=n(86628),o=n(92595),r=n(4615),l=n(97880),d=n(63594),c=(n(95477),n(19124)),u=n(80444),p=n(21273),g=n(98180),m=n(55320),h=n(71844),f=n(35245);function y(e){const{renderAsFullPage:t,isQuickSearchMode:n}=e,r=(0,a.VK)((()=>g.Z.getActiveAssistantRuntimeState()),[]),u=(0,a.VK)((()=>g.Z.getActiveAssistantConfigurationState()),[]),h=null==r?void 0:r.selectedSkill,y=(0,a.VK)((()=>p.Z.isAssistantExperienceQna()),[]),v=S({renderAsFullPage:t}),w=x(),k=(0,a.VK)((()=>p.Z.isXMLAssistantEnabled(h)),[h]),b=(0,a.VK)((()=>p.Z.isJSAssistantEnabled()),[]),C=(0,a.VK)((()=>{var e;return Boolean(null===(e=g.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.clientSteps.find((e=>"human"===e.type)))}),[]),j=(0,f.f6)({assistantRuntimeState:r,assistantConfigurationState:u}),M=(0,a.VK)((()=>(0,c.Gw)()),[]),I=!r||r&&!r.selectedSkill&&!r.automation&&0===r.clientSteps.length,A=(0,a.VK)((()=>I&&!t&&w.length>0&&p.Z.isSuggestedQuestionsExperimentOn()),[I,t,w]),T=Boolean((null==u?void 0:u.sampling)||(null==u?void 0:u.evaluating)),Z=(0,a.VK)((()=>{var e;const t=null===(e=g.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.previewingStepObservations.filter((e=>"observation"===e.type&&"error"===e.observationType));return null==t?void 0:t.map((e=>e.value)).join("\n")}),[]),P=(0,a.VK)((()=>d.Z.state),[]),F=(0,a.VK)((()=>m.default.state.open),[]),R=(0,i.O7)().device.isMobile;return(0,s.useEffect)((()=>{(0,o.exposeDebugValue)("shouldShowSuggestedQuestionsFlags",{isEmptyAssistantState:I,isSuggestedQuestionsEnabled:A,suggestedQuestions:w,renderAsFullPage:t})}),[I,A,w,t]),{shouldRenderFinetunedAssistantIntroMessage:k&&I,shouldShowFullPageSkillSection:k&&!b&&I&&v.length>0&&t,shouldShowInlineSkillSection:k&&!b&&I&&v.length>0&&!t,shouldShowSuggestedQuestionsPageSection:A&&!b,shouldShowQnaWelcomeHeader:!C&&y,shouldShowCitationsAtBottom:!Z||T,shouldShowFullPageAutomationSection:b&&I&&v.length>0&&t,shouldShowInlineAutomationSection:b&&I&&v.length>0&&!t,isAnswerLoading:j&&T,shouldShowCitationsLoadingDots:!(0,l.$K)(j)&&T,shouldShowNonQNAError:u&&Z&&!T&&!y,shouldShowAssistantFeedbackButtons:r&&u&&(r.temporaryClientSteps.length>0||Z)&&!u.sampling&&!u.evaluating,shouldShowHelpRedirectBar:!n&&!F&&y&&!R&&(!r||0===r.clientSteps.length&&0===r.temporaryClientSteps.length)&&(!u||!u.sampling&&!u.evaluating),isAiEligible:P,isLabelerMode:M,isQnA:y,hasLockAction:(null==u?void 0:u.evaluating)||(null==u?void 0:u.sampling)||(null==u?void 0:u.committing)||!P,shouldShowNewChatSuggestions:I}}function S(e){const{renderAsFullPage:t}=e;return(0,a.VK)((()=>(0,h.getFilteredClientSkills)({showCustomSkills:p.Z.showCustomSkills(),hasCurrentPage:!t})),[t])}function x(){return(0,a.VK)((()=>{var e,t;if(!p.Z.shouldShowSuggestedQuestions())return[];const n=null===(e=u.default.state.currentSpaceViewStore)||void 0===e?void 0:e.getModel();return void 0===(s=null==n?void 0:n.getSpaceId())||Math.floor(parseInt((0,r.XR)(s).slice(0,12),16)/96)%4!=0?[]:(null==n||null===(t=n.getAiSuggestions())||void 0===t||null===(t=t.qna_suggested_questions)||void 0===t||null===(t=t.questions)||void 0===t?void 0:t.map((e=>e.text)))??[];var s}),[])}},59107:(e,t,n)=>{n.d(t,{A:()=>h,M:()=>m});n(21703);var s=n(480),i=n(86628),a=n(34420),o=n(59054),r=n(45953),l=n(149),d=n(8542),c=n(54642),u=n(80444),p=n(68373),g=n(58449);function m(){const e=(0,s.O7)(),t=(0,i.VK)((()=>{var e;const t=null===(e=u.default.state.currentSpaceStore)||void 0===e?void 0:e.getSpaceId();if(!t)throw new Error("No space Id for user");return t}),[]),[n]=(0,o.r5)((async()=>{const n=await c.getChatTranscriptSessionHistoryForUser(e,{spaceId:t});if("success"!==n.type)throw new Error("Failed to fetch chat transcript history for space");const s=Date.now(),i=r.PF.create(n.data.recordMap);g.Z.setSessionInfos(t,n.data.chatSessionIds.map((e=>{var t;return{id:e,createdTime:(null===(t=i.getModel({id:e,table:d.t_}))||void 0===t?void 0:t.created_time)??s}})))}),[e,t]);return(0,i.VK)((()=>{const{currentSpaceViewStore:e}=u.default.state;if(!e)return[];const s=g.Z.getSessionsForSpace(t);return"pending"!==n.status||0!==s.length?s.map((n=>{let{id:s}=n;return p.uj.createChildStore(e,{id:s,table:d.t_,spaceId:t})})):void 0}),[n.status,t])}function h(e){const{store:t}=e,n=(0,i.VK)((()=>{var e;return null==t||null===(e=t.getChatStepStore())||void 0===e?void 0:e.dangerouslyGetUnmigratedStorageStep()}),[t]),[{value:s}]=(0,o.r5)((async()=>{if(!n||l.x.isFail(n))return{value:void 0};if(!n.value)return{value:void 0};return await(0,a.Fd)(n.value)}),[n]);return s?{status:"loaded",result:s}:{status:"loading"}}},90891:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var s=n(49085);class i extends s.default{getInitialState(){return{open:!1}}}const a=new i},87066:(e,t,n)=>{n.d(t,{Z:()=>o});var s=n(49085),i=n(92595);class a extends s.default{getInitialState(){return{previouslyVisitedSessionId:void 0}}setPreviouslyVisitedSession(e){this.setState({...this.state,previouslyVisitedSessionId:e})}}const o=new a;(0,i.exposeDebugValue)("AssistantChatHistoryPreviouslyVisitedSessionStore",o)},67973:(e,t,n)=>{n.d(t,{d:()=>i});var s=n(49085);class i extends s.default{getInitialState(){}}},98851:(e,t,n)=>{n.d(t,{Z:()=>R});var s=n(67294),i=n(83355),a=n(13991),o=n(480),r=n(86628),l=n(7057),d=n(11342),c=n(9291),u=n(80560),p=n(47839),g=n(36769),m=n(68626),h=n(21202),f=n(97880),y=n(28020),S=n(88536),x=n(77080),v=n(53730),w=n(54642);async function k(e){const{environment:t}=e,n=function(e){function t(e,n){if(!e)return;if(!n.currentUser.id)return;const s={pointer:e.pointer,userId:n.currentUser.id},i=n.defaultRecordCache.inMemoryRecordCache.getVersion(s),a=e.getRenderableContentIds().length>0,o={id:e.id,type:e.getType(),spaceId:e.getSpaceId(),version:i};return a?{...o,content:e.getRenderableContentStores().map((e=>t(e,n))).filter(f.$K)}:o}return t((0,y.np)(),e)}(t),s=await async function(e,t){if(!e)return;function n(e){const t={id:e.id,table:h.iU,spaceId:e.spaceId};if(e.content){return e.content.map((e=>n(e))).flat().concat([t])}return[t]}const s=n(e).map((e=>({pointer:e,version:-1}))),i={},a=await w.syncRecordValues(t,{requests:s},t.currentUser.id);if("success"===a.type){const e=a.data.recordMap.block;e&&Object.entries(e).forEach((e=>{let[t,n]=e;i[t]=n.value.value.version}))}return i}(n,t),i=await v.transactionQueue.getTotalNumberOfTasks(),a={clientRecord:n,serverRecord:s,webMessageStore:{...(0,S.ZN)(Date.now()),subscriptions:(0,S.gE)()},webExperiments:x.default.getExperimentsMap(),txnQueue:{numTasks:i}};return m.log({level:"info",from:"pageDebuggingActions",type:"debugPageInfo",data:{miscDataToConvertToString:{info:a}}}),a}(0,g.exposeDebugEnvironmentValue)("getDebugPageInfo",(e=>()=>k({environment:e})));var b=n(95477),C=n(57491),j=n(49085);class M extends j.default{getInitialState(){return{showUpdateInfo:!1}}}const I=M;var A=n(64921),T=n(28992),Z=n(26388),P=n(85893);class F extends i.Z{constructor(){super(...arguments),this.storeTypes={store:I},this.handleShowUpdateInfo=()=>{k({environment:this.environment}),this.stores.store.setState({showUpdateInfo:!0})}}renderComponent(){const{device:e}=this.environment,t=`Notion 2.36.${b.default.version}`,n=(0,P.jsx)(c.FormattedMessage,{id:"appVersionMenuItem.lastUpdatedTime.menuItem",defaultMessage:"Updated {lastUpdatedTime}",values:{lastUpdatedTime:(0,l.tv)(b.default.lastUpdatedTime,a.SP)}});let i=(0,P.jsxs)(s.Fragment,{children:[t,(0,P.jsx)("br",{}),n]});if(e.isMobileNative){const e=C.getMobileVersion(this.environment),a=(0,P.jsx)(c.FormattedMessage,{defaultMessage:"Mobile {reactNativeVersionFormatted}",values:{reactNativeVersionFormatted:(0,d.formatVersion)(e)},id:"appVersionMenuItem.lastUpdatedReactNativeVersion.menuItem"});i=(0,P.jsxs)(s.Fragment,{children:[t,(0,P.jsx)("br",{}),a,(0,P.jsx)("br",{}),n]})}if(e.isElectron){const e=p.getDesktopVersion(),a=(0,P.jsx)(c.FormattedMessage,{defaultMessage:"Desktop {desktopVersionFormatted}",values:{desktopVersionFormatted:(0,d.formatVersion)(e)},id:"appVersionMenuItem.desktopVersion.menuItem"});i=(0,P.jsxs)(s.Fragment,{children:[t,(0,P.jsx)("br",{}),a,(0,P.jsx)("br",{}),n]})}const o=b.default.isLocalhost||!1;if(e.isMobile){const e=this.stores.store.state.showUpdateInfo&&(0,P.jsxs)("div",{children:[(0,P.jsx)(V,{}),o?(0,P.jsx)(A.Z,{style:{paddingTop:4},onClick:()=>function(e){const{AppUpdateStore:t,mobileNative:n}=e;t.setState({appUpdate:void 0,electronUpdate:t.state.electronUpdate}),n&&n.resetAssetCache()}(this.environment),children:(0,P.jsx)(c.FormattedMessage,{defaultMessage:"Clear cache",id:"appVersionMenuItem.mobile.clearCache.message"})}):void 0]});return(0,P.jsx)(T.Z,{caption:(0,P.jsxs)("div",{style:{color:this.theme.lightTextColor},children:[(0,P.jsx)("div",{style:{userSelect:"none",WebkitUserSelect:"none"},children:i}),e]}),onClick:this.handleShowUpdateInfo})}return o?(0,P.jsx)(Z.ZP,{renderTooltip:()=>(0,P.jsx)(V,{}),placement:Z.ug.Left,render:e=>(0,P.jsx)(T.Z,{onClick:()=>B(t,this.environment),caption:(0,P.jsx)("div",{style:{color:this.theme.lightTextColor},children:i}),...e})}):(0,P.jsx)(T.Z,{onClick:()=>B(t,this.environment),caption:(0,P.jsx)("div",{style:{color:this.theme.lightTextColor},children:i})})}}F.displayName="AppVersionMenuItem";const R=(0,c.injectIntl)(F);function _(e){let{prefix:t,update:n}=e;window.__c={n:"UpdateStateComponent"};const s=(0,c.useIntl)();return"checking"===n.state?(0,P.jsxs)("div",{children:[t," ",(0,P.jsx)(c.FormattedMessage,{defaultMessage:"Checking for updates…",id:"appVersionMenuItem.updateStateForApp.checking.message"})]}):"no-update"===n.state?(0,P.jsxs)("div",{children:[t," ",(0,P.jsx)(c.FormattedMessage,{defaultMessage:"No update {timeFromNow}",id:"appVersionMenuItem.noUpdatesForApp.message",values:{timeFromNow:(0,l.tv)(n.timestamp,a.SP)}})]}):"downloading"===n.state?(0,P.jsxs)("div",{children:[t," ",(0,P.jsx)(c.FormattedMessage,{defaultMessage:"Downloading {version} {percentComplete}",id:"appVersionMenuItem.downloadingUpdate.message",values:{percentComplete:s.formatNumber(n.progress,{style:"percent",maximumFractionDigits:0}),version:(0,d.formatVersion)(n.version)}})]}):"ready"===n.state?(0,P.jsxs)("div",{children:[t," ",(0,P.jsx)(c.FormattedMessage,{defaultMessage:"Update ready {version}",id:"appVersionMenuItem.updateReady.message",values:{version:(0,d.formatVersion)(n.version)}})]}):"error"===n.state?(0,P.jsxs)("div",{children:[t," ",(0,P.jsx)(c.FormattedMessage,{defaultMessage:"Update error {errorMessage}",id:"appVersionMenuitem.updateError.message",values:{errorMessage:n.error&&n.error.message}})]}):null}function B(e,t){k({environment:t}),u.Pm(t,e)}function V(){window.__c={n:"UpdateInfoComponent"};const e=(0,o.O7)(),{AppUpdateStore:t}=e,n=(0,r.VK)((()=>t.state.appUpdate),[t]),s=(0,r.VK)((()=>t.state.electronUpdate),[t]),i=n?(0,P.jsx)(_,{prefix:"App.js - ",update:n}):(0,P.jsx)(c.FormattedMessage,{defaultMessage:"App.js - Waiting…",id:"appVersionMenuItem.waitingForAppJsUpdate.message"}),a=s&&(0,P.jsx)(_,{prefix:"Electron - ",update:s});return(0,P.jsxs)("div",{children:[i,a]})}},29286:(e,t,n)=>{n.d(t,{Z:()=>_});var s=n(67294),i=n(480),a=n(24405),o=n(11751),r=n(82990),l=n(9291),d=n(86628),c=n(28410),u=n(12174),p=n(36591),g=n(97880),m=(n(95477),n(34700)),h=n(87279),f=n(98742),y=n(21273),S=n(9870),x=n(7339),v=n(52275),w=n(78140),k=n(32163),b=n(72495),C=n(42782),j=n(85893);function M(e,t){window.__c={n:"AssistantModeExtensionMenuItem"};const{mode:n,fineTunedModelsForMode:s,onFocus:a,renderOrigin:o,onSelectModel:r,...l}=e,{isMobile:u}=(0,i.Fy)(),g=(0,d.VK)((()=>{var e;const t=S.Z.state;return null===(e=s.find((e=>{let{name:n}=e;return n===t})))||void 0===e?void 0:e.name}),[s]);return(0,j.jsx)(C.Z,{...l,ref:t,onFocus:a,renderOrigin:o,allowOptionalExtensionMenu:!0,renderExtension:(e,t)=>{let i;return i=u?{menuType:h.og.Modal,...e}:{menuType:h.og.Popup,width:300,...e},(0,j.jsx)(w.Z,{...i,children:(0,j.jsx)(k.Z,{type:k.i.Vertical,initialFocus:0,sections:[{key:"fine-tuned-models",render:e=>(0,j.jsx)(b.Z,{...e}),items:[...s,c.R8].map((e=>{let{name:s,description:i}=e;return{key:s,action:()=>{const e=(0,c.v8)(s)?s:void 0;r({extensionMenuItemParent:t,model:e,mode:n})},render:e=>(0,j.jsx)(v.Z,{...e,title:s,caption:i,right:s===g?(0,p.e)({width:12,height:"auto"}):void 0,shouldWrapCaption:!0})}}))}],onAccept:()=>{t.close()}})})}})}const I=s.forwardRef(M);var A=n(64921),T=n(31945),Z=n(26388);function P(e){window.__c={n:"AssistantFeatureGateBadge"};const{quickSearchMode:t}=e,{isMobile:n}=(0,i.Fy)(),o=(0,d.VK)((()=>y.Z.getMode()),[]),l=(0,c.SQ)(o),g=(0,d.VK)((()=>{var e;const t=S.Z.state;return null===(e=l.find((e=>{let{name:n}=e;return n===t})))||void 0===e?void 0:e.name}),[l]),C=s.useCallback((e=>{var t;const{buttonPopupParent:n,mode:s}=e,i=(0,c.SQ)(s),a=S.Z.state,o=null===(t=i.find((e=>{let{name:t}=e;return t===a})))||void 0===t?void 0:t.name;S.Z.setState(o),x.C.updateLocalOverrideConfig("assistant_variant",s),n.close()}),[]),M=s.useCallback((e=>{const{extensionMenuItemParent:t,model:n,mode:s}=e;S.Z.setState(n),x.C.updateLocalOverrideConfig("assistant_variant",s),t.close()}),[]),P=(0,a.yK)((e=>({buttonContainer:{marginLeft:8,...(0,m.X)({noDrag:Boolean(t)})},badge:{fontSize:n?14:11,fontWeight:500,padding:"1px 4px",backgroundColor:e.cardHoveredBackground,color:e.lightTextColor,borderRadius:4,...r.Z.textOverflowStyle}})),[n,t]),_=!0;return"control"===o?null:(0,j.jsx)(T.ZP,{popupType:n?T.Z4.SlideUp:T.Z4.Popup,disabled:_,placementToOrigin:T.pO.Bottom,alignmentToOrigin:T.vR.Start,renderOrigin:e=>(0,j.jsx)(Z.ZP,{disableTooltip:_,renderTooltip:()=>(0,j.jsx)("div",{children:g??c.R8.name}),placement:Z.ug.Bottom,alignment:Z.v2.Center,render:t=>(0,j.jsx)(A.Z,{...(0,f.Z)(e,t),disabled:_,ignoreLocalHoverState:!0,style:P.buttonContainer,children:(0,j.jsx)("div",{style:P.badge,children:(0,j.jsx)(F,{mode:o})})})}),render:e=>(0,j.jsx)(w.Z,{menuType:h.og.Popup,width:350,children:(0,j.jsx)(k.Z,{type:k.i.Vertical,initialFocus:0,sections:[{key:"assistant_modes",render:e=>(0,j.jsx)(b.Z,{...e,title:"Mode for Dev",shouldShowBottomDivider:!0}),items:u.KM.map((t=>function(e){const{mode:t,buttonPopupParent:n,currentMode:s,onSelectModel:i,onSelectMode:a}=e,o=(0,c.SQ)(t),r=(e,n)=>(0,j.jsx)(v.Z,{...e,ref:n,title:(0,j.jsx)(F,{mode:t}),right:t===s?(0,p.e)({width:12,height:"auto"}):void 0,caption:(0,j.jsx)(R,{mode:t}),shouldWrapCaption:!0});return{key:t,render:(e,n)=>o.length>0?(0,j.jsx)(I,{...e,fineTunedModelsForMode:o,onFocus:()=>{n.onFocus},renderOrigin:(e,t)=>r(e,t),mode:t,onSelectModel:i}):r(e),action:()=>{a({buttonPopupParent:n,mode:t})}}}({buttonPopupParent:e,mode:t,currentMode:o,onSelectMode:C,onSelectModel:M})))}]})})})}function F(e){const{mode:t}=e;return"beta"===t?(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.Beta.label",defaultMessage:"Q&A Beta"}):"alpha"===t?(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.Alpha.label",defaultMessage:"Q&A Alpha"}):"development"===t?(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.Development.label",defaultMessage:"Development"}):"exploratory"===t?(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.exploratory.label",defaultMessage:"Exploratory"}):"wild_west"===t?(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.WildWest.label",defaultMessage:"Wild West"}):(0,g.t1)(t)}function R(e){const{mode:t}=e;return"beta"===t?(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.Beta.caption",defaultMessage:"🚢 Current AI experience for our users."}):"alpha"===t?(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.Alpha.caption",defaultMessage:"🔬 Experience users opting in to in-progress features."}):"development"===t?(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.Development.caption",defaultMessage:"🌱 New features we're about to ship."}):"exploratory"===t?(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.Exploratory.caption",defaultMessage:"🧪 Features still baking but want feedback on."}):"wild_west"===t?(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.WildWest.caption",defaultMessage:"🤠 Yee haw! Use at your own risk!"}):(0,g.t1)(t)}function _(e){window.__c={n:"AssistantMenuHeader"};const{quickSearchMode:t}=e,{device:n}=(0,i.O7)(),{isMobile:s}=n,d=function(e){const{isMobile:t}=e;return(0,a.yK)((e=>({headerSparkles:{width:t?18:16,height:t?18:16,marginRight:6,color:e.regularIconColor},headerLabel:{fontSize:t?16:14,color:e.regularTextColor,fontWeight:r.Z.fontWeight.medium,...r.Z.textOverflowStyle}})),[t])}({isMobile:s});return(0,j.jsxs)(j.Fragment,{children:[(0,o.t)(d.headerSparkles),(0,j.jsx)("div",{style:d.headerLabel,children:(0,j.jsx)(l.FormattedMessage,{id:"assistantMenu.header.askNotionAI.label",defaultMessage:"Ask AI"})}),(0,j.jsx)(P,{quickSearchMode:t})]})}},41532:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D,defaultRecurrenceConfig:()=>z});var s=n(30120),i=n(67294),a=n(480),o=n(24405),r=n(40506),l=n(53877),d=n(42853),c=n(53523),u=n(24211),p=n(72126),g=n(81491),m=n(97880),h=n(63143),f=n(9291),y=n(28020),S=n(87279),x=n(25498),v=n(52275),w=n(31945),k=n(96525),b=n(88359),C=n(74194),j=n(3386),M=n(78140),I=n(28992),A=n(32163),T=n(89728),Z=n(72495),P=n(7931),F=n(64369),R=n(93289),_=n(84795),B=n(26388),V=n(85893);function K(e){window.__c={n:"TimeInput"};const t=(0,a.O7)(),{device:n}=t,r=(0,f.useIntl)(),[l,d]=(0,i.useState)(e.value),[c,u]=(0,i.useState)(void 0),p=t=>{const n=(0,_.parseTime)(t,r),i=s.ou.fromFormat(n??"","T");return i.isValid?(u(void 0),e.onUpdate({hour:i.hour,minute:i.minute})):(u("invalid"),e.onError&&e.onError()),i},g=e=>{const t=e.target.value;d(t),p(t)},m=()=>{const e=p(l);e.isValid&&d(e.toLocaleString(s.ou.TIME_SIMPLE))},h=(0,o.yK)((e=>({input:{textAlign:"right"},error:{boxShadow:e.outlineRedInputBoxShadow}})),[]);return(0,V.jsx)(B.ZP,{renderTooltip:()=>function(e){if("invalid"===e)return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Invalid time",id:"timeInput.invalid"})}(c),forceVisibleState:void 0!==c,placement:B.ug.Bottom,render:()=>(0,V.jsx)(C.Z,{type:"text",onChange:g,onSubmit:m,onBlur:m,value:l,size:1,style:{...e.style,...c?h.error:{},fontSize:n.isMobile?16:14},inputStyle:h.input})})}var L=n(62069),E=n(67149),W=n(7057),O=n(64921);function H(e){window.__c={n:"WeekdaySelector"};const{weekdays:t,onChange:n}=e,s=e.minimumSelection??0,i=(0,f.useIntl)(),a=(0,o.yK)((e=>({wrapper:{display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"center"},selectedDay:{...N,background:e.blueButtonBackground,color:e.regularInvertedTextColor},unselectedDay:{...N,background:e.accentColors.gray[50],color:e.mediumTextColor},selectedDayHover:{background:e.blueButtonHoveredBackground},unselectedDayHover:{background:e.accentColors.gray[100]},selectedDayPressed:{background:e.blueButtonPressedBackground},unselectedDayPressed:{background:e.accentColors.gray[200]}})),[]);return(0,V.jsx)(j.Z,{capture:!0,children:(0,V.jsx)("div",{style:{...a.wrapper,...e.style},children:E.Z.map(((o,r)=>(0,V.jsx)(O.Z,{...e,onClick:()=>{const e=t.includes(o)?t.length>s?t.filter((e=>e!==o)):t:[...t,o];n(e)},style:t.includes(o)?a.selectedDay:a.unselectedDay,hoveredStyle:t.includes(o)?a.selectedDayHover:a.unselectedDayHover,pressedStyle:t.includes(o)?a.selectedDayPressed:a.unselectedDayPressed,children:(0,W.er)(i,r+1)},o)))})})}const N={borderRadius:"50%",marginLeft:3,marginRight:3,height:25,width:25,fontSize:14,paddingTop:2};const D=(0,i.forwardRef)((function(e,t){const{recurrence:n,onChange:S,labelOnly:I}=e,_=(0,a.O7)(),{device:B}=_,E=(0,o.Fg)(),W=(0,f.useIntl)(),[O,N]=(0,i.useState)(void 0),[D,te]=(0,i.useState)(z()),[se,ie]=(0,i.useState)(!0),ae=Boolean(n);void 0===O&&(void 0!==n?(te({...n,hour:n.hour??0,minute:n.minute??0,start_date:(0,r.YL)(n.start_date)}),N(!0)):N(!1));const oe=e=>{const t="week"!==e||void 0!==D.weekdays&&0!==D.weekdays.length?D.weekdays:[(n=D.start_date,(0,m.Yd)(g.RRULE_WEEKDAYS_MAP)[s.ou.fromMillis(n).weekday-1])];var n;te({...D,weekdays:t,frequency:e}),N(!0)},re=()=>{S(D)},le=B.isMobile?w.Z4.SlideUp:w.Z4.Popup,de=function(){const{isMobile:e}=(0,a.Fy)();return(0,o.yK)((t=>({iconStyle:{fill:t.regularIconColor,width:e?18:16},customFrequencySelectButton:{color:t.mediumTextColor,fill:t.lightIconColor,fontWeight:500,fontSize:12},weekdayWrapper:{padding:10},inputLabel:{display:"flex",alignItems:"center",...e?{padding:"10px 14px",fontSize:16,background:t.cardBackground}:{paddingLeft:8}},intervalFrequencyLabel:{color:t.lightTextColor},intervalInputWrapper:{width:70,marginLeft:10,marginRight:10},intervalInput:{textAlign:"right"},timeInputWrapper:{width:90,marginLeft:10,marginRight:10},inputSection:{...U,alignItems:"center",justifyContent:"flex-start",padding:8},chevron:{width:e?14:10,fill:t.lightIconColor,marginLeft:4}})),[e])}(),ce=B.isMobile?"number":"text",ue=x.m.map((e=>({key:e.frequency,action:()=>{oe(e.frequency)},render:t=>(0,V.jsx)(v.Z,{...t,title:Q(e.frequency)})}))),pe=(0,V.jsx)(j.Z,{capture:!0,onLeft:p.yR,onRight:p.yR,onSelectAll:p.yR,onRedo:p.yR,onUndo:p.yR,onCut:p.yR,onCopy:p.yR,onPaste:p.yR,onKeypress:p.yR,onDelete:p.yR,onBackspace:p.yR,onTab:p.yR,children:(0,V.jsx)(C.Z,{value:D.interval.toString(),style:de.intervalInputWrapper,inputStyle:de.intervalInput,type:ce,maxlength:3,onChange:e=>{const t=parseInt(e.target.value);(0,h.hj)(t)&&t>0&&t<=g.MAX_RECURRENCE_INTERVAL&&te({...D,interval:t})},onBlur:e=>{e.target.value=D.interval.toString()}})});return(0,V.jsx)(k.Z,{...e,disabled:e.disabled,popupType:le,ref:t,stopClickPropagation:!0,renderOrigin:t=>I?(0,V.jsxs)(T.Z,{...t,children:[ee({isActive:ae,recurrence:n,intl:W}),(0,d.i)({width:10,marginLeft:4,fill:E.lightIconColor})]}):(0,V.jsx)(b.Z,{...t,icon:(0,c.N)(de.iconStyle),title:(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Repeat",id:"database.templatePickerItem.actionMenu.repeat"}),focused:e.focused,showExtensionArrow:B.isMobile,right:ee({isActive:ae,recurrence:n,intl:W})}),render:e=>(0,V.jsx)(j.Z,{capture:!0,onEnter:p.yR,children:(0,V.jsxs)(M.Z,{...Y(e,B.isMobile,se,re),children:[O?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)(Z.Z,{style:U,children:[(0,V.jsx)(P.Z,{innerButtonStyle:{...!B.isMobile&&de.customFrequencySelectButton},selectedTitle:G(D.frequency),renderMenuSections:t=>[{key:"repeatOptionsSection",render:e=>(0,V.jsx)(Z.Z,{...e}),items:[...J({parent:t,updateFrequencyFn:e=>{oe(e)}}),X({environment:_,parent:t,onChange:S,onClose:()=>{N(!1),e.close()}})]}]}),!B.isMobile&&(0,V.jsx)(T.Z,{isBlue:se,isLightGray:!se,onClick:t=>{re(),e.close()},disabled:!se,children:q})]}),(0,V.jsx)(Z.Z,{style:de.inputSection,shouldShowBottomDivider:!0,children:(0,V.jsx)(F.Z,{style:de.inputLabel,children:$(pe,D.frequency,de.intervalFrequencyLabel)})}),"week"===D.frequency&&(0,V.jsx)(Z.Z,{children:(0,V.jsx)(H,{style:de.weekdayWrapper,focused:!0,weekdays:D.weekdays||[],minimumSelection:1,onChange:e=>{te({...D,weekdays:e})}})}),(0,V.jsx)(Z.Z,{topBorder:!0,children:(0,V.jsx)(w.ZP,{popupType:le,renderOrigin:e=>(0,V.jsx)(b.Z,{...e,title:(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Starts",id:"database.templatePickerItem.repeatMenu.starts"}),focused:!1,showExtensionArrow:B.isMobile,right:s.ou.fromMillis(D.start_date).setLocale((0,u.E2)(W)).toLocaleString({weekday:"short",month:"short",day:"numeric",year:"numeric"})}),render:e=>(0,V.jsx)("div",{style:{padding:"18px 14px 14px"},children:(0,V.jsx)(R.Z,{firstDayOfWeek:y.AK.state,value:Math.max(D.start_date,Date.now()),onChange:t=>{te({...D,start_date:t}),e.close()},disabledDays:{before:new Date}})})})}),(0,V.jsx)(Z.Z,{style:de.inputSection,shouldShowBottomDivider:!0,children:(0,V.jsxs)(F.Z,{style:de.inputLabel,children:[(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Create at",id:"database.templatePickerItem.repeatMenu.createAt"}),(0,V.jsx)(j.Z,{capture:!0,onLeft:p.yR,onRight:p.yR,onSelectAll:p.yR,onRedo:p.yR,onUndo:p.yR,onCut:p.yR,onCopy:p.yR,onPaste:p.yR,onKeypress:p.yR,onDelete:p.yR,onBackspace:p.yR,onTab:p.yR,children:(0,V.jsx)(K,{value:s.ou.local().set({hour:D.hour,minute:D.minute}).toLocaleString(s.ou.TIME_SIMPLE),style:de.timeInputWrapper,onUpdate:e=>{te({...D,...e}),ie(!0)},onError:()=>{ie(!1)}})}),(0,V.jsx)(L.Z,{renderOrigin:e=>(0,V.jsxs)(T.Z,{...e,children:[(0,l.er)(D.timezone),(0,d.i)(de.chevron)]}),onSelect:e=>{te({...D,timezone:e})}})]})})]}):(0,V.jsx)(A.Z,{type:A.i.Vertical,sections:[{key:"repeatOptionsSection",render:e=>(0,V.jsx)(Z.Z,{...e}),items:[...ue,X({environment:_,parent:e,onChange:S})]}],initialFocus:void 0}),O&&ne(W,D,E)]})})})})),U={display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px"};function z(){return{start_date:s.ou.local().set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,l.Sv)(),hour:0,minute:0,frequency:"day",interval:1}}const q=(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Save",id:"database.templatePickerItem.customRecurrence.save"});function Q(e){switch(e){case"day":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Every day",id:"database.templatePickerItem.quickOptionMenuItem.day"});case"week":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Every week",id:"database.templatePickerItem.quickOptionMenuItem.week"});case"month":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Every month",id:"database.templatePickerItem.quickOptionMenuItem.month"});case"year":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Every year",id:"database.templatePickerItem.quickOptionMenuItem.year"});default:(0,m.t1)(e)}}function G(e){switch(e){case"day":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,m.t1)(e)}}function $(e,t,n){switch(t){case"day":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Every {interval} <label>days</label>",id:"database.templatePickerItem.recurrenceInterval.everyXdays",values:{label:e=>(0,V.jsx)("label",{style:n,children:e}),interval:e}});case"week":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Every {interval} <label>weeks</label>",id:"database.templatePickerItem.recurrenceInterval.everyXweeks",values:{label:e=>(0,V.jsx)("label",{style:n,children:e}),interval:e}});case"month":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Every {interval} <label>months</label>",id:"database.templatePickerItem.recurrenceInterval.everyXmonths",values:{label:e=>(0,V.jsx)("label",{style:n,children:e}),interval:e}});case"year":return(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Every {interval} <label>years</label>",id:"database.templatePickerItem.recurrenceInterval.everyXyears",values:{label:e=>(0,V.jsx)("label",{style:n,children:e}),interval:e}});default:(0,m.t1)(t)}}function Y(e,t,n,s){return t?{menuType:S.og.Modal,title:(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Repeat",id:"database.templatePickerItem.mobileRepeatModal.title"}),left:(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Cancel",id:"database.templatePickerItem.customRecurrence.cancel"}),right:q,rightDisabled:!n,onClickRight:()=>{n&&(s(),e.close())},onClickLeft:()=>{e.close()}}:{menuType:S.og.Popup}}function J(e){let{parent:t,updateFrequencyFn:n}=e;return x.m.map((e=>({key:e.frequency,action:()=>{n(e.frequency),t.close()},render:t=>(0,V.jsx)(v.Z,{...t,title:G(e.frequency)})})))}function X(e){let{environment:t,parent:n,onChange:s,onClose:i}=e;return{key:"disable",action:()=>{s(void 0),n.close(),i&&i()},render:e=>(0,V.jsx)(v.Z,{...e,title:(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Off",id:"database.templatePickerItem.quickOptionMenuItem.off"})})}}function ee(e){let{isActive:t,recurrence:n,intl:s}=e;return t?n?(0,V.jsx)(V.Fragment,{children:te(n,s)}):void 0:(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Off",id:"database.templatePickerItem.recurrenceConfigMenuLabel.off"})}function te(e,t){return(0,g.rruleFromRecurrence)({...e,weekdays:void 0,hour:0,minute:0}).toText((e=>{switch(e){case"every":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every"});case"day":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day"});case"days":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days"});case"week":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week"});case"weeks":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks"});case"month":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month"});case"months":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months"});case"year":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year"});case"years":return t.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years"});default:return e.toString()}}))}function ne(e,t,n){const i=(0,g.rruleFromRecurrence)({...t,start_date:(0,r.Io)(new Date(t.start_date))}).after(new Date((0,r.Io)()));if(!i)return null;const a=s.ou.fromJSDate(i).toUTC().setLocale((0,u.E2)(e)).toLocaleString(s.ou.DATETIME_SHORT);return(0,V.jsx)(Z.Z,{topBorder:!0,children:(0,V.jsx)(I.Z,{caption:(0,V.jsx)("span",{style:{color:n.lightTextColor},children:(0,V.jsx)(f.FormattedMessage,{defaultMessage:"Next: {dates}",id:"database.templatePickerItem.recurrenceConfigMenuLabel.next",values:{dates:a}})})})})}},37712:(e,t,n)=>{n.d(t,{A:()=>o});n(67294);var s=n(86628),i=n(24405),a=n(85893);function o(e){let{scrollerStore:t}=e;window.__c={n:"SidebarScrollToTopBorder"};const n=(0,s.VK)((()=>0===t.state.scrollTop),[t]),o=(0,i.yK)((e=>({border:{width:"100%",boxShadow:n?"0 0 0 transparent":`0 1px 0 ${e.regularDividerColor}`,transition:"box-shadow 300ms",height:2,marginTop:-2,zIndex:99}})),[n]);return(0,a.jsx)("div",{style:o.border})}},57254:(e,t,n)=>{n.d(t,{S:()=>i});n(21703),n(94568);var s=n(97880);n(80444),n(98165);function i(e){return"assistantChat"===e.type?1===e.operations.length&&"createBlock"===e.operations[0].command&&"text"===e.operations[0].blockNode.tagName&&0===e.operations[0].blockNode.text.length:"assistantChatText"===e.type?0===e.text.length:void(0,s.t1)(e)}},99622:(e,t,n)=>{n.d(t,{Y:()=>a});var s=n(86628),i=n(88893);function a(e){return(0,s.VK)((()=>i.Q6(e.state)),[e])}},12205:(e,t,n)=>{n.d(t,{J:()=>a});var s=n(86628),i=n(80444);function a(){const{currentSpaceStore:e}=(0,s.Kw)(i.default);return(0,s.VK)((()=>(null==e?void 0:e.canAdmin())??!1),[e])}},34232:(e,t,n)=>{n.d(t,{Z:()=>i});var s=n(67294);function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[a,o]=(0,s.useState)(i),r=(0,s.useRef)(null),l=(0,s.useRef)(null);return(0,s.useLayoutEffect)((()=>{null!==l.current&&window.clearTimeout(l.current),null!==r.current&&window.clearTimeout(r.current),l.current=null,r.current=null,e?0===t?o(!0):r.current=window.setTimeout((()=>{r.current=null,o(!0)}),t):0===n?o(!1):l.current=window.setTimeout((()=>{l.current=null,o(!1)}),n)}),[e,t,n]),a}},41747:(e,t,n)=>{n.d(t,{G:()=>a,Z:()=>l});var s=n(49085),i=n(92595);const a={by_topic:{label:"by Topic",topicType:"pageTopics"},by_keyword:{label:"by Keyword",topicType:"pageKeywords"}};class o extends s.default{getInitialState(){return{subTab:"by_topic",loadingState:{type:"loaded",pageId:void 0},topics:[]}}getSubTab(){return this.state.subTab}setSubTab(e){this.update((t=>({...t,subTab:e})))}getTopicByClientId(e){return this.state.topics.find((t=>t.clientId===e))}setTopicIsExpanded(e,t){this.update((n=>({...n,topics:n.topics.map((n=>({...n,isExpanded:n.clientId===e?t:n.isExpanded})))})))}setTopicDetailLoading(e,t){this.update((n=>({...n,topics:n.topics.map((n=>n.clientId===e?{...n,detailLoadingState:t}:n))})))}setTopicDetailLoaded(e,t){this.update((n=>({...n,topics:n.topics.map((n=>n.clientId===e?{...n,detailLoadingState:"loaded",...t}:n))})))}}const r=new o,l=r;(0,i.exposeDebugValue)("AiContextStore",r)}}]);