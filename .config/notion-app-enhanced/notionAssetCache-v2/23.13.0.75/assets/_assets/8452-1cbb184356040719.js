"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8452],{92660:(e,t,s)=>{s.d(t,{Z:()=>l});s(67294);var r=s(480),n=s(86628),i=s(50506),o=s(53437),a=s(85893);function l(e){window.__c={n:"DefaultPopupOrModal"};const t=(0,r.O7)(),{modalStore:s,render:l}=e,{device:d}=t,c=(0,n.VK)((()=>s.state.open),[s]);return d.isMobile?(0,a.jsx)(o.ZP,{ariaLabel:e.ariaLabel,open:c,popupType:o.ZP.PopupType.SlideUp,origin:e.origin,onDismiss:e.onDismiss,render:l,style:e.style}):(0,a.jsx)(i.Z,{ariaLabel:e.ariaLabel,open:c,preventHideChildrenWhileOpening:!0,render:l,onDismiss:e.onDismiss,style:e.style,innerStyle:e.innerStyle})}},30676:(e,t,s)=>{s.d(t,{F:()=>a});s(67294);var r=s(86628),n=s(74016),i=s(52275),o=s(85893);function a(e){window.__c={n:"TeamMenuItem"};const{teamStore:t}=e,{name:s}=(0,r.VK)((()=>({name:t.getName()})),[t]);return(0,o.jsx)(i.Z,{...e,icon:(0,o.jsx)(n.p,{size:14,store:t,disabled:!0}),title:s})}},22715:(e,t,s)=>{s.d(t,{Z:()=>o});s(67294);var r=s(480),n=s(24405),i=(s(58047),s(85893));function o(){window.__c={n:"WebComponentNotSupportedInMobileNativeWarning"};(0,r.O7)(),(0,n.yK)((e=>({container:{margin:"8px 16px",background:e.accentColors.yellow[100],borderRadius:8,height:"fit-content"}})),[]);return(0,i.jsx)(i.Fragment,{})}},93481:(e,t,s)=>{s.d(t,{Z:()=>C});s(67294);var r=s(83355),n=s(69651),i=s(97880),o=s(9291),a=s(45257),l=s(97638),d=s(41558),c=s(42922),u=s(52275),h=s(3386),p=s(89728),m=s(53437),g=s(72495),f=s(83264),v=s(255),x=s(75689),S=s(91642),y=s(8319),b=s(85893);class M extends r.Z{constructor(){super(...arguments),this.storeTypes={store:d.Z},this.renderActiveButtonOrigin=()=>{const{value:e,dateFormat:t,disabled:s,focused:r,intl:i}=this.props,o=P(this.environment),a=w(this.theme),d={...o.menuItem,...a.activeMenuItem},c=l._Q(e,i,t),h=(0,b.jsx)(v.Z,{onClick:()=>j(this.props.onChange),disabled:s});return(0,b.jsx)(u.Z,{focused:r,disabled:s,icon:(0,n.C)(o.iconActiveDesktop),title:c,right:h,isTokenTitle:!0,alignIconTop:!0,onClick:this.handleOriginActivate,desktopTitleStyle:o.menuItemTitleDesktop,desktopIconStyle:o.iconActiveDesktopWrapper,style:d})},this.renderInactiveButtonOrigin=()=>{const{title:e,icon:t,disabled:s,focused:r,mode:n}=this.props,i=P(this.environment),o=w(this.theme),a={...i.menuItem,...o.buttonMenuItem,...n===y.z.Pill?{width:"fit-content",border:"solid 1px",paddingLeft:0,paddingRight:0,borderRadius:20,fontSize:12}:{}};return(0,b.jsx)(u.Z,{focused:r,disabled:s,icon:t(i.icon),title:e,onClick:this.handleOriginActivate,style:a})},this.renderPillButtonOrigin=()=>{const{value:e,title:t}=this.props;return(0,b.jsx)(a.Z,{on:Boolean(e.starting||e.ending),icon:(0,n.C)({width:16,marginRight:6,fill:"currentColor"}),title:(0,b.jsx)("span",{children:t}),onClick:this.handleOriginActivate})},this.renderPopupContents=()=>{const{title:e,showButtons:t}=this.props,{store:s}=this.stores;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Z,{title:e,value:this.getCurrentValue(),onUpdate:this.updateTemporary,store:s,onDismiss:this.handleMenuClose}),t&&(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",padding:"0px 10px"},children:[(0,b.jsx)(p.Z,{isGray:!0,style:{marginLeft:"auto",marginRight:8},onClick:this.handleMenuClose,children:(0,b.jsx)(o.FormattedMessage,{defaultMessage:"Cancel",id:"searchDateFilter.cancelButton.label"})}),(0,b.jsx)(c.Z,{onClick:()=>this.props.onChange(this.stores.store.state.temporaryDateRange),children:(0,b.jsx)(o.FormattedMessage,{defaultMessage:"Accept",id:"searchDateFilter.acceptButton.label"})})]})]})},this.renderFooter=()=>{const{store:e}=this.stores;return(0,b.jsxs)(g.Z,{topBorder:!0,style:{padding:6,justifyContent:"space-between",display:"flex"},children:[(0,b.jsx)(p.Z,{onClick:()=>{e.setState({...e.state,temporaryDateRange:{starting:void 0,ending:void 0}}),this.props.onChange({})},children:(0,b.jsx)(o.FormattedMessage,{id:"searchDateFilter.clearButton",defaultMessage:"Clear"})}),(0,b.jsx)(c.Z,{onClick:this.handleMenuClose,children:(0,b.jsx)(o.FormattedMessage,{id:"searchDateFilter.applyButton",defaultMessage:"Apply"})})]})},this.handleOriginActivate=()=>{const{disabled:e}=this.props,{store:t}=this.stores;e||t.setState({...t.state,isOpen:!0,focus:"starting"})},this.handleMenuClose=e=>{const{onChange:t,onMenuDismiss:s}=this.props,{store:r}=this.stores,{temporaryDateRange:n}=r.state;l.zD(e)||(this.props.showButtons||t(n),r.setState({...r.state,isOpen:!1,temporaryDateRange:{starting:void 0,ending:void 0}}),s&&s())},this.updateTemporary=e=>{const{store:t}=this.stores;if(!e.error)return t.setState({...t.state,temporaryDateRange:{...t.state.temporaryDateRange,...e.value}})}}didMount(){this.updateTemporary({value:this.props.value})}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{title:t}=this.props,{store:s}=this.stores,r=P(this.environment),n=e===y.z.Section,o=n?t:void 0,a=(()=>e===y.z.Section?this.renderActiveButtonOrigin():e===y.z.Button?this.renderInactiveButtonOrigin():e===y.z.Pill?this.renderPillButtonOrigin():void(0,i.t1)(e))();return(0,b.jsx)(S.Z,{title:o,marginAfter:n,children:(0,b.jsx)(h.Z,{capture:s.state.isOpen,onUp:k,onDown:k,onEnter:k,children:(0,b.jsx)(m.ZP,{popupType:I(this.environment),open:s.state.isOpen,origin:a,render:this.renderPopupContents,onDismiss:this.handleMenuClose,placementToOrigin:m.ZP.Placement.Bottom,alignmentToOrigin:m.ZP.Alignment.Start,keepFocus:!0,style:r.popup})})})}renderMobile(e){const{store:t}=this.stores,s=e===y.z.Section?this.renderMobileFilterSummary():this.renderMobileButtonOrigin();return(0,b.jsx)(m.ZP,{popupType:m.ZP.PopupType.SlideUp,open:t.state.isOpen,origin:s,render:this.renderPopupContents,onDismiss:this.handleMenuClose,preventScaleTransition:!0})}renderMobileButtonOrigin(){const{icon:e,title:t,disabled:s}=this.props,r=P(this.environment);return(0,b.jsx)(u.Z,{disabled:s,focused:!1,icon:e(r.icon),title:t,onClick:this.handleOriginActivate})}renderMobileFilterSummary(){const{title:e,value:t,dateFormat:s,disabled:r,intl:i}=this.props,o=P(this.environment),a=(0,b.jsxs)("div",{style:o.summary,children:[(0,n.C)(o.iconActiveMobile),l._Q(t,i,s)]});return(0,b.jsx)(x.Z,{disabled:r,onClick:this.handleOriginActivate,onClickClear:()=>j(this.props.onChange),label:e,title:a})}getCurrentValue(){const{value:e}=this.props,{store:t}=this.stores,{temporaryDateRange:s}=t.state;return{...e,...s}}}M.displayName="SearchDateFilter";const C=(0,o.injectIntl)(M);function I(e){const{device:t}=e;return t.isMobile?m.ZP.PopupType.SlideUp:m.ZP.PopupType.Popup}function w(e){return{buttonMenuItem:{color:e.mediumTextColor},activeMenuItem:{color:e.regularTextColor}}}function k(e){e.preventDefault&&e.preventDefault()}function j(e){e({starting:void 0,ending:void 0})}function P(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},sectionMenuItem:{display:"flex"},summary:{display:"inline-flex"}}}},83890:(e,t,s)=>{s.d(t,{Z:()=>x});s(67294);var r=s(480),n=s(86628),i=s(66897),o=s(22686),a=s(19889),l=s(7928),d=s(9291),c=s(77907),u=s(68373),h=s(92864),p=s(93044),m=s(255),g=s(97680),f=s(8319),v=s(85893);const x=function(e){let{mode:t,title:s,userIds:n,onChange:i,disabled:a,focused:l,onMenuDismiss:u,onMenuOpen:h,parentStore:p}=e;window.__c={n:"SearchPersonFilter"};const m=(0,r.O7)(),g=(0,d.useIntl)();return(0,v.jsx)(f.Z,{mode:t,title:s,icon:o.f,iconStyles:C(m).recordIcon,items:n,onChange:i,disabled:a,focused:l,renderFilter:(e,t)=>(0,v.jsx)(I,{item:e,args:t,parentStore:p}),renderToken:(e,t)=>(0,v.jsx)(b,{item:e,handlers:t,userIds:n,parentStore:p}),renderItemForSummary:e=>(0,v.jsx)(y,{item:e,parentStore:p}),addItemLabel:(0,v.jsx)(d.FormattedMessage,{defaultMessage:"Add a person",id:"search.filterMenu.addAPersonButton.label"}),labelText:{title:s,tokenInputPlaceholder:g.formatMessage({defaultMessage:"Search people",id:"search.filterMenu.searchPeople.placeholder"}),componentDebugName:"SearchPersonFilter"},performRequest:e=>async function(e,t){let{query:s,current:r}=e;const n=new Set(r),i=await c.deps.searchActions.loader();return(await i.searchVisibleSpaceUsers({environment:t,query:s,membersOnly:!1})).filter((e=>!n.has(e.id))).slice(0,20).map((e=>e.id))}(e,m),renderResultMenuItem:(e,t)=>(0,v.jsx)(M,{item:e,props:t,parentStore:p}),onMenuDismiss:u,onMenuOpen:h,hasItemsSelected:(null==n?void 0:n.length)>0})};function S(e,t){return function(e,t){return u.U6.createChildStore(t,{table:a.KJ,id:e})}(e,t).getValue()}function y(e){let{item:t,parentStore:s}=e;window.__c={n:"ItemForSummaryComponent"};const r=(0,d.useIntl)(),i=(0,n.VK)((()=>S(t,s)),[t,s]);return(0,v.jsx)(v.Fragment,{children:(0,l.Nz)(r,i)})}function b(e){let{item:t,handlers:s,userIds:o,parentStore:a}=e;window.__c={n:"TokenComponent"};const l=(0,r.O7)(),d=1===o.length,c=(0,n.VK)((()=>S(t,a)),[t,a]);return c?(0,v.jsx)(h.ZP,{format:l.device.isMobile?p.lP.Large:p.lP.Small,showRemoveButton:!0,isSingle:d,onClickRemove:s.onRemove,actor:(0,i.m3)(c),shouldShrink:!0,style:{background:"transparent"}},t):null}function M(e){let{item:t,props:s,parentStore:r}=e;window.__c={n:"ResultMenuItemComponent"};const o=(0,n.VK)((()=>S(t,r)),[t,r]);return(0,v.jsx)(g.Z,{...s,actor:(0,i.m3)(o)})}function C(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:2,fill:"currentColor"}}}function I(e){let{item:t,args:s,parentStore:o}=e;window.__c={n:"FilterListItemComponent"};const{disabled:a,onRemove:l,onClick:d}=s,c=C((0,r.O7)()),u=(0,n.VK)((()=>S(t,o)),[t,o]),h=(0,v.jsx)(m.Z,{disabled:a,onClick:l});return(0,v.jsx)(g.Z,{disabled:a,focused:!1,actor:(0,i.m3)(u),right:h,style:c.menuItem,desktopTitleStyle:c.menuItemTitle,onClick:d},t)}},33991:(e,t,s)=>{s.r(t),s.d(t,{DEFAULT_MODAL_WIDTH_WITH_SIDE_PEEK:()=>Y,INACTIVE_TIMEOUT_MS:()=>G,SearchCopyLinkSource:()=>X,SearchStaticContext:()=>$,SearchStoresContext:()=>Q,default:()=>ee,getSearchResultMetadata:()=>re});s(57658);var r=s(67294),n=s(83355),i=s(18466),o=s(49085),a=s(15145),l=s(1800),d=s(12174),c=s(15157),u=s(72126),h=s(4615),p=s(45366),m=s(94804),g=(s(70203),s(97880)),f=s(63143),v=s(51787),x=s(47839),S=s(98730),y=s(40468),b=s(87531),M=s(81598),C=s(40824),I=(s(95477),s(34700)),w=s(73744),k=(s(69988),s(98165)),j=(s(65598),s(59139)),P=s(97638),T=(s(95697),s(2688)),R=s(74948),F=s(80444),B=s(77080),Z=s(32470),A=s(55320),_=s(92338),O=s(62965),L=s(29026);class E extends o.default{getInitialState(){return{insertedActionResultsCount:0,localResults:void 0,serverResultsLoading:!1,serverResults:void 0,serverEventProperties:void 0,serverResultsAllLoaded:!1,errorState:D,selectedQueryResultQuery:void 0}}setState(e){const t={...this.instanceState};if(!(0,O.Z)(this.instanceState,t))return;const s=function(e){const{newState:t,priorState:s}=e,{localResults:r,serverError:n,serverResultsLoading:i,serverResults:o}=t,a=Boolean(r),l=i?void 0:n;if(!a&&i)return!s.errorState.isLoading&&s.errorState.showMajorError?s.errorState:{isLoading:i};if(a)return{hasLocalResults:a,serverError:l,isLoading:!1,showMajorError:!1};if(l)return{hasLocalResults:a,serverError:l,isLoading:!1,showMajorError:!0};if(0===(null==o?void 0:o.results.length))return{hasLocalResults:a,serverError:_.Ix.NoResults,isLoading:!1,showMajorError:!0};return{hasLocalResults:a,serverError:l,isLoading:!1,showMajorError:!1}}({newState:e,priorState:t});super.setState({...e,errorState:s})}getResultCount(){const{serverResults:e,localResults:t}=this.state,s=(null==e?void 0:e.total)??(null==t?void 0:t.total)??0,r=Boolean(e&&s>=100);return{count:s,isLowerBound:Boolean(e&&t&&s<L.Xv)||r}}}const D={showMajorError:!1,isLoading:!1,hasLocalResults:!1,serverError:void 0};const V=E;var q=s(30857),N=s(87956),W=s(88893),K=s(9019),U=s(61817),z=s(86244),H=s(85893);const G=120*f.C0,$=r.createContext(null),Q=r.createContext(null);let X=function(e){return e[e.SidePeekPanel=0]="SidePeekPanel",e[e.KeyboardShortcut=1]="KeyboardShortcut",e}({});const Y=755;class J extends n.Z{constructor(){super(...arguments),this.inactiveTimer=void 0,this.spaceId=void 0,this.isOpen=!1,this.shouldClearServerResultsOnQueryChange=!1,this.queryResultsSectionRef=r.createRef(),this.searchFilterMenuRef=r.createRef(),this.modalBodyMenuRef=r.createRef(),this.searchResultStore=new V,this.secondarySearchResultStore=new V,this.focusedIndexStore=o.default.createValue(void 0),this.defaultBodyFocusedResult=o.default.createValue(void 0),this.searchActionItemsList=o.default.createValue([]),this.getStaticContext=u.HP((()=>({queryResultsSectionRef:this.queryResultsSectionRef,searchFilterMenuRef:this.searchFilterMenuRef,modalBodyMenuRef:this.modalBodyMenuRef,handleSelectSearchResult:this.handleSelectSearchResult,handleCopySearchItemLink:this.handleCopySearchItemLink,handleQueryChange:ae,handlePopupOpen:ie,handlePopupClose:oe,searchResultStore:this.searchResultStore,secondarySearchResultStore:this.secondarySearchResultStore,focusedIndexStore:this.focusedIndexStore,defaultBodyFocusedResult:this.defaultBodyFocusedResult,searchActionItemsStore:this.searchActionItemsList,isQuickSearch:this.props.quickSearchMode}))),this.getStoresContext=u.HP((e=>({parentStore:e}))),this.renderContent=e=>{const t=this.currentMode.state,s=this.isPopupOpen.state;return(0,H.jsx)($.Provider,{value:this.getStaticContext(),children:(0,H.jsxs)(Q.Provider,{value:this.getStoresContext(this.props.parentStore),children:[this.props.quickSearchMode&&!s&&(0,H.jsx)("div",{style:{position:"absolute",height:z.$,width:"100%",...(0,I.X)({drag:!0})}}),"search"===t?(0,H.jsx)(U.$T,{renderAsPage:this.props.renderAsPage,quickSearchMode:this.props.quickSearchMode,searchContentPaneType:e,onClose:this.handleComponentClose}):(0,H.jsx)(M.yX,{renderAsPage:this.props.renderAsPage,quickSearchMode:this.props.quickSearchMode,searchContentPaneType:e,onClose:this.handleComponentClose})]})})},this.handleComponentOpenClose=()=>{const e=A.default.state.open||A.default.state.openAsPage;this.isOpen!==e&&(this.isOpen=e,(A.default.state.open||A.default.state.openAsPage)&&(clearTimeout(this.inactiveTimer),L.ZP.update((e=>({...e,hasScrolled:!1})))))},this.handleComponentClose=e=>{const{device:t}=this.environment,{selectedQueryResult:s,numKeystrokes:r,numServerRequests:n,numLocalRequests:i,hadMetaClick:o}=q.default.state,{serverEventProperties:a}=this.searchResultStore.state,{query:l,hasScrolled:c,mode:u}=L.ZP.state;if(r>0&&(n>0||i>0)&&!s&&!o&&(A.default.state.openAsPage||A.default.state.open)){const e=Date.now(),s=A.default.state.openedTimeMs,i=A.default.state.sessionId,o=q.default.state.firstKeyStrokeTimeMs;v.EH(this.environment,{...a,timeToAbandonMs:e-s,timeFromFirstKeyStrokeToAbandonMs:o?e-o:void 0,numKeystrokes:r,numResultsAboveFold:this.getNumResultsAboveFold(),searchSessionId:i,searchSessionFlowNumber:n,hasScrolled:c,numLocalResults:this.getNumLocalResults(),numTotalLocalResults:this.getNumTotalLocalResults(),numVisibleMembers:(0,W.qX)(),isMobile:t.isMobile})}"assistant"===u&&"keydown"===(null==e?void 0:e.type)?L.ZP.switchToSearchPane():this.props.quickSearchMode?(A.default.closeAndResetMetricsState(),q.default.reset(),s&&!o&&this.resetState(),x.closeQuickSearch()):b.IB(this.environment),"assistant"===u&&C.N.setAssistantLastViewedTime(),""===l.text.trim()&&"assistant"!==u&&L.ZP.reset();const h=B.default.getEligibleGroup({experimentId:"search-shorten-inactive-timer",defaultGroup:"control"});let p=G;"control"!==h&&d.g6["search-shorten-inactive-timer"].includes(h)&&(p=parseInt(h,10)*f.C0),this.inactiveTimer&&clearTimeout(this.inactiveTimer),p>0?this.inactiveTimer=window.setTimeout(this.resetState,p):this.resetState(),!this.props.renderAsPage&&t.isMobile&&R.close(),q.default.reset()},this.handleVisibilityChange=(e,t,s)=>{if(!this.props.quickSearchMode)return;const r=T.ZP;if("stopQueueingSubscriptions"in r&&r.stopQueueingSubscriptions(this.environment),t){let e;e="tray-icon"===s?"quick-search-tray-icon":"shortcut"===s?"quick-search-shortcut":"debug-menu"===s?"quick-search-debug-menu":"quick-search",b.UT({environment:this.environment,analyticsFrom:e,isQuickSearch:!0,renderAsPage:!0})}else this.handleComponentClose()},this.handlePotentialWebSearchAbandon=e=>{this.props.renderAsPage&&this.handleComponentClose()},this.constructSelectSearchItemContext=e=>{var t,s;let{index:r,actionItemCount:n,context:i,selectedResult:o,allSearchResults:a,fromSidePeekPanel:l,sessionId:d,openedTimeMs:c}=e;const{serverEventProperties:u,store:h}=o,m=Date.now(),{numKeystrokes:g,hadMetaClick:f}=q.default.state,{firstKeyStrokeTimeMs:v}=q.default.state,{numServerRequests:x}=q.default.state,{query:S}=L.ZP.state,y=(0,W.qX)(),b=(null==a?void 0:a.filter((e=>{var t;return void 0!==(null===(t=e.matchedCollectionProperties)||void 0===t?void 0:t.collectionText)})).length)??0,M=(null==a?void 0:a.filter((e=>{var t;return void 0!==(null===(t=e.highlight)||void 0===t?void 0:t.collectionText)})).length)??0,C=void 0!==(null===(t=o.matchedCollectionProperties)||void 0===t?void 0:t.collectionText),I=void 0!==(null===(s=o.highlight)||void 0===s?void 0:s.collectionText);return{...u,context:i,queryStringLength:S.text.trim().length,numQueryTokens:p.wS(S.text.trim()).length,hasFilters:P.FN(S.filters),activeFilters:S.filters,selectedItemIndex:r.global-n,selectedItemLocalIndex:{section:r.local.section,index:r.local.indexLocal},numKeystrokes:g,fromSidePeekPanel:l,isSidePeekPanelOpen:L.ZP.state.isSidePeekPanelOpen,isSidebarOpen:L.ZP.isDebugSidebarOpen(),timeToSelectMs:m-c,timeFromFirstKeyStrokeToSelectMs:v?m-v:m-c,sources:null==o?void 0:o.sources,localSources:[...(null==o?void 0:o.localSource)??[]],indexInRecentPages:null==o?void 0:o.indexInRecentPages,timeSinceLastViewedMs:null==o?void 0:o.timeSinceLastViewedMs,hadMetaClick:f,numResultsAboveFold:this.getNumResultsAboveFold(),selectedSearchResultMetadata:re(o),selectedSearchResultContent:void 0,allSearchResultMetadata:null==a?void 0:a.slice(0,50).map((e=>re(e))),totalSearchResultCount:null==a?void 0:a.length,searchSessionId:d,searchSessionFlowNumber:x,originalPosition:null==o?void 0:o.originalPosition,numLocalResults:this.getNumLocalResults(),numTotalLocalResults:this.getNumTotalLocalResults(),numVisibleMembers:y,isMobile:this.environment.device.isMobile,resultWithCollectionPropertyMatchCount:b,resultWithCollectionPropertyHighlightCount:M,isCollectionPropertyMatch:C,isCollectionPropertyHighlight:I}},this.handleSelectSearchResult=e=>{let{index:t,actionItemCount:s,event:r,context:n,selectedResult:i,allSearchResults:o,fromSidePeekPanel:d}=e;const{serverEventProperties:c,store:u}=i;if(!A.default.state.open&&!A.default.state.openAsPage)return;const h=w.DJ(r);"query_results"===n&&(q.default.update((e=>({...e,selectedQueryResult:!0}))),this.searchResultStore.update((e=>({...e,selectedQueryResultQuery:L.ZP.state.query}))));const{sessionId:p,openedTimeMs:f}=A.default.state,{numServerRequests:S}=q.default.state;v.nL(this.environment,{...this.constructSelectSearchItemContext({index:t,actionItemCount:s,context:n,selectedResult:i,allSearchResults:o,fromSidePeekPanel:d,sessionId:p,openedTimeMs:f}),isMetaClick:Boolean(h)});const b=(null==c?void 0:c["server-queryId"])??(0,m.A7)({searchSessionId:p,searchSessionFlowNumber:S});let M;"recent_pages"===n?M=a.tY.SearchRecents:"query_results"===n?M=a.tY.SearchQuery:(0,g.t1)(n);if(this.environment.device.isElectron&&this.props.quickSearchMode){const e=(0,l.Z)({pageModel:i.store.getModel(),pageId:i.store.id,scrollToBlockId:(0,P.dy)(i),pageVisitSource:M,queryId:b});x.openQuickSearchResult(e)}else y.P({searchResult:i,environment:this.environment,pageVisitSource:M,queryId:b,openInNew:h,openInSidePeek:false});N.Z.setState({queryId:b,pageId:u.id,timeEntered:new Date}),h?q.default.update((e=>({...e,hadMetaClick:!0}))):this.handleComponentClose()},this.handleCopySearchItemLink=e=>{let{index:t,actionItemCount:s,context:r,selectedResult:n,allSearchResults:i,fromSidePeekPanel:o,source:a}=e;if(!A.default.state.open&&!A.default.state.openAsPage)return;const{sessionId:l,openedTimeMs:d}=A.default.state;v.sb(this.environment,{...this.constructSelectSearchItemContext({index:t,actionItemCount:s,context:r,selectedResult:n,allSearchResults:i,fromSidePeekPanel:o,sessionId:l,openedTimeMs:d}),source:a})},this.getNumResultsAboveFold=()=>P.MQ({environment:this.environment,searchResultsSection:this.queryResultsSectionRef.current,modalBodyMenu:this.modalBodyMenuRef.current,searchFilterMenu:this.searchFilterMenuRef.current,actionItemCount:this.searchActionItemsList.state.length??0}),this.getNumLocalResults=()=>{var e;return(null===(e=this.searchResultStore.state.localResults)||void 0===e?void 0:e.results.length)??0},this.getNumTotalLocalResults=()=>{var e;return(null===(e=this.searchResultStore.state.localResults)||void 0===e?void 0:e.total)??0},this.handleSpaceChange=()=>{const e=F.default.state.currentSpaceStore&&F.default.state.currentSpaceStore.id;this.spaceId!==e&&(this.spaceId=e,this.resetStateWhenSpaceChange(),S.S(this.environment),this.spaceId&&F.default.state.currentUserStore&&this.props.quickSearchMode&&x.quickSearchReady())},this.resetState=()=>{L.ZP.reset(),this.searchResultStore.reset(),this.secondarySearchResultStore.reset(),q.default.reset(),this.props.quickSearchMode?A.default.closeAndResetMetricsState():A.default.reset()},this.resetStateWhenSpaceChange=()=>{L.ZP.reset(),this.searchResultStore.reset(),this.secondarySearchResultStore.reset(),this.props.quickSearchMode||(A.default.reset(),q.default.reset())},this.currentMode=this.createComputedStore((()=>L.ZP.state.mode)),this.isPopupOpen=this.createComputedStore((()=>L.ZP.state.isPopupOpen))}UNSAFE_willMount(e){var t;this.spaceId=null===(t=F.default.state.currentSpaceStore)||void 0===t?void 0:t.id,(0,Z.lO)(),F.default.state.currentSpaceStore&&F.default.state.currentUserStore&&e.quickSearchMode&&x.quickSearchReady()}UNSAFE_willMountOrUpdate(e){if(e.renderAsPage&&!e.quickSearchMode&&!A.default.state.sessionId){const e=(0,h.ZP)();A.default.update((t=>({...t,open:!1,openAsPage:!0,openedTimeMs:Date.now(),sessionId:e}))),v.wF(this.environment,{from:"nativeTab-search-direct-link",searchSessionId:e})}}didMount(){F.default.addListener(this.handleSpaceChange),A.default.addListener(le),this.props.renderAsPage&&!this.props.quickSearchMode||A.default.addListener(this.handleComponentOpenClose),this.props.quickSearchMode?x.quickSearchVisibilityState.addListener(this.handleVisibilityChange):x.openSearchModalFromQuickSearch.addListener((()=>de(this.environment))),y.T.addListener(this.handlePotentialWebSearchAbandon)}willUnmount(){this.resetState(),this.props.renderAsPage&&!this.props.quickSearchMode||(A.default.removeListener(this.handleComponentOpenClose),x.openSearchModalFromQuickSearch.removeListener((()=>de(this.environment)))),this.props.quickSearchMode&&x.quickSearchVisibilityState.removeListener(this.handleVisibilityChange),y.T.removeListener(this.handlePotentialWebSearchAbandon),F.default.removeListener(this.handleSpaceChange),A.default.removeListener(le),this.inactiveTimer&&(clearTimeout(this.inactiveTimer),this.inactiveTimer=void 0)}renderComponent(){const e=Boolean(L.ZP.state.query.text.trim())||P.VA(L.ZP.state.query.filters)?"search_results":"default_body";if(this.props.renderAsPage)return this.renderContent(e);const{device:t,mobileNative:s}=this.environment,r=Boolean(A.default.state.open);return(0,H.jsx)(K.Z,{open:r,onDismiss:this.handleComponentClose,modalStyle:ne(e,this.props.renderAsPage,this.environment,this.theme),disableAnimation:!t.isMobile||(null==s?void 0:s.supportsNativeHomeOnPhone())||!1,renderContent:()=>this.renderContent(e)})}}J.displayName="Search";const ee=J;function te(e){return P.bC(e)}function se(e){const t=(0,Z.gq)({device:e.device}),s=(0,U.X1)({device:e.device,isPublicAccessPermissionForPage:te(e).hasPublicAccessPermission});if(t)return"90vw";if((0,j.rd)(e))return Y;let r=660;return s&&(r+=250),r}function re(e){const{store:t,highlight:s,sources:r,localSource:n}=e;return i.Z.withListenerIgnored((()=>{var i,o,a,l,d;return{blockId:t.id,blockType:t.getType(),lowestNavigableAncestorId:null===(i=t.getNavigableBlockStore())||void 0===i?void 0:i.id,depth:k.qA(t).length,matchesText:Boolean(null==s?void 0:s.text),matchesPathText:Boolean((null==s?void 0:s.pathText)||(null==s?void 0:s.title)),matchesTitle:Boolean(null==s?void 0:s.title),isNavigable:t.isNavigableBlock(),lastEditedTime:t.getLastEditedTime(),isTeamArchived:null===(o=(0,k.VP)(t))||void 0===o?void 0:o.isArchived(),sources:r,localSource:[...n??[]],badges:(null===(a=e.badges)||void 0===a?void 0:a.map((e=>e.type)))??[],isCollectionPropertyMatch:void 0!==(null===(l=e.matchedCollectionProperties)||void 0===l?void 0:l.collectionText),isCollectionPropertyHighlight:void 0!==(null===(d=e.highlight)||void 0===d?void 0:d.collectionText),featureGroups:e.featureGroups}}))}function ne(e,t,s,r){const n=(0,U.ip)({searchContentPaneType:e,renderAsPage:t,environment:s});return{width:"100%",minHeight:n.minHeight,maxHeight:n.maxHeight,transform:"translate3d(0,0,0)",background:r.popoverBackground,maxWidth:se(s),borderRadius:12}}function ie(){L.ZP.setIsAnyPopupOpen(!0)}function oe(){L.ZP.setIsAnyPopupOpen(!1)}function ae(e){""!==e?(q.default.update((e=>({...e,numKeystrokes:e.numKeystrokes+1}))),L.ZP.updateQueryText(e)):L.ZP.resetQuery({resetFilters:!1})}function le(){var e;const t=null===(e=F.default.state.currentUserStore)||void 0===e?void 0:e.id;t&&c.Z.set({userId:t,key:m.Y6,value:A.default.state.preferSidePeekOpen})}function de(e){b.UT({environment:e,analyticsFrom:"keyboard-shortcut-quick-search-hotkey",isQuickSearch:!1,renderAsPage:!1})}},61817:(e,t,s)=>{s.d(t,{$T:()=>Pi,ip:()=>Ri,X1:()=>Ai});var r=s(67294),n=s(480),i=s(86628),o=s(24405),a=s(15145),l=s(72126),d=s(29477),c=s(80503),u=s(80560),h=s(98730),p=s(43250),m=s(84210),g=s(87279),f=s(59139),v=s(97638),x=s(82063),S=s(5162),y=s(80444),b=s(88632),M=s(69454),C=s(32470),I=s(55320),w=s(29026),k=s(36488),j=s(56940),P=s(3386),T=s(78140),R=s(40721),F=s(83785),B=s(22715),Z=s(33991),A=s(83355),_=s(12174),O=s(67220),L=s(69651),E=s(64275),D=s(6637),V=s(60291),q=s(37612),N=s(83303),W=s(53772),K=s(97880),U=s(82990),z=s(9291),H=s(95477),G=s(34700),$=s(95697),Q=s(61766),X=s(77080),Y=s(23063),J=s(64921),ee=s(52275),te=s(31945),se=s(60458),re=s(89728),ne=s(72495),ie=s(93481),oe=s(84619),ae=s(90028),le=s(21202),de=s(33929),ce=s(15447),ue=s(77907),he=s(68373),pe=s(31278),me=s(11470),ge=s(76798),fe=s(255),ve=s(85567),xe=s(8319),Se=s(85893);const ye={token:{display:"flex",alignItems:"center"},icon:{marginRight:4}},be=(0,z.defineMessages)({searchPages:{defaultMessage:"Search pages",id:"searchPageFilter.searchTokenFilter.tokenInput.placeholder"},selectAPage:{defaultMessage:"Select a page",id:"searchPageFilter.searchTokenFilter.resultSection.title"}});const Me=function(e){let{mode:t,title:s,blockIds:r,onChange:i,disabled:o,focused:a,onMenuDismiss:l,onMenuOpen:d,parentStore:c}=e;window.__c={n:"SearchPageFilter"};const u=(0,n.O7)();return(0,Se.jsx)(xe.Z,{mode:t,hasItemsSelected:(null==r?void 0:r.length)>0,title:s,icon:ae.j,iconStyles:je(u).recordIcon,items:r,onChange:i,focused:a,renderFilter:(e,t)=>(0,Se.jsx)(Pe,{item:e,args:t,parentStore:c}),renderToken:(e,t)=>(0,Se.jsx)(we,{item:e,handlers:t,blockIds:r,parentStore:c}),renderItemForSummary:e=>(0,Se.jsx)(Ie,{item:e,parentStore:c}),addItemLabel:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Add another page",id:"searchPageFilter.searchTokenFilter.addAPage.button"}),labelText:{title:s,tokenInputPlaceholder:de.default.formatMessage(be.searchPages),componentDebugName:"SearchPageFilter"},performRequest:e=>async function(e,t){let{query:s,current:r}=e;const{currentSpaceStore:n}=y.default.state;if(!n)return[];const i=await ue.deps.searchActions.loader(),o=s?(await i.searchPageIds({environment:t,query:s,limit:20,spaceId:n.id,requireEditPermissions:!1,excludeTemplates:!1,source:"ancestor_filter_page_search",boostRecentlyViewedPages:!0})).results:ce.X4.state.map((e=>e.pageId)),a=new Set(r);return o.filter((e=>!a.has(e)))}(e,u),renderResultMenuItem:(e,t)=>(0,Se.jsx)(ke,{item:e,props:t,parentStore:c}),disabled:o,onMenuDismiss:l,onMenuOpen:d})};function Ce(e,t){return he.G.createChildStore(t,{table:le.iU,id:e})}function Ie(e){let{item:t,parentStore:s}=e;const r=Ce(t,s);return(0,Se.jsx)(ge.Z,{store:r,shouldWrap:!0,maxLength:50})}function we(e){let{item:t,handlers:s,blockIds:r,parentStore:o}=e;window.__c={n:"TokenComponent"};const a=(0,n.O7)(),l=ye,d=1===r.length,c=Ce(t,o),u=(0,i.VK)((()=>c.getIcon()),[c]),h=(0,Se.jsxs)("div",{style:l.token,children:[(0,Se.jsx)(pe.Z,{disabled:!0,icon:u,isEmptyPage:!1,size:20,style:l.icon}),(0,Se.jsx)(ge.Z,{store:c})]});return(0,Se.jsx)(ve.Z,{format:a.device.isMobile?oe.lo.Large:oe.lo.Small,value:h,showRemoveButton:!0,onClickRemove:s.onRemove,isSingle:d,shouldShrink:!0,backgroundColor:"transparent",shouldWrap:!1})}function ke(e){let{item:t,props:s,parentStore:r}=e;window.__c={n:"ResultMenuItemComponent"};const n=(0,i.VK)((()=>Ce(t,r)),[t,r]);return(0,Se.jsx)(me.Z,{...s,store:n})}function je(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{fill:"currentColor"}}}function Pe(e){let{item:t,args:s,parentStore:r}=e;window.__c={n:"FilterListItemComponent"};const{disabled:i,onRemove:o,onClick:a}=s,l=je((0,n.O7)()),d=Ce(t,r),c=(0,Se.jsx)(fe.Z,{disabled:i,onClick:o});return(0,Se.jsx)(me.Z,{disabled:i,focused:!1,store:d,right:c,style:l.menuItem,desktopTitleStyle:l.menuItemTitle,onClick:a})}var Te=s(83890),Re=s(88507),Fe=s(29369),Be=s(92338),Ze=s(30397),Ae=s(93044),_e=s(30676);const Oe=function(e){let{mode:t,title:s,teamIds:r,onChange:i,disabled:o,focused:a,onMenuDismiss:l,onMenuOpen:d,parentStore:c}=e;window.__c={n:"SearchTeamFilter"};const u=(0,n.O7)(),h=(0,z.useIntl)(),p=(0,Be.iY)(r);return(0,Se.jsx)(xe.Z,{mode:t,title:s,icon:Re.I,iconStyles:qe(u).recordIcon,items:p||[],onChange:i,disabled:o,focused:a,renderFilter:(e,t)=>(0,Se.jsx)(Ne,{item:e,args:t,parentStore:c}),renderToken:(e,t)=>(0,Se.jsx)(Ve,{item:e,handlers:t,teamIds:r,parentStore:c}),renderItemForSummary:e=>(0,Se.jsx)(Ee,{item:e,parentStore:c}),addItemLabel:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Add a teamspace",id:"search.filterMenu.addATeamButton.label"}),labelText:{title:s,tokenInputPlaceholder:h.formatMessage({defaultMessage:"Search teamspaces",id:"search.filterMenu.searchTeams.placeholder"}),componentDebugName:"SearchTeamFilter"},performRequest:e=>async function(e,t){var s;let{query:r,current:n}=e;const i=new Set(n),o=y.default.state.currentSpaceViewStore,a=y.default.state.currentSpaceStore,l=null===(s=y.default.state.currentUserStore)||void 0===s?void 0:s.id;if(!o||!a||!l)return[];if(!r){const e=new Set(o.getTeamsStores().map((e=>e.id)));if(Ze.Z.state.teams.map((e=>e.id)).forEach((t=>e.add(t))),e.size>0)return[...e]}const d=await(0,$.qX)({environment:t,spaceStore:a,currentUserId:l}),c=await ue.deps.searchActions.loader();return(await c.searchTeams({query:r,spaceViewStore:o,teamStores:d})).filter((e=>!i.has(e.id))).slice(0,20).map((e=>e.id))}(e,u),renderResultMenuItem:(e,t)=>(0,Se.jsx)(De,{item:e,props:t,parentStore:c}),onMenuDismiss:l,onMenuOpen:d,hasItemsSelected:Boolean(p&&(null==p?void 0:p.length)>0)})};function Le(e,t){return he.zX.createChildStore(t,{table:Fe.e0,id:e})}function Ee(e){let{item:t,parentStore:s}=e;return(0,Se.jsx)(Se.Fragment,{children:Le(t,s).getName()})}function De(e){let{item:t,props:s,parentStore:n}=e;const i=Le(t,n);return(0,r.createElement)(_e.F,{...s,key:t,teamStore:i})}function Ve(e){let{item:t,handlers:s,teamIds:r,parentStore:o}=e;window.__c={n:"TokenComponent"};const a=(0,n.O7)(),l=(0,Be.iY)(r),d=1===(null==l?void 0:l.length),c=(0,i.VK)((()=>Le(t,o)),[t,o]),u=(0,i.VK)((()=>c.getName()),[c]),h=(0,i.VK)((()=>function(e){const t=e.getIcon();return e=>(0,Se.jsx)(pe.Z,{disabled:!0,icon:t,isEmptyPage:!1,size:e})}(c)),[c]);return c?(0,Se.jsx)(Ae.ZP,{format:a.device.isMobile?Ae.lP.Large:Ae.lP.Small,showRemoveButton:!0,isSingle:d,onClickRemove:s.onRemove,renderAvatar:h,title:u,style:{background:"transparent"}}):null}function qe(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:6,fill:"currentColor"}}}function Ne(e){let{item:t,args:s,parentStore:r}=e;window.__c={n:"FilterListItemComponent"};const{disabled:i,onRemove:o,onClick:a}=s,l=qe((0,n.O7)()),d=Le(t,r),c=(0,Se.jsx)(fe.Z,{disabled:i,onClick:o});return(0,Se.jsx)(_e.F,{disabled:i,focused:!1,teamStore:d,right:c,style:l.menuItem,desktopTitleStyle:l.menuItemTitle,onClick:a},t)}var We=s(45257),Ke=s(86825),Ue=s(75689),ze=s(91642);class He extends A.Z{renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){return(0,Se.jsx)(ze.Z,{marginAfter:!1,style:Qe(this.environment).sectionMenuItem,children:this.renderSwitcherMenuItem(e)})}renderMobile(e){const{title:t,value:s,disabled:r}=this.props;return e===xe.z.Button?this.renderSwitcherMenuItem(e):(0,Se.jsx)(Ue.Z,{disabled:r,onClick:()=>$e(this.props.value,this.props.onChange),label:t,isToggle:!0,isToggleActive:s})}renderSwitcherMenuItem(e){const{title:t,icon:s,value:r,style:n,...i}=this.props,o=Qe(this.environment),a=this.getThemeColors(),l={...o.menuItem,...a.menuItem,...n};return e===xe.z.Pill?(0,Se.jsx)(We.Z,{on:r,hideChevron:!0,title:(0,Se.jsx)("span",{children:t}),onClick:()=>$e(this.props.value,this.props.onChange),icon:s(o.pillIcon)}):(0,Se.jsx)(Ke.Z,{title:t,icon:s(o.icon),on:r,onClick:()=>$e(this.props.value,this.props.onChange),style:l,...i})}getThemeColors(){return{menuItem:{color:this.theme.mediumTextColor}}}}He.displayName="SearchToggleFilter";const Ge=He;function $e(e,t){t(!e)}function Qe(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},pillIcon:{height:16,width:16,fill:"currentColor",marginRight:6},sectionMenuItem:{display:"flex"}}}var Xe=s(8848),Ye=s(42853),Je=s(32163);function et(e){window.__c={n:"SearchExperimentFilterPopupButton"};const t=(0,n.Fy)();return(0,Se.jsx)(te.ZP,{popupType:t.isMobile?te.Z4.SlideUp:te.Z4.Popup,renderOrigin:t=>(0,Se.jsx)(st,{events:t,...e}),render:t=>(0,Se.jsx)(tt,{parent:t,...e})})}function tt(e){let{parent:t,experiment:s,onChange:r}=e;window.__c={n:"SearchExperimentFilterMenu"};const i=(0,n.Fy)(),a=(0,o.yK)((()=>({menuOptionStyle:{color:Xe.ZP.mediumTextColor}})),[]);let l;l=i.isMobile?{menuType:g.og.Modal,title:s.experimentId,right:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}),onClickRight:t.close}:{menuType:g.og.Popup,width:250};const d=s.groups.map((e=>({key:e,action:n=>{r({experimentId:s.experimentId,group:e}),t.close()},render:(t,s)=>(0,Se.jsx)(ee.Z,{...t,title:e,style:a.menuOptionStyle})})));return(0,Se.jsx)(T.Z,{...l,children:(0,Se.jsx)(Je.Z,{type:Je.i.Vertical,initialFocus:void 0,sections:[{key:s.experimentId,render:e=>(0,Se.jsx)(ne.Z,{...e}),items:d}]})})}function st(e){let{experiment:t,events:s,searchExperimentOverrides:n}=e;window.__c={n:"SearchExperimentFilterMenuButton"};const i=(0,o.yK)((e=>({experimentGroupButtonChevronStyle:{width:10,fill:e.lightIconColor},experimentGroupButtonStyle:{overflowX:"hidden",justifyContent:"left",overflow:"hidden",marginLeft:6,color:e.mediumTextColor},rowContainer:{display:"flex",overflow:"hidden",flexDirection:"row"},groupCell:{overflow:"hidden",marginRight:4}})),[]);return(0,r.createElement)(re.Z,{...s,isSmall:!0,key:t.experimentId,style:i.experimentGroupButtonStyle},(0,Se.jsxs)("div",{style:i.rowContainer,children:[(0,Se.jsx)("div",{style:i.groupCell,children:n[t.experimentId]||t.group}),(0,Se.jsx)("div",{children:(0,Ye.i)(i.experimentGroupButtonChevronStyle)})]}))}const rt=e=>({fontSize:14,lineHeight:1.2,color:e.mediumTextColor,marginRight:4,display:"flex",alignItems:"center",whiteSpace:"nowrap"}),nt=function(e){window.__c={n:"SearchExperimentFilter"};const{experiment:t}=e,{leftOverrides:s,rightOverrides:n,experimentDiffers:a,experimentAgreesButNondefault:l}=(0,i.VK)((()=>{const e=C.v_.state.searchExperimentOverrides,s=C.BJ.state.searchExperimentOverrides,r=(e[t.experimentId]??t.group)!==(s[t.experimentId]??t.group);return{leftOverrides:e,rightOverrides:s,experimentDiffers:r,experimentAgreesButNondefault:!r&&void 0!==s[t.experimentId]&&e[t.experimentId]!==t.group}}),[t]),d=(0,o.yK)((e=>({rowContainer:{backgroundColor:a?e.equationErrorPlaceholderBackground:l?e.accentColors.yellow[100]:void 0},titleCell:{...rt(e),maxWidth:180,textOverflow:"ellipsis",overflow:"hidden"}})),[l,a]),c=(0,r.useCallback)((e=>{const{experimentId:t,group:s,store:r}=e;r.setState({...r.state,searchExperimentOverrides:{...r.state.searchExperimentOverrides,[t]:s}})}),[]);return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)("div",{style:{...d.titleCell,...d.rowContainer},children:t.experimentId.replace("search-","")}),(0,Se.jsx)("div",{style:d.rowContainer,children:(0,Se.jsx)(et,{experiment:t,searchExperimentOverrides:s,onChange:e=>{c({...e,store:C.v_})}})}),(0,Se.jsx)("div",{style:d.rowContainer,children:(0,Se.jsx)(et,{experiment:t,searchExperimentOverrides:n,onChange:e=>{c({...e,store:C.BJ})}})})]})};var it=s(53877),ot=s(42875),at=s(22686);let lt=function(e){return e[e.Button=0]="Button",e[e.MenuItem=1]="MenuItem",e}({});class dt extends A.Z{constructor(){super(...arguments),this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},buttonFilter:{padding:"4px 8px",display:"flex",alignItems:"center",overflow:"hidden"},buttonText:{...U.Z.textOverflowStyle},icon:{display:"inline-block",height:14,width:14,fill:"currentColor"},buttonIcon:{marginRight:6}}}renderComponent(){const{mode:e}=this.props;return e===lt.Button?this.renderAsButton():e===lt.MenuItem?this.renderAsMenuItem():void(0,K.t1)(e)}renderAsButton(){const{icon:e,title:t,filter:s}=this.props,r=this.styles,n=ft(this.props.isLastInSection,this.environment,this.theme);return(0,Se.jsxs)(J.Z,{style:{...r.buttonFilter,...n.buttonFilter},onClick:()=>vt(s,this.props.onMenuDismiss),children:[e&&e({...r.icon,...r.buttonIcon}),(0,Se.jsx)("span",{style:r.buttonText,children:t})]})}renderAsMenuItem(){const{icon:e,title:t,filter:s,focused:r}=this.props,n=this.styles,i=ft(this.props.isLastInSection,this.environment,this.theme),o={...n.menuItem,...i.menuItem};return(0,Se.jsx)(ee.Z,{icon:e&&e(n.icon),focused:r,title:t,onClick:()=>vt(s,this.props.onMenuDismiss),style:o})}}dt.displayName="SearchFilterPreset";class ct extends A.Z{renderComponent(){const e=pt();if(e)return(0,Se.jsx)(dt,{icon:ae.j,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.quickFilters.inCurrentPage",defaultMessage:"In current page"}),filter:e,...this.props})}}ct.displayName="InCurrentPagePreset";class ut extends A.Z{renderComponent(){const e=gt(this.environment);if(e)return(0,Se.jsx)(dt,{icon:at.f,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.quickFilters.createdByMe",defaultMessage:"Created by me"}),filter:e,...this.props})}}ut.displayName="CreatedByMePreset";class ht extends A.Z{renderComponent(){const e=mt();if(e)return(0,Se.jsx)(dt,{icon:L.C,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.quickFilters.editedLastWeek",defaultMessage:"Edited last week"}),filter:e,...this.props})}}ht.displayName="EditedLastWeekPreset";const pt=()=>{const{mainEditorCurrentBlockStore:e}=y.default.state;if(e&&e.id)return{ancestors:[e.id]}},mt=()=>({lastEditedTime:{starting:it.Oo((0,ot.r)()),ending:it.Lg((0,ot.r)())}}),gt=e=>{const{id:t}=e.currentUser;if(t)return{createdBy:[t]}};function ft(e,t,s){const{device:r}=t;return{menuItem:{color:r.isDesktop?s.mediumTextColor:void 0,...e&&{boxShadow:void 0}},buttonFilter:{color:s.mediumTextColor}}}function vt(e,t){!function(e){w.ZP.updateFilters(e)}(e),w.ZP.isDebugSidebarOpen()||w.ZP.setState({...w.ZP.state,isDebugSidebarOpen:!0}),t&&t()}var xt=s(1743),St=s(74194);function yt(e){window.__c={n:"SearchStringOverrideControls"};const{leftValue:t,rightValue:s,setLeftValue:n,setRightValue:i,placeholder:a,label:l}=e,{titleCell:d,rightTitleCell:c,leftTitleCell:u}=(0,o.yK)((e=>{const r=rt(e);return{titleCell:r,rightTitleCell:{...r,color:s?r.color:e.lightTextColor,width:"95%"},leftTitleCell:{...r,color:t?r.color:e.lightTextColor,width:"95%"}}}),[t,s]),[h,p]=(0,r.useState)(s),[m,g]=(0,r.useState)(t);(0,r.useEffect)((()=>{void 0===s&&p(void 0),void 0===t&&g(void 0)}),[s,t]);const f=(0,r.useCallback)((()=>{i(h)}),[i,h]),v=(0,r.useCallback)((()=>{n(m)}),[n,m]),x=(0,r.useCallback)((e=>{p(e.target.value)}),[]),S=(0,r.useCallback)((e=>{g(e.target.value)}),[]);return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)("div",{style:d,children:l}),(0,Se.jsxs)(xt.Z,{capture:!0,allowMenuList:!1,children:[(0,Se.jsx)(St.Z,{style:u,onBlur:v,value:m,onChange:S,placeholder:a}),(0,Se.jsx)(St.Z,{style:c,onBlur:f,value:h,onChange:x,placeholder:a})]})]})}let bt=function(e){return e.Button="Button",e.Section="Section",e}({});class Mt extends A.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:Q.Z},this.renderAddFilterMenu=()=>(0,Se.jsxs)(T.Z,{menuType:g.og.ActionSheet,children:[this.renderSuggestedFilters(),(0,Se.jsxs)(ze.Z,{title:(0,Se.jsx)(Ft,{}),children:[this.renderCreatedByFilter(xe.z.Button),this.renderCreatedTimeFilter(xe.z.Button),this.renderLastEditedTimeFilter(xe.z.Button),this.renderAncestorFilter(xe.z.Button),this.renderInTeamFilter(xe.z.Button)]})]}),this.searchExperimentsToToggle=this.createComputedStore((()=>(0,K.qP)(_.g6).map((e=>{let[t,s]=e;return{experimentId:t,experimentVersion:1,group:X.default.getGroup(t),groups:["control",...s]}})))),this.closeAddFilterMenu=()=>{const{buttonPopupStore:e}=this.stores;e.setState({...e.state,open:!1})}}renderComponent(){return this.props.isMobile?this.props.mode===bt.Button?this.renderAddButtonMobile():this.props.mode===bt.Section?this.renderActiveFiltersMobile():void(0,K.t1)(this.props.mode):this.renderSidebar()}renderActiveFiltersMobile(){const{state:e}=w.ZP,t=v.De(e.query.filters);return(0,Se.jsxs)(ne.Z,{disableMobilePadding:!0,disableMobileBorders:!0,children:[(0,Se.jsx)(At,{mode:xe.z.Section}),(0,Se.jsx)(Rt,{mode:xe.z.Section}),this.renderActiveFilters(t,xe.z.Section)]})}renderAddButtonMobile(){const{buttonPopupStore:e}=this.stores;return(0,Se.jsx)(te.ZP,{popupType:te.Z4.SlideUp,buttonPopupStore:e,renderOrigin:e=>(0,Se.jsx)(Ot,{...e,isMobile:this.props.isMobile}),render:this.renderAddFilterMenu})}renderActiveFilters(e,t){return(0,Se.jsxs)(r.Fragment,{children:[e.createdBy&&this.renderCreatedByFilter(t),e.createdTime&&this.renderCreatedTimeFilter(t),e.lastEditedTime&&this.renderLastEditedTimeFilter(t),e.ancestors&&this.renderAncestorFilter(t),e.inTeams&&this.renderInTeamFilter(t)]})}renderSuggestedFilters(){const{filters:e}=w.ZP.state.query,t=function(e,t){const s=gt(e);if(!s)return!1;if(!s.createdBy)return!1;const r=s.createdBy[0];return-1!==t.createdBy.indexOf(r)}(this.environment,e),s=function(e){const{lastEditedTime:t}=mt();return l.Xy(t,e.lastEditedTime)}(e),r=function(e){const t=pt();if(!t)return!1;if(!t.ancestors)return!1;const s=t.ancestors[0];return-1!==e.ancestors.indexOf(s)}(e);if(!(t&&s&&r))return(0,Se.jsxs)(ze.Z,{title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.quickFiltersSection.title",defaultMessage:"Quick filters"}),marginAfter:!0,children:[!t&&(0,Se.jsx)(ut,{mode:lt.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!s&&(0,Se.jsx)(ht,{mode:lt.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!r&&(0,Se.jsx)(ct,{mode:lt.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu,isLastInSection:!0})]})}renderSidebar(){const e=_t(this.props.isMobile),t={sidebar:{backgroundColor:(s=this.theme).sidebarSecondaryBackground,borderLeft:`1px solid ${s.regularDividerColor}`}};var s;const r={...e.sidebar,...t.sidebar,...!w.ZP.isDebugSidebarOpen()&&e.sidebarHidden},n=(0,f.bN)(this.environment);return(0,Se.jsxs)("aside",{style:r,children:[(0,Se.jsx)(J.Z,{onClick:Zt,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16,position:"absolute",top:10,right:10,...n&&(0,G.X)({noDrag:!0})},children:(0,E.D)({width:14,fill:this.theme.mediumTextColor})}),this.renderDevToolsSection()]})}renderDevToolsSection(){if((0,W.x)(H.default))return(0,Se.jsx)(ze.Z,{title:"Dev Tools",children:(0,Se.jsx)(Y.Z,{isVisible:!0,animationStyle:{height:"100%"},render:()=>(0,Se.jsxs)("div",{style:{overflow:"scroll"},children:[(0,Se.jsx)(Pt,{}),(0,Se.jsx)(Tt,{}),(0,Se.jsx)(jt,{}),(0,Se.jsxs)(ze.Z,{style:{marginTop:16},title:"Quick Switch",children:[(0,Se.jsx)(It,{title:"No local at all",searchExperimentOverrides:{"search-no-local-blending":"on","search-debug-only-no-recent-boosting":"on"}}),(0,Se.jsx)(It,{title:"No local results",searchExperimentOverrides:{"search-no-local-blending":"on"}}),(0,Se.jsx)(It,{title:"No local boosting",searchExperimentOverrides:{"search-debug-only-no-recent-boosting":"on"}}),(0,Se.jsx)(It,{title:"Vector only",searchExperimentOverrides:{"search-vectors":"log-norm"}})]}),(0,Se.jsx)(ze.Z,{style:{marginTop:16},title:"Dev Experiments",right:(0,Se.jsx)(re.Z,{onClick:()=>{C.v_.reset(),C.BJ.reset()},style:{paddingLeft:0,paddingRight:0,height:"unset"},children:(0,V.b)({width:12})}),children:(0,Se.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr 1fr",minWidth:"100%",maxWidth:"100%",paddingLeft:14},children:[(0,Se.jsx)("div",{}),(0,Se.jsx)("div",{}),(0,Se.jsx)(Ct,{columnStore:C.BJ}),this.searchExperimentsToToggle.state.map((e=>(0,Se.jsx)(nt,{experiment:e},e.experimentId))),(0,Se.jsx)(yt,{leftValue:C.v_.state.forcedClusterPattern,rightValue:C.BJ.state.forcedClusterPattern,setLeftValue:C.v_.updateForcedClusterPattern,setRightValue:C.BJ.updateForcedClusterPattern,placeholder:"cluster-pattern",label:"forced cluster pattern"}),(0,Se.jsx)(yt,{leftValue:C.v_.state.forcedBlockIds,rightValue:C.BJ.state.forcedBlockIds,setLeftValue:C.v_.updateForcedBlockIds,setRightValue:C.BJ.updateForcedBlockIds,placeholder:"block ids",label:"forced block ids"})]})})]})})})}renderAncestorFilter(e){const{filters:t}=w.ZP.state.query;return(0,Se.jsx)(Z.SearchStoresContext.Consumer,{children:s=>{let{parentStore:r}=s;return(0,Se.jsx)(Me,{mode:e,focused:!1,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In"}),parentStore:r,blockIds:t.ancestors,onMenuDismiss:this.closeAddFilterMenu,onChange:kt("ancestors")})}})}renderCreatedByFilter(e){const{filters:t}=w.ZP.state.query;return(0,Se.jsx)(Z.SearchStoresContext.Consumer,{children:s=>{let{parentStore:r}=s;return(0,Se.jsx)(Te.Z,{mode:e,focused:!1,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.createdBy",defaultMessage:"Created by"}),parentStore:r,userIds:t.createdBy,onMenuDismiss:this.closeAddFilterMenu,onChange:kt("createdBy")})}})}renderCreatedTimeFilter(e){const{filters:t}=w.ZP.state.query;return(0,Se.jsx)(ie.Z,{mode:e,focused:!1,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"}),icon:L.C,value:t.createdTime,onMenuDismiss:this.closeAddFilterMenu,onChange:kt("createdTime")})}renderLastEditedTimeFilter(e){const{filters:t}=w.ZP.state.query;return(0,Se.jsx)(ie.Z,{mode:e,focused:!1,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),icon:L.C,value:t.lastEditedTime,onMenuDismiss:this.closeAddFilterMenu,onChange:kt("lastEditedTime")})}renderInTeamFilter(e){if(!(0,$.bq)())return;const{filters:t}=w.ZP.state.query;return(0,Se.jsx)(Z.SearchStoresContext.Consumer,{children:s=>{let{parentStore:r}=s;return(0,Se.jsx)(Oe,{mode:e,focused:!1,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace"}),parentStore:r,teamIds:t.inTeams,onMenuDismiss:this.closeAddFilterMenu,onChange:kt("inTeams")})}})}}function Ct(e){let{columnStore:t}=e;window.__c={n:"ExperimentColumnShowHeader"};const s=(0,i.VK)((()=>t.state.visible),[t]);return(0,Se.jsx)(ee.Z,{icon:(0,Se.jsx)(se.Z,{checked:s,size:14,onClick:()=>t.update((e=>({...e,visible:!e.visible})))}),focused:!1,title:"Show",onClick:()=>t.update((e=>({...e,visible:!e.visible})))})}function It(e){let{title:t,searchExperimentOverrides:s}=e;return(0,Se.jsx)(ee.Z,{focused:!1,title:t,onClick:()=>{C.BJ.update((e=>({...e,visible:!1}))),C.v_.update((e=>({...e,searchExperimentOverrides:s})))}})}Mt.displayName="SearchFilterMenu";const wt=Mt;function kt(e){return t=>w.ZP.updateFilters({[e]:t})}function jt(){return null}function Pt(){window.__c={n:"ShowDebugInfoToggle"};const e=(0,i.VK)((()=>C.ZP.state.showDebugInfo),[]);return(0,Se.jsx)(Ge,{mode:xe.z.Button,focused:!1,title:"Show debug info",icon:O.S,value:e,onChange:e=>{C.ZP.setState({...C.ZP.state,showDebugInfo:Boolean(e)})}})}function Tt(){window.__c={n:"ShowDebugSearchToggle"};const e=(0,i.VK)((()=>"everything"===C.ZP.state.debug),[]);return(0,Se.jsx)(Ge,{mode:xe.z.Button,focused:!1,title:"Profile query",icon:O.S,value:e,onChange:e=>{C.ZP.setState({...C.ZP.state,debug:e?"everything":void 0})}})}function Rt(e){let{mode:t}=e;window.__c={n:"DeletedOnlyFilter"};const s=(0,i.VK)((()=>w.ZP.state.query.filters),[]);return(0,Se.jsx)(Ge,{mode:t,focused:!1,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.deletedOnlyToggle.label",defaultMessage:"Deleted only"}),icon:q.y,value:s.isDeletedOnly||!1,onChange:kt("isDeletedOnly")})}function Ft(){return(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFiltersSection.title",defaultMessage:"More filters"})}function Bt(e){w.ZP.updateFilters({navigableBlockContentOnly:e})}function Zt(){w.ZP.update((e=>({...e,isDebugSidebarOpen:!1})))}function At(e){let{mode:t}=e;window.__c={n:"TitlesOnlyFilterComponent"};const{filters:s}=(0,i.VK)((()=>w.ZP.state.query),[]);return(0,Se.jsx)(Ge,{mode:t,focused:!1,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Title only"}),icon:N.c,value:s.navigableBlockContentOnly||!1,onChange:Bt})}function _t(e){return{sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 250px",minHeight:400},sidebarHidden:{display:"none"},addFilterButtonMobile:{fontSize:e?U.Z.fontSize.UISmall.mobile:U.Z.fontSize.UISmall.desktop,fontWeight:U.Z.fontWeight.medium,marginRight:-8}}}function Ot(e){const{isMobile:t}=e,s=_t(t);return(0,Se.jsx)(re.Z,{...e,style:s.addFilterButtonMobile,icon:D.I,isBlue:!0,children:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Add filter",id:"search.addFilter.button.label"})})}var Lt=s(28992),Et=s(98519),Dt=s(4023),Vt=s(7931);const qt=function(e){window.__c={n:"SearchSortMenu"};const t=r.useRef(),s=(0,n.Fy)(),{isMobile:i}=s,{activeOption:a,items:l}=r.useMemo((()=>function(e){const{currentSortBy:t,setSortBy:s,sortOptions:r,selectButton:n}=e;let i=r[0];const o=r.map((e=>{const r=t.field,o=`${r}.${"relevance"===r?"":t.direction}`,a=e.key===o;return a&&(i=e),{key:e.key,action:()=>{s(e.sort),n&&n.current&&n.current.closeMenu()},render:t=>(0,Se.jsx)(ee.Z,{...t,title:e.formattedName,right:a&&(0,Et.k)({fill:Xe.ZP.regularIconColor,width:14,height:14})})}}));return{activeOption:i,items:o}}({...e,selectButton:t})),[e,t]),d=(0,o.yK)((e=>({selectedTitle:{color:e.mediumTextColor},label:{marginRight:2,fontSize:i?U.Z.fontSize.UISmall.mobile:U.Z.fontSize.UISmall.desktop,transform:"translateY(0.5px)"},innerButton:{color:e.mediumTextColor,fontWeight:U.Z.fontWeight.semibold,fontSize:i?U.Z.fontSize.UISmall.mobile:U.Z.fontSize.UISmall.desktop,height:20,padding:"2px 4px",marginRight:1,transform:"translateY(0.5px)"},menu:{minWidth:200}})),[i]),c=i?(0,Se.jsx)(z.FormattedMessage,{id:"search.sort.sortMenuTitle",defaultMessage:"Sort By"}):void 0;return(0,Se.jsx)(Vt.Z,{ref:e=>{e&&(t.current=e)},alignmentToOrigin:Dt.v.Start,selectedTitle:(0,Se.jsx)("div",{style:d.selectedTitle,children:a.formattedName}),label:void 0,renderMenuSections:()=>[{key:"searchSortOrder",render:e=>(0,Se.jsx)(ze.Z,{...e,title:c,desktopStyle:d.menu,disableDesktopPadding:!1}),items:l}],labelStyle:d.label,innerButtonStyle:d.innerButton})};const Nt=[{key:"relevance.",formattedName:(0,Se.jsx)(z.FormattedMessage,{id:"search.sort.sortOrder.bestMatches",defaultMessage:"Best matches"}),sort:{field:"relevance"}},{key:"lastEdited.desc",formattedName:(0,Se.jsx)(z.FormattedMessage,{id:"search.sort.sortOrder.lastEdited.newestFirst",defaultMessage:"Last edited: Newest first"}),sort:{field:"lastEdited",direction:"desc"}},{key:"lastEdited.asc",formattedName:(0,Se.jsx)(z.FormattedMessage,{id:"search.sort.sortOrder.lastEdited.oldestFirst",defaultMessage:"Last edited: Oldest first"}),sort:{field:"lastEdited",direction:"asc"}},{key:"created.desc",formattedName:(0,Se.jsx)(z.FormattedMessage,{id:"search.sort.sortOrder.created.newestFirst",defaultMessage:"Created: Newest first"}),sort:{field:"created",direction:"desc"}},{key:"created.asc",formattedName:(0,Se.jsx)(z.FormattedMessage,{id:"search.sort.sortOrder.created.oldestFirst",defaultMessage:"Created: Oldest first"}),sort:{field:"created",direction:"asc"}}],Wt=function(e){let{isPublicPageSearch:t}=e;window.__c={n:"SearchHeader"};const s=(0,n.O7)(),{device:r}=s,i=function(e){return{menuItemMobile:{paddingBottom:0},titleWrapper:{flex:void 0,marginTop:-3,marginBottom:-1},showSidebarButton:()=>{const{device:t}=e;return{padding:"0 4px",fontSize:t.isMobile?U.Z.fontSize.UISmall.mobile:U.Z.fontSize.UISmall.desktop,fontWeight:U.Z.fontWeight.medium,borderRadius:4,height:20,lineHeight:"20px"}}}}(s),o={...r.isMobile&&i.menuItemMobile},a=t?void 0:(0,Se.jsx)(Ut,{});return(0,Se.jsx)(Lt.Z,{title:(0,Se.jsx)(Kt,{}),right:a,textWrapperStyle:i.titleWrapper,style:o})};function Kt(){window.__c={n:"SortMenu"};const e=(0,i.VK)((()=>w.ZP.state.query.sort),[]);return(0,Se.jsx)(qt,{currentSortBy:e,setSortBy:e=>{w.ZP.setState({...w.ZP.state,query:{...w.ZP.state.query,sort:e}})},sortOptions:Nt})}function Ut(){window.__c={n:"AddFilterButton"};const e=(0,n.O7)(),{device:t}=e;return t.isMobile?(0,Se.jsx)(wt,{isMobile:!0,mode:bt.Button}):null}var zt=s(86244),Ht=(s(57658),s(11751)),Gt=s(87531),$t=s(47449),Qt=s(16091),Xt=s(38755),Yt=s(21273),Jt=s(98180),es=s(69327),ts=s(29798),ss=s(88923),rs=s(27724),ns=s(43145),is=s(94184),os=s.n(is),as=s(8597),ls=s(75e3),ds=s(63296),cs=s(64369);function us(e,t){window.__c={n:"SearchActionMenuItem"};const{inline:s,title:r,focused:n,className:i,blueOutlineFocused:a,compact:l,shouldShowArrowUp:d}=e,{icon:c,...u}=e,h=(0,o.yK)((e=>({hoveredStyle:{background:e.buttonHoveredBackground}})),[]),p=(0,o.yK)((e=>({style:{minHeight:36,paddingTop:8,paddingBottom:8,width:l?"min-content":"100%",display:"flex",...a?{boxShadow:e.focusedShadow,borderRadius:6}:{}},textWrapper:{marginLeft:4,alignItems:void 0,flex:void 0,display:"block",textOverflow:"ellipsis",...s&&{alignItems:"baseline"}},icon:{display:"block",flexShrink:0,height:18,width:18,color:e.mediumTextColor,overflow:"visible",marginRight:6},enterIcon:{height:12,width:12,fill:e.mediumIconColor},iconContainer:{overflow:"visible"},compactButtonHover:{background:e.buttonHoveredBackground},compactButton:{borderRadius:44,marginLeft:10,marginRight:10,padding:"6px 12px",display:"inline-flex",boxShadow:a?e.focusedShadow:void 0,maxWidth:"calc(100% - 20px)"},menuItem:{overflow:"hidden"},menuItemTextWrapper:{marginLeft:0,marginRight:0},right:{marginLeft:n?8:void 0,marginRight:2}})),[s,a,n,l]),m={title:r,icon:c?hs(c,p.icon,p.iconContainer):void 0,style:p.style,textWrapperStyle:p.textWrapper,right:d?(0,as.Z)(p.enterIcon):ps(n,p.enterIcon),className:os()("notranslate",i),buttonStyle:{paddingLeft:2,width:l?"min-content":void 0},hoveredStyle:h.hoveredStyle};return l?(0,Se.jsx)(ds.Z,{style:p.compactButton,icon:e=>m.icon,...u,ref:t,hoveredStyle:p.compactButtonHover,children:(0,Se.jsx)(Lt.Z,{title:(0,Se.jsx)("div",{style:p.menuItem,children:r}),textWrapperStyle:p.menuItemTextWrapper,style:p.menuItem,allowTextSelection:void 0,right:n?m.right:void 0,rightStyle:p.right})}):(0,Se.jsx)(ee.Z,{...u,...m,disableTransition:!0,ignoreLocalHoverState:!0,ref:t})}function hs(e,t,s){return(0,Se.jsx)(cs.Z,{style:s,children:e(t)})}function ps(e,t){const s={...t,opacity:e?1:0};return(0,Se.jsx)("div",{style:{display:"flex"},children:(0,ls.U)(s)})}const ms=r.forwardRef(us);var gs=s(18442),fs=s(75024);class vs extends A.Z{constructor(){super(...arguments),this.styles={footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?U.Z.fontSize.UIRegular.mobile:U.Z.fontSize.UIRegular.desktop}},footerWrapper:{flexShrink:0},footerText:{color:this.theme.lightTextColor,fontSize:fs.yv(this.environment,"UISmall"),...U.Z.textOverflowStyle},footerDebugButton:{...xs(this.theme),marginRight:6},debugGearIcon:{color:this.theme.accentColors.gray[400]},hoveredDebugGearIcon:{color:this.theme.accentColors.gray[600]}}}renderComponent(){const e=this.styles;return(0,Se.jsx)("footer",{style:e.footerWrapper,children:(0,Se.jsxs)(ne.Z,{topBorder:!0,style:e.footer(),disableDesktopPadding:!0,children:[(0,Se.jsx)(Lt.Z,{...this.props,style:e.footerText}),(0,W.x)(H.default)&&!w.ZP.state.isDebugSidebarOpen&&(0,Se.jsx)(re.Z,{onClick:()=>w.ZP.setState({...w.ZP.state,isDebugSidebarOpen:!0}),isSmall:!0,style:e.debugGearIcon,hoveredStyle:e.hoveredDebugGearIcon,children:(0,gs.H)({width:12,height:12})})]})})}}vs.displayName="SearchFooterContainer";const xs=e=>({fontSize:12,color:e.lightTextColor,marginLeft:6,paddingRight:4,paddingLeft:4,height:24}),Ss=vs;var ys=s(41892),bs=s(22109),Ms=s(43039),Cs=s(51787),Is=s(47839),ws=s(62134),ks=s(86706),js=s(24042),Ps=s(58261),Ts=s(74420),Rs=s(26388),Fs=s(79623),Bs=s(23075),Zs=s(41393),As=s(70534);function _s(e){window.__c={n:"KeyboardShortcutWithMacIcons"};const{shortcut:t,iconStyles:s,containerStyles:r}=e,n=(0,o.yK)((e=>({container:{display:"flex",gap:3,alignItems:"center",color:e.mediumIconColor,...r},icon:{strokeWidth:.25,overflow:"visible",stroke:e.mediumIconColor,...s}})),[r,s]);return t?(0,Se.jsxs)("div",{style:n.container,children:[t.shift?(0,As.R)(n.icon):void 0,t.control?(0,Bs.d)(n.icon):void 0,t.option?(0,Zs.Z)(n.icon):void 0,t.command?(0,Fs.V)(n.icon):void 0,t.key?1===t.key.length?t.key.toUpperCase():t.key:void 0]}):null}function Os(){window.__c={n:"SearchFooterNavigationHints"};const e=(0,n.O7)(),t=(0,z.useIntl)(),{isQuickSearch:s}=(0,r.useContext)(Z.SearchStaticContext),a=(0,i.VK)((()=>.75*fs.yv(e,"UIRegular")),[e]),l=(0,o.yK)((t=>({listStyle:{...fs.mK,...U.Z.textOverflowStyle,display:"inline-flex",alignItems:"center",fontSize:fs.yv(e,"UISmall"),color:t.lightTextColor,gap:20},upDownIcon:{display:"inline",width:a+2,height:a+2,fill:t.mediumIconColor},enterIcon:{display:"inline",width:a+1,height:a+1,fill:t.mediumIconColor},commandGlyph:{fontSize:.75*fs.yv(e,"UIRegular"),paddingRight:1,color:t.mediumIconColor},inlineHint:{display:"flex",gap:6,alignItems:"center",height:"max-content"},forwardSlash:{fontSize:9,userSelect:"none",fontWeight:500,display:"flex",lineHeight:1.4},toggleSidePeekHotkey:{display:"inline-flex",marginRight:4},icons:{width:a-1,height:a-1,marginTop:.5},keyboardShortcutContainer:{fontSize:fs.yv(e,"UISmall")}})),[e,a]),d=(0,i.VK)((()=>(0,f.rd)(e)),[e]),c=(0,i.VK)((()=>{var t;const r=null===(t=js.Z.state.preferences)||void 0===t?void 0:t.isQuickSearchEnabled;return e.device.isElectron&&r&&(d||s)}),[e.device.isElectron,s,d]),[u,h]=(0,i.VK)((()=>{const t=w.ZP.state.query.text.length>0;return[d&&X.default.checkGate("search_toggle_side_peek")&&t,(0,f.Qi)(e)]}),[e,d]),p=(0,r.useCallback)((()=>{(I.default.state.open||I.default.state.openAsPage)&&Cs.Sn(e,{searchSessionId:I.default.state.sessionId})}),[e]),m=(0,i.VK)((()=>e.device.isMac),[e.device.isMac]),{command:g}=ws.fg(e);return(0,Se.jsxs)("ul",{style:l.listStyle,children:[(0,Se.jsxs)("li",{style:l.inlineHint,children:[(0,bs.T)(l.upDownIcon),t.formatMessage({id:"searchFooter.helpText.selectHint",defaultMessage:"Select"})]}),(0,Se.jsxs)("li",{style:l.inlineHint,children:[(0,ls.U)(l.enterIcon),t.formatMessage({id:"searchFooter.helpText.openHint",defaultMessage:"Open"})]}),s?(0,Se.jsxs)("li",{style:l.inlineHint,children:[m?(0,Se.jsx)(_s,{shortcut:{command:!0,key:"L"},iconStyles:l.icons,containerStyles:l.keyboardShortcutContainer}):(0,Se.jsx)(Ps.Z,{name:"copyLinkToCurrentPage"}),t.formatMessage({id:"searchFooter.helpText.copyLink",defaultMessage:"Copy link"})]}):void 0,c?(0,Se.jsx)("li",{style:l.inlineHint,onClick:()=>{p(),Is.openQuickSearchShortcutSetting()},children:(0,Se.jsx)(Ls,{environment:e,containerStyles:l.inlineHint})}):void 0,d?null:(0,Se.jsxs)("li",{style:l.inlineHint,children:[(0,Se.jsxs)("span",{children:[(0,Se.jsx)("span",{style:l.commandGlyph,children:g}),(0,ls.U)(l.enterIcon)]}),t.formatMessage({id:"searchFooter.helpText.openNewTab",defaultMessage:"Open in a new tab"})]}),u?(0,Se.jsxs)("li",{style:l.inlineHint,children:[(0,Se.jsxs)("span",{style:l.toggleSidePeekHotkey,children:[(0,Se.jsx)("span",{style:l.commandGlyph,children:g}),(0,Se.jsx)("span",{style:l.forwardSlash,children:"\\"})]}),h?t.formatMessage({id:"searchFooter.helpText.closeSidePeek",defaultMessage:"Close preview"}):t.formatMessage({id:"searchFooter.helpText.openSidePeek",defaultMessage:"Preview"})]}):null]})}function Ls(e){window.__c={n:"CommandSearchFooterShortcut"};const{environment:t,containerStyles:s}=e,[n,a]=(0,r.useState)(!1),l=(0,i.VK)((()=>.75*fs.yv(t,"UIRegular")),[t]),d=(0,o.yK)((e=>({container:{...s,cursor:"pointer"},commandSearchHint:{display:"flex",alignItems:"center"},commandText:{padding:"2px 4px",borderRadius:4,background:n?e.buttonHoveredBackground:void 0},hintAndBadgeContainer:{display:"flex",gap:3,alignItems:"center",width:"max-content"},tooltip:{background:"transparent",boxShadow:"none"},icons:{width:l-1,height:l-1,marginTop:.5},keyboardShortcutContainer:{fontSize:fs.yv(t,"UISmall")}})),[s,t,n,l]),c=(0,i.VK)((()=>t.device.isMac),[t.device.isMac]),u=(0,z.useIntl)(),{commandSearchShortcut:h,commandSearchShortcutToString:p}=(0,i.VK)((()=>{var e;const t=null===(e=js.Z.state.preferences)||void 0===e?void 0:e.quickSearchShortcut;if(!t)return{commandSearchShortcut:void 0,commandSearchShortcutToString:void 0};const s=(0,ks.Uy)(t);return{commandSearchShortcut:s,commandSearchShortcutToString:(0,ks.K9)(s,c)}}),[c]),m=(0,r.useCallback)((()=>{(I.default.state.open||I.default.state.openAsPage)&&Cs.Zb(t,{searchSessionId:I.default.state.sessionId})}),[t]);return(0,Se.jsx)(Rs.ZP,{delayThreshold:400,placement:Rs.ug.Bottom,originGap:8,disableTooltip:!c,renderTooltip:()=>(m(),(0,Se.jsx)(Es,{shortcut:p})),closeDelay:0,style:d.tooltip,render:e=>(0,Se.jsxs)("div",{...e,style:d.container,onClick:()=>Is.openQuickSearchShortcutSetting(),onMouseEnter:t=>{e.onMouseEnter&&e.onMouseEnter(t),n||a(!0)},onMouseLeave:t=>{e.onMouseLeave&&e.onMouseLeave(t),n&&setTimeout((()=>{a(!1)}),200)},children:[(0,Se.jsx)("span",{style:d.commandText,children:c?(0,Se.jsx)(_s,{shortcut:h,iconStyles:d.icons,containerStyles:d.keyboardShortcutContainer}):p}),(0,Se.jsx)("div",{style:d.commandSearchHint,children:n?(0,Se.jsx)("span",{children:u.formatMessage({id:"searchFooter.commandSearch.editText",defaultMessage:"Click to edit shortcut"})}):(0,Se.jsxs)("div",{style:d.hintAndBadgeContainer,children:[u.formatMessage({id:"searchFooter.commandSearch.defaultText",defaultMessage:"Command Search"}),(0,Se.jsx)(Ts.Z,{style:{marginLeft:0}})]})})]})})}function Es(e){window.__c={n:"CommandSearchTooltipHelper"};const{shortcut:t}=e,s=ys.Z.images.commandSearch.tooltipPng,[n,i]=(0,r.useState)(!1);(0,r.useEffect)((()=>{const e=new Image;e.src=s,e.onload=()=>{i(!0)}}),[s]);const a=(0,o.yK)((e=>({container:{width:260,borderRadius:8,backgroundColor:"transparent"},textContainer:{whiteSpace:"break-spaces",padding:15,display:"flex",flexDirection:"column",gap:1,backgroundColor:"light"===e.mode?e.accentColors.gray[700]:e.accentColors.gray[300],borderTopRightRadius:8,borderTopLeftRadius:8},description:{fontWeight:U.Z.fontWeight.regular,color:"light"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[600]},image:{width:"100%"}})),[]);return n?(0,Se.jsxs)("div",{style:a.container,children:[(0,Se.jsxs)("div",{style:a.textContainer,children:[(0,Se.jsx)("div",{children:(0,Se.jsx)(z.FormattedMessage,{id:"searchFooter.commandSearch.tooltip.header",defaultMessage:"Use search and Q&A anywhere"})}),(0,Se.jsx)("div",{style:a.description,children:(0,Se.jsx)(z.FormattedMessage,{id:"searchFooter.commandSearch.tooltip.description",defaultMessage:"Try {shortcut} or click on {menuBarIcon} in your menubar to access search and Ask AI anytime, even with Notion minimized.",values:{shortcut:t,menuBarIcon:(0,Se.jsx)(Ds,{})}})})]}),(0,Se.jsx)("img",{style:a.image,src:s})]}):null}function Ds(){window.__c={n:"MenuBarIcon"};const e=(0,o.yK)((e=>({container:{display:"inline-block",position:"relative"},placeholder:{width:15,height:15,display:"inline-block"},flatMenuIcon:{position:"absolute",left:0,top:3,width:15,height:15,fill:"light"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[600]}})),[]);return(0,Se.jsxs)("div",{style:e.container,children:[(0,Se.jsx)("span",{style:e.placeholder}),(0,Ms.m)(e.flatMenuIcon)]})}var Vs=s(49085);function qs(e){var t;let{explanation:s,simple:r=!1,filterZeros:n=!1}=e;return function e(t,s){if(!t)return[];const{value:i,description:o,details:a}=t;if(0===i&&n)return[];const l=(0===i?"0":i.toFixed(4)).padStart(8);function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return`${"  ".repeat(s+t)}${e}`}const c=`[${l}] ${o}`;if(o.startsWith("match on required clause")){return[d(`[${l}] match on required clause ${null==a?void 0:a[1].description}`)]}if(["max of:","sum of:","min of:"].includes(o)&&1===(null==a?void 0:a.length))return e(a[0],s);if(o.startsWith("tf")||o.startsWith("idf")){var u;const e=o.split(",")[0],t=null===(u=o.split(" computed as ")[1])||void 0===u?void 0:u.replace(" from:","");return[d(`[${l}] ${e}: [${(a??[]).map((e=>`${e.description.split(",")[0]}=${e.value}`)).join(" ")}] --\x3e ${t}`)]}if(o.startsWith("ConstantScore(_id:"))return[d(`[${l}] ids query`)];const h=r&&0!==s&&(o.startsWith("weight")||o.startsWith("Function"));return[d(c.replace(", result of:","").replace(" from:","").replace(" [PerFieldSimilarity]","").replace(/:$/,"").trim()),...(h?[]:a??[]).flatMap((t=>e(t,s+1)))]}(null==s||null===(t=s.details)||void 0===t?void 0:t[0],0)}s(75553),s(32240);var Ns=s(94308),Ws=s(58203);s(21862),s(40468);var Ks=s(97820),Us=s(28020),zs=s(69988),Hs=s(98742),Gs=s(98165),$s=s(16402),Qs=s(35057),Xs=s(16011),Ys=s(90403),Js=s(64133),er=s(73063),tr=s(50506),sr=s(86176),rr=s(3043),nr=s(96525);function ir(e){window.__c={n:"SearchBreadcrumbFilterPopup"};const{parent:t,store:s,onClick:i}=e,o=(0,n.O7)(),{device:a}=o;let l;l=a.isMobile?{menuType:g.og.Modal,title:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Breadcrumb",id:"breadcrumb.mobileBreadcrumbMenu.title"}),right:(0,Se.jsx)(R.DoneMenuText,{}),onClickRight:t.close}:{menuType:g.og.Popup,width:240};const d=(0,r.useCallback)((()=>{null==i||i({store:s,action:"include"})}),[i,s]),c=(0,r.useCallback)((()=>{null==i||i({store:s,action:"exclude"})}),[i,s]),u=s instanceof he.zX?"teamspace":"parent page",h={key:"results",render:e=>(0,Se.jsx)(ne.Z,{...e}),items:[{key:"include-filter",render:e=>(0,Se.jsx)(ee.Z,{...e,title:`Add ${u} to filter`}),action:d},{key:"exclude-filter",render:e=>(0,Se.jsx)(ee.Z,{...e,title:`Exclude ${u} from results`}),action:c}]};return(0,Se.jsx)(T.Z,{...l,children:(0,Se.jsx)(Je.Z,{type:Je.i.Vertical,onAccept:t.close,initialFocus:void 0,sections:[h]})})}const or={marginRight:3};class ar extends A.Z{renderComponent(){const{store:e}=this.props,t=e.getTitleStore();var s,r,n;if(t&&t.isReady())return(0,Se.jsx)("div",{style:(s=this.props.isMobile,r=this.theme,n=this.props.style,{display:"flex",alignItems:"center",lineHeight:1.2,fontSize:s?U.Z.fontSize.UIRegular.mobile:U.Z.fontSize.UIRegular.desktop,color:r.text.tertiary,filter:"grayscale(70%)",...n}),className:"notranslate",children:this.renderAncestors()})}renderAncestors(){const{store:e,maxAncestorCount:t}=this.props,s=Gs.uJ(e),r=e.isNavigableBlock()?s.slice(1):[...s];if(r.reverse(),s.reverse(),r.length>t){const[e,n,i]=[r[0],r.slice(1,r.length-t+1),r.slice(r.length-t+1)];if((0,$.bq)()){const t=i.length;return[this.renderButtonForStore({store:e,showDivider:!this.props.isMobile}),(0,Se.jsx)(cr,{isMobile:this.props.isMobile,style:this.props.style,onClick:this.props.onClick,stores:this.props.isMobile?s:n},"blocks-as-popup"),...i.map(((e,s)=>{const r=!this.props.hideCurrentPage||s!==t-1;return e instanceof he.zX?(0,Se.jsx)(rr.Yo,{store:e,showDivider:r,...pr(e,this.props.ancestorMaxWidth,this.props.onClick,this.props.isMobile,this.theme,this.props.iconSize,this.props.highlighter)},e.id):(0,Se.jsx)(rr.Qe,{store:e,showDivider:r,...pr(e,this.props.ancestorMaxWidth,this.props.onClick,this.props.isMobile,this.theme,this.props.iconSize,this.props.highlighter)},e.id)}))]}{const e=r.filter((e=>e instanceof he.G)),s=r.filter((e=>e instanceof he.G)),n=e.length;return[(0,Se.jsx)(rr.Qe,{store:e[0],showDivider:!this.props.isMobile,...pr(e[0],this.props.ancestorMaxWidth,this.props.onClick,this.props.isMobile,this.theme,this.props.iconSize,this.props.highlighter)},e[0].id),(0,Se.jsx)(cr,{isMobile:this.props.isMobile,style:this.props.style,onClick:this.props.onClick,stores:this.props.isMobile?s:e.slice(1,e.length-t+1)},"blocks-as-popup"),...e.slice(e.length-t+1).map(((e,t)=>(0,Se.jsx)(rr.Qe,{store:e,showDivider:!this.props.hideCurrentPage||t!==n-1,...pr(e,this.props.ancestorMaxWidth,this.props.onClick,this.props.isMobile,this.theme,this.props.iconSize,this.props.highlighter)},e.id)))]}}{const e=r.length;return r.map(((t,s)=>this.renderButtonForStore({store:t,showDivider:!this.props.hideCurrentPage||s!==e-1})))}}renderButtonForStore(e){const{store:t,showDivider:s}=e;return t instanceof he.zX?(0,Se.jsx)(rr.Yo,{store:t,showDivider:s,...pr(t,this.props.ancestorMaxWidth,this.props.onClick,this.props.isMobile,this.theme,this.props.iconSize,this.props.highlighter)}):(0,Se.jsx)(rr.Qe,{store:t,showDivider:s,...pr(t,this.props.ancestorMaxWidth,this.props.onClick,this.props.isMobile,this.theme,this.props.iconSize,this.props.highlighter)})}}ar.displayName="SearchPathBreadcrumb";const lr={marginLeft:3,marginRight:3};function dr(e,t,s){const r=t?te.Z4.SlideUp:te.Z4.Popup;return[{key:"results",render:e=>(0,Se.jsx)(ne.Z,{...e}),items:e.map(((e,t)=>({key:e.id,render:n=>(0,Se.jsx)(nr.Z,{...n,stopClickPropagation:!0,popupType:r,renderOrigin:s=>(0,Se.jsx)(me.Z,{...s,isSubpage:0!==t,store:e,hidePath:!0,focused:!1}),render:t=>(0,Se.jsx)(ir,{parent:t,store:e,onClick:s})}),action:()=>{}})))}]}function cr(e){let{stores:t,isMobile:s,style:r,onClick:n}=e;const i={display:"flex",alignItems:"center",flexShrink:0};return(0,Se.jsx)(te.ZP,{popupType:s?te.Z4.SlideUp:te.Z4.Popup,renderOrigin:e=>s?(0,Se.jsxs)(J.Z,{style:i,mobileFeedback:!0,...e,children:[(0,Se.jsx)(rr.fY,{}),(0,Se.jsx)("div",{style:lr,children:"..."}),(0,Se.jsx)(rr.fY,{})]}):(0,Se.jsxs)("div",{style:i,children:[(0,Se.jsx)(re.Z,{isSmall:!0,...e,style:{paddingLeft:2,paddingRight:2,fontSize:null==r?void 0:r.fontSize},children:"..."}),(0,Se.jsx)(rr.fY,{})]}),render:e=>{let r;return r=s?{menuType:g.og.Modal,title:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Breadcrumb",id:"breadcrumb.mobileBreadcrumbMenu.title"}),right:(0,Se.jsx)(R.DoneMenuText,{}),onClickRight:e.close}:{menuType:g.og.Popup,width:240},(0,Se.jsx)(T.Z,{...r,children:(0,Se.jsx)(Je.Z,{type:Je.i.Vertical,initialFocus:void 0,sections:dr(t,s,n)})})}},"pages-popup")}function ur(e,t){return s=>(0,Se.jsx)(ir,{parent:s,store:e,onClick:t})}function hr(e,t){return{lineHeight:1.2,fontSize:e?U.Z.fontSize.UISmall.mobile:U.Z.fontSize.UISmall.desktop,color:t.text.tertiary}}function pr(e,t,s,r,n,i,o){return{maxWidth:t,popupRenderer:ur(e,s),iconSize:i,titleStyle:hr(r,n),iconStyle:or,highlighter:o}}var mr=s(66897),gr=s(95341),fr=s(96895),vr=s(90683);function xr(e){window.__c={n:"SearchResultToolTip"};const{store:t}=e,s=(0,i.VK)((()=>{const e=t.getCreatedByPointer();if(e)return(0,mr.Hl)({pointer:e,getRecordValue:t.getRecordValue})}),[t]),r=(0,i.VK)((()=>{const e=t.getLastEditedByPointer();if(e)return(0,mr.Hl)({pointer:e,getRecordValue:t.getRecordValue})}),[t]),n=(0,o.yK)((e=>({container:{backgroundColor:Xe.FN.light.gray[900],display:"flex",flexDirection:"column",borderRadius:8},preview:{fontSize:14,color:Xe.FN.light.gray[100],fontWeight:400,display:"flex",gap:10,alignItems:"center"}})),[]),a=(0,z.useIntl)();return(0,Se.jsxs)("div",{style:n.container,children:[s&&(0,Se.jsx)(Sr,{store:t,activity:"created",actor:s}),r&&(0,Se.jsx)(Sr,{store:t,activity:"edited",actor:r}),(0,Se.jsxs)("div",{style:{padding:10,display:"flex",justifyContent:"space-between",cursor:"pointer",alignItems:"center"},onClick:()=>I.default.update((e=>({...e,preferSidePeekOpen:!0}))),children:[(0,Se.jsxs)("div",{style:n.preview,children:[(0,Se.jsx)("span",{children:(0,fr.q)({height:14,width:14})}),(0,Se.jsx)("span",{children:a.formatMessage({id:"searchResultMenuItem.tooltip.sidePeek",defaultMessage:"Preview"})})]}),(0,Se.jsx)("div",{style:{color:"#7F7F7F"},children:(0,gr.d)({height:14,width:14})})]})]})}function Sr(e){window.__c={n:"UserActivity"};const{activity:t,actor:s,store:r}=e,n=(0,o.yK)((e=>({container:{display:"flex",flexDirection:"column",padding:"8px 10px 10px 10px",gap:8,borderBottom:`1px solid ${Xe.FN.light.gray[800]}`,minWidth:195},actorAvatarAndName:{display:"flex",alignItems:"center",gap:5},actorActivityInfo:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:10,fontSize:14},description:{color:"#7F7F7F",fontSize:12,fontWeight:600},date:{color:"#7F7F7F",fontSize:12}})),[]),[a]=(0,i.VK)((()=>{const e="created"===t?r.getCreatedTime():r.getLastEditedTime();return[(0,$s.IS)(e,{useCompactFormat:!0,useLowercase:!0})]}),[t,r]),l=(0,z.useIntl)();return(0,Se.jsxs)("div",{style:n.container,children:[(0,Se.jsx)("div",{style:n.description,children:"edited"===t?l.formatMessage({id:"searchResultMenuItem.tooltip.lastEditedBy",defaultMessage:"Last edited by"}):l.formatMessage({id:"searchResultMenuItem.tooltip.createdBy",defaultMessage:"Created by"})}),(0,Se.jsxs)("div",{style:n.actorActivityInfo,children:[(0,Se.jsxs)("div",{style:n.actorAvatarAndName,children:[(0,Se.jsx)("span",{children:(0,vr.a)({actor:s,size:20,style:{}})}),(0,Se.jsx)("span",{children:(0,mr.$4)(l,s)})]}),(0,Se.jsx)("div",{style:n.date,children:a})]})]})}(0,z.defineMessages)({openInSidePeekButtonLabel:{id:"search.result.openInSidePeek.button.label",defaultMessage:"Open search result in side peek"},copySearchResultLinkButtonLabel:{id:"search.result.copyLink.button.label",defaultMessage:"Copy link to search result"}});class yr extends A.Z{constructor(){super(...arguments),this.storeTypes={explanationModalOpen:Vs.default.createClass(!1)},this.debugHitCustomRenderer=e=>{let{data:t,keyPath:s}=e;if(2===s.length&&"_explanation"===s[0])return{element:(0,Se.jsx)(Se.Fragment,{children:(0,Se.jsx)("button",{onClick:e=>{this.stores.explanationModalOpen.setState(!0),e.stopPropagation()},children:"show simplified explanation"})}),expanded:!1};const r=t._ltrlog;if(r)return function(e){const t=Object.keys(e[0])[0],s=e[0][t].map(((e,t)=>{const s=t%2==0?Ir:Cr;return(0,Se.jsxs)("tr",{children:[(0,Se.jsx)("td",{style:s,children:`${t}`}),(0,Se.jsx)("td",{style:s,children:`${e.name}`}),(0,Se.jsx)("td",{style:s,children:`${e.value}`})]},e.name)}));return{element:(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)("div",{children:(0,Se.jsx)("b",{children:`Featureset: ${t}`})}),(0,Se.jsx)("div",{style:wr,children:(0,Se.jsx)("table",{style:kr,children:s})})]}),expanded:!1}}(r);if(!["_score","matched_queries"].every((e=>t[e])))return null;const{_score:n,matched_queries:i}=t;return{element:(0,Se.jsx)(Se.Fragment,{children:`score ${n}, ${(i??[]).length} matched query clauses`}),expanded:!1}}}renderComponent(){const{focused:e,isLastInSection:t,inline:s,className:r}=this.props,n=Zr(this.environment,this.theme,this.props.inline),i=Br(this.theme),o={...n.menuItem,...!s&&!t&&!e&&i.menuItemBorder},a={...n.caption,...i.caption},l={...n.timestamp,...i.timestamp},d={...n.textWrapper,...this.props.inline&&n.inlineTextWrapper},c={title:this.renderTitle(),icon:(0,Se.jsx)(Rr,{store:this.props.store}),caption:this.renderCaption(),body:(0,Se.jsx)(Ar,{result:this.props.result,store:this.props.store,inline:this.props.inline}),right:this.renderRight(),rightStyle:e?void 0:l,dontShrinkRight:!0,captionStyle:a,style:o,spacerStyle:(u=this.props.store,h=this.props.hidePath,h||!(0,sr.L)(u)?jr:void 0),textWrapperStyle:d,className:os()("notranslate",r),buttonStyle:{paddingLeft:2},hoveredStyle:{background:this.theme.tint.regular}};var u,h;const p=X.default.checkGate("search_toggle_side_peek"),m=(0,f.rd)(this.environment)&&p,g=(0,Qs.Mk)()&&!(0,f.Qi)(this.environment)&&!w.ZP.state.isDebugSidebarOpen,v=g&&m&&this.props.focused;return g?(0,Se.jsx)(Rs.ZP,{delayThreshold:50,placement:Rs.ug.Right,originGap:18,renderTooltip:()=>(0,Se.jsx)(Fr,{store:this.props.store}),style:v?n.sidePeekTooltip:n.tooltip,forceVisibleState:!!v||void 0,allowHover:!!v,render:e=>(0,Se.jsx)(ee.Z,{...this.props,...c,disableTransition:!0,...(0,Hs.Z)(this.props,e)}),closeDelay:0}):(0,Se.jsx)(ee.Z,{...this.props,...c,disableTransition:!0,ignoreLocalHoverState:!0})}renderTitle(){var e;const{store:t,result:s,placeholder:r,index:n}=this.props,i=Zr(this.environment,this.theme,this.props.inline),o=Br(this.theme),a=void 0===s,l={...i.title,...!a&&!this.props.focused&&o.nonHighlightedTextColor},d=[];if(s&&s.highlight)if(d.push(...(0,zs.fe)(s.highlight.pathText)),Pr(this.props.result))d.push(...(0,zs.fe)(s.highlight.title));else{he.G.createChildStore(this.props.store,{table:le.iU,id:s.id,spaceId:s.spaceId}).isNavigableBlock()&&d.push(...(0,zs.fe)(s.highlight.text))}const c=this.props.focused?void 0:Nr({words:d},this.environment,this.theme,this.props.inline),u=null===(e=(0,Gs.VP)(t))||void 0===e?void 0:e.isArchived(),h=function(e){if(e)return e.sources.includes(Be.vp.ElasticsearchUniqueID)}(s),p=(0,Us.zj)(),m=p&&p===(null==s?void 0:s.id);const g=(0,Qs.Mk)()&&!m&&!u?function(){function e(e){var t;return null==s||null===(t=s.badges)||void 0===t?void 0:t.find((t=>t.type===e))}for(const t of["is_template","popular_this_week","most_viewed","verified"]){const s=e(t);if(void 0!==s)return{type:s.type,label:s.label}}}():void 0,f={is_template:e=>(0,Se.jsx)(Er,{label:e,inline:this.props.inline}),verified:e=>(0,Se.jsx)(_r,{label:e,inline:this.props.inline}),popular_this_week:e=>(0,Se.jsx)(Or,{label:e,inline:this.props.inline}),most_viewed:e=>(0,Se.jsx)(Lr,{label:e,inline:this.props.inline})};return(0,Se.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",...l},children:[(0,Se.jsxs)("div",{style:i.titleContent,children:[C.ZP.state.showDebugInfo&&void 0!==n&&`${n+1}. `,h&&this.renderUniqueIdHighlight(s),(0,Se.jsx)(ge.Z,{style:l,store:t,placeholder:r,highlighter:c}),!1,u&&(0,Se.jsx)(Dr,{inline:this.props.inline}),m&&(0,Se.jsx)(Vr,{inline:this.props.inline}),g&&f[g.type](g.label)]}),C.ZP.state.showDebugInfo&&(0,Se.jsx)(Tr,{result:this.props.result,index:this.props.index,originalPosition:this.props.originalPosition})]})}renderUniqueIdHighlight(e){var t;const{focused:s}=this.props,r=null==e||null===(t=e.highlight)||void 0===t?void 0:t.uniqueId;if(!r)return;const n="dark"===this.environment.ThemeStore.state.mode,i=Zr(this.environment,this.theme,this.props.inline),o=Nr({words:[r]},this.environment,this.theme,this.props.inline),a=s?n?Xe.FN.dark.translucentGray[300]:Xe.se.light.darkgray.alpha(.09):n?Xe.FN.dark.translucentGray[200]:Xe.se.light.darkgray.alpha(.06);return(0,Se.jsxs)("div",{style:i.uniqueIDBadgeWrapper,children:[(0,Se.jsx)("div",{children:(0,Se.jsx)(Js.Z,{text:r,highlighter:o})}),(0,Se.jsx)("div",{style:{borderRight:`1.5px solid ${a}`,height:14,borderRadius:1}})]})}renderRight(){return(0,Se.jsx)("div",{style:Zr(this.environment,this.theme,this.props.inline).right,children:qr(this.environment,this.theme,this.props.focused,this.props.inline,this.props.store,this.props.type,this.props.lastViewed,this.props.queryId,this.props.result)})}renderCaption(){const{store:e,inline:t,result:s,debugLocal:r,debugHits:n}=this.props,{device:i}=this.environment,o=Nr({words:(0,zs.fe)(s&&s.highlight&&s.highlight.pathText),removeDuplicate:!0},this.environment,this.theme,this.props.inline),a=t||i.isMobile?0:2,l=(n??[]).find((e=>"elasticsearch"===e.type&&void 0!==e._explanation)),d="elasticsearch"===(null==l?void 0:l.type)?null==l?void 0:l._explanation:void 0,c=Boolean(C.ZP.getDebugLevel());return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(sr.Z,{store:e,extraLength:a,showFullPathInTooltip:!0,highlighter:o,enableHoverAncestor:!0,tooltipStyle:Br(this.theme).captionTooltip,tooltipDividerStyle:Br(this.theme).captionTooltipDivider}),(0,Se.jsxs)("div",{ref:this.props.debugAreaRef,children:[r&&(0,Se.jsx)("div",{style:Zr(this.environment,this.theme,this.props.inline).debugArea,children:(0,Se.jsx)(ue.LazyAdminReactJson,{data:{debugLocal:r},defaultCollapsed:!0,customCollapsedRenderers:[Mr],showCopyButton:!1,showModalButton:!1})}),n&&(0,Se.jsx)("div",{style:Zr(this.environment,this.theme,this.props.inline).debugArea,children:(0,Se.jsx)(ue.LazyAdminReactJson,{data:{debugHits:n},defaultCollapsed:!0,customCollapsedRenderers:[this.debugHitCustomRenderer],showCopyButton:"small",showModalButton:!0})}),n&&(null==s?void 0:s.rankingSignals)&&(0,Se.jsx)("div",{style:Zr(this.environment,this.theme,this.props.inline).debugArea,children:(0,Se.jsx)(ue.LazyAdminReactJson,{data:{rankingSignals:s.rankingSignals},defaultCollapsed:!0,showCopyButton:"small",showModalButton:!1})}),c&&(null==s?void 0:s.featureGroups)&&(0,Se.jsx)("div",{style:Zr(this.environment,this.theme,this.props.inline).debugArea,children:(0,Se.jsx)(ue.LazyAdminReactJson,{data:{featureGroups:s.featureGroups},defaultCollapsed:!0,showCopyButton:"small",showModalButton:!1})}),d&&(0,Se.jsx)(tr.Z,{open:this.stores.explanationModalOpen.state,innerStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll",padding:10},onDismiss:()=>{this.stores.explanationModalOpen.setState(!1)},render:()=>(0,Se.jsx)("pre",{children:qs({explanation:d}).join("\n")})})]})]})}shouldComponentUpdate(e,t,s){var r,n;const i=e.focused!==this.props.focused,o=(null===(r=e.result)||void 0===r?void 0:r.highlight)!==(null===(n=this.props.result)||void 0===n?void 0:n.highlight),a=e.isLastInSection!==this.props.isLastInSection;return i||o||a}}yr.displayName="SearchResultMenuItem";const br=yr,Mr=e=>{let{data:t}=e;const s=t;if(!s)return null;const{localSource:r}=s;let n=r;return n||(n=new Set(["unknown"])),{element:(0,Se.jsx)(Se.Fragment,{children:`from ${[...n].join(",")}`}),expanded:!1}},Cr={paddingLeft:5,paddingRight:20,paddingTop:2,paddingBottom:2,border:"1px solid black",color:Xe.FN.dark.green[900]},Ir={...Cr,color:Xe.FN.dark.gray[30]},wr={maxHeight:200,overflowY:"scroll"},kr={border:"1px solid black"};const jr={visibility:"hidden"};function Pr(e){return e&&!e.sources.includes(Be.vp.Local)}function Tr(e){var t;let{result:s,index:r,originalPosition:n}=e;const i=null===(t=(null==s?void 0:s.sources)??[])||void 0===t?void 0:t.flatMap((e=>e===Be.vp.Local?[""]:e===Be.vp.ElasticSearch?[""]:e===Be.vp.Postgres?[""]:e===Be.vp.VectorDBBlock||e===Be.vp.VectorDBCollection?[""]:e===Be.vp.ElasticsearchRandom?[""]:e===Be.vp.ElasticsearchUniqueID?[""]:e===Be.vp.ElasticsearchForcedRecentRecall?[""]:void(0,K.t1)(e))).reverse(),o=[...void 0===r||void 0===n?[" "]:r>n?[""]:r<n?[""]:[],...i].join("").trim();return o?(0,Se.jsx)("span",{children:o}):null}function Rr(e){let{store:t}=e;window.__c={n:"Icon"};const s=(0,i.VK)((()=>t.getIcon()),[t]),r=(0,i.VK)((()=>t.isEmptyPage()),[t]);return(0,Se.jsx)(pe.Z,{disabled:!0,icon:s,isEmptyPage:r,size:20,largeIcon:!1})}function Fr(e){let{store:t}=e;window.__c={n:"TooltipComponent"};const s=(0,n.O7)();return(0,f.rd)(s)?(0,Se.jsx)(xr,{store:t}):(0,Se.jsx)(Xs.Z,{store:t})}function Br(e){return{nonHighlightedTextColor:{color:e.text.secondary},menuItemBorder:{boxShadow:`0 1px 0 ${e.lightDividerColor}`},highlightedText:{color:e.text.primary},enterIcon:{fill:e.icon.secondary},bookmarkedIcon:{fill:e.topbarFavorite},caption:{color:e.text.secondary},captionTooltip:{color:e.text.contrast},captionTooltipDivider:{color:e.text.contrast},timestamp:{color:e.text.tertiary},tooltipTitle:{color:e.text.secondary},tooltipText:{color:e.text.primary},tooltipValue:{color:e.text.tertiary}}}function Zr(e,t,s){return{title:{fontWeight:U.Z.fontWeight.medium,lineHeight:"20px"},titleContent:{display:"flex",...s?{}:{width:0,flexGrow:1}},menuItem:{minHeight:36,paddingTop:e.device.isMobile?12:8,paddingBottom:e.device.isMobile?12:8},textWrapper:{marginLeft:4,alignItems:"center",width:"100%"},inlineTextWrapper:{alignItems:"center"},highlight:{fontWeight:U.Z.fontWeight.medium},vectorHighlight:{fontWeight:U.Z.fontWeight.medium,whiteSpace:"pre-wrap"},rightContentWrapper:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},rightIcon:{height:12,width:12},rightIconButtonIcon:{height:12,width:12},rightIconButtonWrapper:{height:18,width:18,marginRight:6},uniqueIDBadgeWrapper:{display:"flex",gap:8,marginRight:8,alignItems:"center"},caption:{marginTop:1},debugArea:{fontFamily:"monospace"},timestamp:{fontSize:U.Z.fontSize.UISmall.desktop,fontWeight:U.Z.fontWeight.regular},tooltip:{maxWidth:300},sidePeekTooltip:{background:"transparent",boxShadow:"none"},tooltipTitle:{fontWeight:U.Z.fontWeight.medium,fontSize:U.Z.fontSize.UISmall.desktop},tooltipText:{fontWeight:U.Z.fontWeight.medium,fontSize:U.Z.fontSize.UISmall.desktop,marginLeft:0,paddingRight:20},tooltipValue:{fontSize:U.Z.fontSize.UISmall.desktop,fontWeight:U.Z.fontWeight.regular},tooltipMenuItem:{minHeight:20},badge:{background:"light"===t.mode?t.accentColors.blue[30]:t.accentColors.blue[200]},badgeContent:{display:"flex",alignItems:"center",width:"100%"},badgeCaption:{marginLeft:2,color:t.blueColor},grayedOutBadgeCaption:{marginLeft:1},vectorBadge:{background:t.invoiceGreen,color:t.contentBackground},verifiedBadgeIcon:{width:10,height:10,fill:t.blueColor},right:{display:"flex"},collectionTextMatchingProperty:{lineHeight:2,fontSize:12}}}function Ar(e){var t,s;let{result:r,store:a,inline:l}=e;window.__c={n:"PreviewComponent"};const d=(0,o.Fg)(),c=(0,n.O7)(),u=r?he.G.createChildStore(a,{table:le.iU,id:r.id,spaceId:r.spaceId}):void 0,h=(0,i.VK)((()=>null==u?void 0:u.isNavigableBlock()),[u]);if(!r)return null;if(!r.highlight)return null;if(h&&!Pr(r))return null;let p,m;if(r.highlight.text)p=r.highlight.text;else if(r.highlight.collectionText){var g;p=r.highlight.collectionText,m=null==r||null===(g=r.matchedCollectionProperties)||void 0===g?void 0:g.collectionText}if(p=(0,Ws.$B)(p),!p)return null;const f=(0,zs.ZP)(p);let v=!1;if(Pr(r)){const e=e=>e.filter(zs.il).map((e=>e[0].toLowerCase())),t=t=>void 0===t?[]:e((0,zs.ZP)(t)),s=[...new Set([...t(r.highlight.title),...t(r.highlight.pathText)])],n=e=>s.some((t=>t.includes(e)));v=e(f).every((e=>n(e)))}const x=null!==(t=r.sources)&&void 0!==t&&t.includes(Be.vp.VectorDBBlock)||null!==(s=r.sources)&&void 0!==s&&s.includes(Be.vp.VectorDBCollection)?Zr(c,d,l).vectorHighlight:Zr(c,d,l).highlight,{highlightedText:S}=Br(d),y=v?{}:{...x,...S};return(0,Se.jsxs)(Se.Fragment,{children:[void 0!==m&&(0,Se.jsx)(Ks.Z,{propertySchema:m,showIcon:!0,style:Zr(c,d,l).collectionTextMatchingProperty}),(0,Se.jsx)(Js.Z,{text:p,highlighter:{tokenize:e=>(0,zs.Vu)(f),style:y}})]})}function _r(e){let{label:t,inline:s}=e;window.__c={n:"VerifiedBadgeComponent"};const r=(0,o.Fg)(),i=(0,n.O7)();return(0,Se.jsx)(Ys.Z,{style:Zr(i,r,s).badge,content:(0,Se.jsxs)("div",{style:Zr(i,r,s).badgeContent,children:[(0,Ns.f)(Zr(i,r,s).verifiedBadgeIcon),(0,Se.jsx)("div",{style:Zr(i,r,s).badgeCaption,children:t})]})})}function Or(e){let{label:t,inline:s}=e;window.__c={n:"PopularThisWeekBadgeComponent"};const r=(0,o.Fg)(),i=(0,n.O7)();return(0,Se.jsx)(Ys.Z,{style:Zr(i,r,s).badge,content:(0,Se.jsx)("div",{style:Zr(i,r,s).badgeCaption,children:t})})}function Lr(e){let{label:t,inline:s}=e;window.__c={n:"MostViewedBadgeComponent"};const r=(0,o.Fg)(),i=(0,n.O7)();return(0,Se.jsx)(Ys.Z,{style:Zr(i,r,s).badge,content:(0,Se.jsx)("div",{style:Zr(i,r,s).badgeCaption,children:t})})}function Er(e){let{label:t,inline:s}=e;window.__c={n:"IsTemplateBadgeComponent"};const r=(0,o.Fg)(),i=(0,n.O7)();return(0,Se.jsx)(Ys.Z,{content:(0,Se.jsx)("div",{style:Zr(i,r,s).grayedOutBadgeCaption,children:t})})}function Dr(e){let{inline:t}=e;window.__c={n:"IsTeamArchivedBadgeComponent"};const s=(0,o.Fg)(),r=(0,n.O7)();return(0,Se.jsx)(Ys.Z,{content:(0,Se.jsx)("div",{style:Zr(r,s,t).grayedOutBadgeCaption,children:(0,Se.jsx)(z.FormattedMessage,{id:"search.result.archived.badge.text",defaultMessage:"Archived"})})})}function Vr(e){let{inline:t}=e;window.__c={n:"CurrentPageBadgeComponent"};const s=(0,o.Fg)(),r=(0,n.O7)();return(0,Se.jsx)(Ys.Z,{content:(0,Se.jsx)("div",{style:Zr(r,s,t).grayedOutBadgeCaption,children:(0,Se.jsx)(z.FormattedMessage,{id:"search.result.current.page.badge.text",defaultMessage:"Current Page"})})})}function qr(e,t,s,r,n,i,o,a,l){if(e.device.isMobile)return;if(o&&!s)return(0,$s.IS)(o,{useCompactFormat:!0});const d=Zr(e,t,r),c=Br(t),u={...d.rightIcon,...c.enterIcon,opacity:s?1:0};d.rightIconButtonIcon;return(0,ls.U)(u)}function Nr(e,t,s,r){const{words:n,removeDuplicate:i}=e;if(0===n.length)return;const o={...Zr(t,s,r).highlight,...Br(s).highlightedText},a=i?new Set:void 0;return{tokenize:e=>(0,zs.XT)({text:e,patterns:n,uniqueTokenHighlighterContext:a}),style:o}}function Wr(e,t){return{store:e,id:e.id,score:-1,spaceId:e.getSpaceId(),sources:[Be.vp.Local],featureGroups:[],originalPosition:t,serverEventProperties:void 0}}function Kr(e){switch(e){case"today":return(0,Se.jsx)(z.FormattedMessage,{id:"search.recentPagesTimeBuckets.today.text",defaultMessage:"Today"});case"yesterday":return(0,Se.jsx)(z.FormattedMessage,{id:"search.recentPagesTimeBuckets.yesterday.text",defaultMessage:"Yesterday"});case"past_week":return(0,Se.jsx)(z.FormattedMessage,{id:"search.recentPagesTimeBuckets.pastWeek.text",defaultMessage:"Past week"});case"past_30_days":return(0,Se.jsx)(z.FormattedMessage,{id:"search.recentPagesTimeBuckets.past30Days.text",defaultMessage:"Past 30 days"});case"older":return(0,Se.jsx)(z.FormattedMessage,{id:"search.recentPagesTimeBuckets.older.text",defaultMessage:"Older"})}(0,K.t1)(e)}const Ur=function(e){window.__c={n:"SearchDefaultBody"};const{onSelect:t,spaceId:s,extraTopPadding:a}=e,[d,c]=r.useState(!1),[u,h]=r.useState(!1),p=(0,i.qz)(void 0,ts.Z),{section:m,indexLocal:g,indexGlobal:f}=(0,i.VK)((()=>p.state.focus),[p]),v=(0,n.O7)(),x=(0,n.Fy)(),S=(0,o.yK)((e=>({wrapper:{paddingTop:a?8:void 0,width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto"},sectionHeader:{marginBottom:8},section:{marginBottom:18},sectionBorderBottom:{paddingBottom:10,boxShadow:`0 1px 0 ${e.lightDividerColor}`},notionAiLabel:{lineHeight:"20px",fontSize:14,textOverflow:"ellipsis",overflow:"hidden",display:"block",fontWeight:U.Z.fontWeight.medium},notionAiIcon:{fill:e.aiPurpleColor,overflow:"visible"}})),[a]),{defaultBodyFocusedResult:b,isQuickSearch:M}=(0,r.useContext)(Z.SearchStaticContext),C=(0,i.VK)((()=>{const e=ss.default.state,t=ss.default.isCenterPeekOpen()||rs.default.isInPeekRenderer();return e.open&&(t||e.isOpening)?e.target:y.default.state.mainEditorCurrentBlockStore}),[]),I=(0,i.VK)((()=>ce.X4.state.filter((e=>e.pageId!==(null==C?void 0:C.id)))),[null==C?void 0:C.id]),w=(0,i.VK)((()=>Yt.Z.shouldShowSearchMenuItemAskAI(x)),[x]),k=(0,i.VK)((()=>{const{currentUserSettingsStore:e,currentSpaceStore:t,mainEditorCurrentBlockStore:s}=y.default.state;return!!(t&&s&&s.canRead())&&Yt.Z.isQnATooltipsVisible(v.device,e)}),[v.device]);(0,r.useEffect)((()=>()=>{b.setState(void 0)}),[b]);const j=(0,r.useRef)(null),{value:P}=(0,ue.useDependency)(ue.deps.assistant),T=(0,i.VK)((()=>w?[{key:"actionMenuItem.assistant",action:()=>{const{currentUserSettingsStore:e}=y.default.state;e&&(0,$t.CX)(v,{phase:"complete",transactionUserAction:"AiQnaIntroModal.debug.clickTooltipClose",userSettingsStore:e}),Gt.em({environment:v,shouldResetAssistantStore:Jt.Z.wasActiveSessionLastOpenedOutsideOfHistorySavedWindow()}),null==P||P.assistantActions.updateAssistantTimestampsAfterSessionInitialization({environment:v})},render:e=>{const t=null==C?void 0:C.getSpaceStore(),s=t?(0,Xt.rn)(v,t):void 0,r=(0,Se.jsx)("div",{className:"notranslate",style:S.notionAiLabel,children:s?(0,Se.jsx)(z.FormattedMessage,{id:"searchDefaultBody.searchActionMenuItem.askAiInSpace",defaultMessage:"Ask AI in {spaceName}",values:{spaceName:s}}):(0,Se.jsx)(z.FormattedMessage,{id:"searchDefaultBody.searchActionMenuItem.askNotionAi",defaultMessage:"Ask Notion AI about..."})});return k?(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(Qt.gc,{origin:j}),(0,Se.jsx)(ms,{type:"assistant",...e,blueOutlineFocused:!0,ref:j,title:r,icon:e=>(0,Ht.t)({...e,...S.notionAiIcon})})]}):(0,Se.jsx)(ms,{type:"assistant",...e,title:r,icon:e=>(0,Ht.t)({...e,...S.notionAiIcon})})}}]:[]),[w,v,C,k,S,P]),R=(0,i.VK)((()=>{const e={};return I.forEach((t=>{let{pageId:s,visitedAt:r}=t;return e[s]=r})),e}),[I]),F=(0,i.VK)((()=>{const e=new Map;return I.map(((s,r)=>{const n=ce._5(s.visitedAt),i="today"!==n&&"yesterday"!==n,o={result:{key:`${s.store.id}:${r}`,action:e=>t({index:{local:e.indexLocal,global:e.index},event:e.event,selectedResult:Wr(s.store,r),fromSidePeekPanel:!1,actionItemCount:T.length,context:"recent_pages"}),render:e=>(0,Se.jsx)(br,{...e,inline:!x.isMobile,store:s.store,hidePath:!1,lastViewed:i?R[s.store.id]:void 0,buttonStyle:{paddingLeft:1},type:"recent_pages"})},store:s.store};var a;e.has(n)?null===(a=e.get(n))||void 0===a||a.push(o):e.set(n,[o])})),e}),[T.length,x.isMobile,I,t,R]),B=(0,ue.useDependency)(ue.deps.AppTemplates),A=(0,i.VK)((()=>{var e;return null===(e=y.default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.persona}),[]),_=(0,i.VK)((()=>{var e;const t=null===(e=B.value)||void 0===e?void 0:e.templatePickerItems.getSuggestedTemplatesForSearch({persona:A,environment:v}).slice(0,3);return null==t?void 0:t.map(((e,t)=>({key:`${t}:${e.name}`,action:()=>{Gt.IB(v),e.onClick()},render:t=>(0,Se.jsx)(ms,{...t,title:e.name,icon:()=>e.icon,type:"page_result"})})))}),[B,A,v]),O=(0,i.VK)((()=>!(!_||0===_.length)&&"on"===X.default.getEligibleGroup({experimentId:"search_modal_suggested_templates"})),[_]),L=(0,i.VK)((()=>{const e=[];T.length>0&&e.push({key:"actions",items:T,render:e=>(0,Se.jsx)(ne.Z,{title:"Actions",desktopTitleStyle:S.sectionHeader,disableDesktopPadding:!0,style:{...S.section},children:e.children})});for(const[t,s]of F.entries()){const r=Kr(t),n={key:t,items:s.map((e=>e.result)),render:e=>(0,Se.jsx)(ne.Z,{title:r,desktopTitleStyle:S.sectionHeader,disableDesktopPadding:!0,style:S.section,children:e.children})};e.push(n)}return!M&&_&&_.length>0&&O&&e.push({key:"templates",items:_,render:e=>(0,Se.jsx)(ne.Z,{title:(0,Se.jsx)(z.FormattedMessage,{id:"search.templateSuggestions.header",defaultMessage:"Start with a template"}),desktopTitleStyle:S.sectionHeader,disableDesktopPadding:!0,style:S.section,children:e.children})}),e}),[M,T,F,S.section,S.sectionHeader,_,O]),E=(0,r.useCallback)((e=>{const t=()=>{const e=es.Z.getWithoutSubscribing(s),t=e[e.length-1];return null==t?void 0:t.visitedAt},r=l.P2((async()=>{const e=t(),r=v.currentUser.id;if(!r||!e)return;c(!0);const n=await ce.Od(e,{environment:v,userId:r,spaceId:s});c(!1),n||h(!0)}),300);t()&&e<=200&&!d&&!u&&r()}),[u,d,v,s]);(0,r.useEffect)((()=>{var e;if(void 0===m||void 0===g||void 0===f)return;const t=null===(e=L[m])||void 0===e?void 0:e.key;if(t&&"string"==typeof t)if("actions"===t)b.setState({type:"assistant"});else if(ce._k.includes(t)){var s;const e=null===(s=F.get(t))||void 0===s||null===(s=s[g])||void 0===s?void 0:s.store;e&&b.setState({type:"page_result",value:{index:{local:{indexLocal:g,section:m},global:f},selectedResult:Wr(e,f-T.length)}})}}),[T.length,b,f,m,g,F,L]);const D=(0,i.VK)((()=>T.length),[T.length]),V=!x.isMobile&&I.length>0;return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsxs)("div",{style:S.wrapper,children:[(0,Se.jsx)(Je.Z,{store:p,type:Je.i.Vertical,initialFocus:D,disableKeyboardArrowWrap:!0,sections:L,unfocusOnScroll:!0}),(0,Se.jsx)(ns.Z,{onChange:E})]}),V&&(0,Se.jsx)(Ss,{title:(0,Se.jsx)(Os,{})})]})};var zr=s(36308),Hr=s(15157),Gr=s(34859),$r=s(79131),Qr=s(53336),Xr=s(76725),Yr=s(19889),Jr=s(7928);function en(e){window.__c={n:"SearchFilterBarTitle"};const{filterUIName:t}=e,{parentStore:s}=(0,r.useContext)(Z.SearchStoresContext),n=(0,i.VK)((()=>w.ZP.state.query.filters),[]),a=(0,o.yK)((e=>({title:{maxWidth:220,...U.Z.textOverflowStyle}})),[]),d=(0,i.VK)((()=>{switch(t){case"personFilter":return function(e,t){const s=e.createdBy,r=de.default.getIntl(),n=l.oA(s.map((e=>{const s=he.U6.createChildStore(t,{table:Yr.KJ,id:e});return(0,Jr.Nz)(r,s.getModel())})));return(0,Xr.Z)(n,nn)}(n,s);case"teamsFilter":case"dev_notInTeamFilter":return function(e,t){const s=(0,Be.iY)(e.inTeams);if(!s)return[];const r=l.oA(s.map((e=>he.zX.createChildStore(t,{table:Fe.e0,id:e}).getName())));return(0,Xr.Z)(r,nn)}(n,s);case"pageFilter":return on(n,s);case"dateFilter":return function(e){const t=de.default.getIntl(),s=sn(e);if("createdTime"===s)return v._Q(e.createdTime,t);if("lastEditedTime"===s)return v._Q(e.lastEditedTime,t);return""}(n);case"pageFilter":case"dev_notInPageFilter":return on(n,s);case"titleToggle":return[];default:(0,K.t1)(t)}}),[s,t,n]);return(0,Se.jsx)("div",{style:a.title,children:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"{filterName}{colon} {filterOperator} {filterValues}",id:"search.filterBarFilter.title",values:{filterName:tn(t),filterOperator:0===d.length?void 0:rn(t,n),filterValues:d,colon:0===d.length?void 0:":"}})})}function tn(e){switch(e){case"personFilter":return(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.person",defaultMessage:"Created by"});case"teamsFilter":return(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace"});case"pageFilter":return(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In"});case"dateFilter":return(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.date",defaultMessage:"Date"});case"titleToggle":return(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Title only"});case"dev_notInPageFilter":return(0,Se.jsx)(z.FormattedMessage,{id:"[DO NOT TRANSLATE].search.filterMenu.notInPageFilter.label",defaultMessage:"[dev] Not in page"});case"dev_notInTeamFilter":return(0,Se.jsx)(z.FormattedMessage,{id:"[DO NOT TRANSLATE].search.filterMenu.notInTeamFilter.label",defaultMessage:"[dev] Not in teamspace"})}(0,K.t1)(e)}function sn(e){const t=v.VD.createdTime(e.createdTime),s=v.VD.lastEditedTime(e.lastEditedTime);return t?"createdTime":s?"lastEditedTime":void 0}function rn(e,t){switch(e){case"personFilter":case"teamsFilter":case"pageFilter":case"dev_notInPageFilter":case"dev_notInTeamFilter":case"dateFilter":case"titleToggle":return}(0,K.t1)(e)}const nn=e=>", ";function on(e,t){const s=e.ancestors,r=l.oA(s.map((e=>{const s=he.G.createChildStore(t,{table:le.iU,id:e});return s.isDefined()?s.getModel().getRenderTitle({getRecordModel:s.getRecordModel,userTimeZone:(0,ot.r)(),intl:de.default.getIntl()}):""})));return(0,Xr.Z)(r,nn)}var an=s(41558),ln=s(53437),dn=s(14871),cn=s(83264);const un={today:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Today",id:"searchDateFilter.quickActions.today.label"}),pastWeek:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Last 7 days",id:"searchDateFilter.quickActions.last7Days.label"}),pastMonth:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Last 30 days",id:"searchDateFilter.quickActions.last30Days.label"})};function hn(e){let{date:t,onClick:s,onDismiss:r}=e;const n=(0,ot.r)(),i=it.Lg(n),o=i;let a;const l=un[t];"today"===t?a=i:"pastWeek"===t?a=it.Oo(n):"pastMonth"===t?a=it.dj(n):(0,K.t1)(t);return(0,Se.jsx)(ee.Z,{focused:!1,icon:(0,L.C)({height:18,width:18}),title:l,onClick:e=>{s({value:{starting:{type:"date",start_date:a.start_date},ending:{type:"date",start_date:o.start_date}}}),r(e)}})}class pn extends A.Z{constructor(){super(...arguments),this.storeTypes={store:an.Z},this.renderPillButtonOrigin=()=>{const{icon:e,title:t}=this.props,{store:s}=this.stores,r=yn(this.environment,this.theme),{dateFilterType:n}=s.state,i=w.ZP.state.query.filters[n].starting;return(0,Se.jsx)(We.Z,{on:Boolean(i),icon:e(r.pillIcon),title:(0,Se.jsx)("span",{children:t}),onClick:this.handleOriginActivate})},this.renderPopupContents=()=>{const{title:e}=this.props,{store:t}=this.stores;return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsxs)("div",{style:yn(this.environment,this.theme).dateFilterHeader,children:[this.renderOperatorSelect(),(0,Se.jsx)(J.Z,{style:yn(this.environment,this.theme).clearButton,onClick:this.handleClear,children:(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Clear",id:"searchDateFilter.clearButton.label"})})]}),(0,Se.jsxs)("div",{style:yn(this.environment,this.theme).quickDatesWrapper,children:[(0,Se.jsx)(hn,{date:"today",onClick:this.updateTemporary,onDismiss:this.handleMenuClose}),(0,Se.jsx)(hn,{date:"pastWeek",onClick:this.updateTemporary,onDismiss:this.handleMenuClose}),(0,Se.jsx)(hn,{date:"pastMonth",onClick:this.updateTemporary,onDismiss:this.handleMenuClose})]}),(0,Se.jsx)(cn.Z,{title:e,value:this.getCurrentValue(),onUpdate:this.updateTemporary,store:t,onDismiss:this.handleMenuClose,hideDateInputMenuItems:!0})]})},this.handleOriginActivate=()=>{const{disabled:e,onMenuOpen:t}=this.props,{store:s}=this.stores;e||(t&&t(),s.setState({...s.state,isOpen:!0,focus:"starting"}))},this.handleMenuClose=e=>{const{onMenuDismiss:t}=this.props,{store:s}=this.stores,{temporaryDateRange:r,dateFilterType:n}=s.state;v.zD(e)||(gn(n,r),s.setState({...s.state,isOpen:!1}),t&&t())},this.handleClear=()=>{const{store:e}=this.stores,{dateFilterType:t}=e.state;gn(t,{starting:void 0,ending:void 0}),e.clearTemporaryDateRange()},this.updateTemporary=e=>{const{store:t}=this.stores;if(e.error)return;t.setState({...t.state,temporaryDateRange:{...t.state.temporaryDateRange,...e.value}});const{dateFilterType:s,temporaryDateRange:r}=t.state,{starting:n,ending:i}=r;n&&i&&gn(s,{starting:n,ending:i})}}didMount(){this.updateTemporary({value:this.props.value})}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{store:t}=this.stores,s=yn(this.environment,this.theme);return(0,Se.jsx)(ze.Z,{style:s.sectionMenuItem,children:(0,Se.jsx)(P.Z,{capture:t.state.isOpen,onUp:Sn,onDown:Sn,onEnter:Sn,children:(0,Se.jsx)(ln.ZP,{popupType:vn(this.environment),open:t.state.isOpen,origin:this.renderPillButtonOrigin(),render:this.renderPopupContents,onDismiss:this.handleMenuClose,placementToOrigin:ln.ZP.Placement.Bottom,alignmentToOrigin:ln.ZP.Alignment.Start,keepFocus:!0,style:s.popup})})})}updateFilterFromToggle(e){const{value:t}=this.props,{store:s}=this.stores,{dateFilterType:r}=s.state;gn(e,t),e!==r&&(gn(r,{starting:void 0,ending:void 0}),s.setState({...s.state,dateFilterType:e}))}renderOperatorSelect(){const{device:e}=this.environment,{store:t}=this.stores,{dateFilterType:s}=t.state,r={width:190,items:["createdTime","lastEditedTime"],selectedItem:s,getKey:e=>e,onSelect:e=>this.updateFilterFromToggle(e),renderItem:e=>(0,Se.jsx)(ee.Z,{title:fn(e.value),...e}),renderOrigin:t=>(0,Se.jsx)(J.Z,{...t,style:{paddingLeft:2,paddingRight:2,paddingBottom:2,borderRadius:4,flexShrink:0},children:(0,Se.jsxs)("div",{style:{display:"flex",alignItems:"center",...!e.isMobile&&{color:this.theme.mediumTextColor,fill:this.theme.lightIconColor,fontWeight:500,fontSize:13}},children:[(0,Se.jsx)("span",{style:{marginRight:4},children:fn(s)}),(0,Se.jsx)(xn,{})]})})};return(0,Se.jsx)(dn.Z,{...r,mobileActionSheet:!0})}renderMobile(e){const{store:t}=this.stores,s=e===xe.z.Section?this.renderMobileFilterSummary():this.renderMobileButtonOrigin();return(0,Se.jsx)(ln.ZP,{popupType:ln.ZP.PopupType.SlideUp,open:t.state.isOpen,origin:s,render:this.renderPopupContents,onDismiss:this.handleMenuClose,preventScaleTransition:!0})}renderMobileButtonOrigin(){const{icon:e,title:t,disabled:s}=this.props,r=yn(this.environment,this.theme);return(0,Se.jsx)(ee.Z,{disabled:s,focused:!1,icon:e(r.icon),title:t,onClick:this.handleOriginActivate})}renderMobileFilterSummary(){const{title:e,value:t,dateFormat:s,disabled:r,intl:n}=this.props,i=yn(this.environment,this.theme),o=(0,Se.jsxs)("div",{style:i.summary,children:[(0,L.C)(i.iconActiveMobile),v._Q(t,n,s)]});return(0,Se.jsx)(Ue.Z,{disabled:r,onClick:this.handleOriginActivate,onClickClear:this.handleClear,label:e,title:o})}getCurrentValue(){const{store:e}=this.stores,{dateFilterType:t,temporaryDateRange:s}=e.state;return{...w.ZP.state.query.filters[t],...s}}}pn.displayName="SearchGenericDateFilter";const mn=(0,z.injectIntl)(pn);function gn(e,t){w.ZP.updateFilters({[e]:t})}function fn(e){return{lastEditedTime:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),createdTime:(0,Se.jsx)(z.FormattedMessage,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"})}[e]}function vn(e){const{device:t}=e;return t.isMobile?ln.ZP.PopupType.SlideUp:ln.ZP.PopupType.Popup}function xn(){window.__c={n:"OperatorChevron"};const e=(0,n.O7)(),{device:t}=e;return(0,Ye.i)({width:10,height:10,...t.isMobile&&{marginTop:2}})}function Sn(e){e.preventDefault&&e.preventDefault()}function yn(e,t){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},sectionMenuItem:{display:"flex"},icon:{height:14,width:14,fill:"currentColor"},pillIcon:{height:16,width:16,fill:"currentColor",marginRight:6},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},summary:{display:"inline-flex"},quickDatesWrapper:{marginTop:12,boxShadow:`0 1px 0 ${t.regularDividerColor}`,paddingBottom:15,marginBottom:15},clearButton:{color:t.mediumTextColor,fill:t.lightIconColor,fontWeight:500,fontSize:13,paddingLeft:2,paddingRight:2,paddingBottom:2,borderRadius:4,flexShrink:0},dateFilterHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginLeft:12,marginRight:12}}}function bn(e){const t=w.ZP.state.query.sort,s=Nt.find((e=>l.Xy(e.sort,t)))??Nt[0],r="relevance"===s.sort.field?(0,Se.jsx)(z.FormattedMessage,{id:"search.sort.sortOrder.bestMatches.title",defaultMessage:"Sort"}):s.formattedName;return(0,Se.jsx)(We.Z,{disabled:!1,title:r,onClick:e.onClick,icon:(0,bs.T)({width:16,marginRight:6,fill:"currentColor"})})}function Mn(){const e=w.ZP.state.query.sort,t=Nt.findIndex((t=>l.Xy(t.sort,e))),s=[];for(const r of Nt)s.push({key:r.key,render:e=>(0,Se.jsx)(ee.Z,{...e,title:r.formattedName}),action:()=>{w.ZP.setState({...w.ZP.state,query:{...w.ZP.state.query,sort:r.sort}})}});return(0,Se.jsx)(T.Z,{menuType:g.og.Popup,children:(0,Se.jsx)(Je.Z,{type:Je.i.Vertical,initialFocus:t<0?0:t,sections:[{key:"sortOptions",items:s,render:e=>(0,Se.jsx)(ne.Z,{...e,disableDesktopPadding:!0})}]})})}const Cn=function(e){window.__c={n:"SearchSortButton"};const t=(0,o.yK)((()=>({popup:{paddingTop:12,paddingBottom:8}})),[]);return(0,Se.jsx)(te.ZP,{popupType:te.Z4.Popup,renderOrigin:bn,render:Mn,disabled:!1,placementToOrigin:ln.ZP.Placement.Bottom,alignmentToOrigin:ln.ZP.Alignment.Start,style:t.popup,onClick:e.onMenuOpen,onClose:e.onMenuDismiss})},In="SearchFilterSettings";function wn(e){window.__c={n:"SearchFilterBar"};const{isMobile:t}=e,{parentStore:s}=(0,r.useContext)(Z.SearchStoresContext),{handlePopupOpen:a,handlePopupClose:d}=(0,r.useContext)(Z.SearchStaticContext),c=(0,n.O7)(),u=(0,i.VK)((()=>c.currentUser.id),[c]),h=(0,i.VK)((()=>w.ZP),[]),p=(0,i.Kw)(h),m=p.query.filters,g=(0,i.VK)((()=>I.default.state.isPublicPageSearch),[]),f=(0,i.VK)((()=>(0,$.bq)()&&X.default.checkGate("enable_search_team_filter")&&!g),[g]),v=(0,i.VK)((()=>!g),[g]),x=!1,S=(0,o.yK)((e=>({scroller:{display:"flex",alignItems:"center",paddingTop:10,paddingRight:12,paddingBottom:10,paddingLeft:12},barContainer:{display:"flex",alignItems:"center"},scrollerContainer:{position:"relative",flexGrow:0,overflow:"hidden"},draggableList:{display:"flex",flexShrink:0,marginLeft:6},divider:{height:16,width:1,borderRadius:1,backgroundColor:e.stroke.deemphasized}})),[]),y=(0,r.useCallback)((e=>t=>h.updateFilters({[e]:t})),[h]),b=(0,r.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:r}=e;if(v)return(0,Se.jsx)(Te.Z,{mode:xe.z.Pill,focused:!1,title:(0,Se.jsx)(en,{filterUIName:"personFilter"}),parentStore:s,userIds:m.createdBy,onMenuDismiss:t,onMenuOpen:r,onChange:y("createdBy")})}),[v,s,m.createdBy,y]),M=(0,r.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:r}=e;return f&&(0,Se.jsx)(Oe,{mode:xe.z.Pill,focused:!1,title:(0,Se.jsx)(en,{filterUIName:"teamsFilter"}),parentStore:s,teamIds:m.inTeams,onMenuDismiss:t,onMenuOpen:r,onChange:y("inTeams")})}),[s,m.inTeams,y,f]),C=(0,r.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:r}=e;return(0,Se.jsx)(Me,{mode:xe.z.Pill,focused:!1,title:(0,Se.jsx)(en,{filterUIName:"pageFilter"}),parentStore:s,blockIds:m.ancestors,onMenuDismiss:t,onMenuOpen:r,onChange:y("ancestors")})}),[s,m.ancestors,y]),k=(0,r.useCallback)((()=>null),[s,m.dev_excludedPages,y,x]),j=(0,r.useCallback)((()=>null),[s,m.dev_excludedTeams,y,x]),P=(0,r.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:s}=e;return(0,Se.jsx)(mn,{mode:xe.z.Pill,focused:!1,title:(0,Se.jsx)(en,{filterUIName:"dateFilter"}),icon:L.C,value:m.lastEditedTime,onMenuDismiss:t,onMenuOpen:s})}),[m.lastEditedTime]),T=(0,r.useCallback)((()=>!t&&(0,Se.jsx)(Ge,{mode:xe.z.Pill,focused:!1,title:(0,Se.jsx)(en,{filterUIName:"titleToggle"}),icon:zr.V,value:m.navigableBlockContentOnly||!1,onChange:y("navigableBlockContentOnly")})),[m.navigableBlockContentOnly,y,t]);(0,r.useEffect)((()=>{const e=Hr.Z.get({userId:u,key:In});e&&l.Xy(new Set(e.filterOrder),new Set(p.filterBar.order))&&!l.Xy(e.filterOrder,p.filterBar.order)&&e.filterOrder&&h.updateFilterOrder(e.filterOrder)}),[p.filterBar.order,u,h]);const R={onMenuOpen:a,onMenuDismiss:d},F={titleToggle:T(),personFilter:b(R),teamsFilter:M(R),pageFilter:C(R),dateFilter:P(R),dev_notInPageFilter:k(),dev_notInTeamFilter:j()};const B=(0,r.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:s}=e;return(0,Se.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,Se.jsx)(Cn,{onMenuOpen:s,onMenuDismiss:t}),(0,Se.jsx)("div",{style:S.divider})]})}),[S.divider]);return(0,Se.jsx)("div",{style:S.barContainer,children:(0,Se.jsx)("div",{style:S.scrollerContainer,children:(0,Se.jsxs)(Qr.Z,{type:Gr.Z.X,style:S.scroller,showLeftRightOverlay:!1,children:[(0,Se.jsx)(Se.Fragment,{children:B(R)}),(0,Se.jsx)(Se.Fragment,{children:(0,Se.jsx)($r.ZP,{direction:"horizontal",keys:p.filterBar.order,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>F[e],style:S.draggableList,onDrop:e=>function(e){const t={filterOrder:e};Hr.Z.set({userId:u,key:In,value:t}),h.updateFilterOrder(e)}(e)})})]})})})}var kn=s(12457),jn=s(68785),Pn=s(25904),Tn=s(54642),Rn=s(47307),Fn=s(64964),Bn=s(1310),Zn=s(92660);const An=(0,z.defineMessages)({additionalInformationPlaceholder:{id:"SearchBadResultsForm.additionalInformation.placeholder",defaultMessage:"Add feedback..."},submitFailed:{id:"SearchBadResultsForm.submitFailed",defaultMessage:"Failed to submit report"},submitSuccess:{id:"SearchBadResultsForm.submitSuccess",defaultMessage:"Your report has been submitted, thanks!"},title:{id:"SearchBadResultsForm.title",defaultMessage:"Report bad search"},warning:{id:"SearchBadResultsForm.warning",defaultMessage:"The pages from the search results will be sent to Notion for quality improvement"},cancel:{id:"SearchBadResultsForm.cancel",defaultMessage:"Cancel"},submit:{id:"SearchBadResultsForm.submit",defaultMessage:"Submit"},urlPlaceholder:{id:"SearchBadResultsForm.url.placeholder",defaultMessage:"Link to page you were looking for..."}});function _n(){Pn.Z.reset()}const On=e=>{var t;let{searchStoreState:s,currentSpaceStore:r,serverResults:n,localResults:i,environment:o,exposedSearchExperiments:a,traceLogs:l}=e;const d=Pn.Z.getState(),c=v.AX(n),u=v.AX(i),h={query:s.query,limit:s.limit,debug:"everything"},{publicAccessPermissionAncestorBlockId:p}=v.bC(o),m=v.gC({input:h,spaceId:null==r?void 0:r.id,publicAccessPermissionAncestorBlockId:p,source:"report_bad_search"});if(!m)return;const g=null===(t=document.getElementsByClassName("search-results-list")[0])||void 0===t?void 0:t.outerHTML,f="on"===(null==a?void 0:a.get("vector-search-vanilla-ltr"))||c.some((e=>e.sources.includes(Be.vp.VectorDBBlock)||e.sources.includes(Be.vp.VectorDBCollection)));f&&c.splice(0,-20);const x=a?Object.fromEntries(a.entries()):{},S={queryText:s.query.text.trim(),apiRequest:m,serverResults:JSON.stringify(c,null,2),localResults:JSON.stringify(u,null,2),additionalInformation:d.additionalInformation,desiredUrl:d.desiredUrl,renderedHtml:g,experiments:JSON.stringify(x,null,2),isVectorSearchEnabled:f,traceLogs:null==l?void 0:l.log};Tn.reportBadSearch(o,S).then((e=>{"failed"===e.type?Rn.showErrorMessage((0,Se.jsx)("h1",{children:de.default.formatMessage(An.submitFailed)})):Fn.oV({label:de.default.formatMessage(An.submitSuccess),durationMs:Bn.JY})})),Pn.Z.reset()},Ln=function(e){window.__c={n:"ReportBadSearchForm"};const{serverResults:t,localResults:s,exposedSearchExperiments:a,debugInfo:l}=e,d=null==l?void 0:l.traceLogs,{isMobile:c}=(0,n.Fy)(),u=(0,o.yK)((e=>({wrap:{display:"flex",flexDirection:"column",width:c?"min(100%, 600px)":void 0,minHeight:128,maxHeight:c?void 0:"max(calc(100vh - 78px), 300px)"},modalWrap:{width:"32rem",padding:24,fontSize:14,maxWidth:"100%"},modalTitle:{fontSize:16,fontWeight:U.Z.fontWeight.medium},modalWarning:{fontSize:13,color:e.lightTextColor},titleContainer:{marginBottom:12},buttonArea:{display:"flex",justifyContent:"flex-end",marginTop:18,gap:8},outlineButton:{marginRight:12},feedbackArea:{marginTop:17,padding:8}})),[c]),[h]=(0,r.useState)(w.ZP),p=(0,i.VK)((()=>y.default.state.currentSpaceStore),[]),[m,g]=(0,i.AF)(Pn.Z),f=(0,n.O7)(),v=(0,r.useCallback)((()=>{On({searchStoreState:h.state,currentSpaceStore:p,serverResults:t,localResults:s,exposedSearchExperiments:a,environment:f,traceLogs:d})}),[f,h,p,t,s,a,d]);return(0,Se.jsx)(Zn.Z,{onDismiss:_n,render:()=>(0,Se.jsx)(k.Z,{allowMobileAutoScroll:!0,capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:e=>(0,Se.jsx)("div",{style:u.wrap,children:(0,Se.jsxs)("div",{style:u.modalWrap,...e,children:[(0,Se.jsxs)("div",{style:u.titleContainer,children:[(0,Se.jsx)("div",{style:u.modalTitle,children:de.default.formatMessage(An.title)}),(0,Se.jsx)("div",{style:u.modalWarning,children:de.default.formatMessage(An.warning)})]}),(0,Se.jsx)(St.Z,{placeholder:de.default.formatMessage(An.additionalInformationPlaceholder),value:m.additionalInformation,onChange:e=>{g({...m,additionalInformation:e.target.value})},focusInitial:!0,inputStyle:{padding:8},style:u.feedbackArea}),false,(0,Se.jsxs)("div",{style:u.buttonArea,children:[(0,Se.jsx)(ds.Z,{isLarge:!0,onClick:_n,style:u.outlineButton,children:de.default.formatMessage(An.cancel)}),(0,Se.jsx)(ds.Z,{isRed:!0,isLarge:!0,onClick:v,disabledFeedback:!0,children:de.default.formatMessage(An.submit)})]})]})})}),requireOnline:!0,modalStore:Pn.Z})};function En(e){window.__c={n:"ReportBadSearchButton"};const[t,s]=(0,i.AF)(Pn.Z),r=(0,o.yK)((t=>({button:{...xs(t),...e.buttonStyles}})),[e.buttonStyles]);return(0,Se.jsxs)(ds.Z,{style:r.button,onClick:()=>{s({...t,open:!0})},children:[(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Report bad search",id:"search.header.badSearch.button.label"}),(0,Se.jsx)(Ln,{...e})]})}class Dn extends A.Z{constructor(){super(...arguments),this.storeTypes={requestModalOpen:Vs.default.createClass(!1),responseModalOpen:Vs.default.createClass(!1)},this.styles={footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?U.Z.fontSize.UIRegular.mobile:U.Z.fontSize.UIRegular.desktop}},footerText:{fontSize:fs.yv(this.environment,"UISmall"),...U.Z.textOverflowStyle},inlineHint:{display:"inline",marginRight:16},resultCountWrapper:{display:"flex",alignItems:"center",...U.Z.textOverflowStyle},resultCount:{fontWeight:U.Z.fontWeight.medium},resultText:{verticalAlign:"middle",marginRight:6},spinner:{display:"inline",width:12,height:12,verticalAlign:"middle"},keyboardShortcut:{marginRight:4,marginBottom:1,fontVariant:"all-small-caps",fontSize:1.1*fs.yv(this.environment,"UISmall")},commandGlyph:{fontSize:.75*fs.yv(this.environment,"UIRegular")},footerDebugButton:xs(this.theme),debugModalStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll",padding:10},navigationHints:{marginLeft:15}}}renderComponent(){var e;const{localResults:t,serverResults:s}=this.props.searchResultStore.state,{shouldShow:r}=this.props;if(!r)return;const n=this.styles,i={footerText:{color:(o=this.theme).lightTextColor},resultCount:{color:o.mediumTextColor},keyboardShortcut:{color:o.mediumTextColor}};var o;const a={...n.resultCount,...i.resultCount},{count:l,isLowerBound:d}=this.props.searchResultStore.getResultCount(),c=(0,Se.jsx)("span",{style:n.resultText,children:d?this.props.intl.formatMessage({id:"SearchResultsFooter.helpText.resultCountApproximate",defaultMessage:"{resultCount, plural, other {<resultwrapper>{resultCount}+</resultwrapper> results}}"},{resultCount:l,resultwrapper:e=>(0,Se.jsx)("span",{style:a,children:e})}):this.props.intl.formatMessage({id:"SearchResultsFooter.helpText.resultCount",defaultMessage:"{resultCount, plural, one {<resultwrapper>{resultCount}</resultwrapper> result} other {<resultwrapper>{resultCount}</resultwrapper> results}}"},{resultCount:l,resultwrapper:e=>(0,Se.jsx)("span",{style:a,children:e})})}),u=(0,f.rd)(this.environment),h=(0,f.XP)()||u,p=h?(0,Se.jsx)(Os,{}):(0,Se.jsxs)("div",{style:n.resultCountWrapper,children:[h?void 0:(0,Se.jsxs)("div",{children:[c,this.renderSpinner(this.props.showSpinner)]}),(0,Se.jsx)("div",{style:n.navigationHints,children:(0,Se.jsx)(Os,{})})]}),m=!u&&X.default.checkGate("search-show-report-bad-search");return(0,Se.jsx)(Ss,{title:p,right:(0,Se.jsxs)(Se.Fragment,{children:[m&&(0,Se.jsx)(En,{exposedSearchExperiments:null==s||null===(e=s.serverEventProperties)||void 0===e?void 0:e["server-searchExperiments"],localResults:null==t?void 0:t.results,serverResults:null==s?void 0:s.results,debugInfo:null==s?void 0:s.debugInfo}),this.renderSearchDebugButtons()]})})}renderSpinner(e){const t=this.styles;return(0,Se.jsx)(kn.Z,{show:e,showDelay:500,showHold:200,render:e=>e&&(0,Se.jsx)(jn.Z,{style:t.spinner})})}renderSearchDebugButtons(){var e;if(!C.ZP.state.debug&&!C.ZP.state.showDebugInfo)return;const{rawRequests:t,rawResponses:s}=(null===(e=this.props.searchResultStore.state.serverResults)||void 0===e||null===(e=e.debugInfo)||void 0===e?void 0:e.response)||{};return(0,Se.jsxs)(Se.Fragment,{children:[t&&(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(tr.Z,{open:this.stores.requestModalOpen.state,innerStyle:this.styles.debugModalStyle,onDismiss:()=>{this.stores.requestModalOpen.setState(!1)},render:()=>(0,Se.jsx)(ue.LazyAdminReactJson,{showCopyButton:"large",defaultCollapsed:!1,data:t})}),(0,Se.jsx)(ds.Z,{style:this.styles.footerDebugButton,onClick:()=>this.stores.requestModalOpen.setState(!0),children:"Open Request"})]}),s&&(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(tr.Z,{open:this.stores.responseModalOpen.state,innerStyle:this.styles.debugModalStyle,onDismiss:()=>{this.stores.responseModalOpen.setState(!1)},render:()=>(0,Se.jsx)(ue.LazyAdminReactJson,{showCopyButton:"large",data:{rawResponses:s},defaultCollapsed:!1})}),(0,Se.jsx)(ds.Z,{style:this.styles.footerDebugButton,onClick:()=>this.stores.responseModalOpen.setState(!0),children:"Open Response"})]})]})}}Dn.displayName="SearchResultsFooter";const Vn=(0,z.injectIntl)(Dn);var qn=s(73935),Nn=s(36896),Wn=s(44604),Kn=s(36596),Un=s(43765),zn=s(39634),Hn=s(16354);const Gn=function(e){window.__c={n:"ErrorMenuItem"};const{style:t,captionStyle:s,title:r,caption:i}=e,o=(0,n.O7)(),a=Xn(o),l={...a.menuItem,...t},d={...a.caption,...s};return(0,Se.jsx)(Lt.Z,{...e,title:(0,Se.jsx)(Yn,{title:r}),caption:(0,Se.jsx)(Qn,{caption:i,captionStyle:d}),textWrapperStyle:Xn(o).text,style:l,captionStyle:d})};function $n(e){return{title:{color:e.mediumTextColor},caption:{color:e.lightTextColor}}}function Qn(e){let{captionStyle:t,caption:s}=e;window.__c={n:"CaptionComponent"};const r=(0,o.Fg)();if(!s)return null;const n={...t,...$n(r).caption};return(0,Se.jsx)("div",{style:n,children:s})}function Xn(e){return{menuItem:{minHeight:void 0,...e.device.isMobile&&{background:void 0,boxShadow:void 0},paddingTop:32,paddingBottom:32},text:{textAlign:"center"},title:{margin:0,fontWeight:U.Z.fontWeight.medium,fontSize:fs.yv(e,"UIRegular"),lineHeight:fs.Dp(e,"UIRegular")},caption:{fontSize:fs.yv(e,"UIRegular")}}}function Yn(e){let{title:t}=e;window.__c={n:"TitleComponent"};const s=(0,o.Fg)(),r=(0,n.O7)();if(!t)return null;const i=Xn(r),a=$n(s),l={...i.title,...a.title};return(0,Se.jsx)("div",{role:"alert",style:l,children:t})}const Jn=(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"No results",id:"searchErrorMenuItem.error.noResults"});const ei=function(e){window.__c={n:"SearchErrorMenuItem"};const t=(0,o.yK)((e=>({menuItem:{marginTop:"auto",marginBottom:"auto"},caption:{marginTop:"auto"},reportProblemButton:{display:"inline",color:e.blueColor},searchDeletedButton:{display:"inline",lineHeight:"25px",color:e.blueColor}})),[]),s=(0,n.O7)(),{isQuickSearch:a}=(0,r.useContext)(Z.SearchStaticContext),l=()=>{zn.j({environment:s,from:"quick_find"})};function d(s){const r=function(s){if(s)return;const r=v.FN(c);if(!v.VD.isDeletedOnly(c.isDeletedOnly))return(0,Se.jsx)(z.FormattedMessage,{id:"searchErrorMenuItem.errorPrompt.searchDeleted",defaultMessage:"Some results may be in your deleted pages.{br}<searchdeleted>Search deleted pages</searchdeleted>",values:{searchdeleted:s=>(0,Se.jsx)(Hn.Z,{onClick:e.handleSearchDeletedOnly,style:t.searchDeletedButton,children:s}),br:(0,Se.jsx)("br",{})}});return r?(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Try different search terms or filters",id:"searchErrorMenuItem.errorPrompt.searchTermsAndFilters"}):(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Try different search terms",id:"searchErrorMenuItem.errorPrompt.searchTerms"})}(s);return{title:Jn,caption:r}}const c=(0,i.VK)((()=>w.ZP.state.query.filters),[]);return(0,Se.jsx)(Gn,{...function(s){const r=e.error;switch(r.type){case Be.Ix.NoResults.type:return d(s);case Be.Ix.Offline.type:return function(){const e=(0,Se.jsx)(z.FormattedMessage,{defaultMessage:"Go online for more results.",id:"searchErrorMenuItem.errorPrompt.goOnline"});return{title:Jn,caption:e}}();case Be.Ix.RequestFailed.type:return{title:(0,Se.jsx)(z.FormattedMessage,{id:"searchErrorMenuItem.error.genericErrorMessage",defaultMessage:"Something went wrong"}),caption:(0,Se.jsx)(z.FormattedMessage,{id:"searchErrorMenuItem.errorPrompt.refreshOrReport",defaultMessage:"Try refreshing or <reportlink>report a problem</reportlink>.",values:{reportlink:e=>(0,Se.jsx)(Hn.Z,{onClick:l,style:t.reportProblemButton,children:e})}})};default:(0,K.t1)(r)}}(a??!1),style:t.menuItem,captionStyle:t.caption,shouldWrapCaption:!0})};const ti=8;function si(e){window.__c={n:"SearchResultShimmers"};const{numberOfShimmerResults:t,assistantActionsEnabled:s}=e,r=t===ti&&s,n=(0,o.yK)((e=>({container:{margin:(r?"0px":"8px")+" 10px 6px 10px",display:"flex",flexDirection:"column",gap:10},icon:{width:20,height:20,borderRadius:5,marginLeft:6},titleAndPath:{width:"100%",display:"flex",flexDirection:"column",gap:5},title:{height:18,borderRadius:5},path:{height:12,borderRadius:5},resultContainer:{display:"flex",gap:10,boxShadow:`0 1px 0 ${e.lightDividerColor}`,paddingBottom:10},sectionHeader:{marginBottom:7,marginTop:8}})),[r]),i=Array.from({length:t},(()=>!0));return(0,Se.jsxs)("div",{children:[r&&(0,Se.jsx)(ne.Z,{desktopTitleStyle:n.sectionHeader,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.searchResultsShimmer.bestMatches.text",defaultMessage:"Best matches"})}),(0,Se.jsx)("div",{style:n.container,children:i.map(((e,t)=>(0,Se.jsxs)("div",{style:{...n.resultContainer,...t===i.length-1&&{boxShadow:"none"}},children:[(0,Se.jsx)(Kn.Z,{style:n.icon}),(0,Se.jsxs)("div",{style:n.titleAndPath,children:[(0,Se.jsx)(Kn.Z,{style:{...n.title,width:l.UP(["30%","45%","55%","60%","70%","75%","80%","90%"])}}),(0,Se.jsx)(Kn.Z,{style:{...n.path,width:l.UP(["10%","15%","20%","25%","30%","35%","55%","70%"])}})]})]},`shimmer-item-${t}`)))})]})}const ri=r.memo(si);function ni(e,t,s){if(!t.isLoading)return t.showMajorError?(0,Se.jsx)(ei,{error:t.serverError,handleSearchDeletedOnly:()=>{const t=w.ZP.state.query.text;Gt.IB(e),Nn.Z.setState({...Nn.Z.state,open:!0}),Wn.Z.setState({...Wn.Z.state,currentTab:"all_pages",filter:t,limit:Wn.Z.startLimit})}}):t.serverError&&t.serverError!==Be.Ix.NoResults?function(e,t){return(0,Se.jsx)(ne.Z,{disableMobilePadding:!0,disableMobileBorders:!0,children:(0,Se.jsx)(Un.Z,{title:e,style:t})})}(t.serverError.message,s):void 0}function ii(e,t){return(0,Se.jsx)(ne.Z,{disableMobilePadding:!0,disableMobileBorders:!0,topBorder:!1,style:{marginTop:0,paddingTop:0},children:(0,Se.jsx)(Lt.Z,{body:e,bodyStyle:t})})}const oi=(0,z.injectIntl)((function(e){var t,s,a,d,c,u,h;window.__c={n:"SearchResultsMenuList"};const[m,g]=(0,r.useState)(!1),x=(0,n.Fy)().isMobile,S=(0,o.yK)((e=>({results:{flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%"},messageMenuItem:{...x&&{background:void 0,boxShadow:void 0}},debugMessageMenuItemTextStyle:{whiteSpace:"pre-wrap",fontFamily:"monospace",marginTop:0},actionMenuItemTitle:{fontWeight:U.Z.fontWeight.medium,lineHeight:"20px",fontSize:15,color:e.mediumTextColor,textOverflow:"ellipsis",overflow:"hidden",display:"block"},menuListContainer:{display:"flex",flexDirection:"column",gap:12,marginTop:x?13:void 0,marginBottom:4}})),[x]),{searchResultStore:y,localResults:b,serverResults:M,resultListStore:I,searchExperimentOverrides:k,intl:j,showActions:P,extraTopPadding:T}=e,R=e.errorState,F=(0,i.VK)((()=>w.ZP.state.query.text),[]),{focusedIndexStore:B}=(0,r.useContext)(Z.SearchStaticContext),A=(0,i.VK)((()=>{var e;return null===(e=B.state)||void 0===e?void 0:e.global}),[B]),_=(0,i.VK)((()=>P.length),[P]),O=_>0?{key:"actions",render:e=>(0,Se.jsx)(ne.Z,{...e,shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,extraTopPadding:T,title:(0,Se.jsx)(z.FormattedMessage,{id:"search.searchActions.actions.text",defaultMessage:"Actions"}),titleClassName:p.Xjk}),items:l.oA(P.map(((e,t)=>function(e){const{type:t,title:s,icon:r,action:n,shouldShowArrowUp:i}=e;return{key:`actionMenuItem.${t}`,action:n,render:e=>(0,Se.jsx)(ms,{type:t,...e,title:s,icon:r,shouldShowArrowUp:i})}}({...e,title:e.renderTitle(F,j,S.actionMenuItemTitle),shouldShowArrowUp:void 0!==e.shouldShowArrowUp&&e.shouldShowArrowUp({currentGlobalFocusedIndex:A,actionItemCount:_})}))))}:void 0,L=(0,i.VK)((()=>(0,f.XP)()),[]),E=(0,v.IV)({intentBasedGrouping:L,localResults:b,serverResults:M}),{allSearchResults:D}=E,V=(0,r.useCallback)((t=>{const{results:s,sectionTitle:n,compact:i,rendersTimeSinceLastViewedMs:o}=t,{id:a,title:d}=function(e){if(!e)return{id:"allSearchResults",title:void 0};switch(e.type){case"unique-id":return{id:"uniqueIdSearchResults",title:(0,Se.jsx)(z.FormattedMessage,{id:"search.searchResultBuckets.uniqueID.text",defaultMessage:"ID matches"})};case"jump-back-in":return{id:"jumpBackInSearchResults",title:(0,Se.jsx)(z.FormattedMessage,{id:"search.searchResultBuckets.topResults.text",defaultMessage:"Top results"})};case"server":return{id:"serverOnlySearchResults",title:(0,Se.jsx)(z.FormattedMessage,{id:"search.searchResultBuckets.server.text",defaultMessage:"{count}{maybeLowerBoundSign} results",values:{count:e.values.count,maybeLowerBoundSign:e.values.isLowerBound?"+":""}})};case"main":return{id:"mainSearchResults",title:(0,Se.jsx)(z.FormattedMessage,{id:"search.searchResultBuckets.bestMatches.text",defaultMessage:"Best matches"})};default:(0,K.t1)(e)}}(n);return s.length>0?{key:a,render:e=>(0,Se.jsx)(ne.Z,{...e,shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,title:d,titleClassName:p.Xjk}),items:l.oA(s.map(((t,s)=>{var n,a;return function(e){var t;const{selectedResult:s,index:n,actionItemCount:i,allSearchResults:o,props:a,compact:l,timeSinceLastViewedMs:d}=e,{store:c}=s,u=c.isNavigableBlock()?c:c.getNavigableBlockStore();if(!u)return;const h=r.createRef(),m=Boolean(C.ZP.getDebugLevel()),g=m&&s.sources.includes(Be.vp.Local)?{score:s.score,frecencyScore:s.frecencyScore,localSource:s.localSource,personalizationBoost:s.personalizationBoost,id:s.id,terms:s.terms}:void 0,f=m&&(s.sources.includes(Be.vp.ElasticSearch)||s.sources.includes(Be.vp.VectorDBBlock)||s.sources.includes(Be.vp.VectorDBCollection))?null===(t=a.debugInfo)||void 0===t||null===(t=t.response)||void 0===t?void 0:t.resultsDebugMap[c.id]:void 0,v=a.clusterInfo,x=Date.now();return{key:`${c.id}:${n}`,action:e=>{const{event:t}=e;function r(e){const s=qn.findDOMNode(e.current);return Boolean(s&&"target"in t&&t.target&&(s===t.target||s.contains(t.target)))}h.current&&r(h)||a.handleSelectResult({event:e.event,index:{local:e.indexLocal,global:e.index},selectedResult:s,allSearchResults:o,fromSidePeekPanel:!1,actionItemCount:i,context:"query_results"})},render:e=>{var t;return(0,Se.jsx)(br,{...e,index:n,originalPosition:s.originalPosition,isFirstInSection:0===n,store:u,hidePath:!1,result:s,className:p.ulv,debugLocal:g,debugHits:f,debugAreaRef:h,clusterInfo:v,inline:l&&!m,inlineCaptionMinWidthPercentage:20,lastViewed:d?x-d:void 0,queryId:null===(t=s.serverEventProperties)||void 0===t?void 0:t["server-queryId"],type:"query_results"})}}}({selectedResult:t,index:s,actionItemCount:(null==O||null===(n=O.items)||void 0===n?void 0:n.length)??0,allSearchResults:D,props:e,compact:i,timeSinceLastViewedMs:o&&null!==(a=t.localSource)&&void 0!==a&&a.has("recentVisit")?t.timeSinceLastViewedMs:void 0})})))}:void 0}),[null==O||null===(t=O.items)||void 0===t?void 0:t.length,D,e]),q=(0,i.VK)((()=>V({results:"intent-based-grouping"===E.type?E.sections.jumpBackInSearchResults:[],sectionTitle:{type:"jump-back-in"},compact:!0,rendersTimeSinceLastViewedMs:!0})),[V,E.sections,E.type]),N=(0,i.VK)((()=>{const e="intent-based-grouping"===E.type?E.sections.serverOnlySearchResults:[],{count:t,isLowerBound:s}=y.getResultCount();return V({results:e,sectionTitle:{type:"server",values:{count:t,isLowerBound:s}},compact:!1})}),[V,E.sections,E.type,y]),W=(0,i.VK)((()=>V({results:"uniqueIdSearchResults"in E.sections?E.sections.uniqueIdSearchResults:[],sectionTitle:{type:"unique-id"},compact:!1})),[V,E.sections]),H=(0,i.VK)((()=>V({results:"unique-id"===E.type?E.sections.nonUniqueIdSearchResults:"all"===E.type?E.sections.allSearchResults:[],sectionTitle:"unique-id"===E.type||((null==O?void 0:O.items)??[]).length>0?{type:"main"}:void 0,compact:!1})),[null==O?void 0:O.items,V,E.sections,E.type]),G=[O,q,W,N,H].filter(K.$K),$=null===(s=e.debugInfo)||void 0===s||null===(s=s.response)||void 0===s?void 0:s.parsedQueries,Q=null===(a=e.debugInfo)||void 0===a||null===(a=a.response)||void 0===a?void 0:a.detectedLanguages,X=null===(d=e.debugInfo)||void 0===d?void 0:d.traceLogs,Y=null===(c=e.debugInfo)||void 0===c||null===(c=c.response)||void 0===c?void 0:c.debugUrls,J=(0,r.useCallback)(((t,s)=>{const{onMaybeLoadMoreResults:r}=e,n=t<=200;n&&!m&&r(),g(n),s.offsetFromTop&&w.ZP.update((e=>({...e,hasScrolled:!0})))}),[m,e]),ee=0===((null==b?void 0:b.length)??0)&&"serverError"in R&&"NoResultsFound"===(null===(u=R.serverError)||void 0===u?void 0:u.type)?0:(null==O||null===(h=O.items)||void 0===h?void 0:h.length)??0,te=(0,i.VK)((()=>Yt.Z.showSearchAiFeatures()),[]),se=(0,n.O7)(),re=(0,i.VK)((()=>{const e=void 0===M;if(!(e&&(te||(0,f.rd)(se))))return 0;const t=y.state.serverResultsLoading,s=(null==b?void 0:b.length)??0,r="serverError"in R&&void 0!==R.serverError;return(e&&!t||t)&&!r?ti-s:0}),[se,y,null==b?void 0:b.length,M,R,te]);return(0,Se.jsx)(Z.SearchStaticContext.Consumer,{children:e=>{let{queryResultsSectionRef:t}=e;return(0,Se.jsxs)("section",{style:S.results,ref:t,children:[!l.xb(k)&&ii((0,Se.jsx)(Se.Fragment,{children:(0,Se.jsx)(ue.LazyAdminReactJson,{data:{searchExperimentOverrides:k},showCopyButton:!1,showModalButton:!1,defaultCollapsed:!1})}),S.debugMessageMenuItemTextStyle),$&&ii((0,Se.jsx)(ue.LazyAdminReactJson,{data:{parsedQueries:$},customCollapsedRenderers:[ui],showCopyButton:"small",showModalButton:!0,defaultCollapsed:!0}),S.debugMessageMenuItemTextStyle),Q&&ii((0,Se.jsx)(ue.LazyAdminReactJson,{data:{detectedLanguages:Q},customCollapsedRenderers:[di]}),S.debugMessageMenuItemTextStyle),X&&ii((0,Se.jsx)(ue.LazyAdminReactJson,{data:{tracer:{traceLogs:X}},customCollapsedRenderers:[li],defaultCollapsed:!0}),S.debugMessageMenuItemTextStyle),Y&&ii((0,Se.jsx)(ue.LazyAdminReactJson,{data:{debugUrls:Y},defaultCollapsed:!0,customCollapsedRenderers:[pi],showCopyButton:"small",showModalButton:!0,maxLinkValueLength:40}),S.debugMessageMenuItemTextStyle),G&&(0,Se.jsx)("div",{className:"search-results-list",children:(0,Se.jsx)(Je.Z,{type:Je.i.Vertical,initialFocus:ee,store:I,disableKeyboardArrowWrap:!0,sections:G,style:S.menuListContainer})}),ni(se,R,S.messageMenuItem)||(0,Se.jsx)(ns.Z,{onChange:J}),re>0&&(0,Se.jsx)(ri,{numberOfShimmerResults:re,assistantActionsEnabled:te})]})}})}));function ai(e){const t=e.replaceAll(/\(MatchNoDocsQuery\("Matching no documents because no terms present"\)\)\^[0-9\.]/g,"").replaceAll(/MatchNoDocsQuery\("Matching no documents because no terms present"\)/g,"").replaceAll(/ConstantScore\(([^)]+):([^)]+)\)/g,"<i>$1</i>:<b>$2</b>").replace(/function score \(\((.*)\), functions:.*\)/,"$1").replaceAll("( ","(").replaceAll(" )",")").replaceAll("|","| <br/>").replaceAll(/([^( ]+):"([^"]+)"/g,'<i>$1</i>:<b>"$2"</b>').replaceAll(/([^( ]+):([^) ]+)/g,"<i>$1</i>:<b>$2</b>");return(0,Se.jsx)("span",{dangerouslySetInnerHTML:{__html:t}})}const li=e=>{let{data:t,keyPath:s}=e;if("traceLogs"===(null==s?void 0:s[0])&&l.PO(t)&&Array.isArray(t.log)&&t.log.length>0){const{log:e,startTimeMs:s}=t;return{element:(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)("div",{children:(0,Se.jsx)("b",{children:`Trace started at ${s}`})}),e.map(((e,t)=>(0,Se.jsxs)("div",{children:[(0,Se.jsx)("span",{style:hi,children:`[${e.timestamp-s}ms][${e.callerFileName.split(".")[0]}]`}),(0,Se.jsx)("span",{children:`${e.msg}`})]},t)))]}),expanded:!1}}return null},di=e=>{let{data:t,keyPath:s}=e;return"detectedLanguages"===s.join(".")&&l.PO(t)?{element:(0,Se.jsx)(Se.Fragment,{children:Object.entries(t).filter((e=>{let[t,s]=e;return Boolean(s)})).map((e=>{let[t]=e;return t})).join(", ")||"None"}),expanded:!1}:null},ci=["type","description","time_in_nanos"],ui=e=>{var t,s;let{data:r,keyPath:n}=e;const i=r,o=Object.values(i).find((e=>void 0!==e));if(!o)return null;if(!ci.every((e=>o[e])))return null;if(1===n.length)return{element:ai(o.description),expanded:!1};let a=o.description??"";return null!==(t=a)&&void 0!==t&&t.includes("permissions.teamIds")&&(a="PermissionsQuery"),null!==(s=a)&&void 0!==s&&s.includes("(_id:[")&&(a="BoostRecentPageIds"),{element:ai(a),expanded:!1}},hi={color:"blue"},pi=e=>{let{data:t}=e;const s=t;if(!s)return null;const r=Object.values(s).find((e=>{let{clusterName:t}=e;return void 0!==t}));if(r){const{clusterName:e}=r;return{element:(0,Se.jsx)(Se.Fragment,{children:e}),expanded:!1}}return{element:(0,Se.jsx)(Se.Fragment,{children:"unknown"}),expanded:!1}};const mi=function(e){window.__c={n:"SearchResultsBody"};const{searchResultStore:t,sxsMode:s,searchDebugColumnStore:a,extraTopPadding:l}=e,d=(0,n.O7)(),c=(0,n.Fy)(),u=(0,o.yK)((e=>({container:{display:"flex",flexDirection:"column",width:s?"50%":"100%",flex:1,overflow:"hidden"},askAiLabel:{color:e.regularTextColor,fontWeight:U.Z.fontWeight.medium,fontSize:14},askAiQuery:{fontWeight:U.Z.fontWeight.regular},askAiIcon:{fill:e.aiPurpleColor}})),[s]),h=(0,i.qz)(void 0,ts.Z),p=(0,i.VK)((()=>h.state.focus),[h]),{handleSelectSearchResult:m,focusedIndexStore:g,searchActionItemsStore:x}=(0,r.useContext)(Z.SearchStaticContext),{localResults:S,serverResults:y,clusterInfo:b,debugInfo:M,serverResultsLoading:I,searchExperimentOverrides:k,hasPublicAccessPermission:j,errorState:P,serverResultsAllLoaded:T}=(0,i.VK)((()=>{var e,s;const{hasPublicAccessPermission:r}=v.bC(d);return{localResults:t.state.localResults,serverResults:t.state.serverResults,serverResultsLoading:t.state.serverResultsLoading,clusterInfo:null===(e=t.state.serverResults)||void 0===e?void 0:e.clusterInfo,debugInfo:null===(s=t.state.serverResults)||void 0===s?void 0:s.debugInfo,searchExperimentOverrides:a.state.searchExperimentOverrides,hasPublicAccessPermission:r,errorState:t.state.errorState,serverResultsAllLoaded:t.state.serverResultsAllLoaded}}),[t,a,d]),R=!1===P.isLoading&&P.showMajorError,F=Boolean(S||y),B=(0,r.useCallback)((()=>{!I&&!T&&void 0!==y&&w.ZP.update((e=>({...e,limit:e.limit+w.Xv,isScrolled:!0,source:"quick_find_scroll"})))}),[I,T,y]),A=(0,i.VK)((()=>v.oO({localResults:null==S?void 0:S.results,serverResults:null==y?void 0:y.results})),[S,y]),_=(0,i.VK)((()=>{if(s)return[];return[{type:"assistant",renderTitle:(e,t,s)=>function(e,t){return(0,Se.jsx)("div",{className:"notranslate",style:t,children:e})}((0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)("span",{children:(0,Se.jsx)(z.FormattedMessage,{id:"searchResultsBody.askAiMenuItem.title",defaultMessage:"Ask AI"})}),(0,Se.jsx)("span",{style:u.askAiQuery,children:e?` ${e}`:""})]}),{...s,...u.askAiLabel}),icon:e=>(0,Ht.t)({...e,...u.askAiIcon}),action:()=>{Gt.em({environment:d,shouldResetAssistantStore:w.ZP.state.query.text.length>0||Jt.Z.wasActiveSessionLastOpenedOutsideOfHistorySavedWindow()})},shouldShow:()=>Yt.Z.shouldShowSearchMenuItemAskAI(c),shouldShowArrowUp:e=>{let{currentGlobalFocusedIndex:t,actionItemCount:s}=e;return void 0!==t&&t===s}}].filter((e=>e.shouldShow(d)))}),[d,u,s,c],{useDeepEqual:!0}),O=(0,i.VK)((()=>{if(s)return 0;{const e=_.map((e=>({type:e.type})));return x.update((t=>e)),x.state.length}}),[s,_,x]);(0,i.VK)((()=>{const e=t.state.insertedActionResultsCount,s=O;e!==s&&t.update((e=>({...e,insertedActionResultsCount:s})))}),[t,O]);const L=(0,r.useCallback)((()=>h.update((e=>e.focus.isInitialized&&0===e.focus.section&&0===e.focus.indexLocal&&0===e.focus.indexGlobal?e:{...e,focus:_.length>0?{section:1,indexLocal:0,indexGlobal:_.length}:{section:0,indexLocal:0,indexGlobal:0}}))),[h,_]);(0,r.useEffect)((()=>{L()}),[A,L]),(0,r.useEffect)((()=>{void 0!==p.section&&void 0!==p.indexLocal&&void 0!==p.indexGlobal?g.setState({local:{section:p.section,indexLocal:p.indexLocal},global:p.indexGlobal}):g.setState(void 0)}),[g,p]);const E=(0,i.VK)((()=>{const e=C.ZP.state.showDebugInfo;return!R&&F&&!c.isMobile&&!(0,f.rd)(d)||e||s}),[c.isMobile,F,R,s,d]);return(0,Se.jsxs)("div",{style:u.container,children:[(0,Se.jsx)(oi,{errorState:P,handleSelectResult:m,onMaybeLoadMoreResults:B,resultListStore:h,searchResultStore:t,localResults:null==S?void 0:S.results,serverResults:null==y?void 0:y.results,debugInfo:M,clusterInfo:b,publicAccessPermission:j,searchExperimentOverrides:k,showActions:_,extraTopPadding:l}),(0,Se.jsx)(Vn,{searchResultStore:t,showSpinner:I,shouldShow:E})]})};function gi(e){window.__c={n:"SearchNavigationalView"};const{searchContentPaneType:t}=e,{searchFilterMenuRef:s,handleSelectSearchResult:a,searchResultStore:l,secondarySearchResultStore:d}=(0,r.useContext)(Z.SearchStaticContext),c=(0,n.Fy)(),{errorState:u,shouldShowSxSView:h}=(0,i.VK)((()=>({shouldShowSxSView:Boolean((0,C.gq)({device:c})&&C.BJ.state.visible),errorState:l.state.errorState})),[l,c]),p=(0,o.yK)((()=>({container:{display:"flex",flexDirection:"column",width:h?"50%":"100%"},sxsContainer:{display:"flex",flexDirection:"row",height:"100%",overflow:"hidden",maxWidth:"100%"}})),[h]),m=!1===u.isLoading&&u.showMajorError,g=(0,i.VK)((()=>w.ZP.state.filterBar.show),[]),f=!c.isMobile&&!g,v={searchResultStore:l,searchDebugColumnStore:C.v_,sxsMode:h,extraTopPadding:f},x=(0,i.VK)((()=>{var e;return null===(e=y.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]);return(0,Se.jsxs)(Se.Fragment,{children:[!c.isMobile&&g&&(0,Se.jsx)(wn,{isMobile:c.isMobile}),"search_results"===t?(0,Se.jsxs)(Se.Fragment,{children:[!m&&c.isMobile&&(0,Se.jsx)(wt,{isMobile:!0,mode:bt.Section,ref:s}),(0,Se.jsxs)("div",{style:p.sxsContainer,children:[(0,Se.jsx)(mi,{...v}),h&&(0,Se.jsx)(mi,{...v,searchResultStore:d,searchDebugColumnStore:C.BJ})]})]}):x?(0,Se.jsx)(Ur,{onSelect:a,spaceId:x,extraTopPadding:f}):null]})}var fi=s(97439),vi=s(27714),xi=s(37034),Si=s(10912),yi=s(84076);function bi(e){window.__c={n:"SearchSidePeekPanelMetadataItem"};const{itemName:t,itemValue:s,associatedUser:r}=e,n=(0,o.yK)((e=>({itemName:{fontSize:12,color:e.lightTextColor},itemValue:{fontSize:12,...r&&{display:"grid",gridTemplateColumns:"1fr auto auto",gap:5,textAlign:"right"}},itemContainer:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:12},metadataActorName:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[r]),i=r;return(0,Se.jsxs)("div",{style:n.itemContainer,children:[(0,Se.jsx)("div",{style:n.itemName,children:t}),(0,Se.jsxs)("div",{style:n.itemValue,children:[i&&(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(Rs.ZP,{delayThreshold:50,placement:Rs.ug.Top,allowHover:!0,renderTooltip:()=>(0,Se.jsxs)("div",{style:{display:"flex",gap:5},children:[i.avatar,i.name]}),closeDelay:0,render:e=>(0,Se.jsx)("span",{...e,style:n.metadataActorName,children:i.name})}),(0,Se.jsx)("span",{children:""})]}),(0,Se.jsx)("span",{children:s})]})]})}const Mi={createdBy:(0,Se.jsx)(z.FormattedMessage,{id:"search.preview.metadata.createdBy",defaultMessage:"Created by"}),created:(0,Se.jsx)(z.FormattedMessage,{id:"search.preview.metadata.created",defaultMessage:"Created"}),lastEditedBy:(0,Se.jsx)(z.FormattedMessage,{id:"search.preview.metadata.lastEditedBy",defaultMessage:"Last edited by"}),lastEdited:(0,Se.jsx)(z.FormattedMessage,{id:"search.preview.metadata.lastEdited",defaultMessage:"Edited"})},Ci={type:"page_content"};function Ii(e){var t;window.__c={n:"SearchSidePeekPanel"};const{selectedResult:s,onClickPreview:l,handleClickCopyLink:d}=e,c="page_result"===s.type,h=(0,o.yK)((e=>({sidePeekPanel:{width:250,overflowY:"auto",overflowX:"hidden",minHeight:400,borderLeft:`1px solid ${e.lightDividerColor}`,display:"flex",flexDirection:c?"column":"row",justifyContent:c?"space-between":"center",alignItems:c?"normal":"center",zIndex:1},emoji:{width:20},sidePeekContentContainer:{margin:16},report:{fontSize:12,position:"absolute",bottom:0,right:0,margin:16,display:"flex",gap:10},sidePeekActionContainer:{margin:16},pageIconAndTitleContainer:{marginTop:12,display:"flex",gap:8,flexDirection:"column",justifyContent:"space-between"},title:{fontSize:16,fontWeight:U.Z.fontWeight.semibold,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},untitledPageColor:{color:e.text.tertiary},titleAndLinkContainer:{display:"grid",gridTemplateColumns:"1fr auto",width:"fit-content",gap:5},previewContainer:{marginTop:8,marginBottom:8,display:"flex",flexDirection:"column",position:"relative"},hoveredOrPressedPreview:{background:"unset",boxShadow:"unset"},preview:{borderRadius:6,background:"unset",boxShadow:"unset",border:`1px solid ${e.lightDividerColor}`,padding:12},contentCover:{color:e.text.primary,fontSize:11,lineHeight:1.5,marginBottom:0,width:"110%",transform:"translateX(-12px) translateY(-4px) scale(0.91)",paddingLeft:12,paddingRight:12,paddingTop:12,paddingBottom:0,borderRadius:6,border:`1px solid ${e.lightDividerColor}`,background:"transparent"},contentCoverFade:{height:48,background:`linear-gradient(to bottom, transparent, ${"light"===e.mode?e.contentBackground:e.sidebarBackground} 100%)`},metadataContainer:{marginTop:8,display:"flex",flexDirection:"column",gap:8},action:{borderRadius:4,background:"unset",fontSize:12,display:"flex"},metadataActorWrapper:{overflow:"hidden"},metadataActorAvatar:{marginRight:5},doubleChevronIcon:{color:e.accentColors.gray[400],cursor:"pointer",width:"max-content"},debugGearIcon:{color:e.accentColors.gray[400]},hoveredDebugGearIcon:{color:e.accentColors.gray[600]}})),[c]),p=(0,i.VK)((()=>h.sidePeekPanel),[h.sidePeekPanel]),g=(0,n.O7)(),f=(0,z.useIntl)(),v=(0,i.VK)((()=>"page_result"===s.type?{type:"page_result",value:s.value.selectedResult.store}:{type:"assistant",value:void 0}),[s]),x=(0,i.VK)((()=>{if("page_result"!==v.type)return;const e=(0,xi.V)(v.value,f,g,!Yt.Z.isXMLAssistantEnabled(void 0));return e&&e.trim().length>0?e:void 0}),[f,g,v]),S=(0,r.useCallback)((e=>{const{id:t,spaceStore:s,table:r,showAvatar:n}=e;if(void 0===t||void 0===r)return;const i=(0,mr.Hl)({pointer:{id:t,spaceId:s.id,table:r},getRecordModel:s.getRecordModel}).asActor;return!i||i.isUser()&&!s.getSpaceUserStore(i.id).isMember()||i.isBot()&&!s.getSpaceBotStore(i.id).isMember()?void 0:{name:(0,mr.$4)(f,i),avatar:n?(0,vr.a)({actor:i,size:18,style:h.metadataActorAvatar}):void 0}}),[f,h.metadataActorAvatar]),b=(0,r.useCallback)((e=>(0,$s.IS)(e,{useUltraCompactFormat:!0,useWeeks:!0,useLowercase:!0})),[]),{createdBy:M,created:C,lastEditedBy:I,lastEdited:k}=(0,i.VK)((()=>{const e=y.default.state.currentSpaceStore;if(void 0===e||"page_result"!==s.type)return{createdBy:void 0,created:void 0,lastEditedBy:void 0,lastEdited:void 0};const t=s.value.selectedResult.store;return{createdBy:S({id:t.getCreatedById(),table:t.getCreatedByTable(),spaceStore:e,showAvatar:!0}),created:b(t.getCreatedTime()),lastEditedBy:S({id:t.getLastEditedById(),table:t.getLastEditedByTable(),spaceStore:e,showAvatar:!0}),lastEdited:b(t.getLastEditedTime())}}),[b,S,s]),j=[{key:"created",itemName:Mi.created,itemValue:C,associatedUser:M},{key:"lastEdited",itemName:Mi.lastEdited,itemValue:k,associatedUser:I}],{previewIcon:P,isEmptyPage:T}=(0,i.VK)((()=>{if("page_result"!==s.type)return{previewIcon:void 0,isEmptyPage:!0};const e=s.value.selectedResult.store;return{previewIcon:e.getIcon(),isEmptyPage:e.isEmptyPage()}}),[s]),R=(0,i.VK)((()=>{if("page_result"!==s.type)return;const e=s.value.selectedResult.store;return(0,m.ZP)({store:e,collectionViewId:e.id,fullyQualified:!0,pageVisitSource:a.tY.SearchQuery})}),[s]),F=(0,r.useCallback)((()=>{R&&(u.RD({environment:g,stringValue:R,copiedMessage:u.tq.copiedLinkToClipboard}),d&&d({source:Z.SearchCopyLinkSource.SidePeekPanel}))}),[d,g,R]),B=(0,i.VK)((()=>X.default.checkGate("search_toggle_side_peek")),[]),A=(0,i.VK)((()=>X.default.checkGate("search-show-report-bad-search")),[]),{searchResultStore:_}=(0,r.useContext)(Z.SearchStaticContext),{localResults:O,serverResults:L}=(0,i.VK)((()=>_.state),[_]),E=(0,W.x)(H.default);return(0,Se.jsxs)("aside",{style:p,children:[(0,Se.jsx)("div",{style:h.sidePeekContentContainer,children:"page_result"===s.type?(0,Se.jsxs)(Se.Fragment,{children:[B&&(0,Se.jsx)("div",{onClick:()=>Gt.bn(),style:h.doubleChevronIcon,children:(0,fi.D)({width:15,height:15})}),(0,Se.jsxs)("div",{style:h.pageIconAndTitleContainer,children:[(0,Se.jsx)(pe.Z,{disabled:!0,icon:P,isEmptyPage:T,size:26,largeIcon:!0}),(0,Se.jsxs)("span",{style:h.titleAndLinkContainer,children:[(0,Se.jsx)("span",{style:{...h.title,...!x&&h.untitledPageColor},children:x??(0,Se.jsx)(z.FormattedMessage,{id:"search.preview.untitledPage",defaultMessage:"Untitled"})}),(0,Se.jsx)(ki,{onClick:F})]})]}),(0,Se.jsx)(yi.Z,{style:h.previewContainer,href:R,hoveredStyle:h.hoveredOrPressedPreview,pressedStyle:h.hoveredOrPressedPreview,onClick:l,children:(0,Se.jsx)(Si.Z,{variant:"default",store:s.value.selectedResult.store,coverFormat:Ci,coverSizeFormat:"large",showEmptyGalleryCover:!1,coverContentFadedOverlay:!0,coverContentFadedOverlayStyle:h.contentCoverFade,contentWrapStyle:h.contentCover,coverHeight:180,onLoadProxiedImage:()=>{},renderAdditionalBlocks:!0,rendererBlockStyle:{fontSize:9}})}),(0,Se.jsx)("div",{style:h.metadataContainer,children:j.filter((e=>void 0!==e.itemValue)).map(((e,t)=>(0,Se.jsx)(bi,{isFirstInList:0===t,itemName:e.itemName,itemValue:e.itemValue,associatedUser:e.associatedUser},e.key)))})]}):(0,Se.jsx)(wi,{query:s.value??""})}),A?(0,Se.jsxs)("div",{style:h.report,children:[(0,Se.jsx)(En,{exposedSearchExperiments:null==L||null===(t=L.serverEventProperties)||void 0===t?void 0:t["server-searchExperiments"],localResults:null==O?void 0:O.results,serverResults:null==L?void 0:L.results,debugInfo:null==L?void 0:L.debugInfo}),E&&(0,Se.jsx)(er.Z,{ariaLabel:"Button to open search's debug side panel",onClick:()=>w.ZP.setState({...w.ZP.state,isDebugSidebarOpen:!0}),style:h.debugGearIcon,hoveredStyle:h.hoveredDebugGearIcon,icon:e=>(0,gs.H)({width:12,height:12})})]}):null]})}function wi(e){window.__c={n:"QnaPanel"};const{query:t}=e,s=(0,o.yK)((e=>({container:{display:"flex",flexDirection:"column",gap:30},chatAndAvatarContainer:{display:"flex",gap:6,alignItems:"flex-end"},chatContainer:{display:"flex",flexDirection:"column",gap:10,flexGrow:1,justifyContent:"center"},questionBubble:{backgroundColor:e.cardHoveredBackground,color:e.lightTextColor,padding:8,borderRadius:16,fontSize:12,minWidth:40,minHeight:32,width:"fit-content",maxWidth:180,alignSelf:"flex-end",userSelect:"none",overflow:"hidden",textOverflow:"ellipsis"},introBubble:{backgroundColor:e.accentColors.purple[50],color:e.accentColors.purple[500],padding:"8px 12px",borderRadius:16,fontSize:14,width:170,userSelect:"none",overflow:"hidden",display:"flex",flexDirection:"column",gap:6,textOverflow:"ellipsis"},helperDescription:{textAlign:"center",fontSize:12,color:e.lightTextColor,display:"flex",justifyContent:"center"},loadingDots:{border:`1px solid ${e.lightDividerColor}`,padding:12,borderRadius:100,width:"max-content"},writingIndicatorCircle:{height:5,width:5,opacity:.6,backgroundColor:e.lightIconColor,borderRadius:"100%"},writingButtonWrapper:{display:"flex",alignItems:"center",justifyContent:"center",gap:3,width:"inherit",height:"inherit"}})),[]);return(0,Se.jsxs)("div",{style:s.container,children:[(0,Se.jsxs)("div",{style:s.chatAndAvatarContainer,children:[(0,Se.jsx)(ji,{}),(0,Se.jsx)("div",{style:s.chatContainer,children:t?(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)("div",{style:s.questionBubble,children:t}),(0,Se.jsx)("div",{style:s.loadingDots,children:(0,Se.jsxs)("div",{role:"decorative",style:s.writingButtonWrapper,children:[(0,Se.jsx)("div",{role:"decorative",style:s.writingIndicatorCircle}),(0,Se.jsx)("div",{role:"decorative",style:s.writingIndicatorCircle}),(0,Se.jsx)("div",{role:"decorative",style:s.writingIndicatorCircle})]})})]}):(0,Se.jsxs)("div",{style:s.introBubble,children:[(0,Se.jsx)("div",{children:(0,Se.jsx)(z.FormattedMessage,{id:"searchSidePeekPanel.welcomeMessage.title",defaultMessage:"Hi! Im Notion AI."})}),(0,Se.jsx)(z.FormattedMessage,{id:"searchSidePeekPanel.welcomeMessage.caption",defaultMessage:"Let me help you find information and answer questions."})]})})]}),(0,Se.jsx)("div",{style:s.helperDescription,children:(0,Se.jsx)("div",{style:{width:"90%"},children:(0,Se.jsx)(z.FormattedMessage,{id:"SearchSidePeek.caption",defaultMessage:"Get quick answers for anything in your workspace"})})})]})}function ki(e){window.__c={n:"CopyLinkIcon"};const t=(0,n.O7)(),s=(0,o.yK)((e=>({linkIcon:{width:14,height:14,fill:"light"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[500]},hoveredBackground:{backgroundColor:e.buttonHoveredBackground},shortcutLabel:{color:e.mediumInvertedTextColor},tooltipContent:{display:"flex",flexDirection:"column"}})),[]),r=(0,i.VK)((()=>(0,f.bN)(t)),[t]);return(0,Se.jsx)(Rs.ZP,{delayThreshold:600,placement:Rs.ug.Top,allowHover:!0,renderTooltip:()=>(0,Se.jsxs)("div",{style:s.tooltipContent,children:[(0,Se.jsx)(z.FormattedMessage,{id:"search.preview.copyLink",defaultMessage:"Copy link"}),r&&(0,Se.jsx)(Ps.Z,{style:s.shortcutLabel,name:"copyLinkToCurrentPage"})]}),closeDelay:0,render:t=>(0,Se.jsx)(er.Z,{...t,icon:e=>(0,vi.N)(s.linkIcon),ariaLabel:"Button to toggle the filter bar",hoveredStyle:s.hoveredBackground,onClick:e.onClick})})}function ji(){window.__c={n:"AssistantLogo"};const e=(0,o.yK)((e=>({faceImgWrap:{width:32,height:32,borderRadius:"100%",background:e.whiteButtonBackground,border:`1px solid ${e.lightDividerColor}`,overflow:"hidden",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"},faceImg:{width:40,pointerEvents:"none"},aiSparklesFill:{height:14,width:14,fill:e.mediumIconColor,pointerEvents:"none"}})),[]);return(0,Se.jsx)("div",{style:e.faceImgWrap,children:(0,Ht.t)(e.aiSparklesFill)})}function Pi(e){window.__c={n:"SearchContentPane"};const t=(0,n.Fy)(),s=(0,n.O7)();return(0,r.useEffect)((()=>{h.S(s)}),[s]),(0,x.Z)(),(0,Se.jsx)(j.Z,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!t.isMobile,render:()=>(0,Se.jsx)(k.Z,{capture:!0,allowMenuList:!0,render:t=>(0,Se.jsx)(Ti,{...e,ignoreAreaEvents:t})})})}function Ti(e){window.__c={n:"SearchContentPaneInner"};const{ignoreAreaEvents:t,renderAsPage:s,quickSearchMode:d,onClose:c,searchContentPaneType:h}=e,{handleQueryChange:x,searchFilterMenuRef:S,modalBodyMenuRef:y,searchResultStore:k,focusedIndexStore:j,defaultBodyFocusedResult:R,searchActionItemsStore:F,handleSelectSearchResult:A,handleCopySearchItemLink:_}=(0,r.useContext)(Z.SearchStaticContext),[O,L]=(0,r.useState)(!1),[E,D]=(0,r.useState)(!1),V=(0,n.O7)(),q=(0,n.Fy)(),N=(0,i.VK)((()=>w.ZP.state.query.text),[]),{isSearchMenuOpen:W,shouldShowDebugSidebar:K,hasPublicAccessPermission:U,shouldShowSpinner:z}=(0,i.VK)((()=>{const e=Boolean(b.Z.state.online),{hasPublicAccessPermission:t}=v.bC(V);return{isSearchMenuOpen:I.default.state.open,shouldShowSpinner:e&&Boolean(N)&&k.state.serverResultsLoading&&!O,shouldShowDebugSidebar:Ai({device:q,isPublicAccessPermissionForPage:t}),hasPublicAccessPermission:t}}),[O,k,q,V,N]),H=(0,r.useMemo)((()=>l.Ds((()=>{const{activeElement:e}=document;e instanceof HTMLInputElement&&e.blur()}),500,{leading:!0})),[]),G=(0,r.useCallback)((()=>{E&&H()}),[H,E]),$=(0,r.useCallback)((e=>{D(e),e||q.isMobileNative&&M.Z.updateKeyboardPhase(V,M.i.willHide,0)}),[q.isMobileNative,V]),Q=(0,i.VK)((()=>v.pG({searchResultStore:k,focusedIndexStore:j,searchActionsStore:F})),[k,j,F]),X=(0,i.VK)((()=>R.state),[R]),Y=(0,r.useMemo)((()=>(0,Se.jsx)(zt.Z,{isOpen:Boolean(s||W),onTypingChange:L,onFocusChange:$,showSpinner:z,onQueryChange:x,quickSearchMode:d,selectedResult:"page_result"===(null==Q?void 0:Q.type)?Q.value.selectedResult.store:void 0})),[s,W,$,z,x,d,Q]),J=(0,i.VK)((()=>Ri({searchContentPaneType:h,renderAsPage:s,environment:V})),[h,s,V]),ee=(0,o.yK)((e=>({body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",zIndex:2},topbar:{height:void 0,marginTop:10,marginLeft:16,marginBottom:10,marginRight:16},topbarRightButtonWrapper:{flex:void 0,paddingLeft:16},topbarButton:{fontWeight:void 0,padding:0,color:e.mediumTextColor},scroller:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between",maxHeight:J.maxHeight,minHeight:J.minHeight}})),[J.maxHeight,J.minHeight]),te=(0,r.useMemo)((()=>{if(q.isMobile){return{menuType:g.og.Modal,left:Y,shouldRenderLeftDirectly:!0,width:s?"100vw":void 0,...Bi({isPhone:q.isPhone,renderAsPage:s,style:ee.topbarRightButtonWrapper,onClick:c}),header:"search_results"===h&&(0,Se.jsx)(Wt,{isPublicPageSearch:U}),disableHeaderShadow:!0,topbarStyle:ee.topbar,leftRightButtonStyle:ee.topbarButton,onScroll:Zi(q)?G:void 0,bodyScrollerClassName:p.GZn,...t}}return{menuType:g.og.Popup,maxHeight:J.maxHeight,minHeight:J.minHeight,maxWidth:"100%",...d?{width:"100vw"}:{},disableScroller:!0,scrollerStyle:ee.scroller,...t}}),[q,ee,t,Y,s,c,h,U,G,J.minHeight,J.maxHeight,d]),se=X||Q;"assistant"===(null==se?void 0:se.type)&&(se.value=N);const re=(0,i.VK)((()=>F.state.length),[F]),ne=(0,i.VK)((()=>{if("page_result"===(null==se?void 0:se.type)){const{index:e,selectedResult:t,allSearchResults:s}=se.value;return r=>A({event:r,index:e,selectedResult:t,allSearchResults:s,fromSidePeekPanel:!0,actionItemCount:re,context:"search_results"===h?"query_results":"recent_pages"})}}),[re,A,h,se]),ie=(0,i.VK)((()=>{if("page_result"===(null==se?void 0:se.type)){const{index:e,selectedResult:t,allSearchResults:s}=se.value;return r=>{const{source:n}=r;_({index:e,selectedResult:t,allSearchResults:s,fromSidePeekPanel:n===Z.SearchCopyLinkSource.SidePeekPanel,actionItemCount:re,context:"search_results"===h?"query_results":"recent_pages",source:n})}}}),[re,_,h,se]),oe=(0,i.VK)((()=>!(0,f.bN)(V)&&V.WindowSizeStore.state.width<Z.DEFAULT_MODAL_WIDTH_WITH_SIDE_PEEK),[V]),ae=(0,i.VK)((()=>!((0,C.gq)({device:q})||oe||w.ZP.state.isDebugSidebarOpen||void 0===se||"default_body"===h)&&(0,f.Qi)(V)),[V,h,se,q,oe]);(0,i.VK)((()=>{w.ZP.state.isSidePeekPanelOpen!==ae&&w.ZP.update((e=>({...e,isSidePeekPanelOpen:ae})))}),[ae]);const le=(0,r.useCallback)((()=>{if(!d||!se||"page_result"!==se.type)return;const e=se.value.selectedResult.store,t=(0,m.Hu)({store:e,collectionViewId:e.id,fullyQualified:!0,pageVisitSource:a.tY.SearchQuery});t&&(u.RD({environment:V,stringValue:t,copiedMessage:u.tq.copiedLinkToClipboard}),ie&&ie({source:Z.SearchCopyLinkSource.KeyboardShortcut}))}),[V,ie,d,se]);return(0,Se.jsx)(P.Z,{capture:!0,onCopyLinkToCurrentPage:e=>{le()},onCopyLinkToPageInCommandSearch:e=>{le()},children:(0,Se.jsx)(T.Z,{...te,className:p.Oau,ref:y,children:(0,Se.jsxs)(Fi,{enableLazyLoading:s,children:[(0,Se.jsxs)("div",{style:ee.body,children:[(0,Se.jsx)(B.Z,{}),!q.isMobile&&Y,(0,Se.jsx)(gi,{searchContentPaneType:h})]}),ae&&void 0!==se?(0,Se.jsx)(Ii,{selectedResult:se,onClickPreview:ne,handleClickCopyLink:ie}):void 0,K&&(0,Se.jsx)(wt,{ref:S})]})})})}function Ri(e){const{searchContentPaneType:t,renderAsPage:s,environment:r}=e;if(s)return{maxHeight:"100vh",minHeight:"100vh"};if((0,f.rd)(r)){const e=r.WindowSizeStore.state.height>570+(0,c.u3)(r.device.isElectronMac)?570:0;return{minHeight:`max(${"search_results"===t?70:50}vh, ${e}px)`,maxHeight:`max(${"search_results"===t?70:50}vh, ${e}px)`}}return"assistant"===w.ZP.state.mode?{maxHeight:"80vh",minHeight:570}:{maxHeight:"80vh",minHeight:50}}function Fi(e){window.__c={n:"SearchMenuContentsWrapper"};const{enableLazyLoading:t,children:s}=e,i=(0,n.O7)();return t?(0,Se.jsx)(F.Z,{fetch:async()=>{var e;await d.Vs(0),await y.default.waitUntil((()=>void 0!==y.default.state.currentSpaceStore)),null===(e=i.mobileNative)||void 0===e||e.markTransitionReady({type:"search"})},loading:()=>(0,Se.jsx)(r.Fragment,{}),render:()=>s}):(0,Se.jsx)(r.Fragment,{children:s})}function Bi(e){let{isPhone:t,style:s,renderAsPage:r,onClick:n}=e;return t&&(0,S.Y)("supportsNativeHome")||r?{rightOuterStyle:{display:"none"}}:{right:(0,Se.jsx)(R.CancelMenuText,{}),onClickRight:n,rightOuterStyle:s}}function Zi(e){return!!e.isMobile&&(!e.isIOS||e.isMobileNative)}function Ai(e){let{device:t,isPublicAccessPermissionForPage:s}=e;if(!s&&!t.isMobile)return w.ZP.isDebugSidebarOpen()}},86244:(e,t,s)=>{s.d(t,{$:()=>H,Z:()=>Q});var r=s(67294),n=s(83355),i=s(480),o=s(86628),a=s(24405),l=s(6637),d=s(35840),c=s(94804),u=s(70203),h=s(82990),p=s(9291),m=s(12457),g=s(34700),f=s(59139),v=s(97638),x=s(38755),S=s(5162),y=s(80444),b=s(21273),M=s(25904),C=s(30857),I=s(29026),w=s(73063),k=s(74194),j=s(68785),P=s(31278),T=s(26388),R=s(72787),F=s(72126),B=s(51787),Z=s(87531),A=s(70782),_=s(81598),O=s(87279),L=s(29741),E=s(69327),D=s(55320),V=s(31945),q=s(78140),N=s(53437),W=s(33991),K=s(85893);function U(e){window.__c={n:"WorkspaceIcon"};const{events:t,spaceIcon:s,spaceName:n}=e,[i,o]=(0,r.useState)(!1),l=(0,a.yK)((e=>({downIcon:{height:8,width:8,stroke:e.icon.tertiary},wrapper:{display:"flex",alignItems:"center",gap:2,paddingRight:5,...(0,g.X)({noDrag:!0}),cursor:"pointer"},recordIcon:{backgroundColor:i?e.buttonHoveredBackground:void 0,padding:4,height:void 0,width:void 0}})),[i]);return(0,K.jsxs)("span",{...t,style:l.wrapper,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[(0,K.jsx)(P.Z,{bucket:"public",disabled:!0,icon:s,isEmptyPage:!1,size:24,style:l.recordIcon,title:n}),(0,R.Y)(l.downIcon)]})}const z=function(){window.__c={n:"SearchWorkspaceSwitcher"};const e=(0,o.VK)((()=>y.default.state.currentSpaceStore),[]),t=(0,o.VK)((()=>null==e?void 0:e.id),[null==e?void 0:e.id]),s=(0,i.O7)(),n=(0,o.VK)((()=>s.currentUser.id),[s.currentUser.id]),{handlePopupOpen:a,handlePopupClose:l}=(0,r.useContext)(W.SearchStaticContext),d=(0,r.useCallback)((async e=>{const{newSpaceView:t,associatedUserId:r,closeSwitcherPopupFn:i}=e,o=t.getSpaceId();if(t&&n&&o){var a;const e=null===(a=y.default.state.currentSpaceViewStore)||void 0===a?void 0:a.id,l=D.default.state.sessionId;e&&l&&o&&B.fh(s,{currentSearchSessionId:l,currentWorkspaceId:e,newWorkspaceId:o}),i(),y.default.update((e=>({...e,currentSpaceViewStore:t,currentSpaceStore:null==t?void 0:t.getSpaceStore()}))),n!==r&&await A.x({environment:s,newCurrentUserId:r}),b.Z.isAiEnabled()&&_.L6.loader().then((e=>{let{assistantActions:t}=e;t.clearAllAssistantSessions()})),E.Z.reinitializeState(s,r,o),D.default.closeAndResetMetricsState(),C.default.reset(),Z.UT({environment:s,analyticsFrom:"quick-search-switch-workspace",isQuickSearch:!0,renderAsPage:!0})}}),[n,s]),{spaceIcon:c,spaceName:u}=(0,o.VK)((()=>e?{spaceName:e.getName(),spaceIcon:(0,x.Wd)(s,e)}:{spaceName:void 0,spaceIcon:void 0}),[e,s]),h=[...s.currentUser.loggedInUserIds],p=(0,o.VK)((()=>{var e;return F.mN(F.oA((null===(e=y.default.state.currentUserRootStore)||void 0===e?void 0:e.getSpaceViewStores())??[]),(e=>e.getSpaceId()))}),[]);return e?!t||!n||!e||p.length<=1&&1===h.length?null:(0,K.jsx)(V.ZP,{popupType:V.Z4.Popup,renderOrigin:e=>(0,K.jsx)(U,{events:e,spaceIcon:c,spaceName:u}),render:e=>(0,K.jsx)(q.Z,{menuType:O.og.Popup,children:h.map(((t,s)=>(0,K.jsx)(L.LP,{onSpaceClick:s=>d({newSpaceView:s.spaceViewStore,associatedUserId:t,closeSwitcherPopupFn:e.close}),userId:t,isLastUser:s===h.length-1,disableAccountActions:!0,hideShortcuts:!0},`commandSearch-userworkspaces-${s}`)))}),onClick:a,onClose:l,disabled:!1,placementToOrigin:N.ZP.Placement.Bottom,alignmentToOrigin:N.ZP.Alignment.Start,style:{...(0,g.X)({noDrag:!0}),marginRight:30}}):null},H=48;class G extends n.Z{constructor(){super(...arguments),this.typingTimer=void 0,this.renderLeft=()=>{const{showSpinner:e,selectedResult:t,quickSearchMode:s}=this.props,{device:r}=this.environment,n=this.styles,i={...Y(this.theme).searchIcon,...n.searchIcon};if(s)return(0,K.jsx)(z,{});const o=null==t?void 0:t.getIcon(),a=Boolean(I.ZP.state.query.text.trim())&&!r.isMobile;return(0,K.jsx)(m.Z,{show:e,showDelay:500,showHold:200,render:e=>(e=>(0,K.jsx)("div",{style:n.headerIcon,children:e?(0,K.jsx)(j.Z,{style:i}):a?(0,K.jsx)(P.Z,{disabled:!0,icon:o,isEmptyPage:Boolean(o),size:20}):(0,d.R)(i)}))(e)})},this.handleQueryChange=e=>{this.handleTyping();const t=String(e.target.value);this.props.onQueryChange(t)},this.isPopupOpen=this.createComputedStore((()=>I.ZP.state.isPopupOpen)),this.styles={inputDesktop:{fontSize:18,height:H,paddingLeft:12,paddingRight:16,alignItems:"center",flexGrow:0,flexShrink:0,zIndex:1},inputMobile:{fontSize:16,border:"none",boxShadow:"none",borderRadius:7,lineHeight:"1.2",padding:"6px 8px"},searchIcon:{width:16,height:16},headerIcon:{height:24,width:24,display:"flex",alignItems:"center",justifyContent:"center"},input:{minWidth:0,...h.Z.textOverflowStyle},suggestedText:{whiteSpace:"pre",color:this.theme.mediumTextColor},suggestedTextWrapper:{overflow:"hidden",textOverflow:"ellipsis"},autoCompletedText:{background:this.theme.tint.regular},clearButton:{marginLeft:8},userInputAndSuggestedTextContainer:{display:"grid",gridTemplateColumns:"auto 1fr"}}}willUnmount(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=void 0)}renderComponent(){const{device:e}=this.environment,{isOpen:t,selectedResult:s,quickSearchMode:r}=this.props,n=this.styles,i=Y(this.theme),o=I.ZP.state.query.text,a=function(e,t,s){if(0===s.length||s.length>=20||e.isMobile||void 0===t)return;const r=u.Jcv(t.getTitleValue()),n=r.replaceAll("\n"," "),i=r.slice(0,s.length),o=n.substring(s.length);if(r.length>0&&i.toLocaleLowerCase()===s.toLocaleLowerCase())return`${o}  ${G.messages.open.defaultMessage}`;return`  ${G.messages.open.defaultMessage}`}(e,s,o),l=o.trim().length>0&&a?(0,K.jsxs)("div",{style:n.userInputAndSuggestedTextContainer,children:[(0,K.jsx)("span",{style:{whiteSpace:"pre-wrap"},children:o}),(0,K.jsx)("div",{style:{...n.suggestedTextWrapper,...r&&!this.isPopupOpen.state&&(0,g.X)({drag:!0})},children:(0,K.jsx)("span",{style:n.autoCompletedText,children:a})})]}):"",d=e.isMobile?k.B.ExtraLarge:k.B.Transparent,c=e.isMobile?{...n.inputMobile,...i.inputMobile}:{...n.inputDesktop,...i.inputDesktop},h=b.Z.showSearchAiFeatures()||(0,f.rd)(this.environment),p={...n.input,...r&&(0,g.X)({noDrag:!0}),width:0===o.length&&r?`min(${X(this.props.intl,this.environment).length}ch, 100%)`:"100%"};return(0,K.jsx)("div",{style:{display:"flex",flex:1},children:(0,K.jsx)(k.Z,{format:d,placeholder:X(this.props.intl,this.environment),left:this.renderLeft(),value:o,suggestedText:l,suggestedTextStyle:n.suggestedText,focus:e.isMobile?void 0:t&&!M.Z.state.open,focusInitial:!(0,S.Y)("supportsNativeHome")&&e.isMobile,focusAfterAnimation:!0,showClearButton:!0,right:!e.isMobile&&h&&(0,K.jsx)($,{quickSearchMode:r}),isRightLastElementOfInput:!0,selectAll:!0,onChange:this.handleQueryChange,onClearButtonClick:J,onFocus:()=>{(0,this.props.onFocusChange)(!0)},onBlur:()=>{(0,this.props.onFocusChange)(!1)},style:c,inputStyle:p,clearButtonStyle:{...r&&(0,g.X)({noDrag:!0})}})})}handleTyping(){void 0===C.default.state.firstKeyStrokeTimeMs&&C.default.update((e=>({...e,firstKeyStrokeTimeMs:Date.now()})));const{onTypingChange:e}=this.props;this.typingTimer&&window.clearTimeout(this.typingTimer),e(!0),this.typingTimer=window.setTimeout((()=>e(!1)),300)}}function $(e){window.__c={n:"FilterIconButton"};const[t,s]=(0,o.VK)((()=>{const e=I.ZP.state.query.filters,t=(0,v.FN)(e);return[I.ZP.state.filterBar.show,t]}),[]),r=(0,i.O7)();(0,o.VK)((()=>{const e=r.currentUser.id;if(!e)return;!1===(0,c.fe)(e)&&!0===t&&I.ZP.collapseFilterBar()}),[r,t]);const n=(0,a.yK)((t=>({container:{padding:4,marginLeft:5,borderRadius:4,height:"fit-content",width:"fit-content",display:"flex",...e.quickSearchMode&&(0,g.X)({noDrag:!0})},hoveredContainerStyles:{background:s?t.accentColors.uiBlue[100]:t.buttonHoveredBackground},icon:{width:17,height:17,cursor:"pointer",fill:s?t.accentColors.uiBlue[600]:"light"===t.mode?t.accentColors.gray[300]:t.accentColors.gray[500]}})),[s,e.quickSearchMode]);return(0,K.jsx)(T.ZP,{renderTooltip:()=>(0,K.jsx)(K.Fragment,{children:(0,K.jsx)("div",{children:t?(0,K.jsx)(p.FormattedMessage,{id:"searchInputMenuItem.filterBarToggleButtonTooltip.hide",defaultMessage:"Hide filters"}):(0,K.jsx)(p.FormattedMessage,{id:"searchInputMenuItem.filterBarToggleButtonTooltip.show",defaultMessage:"Show filters"})})}),placement:T.ug.Bottom,alignment:T.v2.Start,disableTooltip:r.device.isMobile,delayThreshold:400,render:e=>(0,K.jsx)(w.Z,{...e,icon:e=>(0,l.I)(n.icon),ariaLabel:"Button to toggle the filter bar",style:n.container,hoveredStyle:n.hoveredContainerStyles,onClick:()=>t?I.ZP.collapseFilterBar():I.ZP.expandFilterBar()})})}G.displayName="SearchInputMenuItem",G.messages=(0,p.defineMessages)({open:{id:"search.inputMenu.suggestedText.open",defaultMessage:"Open"}});const Q=(0,p.injectIntl)(G);function X(e,t){const{currentSpaceStore:s,mainEditorCurrentBlockStore:r}=y.default.state,n=s&&(0,x.rn)(t,s);if(n&&b.Z.showSearchAiFeatures())return e.formatMessage({id:"searchInputMenuItem.placeholder.SearchOrAskQuestionInSpace",defaultMessage:"Search or ask question in {spaceName}"},{spaceName:n});if(n)return e.formatMessage({id:"searchInputMenuItem.placeholder.searchInSpace",defaultMessage:"Search {spaceName}"},{spaceName:n});if(r){const t=u.Jcv(r.getTitleValue()).slice(0,100);return e.formatMessage({id:"searchInputMenuItem.placeholder.namedPage",defaultMessage:"Search in {pageTitle}"},{pageTitle:t})}return e.formatMessage({id:"searchInputMenuItem.placeholder.unnamedPage",defaultMessage:"Search in page"})}function Y(e){return{inputDesktop:{boxShadow:`0 1px 0 ${e.regularDividerColor}`},inputMobile:{background:e.inputBackground},searchIcon:{fill:e.mediumIconColor}}}function J(){I.ZP.resetQuery({resetFilters:!0}),I.ZP.update((e=>({...e,source:"quick_find"})))}},82063:(e,t,s)=>{s.d(t,{Z:()=>A});var r=s(67294),n=s(480),i=s(86628),o=s(72126),a=s(33991),l=s(75822),d=s(32470),c=s(59054),u=s(21202),h=s(94804),p=s(92338),m=s(97880),g=s(63143),f=s(51787),v=s(59139),x=s(97638),S=s(18245),y=s(49038),b=s(80444),M=s(88632),C=s(77080),I=s(69327),w=s(84166),k=s(68373),j=s(55320),P=s(30857),T=s(29026);function R(e){let{dependencies:t,debugColumnStore:s,localDebounce:r=75,fetchServerResultsFn:a,searchResultStore:l,permanentFilterOverride:d,enabled:u,preventUpdateSearchMetrics:h}=e;const p=(0,n.O7)(),m=(0,i.VK)((()=>function(e){const{isOnline:t,debugColumnStore:s}=e,r=s.state.searchExperimentOverrides;function n(e){return(null==r?void 0:r[e])??C.default.getGroup(e,{disableExposureLogging:!0})}return{shouldSearchLocal:"on"!==n("search-no-local-blending")&&t,forcedClusterPattern:s.state.forcedClusterPattern,searchExperimentOverrides:s.state.searchExperimentOverrides,forcedBlockIds:s.state.forcedBlockIds}}({isOnline:t.isOnline,debugColumnStore:s})),[t.isOnline,s]);(0,c.r5)((()=>u?async function(e){var t;const{query:s,openAsPage:r,store:n,fetchServerResultsFn:i}=e;if(r&&o.Xy(s,n.state.selectedQueryResultQuery))return;"quick_find_scroll"!==T.ZP.state.source&&function(e){const{shouldSearchLocal:t,parentStore:s,environment:r,query:n,debug:i,limit:o,hasPublicAccessPermission:a,isOnline:l,store:d,permanentFilterOverride:c,preventUpdateSearchMetrics:u}=e;let h;const p={...n,filters:{...n.filters,...c}};t?(h=x.b9(function(e){const{parentStore:t,requestInput:s,isOnline:r,environment:n,hasPublicAccessPermission:i,localSearchCache:o}=e,{query:a}=s;if(!o)return;if(!a.text.trim())return;if(i)return;const l=S.default.mark("rum.local_quick_search_query"),d=void 0,c=(0,y.Y)({query:s,localCachedPages:o,parentStore:t,environment:n,isOnline:r,shouldLimitLocalResultsWhenOnline:!0,applyScoreThresholdWhenOnline:!0,maxLocalResultsOverride:d,canUseLtr:!0});return S.default.measure(l,{environment:n}),c}({parentStore:s,environment:r,requestInput:{query:p,debug:i,limit:o},hasPublicAccessPermission:a,isOnline:l,localSearchCache:w.Z.state.localSearchableBlocksCache})),u||P.default.update((e=>({...e,numLocalRequests:e.numLocalRequests+1}))),d.update((e=>({...e,localResults:h})))):d.update((e=>({...e,localResults:void 0})))}(e);const a=new Set;null===(t=n.state.localResults)||void 0===t||t.results.forEach((e=>a.add(e.id))),await i({...e,excludedBlockIds:[...a]})}({...t,...m,store:l,fetchServerResultsFn:a,environment:p,permanentFilterOverride:d,preventUpdateSearchMetrics:h}):Promise.resolve()),[t,m,l,a,p,d,u,h],{debounce:r})}async function F(e){var t,s,r;let{parentStore:n,environment:i,query:o,debug:a,isOnline:l,publicAccessPermissionAncestorBlockId:d,currentSpaceStore:c,searchExperimentOverrides:y,forcedClusterPattern:b,store:M,forcedBlockIds:C,limit:w,permanentFilterOverride:R,excludedBlockIds:F,preventUpdateSearchMetrics:B}=e;const Z={...o,filters:{...o.filters,...R}};if(!Z.text.trim()&&!x.FN(Z.filters))return;const A=T.ZP.state.source,_="quick_find_scroll"===A,O=_||0===P.default.state.numServerRequests;M.update((e=>{var t;return{...e,serverResultsLoading:!0,...O?{serverResults:e.serverResults,serverEventProperties:null===(t=e.serverResults)||void 0===t?void 0:t.serverEventProperties}:{serverResults:void 0,serverEventProperties:void 0}}})),B||P.default.update((e=>({...e,numServerRequests:e.numServerRequests+1})));const L=(0,h.A7)({searchSessionId:j.default.state.sessionId,searchSessionFlowNumber:P.default.state.numServerRequests}),E={query:Z,debug:a,limit:w},D=await async function(e){const{parentStore:t,requestInput:s,isOnline:r,environment:n,publicAccessPermissionAncestorBlockId:i,searchSessionId:o,searchSessionFlowNumber:a,source:l,spaceId:d,searchExperimentOverrides:c,forcedClusterPattern:h,forcedBlockIds:f,excludedBlockIds:v}=e;if(!r)return{error:p.Ix.Offline};const y=S.default.mark("rum.server_quick_search_query"),b=await x.MS({environment:n,input:s,spaceId:d,publicAccessPermissionAncestorBlockId:i,searchSessionId:o,searchSessionFlowNumber:a,source:l,searchExperimentOverrides:c,forcedClusterPattern:h,recentPagesForBoosting:d&&"on"!==(null==c?void 0:c["search-debug-only-no-recent-boosting"])?I.Z.getWithoutSubscribing(d):[],forcedBlockIds:f,excludedBlockIds:v});if(!b)return;if("failed"===b.type)return b.offline?{error:p.Ix.Offline}:{error:p.Ix.RequestFailed};const{trackEventProperties:M,results:C,total:w,debug:j,clusterInfo:P}=b.data,T=(0,g.m8)((0,m.qP)(M).map((e=>{let[t,s]=e;return[`server-${t}`,s]}))),R=C.map(((e,s)=>({...e,serverEventProperties:T,originalPosition:s,store:k.G.createChildStore(t,{table:u.iU,id:e.id})})));return S.default.measure(y,{environment:n}),{value:{results:R,total:w,debugInfo:j,serverEventProperties:T,clusterInfo:P}}}({parentStore:n,environment:i,requestInput:E,spaceId:null==c?void 0:c.id,searchSessionId:j.default.state.sessionId,searchSessionFlowNumber:P.default.state.numServerRequests,publicAccessPermissionAncestorBlockId:d,isOnline:l,source:A,searchExperimentOverrides:y,forcedClusterPattern:b,forcedBlockIds:C,excludedBlockIds:F});if(L!==(0,h.A7)({searchSessionId:j.default.state.sessionId,searchSessionFlowNumber:P.default.state.numServerRequests}))return;if(!D||D.error)return M.update((e=>({...e,serverError:null==D?void 0:D.error,serverResultsLoading:!1,serverResults:void 0,serverEventProperties:void 0})));const V=x.b9(D),q=_?x.Nu({existingResults:M.state.serverResults,newPageResults:V}):V,N=D.value.results;M.update((e=>({...e,serverError:null==D?void 0:D.error,serverResultsLoading:!1,serverResults:q,serverResultsAllLoaded:N.length<w,serverEventProperties:D.value.serverEventProperties})));const W=(null==q?void 0:q.results.map((e=>{var t;return{id:e.id,badges:(null===(t=e.badges)||void 0===t?void 0:t.map((e=>e.type)))??[]}})))??[],K=new Map;for(const{badges:u}of W)for(const e of u){const t=K.get(e)??0;K.set(e,t+1)}const{sections:U}=x.IV({intentBasedGrouping:(0,v.XP)(),localResults:null===(t=M.state.localResults)||void 0===t?void 0:t.results,serverResults:null==q?void 0:q.results}),z={};for(const[u,h]of Object.entries(U))z[u]=h.map((e=>e.id));f.Zf(i,{numLocalResults:(null===(s=M.state.localResults)||void 0===s?void 0:s.results.length)||0,numServerResults:(null==q?void 0:q.results.length)||0,localResultsIds:(null===(r=M.state.localResults)||void 0===r?void 0:r.results.map((e=>e.id)))||[],...D.value.serverEventProperties,badgeCounts:K,badgesByResultId:W,idsBySection:z})}const B=(0,o.Ds)(F,l.rE),Z=(0,o.Ds)(F,l.rE);function A(){const e=(0,n.Fy)(),{searchResultStore:t,secondarySearchResultStore:s}=(0,r.useContext)(a.SearchStaticContext),{parentStore:o}=(0,r.useContext)(a.SearchStoresContext),l=function(e){const t=(0,n.O7)();return(0,i.VK)((()=>{const{hasPublicAccessPermission:s,publicAccessPermissionAncestorBlockId:r}=x.bC(t);return{isOnline:Boolean(M.Z.state.online),limit:T.ZP.state.limit,parentStore:e,hasPublicAccessPermission:s,publicAccessPermissionAncestorBlockId:r,currentSpaceStore:b.default.state.currentSpaceStore,debug:d.ZP.getDebugLevel(),openAsPage:j.default.state.openAsPage,currentSpaceViewStore:b.default.state.currentSpaceViewStore,query:T.ZP.state.query}}),[t,e])}(o),c=(0,i.VK)((()=>Boolean((0,d.gq)({device:e})&&d.BJ.state.visible)),[e]);R({dependencies:l,searchResultStore:t,debugColumnStore:d.v_,enabled:!0,fetchServerResultsFn:B}),R({dependencies:l,searchResultStore:s,debugColumnStore:d.BJ,enabled:c,fetchServerResultsFn:Z,preventUpdateSearchMetrics:!0})}},49038:(e,t,s)=>{s.d(t,{Y:()=>F,f:()=>R});var r=s(58573),n=s(72126),i=s(4615),o=s(21202),a=s(45366),l=s(92338),d=s(97978),c=s(97638),u=(s(57658),s(80444)),h=s(46735),p=s(42198);const m=e=>{var t;let{result:s,featureExtractor:r}=e;const n=null===(t=r.frecencyStore)||void 0===t?void 0:t.getFrecencyScore(s.block.blockModel.id);return{name:"FRECENCY_SCORE",value:n||0}},g=e=>{let{result:t}=e;return{name:"LEXICAL_MATCH_SCORE",value:t.score}},f={name:"CLIENT_FEATURESET_V2_RAW",features:[e=>{let{result:t}=e;return{name:"IS_EXACT_MATCH",value:t.matchMetadata&&"isExactMatch"in t.matchMetadata?1:0}},e=>{let{result:t}=e;return{name:"IS_PREFIX_MATCH",value:t.matchMetadata&&"isPrefixMatch"in t.matchMetadata?1:0}},e=>{let{result:t}=e;return{name:"IS_WORD_PREFIX_MATCH",value:t.matchMetadata&&"isWordPrefixMatch"in t.matchMetadata?1:0}},e=>{let{result:t}=e;return{name:"IS_SUBSTRING_MATCH",value:t.matchMetadata&&"isSubstringMatch"in t.matchMetadata?1:0}},e=>{let{result:t}=e;return{name:"IS_FUZZY_MATCH",value:t.matchMetadata&&"isFuzzyMatch"in t.matchMetadata?1:0}},e=>{let{result:t}=e;return{name:"IS_FRECENT_PAGE",value:t.block.source.has("frecencyStore")?1:0}},e=>{let{result:t}=e;return{name:"IS_BOOKMARKED_PAGE",value:t.block.source.has("bookmarkedPage")?1:0}},e=>{let{result:t}=e;return{name:"IS_TEAM_PAGE",value:t.block.source.has("teamPage")?1:0}},e=>{let{result:t}=e;return{name:"IS_SHARED_PAGE",value:t.block.source.has("sharedPage")?1:0}},e=>{let{result:t,featureExtractor:s}=e;const[r,n]=s.getFrecencyScoreBounds();return{name:"FRECENCY_SCORE_SCALED",value:s.minMaxScale(m({result:t,featureExtractor:s}).value,r,n)}},e=>{let{result:t}=e;return{name:"IS_RECENT_VISIT_BY_ME",value:t.block.source.has("recentVisit")?1:0}},e=>{let{result:t}=e;return{name:"TIME_SINCE_LAST_VIEWED_BY_ME",value:t.block.timeSinceLastViewedMs??-1}},e=>{let{result:t,featureExtractor:s}=e;return{name:"IS_SIMILAR_USER_1D_RECENT_PAGE",value:p.default.isSimilarUsersRecentPages({userId:s.userId,spaceId:s.spaceId,pageId:t.block.blockModel.id})?1:0}},e=>{let{result:t,featureExtractor:s}=e;return{name:"NUM_SIMILAR_USERS_VIEWED_PAGE",value:p.default.getNumSimilarUsersVisitedPage({userId:s.userId,spaceId:s.spaceId,pageId:t.block.blockModel.id})||0}},e=>{let{result:t,featureExtractor:s}=e;return{name:"PAGE_MOST_SIMILAR_VIEWER_SIMILARITY",value:p.default.getHighestViewerSimilarityScoreForPage({userId:s.userId,spaceId:s.spaceId,pageId:t.block.blockModel.id})||0}},e=>{let{result:t,featureExtractor:s}=e;const r=p.default.getSimilarUsersMostRecentVisitTimeForPage({userId:s.userId,spaceId:s.spaceId,pageId:t.block.blockModel.id});return{name:"TIME_SINCE_SIM_USER_VISIT",value:r?s.currentTimeMs-r:-1}},e=>{let{result:t,featureExtractor:s}=e;return{name:"IS_TOP_PAGES_7D_PAGE_VIEWS",value:p.default.isTopPages7dPageView({userId:s.userId,spaceId:s.spaceId,pageId:t.block.blockModel.id})?1:0}},e=>{let{result:t,featureExtractor:s}=e;return{name:"PAGE_AUTHORITY_V1",value:p.default.getPageAuthorityV1ForPage({userId:s.userId,spaceId:s.spaceId,pageId:t.block.blockModel.id})||0}},e=>{let{result:t,featureExtractor:s}=e;return{name:"TIME_SINCE_LAST_EDIT",value:s.currentTimeMs-t.block.blockModel.last_edited_time}},e=>{let{result:t,featureExtractor:s}=e;return{name:"IS_LAST_EDITED_BY_ME",value:s.userId&&t.block.blockModel.last_edited_by_id===s.userId?1:0}},e=>{let{result:t}=e;return{name:"IS_LAST_EDITED_BY_ME_WITHIN_12H",value:t.block.source.has("defaultRecordCache")?1:0}},e=>{let{result:t,featureExtractor:s}=e;return{name:"TIME_SINCE_LAST_EDITED_BY_ME",value:p.default.getUserLastEditedTimeForPage({userId:s.userId,spaceId:s.spaceId,pageId:t.block.blockModel.id})??-1}},e=>{let{result:t,featureExtractor:s}=e;return{name:"TIME_SINCE_SIM_USER_LAST_EDIT",value:p.default.getSimilarUserLastEditedTimeForPage({userId:s.userId,spaceId:s.spaceId,pageId:t.block.blockModel.id})??-1}},g,m]};function v(e){let t=0,s=0;for(const r of e)r<t&&(t=r),r>s&&(s=r);return[t,s]}class x{constructor(e,t,s){var r;this.featuresets=void 0,this.frecencyStore=void 0,this.results=void 0,this.resultsFeatureMetadata={},this.userId=void 0,this.spaceId=void 0,this.currentTimeMs=void 0,this.frecencyStore=h.Z.lazyFrecencyStore.get(t.currentUser.id),this.featuresets=e,this.results=s,this.userId=t.currentUser.id,this.spaceId=null===(r=u.default.state.currentSpaceStore)||void 0===r?void 0:r.id,this.currentTimeMs=Date.now()}minMaxScale(e,t,s){return t===s?0:(e-t)/(s-t)}getFrecencyScoreBounds(){if(!this.resultsFeatureMetadata.minFrecencyScore||!this.resultsFeatureMetadata.maxFrecencyScore){const e=this.results.map((e=>m({result:e,featureExtractor:this}).value||0)),[t,s]=v(e);this.resultsFeatureMetadata.minFrecencyScore=t,this.resultsFeatureMetadata.maxFrecencyScore=s}return[this.resultsFeatureMetadata.minFrecencyScore,this.resultsFeatureMetadata.maxFrecencyScore]}getLexicalMatchScoreBounds(){if(!this.resultsFeatureMetadata.minLexicalMatchScore||!this.resultsFeatureMetadata.maxLexicalMatchScore){const e=this.results.map((e=>g({result:e,featureExtractor:this}).value||0)),[t,s]=v(e);this.resultsFeatureMetadata.minLexicalMatchScore=t,this.resultsFeatureMetadata.maxLexicalMatchScore=s}return[this.resultsFeatureMetadata.minLexicalMatchScore,this.resultsFeatureMetadata.maxLexicalMatchScore]}extractFeatureGroup(e){const t=[];for(const s of this.featuresets){const r={groupName:s.name,features:[]};for(const t of s.features)r.features.push(t({result:e,featureExtractor:this}));t.push(r)}return t}}var S=s(29026);var y=s(77080),b=s(26842),M=s(88893),C=s(43759);function I(e){const{results:t,featureGroups:s}=e;return t.map(((e,t)=>{const{block:r,score:n,personalizationBoost:i,rendered:o,terms:a}=e;return{sources:[l.vp.Local],id:r.blockModel.id,spaceId:r.blockModel.space_id,score:n,localSource:r.source,personalizationBoost:i,terms:a,highlight:{text:o},featureGroups:s[t]}}))}function w(e){return e.has("recentVisit")||e.has("frecencyStore")||e.has("bookmarkedPage")||e.has("defaultRecordCache")?1.25:1}function k(e,t,s){const r=e=>s.matches(e.block),n=(0,a.wS)(t);if(1===n.length)return e.search(t,{filter:r,prefix:!0,fields:["text","inits"]});const i=e.search(t,{filter:r,combineWith:"AND",fields:["text"]});if(i.length>0)return i;const o=n.filter((e=>e.length>=C.Q)),l=(d=o.length,Math.round(.6*d+.5));var d;return e.search(t,{filter:e=>e.queryTerms.length>=l&&r(e)})}const j=e=>e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");function P(e){const{block:t,score:s,terms:r}=e,{source:n,text:i}=t,o=r.map(j).join("|"),a=new RegExp(o,"ig");return{block:t,rendered:r.length>0?i.replaceAll(a,`${l.Um}$&${l.dK}`):i,score:s,personalizationBoost:w(n),terms:r}}function T(e,t,s,o,a){const{blocks:d,getAllBlocks:u}=e,h=a.text.trim(),p=(0,i.nv)(h),m=p.length>0?p.join(" "):h,g=new c.uL(s),f="minisearch"===t||"minisearch-frecency"===t;return f&&m.length>0?function(e,t,s){return k(e,t,s).map(P)}(d,m,g):f?u().filter((e=>g.matches(e.block))).map(P):((e,t,s,i,o)=>n.oA(e.map((e=>{if(!t.matches(e))return;let n;if(n=i.includes(e.blockModel.id)?{rendered:"",score:r.$r,matchMetadata:{isExactIdMatch:!0}}:(0,r.C6)(s,e.text,{pre:l.Um,post:l.dK,ignoreFuzzyFallback:o}),n){const{rendered:t,score:s}=n;return{block:e,rendered:t,score:s,personalizationBoost:w(e.source),terms:[]}}}))))(u().map((e=>{let{block:t}=e;return t})),g,h,p,o)}function R(e){let{query:t,localCachedPages:s,userId:i,includeRecordMap:o,environment:a,applyRecallScoreThreshold:l,canUseLtr:u}=e;const{query:h,limit:p}=t,{filters:m,sort:g}=h,v=y.default.getEligibleGroup({experimentId:"search-client-page-match"}),b=T(s,v,m,l,h);if(0===b.length)return;const C=function(e,t){const{field:s}=e,r="relevance"===s||"desc"===e.direction?-1:1;switch(s){case"lastEdited":case"scroll":return n.MR(t,(e=>{let{block:{blockModel:t}}=e;return r*(t.last_edited_time||0)}));case"created":return n.MR(t,(e=>{let{block:{blockModel:t}}=e;return r*(t.created_time||0)}));default:return n.MR(t,(e=>{let{score:t}=e;return r*t}))}}(g,b);u&&(0,d.j)(a,"search_local_recall_results",{num_visible_members:(0,M.qX)(),results:C.map((e=>({id:e.block.blockModel.id,localSource:[...e.block.source]})))});let w;if("relevance"===g.field&&"minisearch"!==v)if(t.query.text.length>1&&u){const e=C.map((e=>({...e,matchMetadata:(0,r.EB)(t.query.text,e.block.text)}))),s=new x([f],a,e);w=function(e){const{sort:t,currentUserId:s,unsorted:r}=e;return(0,c.YB)({sort:t,currentUserId:s,unsorted:r,batchSize:S.Xv})}({sort:g,unsorted:I({results:C,featureGroups:e.map((e=>s.extractFeatureGroup(e)))}),currentUserId:i})}else w=(0,c.YB)({sort:g,currentUserId:i,unsorted:I({results:C,featureGroups:C.map((e=>[]))}),batchSize:S.Xv});else w=I({results:C,featureGroups:C.map((e=>[]))});w=w.slice(0,p);const k=o??!0;return{total:b.length,results:w,recordMap:k?s.recordMap.toJson({allowVersionDowngrade:!1}):{},trackEventProperties:void 0}}function F(e){let{query:t,localCachedPages:s,parentStore:r,isOnline:n,environment:i,shouldLimitLocalResultsWhenOnline:a,applyScoreThresholdWhenOnline:d,maxLocalResultsOverride:u,canUseLtr:h}=e;const p=R({query:t,localCachedPages:s,userId:i.currentUser.id,environment:i,applyRecallScoreThreshold:n&&d,canUseLtr:h});if(!p)return;if(0===p.results.length)return{error:l.Ix.NoResults};let m=p.results.map(((e,t)=>({...e,originalPosition:t,store:b.G.createChildStore(r,{table:o.iU,id:e.id}),serverEventProperties:void 0})));const g=m.length;return n&&a&&(m=(0,c.g8)(i,m,u)),0===m.length?{error:l.Ix.NoResults}:{value:{total:g,results:m,debugInfo:void 0}}}},86706:(e,t,s)=>{s.d(t,{K9:()=>S,Uy:()=>x,nx:()=>h});s(57658);var r=s(67294),n=s(480),i=s(24405),o=s(72126),a=s(9291),l=s(74194),d=s(85893);const c=["control+t","control+shift+n","control+shift+t","control+w","control+shift+w","control+r","control+shift+r","control+shift+i","control+\\","control+=","control+-","control+0","control+[","control+]","control+shift+tab","control+tab","control+1","control+2","control+3","control+4","control+5","control+6","control+7","control+8","control+9"],u=["command+,","command+t","command+shift+n","command+shift+t","command+w","command+shift+w","command+r","command+shift+r","alt+command+i","command+\\","command+=","command+-","command+0","command+[","command+]","control+shift+tab","control+tab","command+option+left","command+option+right","command+shift+[","command+shift+]","command+1","command+2","command+3","command+4","command+5","command+6","command+7","command+8","command+9"];function h(e){function t(){return e.shortcut?x(e.shortcut):void 0}window.__c={n:"KeyboardGlobalShortcutSettingInput"};const{isMac:s,isWindows:h}=(0,n.Fy)(),{KeyboardShortcutStackStore:y}=(0,n.O7)(),[b,M]=(0,r.useState)(t()),[C,I]=(0,r.useState)(new Set([])),[w,k]=(0,r.useState)(),[j,P]=(0,r.useState)(!1),T=(0,r.useRef)(!1),R=(0,r.useRef)(!1),F=(0,r.useRef)(!1),B=(0,i.yK)((e=>({container:{display:"flex",flexDirection:"column",gap:10,alignItems:"flex-end"},takenShortcutError:{color:e.accentColors.red[500],fontSize:12}})),[]);function Z(){if(b&&F.current)if(b.key)if(s?b.control||b.option||b.command:b.control||b.option)if(function(e,t,s){for(const n of Object.values(e.shortcutMap))for(const e of n)if(o.Xy(x(e),t))return!0;const r=s?u:c;for(const n of r)if(o.Xy(x(n),t))return!0;return!1}(y,b,s)){M(t());const e=S(b,s);k((0,d.jsx)(a.FormattedMessage,{id:"desktopQuickSearch.error.shortcutAlreadyUsed",defaultMessage:"{reservedShortcut} is already used",values:{reservedShortcut:e}}))}else{const t=function(e,t){const s=[];e.shift&&s.push("shift");e.control&&(t?s.push("control"):s.push("ctrl"));e.option&&(t?s.push("option"):s.push("alt"));e.command&&(t?s.push("command"):s.push("meta"));e.key&&s.push(e.key.toLowerCase());return s.join("+")}(b,s);e.onChange(t)}else M(t()),k(s?(0,d.jsx)(a.FormattedMessage,{id:"desktopQuickSearch.error.macModifierRequired",defaultMessage:"Use one of Option, Control, or Command for global keyboard shortcuts"}):(0,d.jsx)(a.FormattedMessage,{id:"desktopQuickSearch.error.windowsModifierRequired",defaultMessage:"Use one of Control or Alt for global keyboard shortcuts"}));else M(void 0);else F.current||M(t());T.current=!0,P(!1),F.current=!1}function A(e){if(h&&e.startsWith("Meta"))return;const t=new Set([...C,e]),s=function(e){const t={};for(const s of e)s.startsWith(m)?t.command=!0:s.startsWith(f)?t.option=!0:s.startsWith(g)?t.shift=!0:s.startsWith(v)?t.control=!0:s.startsWith("Key")?t.key=s.substring(3).toLowerCase():s.startsWith("Digit")?t.key=s.substring(5):p[s]&&(t.key=p[s]);return 0===Object.values(t).filter((e=>!o.o8(e))).length?void 0:t}(t);I(t),M(s),k(void 0),F.current=!0}return(0,d.jsxs)("div",{style:B.container,children:[(0,d.jsx)(l.Z,{onKeyDown:function(e){R.current=!0,"Escape"===e.key?e.currentTarget.blur():"Tab"!==e.key&&(e.preventDefault(),e.stopPropagation(),A(e.code))},onKeyUp:function(e){R.current&&function(e){const t=new Set([...C]);if(t.delete(e),e.startsWith("Meta"))for(const s of t)s.startsWith(g)||s.startsWith(f)||s.startsWith(v)||t.delete(s);I(t),0===t.size&&Z()}(e.code)},onFocus:function(e){M(void 0),P(!0)},onBlur:function(e){T.current||Z(),T.current=!1,R.current=!1,I(new Set),P(!1)},focus:j,readOnly:!0,inputStyle:{textAlign:"center",caretColor:"transparent"},value:b&&S(b,s)}),w&&(0,d.jsx)("div",{style:B.takenShortcutError,children:w})]})}const p={ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",Backquote:"`",Backslash:"\\",Backspace:"backspace",BracketLeft:"[",BracketRight:"]",Comma:",",Delete:"delete",Enter:"return",Equal:"=",Minus:"-",Period:".",Quote:"'",Semicolon:";",Slash:"/",Space:"space"},m="Meta",g="Shift",f="Alt",v="Control";function x(e){const t={};for(let s of e.split("+"))s=s.toLowerCase(),"command"===s||"meta"===s?t.command=!0:"option"===s||"alt"===s?t.option=!0:"shift"===s?t.shift=!0:"control"===s||"ctrl"===s?t.control=!0:t.key=s;return t}function S(e,t){const s=[];if(e.shift&&(t?s.push("shift"):s.push("Shift")),e.control&&(t?s.push("control"):s.push("Ctrl")),e.option&&(t?s.push("option"):s.push("Alt")),e.command&&(t?s.push(""):s.push("Win")),e.key){const t=1===e.key.length?e.key.toUpperCase():e.key;s.push(t)}return s.join("+")}},63334:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(49085);class n extends r.default{getInitialState(){return{}}}const i=n},25904:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(49085);class n extends r.default{getInitialState(){return{open:!1}}}const i=new n},30857:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var r=s(49085);class n extends r.default{getInitialState(){return{selectedQueryResult:!1,numKeystrokes:0,numServerRequests:0,numLocalRequests:0,hadMetaClick:!1,firstKeyStrokeTimeMs:void 0}}}const i=new n},54983:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(49085);class n extends r.default{getInitialState(){return{}}}const i=n},45366:(e,t,s)=>{s.d(t,{wS:()=>i});var r=s(72126);const n=/[-./\\()"',;<>~!@#$%^&*|+=[\]{}`~?:\s]/u;function i(e){return(0,r.oA)(e.split(n))}}}]);