"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5998],{42807:(e,t,o)=>{o.r(t),o.d(t,{default:()=>X});var i=o(67294),s=o(83355),n=o(15145),r=o(92996),a=o(84619),l=o(22225),d=o(13148),p=o(12217),c=o(58810),u=o(17683),h=o(32240),g=o(47453),m=o(98519),M=o(72126),f=o(82990),S=o(9291),k=o(50906),x=o(26999),R=o(28651),b=o(48543),y=o(73744),v=o(12534),P=o(33929),w=o(39500),C=o(29376),j=o(86098),I=o(19671),L=o(88923),T=o(97039),O=o(78030),B=o(53876),F=o(64921),Z=o(5145),D=o(50478),_=o(73063),E=o(11470),A=o(26388),V=o(25845),U=o(85893);const z=(0,S.defineMessages)({openAsPageTitle:{defaultMessage:"Open",id:"database.navigateButton.openAsPageTitle"}});class H extends s.Z{constructor(){var e;super(...arguments),e=this,this.outerRef=i.createRef(),this.relationTokenBlockStoreRef=i.createRef(),this.storeTypes={mouseStore:R.Z},this.isSprintsTypedProperty=this.createComputedStore((()=>this.props.targetCollectionStore.getFormatStore().getKeyStore("app_config_uri").getValue()===r.p$)),this.renderOuterDesktopRelationRow=(e,t,o,i,s,n,r)=>(0,U.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%"},ref:this.outerRef,children:["section"===t&&this.stores.mouseStore.state.mouseEntered&&o&&(0,U.jsx)(A.ZP,{renderTooltip:()=>(0,U.jsx)(S.FormattedMessage,{defaultMessage:"Drag <medium>to move</medium>",id:"database.relationMenuRow..dragPrompt.text",values:{medium:e=>(0,U.jsx)("span",{style:{color:this.theme.mediumInvertedTextColor},children:e})}}),render:e=>(0,U.jsx)(_.Z,{hasBackground:!1,ariaLabel:"Drag to move a related page",icon:p.D,iconStyle:{width:14,height:14,fill:this.theme.lightIconColor},hoveredStyle:{borderRadius:4},style:{cursor:"grab",width:D.C$+4,marginLeft:-(D.C$+4),height:24,borderRadius:4},...e})}),"section"===t?(0,U.jsx)("div",{style:G(this.props.rowType,this.theme,i),onContextMenu:e=>Y(e,this.environment),onMouseEnter:n,onMouseLeave:r,onClick:this.handleRelationSectionRelationMenuRowClick,role:"button","aria-label":"Editable title","aria-disabled":this.props.disabled,tabIndex:this.props.disabled?-1:0,children:e}):(0,U.jsx)("div",{style:G(this.props.rowType,this.theme,i),onContextMenu:e=>Y(e,this.environment),onMouseEnter:n,onMouseLeave:r,role:"button",tabIndex:this.props.disabled?-1:0,"aria-disabled":this.props.disabled,onClick:e=>{(0,v.ZP)({event:e,context:v.Af.EditorClick,callback:()=>{(0,w.uG)(e)||(s?s(this.outerRef.current):this.handleButtonClick(e,this.isSprintsTypedProperty.state))}})},children:e})]}),this.renderInnerRelationMenuRow=(e,t,o,i,s,n,r,a,d,p,c)=>{const u="section"===o&&!this.props.disabled&&t.canEdit()&&!i.isMobile,h=C.BI(this.props.collectionStore.getSchema(),this.props.property);let m,M;return m=a?h?(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.removePR.message",defaultMessage:"Unlink PR"}):(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.removePage.message",defaultMessage:"Unlink page"}):h?(0,U.jsx)(S.FormattedMessage,{defaultMessage:"Link PR",id:"database.relationMenuRow.tooltip.addPR.message"}):(0,U.jsx)(S.FormattedMessage,{defaultMessage:"Link page",id:"database.relationMenuRow.tooltip.addPage.message"}),M="section"===o&&a?h?(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.insertPRInline.message",defaultMessage:"Insert new PR"}):(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.insertPageInline.message",defaultMessage:"Insert new page"}):h?(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.insertPR.message",defaultMessage:"Link another PR"}):(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.insertPage.message",defaultMessage:"Link another page"}),(0,U.jsxs)(U.Fragment,{children:[e&&"popup"===o&&(0,U.jsx)(Z.ZP,{iconSize:12,style:{marginLeft:2,height:20}}),i.isPhone?this.renderRelationToken(i,u):this.renderRelationProperties(i,u),(s||n)&&(0,U.jsxs)("div",{style:J(this.theme,s||n,!1),children:[s&&(0,U.jsx)(W,{isOpenPage:!1,ariaLabel:a?"Unlink page":"Link page",onClick:d,style:{borderRadius:3},icon:a?l.g:g.R,tooltipMessage:m}),n&&p&&(0,U.jsx)(W,{isOpenPage:!1,ariaLabel:"section"===o&&a?"Insert new page":"Link another page",onClick:()=>p(this.outerRef.current),style:{borderRadius:0},icon:g.R,tooltipMessage:M})]}),r&&c&&this.renderRelationMenuRowOpenPageButton(s,n,c)]})},this.renderRelationMenuRowOpenPageButton=(e,t,o)=>(0,U.jsx)("div",{style:J(this.theme,e||t,!0),children:(0,U.jsx)(W,{isOpenPage:!0,ariaLabel:"side_peek"===this.peekModeStore.state?"Open in side peek":"center_peek"===this.peekModeStore.state?"Open in center peek":"Open as page",onClick:o,style:{width:60},icon:"side_peek"===this.peekModeStore.state?h.y:"center_peek"===this.peekModeStore.state?u.Q:c.Z,tooltipMessage:"side_peek"===this.peekModeStore.state?(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.openPageSidePeek.message",defaultMessage:"Open in side peek"}):"center_peek"===this.peekModeStore.state?(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.openPageCenterPeek.message",defaultMessage:"Open in center peek"}):(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.openPage.message",defaultMessage:"Open as page"})})}),this.renderSprintsInnerRelationMenuRow=(e,t,o,i,s,n,r,a,d,p,c)=>{const u="section"===o&&!this.props.disabled&&t.canEdit()&&!i.isMobile;return(0,U.jsxs)(U.Fragment,{children:[e&&"popup"===o&&(0,U.jsx)(Z.ZP,{iconSize:12,style:{marginLeft:2,height:20}}),i.isPhone?this.renderRelationToken(i,u):this.renderRelationProperties(i,u),a&&"popup"===o&&(0,U.jsx)("div",{style:{display:"inline-flex",marginLeft:"auto",alignItems:"center",justifyContent:"center",padding:0,height:24},children:(0,m.k)({width:16,height:16,fill:this.theme.regularIconColor,display:"inline-flex",alignItems:"center",justifyContent:"center"})}),(s||n)&&(0,U.jsxs)("div",{style:J(this.theme,s||n,!1),children:[s&&(0,U.jsx)(W,{isOpenPage:!1,ariaLabel:a?"Remove this sprint":"Add this sprint",onClick:d,style:{borderRadius:3},icon:a?l.g:g.R,tooltipMessage:a?(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.removePage.messageSprints",defaultMessage:"Remove this sprint"}):(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.addPage.messageSprints",defaultMessage:"Add this sprint"})}),n&&p&&(0,U.jsx)(W,{isOpenPage:!1,ariaLabel:"section"===o&&a?"Insert new page":"Move to a different sprint",onClick:()=>p(this.outerRef.current),style:{borderRadius:0},icon:g.R,tooltipMessage:"section"===o&&a?(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.insertPageInline.message",defaultMessage:"Insert new page"}):(0,U.jsx)(S.FormattedMessage,{id:"database.relationMenuRow.tooltip.insertPage.messageSprints",defaultMessage:"Move to a different sprint"})})]}),r&&c&&this.renderRelationMenuRowOpenPageButton(s,n,c)]})},this.renderRelationToken=function(t,o){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{relatedPageStore:s,rowType:n,pageStore:r}=e.props;return(0,U.jsx)("div",{style:{display:"flex",alignItems:"center",flex:"0 1 auto",minHeight:0,...!i&&{minWidth:40},paddingLeft:"section"===n?4:6},children:(0,U.jsx)(V.Z,{ref:e.relationTokenBlockStoreRef,format:a.lo.Inline,blockId:s.id,isSingle:!0,parentStore:r,noUnderline:e.isSprintsTypedProperty.state,style:{display:"flex",alignItems:"center",margin:0,whiteSpace:"nowrap",marginRight:"section"===n?0:t.isTablet?8:0,minWidth:0},titleStyle:{...f.Z.textOverflowStyle,maxWidth:"100%"},clickTitleBehavior:o?"edit":void 0,onTitleEnter:e.props.onInsertInline,index:e.props.index},s.id)})},this.renderRelationProperties=(e,t)=>{const{relatedPageStore:o,targetCollectionStore:s,blockPropertyValueOverlayStore:n,rowType:r}=this.props,a=this.targetPropertiesToDisplay.state;if(M.xb(a))return;const l="section"!==r||(this.props.disabled||!o.canEdit()||this.environment.device.isMobile),d=a.map((a=>{if("title"===a.property){const o=this.isSprintsTypedProperty.state;return(0,U.jsx)(i.Fragment,{children:this.renderRelationToken(e,t,o)},"title")}return(0,U.jsx)(T.Z,{store:o,property:a.property,disabled:l,locked:!1,format:"section"===r?O.C.RelationSection:O.C.Relation,tableWrap:!1,blockPropertyValueOverlayStore:n??I.Z,collectionStore:s},a.property)}));return(0,U.jsx)("div",{style:{display:"flex",marginRight:8,maxHeight:22,alignItems:"center",...f.Z.textOverflowStyle},children:d})},this.targetPropertiesToDisplay=this.createComputedStore((()=>{const{collectionStore:e,targetCollectionStore:t,property:o}=this.props,i=t.getSchema();return i?C.U1({collectionStore:e,property:o}).filter((e=>e.visible&&("title"===e.property||i[e.property]))):[]}),!0),this.peekModeStore=this.createComputedStore((()=>{if(L.default.state.open)return L.default.state.mode;const{blockPropertyValueOverlayStore:e}=this.props,t=null==e?void 0:e.state;if(null==t||!t.isOpen||null==t||!t.collectionContextStore)return L.default.state.mode;const o=t.collectionContextStore,i=null==o?void 0:o.collectionViewStore(),s=null==i?void 0:i.getType();return i&&s?i.getFormat().collection_peek_mode??b.Ls[s]:L.default.state.mode})),this.handleMouseMove=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleButtonClick=(e,t)=>{const{collectionStore:o,targetCollectionStore:i,relatedPageStore:s,onActionButtonClick:r,disabled:a,rowType:l,blockPropertyValueOverlayStore:d,isSelected:p}=this.props;if(a||p){if(t)return;const r=y.DJ(e),a=o.id===i.id?L.default.state.resultsStore:void 0,p=o.id===i.id?L.default.state.collectionContextStore:void 0,c=L.default.isSidePeekOpen();if(x.CH({environment:this.environment,store:s,peekMode:this.peekModeStore.state,openInNew:r,resultsStore:a,collectionContextStore:p,pageVisitSource:n.tY.PeekOpen}),k.XX(this.environment,{from:"inline"===l||"section"===l?"property_value":"configure_relation_modal",meta_click:Boolean(r)}),"popup"===l&&!c){(d??I.Z).setState({isOpen:!1})}}else r(e)},this.handleRelationSectionRelationMenuRowClick=e=>{const{collectionStore:t,targetCollectionStore:o,isSelected:i,relatedPageStore:s,onActionButtonClick:r,disabled:a}=this.props;(0,v.ZP)({event:e,context:v.Af.EditorClick,callback:()=>{if(!(0,w.uG)(e))if(i||a){const i=y.DJ(e),r=t.id===o.id?L.default.state.resultsStore:void 0,a=t.id===o.id?L.default.state.collectionContextStore:void 0;x.CH({environment:this.environment,store:s,peekMode:this.peekModeStore.state,openInNew:i,resultsStore:r,collectionContextStore:a,pageVisitSource:n.tY.PeekOpen}),k.XX(this.environment,{from:"relation_section",meta_click:Boolean(i)})}else r(e)}})}}get registries(){return[j.Z]}renderComponent(){const{device:e}=this.environment;return e.isPhone&&"popup"===this.props.rowType?(0,U.jsx)($,{...this.props}):this.renderDesktopMenuItem()}renderDesktopMenuItem(){const{disabled:e,locked:t,canDrag:o,relatedPageStore:i,focused:s,isSelected:n,rowType:r,targetCollectionStore:a,onActionButtonClick:l,onSecondaryButtonClick:d,onOpenPageButtonClick:p,onMouseEnter:c,onMouseLeave:u}=this.props,{device:h}=this.environment,m=(h.isMobile||s)&&!t&&!e;if(this.isSprintsTypedProperty.state)return this.renderSprintsDesktopMenuItem();const f="section"!==r?(h.isMobile||s)&&!t&&!e:m,k=!t&&!e&&"section"===r&&!h.isMobile&&!(1===this.props.propertyLimit)&&a.canEdit(),x=!h.isMobile&&!t&&s&&!e&&("inline"===r||"section"===r)&&!M.o8(d),R=!h.isMobile&&s&&!e&&"section"===r&&!M.o8(p),b=this.renderInnerRelationMenuRow(o,i,r,h,f,x&&"section"!==r,R,n,l,d,p),y=this.theme.mediumInvertedTextColor;return(0,U.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"calc(100% + 48px)",paddingLeft:48,position:"relative",left:-48},onMouseEnter:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,ref:this.outerRef,children:[this.stores.mouseStore.state.mouseEntered&&k&&(0,U.jsx)(A.ZP,{renderTooltip:()=>(0,U.jsx)(S.FormattedMessage,{defaultMessage:"Click <medium>to insert a page below</medium>",id:"database.relationMenuRow.tooltip.floatingAddPageButton.message",values:{medium:e=>(0,U.jsx)("span",{style:{color:y},children:e})}}),render:e=>(0,U.jsx)(_.Z,{hasBackground:!1,ariaLabel:"Create a new related page",icon:g.R,iconStyle:{width:16,height:16,fill:this.theme.lightIconColor},onClick:this.props.onInsertInline,hoveredStyle:{borderRadius:4},style:{marginLeft:o?-44:-22,position:"absolute",marginRight:4},...e})}),this.renderOuterDesktopRelationRow(b,r,o,s,void 0,c,u)]})}renderSprintsDesktopMenuItem(){const{disabled:e,locked:t,canDrag:o,relatedPageStore:i,focused:s,isSelected:n,rowType:r,onActionButtonClick:a,onSecondaryButtonClick:l,onOpenPageButtonClick:d,onMouseEnter:p,onMouseLeave:c,propertyLimit:u}=this.props,{device:h}=this.environment,g=(h.isMobile||s)&&!t&&!e,m="section"!==r?(h.isMobile||s)&&!t&&!e&&1!==u&&"popup"===r&&n:g,f=!h.isMobile&&!t&&s&&!e&&!M.o8(l),S=!h.isMobile&&s&&!e&&("section"===r||"inline"===r)&&!M.o8(d),k=S,x=this.renderSprintsInnerRelationMenuRow(o,i,r,h,m,f&&!k&&"section"!==r,S,n,a,l,d);return this.renderOuterDesktopRelationRow(x,r,o,s,l,p,c)}}function W(e){const{isOpenPage:t,onClick:o,style:i,icon:s,tooltipMessage:n,ariaLabel:r}=e;return(0,U.jsx)(A.ZP,{renderTooltip:()=>n,render:e=>(0,U.jsx)(_.Z,{hasBackground:!1,ariaLabel:r,icon:s,onClick:o,caption:t&&P.default.formatMessage(z.openAsPageTitle),hoveredStyle:{borderRadius:4},style:{height:20,width:20,flex:"0 0 auto",...i},...e})})}H.displayName="RelationMenuRow";const X=H;function N(e){let{onActionButtonClick:t}=e;return(0,U.jsx)(F.Z,{mobileFeedback:!0,onClick:t,style:{padding:12,marginRight:-12},children:(0,d.U)({width:20,height:20})})}function $(e){const t=!e.disabled&&e.isSelected;return(0,U.jsx)(E.Z,{...e,store:e.relatedPageStore,hidePath:!0,right:t?(0,U.jsx)(N,{onActionButtonClick:e.onActionButtonClick}):void 0})}function G(e,t,o){return{...f.Z.textOverflowStyle,display:"flex",alignItems:"center",position:"relative",borderRadius:4,width:"100%",height:C.Mu,paddingTop:2,paddingRight:4,paddingBottom:2,paddingLeft:0,fontSize:B.z6,margin:"popup"===e?"0px 4px":0,cursor:"pointer",background:o?t.buttonHoveredBackground:void 0,userSelect:"none"}}function J(e,t,o){return{position:"absolute",right:o?t?36:6:6,top:4,display:"inline-flex",flexShrink:0,borderRadius:4,overflow:"hidden",padding:2,gap:1,background:e.popoverBackground,boxShadow:e.lightBoxShadow}}function Y(e,t){const{device:o}=t;o.isAndroid&&o.isPhone&&e.preventDefault()}},64275:(e,t,o)=>{o.d(t,{D:()=>n});o(67294);var i=o(45238),s=o(85893);const n=(0,i.I)("closeSmall",{viewBox:"0 0 16 16",svg:(0,s.jsx)("path",{d:"M3.732 11.052c-.303.308-.32.877.011 1.202.33.33.894.32 1.203.011L8 9.21l3.05 3.05c.32.325.872.32 1.197-.011a.857.857 0 00.01-1.197L9.21 8.002l3.05-3.056a.857.857 0 00-.01-1.197.857.857 0 00-1.198-.01L8 6.788 4.946 3.732c-.31-.303-.878-.32-1.203.01-.325.331-.314.895-.01 1.203l3.055 3.056-3.056 3.05z"})})}}]);