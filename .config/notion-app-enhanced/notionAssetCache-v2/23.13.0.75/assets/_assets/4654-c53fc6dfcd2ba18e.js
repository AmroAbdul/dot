"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4654],{84654:(e,t,o)=>{o.r(t),o.d(t,{COMPLETION_THROTTLE:()=>ae,acceptCursorCompletion:()=>Ae,acceptCursorCompletionAssistant:()=>Fe,cancelCompletion:()=>Oe,cancelCursorCompletionAssistant:()=>Te,doesPromptNeedAdditionalUserInput:()=>ue,handleCompletionPopupRetry:()=>fe,improveCompletion:()=>we,insertBlockSelectionCompletion:()=>_e,insertTextSelectionCompletion:()=>We,maybeSetPromptForCurrentAiBlock:()=>Ge,openCompletionPopupForBlockSelectionContext:()=>ce,openCompletionPopupForCursorContext:()=>se,openCompletionPopupForPrefilledContext:()=>de,openCompletionPopupForSavedContext:()=>pe,postProcessAICreatedStores:()=>Le,redoCompletionRevision:()=>Be,replaceTextSelectionCompletion:()=>Re,revertCurrentCompletionRevision:()=>Ue,selectPageAndOpenCompletionPopupForBlockSelectionContext:()=>le,showCompletionErrorWithCode:()=>ke,stopCompletion:()=>Ee,submitFeedbackForRevision:()=>Ke,triggerAssistantSkillCompletion:()=>ye,triggerCompletionForAiBlock:()=>Pe,updateAiEligibility:()=>je});o(21703),o(57658),o(30541);var n=o(26263),i=o(1302),r=o(41432),a=o(68626),s=o(42875),l=o(74229),c=o(72126),p=o(482),d=o(29299),m=o(4615),u=o(82883),f=o(3791),g=o(70203),y=o(95371),h=o(97880),v=o(10910),k=o(54642),C=o(80560),S=o(47307),x=o(94419),w=o(9953),I=o(24677),P=o(64964),M=o(993),A=o(98104),F=o(29373),T=o(82530),b=o(56518),W=o(78663),R=o(99417),L=o(96318),_=o(43455),E=o(33929),N=o(45162),B=o(46654),U=o(65598),O=o(77546),Z=o(69645),z=o(73959),D=o(89224),V=o(85720),H=o(77907),$=o(95802),j=o(80444),K=o(21273),G=o(98180),X=o(16772),q=o(77080),Y=o(68373),Q=o(27724),J=o(44041),ee=o(35057),te=o(28956),oe=o(92022),ne=o(71184),ie=o(63594),re=o(30793);const ae=300;async function se(e){const{environment:t,prompt:o=R.NX,additionalContext:n,from:i}=e,r=(0,W.FD)();r&&await me({environment:t,prompt:o,context:r,additionalContext:n,from:i})}async function le(e){const t=I.aw(I.KX()),o=(0,N.W9)(t);if(!o)return;A.NA({multiSelection:o});const n=(0,W.Fu)();if(!n)return;const i={type:"closedWithContext",context:n,futureRevisions:[]};X.default.setState(i),await pe(e)}async function ce(e){const{environment:t,prompt:o=R.NX,additionalContext:n,from:i}=e,r=(0,W.Xc)();r&&await me({environment:t,prompt:o,context:r,additionalContext:n,from:i})}async function pe(e){"closedWithContext"===X.default.state.type&&X.default.state.context&&await me({...e,context:X.default.state.context})}async function de(e){await me(e)}async function me(e){const{environment:t,prompt:o,context:r,additionalContext:a,skipInitialForm:s,from:l}=e,c=X.default.getExistingSessionId(),p=c??(0,m.ZP)();if(ue({clientPrompt:o,additionalContext:a})&&!s)return void(await(0,oe.toggleInitialPrompt)({environment:t,from:l,prefilledValue:(0,W.$W)(o),promptForAnalytics:o,sessionId:p,context:r}));Boolean(c)||v.Tl(t,{session_id:p,prompt_key:o.key,from:l}),A.ZH(t),await async function(e){const{environment:t,context:o,prompt:r,additionalContext:a,updater:s,sessionId:l,from:c}=e;"textSelection"===o.type&&s((()=>{A.ZH(t),I.ZH(t)}));const p=await H.deps.markdownLinkifyIt.loader(),{serverPrompt:d}=ge({...e,markdownLinkifyIt:p}),m=new n.Z({name:"completionActions.triggerCompletion",isTemporaryData:!0});s((()=>{t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(m)}));const u=X.default.state,f="completionPopup"===u.type&&"initialPrompt"===u.stage||"closedWithContext"===u.type?u.futureRevisions:[],g={type:"completionPopup",stage:"results",loading:!0,sessionId:l,revisions:[...f,{type:"initial",clientPrompt:r,serverPrompt:d,additionalContext:a,userSearchCache:new Map,completion:void 0,hasFeedback:!1}],futureRevisions:[],context:o,inMemoryRecordCache:m,from:c,hasErrored:!1};s((()=>{X.default.setState(g)})),await i.default.afterNextFlush(),await s((()=>Me({environment:t}))),await he({...e,updater:s,isRetry:!1})}({environment:t,context:r,prompt:o,intl:E.default.getIntl(),updater:X.default.createUpdater(),additionalContext:a,sessionId:p,from:l})}function ue(e){const{clientPrompt:t,additionalContext:o}=e,n="translate"===t.key&&o&&o.language,i="changeTone"===t.key&&o&&o.tone;return Boolean(!n&&!i&&t.steps)}async function fe(e){const{environment:t}=e,o=X.default.state;if("completionPopup"===o.type&&"results"===o.stage)if(A.ZH(t),ue((0,R.Iz)(o)));else{const e=(0,R.Iz)(o);X.default.setState({...o,revisions:[...o.revisions,{type:"initial",clientPrompt:e.clientPrompt,serverPrompt:e.serverPrompt,additionalContext:e.additionalContext,userSearchCache:new Map,completion:void 0,hasFeedback:!1}]}),await he({environment:t,updater:X.default.createUpdater(),isRetry:!0})}}function ge(e){const{environment:t,context:o,prompt:n,additionalContext:i,intl:r,markdownLinkifyIt:a}=e,l=(0,u.X)({intl:r,textValue:o.currentPage.getBlockTitleStore().getValue(),getRecordModel:o.currentPage.getRecordModel,userTimeZone:(0,s.r)()}),{previousContent:p,restContent:d,pageContent:m}=function(e){var t,o;const{environment:n,context:i,markdownLinkifyIt:r}=e,a=i.currentPage.getContentStores()[0];let s,l;if("cursor"===i.type||"textSelection"===i.type)s=i.textSelection.start,l=i.textSelection.end;else{var c;s={store:i.stores[0].getBlockTitleStore(),index:0};const e=i.stores[i.stores.length-1].getBlockTitleStore();l={store:e,index:(null===(c=(0,V.x0)(e))||void 0===c?void 0:c.endIndex)||0}}const p=ze(i.currentPage),d=C.wc({environment:n,textSelection:{start:{store:a.getBlockTitleStore(),index:0},end:l},markdownSerializationOptions:(0,_.KF)(),markdownLinkifyIt:r}),m=[p,d].filter(h.$K).join("\n\n"),u=(0,Z.Bj)({includeNonSelectableListContainer:!1}),f=null===(t=(0,y.CY)(u).value)||void 0===t?void 0:t.store,g=null==f?void 0:f.getBlockTitleStore(),v=g&&C.wc({environment:n,textSelection:{start:s,end:{store:g,index:(null===(o=(0,V.x0)(g))||void 0===o?void 0:o.endIndex)||0}},markdownSerializationOptions:(0,_.KF)(),markdownLinkifyIt:r})||"",k=De({environment:n,page:i.currentPage,markdownLinkifyIt:r})||"";return{previousContent:m,restContent:v,pageContent:k}}({environment:t,context:o,markdownLinkifyIt:a});let f,g;if("textSelection"===o.type||"blockSelection"===o.type){if("textSelection"===o.type)g=C.wc({environment:t,textSelection:o.textSelection,markdownSerializationOptions:(0,_.KF)(),markdownLinkifyIt:a})??"";else if("blockSelection"===o.type){const e=c.oA(Q.default.state.stores.map((e=>e.getValue())));g=(0,b.X4)({rootBlock:{...o.currentPage.pointer,spaceId:o.currentPage.getSpaceId()},blockValues:e,isWindows:t.device.isWindows,getRecordValue:o.currentPage.getRecordValue,markdownSerializationOptions:(0,_.KF)(),markdownLinkifyIt:a}).markdown||""}else(0,h.t1)(o);f=Ve({prompt:n,selectedText:g,pageTitle:l,pageContent:m,additionalContext:i}),f||(f=$e({prompt:n,pageTitle:l,previousContent:p,restContent:d,pageContent:m,additionalContext:i}))}else"cursor"===o.type?(f=$e({prompt:n,pageTitle:l,previousContent:p,restContent:d,pageContent:m,additionalContext:i}),f||(f=Ve({prompt:n,selectedText:m,pageTitle:l,additionalContext:i,pageContent:m}))):(0,h.t1)(o);if(!f)throw new Error(`Unable to find server prompt for "${n.key}" client prompt`);const v={type:"initial",pageTitle:l,selectedText:g,pageContent:m};return{serverPrompt:f.serverPrompt,initialStep:v,humanStep:f.humanStep}}async function ye(e){const{environment:t,context:o,clientSkill:r,skillSettings:a,updater:s,sessionId:l,from:c}=e;"textSelection"===o.type&&s((()=>{A.ZH(t),I.ZH(t)}));const p=new n.Z({name:"completionActions.triggerCompletion",isTemporaryData:!0}),d={type:"completionPopup",stage:"results",loading:!0,sessionId:l,revisions:[{type:"initial",clientPrompt:{},serverPrompt:{},userSearchCache:new Map,completion:void 0,hasFeedback:!1}],futureRevisions:[],context:o,inMemoryRecordCache:p,from:c,hasErrored:!1,clientSkill:r,skillSettings:a};s((()=>{X.default.setState(d)})),await i.default.afterNextFlush(),await s((()=>Me({environment:t}))),await he({...e,updater:s,isRetry:!1})}async function he(e){const{environment:t,updater:o,isRetry:n}=e,i=X.default.state;if("completionPopup"!==i.type||"results"!==i.stage)return;const{sessionId:r,clientSkill:a,skillSettings:s}=i,p=Date.now(),d=(0,m.ZP)(),u=(0,R.Iz)(i);if(i.revisions[i.revisions.length-1]!==u)throw new Error("Assertion failure, expected current revision to be initial revision");const f={...u,inferenceId:d},y=i.revisions.slice(0,i.revisions.length-1),{serverPrompt:C}=f;v.g_(t,{session_id:r,inference_id:d,from:i.from,prompt_key:f.clientPrompt.key,type:"completion"}),o((()=>{X.default.setState({...i,loading:!0,revisions:[...y,f]})}));let S=!1;if(K.Z.isAssistantInWriterEnabled()){t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(i.inMemoryRecordCache);const{assistantActions:e}=await H.deps.assistant.loader();if(n){const o=G.Z.getActiveSessionId();if(!o)throw new Error("No assistantSessionId.");await e.sampleNextAssistantSteps({environment:t,sessionId:o,inferenceId:(0,m.ZP)()})}else{var x;const o=await e.resetAndInitializeAssistantSession({environment:t,completionContext:i.context,clientSkill:a,skillSettings:s});if("helpMeWrite"===C.type||"helpMeDraft"===C.type||"helpMeEdit"===C.type){let n;"textSelection"===i.context.type?n=`I just selected some text denoted by selection XML tags.\n${C.prompt}`:"blockSelection"===i.context.type?n=`I just selected some blocks denoted by selection XML tags.\n${C.prompt}`:"cursor"===i.context.type?n=`I just inserted my cursor into this page at the location denoted by selection XML tags.\n${C.prompt}`:(0,h.t1)(i.context),await e.commitHumanStep({environment:t,text:(0,g.TPx)(n),sessionId:o.sessionId})}else null!==(x=i.clientSkill)&&void 0!==x&&null!==(x=x.inAppSkillTrigger)&&void 0!==x&&x.requiresInput||await e.sampleNextAssistantSteps({environment:t,sessionId:o.sessionId,inferenceId:(0,m.ZP)()})}S=!0,await o((()=>{const e=X.default.state;if("completionPopup"!==e.type||"results"!==e.stage)return;const t=new Map,o=c.Z$(Q.default.state.stores);X.default.setState({...e,revisions:[...y,{...f,completion:"",userSearchCache:t}],context:{...e.context,origin:o||e.context.origin},loading:!1})}))}else{const e=c.P2((async()=>{S||await o((()=>Me({environment:t,setSelection:!1})))}),ae),n=async function(e,t,o){if(!q.default.checkGate("ai_favorites"))return;const{currentSpaceStore:n}=j.default.getState();if(!n)return;if(!t.trim())return;const i=await k.getCompletion(e,{id:(0,m.ZP)(),aiSessionId:o,context:{type:"promptTitle",selectedText:t},model:"default",metadata:{},spaceId:n.id,isSpacePermission:!1});if("success"!==i.type)return;const r=[];if(l.H1.is(i.data))for await(const s of i.data){if("success"!==s.type)return;r.push(s.completion)}const a=r.join("").trim();return a||void 0}(t,(0,R.gY)(u),r),a=Ce({environment:t,inferenceId:d,aiSessionId:r,serverPrompt:C,targetStore:i.context.currentPage,inferenceReason:"writer",attribution:{blockId:i.context.currentPage.id},metadata:{blockId:i.context.currentPage.id},onUpdate(t){let{completion:n,userSearchCache:i}=t;o((()=>{const t=X.default.state;"completionPopup"===t.type&&"results"===t.stage&&(X.default.setState({...t,revisions:[...y,{...f,completion:n,userSearchCache:i}]}),e())}))}}),[s,g]=await Promise.all([n,a]);if("error_modal_shown"===g.type||"upsell_modal_shown"===g.type)return void o((()=>Ne()));S=!0;const{completion:h,userSearchCache:x}=g;await o((()=>{v.WP(t,{session_id:r,inference_id:d,preview_time:Date.now()-p,type:"completion"});const e=X.default.state;if("completionPopup"===e.type&&"results"===e.stage)return X.default.setState({...e,revisions:[...y,{...f,completion:h,userSearchCache:x,promptTitle:s}],loading:!1}),Me({environment:t,setSelection:!0})}))}}function ve(e){const{environment:t,inMemoryRecordCache:o,completion:n,userSearchCache:i,store:r,prompt:a,additionalContext:s,isComplete:l,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:m}=e;T.createAndCommit({userAction:"completionActions.updateAiBlockForCompletion",environment:t,perform:e=>{const u=r.clone(o);u.getContentIds().forEach((t=>{T.applyOperation({store:u,operation:(0,d.$j)({blockParentId:u.id,recordId:t}),transaction:e})}));const f=C.Mt({environment:t,text:n,inMemoryRecordCache:o,transaction:e,markdownOptions:(0,_.N9)(i),markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:m,useCrdt:u.useCrdt()});if(!f)return;const y=u.getContentStore();f.reverse().forEach((t=>{x.Ce({parent:y,prepend:t,transaction:e}),w.sW({store:t,data:{parent_id:u.id,parent_table:u.table,alive:!0},transaction:e})})),T.applyOperation({store:u,operation:p.op.update({pointer:u.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:a.key}}),transaction:e});const h=s?(0,g.TPx)(s.prompt):[];M.sO({environment:t,store:u.getBlockTitleStore(),value:h,transaction:e}),l&&He({transaction:e,completionState:{clientPrompt:a,additionalContext:s}})}})}function ke(e){const t=E.default.getIntl();return 451===e?P.oV({label:t.formatMessage({id:"completionActions.moderationError",defaultMessage:"AI does not allow content that is harmful or illegal. Please revise your input and try again. (451)"})}):502===e||503===e||504===e?P.oV({label:t.formatMessage({id:"completionActions.providerError",defaultMessage:"We’re experiencing issues with our AI provider. Try again in a few minutes. ({errorCode})"},{errorCode:e})}):void P.oV({label:t.formatMessage({id:"completionActions.genericError",defaultMessage:"AI is temporarily unavailable. Try again in a few minutes. ({errorCode})"},{errorCode:e})})}async function Ce(e){var t;const{environment:o,inferenceId:n,serverPrompt:i,targetStore:r,onUpdate:s,aiSessionId:c,metadata:p,attribution:d,inferenceReason:m}=e,u=L.mw()?L.SA:k.getCompletion,g=null===(t=j.default.state.currentSpaceStore)||void 0===t?void 0:t.id,y=(0,B.UK)(r);if(!g)return ke(1001),{type:"error_modal_shown"};const h=await u(o,{id:n,context:i,model:"default",spaceId:g,isSpacePermission:y,aiSessionId:c,metadata:p,attributionForLogging:d,inferenceReason:m});if("success"!==h.type)return S.showError(h),{type:"error_modal_shown"};let C="",x="";const w=new Map,I=await H.deps.searchActions.loader(),P=e=>I.searchVisibleSpaceUsers({environment:o,query:e,membersOnly:!0});if(l.H1.is(h.data))for await(const a of h.data)if("success"===a.type)C+=a.completion,(0,_.Ie)(C)||(x=Se(C),await(0,_.$A)(C,P,w)),s({completion:x,userSearchCache:new Map(w)});else if("error"===a.type)return(0,f.lX)(a.errorCode)?(J.y(o,{from:"ai_limit_in_app",for:(0,ee.zt)(),addOnFeature:"ai"}),{type:"upsell_modal_shown"}):(ke(a.errorCode),{type:"error_modal_shown"});const M=Se(C);return M?(await(0,_.$A)(M,P,w),{type:"success",completion:M,userSearchCache:new Map(w)}):(ke(600),a.log({level:"error",from:"completionActions.getCompletionWithPostProcessing",type:"emptyResponse",data:{inferenceId:n}}),v.UD(o,{promptKey:i.type}),{type:"error_modal_shown"})}function Se(e){return e.replace(/<br>/g,"\n")}function xe(e){const{improvement:t}=e;return"continueWriting"===t.type?{type:"human",prompt:"Continue writing"}:"makeLonger"===t.type?{type:"human",prompt:"Make longer"}:"helpMeEdit"===t.type?{type:"human",prompt:t.prompt}:void(0,h.t1)(t.type)}async function we(e,t){const o=X.default.state;if("completionPopup"!==o.type||"results"!==o.stage)return;let n=!1;const i=X.default.createUpdater();if(K.Z.isAssistantInWriterEnabled()){if("helpMeEdit"!==t.type)throw new Error("Improvements other than helpMeEdit are not supported");const{assistantActions:o}=await H.deps.assistant.loader(),r=G.Z.getActiveSessionId();if(!r)throw new Error("No active assistant session");await o.commitHumanStep({environment:e,text:(0,g.TPx)(t.prompt),sessionId:r}),n=!0,await i((()=>{const e=X.default.state;if("completionPopup"!==e.type||"results"!==e.stage)return;const t=c.Z$(Q.default.state.stores);X.default.setState({...e,context:{...e.context,origin:t||e.context.origin},loading:!1})}))}else{const r=(0,R.xM)(o);if(!r.completion)return;const a=o.context,s=r.completion,l="continueWriting"===t.type?s:"",p=Date.now(),d=(0,m.ZP)();v.g_(e,{session_id:o.sessionId,inference_id:d,from:o.from,prompt_key:(0,R.Iz)(o).clientPrompt.key,improvement_prompt_type:t.type,type:"follow_up_improvement"});const u=[...o.revisions,...o.futureRevisions],f={type:"followup",improvement:t,completion:l,userSearchCache:new Map,inferenceId:d,hasFeedback:!1,previousRevision:(0,R.HS)(o)},g={...o,loading:!0,revisions:[...u,f],futureRevisions:[]},y=await H.deps.markdownLinkifyIt.loader(),k=function(e){const{environment:t,completionState:o,markdownLinkifyIt:n}=e,{context:i}=o,r=[];for(const a of(0,R.zU)(o))if("initial"===a.type){const{initialStep:e,humanStep:o}=ge({environment:t,context:i,prompt:a.clientPrompt,additionalContext:a.additionalContext,intl:E.default.getIntl(),markdownLinkifyIt:n});if(void 0===a.completion)throw new Error("Assertion failure, followup without initial completion");r.unshift(e,o,{type:"assistant",result:a.completion})}else if("followup"===a.type){const e=[xe({improvement:a.improvement})];a.completion&&e.push({type:"assistant",result:a.completion}),r.unshift(...e)}else(0,h.t1)(a);L.mw()&&console.log("Transcript",JSON.stringify(r,null,2));return{type:"writerFollowup",transcript:r}}({environment:e,completionState:g,markdownLinkifyIt:y});i((()=>{X.default.setState(g)}));const C=c.P2((async()=>{n||await i((()=>Me({environment:e,setSelection:!1})))}),ae),S=await Ce({environment:e,inferenceId:d,serverPrompt:k,targetStore:a.currentPage,aiSessionId:o.sessionId,inferenceReason:"writer",attribution:{blockId:o.context.currentPage.id},metadata:{blockId:a.currentPage.id},onUpdate(e){let{completion:t,userSearchCache:o}=e;i((()=>{const e=X.default.state;"completionPopup"===e.type&&"results"===e.stage&&(X.default.setState({...e,revisions:[...u,{...f,completion:l+t,userSearchCache:o}]}),C())}))}});if("error_modal_shown"===S.type||"upsell_modal_shown"===S.type)return void i((()=>Ne()));n=!0;const{completion:x,userSearchCache:w}=S;i((()=>{v.WP(e,{session_id:g.sessionId,inference_id:d,preview_time:Date.now()-p,type:"follow_up_improvement"}),X.default.setState({...g,loading:!1,revisions:[...u,{...f,completion:l+x,userSearchCache:w}]}),Me({environment:e,setSelection:!0})}))}}const Ie=(0,h.AO)((e=>e instanceof Y.G?{true:e}:{false:e}));async function Pe(e){const{environment:t,store:o,prompt:i,additionalContext:r}=e,a=o.getRecordStoreUIRoot();if(!Ie(a))return;const l=await H.deps.markdownLinkifyIt.loader(),p=function(e){const{environment:t,rootStore:o,store:n,prompt:i,additionalContext:r,markdownLinkifyIt:a}=e,l=E.default.getIntl(),c=(0,u.X)({intl:l,textValue:o.getBlockTitleStore().getValue(),getRecordModel:o.getRecordModel,userTimeZone:(0,s.r)()}),p=De({environment:t,page:o,markdownLinkifyIt:a})||"";if("summarizeMeetingTranscript"===i.key)return{type:"summarizeMeetingTranscript",pageTitle:c,pageContent:p};if("helpMeWrite"===i.key){var d,m,f,g,v;const e={type:"helpMeWrite",pageTitle:c,pageContent:p,prompt:(null==r?void 0:r.prompt)??""},i=(0,Z.dq)({includeNonSelectableListContainer:!1,root:n.getHighestContentBlockUIAncestor()});if(!i)return e;const s=(0,Z.v5)(n,i.children);if(!s)return e;const l=o.getContentStores()[0],u=(0,y.YL)(i,s),k=u.prev?u.prev.value.store.getBlockTitleStore():null===(d=u.parent)||void 0===d?void 0:d.value.store.getBlockTitleStore(),S=l&&k&&C.wc({environment:t,textSelection:{start:{store:l.getBlockTitleStore(),index:0},end:{store:k,index:(null===(m=(0,V.x0)(k))||void 0===m?void 0:m.endIndex)??0}},markdownSerializationOptions:(0,_.KF)(),markdownLinkifyIt:a})||"",x=[ze(o),S].filter(h.$K).join("\n\n"),w=null===(f=(0,y.Xf)(i,s).next)||void 0===f?void 0:f.value.store.getBlockTitleStore(),I=null===(g=(0,y.CY)(i).value)||void 0===g?void 0:g.store,P=null==I?void 0:I.getBlockTitleStore();return{type:"helpMeWrite",pageTitle:c,previousContent:x,restContent:w&&P&&C.wc({environment:t,textSelection:{start:{store:w,index:0},end:{store:P,index:(null===(v=(0,V.x0)(P))||void 0===v?void 0:v.endIndex)||0}},markdownSerializationOptions:(0,_.KF)(),markdownLinkifyIt:a})||"",prompt:(null==r?void 0:r.prompt)??""}}return"summarize"===i.key||"findActionItems"===i.key?{type:i.key,pageTitle:c,selectedText:p}:void 0}({environment:t,rootStore:a,store:o,prompt:i,additionalContext:r,markdownLinkifyIt:l});if(!p)return;const d=c.P2(ve,ae),f=new n.Z({name:"completionActions.triggerCompletionForAiBlock",isTemporaryData:!0});t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(f);const g=await H.deps.tinyMceMicrosoftWordPasteFilter.loader(),v=await Ce({environment:t,inferenceId:(0,m.ZP)(),serverPrompt:p,targetStore:a,aiSessionId:(0,m.ZP)(),metadata:{blockId:a.id},inferenceReason:"writer",attribution:{blockId:a.id},onUpdate(e){let{completion:n,userSearchCache:a}=e;d({inMemoryRecordCache:f,environment:t,store:o,completion:n,userSearchCache:a,prompt:i,additionalContext:r,isComplete:!1,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:g})}});if(t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(f),"error_modal_shown"===v.type||"upsell_modal_shown"===v.type)return;const{completion:k,userSearchCache:S}=v;ve({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,store:o,completion:k,userSearchCache:S,prompt:i,additionalContext:r,isComplete:!0,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:g})}async function Me(e){const{environment:t,setSelection:o}=e,n=X.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const r=(0,R.xM)(n),{completion:a,userSearchCache:s}=r,{context:l,inMemoryRecordCache:p}=n;if("cursor"!==l.type)return;p.clearCache();const{currentBlock:d,currentParent:m,currentPage:u}=l,f=m||u.getContentStore(),{insertTitle:y,insertCompletion:h}=be({completion:a||"",currentPage:u});y&&T.createAndCommit({userAction:"completionActions.temporaryInsertion.insertTitle",environment:t,canUndo:!1,perform:e=>{var t;const o=null===(t=u.getTitleStore())||void 0===t?void 0:t.clone(p);o&&w.sO({store:o,value:(0,g.TPx)(y),transaction:e})}});const[v,k]=await Promise.all([H.deps.markdownLinkifyIt.loader(),H.deps.tinyMceMicrosoftWordPasteFilter.loader()]);if(h){const e=T.createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletion",environment:t,canUndo:!1,perform:e=>{if(!h)return;const o=C.Mt({environment:t,text:h,inMemoryRecordCache:p,transaction:e,markdownOptions:(0,_.N9)(s),markdownLinkifyIt:v,tinyMceMicrosoftWordPasteFilter:k,useCrdt:!1});if(!o)return;Le(t,o);Ze({parentStore:f.clone(p),insertAfter:null==d?void 0:d.clone(p),insertStores:o,transaction:e});return o.map((e=>e.clone(t.defaultRecordCache.inMemoryRecordCache))).map((e=>e.cloneWithNewUIParent(f)))}}).performResult;if(!e||!e.length)return;o&&I.Z5({environment:t,stores:e}),await i.default.afterNextFlush();const n=X.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const r=c.oA(e.map((e=>$.C.findNodeFromStore(e))));if(!(r[0]?(0,O.VW)(r[0]):void 0))return;X.default.setState({...n,context:{...n.context,origin:c.Z$(e)}})}else if(d){const e=(0,R.Ah)(d),i=new DOMRect(null==e?void 0:e.x,null==e?void 0:e.y,null==e?void 0:e.width,0);T.createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletionStores",environment:t,canUndo:!1,perform:e=>{Ze({parentStore:f.clone(p),insertAfter:d.clone(p),insertStores:[],transaction:e})}}),o&&I.ZH(t),d.getAlive()?X.default.setState({...n,context:{...l,origin:d}}):X.default.setState({...n,context:{...l,origin:i}})}}function Ae(e){var t;const{environment:o,transaction:n,selectInsertion:a,exitType:s,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:c}=e,d=X.default.state;if(X.default.invalidateLastUpdater(),"completionPopup"!==d.type||"results"!==d.stage||"cursor"!==d.context.type)return;const{completion:m,userSearchCache:u,inferenceId:f}=(0,R.xM)(d);if(!m)return;const{currentBlock:y,currentParent:h,currentPage:k}=d.context,S=h||k.getContentStore();X.default.resetStore(e);const{insertTitle:P,insertCompletion:M}=be({completion:m,currentPage:k});P&&"convert_to_ai_block"!==s&&w.sO({store:k.getBlockTitleStore(),value:(0,g.TPx)(P),transaction:n});const F=(null===(t=(0,z.sQ)(S))||void 0===t?void 0:t.useCrdt())??!1,b=C.Mt({environment:o,text:M,inMemoryRecordCache:o.defaultRecordCache.inMemoryRecordCache,transaction:n,markdownOptions:(0,_.N9)(u),markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:c,useCrdt:F});if(b){if(y&&"convert_to_ai_block"===s){var W;const e=w.j4({environment:o,type:r.Ti.aiBlock,inMemoryRecordCache:y.inMemoryRecordCache,transaction:n,spaceId:y.pointer.spaceId,useCrdt:F});x.BE({parent:S,after:y,insert:e,transaction:n}),(0,U.PF)(y)&&x.Od({parent:S,childToRemove:y,transaction:n});const t=(0,R.xM)(d);if("initial"!==t.type)throw new Error("Assertion failure, currentRevision.type is not initial");const i=null===(W=t.additionalContext)||void 0===W?void 0:W.prompt;i&&T.applyOperation({store:e,operation:p.op.set({pointer:e.pointer,path:["properties","title"],args:[[i]]}),transaction:n}),T.applyOperation({store:e,operation:p.op.update({pointer:e.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:t.clientPrompt.key}}),transaction:n}),Ze({parentStore:e.getContentStore(),insertAfter:void 0,insertStores:b,transaction:n})}else Ze({parentStore:S,insertAfter:y,insertStores:b,transaction:n}),function(e){const{environment:t,parentStore:o,insertStores:n,selectInsertion:r}=e,a=n.map((e=>e.cloneWithNewUIParent(o)));i.default.afterNextFlush((()=>{I.yu({environment:t,stores:a}),r&&function(e){const{environment:t,insertedStores:o}=e;D.clear(t),i.default.afterNextFlush((()=>{const e=(0,N.W9)(o);e&&A.NA({multiSelection:e})}))}({environment:t,insertedStores:a})}))}({environment:o,parentStore:S,insertStores:b,selectInsertion:a});He({transaction:n,completionState:(0,R.Iz)(d)}),f&&v.NF(o,{type:"cursor_completion",inference_id:f,feedback_type:"accept",timestamp:(new Date).toUTCString()})}}async function Fe(e){const{environment:t}=e;X.default.invalidateLastUpdater(),X.default.resetStore(e);const{assistantActions:o}=await H.deps.assistant.loader(),n=G.Z.getActiveSessionId();n&&(await o.commitPreviewAssistantStep({environment:t,sessionId:n}),await o.applyUncommittedOperations({environment:t,sessionId:n}),o.clearActiveAssistantSession({environment:t,sessionId:n}))}async function Te(e){const{environment:t}=e;X.default.invalidateLastUpdater(),X.default.resetStore(e);const{assistantActions:o}=await H.deps.assistant.loader(),n=G.Z.getActiveSessionId();n&&o.clearActiveAssistantSession({environment:t,sessionId:n})}function be(e){const{completion:t,currentPage:o}=e;let n,i;const r=Boolean(o.getBlockTitleStore().getValue()),a=o.getContentStores().every((e=>{var t;return!(null!==(t=e.getTitleStore())&&void 0!==t&&t.getValue())}));if(!r&&a){const{title:e,content:o}=function(e){const t=e.trim().split("\n"),o=t[0];return o.startsWith("# ")?{title:o.substring(2),content:t.slice(1).join("\n")}:{title:"",content:e}}(t||"");n=e,i=o}else i=t;return{insertTitle:n,insertCompletion:i}}function We(e){var t,o;const{environment:n,transaction:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=X.default.state;if(X.default.invalidateLastUpdater(),"completionPopup"!==s.type||"results"!==s.stage||"textSelection"!==s.context.type)return;const{completion:l,userSearchCache:p}=(0,R.xM)(s);if(!l)return;const{endBlock:d,endBlockParent:m,currentPage:u}=s.context,f=m||u.getContentStore();X.default.resetStore(e);const y=C.Mt({environment:n,text:l,inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:i,markdownOptions:(0,_.N9)(p),markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a,useCrdt:d.useCrdt()});if(!y)return;Ze({parentStore:f,insertAfter:d,insertStores:y,transaction:i}),He({transaction:i,completionState:(0,R.Iz)(s)});const h=y.map((e=>e.cloneWithNewUIParent(f))),v=null===(t=c.Ps(h))||void 0===t?void 0:t.getBlockTitleStore(),k=null===(o=c.Z$(h))||void 0===o?void 0:o.getBlockTitleStore();v&&k&&A.NA({multiSelection:{start:{index:0,store:v},end:{index:k.getValue()?g.QaF(k.getValue()).length:0,store:k}}})}function Re(e){const{environment:t,transaction:o,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}=e,r=X.default.state;if(X.default.invalidateLastUpdater(),"completionPopup"!==r.type||"results"!==r.stage||"textSelection"!==r.context.type)return;const a=(0,R.xM)(r);a.completion&&(A.NA({multiSelection:r.context.textSelection}),C.R$({environment:t,text:a.completion,transaction:o,disableEmbedMenu:!0,overwrite:!0,selectAll:!0,markdownOptions:(0,_.N9)(a.userSearchCache),markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}),He({transaction:o,completionState:(0,R.Iz)(r)}),X.default.resetStore(e))}function Le(e,t){for(const o of t)F.X_(e,o)}function _e(e){const{environment:t,transaction:o,replace:n,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r}=e,a=X.default.state;if(X.default.invalidateLastUpdater(),"completionPopup"!==a.type||"results"!==a.stage||"blockSelection"!==a.context.type)return;const{completion:s,userSearchCache:l}=(0,R.xM)(a);if(!s)return;const{stores:p}=a.context,d=c.Z$(p);if(!d)return;const m=d.getRecordStoreUIParent();if(!m)return;X.default.resetStore(e);const u=C.Mt({environment:t,text:s,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:o,markdownOptions:(0,_.N9)(l),markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r,useCrdt:d.useCrdt()});if(!u)return;if(Ze({parentStore:m,insertAfter:d,insertStores:u,transaction:o}),n)for(const c of p){const e=c.getRecordStoreUIParent();e&&x.Od({parent:e,childToRemove:c,transaction:o})}He({transaction:o,completionState:(0,R.Iz)(a)});const f=u.map((e=>e.cloneWithNewUIParent(m)));I.Z5({environment:t,stores:f})}function Ee(e){const t=X.default.state;if("completionPopup"!==t.type||"results"!==t.stage||!t.loading)return;const o=(0,R.xM)(t);o.completion&&(v.zi(e,{session_id:t.sessionId,inference_id:o.inferenceId}),X.default.invalidateLastUpdater(),X.default.setState({...t,loading:!1}),Me({environment:e,setSelection:!0}))}function Ne(){const e=X.default.state;"completionPopup"===e.type&&"results"===e.stage&&X.default.setState({...e,hasErrored:!0})}function Be(e){const t=X.default.state;"completionPopup"===t.type&&"results"===t.stage&&0!==t.futureRevisions.length&&(X.default.invalidateLastUpdater(),X.default.setState({...t,hasErrored:!1,loading:!1,revisions:[...t.revisions,t.futureRevisions[0]],futureRevisions:t.futureRevisions.slice(1)}),Me({environment:e,setSelection:!0}))}function Ue(e){const{environment:t,purgeFromHistory:o}=e,n=X.default.state;if("completionPopup"!==n.type||"results"!==n.stage||0===n.revisions.length)return;const i=n.revisions[n.revisions.length-1];return X.default.invalidateLastUpdater(),X.default.setState({...n,hasErrored:!1,loading:!1,revisions:n.revisions.slice(0,-1),futureRevisions:o?n.futureRevisions:[i,...n.futureRevisions]}),Me({environment:t,setSelection:!0}),i}async function Oe(e){X.default.invalidateLastUpdater();const{environment:t,sessionId:o,inferenceId:n,exitType:i}=e,r=X.default.state;if("completionPopup"!==r.type||"initialPromptForAIBlock"===r.stage)return;if((!t.device.isMobileNative||"error_modal"!==i&&"upsell_modal"!==i)&&("cursor"===r.context.type||"textSelection"===r.context.type?A.NA({multiSelection:r.context.textSelection}):"blockSelection"===r.context.type?I.Z5({environment:t,stores:r.context.stores}):(0,h.t1)(r.context)),X.default.resetStore(e),v.HC(t,{session_id:o,inference_id:n,exit_type:i}),"results"!==r.stage)return;const a=(0,R.xM)(r);if(a.inferenceId&&v.NF(t,{type:"cursor_completion",inference_id:a.inferenceId,feedback_type:"cancel",timestamp:(new Date).toUTCString()}),K.Z.isAssistantInWriterEnabled()){const{assistantActions:e}=await H.deps.assistant.loader();e.clearActiveAssistantSession({environment:t})}}function Ze(e){const{parentStore:t,insertAfter:o,insertStores:n,transaction:i}=e,r=c.d9(n).reverse();for(const a of r)o?x.BE({parent:t,insert:a,after:o,transaction:i}):x.Ce({parent:t,prepend:a,transaction:i}),w.sW({store:a,data:{parent_id:t.id,parent_table:t.table,alive:!0},transaction:i});o&&(0,U.PF)(o)&&x.Od({parent:t,childToRemove:o,transaction:i})}function ze(e){return C.jm({rootBlock:{...e.pointer,spaceId:e.getSpaceId()},getRecordValue:e.getRecordValue})}function De(e){const{environment:t,page:o,markdownLinkifyIt:n}=e,i=c.oA(o.getContentStores().map((e=>e.getValue())));return[ze(o),(0,b.X4)({rootBlock:{...o.pointer,spaceId:o.getSpaceId()},getRecordValue:o.getRecordValue,blockValues:i,isWindows:t.device.isWindows,markdownSerializationOptions:(0,_.KF)(),markdownLinkifyIt:n}).markdown].filter(h.$K).join("\n\n")}function Ve(e){const{prompt:t,pageTitle:o,pageContent:n,selectedText:i,additionalContext:r}=e;L.mw()&&console.log("textSelectionPromptToServerContext",e);const a="string"==typeof t.name?t.name:E.default.formatMessage(t.name);if("fixSpellingGrammar"===t.key||"explainThis"===t.key||"makeLonger"===t.key||"makeShorter"===t.key||"findActionItems"===t.key||"improveWriting"===t.key||"simplifyLanguage"===t.key||"cleanUpFormatting"===t.key||"summarize"===t.key)return{serverPrompt:{type:t.key,pageTitle:o,selectedText:i},humanStep:{type:"human",prompt:a}};if("translate"===t.key){const e=(null==r?void 0:r.language)??"english";return{serverPrompt:{type:t.key,text:i,language:e},humanStep:{type:"human",prompt:`Translate to ${e}`}}}if("changeTone"===t.key){const e=(null==r?void 0:r.tone)??"professional";return{serverPrompt:{type:t.key,text:i,tone:e},humanStep:{type:"human",prompt:`Change tone to ${e}`}}}if("helpMeEdit"===t.key){const e=(null==r?void 0:r.prompt)||"";return{serverPrompt:{type:t.key,prompt:e,selectedText:i,pageTitle:o,pageContent:n},humanStep:{type:"human",prompt:e}}}}function He(e){const{transaction:t,completionState:{clientPrompt:o,additionalContext:n,promptTitle:i}}=e,r=(0,re.BG)({clientPrompt:o,additionalContext:n,promptTitle:i});if(!r)return;const{currentUserSettingsStore:a}=j.default.state;if(!a)return;(0,ne.Gl)(a,r)||(0,re.Nv)(r,a,t)}function $e(e){const{prompt:t,pageTitle:o,previousContent:n,restContent:i,additionalContext:r,pageContent:a}=e;L.mw()&&console.log("cursorPromptToServerContext",e);const s="string"==typeof t.name?t.name:E.default.formatMessage(t.name);if("continueWriting"===t.key)return{serverPrompt:{type:"continueWriting",pageTitle:o,previousContent:n,restContent:i},humanStep:{type:"human",prompt:s}};if("helpMeWrite"===t.key){const e=(null==r?void 0:r.prompt)??"";return{serverPrompt:{type:"helpMeWrite",pageTitle:o,previousContent:n,restContent:i,prompt:e},humanStep:{type:"human",prompt:e}}}if("helpMeDraft"===t.key){const e=(null==r?void 0:r.prompt)??"";return{serverPrompt:{type:"helpMeDraft",prompt:e,previousContent:n,pageTitle:o},humanStep:{type:"human",prompt:e}}}if("todoList"===t.key||"outline"===t.key||"meetingAgenda"===t.key||"brainstormIdeas"===t.key||"prosConsList"===t.key||"socialMediaPost"===t.key||"pressRelease"===t.key||"creativeStory"===t.key||"poem"===t.key||"essay"===t.key||"blogPost"===t.key||"jobDescription"===t.key||"salesEmail"===t.key||"recruitingEmail"===t.key){const e=(null==r?void 0:r.topic)??"";return{serverPrompt:{type:t.key,topic:e,pageContent:a},humanStep:{type:"human",prompt:e}}}return"summarize"===t.key||"findActionItems"===t.key?{serverPrompt:{type:t.key,pageTitle:o,selectedText:a},humanStep:{type:"human",prompt:s}}:void 0}async function je(e,t){let o;const n=L.ZE();if(n.debug)o=402!==n.showErrorCode;else{const n=await k.getAIUsageEligibility(e,{spaceId:t});"success"===n.type&&(o=n.data.isEligible,te.Z.setState(n.data))}return void 0!==o&&ie.Z.setState(o),o}async function Ke(e){const{environment:t,revision:o,type:n,userContent:i,shareWithNotion:r,userOptIn:a}=e;if(K.Z.isAssistantInWriterEnabled()){const{assistantActions:e}=await H.deps.assistant.loader(),o=G.Z.getActiveSessionId();if(!o)throw new Error("No assistantSessionId.");e.saveFeedback({environment:t,inferenceId:"",type:"thumbsup"===n?"assistant_thumbs_up":"assistant_thumbs_down",sessionId:o,userComment:i,shareWithNotion:r,userOptIn:a})}else{const e=X.default.state;if(!o.inferenceId||"completionPopup"!==e.type||"results"!==e.stage)return;v.NF(t,{type:"cursor_completion",inference_id:o.inferenceId,feedback_type:n,timestamp:(new Date).toUTCString(),user_comment:i,share_with_notion:r,user_opt_in:a}),X.default.setState({...e,revisions:e.revisions.map((e=>e.inferenceId===o.inferenceId?{...e,hasFeedback:!0}:e))})}}function Ge(e,t){const o=X.default.state;"completionPopup"===o.type&&"initialPromptForAIBlock"===o.stage&&T.createAndCommit({userAction:"completionActions.updatePromptForCurrentAiBlock",environment:e,perform:e=>{T.applyOperation({store:o.store,operation:p.op.set({pointer:o.store.pointer,path:["properties","title"],args:(0,g.TPx)(t)}),transaction:e})}})}},99417:(e,t,o)=>{o.d(t,{Ah:()=>H,Dr:()=>b,HS:()=>Y,Iz:()=>K,LN:()=>B,Mh:()=>O,NX:()=>V,OE:()=>W,dU:()=>J,gY:()=>q,pv:()=>Z,sB:()=>D,sr:()=>X,t8:()=>_,up:()=>U,wA:()=>$,wq:()=>E,xM:()=>G,zU:()=>Q});o(57658),o(21703);var n=o(87205),i=(o(99036),o(8848)),r=o(30579),a=o(41886),s=o(27245),l=o(52897),c=o(7500),p=o(31157),d=o(88607),m=o(25879),u=o(12970),f=o(91856),g=o(20669),y=o(25651),h=o(11751),v=o(72050),k=o(72126),C=o(97880),S=o(9291),x=(o(95477),o(43250)),w=o(95802),I=o(21273),P=o(16772),M=(o(77080),o(68373)),A=o(78663),F=o(19124),T=o(33929);const b=(0,S.defineMessages)({writeWithAI:{defaultMessage:"Write with AI",id:"id.completions.writeWithAI"},draftWithAI:{defaultMessage:"Draft with AI",id:"id.completions.draftWithAI"},extractFromSelection:{defaultMessage:"Generate from selection",id:"id.completions.extractFromSelection"},extractFromPage:{defaultMessage:"Generate from page",id:"id.completions.extractFromPage"},editSelection:{defaultMessage:"Edit or review selection",id:"id.completions.editSelection"},editPage:{defaultMessage:"Edit or review page",id:"id.completions.editPage"},aiBlocks:{defaultMessage:"Insert AI blocks",id:"id.completions.aiBlocks"},helpMeEdit:{defaultMessage:"Ask AI to edit...",id:"id.completions.helpMeEdit"},askAI:{defaultMessage:"Ask AI",id:"id.completions.askAI"},genericHelpMeEdit:{defaultMessage:"{filter}",id:"id.completions.genericHelpMeEdit"},genericHelpMeWrite:{defaultMessage:"{filter}",id:"id.completions.genericHelpMeWrite"},continueWriting:{defaultMessage:"Continue writing",id:"id.completions.continueWriting"},brainstormIdeas:{defaultMessage:"Brainstorm ideas",id:"id.completions.brainstormIdeas"},brainstormIdeasTopic:{defaultMessage:'What do you want to brainstorm ideas about?\nFor example, "creative name ideas for a pirate themed party game"',id:"id.completions.Topic"},summarize:{defaultMessage:"Summarize",id:"id.completions.summarize"},translate:{defaultMessage:"Translate",id:"id.completions.translate"},translateLanguage:{defaultMessage:"Select language",id:"id.completions.translateLanguage"},blogPost:{defaultMessage:"Blog post",id:"id.completions.blogPost"},blogPostTopicPlaceholder:{defaultMessage:'What should the blog post be about?\nFor example, "the benefits of practicing mindfulness and meditation"',id:"id.completions.blogPost.blogPostTopic.placeholder"},blogPostGenerate:{defaultMessage:"Generate post",id:"id.completions.blogPost.generate"},prosConsList:{defaultMessage:"Pros and cons list",id:"id.completions.prosConsList"},prosConsListPlaceholder:{defaultMessage:'What do you want to make a pros and cons list about?\nFor example, "learning a new language for the first time"',id:"id.completions.prosConsListPlaceholder"},socialMediaPostPlaceholder:{defaultMessage:'What do you want to make a social media post about?\nFor example, "tips and tricks for changing careers"',id:"id.completions.socialMediaPostPlaceholder"},outlinePlaceholder:{defaultMessage:'What do you want to make an outline for?\nFor example, "a detailed step-by-step process for getting into university"',id:"id.completions.outlinePlaceholder"},creativeStoryPlaceholder:{defaultMessage:'What do you want to write a story about?\nFor example, "suzy discovers a magical secret room only she can see"',id:"id.completions.creativeStoryPlaceholder"},poemPlaceholder:{defaultMessage:'What do you want to write a poem about?\nFor example, "a whimsical poem about finding meaning in ordinary things"',id:"id.completions.poemPlaceholder"},essayPlaceholder:{defaultMessage:'What do you want to write an essay about?\nFor example, "how a chaotic environment can actually improve focus"',id:"id.completions.essayPlaceholder"},todoListPlaceholder:{defaultMessage:'What do you want to make a to-do list about?\nFor example, "creating a new board game"',id:"id.completions.todoListPlaceholder"},meetingAgendaPlaceholder:{defaultMessage:'What is the purpose of the meeting?\nFor example, "alignment on pricing for new product"',id:"id.completions.meetingAgendaPlaceholder"},pressReleasePlaceholder:{defaultMessage:'What should the press release be about?\nFor example, "product launch for new mind-reading app for pets"',id:"id.completions.pressReleasePlaceholder"},jobDescriptionPlaceholder:{defaultMessage:'What job do you want to write a description about?\nFor example, "data engineer at Notion, needs Postgres experience"',id:"id.completions.jobDescriptionPlaceholder"},salesEmailPlaceholder:{defaultMessage:'What product are you selling?\nFor example, "email for a head of operations about a new brain boosting supplement"',id:"id.completions.salesEmailPlaceholder"},recruitingEmailPlaceholder:{defaultMessage:'Who are you trying to recruit?\nFor example, "experienced frontend engineer for our new social mindfulness app"',id:"id.completions.recruitingEmailPlaceholder"},helpMeEditPlaceholder:{defaultMessage:'How would you like to edit this text?\nFor example, "Summarize in one sentence"',id:"id.completions.helpMeEditPlaceholder"},improveWriting:{defaultMessage:"Improve writing",id:"id.completions.improveWriting"},fixSpellingGrammar:{defaultMessage:"Fix spelling & grammar",id:"id.completions.fixSpellingGrammar"},explainThis:{defaultMessage:"Explain this",id:"id.completions.explainThis"},makeLonger:{defaultMessage:"Make longer",id:"id.completions.makeLonger"},findActionItems:{defaultMessage:"Find action items",id:"id.completions.findActionItems"},makeShorter:{defaultMessage:"Make shorter",id:"id.completions.makeShorter"},simplifyLanguage:{defaultMessage:"Simplify language",id:"id.completions.simplifyLanguage"},changeTone:{defaultMessage:"Change tone",id:"id.completions.changeTone"},changeToneType:{defaultMessage:"Select tone",id:"id.completions.changeToneType"},socialMediaPost:{defaultMessage:"Social media post",id:"id.completions.socialMediaPost"},cleanUpFormatting:{defaultMessage:"Clean up formatting",id:"id.completions.cleanUpFormatting"},outline:{defaultMessage:"Outline",id:"id.completions.outline"},creativeStory:{defaultMessage:"Creative story",id:"id.completions.creativeStory"},poem:{defaultMessage:"Poem",id:"id.completions.poem"},essay:{defaultMessage:"Essay",id:"id.completions.essay"},todoList:{defaultMessage:"To-do list",id:"id.completions.todoList"},toDoListKeywords:{id:"id.completions.todoListKeywords",defaultMessage:"Todo To-Do List"},meetingAgenda:{defaultMessage:"Meeting agenda",id:"id.completions.meetingAgenda"},pressRelease:{defaultMessage:"Press release",id:"id.completions.pressRelease"},jobDescription:{defaultMessage:"Job description",id:"id.completions.jobDescription"},salesEmail:{defaultMessage:"Sales email",id:"id.completions.salesEmail"},recruitingEmail:{defaultMessage:"Recruiting email",id:"id.completions.recruitingEmail"},conclusion:{defaultMessage:"Conclusion",id:"id.completions.conclusion"},autofillSummary:{defaultMessage:"Summary",id:"id.completions.autofillSummary"},autofillTranslate:{defaultMessage:"Translate",id:"id.completions.autofillTranslate"},autofillExtract:{defaultMessage:"Key info",id:"id.completions.autofillExtract"},autofillCustom:{defaultMessage:"Custom autofill",id:"id.completions.autofillCustom"},insertAIBlock:{defaultMessage:"Insert as AI block",id:"id.completions.insertAIBlock"}}),W={text:{summarize:{name:b.autofillSummary,svg:f.Y},translate:{name:b.autofillTranslate,svg:d.Q},extract:{name:b.autofillExtract,svg:v.A},custom:{name:b.autofillCustom,svg:g.y}},select:{select:{name:b.autofillCustom,svg:g.y}},multi_select:{select:{name:b.autofillCustom,svg:g.y}}};const R=[F.eL,{key:"brainstormIdeas",category:"draftWithAI",name:b.brainstormIdeas,svg:m.b,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.brainstormIdeasTopic,placeholder:b.brainstormIdeasTopic,type:"text"}]},{key:"blogPost",category:"draftWithAI",name:b.blogPost,generateName:b.blogPostGenerate,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.blogPostTopicPlaceholder,placeholder:b.blogPostTopicPlaceholder,type:"text"}]},{key:"outline",category:"draftWithAI",name:b.outline,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.outlinePlaceholder,placeholder:b.outlinePlaceholder,type:"text"}]},{key:"socialMediaPost",category:"draftWithAI",name:b.socialMediaPost,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.socialMediaPostPlaceholder,placeholder:b.socialMediaPostPlaceholder,type:"text"}]},{key:"pressRelease",category:"draftWithAI",name:b.pressRelease,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.pressReleasePlaceholder,placeholder:b.pressReleasePlaceholder,type:"text"}]},{key:"creativeStory",category:"draftWithAI",name:b.creativeStory,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.creativeStoryPlaceholder,placeholder:b.creativeStoryPlaceholder,type:"text"}]},{key:"essay",category:"draftWithAI",name:b.essay,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.essayPlaceholder,placeholder:b.essayPlaceholder,type:"text"}]},{key:"poem",category:"draftWithAI",name:b.poem,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.poemPlaceholder,placeholder:b.poemPlaceholder,type:"text"}]},{key:"todoList",category:"draftWithAI",name:b.todoList,fuzzySearchKeywords:b.toDoListKeywords,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.todoListPlaceholder,placeholder:b.todoListPlaceholder,type:"text"}]},{key:"meetingAgenda",category:"draftWithAI",name:b.meetingAgenda,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.meetingAgendaPlaceholder,placeholder:b.meetingAgendaPlaceholder,type:"text"}]},{key:"prosConsList",category:"draftWithAI",name:b.prosConsList,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.prosConsListPlaceholder,placeholder:b.prosConsListPlaceholder,type:"text"}]},{key:"jobDescription",category:"draftWithAI",name:b.jobDescription,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.jobDescriptionPlaceholder,placeholder:b.jobDescriptionPlaceholder,type:"text"}]},{key:"salesEmail",category:"draftWithAI",name:b.salesEmail,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.salesEmailPlaceholder,placeholder:b.salesEmailPlaceholder,type:"text"}]},{key:"recruitingEmail",category:"draftWithAI",name:b.recruitingEmail,svg:y.R,svgFill:i.FN.light.purple[400],steps:[{key:"topic",name:b.recruitingEmailPlaceholder,placeholder:b.recruitingEmailPlaceholder,type:"text"}]}],L=[F.It,{key:"continueWriting",category:"writeWithAI",name:b.continueWriting,svg:y.R,svgFill:i.FN.light.purple[400],requiresContent:!0},{key:"summarize",category:"extractFromContent",name:b.summarize,svg:f.Y,svgFill:i.FN.light.purple[400],requiresContent:!0},{key:"findActionItems",category:"extractFromContent",name:b.findActionItems,svg:u.O,svgFill:i.FN.light.purple[400],requiresContent:!0}];function _(e){if("string"==typeof e.name)return e.name;return T.default.getIntl().formatMessage(e.name)}function E(e){for(const t of N()){const o=(0,A.$W)(t);if(o&&e.startsWith(o))return{prompt:t,additionalContext:{topic:e}}}}function*N(){for(const t of R){var e;1===(null===(e=t.steps)||void 0===e?void 0:e.length)&&"topic"===t.steps[0].key&&(yield t)}}function B(e,t){const o=e.trim().toLocaleLowerCase();for(const n of N()){if((0,A.$W)(n,t).trim().toLocaleLowerCase()===o)return!0}return!1}function U(e){if(I.Z.isAssistantInWriterEnabled())return[];const t=[];return"cursor"===e.selectionType?e.isPageEmpty?t.push(...R):t.push(...L,...z,...R):t.push(...z,...L,...R),k.mN(t,(e=>e.key))}function O(e,t){switch(e){case"writeWithAI":return b.writeWithAI;case"draftWithAI":return b.draftWithAI;case"editContent":switch(t){case"page":return b.editPage;case"selection":return b.editSelection}break;case"extractFromContent":switch(t){case"page":return b.extractFromPage;case"selection":return b.extractFromSelection}}}function Z(e,t){const o={editContent:[],writeWithAI:[],draftWithAI:[],extractFromContent:[]};function n(e){return[e,o[e]]}for(const i of e)o[i.category].push(i);return"cursor"===t.selectionType?t.isPageEmpty?[n("draftWithAI"),n("writeWithAI")]:[n("writeWithAI"),n("extractFromContent"),n("editContent"),n("draftWithAI")]:[n("editContent"),n("extractFromContent"),n("writeWithAI"),n("draftWithAI")]}const z=[{key:"improveWriting",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:b.improveWriting,svg:l.d,svgFill:i.FN.light.purple[400]},{key:"fixSpellingGrammar",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:b.fixSpellingGrammar,svg:s.U,svgFill:i.FN.light.purple[400]},{key:"summarize",category:"extractFromContent",name:b.summarize,svg:f.Y,svgFill:i.FN.light.purple[400]},{key:"translate",category:"extractFromContent",name:b.translate,svg:d.Q,svgFill:i.FN.light.purple[400],generateName:b.translate,regenerateName:b.translate,steps:[{key:"language",name:b.translateLanguage,type:"dropdown",dropdownOptions:n.nI}]},{key:"explainThis",category:"extractFromContent",name:b.explainThis,svg:a.y,svgFill:i.FN.light.purple[400]},{key:"makeShorter",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:b.makeShorter,svg:p.f,svgFill:i.FN.light.purple[400]},{key:"makeLonger",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:b.makeLonger,svg:c.H,svgFill:i.FN.light.purple[400]},{key:"findActionItems",category:"extractFromContent",name:b.findActionItems,svg:u.O,svgFill:i.FN.light.purple[400]},{key:"changeTone",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:b.changeTone,svg:r.p,svgFill:i.FN.light.purple[400],generateName:b.changeTone,regenerateName:b.changeTone,steps:[{key:"tone",name:b.changeToneType,type:"dropdown",dropdownOptions:n.vK}]},{key:"simplifyLanguage",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:b.simplifyLanguage,svg:h.t,svgFill:i.FN.light.purple[400]},{key:"helpMeEdit",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:b.helpMeEdit,svg:l.d,svgFill:i.FN.light.purple[400],steps:[{key:"prompt",name:b.helpMeEditPlaceholder,placeholder:b.helpMeEditPlaceholder,type:"text"}]}];function D(e){return{key:"helpMeEdit",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:b.helpMeEdit,svg:l.d,svgFill:i.FN.light.purple[400],steps:[{key:"prompt",name:b.helpMeEditPlaceholder,placeholder:b.helpMeEditPlaceholder,type:"text",prefilledValue:e}]}}const V={key:"continueWriting",name:b.continueWriting};function H(e){let t=w.C.findNodeFromStore(e);if(t){if("table"===e.getType()){const e=t.querySelector(`.${x.euV}.notion-table-block`);t=e??t}return t.getBoundingClientRect()}}function $(e){const{origin:t}=e;return t instanceof M.G?H(t):t instanceof HTMLElement?t.getBoundingClientRect():t}function j(e){if(0===e.revisions.length)throw new Error("Assertion failure: no revisions exist")}function K(e){j(e);for(const t of Q(e))if("initial"===t.type)return t;throw new Error("Assertion failure, initial revision does not exist")}function G(e){return j(e),e.revisions[e.revisions.length-1]}function X(e){return"followup"===G(e).type}function q(e){return e.additionalContext&&(e.additionalContext.prompt||e.additionalContext.topic)||""}function Y(e){if(0===e.revisions.length)throw new Error("Assertion failure, expected revisions to be non-empty");return e.revisions.length-1}function*Q(e){let t=Y(e),o=0;for(;;){if(o+=1,o>1e4)throw new Error("Maximum iteration limit reached");const n=e.revisions[t];if(!n)throw new Error("Assertion failure, invalid revision index");if(yield n,"initial"===n.type)break;"followup"===n.type?t=n.previousRevision:(0,C.t1)(n)}}function J(){const e=P.default.state;return"completionPopup"===e.type&&"initialPromptForAIBlock"===e.stage&&!e.store.hasContent()}},96318:(e,t,o)=>{o.d(t,{SA:()=>g,ZE:()=>d,mw:()=>p});o(57658);var n=o(92595),i=o(29477),r=o(95477);let a=0;const s="clipboard",l={debug:Boolean(r.default.isDevelopingInAirplaneMode),responseText:s,showErrorCode:!1,delayBetweenChunks:20,chunkSize:5,numLoremIpsums:3},c="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porta auctor sem vel efficitur. Vivamus efficitur eros sed erat efficitur efficitur. Vivamus et augue vel est efficitur efficitur.";function p(){return l.debug}function d(){return l}function m(e){return{async*[Symbol.asyncIterator](){for(const t of e)await(0,i.Vs)(l.delayBetweenChunks),yield t}}}function u(e,t){const o=Math.ceil(e.length/t),n=new Array(o);for(let i=0,r=0;i<o;++i,r+=t)n[i]=e.substr(r,t);return n}function f(e){return e.map((e=>({type:"success",completion:e,inferenceId:"mock"})))}const g=async(e,t)=>{console.log("Retrieving fake completion for data",t);const{context:o}=t,n=o.selectedText,i=[];let{responseText:p}=l;if(p===s&&(p=await async function(){try{return await navigator.clipboard.readText()}catch(e){return}}()??"Unable to retrieve clipboard text."),void 0===p&&(i.push({type:"success",completion:"\n",inferenceId:"mock"},{type:"success",completion:"this is ",inferenceId:"mock"},{type:"success",completion:"fake ",inferenceId:"mock"},{type:"success",completion:`streaming response ${a++}.`,inferenceId:"mock"}),r.default.isDevelopingInAirplaneMode&&i.push({type:"success",completion:"\n\nTo see a real AI response, run the server with `--airplaneMode=false`.",inferenceId:"mock"}),"string"==typeof n)){i.push({type:"success",completion:"\n\nHere is the text you selected:\n\n",inferenceId:"mock"});for(const e of u(n,l.chunkSize))i.push({type:"success",completion:e,inferenceId:"mock"})}if(l.showErrorCode)i.push({type:"error",message:"alas",errorCode:l.showErrorCode});else if(void 0===p)for(let r=0;r<l.numLoremIpsums;r++)i.push(...f([`\n\n${r+1}. `,...u(c,0===l.delayBetweenChunks?c.length:l.chunkSize)]));else if(p.length>0){const e=u(p,l.chunkSize);i.push(...f(e))}return Promise.resolve({type:"success",data:m(i),status:200,headers:{}})};(0,n.exposeDebugValue)("completionDebugSettings",l)},28956:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(49085);class i extends n.default{getInitialState(){}}const r=new i}}]);