"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5309],{21292:(e,t,o)=>{o.d(t,{Z:()=>k});var n=o(67294),i=o(12183),r=o(480),s=o(86628),l=o(24405),a=o(56373),c=o(8848),d=o(59054),p=o(47453),u=o(6287),m=o(82990),g=o(9291),h=o(8406),S=o(54642),f=o(16956),y=o(47307),x=o(82530),v=o(42922),C=o(68894),b=o(68785),w=o(76798),j=o(32662),_=o(64369),M=o(33929),I=o(85893);const P=(0,g.defineMessages)({autoIncrementIdPrefixPlaceholder:{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPlaceholder"},duplicatePrefixNameError:{defaultMessage:"{prefixName} isn't available for use.",id:"database.viewSettings.propertyTab.duplicatePrefixNameError"}});function k(e){window.__c={n:"CollectionSettingsAutoIncrementIdProperty"};const{uniqueIdProperty:t,prefixValue:o,collectionContextStore:c}=e,b=(0,r.O7)(),k=(0,s.VK)((()=>c.collectionStore()),[c]),[F,R]=(0,n.useState)(o??""),[Z,A]=(0,n.useState)(!0),[V,B]=(0,n.useState)(),O=(0,n.useCallback)((()=>{A(!0),B(void 0)}),[A,B]),D=(0,n.useCallback)((e=>{A(!0),B(M.default.formatMessage(P.duplicatePrefixNameError,{prefixName:`"${e}"`}))}),[]),N=(0,n.useCallback)(((e,t,o)=>{const n=o.collectionStore();n&&(A(!1),S.setRecordKey(b,{spaceId:n.getSpaceId(),table:n.table,key:e,id:n.id}).then((n=>{A(!0),200!==n.status?D(e):h.$q({environment:b,collectionContextStore:o,property:t,from:"view_settings",action:"unique_id_change_collection_key"})})).catch((()=>D(e))))}),[b,D]),K=(0,n.useCallback)((async e=>{if(!k)return!1;const t=await S.isRecordKeyAvailable(b,{spaceId:k.getSpaceId(),table:k.table,key:e.trim()});return"success"===t.type&&t.data.isAvailable}),[k,b]),L=(0,i.v)((e=>{K(e).then((t=>{t||D(e),A(!0)})).catch((()=>D(e)))}),500),[E]=(0,d.r5)((async()=>{if(k)return S.suggestRecordKey(b,{spaceId:k.getSpaceId(),table:u.v,id:k.id,shouldSetSuccessfullySuggestedRecord:!1})}),[k,b]);(0,n.useEffect)((()=>{var e;if(!o&&"resolved"===E.status)return"success"===(null===(e=E.value)||void 0===e?void 0:e.type)&&E.value.data?(B(void 0),void R(E.value.data.key)):void 0}),[o,E]),(0,n.useEffect)((()=>()=>{L.cancel()}),[L]);const q=(0,n.useCallback)((e=>{const t=e.target.value.toUpperCase();R(t),O(),t&&t!==o&&((0,a.k5)(t)||B(M.default.formatMessage(a.sY.prefixInvalidError)),A(!1),L(t))}),[O,o,L]),W=(0,n.useCallback)((()=>{L.flush()}),[L]),G=(0,n.useCallback)((e=>{const n=null==k?void 0:k.getRecordKeyStore();e!==o&&!V&&n&&k&&null!=t&&t.propertySchema?N(e,null==t?void 0:t.propertyId,c):A(!0)}),[k,o,V,t,N,c]),z=(0,n.useCallback)((()=>{const e=c.collectionStore();e&&x.createAndCommit({userAction:"CollectionSettingsAutoIncrementIdPropertyCreateNewIdProperty",environment:b,perform:t=>{const o=f.G3({environment:b,collectionStore:e,collectionViewArgs:void 0,propertyType:"auto_increment_id",transaction:t});N(F,o,c)}})}),[c,b,F,N]),U=(0,n.useCallback)((e=>{if(!k)return;const t=[{label:(0,I.jsx)(g.FormattedMessage,{id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit",defaultMessage:"Update ID Prefix"}),color:"red",onAccept:()=>G(e)}];y.showDialog({message:(0,I.jsx)("span",{children:(0,I.jsx)(g.FormattedMessage,{id:"database.viewSettings.propertyTab.changePrefixConfirmationMessage",defaultMessage:"Updating the prefix will stop 3rd party automations that rely on this ID (e.g., GitHub PR status automation).",values:{databaseName:(0,I.jsx)(w.Z,{style:{display:"inline",fontWeight:m.Z.fontWeight.medium},shouldWrap:!0,store:k})}})}),showCancel:!0,keepFocus:!0,items:t})}),[k,G]),$=(0,n.useCallback)((e=>{o?U(e):G(e)}),[o,G,U]),H=(0,n.useCallback)((()=>t?t&&!o?(0,I.jsxs)(I.Fragment,{children:[(0,p.R)({width:14,height:14}),(0,I.jsx)(j.Z,{size:4}),(0,I.jsx)(g.FormattedMessage,{defaultMessage:"Add ID prefix",id:"database.viewSettings.propertyTab.autoIncrementIdCreatePrefix"})]}):(0,I.jsx)(g.FormattedMessage,{defaultMessage:"Update ID Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit"}):(0,I.jsxs)(I.Fragment,{children:[(0,p.R)({width:14,height:14}),(0,I.jsx)(j.Z,{size:4}),(0,I.jsx)(g.FormattedMessage,{defaultMessage:"Add ID property",id:"database.viewSettings.propertyTab.autoIncrementIdCreateProperty"})]})),[o,t]),Y=(0,l.yK)((e=>({prefixInputOuterStyle:{color:void 0===o?e.lightTextColor:e.regularTextColor}})),[o]);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(C.ZP,{left:(0,I.jsx)(_.Z,{style:{marginLeft:4,marginRight:7},children:(0,I.jsx)(g.FormattedMessage,{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefix"})}),value:F,inputOuterStyle:Y.prefixInputOuterStyle,onChange:q,onBlur:W,placeholder:P.autoIncrementIdPrefixPlaceholder.defaultMessage,onSubmit:()=>$(F.trim()),focusInitial:!1,selectAll:!1,disabled:!1}),V||!Z?(0,I.jsx)(T,{prefixName:F,hasRequestCompleted:Z,errorMessage:V}):(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(_.Z,{isSmall:!0,isSecondaryColor:!0,style:{marginTop:16,marginLeft:16},children:(0,I.jsx)(g.FormattedMessage,{defaultMessage:"{prefixWithHyphen}1, {prefixWithHyphen}2, {prefixWithHyphen}3, ...",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPreview",values:{prefixWithHyphen:F?`${F}-`:""}})})}),(0,I.jsx)(v.Z,{isLarge:!0,style:{margin:"8px 16px",width:"90%"},onClick:()=>{t?$(F.trim()):z()},disabled:F===o||Boolean(V)||!Z,children:H()})]})}function T(e){const{errorMessage:t,hasRequestCompleted:o}=e;return(0,I.jsx)(_.Z,{isMultiline:!0,style:{paddingTop:12,marginLeft:16,marginRight:16,...o?{color:c.ZP.red}:{},...e.styles},isSecondaryColor:!o,children:o&&t?t:(0,I.jsx)("div",{style:{paddingTop:3,paddingBottom:3},children:(0,I.jsx)(b.Z,{style:{width:14,height:14}})})})}},34464:(e,t,o)=>{o.d(t,{V:()=>I,m:()=>M});var n=o(67294),i=o(480),r=o(76487),s=o(86628),l=o(49085),a=o(92996),c=o(34296),d=o(47453),p=o(82990),u=o(9291),m=o(8406),g=o(5149),h=o(94419),S=o(82530),f=o(40663),y=o(75330),x=o(72495),v=o(89014),C=o(43696),b=o(97372),w=o(94166),j=o(32628),_=o(85893);function M(e){window.__c={n:"CollectionSettingsCreateViewSource"};const{collectionContextStore:t,collectionSettingsStore:o}=e,v=(0,i.O7)(),C=(0,n.useMemo)((()=>l.default.createValue("")),[]),M=(0,r.Z)(),[P,k,T,F]=(0,s.VK)((()=>[t.collectionViewBlockStore(),t.collectionStore(),t.getCollectionViewBlockSourceState(),C.state]),[t,C]);return P?(0,_.jsx)(b.ZP,{...e,title:(0,_.jsx)(u.FormattedMessage,{defaultMessage:"Select data source",id:"database.viewSettings.createViewSourceTab.title"}),handleClose:()=>{m.tW({environment:v,eventName:"abandoned_search",queryLength:F.length,sessionId:M,source:c.S.Source}),g.E3({collectionSettingsStore:o})},footer:"uninitialized"===T&&(0,_.jsx)(x.Z,{topBorder:!0,children:(0,_.jsx)(w.Z,{icon:d.R,isGray:!0,title:F?(0,_.jsx)(u.FormattedMessage,{defaultMessage:"New database “{filterText}”",id:"database.viewSettings.createViewSourceTab.newCollectionWithNameButton.title",values:{filterText:(0,_.jsx)("span",{style:{...p.Z.textOverflowStyle,fontWeight:p.Z.fontWeight.medium,maxWidth:160,display:"inline-block",verticalAlign:"bottom"},children:F})}}):(0,_.jsx)(u.FormattedMessage,{defaultMessage:"New database",id:"database.viewSettings.createViewSourceTab.newCollectionButton.title"}),onClick:()=>function(e,t,o,n){m.wd({environment:o,collectionContextStore:e,action:"select_new_collection"}),g.E3({collectionSettingsStore:t});const i=e.collectionViewStore(),r=e.collectionViewBlockStore();i&&r&&g.nr({environment:o,selectedDBType:a.br,collectionName:n,collectionContextStore:e,collectionViewBlockStore:r,collectionViewStore:i,useTemporaryRecordCache:!1,baseViewType:"table"})}(t,o,v,F)})}),children:(0,_.jsx)(j.Z,{collectionContextStore:t,selectedCollectionStore:k,parentStore:P,onAccept:e=>function(e,t,o,n){S.createAndCommit({userAction:"CollectionSettingsCreateViewSource.handleSourcePickerAccept",environment:t,perform:n=>{y.yc({environment:t,collectionContextStore:o,collectionStore:e,transaction:n});const i=o.collectionViewStore(),r=o.collectionViewBlockStore(),s=e.getParentBlockStore();i&&s&&null!=r&&r.isDefined()&&(0,f.h7)(r)&&h.BE({parent:s.getCollectionViewsStore(),insert:i,transaction:n})}}),I({collectionStore:e,collectionContextStore:o,collectionSettingsStore:n})}(e,v,t,o),context:c.S.Source,inputStore:C,searchSessionId:M})}):null}async function I(e){const{collectionStore:t,collectionContextStore:o,collectionSettingsStore:n}=e,i=o.collectionViewBlockStore(),r=o.collectionViewStore(),s=t.getParentBlockStore();if(!i||!s||!r)return;await Promise.all([...s.getCollectionViewStores().map((e=>e.load())),...i.getCollectionViewStores().map((e=>e.load()))]);(0,C.g)({collectionStore:t,sourceCollectionViewBlockStore:s,currentCollectionViewBlockStore:i,currentCollectionViewStore:r,constraints:(0,v.x)(r.id)}).length>0?g.H4({collectionSettingsStore:n,item:{type:"duplicateExistingView"}}):g.H4({collectionSettingsStore:n,item:{type:"createView"}})}},43696:(e,t,o)=>{o.d(t,{Z:()=>Z,g:()=>R});o(57658),o(67294);var n=o(83355),i=o(26263),r=o(49085),s=o(56666),l=o(47453),a=o(72126),c=o(9291),d=o(8406),p=o(5149),u=o(9953),m=o(82530),g=o(75330),h=o(20616),S=o(68155),f=o(10906),y=o(73657),x=o(52275),v=o(68894),C=o(32163),b=o(72495),w=o(33929),j=o(89014),_=o(29798),M=o(68373),I=o(97372),P=o(94166),k=o(85893);const T=(0,c.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a view…",id:"database.viewSettings.duplicateExistingViewTab.inputPlaceholder"}});class F extends n.Z{constructor(){super(...arguments),this.temporaryRecordCache=new i.Z({name:"CollectionSettingsDuplicateExistingView"}),this.lastDuplicatedViewId=void 0,this.originalCollectionPointer=void 0,this.didAccept=!1,this.preselectedViewPointer=void 0,this.storeTypes={inputStore:r.default.createClass(""),menuListStore:_.Z,limitStore:r.default.createClass(!0)},this.handlePreviewCollectionView=e=>{this.duplicateViewSettings(e,!0)},this.handlePreviewCollectionViewDebounced=a.Ds(this.handlePreviewCollectionView,500),this.handleMenuListStoreChange=()=>{const e=this.stores.menuListStore.state,{device:t}=this.environment;if(void 0===e.focus.indexGlobal||t.isMobile)return;const o=this.getCurrentResult().viewStores[e.focus.indexGlobal];o&&this.handlePreviewCollectionViewDebounced(o)},this.handleDuplicateViewAccept=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.temporaryRecordCache),d.wd({environment:this.environment,collectionContextStore:o,action:"click_duplicate_view"}),this.duplicateViewSettings(e,!1),p.wl({collectionSettingsStore:t,item:{type:"main",selectViewNameInitial:!0}}),this.didAccept=!0},this.handleNewEmptyViewClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;d.wd({environment:this.environment,collectionContextStore:t,action:"click_new_empty_view"}),p.E3({collectionSettingsStore:e}),p.H4({collectionSettingsStore:e,item:{type:"createView"}}),this.didAccept=!0}}UNSAFE_willMount(e){const{collectionContextStore:t}=e,{device:o}=this.environment,n=t.collectionStore(),i=t.collectionViewStore();if(!i)return;const r=(0,j.x)(i.id);this.preselectedViewPointer=null==r?void 0:r.viewPointer,this.originalCollectionPointer=null==n?void 0:n.pointer,this.environment.defaultRecordCache.inMemoryRecordCache.addCacheOverride(this.temporaryRecordCache),this.stores.menuListStore.addListener(this.handleMenuListStoreChange);const{viewStores:s}=this.getCurrentResult(),[l]=s;!o.isMobile&&l&&this.duplicateViewSettings(l,!0)}willUnmount(){if(this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.temporaryRecordCache),this.stores.menuListStore.removeListener(this.handleMenuListStoreChange),!this.didAccept){const{viewStores:e}=this.getCurrentResult(),t=this.lastDuplicatedViewId?e.find((e=>e.id===this.lastDuplicatedViewId)):e[0];if(!t)return;this.duplicateViewSettings(t,!1)}}renderComponent(){const{inputStore:e,menuListStore:t,limitStore:o}=this.stores,{device:n}=this.environment,i=e.state,{viewStores:r,showMore:d}=this.getCurrentResult(),p=a.oA(r.map((e=>{const t=e.getType(),o=e.getFormat().collection_view_icon;if(!t||"page"===t)return;const n=e.getName(),i=e.id;return{key:i,render:e=>{var r;return(0,k.jsx)(x.Z,{...e,title:(0,k.jsx)(S.Z,{collectionViewType:t,collectionViewName:n}),icon:(0,k.jsx)(h.F,{color:"regular",viewIcon:o,viewType:t,style:{marginRight:6}}),checkState:(null===(r=this.preselectedViewPointer)||void 0===r?void 0:r.id)===i})},action:()=>{this.handleDuplicateViewAccept(e)}}})));if(d>0){const e={key:"showMore",render:e=>(0,k.jsx)(x.Z,{...e,icon:(0,s.o)({width:16,height:16,color:this.theme.mediumTextColor}),style:{color:this.theme.mediumTextColor},title:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.duplicateExistingViewTab.showMore.title",values:{showMore:d}})}),action:()=>{o.setState(!1)}};p.push(e)}return(0,k.jsxs)(I.ZP,{...this.props,title:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"Copy an existing view",id:"database.viewSettings.duplicateExistingViewTab.title"}),footer:(0,k.jsx)(b.Z,{topBorder:!0,children:(0,k.jsx)(P.Z,{icon:l.R,isGray:!0,title:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"New empty view",id:"database.viewSettings.duplicateExistingViewTab.newEmptyViewButton.title"}),onClick:this.handleNewEmptyViewClick})}),children:[(d>0||i)&&(0,k.jsx)(b.Z,{children:(0,k.jsx)(v.ZP,{focusInitial:!n.isMobile||void 0,value:i,onChange:n=>{e.setState(n.target.value),t.setState({focus:{section:0,indexLocal:0,indexGlobal:0}}),o.setState(!0)},placeholder:w.default.formatMessage(T.inputPlaceholder),showClearButton:!0})}),p.length>0&&(0,k.jsx)(C.Z,{type:C.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,k.jsx)(b.Z,{...e}),items:p}],store:t}),0===p.length&&(0,k.jsx)(y.Z,{caption:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.duplicateExistingViewTab.noResultsTitle"})})]})}getCurrentResult(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore(),o=e.collectionStore(),n=e.collectionViewStore();if(!t||!o||!n)return{viewStores:[],showMore:0};const{inputStore:i,limitStore:r}=this.stores,s=i.state,l=o.getParentBlockStore();if(!t||!l)return{viewStores:[],showMore:0};let a=R({collectionStore:o,sourceCollectionViewBlockStore:l,currentCollectionViewBlockStore:t,currentCollectionViewStore:n,constraints:(0,j.x)(n.id)}),c=0;return s?a=a.filter((e=>(0,f.D)(e,s))):r.state&&(c=a.length-7,a=a.slice(0,7)),{viewStores:a,showMore:c}}duplicateViewSettings(e,t){if(e.id===this.lastDuplicatedViewId&&t)return;this.lastDuplicatedViewId=e.id;const{collectionContextStore:o}=this.props,n=o.collectionViewStore(),i=e.getType();if(!n||!i)return;const r=e.getName(),s=e.getPageSort(),l=e.getFormat(),a=e.getKeyStore("query2").getValue();let c=n;t&&(c=n.clone(this.temporaryRecordCache)),m.createAndCommit({userAction:"CollectionSettingsDuplicateExistingView.duplicateViewSettings",environment:this.environment,perform:e=>{u.sW({store:c,data:{name:r,type:i,page_sort:s,format:{...l,collection_pointer:this.originalCollectionPointer},query2:a},transaction:e})}}),g.Ip({collectionContextStore:o})}}function R(e){const{collectionStore:t,sourceCollectionViewBlockStore:o,currentCollectionViewBlockStore:n,currentCollectionViewStore:i,constraints:r}=e;let s=a.mN([...n.getCollectionViewStores(),...o.getCollectionViewStores()],(e=>e.id)).filter((e=>{var o;return(null===(o=e.getCollectionStore())||void 0===o?void 0:o.id)===t.id&&e.id!==i.id&&"page"!==e.getType()}));if(null!=r&&r.viewType&&(s=[...s.filter((e=>e.getType()===r.viewType)),...s.filter((e=>e.getType()!==r.viewType))]),null!=r&&r.viewPointer){const{id:e}=r.viewPointer,t=s.find((t=>t.pointer.id===e))||M.Xr.createChildStore(o,r.viewPointer);s=[t,...s.filter((t=>t.pointer.id!==e))]}return s}F.displayName="CollectionSettingsDuplicateExistingView";const Z=(0,c.injectIntl)(F)},59862:(e,t,o)=>{o.d(t,{Z:()=>he});var n=o(67294),i=o(480),r=o(86628),s=o(24405),l=o(77657),a=o(29109),c=o(97880),d=o(9291),p=o(47307),u=o(89475),m=o(16732),g=o(51592),h=o(89728),S=o(72495),f=o(32662),y=o(12205),x=o(30874),v=o(21292),C=(o(57658),o(99036)),b=o(39068),w=o(84619),j=o(74487);const _={pull_request_review_edited:!0,pull_request_review_submitted:!0,pull_request_review_requested:!0,pull_request_review_request_removed:!0,pull_request_closed:!0,pull_request_opened:!0,pull_request_reopened:!0,installation_deleted:!0,installation_suspend:!0,installation_unsuspend:!0,pull_request_converted_to_draft:!0,pull_request_edited:!0,pull_request_assigned:!0},M={pull_request_opened:!0,pull_request_review_requested:!0,pull_request_review_submitted:!0,pull_request_closed:!0};(0,c.AO)((e=>{const t=(0,c.Yd)(_);return(0,c.DE)(t,e)?{true:e}:{false:e}}));j.literals(...(0,c.Yd)({pull_request:!0,pull_request_review:!0,installation:!0})),j.literals(...(0,c.Yd)(_));var I=o(33907),P=o(47453),k=o(37612),T=o(8406),F=o(16956),R=o(82530),Z=o(75330),A=o(42922),V=o(52275),B=o(31945),O=o(96525),D=o(61519),N=o(78140),K=o(32163),L=o(40721),E=o(22084),q=o(66890),W=o(33929),G=o(87279),z=o(29376),U=o(94166),$=o(85893);const H=(0,d.defineMessages)({autoUpdate:{defaultMessage:"Auto-update",id:"collectionSettingsGithubAutomationConfig.statusPicker.autoUpdate"},when:{defaultMessage:"when PR is",id:"collectionSettingsGithubAutomationConfig.statusPicker.when"},addStatusDescription:{defaultMessage:"Add a status property to set up automations.",id:"collectionSettingsGithubAutomationConfig.addStatusDescription"},addStatusButton:{defaultMessage:"Add status property",id:"collectionSettingsGithubAutomationConfig.statusPicker.addStatusButton"},newStatusPropertyButton:{defaultMessage:"New status",id:"collectionSettingsGithubAutomationConfig.statusPicker.newStatusPropertyButton"},pull_request_opened:{defaultMessage:"Opened",id:"collectionSettingsGithubAutomationConfig.pullRequestOpened"},pull_request_review_requested:{defaultMessage:"Review requested",id:"collectionSettingsGithubAutomationConfig.pullRequestReviewRequested"},pull_request_review_submitted:{defaultMessage:"Approved",id:"collectionSettingsGithubAutomationConfig.pullRequestApproved"},pull_request_closed:{defaultMessage:"Merged",id:"collectionSettingsGithubAutomationConfig.pullRequestMerged"},noAutomations:{defaultMessage:"None",id:"collectionSettingsGithubAutomationConfig.noAutomation"},removeStatusOption:{defaultMessage:"Clear",id:"collectionSettingsGithubAutomationConfig.removeStatusOption"}}),Y={pull_request_opened:W.default.formatMessage(H.pull_request_opened),pull_request_review_requested:W.default.formatMessage(H.pull_request_review_requested),pull_request_review_submitted:W.default.formatMessage(H.pull_request_review_submitted),pull_request_closed:W.default.formatMessage(H.pull_request_closed)},Q=W.default.formatMessage(H.noAutomations),X={pull_request_opened:null,pull_request_review_requested:null,pull_request_review_submitted:null,pull_request_closed:null};function J(e){window.__c={n:"CollectionSettingsGithubAutomationConfig"};const{gitHubProperty:t,selectedStatusProperty:o,setSelectedStatusProperty:s,intl:l}=e,a=(0,i.O7)(),d=(0,q.Y$)(),p=(0,i.Fy)(),u=ne(),m=(0,r.VK)((()=>{const e=(0,z.KV)(d,t);if(e&&(0,C.NK)(e))return e}),[d,t]),g=(0,r.VK)((()=>{const e=d.normalizedSchemaStore.state;return(0,c.qP)(e).flatMap((e=>{let[t,o]=e;return o&&(0,C.gB)(o)?[{id:t,schema:o}]:[]}))}),[d.normalizedSchemaStore]);(0,n.useEffect)((()=>{if(!o&&g.length>0){if(null!=m&&m.connectedRelation.automation)for(const t of g)if(m.connectedRelation.automation[t.id])return void s(t);const e=g[0];s(e)}}),[g,m,o,s]);const[h,y]=(0,n.useState)(X);(0,n.useEffect)((()=>{var e,t;o&&m&&(0,C.NK)(m)&&null!==(e=m.connectedRelation.automation)&&void 0!==e&&e[o.id]?y(null===(t=m.connectedRelation.automation)||void 0===t?void 0:t[o.id]):y(X)}),[m,o]);const x=(0,n.useCallback)((e=>{const n=d.collectionStore();if(!(n&&o&&m&&(0,C.p_)(m)))return;const i=m.connectedRelation;if(!i||!o.id)return;i.automation={...i.automation,...e};const r={...m,connectedRelation:{...i}};T.$q({environment:a,collectionContextStore:d,property:o.id,from:"github_pull_requests_property",action:"configure_github_pr_automation",githubAutomationConfigured:e}),R.createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomation",environment:a,perform:e=>{Z.xO({environment:a,collectionStore:n,update:{[t]:r},transaction:e})}})}),[d,o,m,a,t]),v=(0,r.VK)((()=>o&&o.schema.options?o.schema.options:[]),[o]),b=(0,r.VK)((()=>{const e={};return v.forEach((t=>{e[t.id]=t})),e}),[v]),j=(0,r.VK)((()=>{var e,t;const n=null==o||null===(e=o.schema)||void 0===e?void 0:e.groups,i=null==o||null===(t=o.schema)||void 0===t?void 0:t.options;return n&&i?n.map((e=>{const t=i.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));if(0!==t.length)return{group:e,groupOptions:t}})).filter(c.$K):[]}),[o]);function _(e,t){const n=j.map((t=>{let{group:n,groupOptions:i}=t;const r=i.map((t=>({key:t.id,render:e=>(0,$.jsx)(V.Z,{...e,focused:e.focused,isTokenTitle:!0,title:(0,$.jsx)(E.F,{format:w.lo.Small,value:t.value,color:t.color,showRemoveButton:!1,groupColor:n.color,isSingle:!0})}),action:()=>{const n={...h,[e]:t.id};o&&(x({[o.id]:n}),y(n))}}))).filter(c.$K);return{key:n.name,render:e=>(0,$.jsx)(S.Z,{...e,title:n.name,topBorder:e.index>0}),items:r}}));if(h[e]){function i(){const n={...h,[e]:null};o&&(x({[o.id]:n}),y(n)),t.close()}const r={key:"removeOptionSection",render:e=>(0,$.jsx)(S.Z,{...e,topBorder:!0}),items:[{key:"removeOptionButton",render:e=>(0,$.jsx)(V.Z,{...e,focused:!1,title:l.formatMessage(H.removeStatusOption),left:(0,k.y)({width:12}),onClick:i}),action:e=>{i()}}]};n.push(r)}return n}return o?(0,$.jsx)(S.Z,{topBorder:!1,disableDesktopPadding:!0,disableMobilePadding:!0,title:(0,$.jsx)(te,{selectedStatusProperty:o,setSelectedStatusProperty:s,existingStatusProperties:g,intl:l}),children:(0,c.Yd)(M).map((e=>(0,$.jsx)(O.Z,{focused:!1,placementToOrigin:B.pO.Top,alignmentToOrigin:B.vR.End,popupType:p.isMobile?B.Z4.SlideUp:B.Z4.Popup,render:t=>{const o=p.isMobile?{menuType:G.og.Modal,right:(0,$.jsx)(L.DoneMenuText,{}),onClickRight:t.close}:{menuType:G.og.Popup,width:150};return(0,$.jsx)(N.Z,{...o,children:(0,$.jsx)(K.Z,{type:K.i.Vertical,sections:_(e,t),initialFocus:void 0,onAccept:t.close})})},renderOrigin:t=>{const n=h[e];let i=(0,$.jsx)("div",{style:u.noneText,children:Q});if(n){const e=b[n];if(e){var r;const t=null==o||null===(r=o.schema)||void 0===r||null===(r=r.groups)||void 0===r||null===(r=r.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(n)})))||void 0===r?void 0:r.color;i=(0,$.jsx)(E.F,{format:w.lo.Small,showRemoveButton:!1,isSingle:!0,value:e.value,color:e.color,groupColor:t})}}return(0,$.jsx)(U.Z,{...t,focused:!1,icon:()=>(0,$.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"flex-start",whiteSpace:"nowrap"},children:[Y[e],(0,$.jsx)(f.Z,{size:8}),(0,I.n)(u.automationMenuItemArrow)]}),title:(0,$.jsx)("div",{style:{width:"100%",display:"inline-flex",justifyContent:"flex-end"},children:i}),showChevron:!0,chevronStyle:{margin:0}})}},e)))}):(0,$.jsx)(ee,{setSelectedStatusProperty:s,intl:l})}function ee(e){window.__c={n:"AddStatusProperty"};const{setSelectedStatusProperty:t,intl:o}=e,n=(0,i.O7)(),r=(0,q.Y$)(),s=ne();return(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,$.jsx)(D.Z,{size:"100%",innerStyle:s.addStatusDivider}),(0,$.jsx)("div",{style:s.addStatusDescription,children:o.formatMessage(H.addStatusDescription)}),(0,$.jsxs)(A.Z,{style:s.addStatusButton,onClick:e=>{e.stopPropagation(),oe(n,r,t)},children:[(0,P.R)({width:14}),(0,$.jsx)(f.Z,{size:4}),o.formatMessage(H.addStatusButton)]}),(0,$.jsx)(f.Z,{size:4})]})}function te(e){window.__c={n:"GithubStatusPropertyPicker"};const{selectedStatusProperty:t,setSelectedStatusProperty:o,existingStatusProperties:n,intl:r}=e,l=(0,i.O7)(),a=(0,q.Y$)(),d=(0,i.Fy)(),p=ne(),u=(0,s.Fg)(),m=n.map((e=>{const{id:t,schema:n}=e;return{key:t,action:()=>{o(e)},render:t=>(0,$.jsx)(V.Z,{...t,icon:(0,$.jsx)(b.ZP,{size:14,theme:u,icon:e&&e.schema.icon,type:"status"}),title:n.name})}})).filter(c.$K),g={key:"newStatusProperty",action:()=>{oe(l,a,o)},render:e=>(0,$.jsx)(V.Z,{...e,icon:(0,P.R)(p.statusPickerIcon),title:r.formatMessage(H.newStatusPropertyButton)})};return(0,$.jsxs)("div",{style:p.statusPickerWrapper,children:[(0,$.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[r.formatMessage(H.autoUpdate),d.isMobile&&(0,$.jsx)(f.Z,{size:4}),(0,$.jsx)(B.ZP,{placementToOrigin:B.pO.Bottom,alignmentToOrigin:B.vR.Start,popupType:d.isMobile?B.Z4.SlideUp:B.Z4.Popup,renderOrigin:e=>(0,$.jsx)(V.Z,{...e,title:t.schema.name,focused:!1,style:p.statusPickerButtonCore,textWrapperStyle:p.statusPickerButtonTextWrapper,left:(0,$.jsx)(b.ZP,{size:14,theme:u,icon:t.schema.icon,type:"status"}),leftStyle:{marginLeft:2},showExtensionArrow:!0,extensionArrowStyle:p.statusPickerExtensionArrow}),render:e=>{const t=d.isMobile?{menuType:G.og.ActionSheet}:{menuType:G.og.Popup,width:150};return(0,$.jsx)(N.Z,{...t,children:(0,$.jsx)(K.Z,{type:K.i.Vertical,sections:[{key:0,render:e=>(0,$.jsx)(S.Z,{...e}),items:[...m,g]}],initialFocus:0,onAccept:e.close})})}})]}),d.isMobile&&(0,$.jsx)(f.Z,{size:4}),r.formatMessage(H.when)]})}function oe(e,t,o){const n=t.collectionStore();n&&R.createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomationCreateNewStatusProperty",environment:e,perform:i=>{const r=F.G3({environment:e,collectionStore:n,collectionViewArgs:void 0,propertyType:"status",transaction:i}),s=(0,z.KV)(t,r);s&&(0,C.gB)(s)&&o({id:r,schema:s})}})}function ne(){const e=(0,i.Fy)().isMobile;return(0,s.yK)((t=>({addStatusDivider:{borderColor:t.tableDividerColor},addStatusDescription:{width:"calc(100% - 24px)",padding:e?"16px 8px":"14px 0px",fontSize:e?16:12,color:t.lightTextColor},addStatusButton:{width:"calc(100% - 24px)",display:"inline-flex",alignItems:"center",justifyContent:"center"},noneText:{color:t.lightTextColor},automationMenuItemArrow:{width:12,fill:t.lightIconColor,stroke:t.lightIconColor,strokeOpacity:.5,strokeWidth:2},statusPickerWrapper:{display:"inline-flex",alignItems:"center",flexWrap:"wrap",rowGap:2,marginBottom:e?10:void 0},statusPickerButtonTextWrapper:{margin:"0px 4px",fontSize:12},statusPickerButtonCore:{minHeight:e?28:20,borderRadius:5,maxWidth:e?150:100},statusPickerIcon:{width:14,height:14},statusPickerExtensionArrow:{transform:"rotate(180deg)",marginRight:2}})),[e])}var ie=o(64155);const re=(0,d.defineMessages)({tabTitle:{defaultMessage:"GitHub Pull Requests",id:"database.viewSettings.githubConfigTab.tabTitle"},connect:{defaultMessage:"Connect to GitHub (Workspace)",id:"database.viewSettings.githubConfigTab.connect"},connectDescriptionAdmin:{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) connection.",id:"database.viewSettings.githubConfigTab.connectDescriptionAdmin"},authError:{defaultMessage:"Auth failed. Please try again or contact Notion support.",id:"database.viewSettings.githubConfigTab.authError"},tabDescriptionNoIdPrefix:{defaultMessage:"This feature requires a prefixed ID property to link GitHub PRs to Notion {pluralItemName}.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoIdPrefix"},tabDescriptionNoStatus:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoStatus"},tabDescription:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title. Set up automated status updates in Notion based on PR status changes.",id:"database.viewSettings.githubConfigTab.tabDescription"}});function se(e){let{collectionContextStore:t,intl:o}=e;window.__c={n:"UnauthedFallback"};const n=ge(),{hoveredBackground:s,pressedBackground:l}=me(),a=(0,y.J)(),c=(0,i.O7)(),d=ue(),g=function(e){return(0,r.VK)((()=>{var t;return null===(t=e.collectionStore())||void 0===t?void 0:t.getSpaceId()}),[e])}(t);return(0,$.jsxs)(S.Z,{disableMobileBorders:!0,mobileStyle:n.previewContentContainer,style:n.previewContentContainer,children:[(0,$.jsx)("img",{src:"/images/external_integrations/github-icon.png",style:{width:36,height:36}}),(0,$.jsx)("p",{style:n.connectDescription,children:a?(0,m.GT)().description:o.formatMessage(re.connectDescriptionAdmin)}),(0,$.jsx)(h.Z,{style:n.connectButton,hoveredStyle:{background:s},pressedStyle:{background:l},disabled:!a,disabledFeedback:!a,onClick:async e=>{if(e.preventDefault(),g&&d)try{await u.hM({environment:c,spaceId:g,integration:d,from:"connected_relation_property_menu"})}catch(t){const e=o.formatMessage(re.authError);p.showErrorMessage(e)}},children:o.formatMessage(re.connect)}),(0,$.jsx)(f.Z,{size:4})]})}function le(e){let{collectionContextStore:t}=e;window.__c={n:"UserEducationSection"};const o=ge(),{isMobile:n}=(0,i.Fy)(),r=pe(t);return(0,$.jsxs)(S.Z,{disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,mobileStyle:o.previewContentContainer,style:o.previewContentContainer,children:[(0,$.jsx)(f.Z,{size:n?16:8}),(0,$.jsx)(ie.Z,{width:"calc(100% - 24px)",uniqueIdPrefix:null==r?void 0:r.prefix})]})}function ae(e){let{collectionContextStore:t,intl:o,selectedStatusProperty:n}=e;window.__c={n:"DescriptionSection"};const i=(0,r.VK)((()=>t.databaseType),[t]),s=pe(t),l=ge(),a=(0,g.sN)(i),c=(0,g.Q_)(i);let d;return d=s&&s.prefix?n?o.formatMessage(re.tabDescription,{singleItemName:a}):o.formatMessage(re.tabDescriptionNoStatus,{singleItemName:a}):o.formatMessage(re.tabDescriptionNoIdPrefix,{pluralItemName:c}),(0,$.jsx)(S.Z,{disableMobileBorders:!0,disableMobilePadding:!0,mobileStyle:l.tabDescription,style:l.tabDescription,children:d})}function ce(e){let{collectionContextStore:t}=e;window.__c={n:"UniqueIdSection"};const o=pe(t);return o&&o.prefix?null:(0,$.jsx)(v.Z,{collectionContextStore:t,uniqueIdProperty:o&&{propertyId:o.id,propertySchema:o.schema},prefixValue:null==o?void 0:o.prefix})}function de(e){let{collectionContextStore:t,selectedStatusProperty:o,setSelectedStatusProperty:n,property:i,intl:r}=e;window.__c={n:"AutomationConfigSection"};const s=pe(t);return s&&s.prefix?(0,$.jsx)(J,{selectedStatusProperty:o,setSelectedStatusProperty:n,gitHubProperty:i,intl:r}):null}function pe(e){return(0,r.VK)((()=>{var t,o;const n=null===(t=e.collectionStore())||void 0===t||null===(t=t.getRecordKeyStore())||void 0===t?void 0:t.getRecordKey(),i=null===(o=e.collectionStore())||void 0===o?void 0:o.getSchema(),r=i&&(0,c.qP)(i).find((e=>{let[,t]=e;return t&&"auto_increment_id"===t.type}));if(r){const[e,t]=r;if(t&&"auto_increment_id"===t.type)return{id:e,schema:t,prefix:n}}}),[e])}function ue(){return(0,r.VK)((()=>x.Z.integrations.state.find((e=>e.id===l.U9))),[])}function me(){const e=ue(),t=(0,s.Fg)();return(0,r.VK)((()=>(0,a.d)(e,t.mode)),[e,t.mode])}function ge(){const{isMobile:e}=(0,i.Fy)(),{background:t}=me();return(0,s.yK)((o=>({previewContentContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},connectButton:{fontSize:14,maxWidth:"calc(100% - 24px)",height:void 0,color:o.regularInvertedTextColor,background:t,whiteSpace:"normal",padding:8,textAlign:"center"},connectDescription:{maxWidth:"calc(100% - 24px)",color:o.lightTextColor,fontSize:14,textAlign:"center"},tabDescription:{padding:e?18:14,fontSize:e?16:12,color:o.lightTextColor}})),[e,t])}const he=(0,d.injectIntl)((function(e){window.__c={n:"CollectionSettingsGithubConfig"};const{collectionContextStore:t,property:o,intl:i}=e,[s,a]=(0,n.useState)(void 0);return(0,r.VK)((()=>{const e=x.Z.bots.state.find((e=>e.integration_id===l.U9));return Boolean(e)}),[])?(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(le,{collectionContextStore:t}),(0,$.jsx)(ae,{collectionContextStore:t,intl:i,selectedStatusProperty:s}),(0,$.jsx)(ce,{collectionContextStore:t}),(0,$.jsx)(de,{collectionContextStore:t,selectedStatusProperty:s,setSelectedStatusProperty:a,property:o,intl:i})]}):(0,$.jsx)(se,{collectionContextStore:t,intl:i})}))},64155:(e,t,o)=>{o.d(t,{Z:()=>d});o(67294);var n=o(480),i=o(24405),r=o(41892),s=o(82990),l=o(9291),a=o(32662),c=o(85893);function d(e){window.__c={n:"CollectionSettingsGithubPrTaskPreview"};const t=(0,l.useIntl)(),o=function(e){const{isMobile:t}=(0,n.Fy)(),o=t?18:14,r=1,l=6,a=20;return(0,i.yK)((t=>({githubContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:e||"90%",padding:a,border:`${r}px solid ${t.tableDividerColor}`,borderRadius:l,borderBottomRightRadius:4,cursor:"default"},githubPrTitleRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",width:`calc(100% + ${a}px)`,overflow:"hidden"},githubPrTitle:{display:"inline-flex",fontSize:o,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",background:t.whiteButtonBackground,padding:"2px 4px",borderTopLeftRadius:5,borderBottomLeftRadius:5,borderLeft:`2px solid ${t.blueColor}`,borderTop:`2px solid ${t.blueColor}`,borderBottom:`2px solid ${t.blueColor}`,width:"100%"},githubTask:{background:"light"===t.mode?t.accentColors.blue[50]:t.accentColors.blue[400]},githubPrInfoRow:{display:"inline-flex"},githubPrInfoPill:{display:"flex",flexDirection:"row",alignItems:"center",width:"fit-content",padding:"4px 10px",borderRadius:"2em",background:"#238636",flexShrink:0,...s.Z.textOverflowStyle},githubPrInfoOpenText:{color:"white",fontSize:o-2,fontWeight:500},githubPrInfoMergeInto:{display:"inline-flex",alignItems:"center",fontSize:o-2,color:t.lightTextColor,...s.Z.textOverflowStyle},githubPrInfoMain:{padding:"0px 4px",fontFamily:s.Z.baseFontFamily.githubMono,background:t.cardPressedBackground,borderRadius:l,color:t.regularTextColor,verticalAlign:"text-bottom",...s.Z.textOverflowStyle}})),[o,e])}(e.width),d=(0,c.jsx)("div",{id:"github-preview-github-pr-title-row",style:o.githubPrTitleRow,children:(0,c.jsxs)("div",{id:"github-preview-github-pr-title-wrapper",style:o.githubPrTitle,children:[(0,c.jsx)(a.Z,{size:2}),"[",(0,c.jsxs)("div",{id:"github-preview-github-pr-task",style:o.githubTask,children:[e.uniqueIdPrefix||t.formatMessage(p.idPrefix),e.uniqueIdValue?`-${e.uniqueIdValue}`:"-1"]}),"]",(0,c.jsx)(a.Z,{size:2}),t.formatMessage(p.prTitle)]})}),u=(0,c.jsxs)("div",{id:"github-preview-github-pr-info-row",style:o.githubPrInfoRow,children:[(0,c.jsxs)("div",{id:"github-preview-github-open-pr-pill",style:o.githubPrInfoPill,children:[(0,c.jsx)("img",{src:r.Z.images.externalIntegrations.githubPullOpenIconWhitePng,style:{width:16,height:16}}),(0,c.jsx)(a.Z,{size:2}),(0,c.jsx)("div",{style:o.githubPrInfoOpenText,children:t.formatMessage(p.open)})]}),(0,c.jsx)(a.Z,{size:8}),(0,c.jsx)("div",{id:"github-preview-github-merge-into-main",style:o.githubPrInfoMergeInto,children:(0,c.jsxs)("span",{style:o.githubPrInfoMergeInto,children:[t.formatMessage(p.mergeInto),(0,c.jsx)(a.Z,{size:4}),(0,c.jsx)("span",{style:o.githubPrInfoMain,children:t.formatMessage(p.main)})]})})]});return(0,c.jsxs)("div",{id:"github-preview-github-container",style:o.githubContainer,children:[d,(0,c.jsx)(a.Z,{size:12}),u]})}const p=(0,l.defineMessages)({dismissButtonAriaLabel:{defaultMessage:"A button to dismiss the user education preview.",id:"database.viewSettings.githubConfigTab.preview.dismissButtonAriaLabel"},idPrefix:{defaultMessage:"TASK",id:"database.viewSettings.githubConfigTab.preview.idPrefix"},prTitle:{defaultMessage:"GitHub PR Title",id:"database.viewSettings.githubConfigTab.preview.prTitle"},open:{defaultMessage:"Open",id:"database.viewSettings.githubConfigTab.preview.open"},mergeInto:{defaultMessage:"Merge into",id:"database.viewSettings.githubConfigTab.preview.mergeInto"},main:{defaultMessage:"main",id:"database.viewSettings.githubConfigTab.preview.main"}})},57230:(e,t,o)=>{o.d(t,{Z:()=>Z});var n=o(67294),i=o(480),r=o(86628),s=o(24405),l=o(84169),a=o(72126),c=o(72141),d=o(9291),p=o(8406),u=o(42922),m=o(68894),g=o(76798),h=o(72495),S=o(86825),f=o(26388),y=o(64369),x=o(12534),v=o(29376),C=o(4023),b=o(85893);function w(e){window.__c={n:"CollectionSettingsAutoRelateSwitch"};const{temporaryAutoRelateState:t,handleAutoRelateToggle:o,collectionContextStore:n,targetCollectionStore:i,autoRelate:a,hasInverseRelation:c}=e,p=(0,r.VK)((()=>n.collectionStore()),[n]),u=(0,r.VK)((()=>Boolean(null==p?void 0:p.isSyncedCollection())),[p]),m=(0,r.VK)((()=>(null==p?void 0:p.getFormat().bot_id)||i.getFormat().bot_id),[p,i]),g=(0,r.VK)((()=>!!m&&(u||!u&&c)),[m,u,c]),h=(0,s.yK)((e=>({errorLabel:{margin:"0px 14px",color:e.errorText},helpIcon:{width:16,fill:e.lightIconColor,marginLeft:6}})),[]),y=(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:[(0,b.jsx)(d.FormattedMessage,{defaultMessage:"Automatically Relate",id:"database.viewSettings.setupRelationTab.autoRelate.title"}),(0,b.jsx)(f.ZP,{render:e=>(0,b.jsx)("div",{...e,children:(0,l.m)(h.helpIcon)}),style:{width:200},placement:C.u.Bottom,textWrap:!0,renderTooltip:()=>(0,b.jsx)(d.FormattedMessage,{defaultMessage:"Relations will automatically populate based on links found in page properties.",id:"database.viewSettings.setupRelationTab.autoRelateTooltip"})})]});return g?(0,b.jsx)(S.Z,{title:y,on:t?t.enabled:!!a&&(null==a?void 0:a.enabled),focused:!1,onClick:()=>o(m),textWrapperStyle:{opacity:1}}):null}var j=o(40113),_=o(95474),M=o(19871),I=o(42696),P=o(82990),k=o(31278);function T(e){window.__c={n:"CollectionSettingsRelationVisualizer"};const{collectionContextStore:t,targetCollectionStore:o,propertySchema:n,propertyName:i,temporaryInverseState:l,hasInverseRelation:a,inverseRelationName:c,isInitialPropertyName:p}=e,u=(0,d.useIntl)(),m=(0,r.VK)((()=>t.collectionStore()),[t]),g=l?l.hasInverseRelation:a,S=(0,r.VK)((()=>Boolean(m&&o.id===m.id)),[m,o]),f=(0,r.VK)((()=>{const e=l?l.inverseName:c;return e||(null!=m&&m.isDefined()?v.aI(u,{sourceCollection:m.getModel(),isSelfRelation:S,targetCollectionStore:o,createUnique:!0}):"")}),[m,u,c,S,l,o]),x=(0,r.VK)((()=>null!=m&&m.isDefined()?f===v.aI(u,{sourceCollection:m.getModel(),isSelfRelation:S,targetCollectionStore:o,createUnique:!1}):void 0),[m,u,f,S,o]),C=Boolean(!S&&p&&(!g||g&&x)),w=(0,s.yK)((e=>({preview:{background:e.inputBackground,marginLeft:14,marginRight:14,padding:C?"42px 12px":12,boxShadow:e.inputBoxShadow,borderRadius:4,display:"flex",flexDirection:"column",justifyContent:"center"},condensedView:{height:22,display:"flex",justifyContent:"center",alignItems:"center"},condensedProperties:{width:33,height:g?20:10,margin:"0px 12px",display:"flex",flexDirection:"column",justifyContent:"center"},databasesRow:{height:22}})),[C,g]);return m?(0,b.jsx)(h.Z,{title:(0,b.jsx)(y.Z,{isSmall:!0,isSecondaryColor:!0,children:(0,b.jsx)(d.FormattedMessage,{defaultMessage:"Preview",id:"database.viewSettings.setupRelationTab.relationVisualizer.title"})}),disableMobileBorders:!0,children:(0,b.jsx)("div",{style:w.preview,children:C?(0,b.jsxs)("div",{style:w.condensedView,children:[(0,b.jsx)(R,{collectionStore:m,condensedView:!0}),(0,b.jsxs)("div",{style:w.condensedProperties,children:[(0,b.jsx)(F,{propertyName:i||(null==n?void 0:n.name),condensedView:!0}),g&&(0,b.jsx)(F,{propertyName:f,condensedView:!0,isInverse:!0})]}),(0,b.jsx)(R,{collectionStore:o,condensedView:!0,isTarget:!0})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(F,{propertyName:i||(null==n?void 0:n.name),bidirectional:S&&!g}),(0,b.jsxs)("div",{style:w.databasesRow,children:[(0,b.jsx)(R,{collectionStore:m}),(0,b.jsx)(R,{collectionStore:o,isTarget:!0})]}),g&&(0,b.jsx)(F,{propertyName:f,isInverse:!0})]})})}):null}function F(e){window.__c={n:"RelationVisualizerProperty"};const{propertyName:t,bidirectional:o,isInverse:n,condensedView:i}=e,r=(0,s.yK)((e=>({propertyLabel:{fontSize:12,wordBreak:"break-word",...P.Z.textOverflowStyle,maxWidth:200,alignSelf:"center",color:e.mediumTextColor,fill:e.mediumIconColor},arrow:{width:136,height:25,alignSelf:"center",transform:n?"rotate(180deg)":void 0,margin:n?"6px 12px 0px 6px":"0px 6px 6px 6px",opacity:.3,fill:e.regularIconColor},smallArrow:{height:8,paddingLeft:1,marginTop:n?2:void 0,display:"inherit",transform:n?"rotate(180deg)":void 0,opacity:.3,fill:e.regularIconColor}})),[n]),l=(0,b.jsx)("div",{style:r.propertyLabel,children:t||""});return(0,b.jsxs)(b.Fragment,{children:[!n&&!i&&l,i?(0,_.p)(r.smallArrow):o?(0,M.G)(r.arrow):(0,j.h)(r.arrow),n&&!i&&l]})}function R(e){window.__c={n:"RelationVisualizerDatabase"};const{collectionStore:t,condensedView:o,isTarget:n}=e,i=(0,r.VK)((()=>t.getIcon()),[t]),l=(0,s.yK)((e=>({wrapper:{display:"flex",alignItems:"center",padding:2,color:e.mediumTextColor,fill:e.mediumIconColor,position:o?void 0:"absolute",left:o?void 0:n?"72%":"28%",transform:o?void 0:"translate(-50%, 0)",width:"fit-content"},icon:{marginRight:4,width:12,height:12},title:{fontSize:12,wordBreak:"break-word",...P.Z.textOverflowStyle,maxWidth:100}})),[o,n]);return(0,b.jsxs)("div",{style:l.wrapper,children:[i?(0,b.jsx)(k.Z,{icon:i,isEmptyPage:!1,size:12,disabled:!0,style:l.icon}):(0,I.t)(l.icon),(0,b.jsx)(g.Z,{store:t,style:l.title})]})}function Z(e){window.__c={n:"CollectionSettingsInverseRelationConfig"};const{collectionContextStore:t,property:o,propertyName:a,targetCollectionStore:m,onSubmit:y,buttonContents:j,isInitialPropertyName:_,temporaryInverseState:M,setTemporaryInverseState:I,from:P}=e,k=(0,i.O7)(),F=(0,r.VK)((()=>o?v.KV(t,o):void 0),[t,o]),R=(0,r.VK)((()=>t.collectionStore()),[t]),Z=(0,r.VK)((()=>Boolean(R&&R.id===m.id)),[R,m]),V=(0,r.VK)((()=>Boolean(o?v.OP(t,o,m):void 0)),[t,o,m]),B=(0,r.VK)((()=>{if("relation"!==(null==F?void 0:F.type))return"";const e=F.property;if(!e||e===o)return"";const t=m.getRole();if(!t||!c.YX(t))return"";const n=m.getSchema()[e];return(null==n?void 0:n.name)||""}),[m,o,F]),O=(0,r.VK)((()=>"relation"===(null==F?void 0:F.type)&&F.autoRelate?F.autoRelate:{enabled:!1}),[F]),D=(0,r.VK)((()=>Boolean(v.gZ(m))),[m]),N=(0,r.VK)((()=>Boolean((null==R?void 0:R.getDatabaseType())&&o&&(null==R?void 0:R.isTypedProperty(o)))),[R,o]),K=(0,r.VK)((()=>t.contextType),[t]),L=(0,s.yK)((e=>({errorLabel:{margin:"0px 14px",color:e.errorText},helpIcon:{width:16,fill:e.lightIconColor,marginLeft:6}})),[]),E=(0,n.useMemo)((()=>M?M.hasInverseRelation:V),[M,V]),q=(0,n.useMemo)((()=>M?M.inverseName:B),[M,B]),W=(0,n.useMemo)((()=>M?M.autoRelate:O),[M,O]),G=(0,n.useCallback)((()=>{const e=null!=R&&R.isSyncedCollection()?W:E?{enabled:!1}:W;I({hasInverseRelation:!E,inverseName:E?void 0:q,autoRelate:e}),o&&p.$q({environment:k,collectionContextStore:t,property:o,from:"collectionPage"===K?"page_properties":"view_settings",action:E?"relation_toggle_inverse_off":"relation_toggle_inverse_on",is_self_relation:Z})}),[I,E,q,W,t,R,o,K,Z,k]),z=(0,n.useCallback)((e=>{I({hasInverseRelation:!0,inverseName:e.target.value,autoRelate:W})}),[I,W]),U=(0,n.useCallback)((e=>{const n=null!=W&&W.enabled?{enabled:!1}:{enabled:!0,bot_id:e};I({hasInverseRelation:E,inverseName:q,autoRelate:n}),o&&p.$q({environment:k,collectionContextStore:t,property:o,from:"collectionPage"===K?"page_properties":"view_settings",action:n.enabled?"auto_relation_toggle_on":"auto_relation_toggle_off"})}),[o,I,t,K,q,E,W,k]),$=(0,n.useCallback)((e=>{(0,x.ZP)({event:e,context:x.Af.CollectionSettingsClick,callback:y})}),[y]),H=(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:[Z?(0,b.jsx)(d.FormattedMessage,{id:"database.viewSettings.setupRelationTab.selfRelation.reverse",defaultMessage:"Separate directions"}):(0,b.jsx)(d.FormattedMessage,{id:"database.viewSettings.setupRelationTab.relation.reverse",defaultMessage:"Show on {databaseName}",values:{databaseName:(0,b.jsx)(g.Z,{style:{display:"inline"},store:m})}}),(0,b.jsx)(f.ZP,{render:e=>(0,b.jsx)("div",{...e,children:(0,l.m)(L.helpIcon)}),style:{width:200},placement:C.u.Bottom,textWrap:!0,renderTooltip:()=>!D||N?(0,b.jsx)(d.FormattedMessage,{defaultMessage:"Cannot edit target database.",id:"database.viewSettings.setupRelationTab.inverseDisabledWarning.title"}):Z?(0,b.jsx)(d.FormattedMessage,{defaultMessage:"Create separate properties for each direction of a two-way relation. Useful for modeling Parent task/Sub-tasks, Blocked by/Blocking, and more.",id:"database.viewSettings.setupRelationTab.inverseRelationTooltip.selfRelation"}):(0,b.jsx)(d.FormattedMessage,{defaultMessage:"Create a property on {databaseName} showing backlinks to the current database",id:"database.viewSettings.setupRelationTab.inverseRelationTooltip",values:{databaseName:(0,b.jsx)(g.Z,{style:{display:"inline"},store:m})}})})]});return(0,b.jsxs)(b.Fragment,{children:[!(Z&&V)&&!P&&(0,b.jsx)(S.Z,{title:H,on:E,focused:!1,onClick:G,disabled:!D||Z&&V||N,textWrapperStyle:{opacity:1}}),(0,b.jsx)(A,{collectionContextStore:t,targetCollectionStore:m,isSelfRelation:Z,temporaryInverseState:M,hasInverseRelation:V,inverseRelationName:B,disabled:!D||N,onChange:z,from:P}),(0,b.jsx)(w,{handleAutoRelateToggle:U,temporaryAutoRelateState:null==M?void 0:M.autoRelate,collectionContextStore:t,autoRelate:O,targetCollectionStore:m,hasInverseRelation:E}),(()=>{if("relation"!==(null==F?void 0:F.type))return!0;if(M){if(M.hasInverseRelation!==V)return!0;if(M.inverseName&&M.inverseName!==B)return!0;if(M.autoRelate&&M.autoRelate.enabled!==O.enabled)return!0}return!1})()&&(0,b.jsx)(h.Z,{children:(0,b.jsx)(u.Z,{style:{display:"flex",margin:"6px 12px 0px 12px"},onClick:$,children:j})}),"subitem"!==P&&"timeline_arrows_by"!==P&&(0,b.jsx)(T,{propertySchema:F,propertyName:a,collectionContextStore:t,targetCollectionStore:m,temporaryInverseState:M,hasInverseRelation:V,inverseRelationName:B,isInitialPropertyName:_})]})}function A(e){window.__c={n:"CollectionSettingsInverseRelationName"};const{collectionContextStore:t,targetCollectionStore:o,isSelfRelation:n,temporaryInverseState:i,hasInverseRelation:s,inverseRelationName:l,disabled:c,onChange:p,from:u}=e,S=(0,d.useIntl)(),f=(0,r.VK)((()=>{const e=t.collectionStore();return null!=e&&e.isDefined()?v.aI(S,{sourceCollection:e.getModel(),isSelfRelation:n,targetCollectionStore:o,createUnique:!0,from:u}):S.formatMessage({id:"database.viewSettings.setupRelationTab.inverseRelationName.placeholder",defaultMessage:"Related to target"})}),[t,S,n,o,u]);return(i?i.hasInverseRelation:s)?(0,b.jsx)(h.Z,{title:!u&&(0,b.jsx)(y.Z,{isSmall:!0,isSecondaryColor:!0,children:(0,b.jsx)(d.FormattedMessage,{defaultMessage:"Related property on {databaseName}",id:"database.viewSettings.setupRelationTab.inverseRelationNameInput.title",values:{databaseName:(0,b.jsx)(g.Z,{style:{display:"inline"},store:o})}})}),children:(0,b.jsx)(m.ZP,{value:"subitem"!==u&&"timeline_arrows_by"!==u?(null==i?void 0:i.inverseName)||l:f,placeholder:f,onChange:p,onBlur:a.yR,onSubmit:a.yR,focusInitial:!1,selectAll:!1,disabled:c})}):null}},71268:(e,t,o)=>{o.d(t,{C:()=>h,U:()=>S});var n=o(67294),i=o(480),r=o(99036),s=o(9291),l=o(8406),a=o(82530),c=o(75330),d=o(52821),p=o(85893);function u(e,t,o){return"1"===e?"relation"===t?o&&!0===o?(0,p.jsx)(s.FormattedMessage,{defaultMessage:"1 item",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne.connectedRelation"}):(0,p.jsx)(s.FormattedMessage,{defaultMessage:"1 page",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne.relation"}):(0,p.jsx)(s.FormattedMessage,{defaultMessage:"1 {type}",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne",values:{type:d.SO[t]}}):"no_limit"===e?(0,p.jsx)(s.FormattedMessage,{defaultMessage:"No limit",id:"database.viewSettings.collectionPropertyLimitHelpers.noLimit"}):void 0}function m(e,t,o){return{key:e,title:u(e,t,o)}}var g=o(18533);function h(e){window.__c={n:"CollectionSettingsLimitOptions"};const{property:t,propertySchema:o,collectionContextStore:s}=e,d=(0,i.O7)(),u=(0,n.useCallback)((e=>{const n=s.collectionStore();if(!n||!(0,r.en)(o))return;const i={...o,limit:Number(e)?1:void 0};a.createAndCommit({userAction:"CollectionSettingsLimitOptions.handleLimitChange",environment:d,perform:e=>{c.xO({environment:d,collectionStore:n,update:{[t]:i},transaction:e})}});const p=Number(e)?`${o.type}_toggle_limit_on`:`${o.type}_toggle_limit_off`;l.$q({environment:d,collectionContextStore:s,property:t,from:"view_settings",action:p})}),[s,d,t,o]);return(0,r.en)(o)?"relation"===o.type&&o.connectedRelation?(0,p.jsx)(S,{propertyType:o.type,connectedRelation:!0,selectedKey:o.limit?"1":"no_limit",onChange:u}):(0,p.jsx)(S,{propertyType:o.type,selectedKey:o.limit?"1":"no_limit",onChange:u}):null}function S(e){const{propertyType:t,selectedKey:o,connectedRelation:n,onChange:i}=e;return(0,p.jsx)(g.Z,{title:(0,p.jsx)(s.FormattedMessage,{defaultMessage:"Limit",id:"database.viewSettings.collectionPropertyLimitHelpers.limit"}),selectedKey:o,popupStyle:{minWidth:190},options:[m("1",t,n),m("no_limit",t)],onChange:i})}},71214:(e,t,o)=>{o.d(t,{I:()=>m});var n=o(67294),i=o(480),r=o(86628),s=o(49085),l=o(40107),a=o(27153),c=o(68894),d=o(2520),p=o(33929),u=o(85893);const m=n.forwardRef((function(e,t){window.__c={n:"CollectionSettingsNameInput"};const{placeholder:o,focusInitial:m,selectAll:g,disabled:h,inputOuterStyle:S,iconButton:f,inputRightButton:y,initialValue:x,onBlur:v,onSubmit:C}=e,b=(0,i.O7)(),w=(0,r.qz)(e.inputStore,s.default),j=(0,r.VK)((()=>w.state),[w]),_=(0,n.useCallback)((()=>{v(j)}),[j,v]),M=(0,n.useCallback)((()=>{C(j)}),[j,C]),I=(0,n.useCallback)((e=>{w.setState(e.target.value)}),[w]),P=(0,l.S)();return(0,n.useEffect)((()=>{w.setState(x)}),[]),(0,n.useEffect)((()=>()=>{P()&&x!==j&&v(j)}),[x,j,P,v]),(0,u.jsx)(c.ZP,{ref:t,focusInitial:m,selectAll:g,value:j,onChange:I,onBlur:_,onSubmit:M,placeholder:o,disabled:h,textWrapperStyle:{opacity:h?.7:void 0},inputOuterStyle:S,left:f&&(0,u.jsx)(c.DO,{icon:f.icon,iconStyle:f.iconStyle,onClick:e=>function(e,t,o){if(!(o&&e.target instanceof Element))return;const n=p.default.getIntl(),{onSubmit:i,enforceIconColor:r,includeEmojiTab:s}=o;a.$(t,{originRect:e.target.getBoundingClientRect(),originGap:3,popupHeight:d.DQ,popupWidth:d.rw,showArrow:!0,title:n.formatMessage({defaultMessage:"Icon",id:"mediaPicker.tabs.icon"}),currentTab:"icon",tabs:s?[{type:"emoji",onChange:(e,t)=>{i(e),t&&t.keepVisible||a.Z()}},{type:"icon",enforceIconColor:r,onChange:(e,t)=>{i(e),t&&t.keepVisible||a.Z()}}]:[{type:"icon",enforceIconColor:r,onChange:(e,t)=>{i(e),t&&t.keepVisible||a.Z()}}],onDelete:()=>{i(),a.Z()}})}(e,b,f),disabled:h}),showClearButton:!1,inputRight:y})}))},74817:(e,t,o)=>{o.d(t,{mJ:()=>to,ZP:()=>oo,sY:()=>Jt});o(21703),o(57658);var n=o(67294),i=o(73935),r=o(83355),s=o(1302),l=o(480),a=o(86628),c=o(24405),d=o(49085),p=o(99036),u=o(80951),m=o(8848),g=o(39068),h=o(79362),S=o(5257),f=o(88437),y=o(44643),x=o(55964),v=o(16184),C=o(37612),b=o(72050),w=o(108),j=o(3791),_=o(97880),M=o(82990),I=o(9291),P=o(10910),k=o(8406),T=o(16956),F=o(5149),R=o(87085),Z=o(96802),A=o(80402),V=o(82530),B=o(34517),O=o(40663),D=o(51592),N=o(75330),K=o(10906),L=o(30905),E=o(91965),q=o(74420),W=o(31278),G=o(76798),z=o(72495),U=o(32662),$=o(24006),H=o(26388),Y=o(64369),Q=o(18145),X=o(28020),J=o(52821),ee=o(43224),te=o(99417),oe=o(19124),ne=o(33929),ie=o(18514),re=o(77546),se=o(67695),le=o(61766),ae=o(77080),ce=o(83212),de=o(68373),pe=o(88280),ue=o(17095),me=o(27871),ge=o(21292),he=o(9953),Se=o(93174),fe=o(39093),ye=o(9015),xe=o(96245),ve=o(68894),Ce=o(5971),be=o(68910),we=o(97372),je=o(85893);function _e(e){window.__c={n:"CollectionSettingsButtonOptions"};const{collectionContextStore:t,propertySchema:o,propertyId:i}=e,r=(0,l.O7)().currentUser.id,s=(0,Ce.E)("automation_ui_unify"),[c,d]=(0,n.useState)([]),p=(0,a.VK)((()=>t.permissionScopes.state),[t]),u=(0,a.VK)((()=>t.collectionStore()),[t]),m=(0,a.VK)((()=>null==u?void 0:u.getSpaceId()),[u]),{maybePersistedAutomationStore:g,maybePersistedTransactionActions:h}=(0,xe.$)({automationId:o.automation_id,spaceId:m,defaultValue:void 0,persist:!0}),S=(0,a.VK)((()=>null==g?void 0:g.getTrigger()),[g]),f=(0,n.useMemo)((()=>{if(g)return new be.L({type:"button_property",persisted:!0,automationStore:g,collectionContextStore:t,propertyId:i,propertySchema:o,intl:ne.default.getIntl(),parentRecordStore:g,currentUserId:r})}),[i,o,g,t,r]),y=(0,a.VK)((()=>(null==g?void 0:g.getNameStore().getValue())??""),[g]),x=(0,n.useCallback)((e=>{if(!g)return;const t=e.currentTarget.value;h.createAndCommit({userAction:"CollectionSettingsButtonOptions.setName",perform:e=>{he.sO({store:g.getNameStore(),transaction:e,value:t})}})}),[g,h]),v=(0,n.useCallback)((e=>{d((t=>[...t,e.id]))}),[]);return u&&g&&S&&"button"===S.type&&f?(0,je.jsxs)(ye.Z.Provider,{value:{automationContextStore:f,collectionStore:u,disabled:!1,editorPlacement:{type:"inline"},editorWidth:we.nJ,maybePersistedTransactionActions:h,onActionAdded:v,suppressActionErrors:c},children:[(0,je.jsx)(z.Z,{topBorder:!0,title:(0,je.jsx)(I.FormattedMessage,{id:"database.buttonProperty.label",defaultMessage:"Label"}),children:(0,je.jsx)(ve.ZP,{disabled:!p.canConfigureCollection,placeholder:ne.default.formatMessage(Me.inputPlaceholder),value:y,onChange:x})}),s?(0,je.jsx)(z.Z,{style:{paddingInline:12},children:(0,je.jsx)(fe._v,{areActionsEditable:!0,areTriggersEditable:!1})}):(0,je.jsxs)(z.Z,{title:(0,je.jsx)(I.FormattedMessage,{id:"database.buttonProperty.actions",defaultMessage:"Actions"}),children:[(0,je.jsx)(Se.C,{contextStore:f,disabled:!p.canConfigureCollection,suppressErrors:!0,onActionAdded:()=>{},buttonPlacement:void 0}),(0,je.jsx)("div",{})]})]}):null}const Me=(0,I.defineMessages)({inputPlaceholder:{defaultMessage:"Type a name for this button...",id:"database.buttonProperty.label.inputPlaceholder"}});var Ie=o(13991),Pe=o(40506),ke=o(11843),Te=o(18533);const Fe=function(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"CollectionSettingsDateOptions"};const n=(0,I.useIntl)(),i=(0,l.O7)(),r=(0,a.VK)((()=>Re(t,o)),[t,o]);if(!r)return null;const s=r.date_format||Pe.sF,c=function(e){const t=Ze();for(const o in t)if(t[o]===e)return o;return"12h"}(r.time_format||Pe.c_);return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Te.Z,{title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Date format",id:"database.viewSettings.dateOptions.dateFormat"}),selectedKey:s,popupStyle:{minWidth:190},options:Pe.Zy.map((e=>({key:e,title:n.formatMessage(Pe.fy[e])}))),onChange:e=>function(e,t,o,n){const i=o.collectionStore(),r=Re(o,n);if(!i||!r)return;const s={...r,date_format:e};V.createAndCommit({userAction:"CollectionSettingsDateOptions.handleDateFormatChange",environment:t,perform:e=>{N.xO({environment:t,collectionStore:i,update:{[n]:s},transaction:e})}}),k.$q({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"date_change_format"})}(e,i,t,o)}),(0,je.jsx)(Te.Z,{title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Time format",id:"database.viewSettings.dateOptions.timeFormat"}),selectedKey:c,popupStyle:{minWidth:190},options:Pe.L7.map((e=>({key:e,title:n.formatMessage(Pe.Fi[e])}))),onChange:e=>function(e,t,o,n){const i=o.collectionStore(),r=Re(o,n);if(!i||!r)return;const s=Ze()[e],l={...r,time_format:s};V.createAndCommit({userAction:"CollectionSettingsDateOptions.handleClockFormatChange",environment:t,perform:e=>{N.xO({environment:t,collectionStore:i,update:{[n]:l},transaction:e})}}),k.$q({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"date_change_time_format"})}(e,i,t,o)})]})};function Re(e,t){const o=e.normalizedSchemaStore.state[t];if(o)return"date"===o.type||"created_time"===o.type||"last_edited_time"===o.type||"last_visited_time"===o.type?o:void 0}function Ze(){return(0,ke.E)(Ie.SP).time}var Ae=o(22686);function Ve(e){window.__c={n:"CollectionSettingsDefaultPersonPicker"};const{collectionContextStore:t,property:o,propertySchema:i}=e,r=(0,l.O7)(),s=(0,n.useCallback)((e=>{const n={...i,default:"created_by"===e?"created_by":void 0},s=t.collectionStore();if(!s)return;const l=[],a={pointer:s.pointer,command:"update",path:["schema",o],args:{default:e}};l.push(a),N.HW({environment:r,collectionStore:s,performTransaction:e=>{for(const t of l)V.applyOperation({store:(0,de.Kv)(s,t.pointer),operation:t,transaction:e})}}),V.createAndCommit({userAction:"CollectionSettingsDefaultPersonPicker.handleChange",environment:r,perform:e=>{N.xO({environment:r,collectionStore:s,update:{[o]:n},transaction:e})}})}),[t,r,o,i]);return(0,je.jsx)(Te.Z,{title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Default",id:"CollectionSettingsDefaultPersonPicker.default.title"}),selectedKey:i.default?"created_by":"no_default",popupStyle:{minWidth:190},options:[{key:"no_default",title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"No default",id:"CollectionSettingsDefaultPersonPicker.options.noDefault"})},{key:"created_by",title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Created by",id:"CollectionSettingsDefaultPersonPicker.options.creator"}),icon:(0,Ae.f)({width:16})}],onChange:s})}var Be=o(62965),Oe=o(31945),De=o(53437),Ne=o(72589),Ke=o(77907),Le=o(94166);function Ee(e){let{collectionContextStore:t,collectionSettingsStore:o,property:i}=e;window.__c={n:"CollectionSettingsFormulaOptions"};const r=(0,l.O7)(),s=(0,a.qz)(void 0,le.Z),c=(0,n.useCallback)((e=>{const n=t.collectionStore();if(!n)return null;const s=t.normalizedSchemaStore.state[i];if("formula"!==(null==s?void 0:s.type))return;const l=Boolean(n.getDatabaseType()&&n.isTypedProperty(i)),a=null==o?void 0:o.getState().fromBlock;return(0,je.jsx)(Ke.DependencyConsumer,{dependency:Ke.deps.formulas,children:t=>(0,je.jsx)(Ne.Z,{handleClose:e.close,property:i,getRecordModel:n.getRecordModel,propertySchema:s,collectionStore:n,handleSave:e=>function(e,t){const{newValue:o,newType:n,propertySchema:i,property:r,collectionStore:s}=e,l=o?{...i,formula2:{code:o,result_type:n},version:"v2"}:{...i,formula2:void 0,version:"v2"};V.createAndCommit({userAction:"CollectionSettingsFormulaOptions.handleFormulaChange",environment:t,perform:e=>{N.xO({environment:t,collectionStore:s,update:{[r]:l},transaction:e})}})}(e,r),formulas:t,disabled:l,blockStore:a,analyticsFrom:"view_settings"})})}),[t,o,r,i]);return(0,je.jsx)(Oe.ZP,{popupType:r.device.isMobile?De.kQ.SlideUp:De.kQ.Popup,alignmentToOrigin:Oe.vR.End,renderOrigin:e=>(0,je.jsx)(Le.Z,{title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Formula",id:"database.viewSettings.formulaOptions.title"}),right:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Edit",id:"database.viewSettings.formulaOptions.edit"}),showChevron:!0,rotateChevron:s.state.open,...e}),render:c,buttonPopupStore:s})}const qe=n.memo(Ee,Be.Z);var We=o(59862),Ge=o(73590),ze=o(71268),Ue=o(71214),$e=o(35011),He=o(34299),Ye=o(35102),Qe=o(42853),Xe=o(38737),Je=o(64921),et=o(74194),tt=o(85248),ot=o(78942),nt=o(58573),it=o(15157),rt=o(87279),st=o(29798),lt=o(52275),at=o(78140),ct=o(32163);const dt="LastUsedCurrency";class pt extends r.Z{constructor(){super(...arguments),this.storeTypes={numberFormatFilterStore:d.default.createClass(""),menuListStore:st.Z},this.handleNumberFormatFilterChange=e=>{this.stores.numberFormatFilterStore.setState(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:rt.og.ActionSheet}:{menuType:rt.og.Popup};const o=!e.isMobile&&(0,je.jsx)(z.Z,{isInput:!0,children:(0,je.jsx)(ve.ZP,{value:this.stores.numberFormatFilterStore.state,onChange:this.handleNumberFormatFilterChange,focus:!0,focusAfterAnimation:!0,placeholder:ne.default.getIntl().formatMessage({defaultMessage:"Filter formats…",id:"blockPropertyValue.filterForNumberFormats.placeholder"}),preventCaptureDeleteWhenEmpty:!0})});return(0,je.jsx)(at.Z,{...t,header:o,children:(0,je.jsx)(ct.Z,{type:ct.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,je.jsx)(z.Z,{...e}),items:this.getMenuItems()}],store:this.stores.menuListStore})})}getMenuItems(){const e=it.Z.get({userId:this.environment.currentUser.id,key:dt});return(0,nt.ZP)(this.stores.numberFormatFilterStore.state,(0,Xe.jD)(e),(e=>e)).map((e=>({key:e,render:t=>(0,je.jsx)(mt,{name:e,props:t}),action:()=>function(e,t,o,n,i,r){const s=n[o];if(!s)return;if("number"!==s.type&&"formula"!==s.type)return;const l={...s,number_format:e,..."percent"===e&&void 0!==(null==s?void 0:s.show_as)?{show_as:{...null==s?void 0:s.show_as,maxValue:1}}:{}};"number"===s.type&&(0,Xe.b3)(e)&&it.Z.set({userId:i.currentUser.id,key:dt,value:e});V.createAndCommit({userAction:"NumberFormatMenu.handleNumberFormatChange",environment:i,perform:e=>{N.xO({environment:i,collectionStore:t,update:{[o]:l},transaction:e})}}),null==r||r()}(e,this.props.collectionStore,this.props.property,this.props.schema,this.environment,this.props.onClose)})))}}pt.displayName="NumberFormatMenu";const ut=pt;function mt(e){let{name:t,props:o}=e;return(0,je.jsx)(lt.Z,{...o,title:(0,Xe.Bo)(ne.default.getIntl(),t)})}var gt=o(9050),ht=o(66890),St=o(16187);function ft(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"CollectionSettingsNumberOptions"};const{propertySchema:n,numberFormat:i}=(0,a.VK)((()=>{const e=t.collectionStore(),n=t.normalizedSchemaStore.state[o];if(!n||!e)return{};if("number"===n.type)return{propertySchema:n,numberFormat:n.number_format??Xe.dk};if("formula"===n.type)return"number"===(0,$e.mm)(n)||n.formula2&&"number"===(0,Ye.aL)(n.formula2.result_type).type?{propertySchema:n,numberFormat:n.number_format??Xe.dk}:{};if("rollup"===n.type){var i;if(n.aggregation&&"show_unique"!==n.aggregation){var r;const i=null===(r=(0,He.gT)({property:o,schema:t.normalizedSchemaStore.state,getRecordModel:e.getRecordModel}))||void 0===r?void 0:r.targetPropertySchema;if(void 0===(null==i?void 0:i.type))return{};const s=(0,St.SD)(n.aggregation,(0,St.SD)(n.aggregation,"number_format"in i?i.number_format:void 0));return s?{propertySchema:n,numberFormat:s}:{}}const s=null===(i=(0,He.gT)({property:o,schema:t.normalizedSchemaStore.state,getRecordModel:e.getRecordModel}))||void 0===i?void 0:i.targetPropertySchema;if("number"===(null==s?void 0:s.type)||"formula"===(null==s?void 0:s.type)&&"number"===(0,$e.r9)(s))return{propertySchema:n,numberFormat:s.number_format??Xe.dk}}return{}}),[t,o]);if(!n)return null;const r="rollup"!==n.type;return(0,je.jsxs)(je.Fragment,{children:[r?(0,je.jsx)(yt,{numberFormat:i,property:o}):null,(0,je.jsx)(xt,{property:o,propertySchema:n,numberFormat:i})]})}function yt(e){let{numberFormat:t,property:o}=e;window.__c={n:"NumberFormatSection"};const n=(0,ht.Y$)(),i=(0,a.qz)(void 0,le.Z),r=(0,I.useIntl)(),s=(0,l.O7)();return(0,je.jsx)(Oe.ZP,{popupType:s.device.isMobile?De.kQ.SlideUp:De.kQ.Popup,alignmentToOrigin:Oe.vR.End,renderOrigin:e=>(0,je.jsx)(Le.Z,{title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Number format",id:"database.viewSettings.numberOptions.numberFormat"}),right:(0,je.jsx)("span",{style:{...M.Z.textOverflowStyle},children:(0,Xe.Bo)(r,Xe.dX.find((e=>e===t))??Xe.dk)}),showChevron:!0,rotateChevron:i.state.open,...e}),render:e=>{const t=n.collectionStore(),i=n.normalizedSchemaStore.state;if(t)return(0,je.jsx)(ut,{collectionStore:t,property:o,schema:i,onClose:e.close})},buttonPopupStore:i})}function xt(e){let{property:t,propertySchema:o,numberFormat:i}=e;window.__c={n:"NumberShowAsSection"};const{show_as:r}=o,s=(0,ht.Y$)(),a=(0,l.O7)(),d=(0,c.Fg)(),p=n.useRef({color:(null==r?void 0:r.color)??"green",maxValue:(null==r?void 0:r.maxValue)??100,showValue:(null==r?void 0:r.showValue)??!0}),u={type:(null==r?void 0:r.type)??"number",color:(null==r?void 0:r.color)??p.current.color,maxValue:(null==r?void 0:r.maxValue)??p.current.maxValue,showValue:(null==r?void 0:r.showValue)??p.current.showValue},g=(0,c.yK)((e=>({card:{boxSizing:"content-box",height:36,flex:1,margin:1,boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.mediumTextColor,borderRadius:4,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",paddingLeft:12,paddingRight:12,paddingTop:6,paddingBottom:6,cursor:"pointer"},selectedCard:{boxShadow:`0 0 0 2px ${e.blueColor}`,color:e.blueColor},cardVisual:{height:20,marginBottom:4,width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},cardText:{lineHeight:1,fontSize:12},progressBar:{width:"100%"},showAsTypeOption:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginLeft:16,marginRight:16,marginTop:6,gap:12},extraOptionStyle:{display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:16,paddingRight:16,gap:16,height:28,width:"100%"}})),[]),h=(0,n.useCallback)((e=>{const n=s.collectionStore();o&&n&&(V.createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:a,perform:i=>{N.xO({environment:a,collectionStore:n,update:{[t]:{...o,show_as:e}},transaction:i})}}),k.$q({environment:a,collectionContextStore:s,property:t,from:"view_settings",action:"number_change_show_as",number_show_as:(null==e?void 0:e.type)??"number"}))}),[s,a,t,o]),S=[{key:"number",visual:(0,je.jsx)("div",{style:{fontSize:16,fontWeight:M.Z.fontWeight.medium},children:"42"}),text:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Number",id:"database.viewSettings.numberOptions.showAsNumber"})},{key:"bar",visual:(0,je.jsx)(tt.k,{percentage:50,filledColor:"bar"===u.type?d.blueColor:d.regularDividerColor,unfilledColor:"bar"===u.type?d.accentColors.blue[50]:d.regularDividerColor,style:{width:"100%"}}),text:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Bar",id:"database.viewSettings.numberOptions.showAsBar"})},{key:"ring",visual:(0,je.jsx)(ot.e,{size:20,percentage:40,filledColor:"ring"===u.type?d.blueColor:d.regularDividerColor,unfilledColor:"ring"===u.type?d.accentColors.blue[50]:d.accentColors.gray[100],style:{width:"100%"}}),text:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Ring",id:"database.viewSettings.numberOptions.showAsRing"})}],f=(0,je.jsx)("div",{style:g.showAsTypeOption,children:S.map((e=>{const t=u.type===e.key;return(0,je.jsxs)(Je.Z,{onClick:()=>{const t="number"===e.key?void 0:{type:e.key,color:u.color,maxValue:"percent"===i?1:u.maxValue,showValue:u.showValue};void 0!==t&&(p.current=t),h(t)},style:{...g.card,...t?g.selectedCard:{}},children:[(0,je.jsx)("div",{style:g.cardVisual,children:e.visual}),(0,je.jsx)("div",{style:g.cardText,children:e.text})]},e.key)}))}),y=e=>{const t="number"!==u.type?{...u,type:u.type,...e}:void 0;void 0!==t&&(p.current=t),h(t)},x="number"!==u.type?(0,je.jsxs)("div",{style:g.extraOptionStyle,children:[(0,je.jsx)("div",{style:{flex:6,fontSize:14},children:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Color",id:"database.viewSettings.numberOptions.color"})}),(0,je.jsx)("div",{style:{display:"flex",flexWrap:"wrap",flex:6,gap:7},children:(0,je.jsx)(Oe.ZP,{popupType:a.device.isMobile?Oe.Z4.SlideUp:Oe.Z4.Popup,renderOrigin:e=>(0,je.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"end"},...e,children:(0,je.jsx)(gt.Z,{color:u.color,focused:!1,buttonStyle:{width:"auto",marginLeft:0,marginRight:0,borderRadius:4,color:d.lightTextColor},style:{minHeight:36},right:(0,Qe.i)({width:12,height:12})})}),render:e=>{const t=m.AP.map((t=>(0,je.jsx)(gt.Z,{color:t,checkState:t===u.color,focused:!1,style:{width:"100%"},onClick:()=>{y({color:t}),e.close()}},t)));return(0,je.jsx)("div",{style:{minWidth:150,paddingTop:8,paddingBottom:8},children:t})}})})]}):null,v="number"!==u.type?"percent"!==i&&(0,je.jsxs)("div",{style:g.extraOptionStyle,children:[(0,je.jsx)("div",{style:{flex:6,fontSize:14},children:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Divide by",id:"database.viewSettings.numberOptions.divideBy"})}),(0,je.jsx)("div",{style:{flex:6},children:(0,je.jsx)(et.Z,{value:u.maxValue.toString(),onChange:e=>{const t=e.target.value.replace(/[^0-9]/g,""),o=parseFloat(t);!isNaN(o)&&o>0&&y({maxValue:o})},inputStyle:{textAlign:"right"}})})]}):null,C="number"!==u.type?(0,je.jsxs)("div",{style:g.extraOptionStyle,children:[(0,je.jsx)("div",{style:{flex:6,fontSize:14},children:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Show number",id:"database.viewSettings.numberOptions.showValue"})}),(0,je.jsx)("div",{style:{flex:6,display:"flex",justifyContent:"flex-end"},children:(0,je.jsx)($.Z,{on:u.showValue,onClick:()=>{y({showValue:!u.showValue})},disabled:!1})})]}):null,b=Boolean(x||v||C),w=(0,je.jsxs)("div",{style:{backgroundColor:d.accentColors.gray[30],borderRadius:5,marginTop:b?12:0,marginLeft:b?14:0,marginRight:b?14:0,paddingTop:b?12:0,paddingBottom:b?12:0,maxHeight:b?1e3:0,transition:"max-height 0.5s ease-in-out",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[x,v,C]});return(0,je.jsxs)(z.Z,{title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Show as",id:"database.viewSettings.numberPercentOptions.showAs"}),topBorder:!0,disableMobileBorders:!0,children:[f,w,(0,je.jsx)("div",{style:{marginTop:12,marginLeft:18,marginRight:18,fontSize:12,color:d.lightTextColor},children:(0,je.jsx)(I.FormattedMessage,{id:"database.CollectionSettings.NumberOptions.applyAllViews",defaultMessage:"Changes apply to all views showing this property."})})]})}var vt=o(31869),Ct=o(29376),bt=o(57230),wt=o(34532);function jt(e){window.__c={n:"CollectionSettingsRelationOptions"};const{collectionContextStore:t,property:o}=e,i=(0,l.O7)(),r=(0,I.useIntl)(),[s,c]=(0,n.useState)(void 0),d=(0,a.VK)((()=>t.collectionStore()),[t]),m=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),g=(0,a.VK)((()=>Ct.KV(t,o)),[t,o]),h=g&&(0,p.NK)(g)?g.connectedRelation:void 0,S=(0,a.VK)((()=>_t(t.collectionViewBlockStore(),g)),[t,g]),f=Boolean(S&&(null==d?void 0:d.id)===S.id),y=(0,a.VK)((()=>Boolean(S&&(null==g?void 0:g.name)===Ct.m8(r,{targetCollectionStore:S,isSelfRelation:f,sourceSchema:m,createUnique:!1}))),[g,r,S,f,m]),x=(0,a.VK)((()=>t.contextType),[t]),v=(0,n.useCallback)((()=>{if(!s)return;const{hasInverseRelation:e,inverseName:n,autoRelate:l}=s;V.createAndCommit({userAction:"CollectionSettingsRelationOptions.handleEditRelation",environment:i,perform:s=>{vt.gy({environment:i,collectionContextStore:t,property:o,hasInverseRelation:e,inverseName:n,autoRelate:l,intl:r,transaction:s})}}),k.$q({environment:i,collectionContextStore:t,property:o,from:"collectionPage"===x?"page_properties":"view_settings",action:"relation_edit",is_self_relation:f,has_inverse:e,auto_relate:null==l?void 0:l.enabled}),c(void 0)}),[s,i,t,o,x,f,r]);if(!S)return null;const C=g&&!(0,u.gg)(g)&&!(0,u.ic)(g);return(0,je.jsxs)(je.Fragment,{children:[C&&(0,je.jsx)(wt.Z,{isSelfRelation:f,collectionStore:S,showAs:"link",disabled:!0}),C&&(0,je.jsx)(ze.C,{collectionContextStore:t,propertySchema:g,property:o}),!Boolean(h)&&(0,je.jsx)(bt.Z,{collectionContextStore:t,targetCollectionStore:S,property:o,buttonContents:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Update relation",id:"database.viewSettings.editRelation.updateButton.title"}),temporaryInverseState:s,setTemporaryInverseState:c,isInitialPropertyName:y,onSubmit:v})]})}function _t(e,t){if("relation"!==(null==t?void 0:t.type))return;const o=null==t?void 0:t.collection_pointer;return o&&e?de.NW.createChildStore(e,o):void 0}var Mt=o(47453),It=o(71644),Pt=o(47307),kt=o(97180),Tt=o(79131),Ft=o(73063),Rt=o(3386),Zt=o(92658),At=o(84619),Vt=o(73456),Bt=o(22084),Ot=o(4023);function Dt(e){var t;window.__c={n:"CollectionSettingsSelectOptionRow"};const o=(0,l.O7)(),i=(0,c.Fg)(),{isMobile:r}=(0,l.Fy)(),{property:s,option:d,statusGroup:p,propertySchema:u,isDefault:m,disabled:g}=e,h=(0,ht.Y$)(),S=(0,a.VK)((()=>{var e;return null===(e=h.collectionStore())||void 0===e?void 0:e.id}),[h]),f=(0,a.qz)(void 0,le.Z),y=(0,a.VK)((()=>f.state.open),[f]),x=(0,n.useCallback)((()=>{f.setState({open:!0})}),[f]),v=(0,n.useCallback)((()=>{f.setState({open:!1})}),[f]),C=(0,n.useCallback)((e=>{const t=h.collectionStore();t&&N.HW({environment:o,collectionStore:t,performTransaction:o=>{for(const n of e)V.applyOperation({store:(0,de.Kv)(t,n.pointer),operation:n,transaction:o})}})}),[h,o]),b=(0,c.yK)((()=>({defaultText:{fontSize:12,fontWeight:500,textTransform:"uppercase"}})),[]);return S?(0,je.jsx)(Vt.Z,{open:y,origin:(0,je.jsx)(H.ZP,{renderTooltip:e=>(0,je.jsxs)("div",{...e,style:ee.F6,children:[(0,je.jsx)("div",{children:d.value}),(0,je.jsx)("div",{style:{color:i.mediumInvertedTextColor},children:d.description})]}),placement:Ot.u.Left,disableTooltip:!(null!==(t=d.description)&&void 0!==t&&t.length),render:e=>{var t,o;return(0,je.jsx)(Le.Z,{...e,showDragHandle:!0,showChevron:!0,disabled:g,rotateChevron:y,title:"status"===u.type?(0,je.jsx)(Bt.F,{format:r?At.lo.Large:At.lo.Medium,value:d.value,color:d.color,hideTooltip:!(null===(t=d.description)||void 0===t||!t.length),tooltipPlacement:Ot.u.Left,showRemoveButton:!1,isSingle:!0,groupColor:null==p?void 0:p.color}):(0,je.jsx)(Bt.a,{format:r?At.lo.Large:At.lo.Medium,value:d.value,color:d.color,hideTooltip:!(null===(o=d.description)||void 0===o||!o.length),tooltipPlacement:Ot.u.Left,showRemoveButton:!1,isSingle:!0}),right:m?(0,je.jsx)("span",{style:b.defaultText,children:(0,je.jsx)(I.FormattedMessage,{id:"database.statusProperty.default",defaultMessage:"Default"})}):void 0,onClick:x})}}),option:d,property:s,propertySchema:u,statusGroup:p,collectionId:S,analyticsFrom:"view_settings",alignmentToOrigin:Ot.v.End,onChange:C,onClose:v}):null}class Nt extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:Zt.Z,inputGroupIndexState:d.default.createClass(void 0)},this.handleNewOptionClick=e=>{this.stores.inputStore.setState({focus:!0,inputValue:""}),void 0!==e&&this.stores.inputGroupIndexState.setState(e)},this.handleInputChange=e=>{const t=e.target.value.replace(/,/g,"");this.stores.inputStore.setState({focus:!0,inputValue:t})},this.handleInputBlur=()=>{const e=this.environment.device.isPhone?this.stores.inputStore.state.inputValue:"";this.stores.inputStore.setState({focus:!1,inputValue:e})},this.handleInputSubmit=()=>{const{collectionContextStore:e,property:t}=this.props,o=e.collectionStore(),n=qt(this.props.collectionContextStore,this.props.property);if(!n||!o)return;const i=n.options||[],r=this.stores.inputStore.state.inputValue;if(r){let e=(0,p.TL)(i);if("status"===n.type){var s;const t=null===(s=this.stores.inputGroupIndexState)||void 0===s?void 0:s.state;if(void 0!==t){var l;const o=null===(l=n.groups)||void 0===l||null===(l=l[t])||void 0===l?void 0:l.color;o&&(e=o)}}if(i.find((e=>e.value===r)))return Pt.showErrorMessage((0,je.jsx)(Et,{})),void this.handleInputBlur();const c={id:(0,It.ZP)(),value:r,color:e};let d,u;if(d=!(0,p.cu)(n)||"alphabetical"!==n.auto_sort_options&&"reverse_alphabetical"!==n.auto_sort_options?{pointer:o.pointer,command:"keyedObjectListBefore",path:["schema",t,"options"],args:{value:c}}:(0,p.Ch)({collectionId:o.id,property:t,propertySchema:n,newOption:c,isAscending:"alphabetical"===n.auto_sort_options}),"status"===n.type){var a;const e=null===(a=this.stores.inputGroupIndexState)||void 0===a?void 0:a.state;void 0!==e&&(u={pointer:o.pointer,command:"listBefore",path:["schema",t,"groups",e,"optionIds"],args:{id:c.id}})}N.HW({environment:this.environment,collectionStore:o,performTransaction:e=>{V.applyOperation({store:(0,de.Kv)(o,d.pointer),operation:d,transaction:e}),u&&V.applyOperation({store:(0,de.Kv)(o,u.pointer),operation:u,transaction:e})}})}this.stores.inputStore.setState({focus:!0,inputValue:""}),k.$q({environment:this.environment,collectionContextStore:e,property:t,from:"view_settings",action:"select_add_option"})}}renderComponent(){var e,t;const{collectionContextStore:o,property:n,disabled:i,aIAutofillOption:r}=this.props,s=null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema(),l=null===(t=o.collectionStore())||void 0===t?void 0:t.getFormat().app_config_uri,a=qt(this.props.collectionContextStore,this.props.property);if(!s||!a)return;const{inputStore:c,inputGroupIndexState:d}=this.stores,u=c.state,m=d.state;if("status"===a.type){const e=a.groups??[];if(0===e.length)return;const t=a.options??[],o=e.map((e=>{const o=t.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return{group:e,groupOptions:o}})),r=a.defaultOption,c=[...o[0].groupOptions.map((e=>e.value))];for(const{group:n,groupOptions:i}of o.slice(1))c.push({key:`group-header-${n.name}`,draggable:!1}),c.push(...i.map((e=>e.value)));const d=(0,O.Hw)(l,s,n)?{tooltipCaption:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"These options are core to the property and cannot be changed.",id:"database.viewSettings.selectOptions.disabledGroupMessage"})}:void 0,p=(s,l)=>{if(s.startsWith("group-header-")){const e=s.substring("group-header-".length),t=o.findIndex((t=>{let{group:o}=t;return o.name===e})),{group:n,groupOptions:r}=o[t];return(0,je.jsxs)(Lt,{title:(0,je.jsx)(kt.r_,{disableGroup:d,group:n,showIcon:!1}),right:!u.focus&&(0,je.jsx)(Wt,{collectionContextStore:this.props.collectionContextStore,property:this.props.property,intl:this.props.intl,onClick:()=>this.handleNewOptionClick(t)}),disabled:i,children:[m===t&&this.renderNewOptionInput(),!u.focus&&0===r.length&&this.renderNewOptionItem(t)]})}{const o=t.find((e=>e.value===s));if(!o)return;const l=e.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(o.id)}));return(0,je.jsx)(Dt,{option:o,statusGroup:l,propertySchema:a,property:n,isDefault:o.value===r,disabled:i},o.value)}};return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsxs)(Lt,{title:(0,je.jsx)(kt.r_,{disableGroup:d,group:o[0].group}),right:!u.focus&&(0,je.jsx)(Wt,{collectionContextStore:this.props.collectionContextStore,property:this.props.property,intl:this.props.intl,onClick:()=>this.handleNewOptionClick(0)}),disabled:i,children:[0===m&&this.renderNewOptionInput(),!u.focus&&0===o[0].groupOptions.length&&this.renderNewOptionItem(0)]}),(0,je.jsx)(Tt.ZP,{direction:"vertical",keys:c,renderKey:p,onDrop:e=>Gt(e,this.environment,this.props.property,this.props.collectionContextStore),disabled:i})]})}{const e=a.options??[],t=e.map((e=>e.value)),o=a.auto_sort_options||"manual";return[(0,je.jsx)(Te.Z,{title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.selectOptions.autoSort"}),selectedKey:o,options:[{key:"manual",title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Manual",id:"database.viewSettings.selectOptions.autoSort.none"})},{key:"alphabetical",title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.viewSettings.selectOptions.autoSort.alphabetical"})},{key:"reverse_alphabetical",title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Reverse alphabetical",id:"database.viewSettings.selectOptions.autoSort.reverseAlphabetical"})}],onChange:e=>function(e,t,o,n){const i=o.collectionStore(),r=o.normalizedSchemaStore.state,s=qt(o,n);if(!i||!s)return;if(!(0,p.cu)(s))return;const l=[{pointer:i.pointer,command:"update",path:["schema",n],args:{auto_sort_options:e}}];"alphabetical"!==e&&"reverse_alphabetical"!==e||l.push(...(0,K.L5)({collectionId:i.id,property:n,propertySchema:s,schema:r,isAscending:"alphabetical"===e})||[]);N.HW({environment:t,collectionStore:i,performTransaction:e=>{for(const t of l)V.applyOperation({store:(0,de.Kv)(i,t.pointer),operation:t,transaction:e})}}),k.$q({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"select_change_auto_sort_options"})}(e,this.environment,this.props.collectionContextStore,this.props.property),popupStyle:{minWidth:190}},"autoSortMenuItem"),r,(0,je.jsx)(Lt,{title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Options",id:"database.viewSettings.selectOptions.title"}),right:!u.focus&&t.length>0&&(0,je.jsx)(Wt,{collectionContextStore:this.props.collectionContextStore,property:this.props.property,intl:this.props.intl,onClick:()=>this.handleNewOptionClick()}),disabled:i,children:this.renderNewOptionInput()},"sectionHeader"),t.length>0&&(0,je.jsx)(Tt.ZP,{direction:"vertical",keys:t,renderKey:t=>{const o=e.find((e=>e.value===t));if(o)return(0,je.jsx)(Dt,{option:o,property:n,propertySchema:a,isDefault:!1,statusGroup:void 0,disabled:i},o.value)},onDrop:e=>Gt(e,this.environment,this.props.property,this.props.collectionContextStore)}),!u.focus&&0===t.length&&this.renderNewOptionItem()]}}renderNewOptionInput(){const{inputStore:e}=this.stores,t=e.state;if(t.focus)return(0,je.jsx)(Rt.Z,{capture:!0,onEsc:this.handleInputBlur,children:(0,je.jsx)(ve.ZP,{value:t.inputValue,focus:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Type a new option…",id:"database.viewSettings.selectOptions.newSelectOption.inputPlaceholder"}),style:{marginTop:2,marginBottom:8},onChange:this.handleInputChange,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,mobileKeyboardOnDismiss:this.handleInputSubmit})})}renderNewOptionItem(e){return(0,je.jsx)(lt.Z,{icon:(0,Mt.R)({width:14}),focused:!1,title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.noOptions"}),style:{width:"100%"},onClick:()=>this.handleNewOptionClick(e)})}}Nt.displayName="CollectionSettingsSelectOptions";const Kt=(0,I.injectIntl)(Nt);function Lt(e){let{title:t,right:o,children:n,disabled:i,overrideStyle:r}=e;return(0,je.jsx)(z.Z,{topBorder:!0,title:t,desktopTitleStyle:{height:20},right:!i&&o,style:{width:"100%",paddingBottom:0,...r},children:!i&&n})}function Et(){return(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Option already exists.",id:"database.optionExistsAlreadyError.message"})}function qt(e,t){const o=e.normalizedSchemaStore.state[t];if(o&&((0,p.cu)(o)||"status"===o.type))return o}function Wt(e){let{onClick:t,collectionContextStore:o,property:n,intl:i}=e;window.__c={n:"NewOptionButton"};return(0,a.VK)((()=>qt(o,n)),[o,n])?(0,je.jsx)(Ft.Z,{icon:Mt.R,onClick:t,style:{width:20,height:20},ariaLabel:i.formatMessage({defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.addOption"})}):null}function Gt(e,t,o,n){const i=n.normalizedSchemaStore.state,r=n.collectionStore();if(!r)return;const s=i[o];let l;if("status"===(null==s?void 0:s.type)){l=[[]];for(const t of e)t.startsWith("group-header-")?l.push([]):l[l.length-1].push(t)}else l=e;const a=(0,K.YL)({newOptions:l,collectionId:r.id,property:o,schema:i});if(a){if(s&&(0,p.cu)(s)){"manual"!==(s.auto_sort_options||"manual")&&a.push({pointer:r.pointer,command:"update",path:["schema",o],args:{auto_sort_options:"manual"}})}N.HW({environment:t,collectionStore:r,performTransaction:e=>{for(const t of a)V.applyOperation({store:(0,de.Kv)(r,t.pointer),operation:t,transaction:e})}})}k.$q({environment:t,collectionContextStore:n,property:o,from:"view_settings",action:"select_options_reorder"})}var zt=o(42283),Ut=o(53866);const $t=(0,I.defineMessages)({statusShowAsLabel:{id:"database.viewSettings.statusOptions.showAs",defaultMessage:"Show as"},statusCheckboxLabel:{id:"database.viewSettings.statusOptions.showAs.checkbox",defaultMessage:"Checkbox"},statusSelectLabel:{id:"database.viewSettings.statusOptions.showAs.select",defaultMessage:"Select"}});function Ht(e){let{collectionContextStore:t,property:o,disabled:n}=e;window.__c={n:"CollectionSettingsStatusOptions"};const i=(0,l.O7)(),r=(0,c.yK)((e=>({icon:{width:16,height:16,fill:e.mediumIconColor}})),[]),[s,d]=(0,a.VK)((()=>{var e;return[Yt(t,o),(null===(e=t.getPropertyFormat(o))||void 0===e?void 0:e.statusShowAs)??"select"]}),[t,o]);if(!s)return null;const p=[{key:"checkbox",title:ne.default.formatMessage($t.statusCheckboxLabel),icon:(0,zt.r)(r.icon)},{key:"select",title:ne.default.formatMessage($t.statusSelectLabel),icon:(0,Ut.w)(r.icon)}];return(0,je.jsx)(Te.Z,{title:ne.default.formatMessage($t.statusShowAsLabel),selectedKey:d,popupStyle:{minWidth:190},options:p,onChange:e=>function(e,t,o,n){const i=o.formatStore();if(!i)return;const r=o.getPropertyFormatKey();if(!r)return;V.createAndCommit({userAction:"CollectionSettingsStatusOptions.handleShowAsChange",environment:t,perform:t=>{T.er({formatStore:i,formatKey:r,property:n,update:{statusShowAs:e,visible:!0},transaction:t})}}),k.$q({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"status_change_format"})}(e,i,t,o),disabled:n})}function Yt(e,t){const o=e.normalizedSchemaStore.state[t];if(o&&"status"===o.type)return o}function Qt(e){let{collectionContextStore:t,property:o,propertySchema:n}=e;window.__c={n:"CollectionSettingsUrlOptions"};const i=(0,l.O7)();return(0,je.jsx)(Le.Z,{title:(0,je.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Show full URL",id:"database.viewSettings.propertyTab.toggleShowFullUrl"})}),showChevron:!1,right:(0,je.jsx)($.Z,{on:Boolean(n.show_full_url),onClick:()=>Xt(i,t,o,n),disabled:!1,noColor:!1}),onClick:()=>Xt(i,t,o,n)})}function Xt(e,t,o,n){const i=t.collectionStore();if(!n||!i||"url"!==n.type)return;const r=!Boolean(n.show_full_url);V.createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:e,perform:t=>{N.xO({environment:e,collectionStore:i,update:{[o]:{...n,show_full_url:r}},transaction:t})}}),k.$q({environment:e,collectionContextStore:t,property:o,from:"view_settings",action:r?"url_toggle_show_full_on":"url_toggle_show_full_off"})}Ht.displayName="CollectionSettingsStatusOptions";const Jt=(0,I.defineMessages)({inputPlaceholder:{defaultMessage:"Property name",id:"database.viewSettings.propertyTab.propertyName"},autofillOffLabel:{defaultMessage:"Off",id:"database.viewSettings.propertyTab.autofillOffLabel"},autofillOnLabel:{defaultMessage:"On",id:"database.viewSettings.propertyTab.autofillOnLabel"},keptUpToDateWithNotionAITooltip:{defaultMessage:"Auto-updated by AI",id:"database.tableHeaderCell.tooltipAiAutofillDescription"}});class eo extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:d.default.createClass(""),propertyTypeButtonPopupStore:le.Z,showPropertyDescriptionStore:d.default.createClass(!1)},this.handlePropertyTypeClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props,o=go(this.props.collectionContextStore,this.props.property),n=t.collectionStore();n&&F.H4({collectionSettingsStore:e,item:{type:"propertyType",propertySchema:o,propertyTypes:(0,J.TP)({isSyncedCollection:n.isSyncedCollection(),collectionContextStore:t,environment:this.environment}),onAccept:this.handlePropertyTypeAccept,noSuggestion:!0}})},this.handlePropertyNameSubmit=e=>{if(this.shouldShowDuplicateError())return;const{property:t,collectionContextStore:o}=this.props,n=no(this.props.collectionContextStore);if(!n)return;const i=n.getSchema()[t];i&&i.name!==e&&(V.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyNameSubmit",environment:this.environment,perform:o=>{T.Bv({collectionStore:n,property:t,name:e,transaction:o})}}),k.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"rename"}))},this.handlePropertyDescriptionSubmit=e=>{var t;const{collectionContextStore:o,property:n}=this.props,i=o.collectionStore(),r=this.environment,s=null==i||null===(t=i.getSchema())||void 0===t?void 0:t[this.props.property];i&&void 0!==s&&e!==s.description&&(V.createAndCommit({userAction:"CollectionSettingsProperty.handleDescriptionChange",environment:r,perform:t=>{N.xO({environment:r,collectionStore:i,update:{[n]:{...s,description:e}},transaction:t})}}),k.$q({environment:r,collectionContextStore:o,property:n,from:"view_properties",action:"set_description"}))},this.handleTogglePropertyWrapClick=()=>{const{collectionContextStore:e,formatKey:t}=this.props,o=lo(this.props.property,this.props.formatKey,this.props.collectionContextStore),n=e.collectionViewStore(),i=e.normalizedFormatStore.state,r=go(this.props.collectionContextStore,this.props.property);r&&o&&n&&t&&r&&(A.K4({currentValue:this.wrapProperty.state,environment:this.environment,property:this.props.property,collectionViewStore:n,format:i,formatKey:t}),k.wd({environment:this.environment,collectionContextStore:e,action:"toggle_property_wrap",original_view_type:n.getType(),property_type:r.type}))},this.handlePropertyTypeAccept=e=>{const{property:t,collectionContextStore:o,collectionSettingsStore:n,formatKey:i}=this.props,r=no(this.props.collectionContextStore);r&&(k.$q({environment:this.environment,collectionContextStore:o,property:t,new_property_type:(0,p.TN)(e),from:"view_settings",action:"change_type"}),"relation"===e?F.H4({collectionSettingsStore:n,item:{type:"selectRelationSource",property:t,formatKey:i}}):(V.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyTypeAccept",environment:this.environment,perform:o=>{T.LC({environment:this.environment,collectionStore:r,property:t,type:e,transaction:o})}}),F.z$({collectionSettingsStore:n}),(0,p.XU)(e)&&R.K7({propertyType:e,propertyId:t,collectionContextStore:o})),this.stores.propertyTypeButtonPopupStore.reset())},this.wrapProperty=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return!!o&&(Boolean((null===(e=lo(this.props.property,this.props.formatKey,this.props.collectionContextStore))||void 0===e?void 0:e.wrap)||o.getFormat().table_wrap)&&"timeline"!==o.getType())})),this.isMyTasks=this.createComputedStore((()=>{var e;const t=null===(e=this.props.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!t&&(0,X.qG)(t)}))}didMount(){s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{!function(e,t,o){const n=t.collectionViewStore();if(!n||"table"!==n.getType())return;const r=se.Z.findTableHeaderCell(t,e);if(!r)return;const s=r.getNode(),l=i.findDOMNode(o);if(!s||!l)return;const a=(0,re.xH)(s);if(!a)return;const c=l.getBoundingClientRect(),d=s.getBoundingClientRect().right+20-c.left;a.scrollLeft=a.scrollLeft+d}(this.props.property,this.props.collectionContextStore,this)}))}))}renderComponent(){const{theme:e}=this,{property:t,collectionContextStore:o,selectNameInitial:n,formatKey:i}=this.props,r=go(o,t),s=lo(t,i,o);if(!r)return;const l=o.collectionStore(),a="collectionTypedView"===o.contextType,c=l&&l.getDatabaseType(),d=Boolean(c&&l&&l.isTypedProperty(t)),m=this.createComputedStore((()=>Boolean(l&&c&&O.cR((0,B.appConfigs)(),c,t,l)))),S=!(0,u.Kp)(r),f=a,y=a||(0,u.sh)({propertySchema:r,isTypedProperty:d}),x="collectionViewBlock"===o.contextType,v=this.stores.showPropertyDescriptionStore.state,C=r.description;return(0,je.jsxs)(we.ZP,{...this.props,title:l?(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Edit property",id:"database.viewSettings.propertyTab.title"}):(0,je.jsx)(I.FormattedMessage,{defaultMessage:"View property",id:"database.viewSettings.propertyTab.title.viewProperty"}),footer:this.renderFooterActions(r,s,m.state,c),unconstrainedWidth:x,children:[(0,je.jsxs)(z.Z,{children:[(0,je.jsx)(Ue.I,{disabled:f,initialValue:r.name||"",placeholder:ne.default.formatMessage(Jt.inputPlaceholder),onBlur:this.handlePropertyNameSubmit,onSubmit:this.handlePropertyNameSubmit,focusInitial:n,selectAll:n,inputStore:this.stores.inputStore,inputOuterStyle:x?{background:e.contentBackground}:void 0,iconButton:{icon:t=>(0,je.jsx)(g.ZP,{type:r.type,icon:r.icon,size:16,theme:e,style:t}),iconStyle:{fill:h.Lr[e.mode].gray},enforceIconColor:"gray",onSubmit:e=>function(e,t,o,n){const i=no(o);if(!i)return;V.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyIconSubmit",environment:e,perform:e=>{T.OK({collectionStore:i,property:t,icon:n,transaction:e})}}),k.$q({environment:e,collectionContextStore:o,property:t,icon:n,from:"view_settings",action:"change_icon"})}(this.environment,this.props.property,this.props.collectionContextStore,e)},inputRightButton:this.isMyTasks.state?null:(0,je.jsx)(ue.l,{description:C,showTooltip:!v,onClick:()=>{this.stores.showPropertyDescriptionStore.setState(!v)},addDescriptionText:this.props.intl.formatMessage(ee.aB.addPropertyDescriptionTooltip),editDescriptionText:this.props.intl.formatMessage(ee.aB.editPropertyDescriptionTooltip)})}),this.shouldShowDuplicateError()&&(0,je.jsx)(to,{propertyName:this.stores.inputStore.state})]}),v&&(0,je.jsx)(me.i,{initialDescription:C,handleSaveDescription:this.handlePropertyDescriptionSubmit}),(0,je.jsxs)(z.Z,{children:[S&&this.renderPropertyTypeMenuItem(y,d,c),a?(0,je.jsx)(je.Fragment,{children:"status"===r.type&&(0,je.jsx)(co,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore,property:this.props.property})}):(0,je.jsxs)(je.Fragment,{children:[(0,oe.Zt)(this.environment)&&"text"===r.type&&(0,je.jsx)(Po,{collectionContextStore:this.props.collectionContextStore,property:this.props.property,collectionSettingsStore:this.props.collectionSettingsStore}),(0,p.cu)(r)&&(0,je.jsx)(jo,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore,property:this.props.property,propertySchema:r}),"status"===r.type&&(0,je.jsx)(co,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore,property:this.props.property}),"formula"===r.type&&(0,je.jsx)(po,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore,property:this.props.property}),"rollup"===r.type&&(0,je.jsx)(ko,{property:this.props.property,collectionContextStore:this.props.collectionContextStore}),("date"===r.type||"created_time"===r.type||"last_edited_time"===r.type)&&(0,je.jsx)(uo,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),"relation"===r.type&&(0,je.jsx)(mo,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),"person"===r.type&&(0,je.jsx)(Co,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),(0,je.jsx)(ho,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),(0,je.jsx)(So,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),"auto_increment_id"===r.type&&(0,je.jsx)(vo,{collectionContextStore:this.props.collectionContextStore,property:this.props.property})]})]}),"button"===r.type&&(0,je.jsx)(yo,{collectionContextStore:this.props.collectionContextStore,property:this.props.property})]})}renderFooterActions(e,t,o,n){const{property:i,formatKey:r,collectionContextStore:s}=this.props,l=s.collectionStore(),a=r&&("title"!==i||(0,K.XO)({viewType:ro(this.props.collectionContextStore),format:s.normalizedFormatStore.state})),c=r&&"title"!==i&&(0,K.w0)({viewType:ro(this.props.collectionContextStore)}),d=J.Tr.includes(e.type)&&!(0,p.dx)(e)&&l,u=J.Tr.includes(e.type)&&l,m=a||d||u;return(0,je.jsxs)(je.Fragment,{children:[m&&(0,je.jsxs)(z.Z,{topBorder:!0,children:[l&&(0,je.jsx)(wo,{environment:this.environment,collectionStore:l,collectionContextStore:s,property:i,propertySchema:e}),a&&t&&(null!=t&&t.visible?(0,je.jsx)(Le.Z,{icon:y.L,isPadded:!0,title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Hide in view",id:"database.viewSettings.propertyTab.hideInViewButton.title"}),onClick:()=>Mo(this.environment,this.props.collectionContextStore,this.props.formatKey,this.props.property)}):(0,je.jsx)(Le.Z,{icon:x.N,isPadded:!0,title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Show in view",id:"database.viewSettings.propertyTab.showInViewButton.title"}),onClick:()=>Mo(this.environment,this.props.collectionContextStore,this.props.formatKey,this.props.property)})),c&&t&&(this.wrapProperty.state?(0,je.jsx)(Le.Z,{icon:b.A,iconStyle:{transform:"scale(.8)"},isPadded:!0,title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Don't wrap in view",id:"database.viewSettings.propertyTab.dontWrapInViewButton.title"}),onClick:this.handleTogglePropertyWrapClick}):(0,je.jsx)(Le.Z,{icon:w.p,iconStyle:{transform:"scale(.7)"},isPadded:!0,title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Wrap in view",id:"database.viewSettings.propertyTab.wrapInViewButton.title"}),onClick:this.handleTogglePropertyWrapClick})),d&&(0,je.jsx)(Le.Z,{icon:f.a,title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.viewSettings.propertyTab.duplicateButton.title"}),onClick:()=>async function(e,t,o,n,i){const r=io(i,o),s=so(o),l=no(o),a=o.collectionViewStore(),c=null==l?void 0:l.getSpaceId();if(!l||!a||!c)return;const d=go(o,t);if(!d)return;const p=await(0,K.xy)({environment:e,schema:s,property:t,properties:r,parentStore:l,spaceId:c});if(!p)return;V.createAndCommit({userAction:"CollectionSettingsProperty.handleDuplicateClick",environment:e,perform:n=>{N.xO({environment:e,collectionStore:l,update:{[p.newProperty]:p.newPropertySchema},transaction:n});const r=ao(t,i,o);A.oz({environment:e,collectionContextStore:o,currentIndex:r,entrypoint:"CollectionSettingsProperty",transaction:n,propertyAction:"duplicate"}),p.automationUpdate&&N.Ki({environment:e,collectionStore:l,update:p.automationUpdate,transaction:n}),i&&Z.FH({stores:[a],update:{[i]:p.newProperties},transaction:n})}}),F.FK({collectionSettingsStore:n,item:{type:"property",property:p.newProperty,formatKey:i}}),k.wd({environment:e,collectionContextStore:o,action:"duplicate_property",original_view_type:null==a?void 0:a.getType(),property_type:d.type})}(this.environment,this.props.property,this.props.collectionContextStore,this.props.collectionSettingsStore,this.props.formatKey)}),u&&(0,je.jsx)(To,{collectionContextStore:this.props.collectionContextStore,property:this.props.property,collectionSettingsStore:this.props.collectionSettingsStore,formatKey:this.props.formatKey,isRequiredTypedProperty:o,databaseType:n})]}),"formula"===e.type&&(0,je.jsx)(z.Z,{topBorder:!0,children:(0,je.jsx)(Ge.Z,{href:(0,ie.UY)("guides.formulas"),title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Learn about formulas",id:"database.viewSettings.propertyTab.formulas.learnMoreButton.title"}),analyticsFrom:"view_settings_property_formula"})}),"relation"===e.type&&(0,je.jsx)(_o,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),"rollup"===e.type&&(0,je.jsx)(z.Z,{topBorder:!0,children:(0,je.jsx)(Ge.Z,{href:(0,ie.UY)("guides.relations"),title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Learn about rollups",id:"database.viewSettings.propertyTab.rollups.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})})]})}renderPropertyTypeMenuItem(e,t,o){const{propertyTypeButtonPopupStore:n}=this.stores,i=this.props.collectionContextStore.collectionViewBlockStore(),r=go(this.props.collectionContextStore,this.props.property),s=_t(i,r);if(!r)return;const l=null==s?void 0:s.getIcon(),{theme:a}=this,c=(0,u.gg)(r)||(0,u.ic)(r);return(0,je.jsx)(H.ZP,{placement:H.ug.Left,disableTooltip:!e,renderTooltip:e=>t?(0,je.jsx)(I.FormattedMessage,{...e,defaultMessage:"{type} type is required for this property in {databaseType}.",id:"database.viewSettings.propertyTab.restrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property.",values:{type:J.SO[r.type],databaseType:(0,D.Mn)(o)}}):(0,je.jsx)(I.FormattedMessage,{...e,defaultMessage:"{type}'s type cannot be changed.",id:"database.viewSettings.propertyTab.untypedRestrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property.",values:{type:J.SO[r.type]}}),render:t=>(0,je.jsx)(Le.Z,{...t,disabled:e,rotateChevron:n.state.open,title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"}),showChevron:!0,right:(0,je.jsxs)(je.Fragment,{children:[e?(0,je.jsx)("div",{...t,children:(0,v.Q)({width:14,fill:a.regularIconColor})}):(0,je.jsx)(g.ZP,{type:r.type,icon:void 0,size:16,theme:a}),(0,je.jsx)(U.Z,{size:4}),c?(0,je.jsxs)("div",{style:{color:e?a.darkTextColor:void 0,display:"flex",alignItems:"center"},children:[(0,je.jsx)(W.Z,{icon:l,isEmptyPage:!1,size:20,disabled:!0}),(0,je.jsx)(G.Z,{store:s,style:{display:"inline",wordBreak:"break-word",...M.Z.textOverflowStyle}})]}):(0,je.jsx)("span",{style:{color:e?a.darkTextColor:void 0},children:J.SO[r.type]})]}),onClick:this.handlePropertyTypeClick})})}shouldShowDuplicateError(){const{property:e}=this.props,{inputStore:t}=this.stores,o=so(this.props.collectionContextStore),n=t.state,i=Object.keys(o).find((t=>{var i;return t!==e&&(null===(i=o[t])||void 0===i?void 0:i.name)===n}));return Boolean(i)}}function to(e){return(0,je.jsx)(Y.Z,{isMultiline:!0,style:{paddingTop:8,marginLeft:16,marginRight:16,color:m.ZP.red,...e.styles},children:(0,je.jsx)(I.FormattedMessage,{id:"database.viewSettings.propertyTab.duplicatePropertyNameError",defaultMessage:"A property named {propertyName} already exists in this database.",values:{propertyName:e.propertyName}})})}eo.displayName="CollectionSettingsProperty";const oo=(0,I.injectIntl)(eo);function no(e){if(e.collectionViewBlockStore())return e.collectionStore()}function io(e,t){if(!e)return[];return t.normalizedFormatStore.state[e]||[]}function ro(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function so(e){const t=no(e);return t?t.getSchema():e.normalizedSchemaStore.state||{}}function lo(e,t,o){const n=io(t,o);return null==n?void 0:n.find((t=>t.property===e))}function ao(e,t,o){const n=io(t,o);if(0===n.length)return-1;return n.filter((e=>e.visible)).findIndex((t=>t.property===e))}function co(e){let{collectionSettingsStore:t,collectionContextStore:o,property:n}=e;window.__c={n:"StatusOptions"};const i=(0,a.VK)((()=>{var e;return O.Hw(null===(e=o.collectionStore())||void 0===e?void 0:e.getDatabaseType(),o.normalizedSchemaStore.state,n)}),[o,n]);return(0,je.jsxs)(je.Fragment,{children:[i?null:(0,je.jsx)(Ht,{collectionContextStore:o,property:n,disabled:i}),(0,je.jsx)(Kt,{collectionSettingsStore:t,collectionContextStore:o,property:n,disabled:i,aIAutofillOption:null})]})}function po(e){let{collectionContextStore:t,collectionSettingsStore:o,property:n}=e;return(0,je.jsx)(qe,{collectionContextStore:t,collectionSettingsStore:o,property:n})}function uo(e){let{collectionContextStore:t,property:o}=e;return(0,je.jsx)(Fe,{collectionContextStore:t,property:o})}function mo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"RelationOptions"};return(0,a.VK)((()=>{const e=t.normalizedSchemaStore.state[o];return(0,u.Kp)(e)}),[t,o])?(0,je.jsx)(We.Z,{collectionContextStore:t,property:o}):(0,je.jsx)(jt,{collectionContextStore:t,property:o})}function go(e,t){return so(e)[t]}function ho(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"NumberOptions"};const n=(0,a.VK)((()=>go(t,o)),[t,o]);return n&&("number"===n.type||"formula"===n.type||"rollup"===n.type)?(0,je.jsx)(ft,{collectionContextStore:t,property:o}):null}function So(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"URLOptions"};const n=(0,a.VK)((()=>ae.default.checkGate("collections_shorten_url")),[]),i=(0,a.VK)((()=>go(t,o)),[t,o]),r=(0,a.VK)((()=>no(t)),[t]);return n&&i&&"url"===i.type&&r?(0,je.jsx)(Qt,{collectionContextStore:t,property:o,propertySchema:i}):null}function fo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"DefaultPersonPicker"};const n=(0,a.VK)((()=>go(t,o)),[t,o]);return n&&"person"===n.type?(0,je.jsx)(Ve,{collectionContextStore:t,propertySchema:n,property:o}):null}function yo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"ButtonOptions"};const n=(0,a.VK)((()=>go(t,o)),[t,o]);return n&&"button"===n.type?(0,je.jsx)(_e,{collectionContextStore:t,propertySchema:n,propertyId:o}):null}function xo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"LimitOptions"};const n=(0,a.VK)((()=>go(t,o)),[t,o]);return n?(0,je.jsx)(ze.C,{collectionContextStore:t,propertySchema:n,property:o}):null}function vo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"AutoIncrementId"};const n=(0,a.VK)((()=>go(t,o)),[t,o]),i=(0,a.VK)((()=>{var e;const o=null===(e=t.collectionStore())||void 0===e?void 0:e.getRecordKeyStore();return null==o?void 0:o.getRecordKey()}),[t]);return n&&"auto_increment_id"===n.type?(0,je.jsx)(ge.Z,{uniqueIdProperty:{propertyId:o,propertySchema:n},prefixValue:i,collectionContextStore:t}):null}function Co(e){let{collectionContextStore:t,property:o}=e;return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(xo,{collectionContextStore:t,property:o}),(0,je.jsx)(fo,{collectionContextStore:t,property:o})]})}function bo(e){window.__c={n:"AutofillOptionSection"};const{environment:t,property:o,propertySchema:i,collectionSettingsStore:r,collectionStore:s}=e,l=(0,a.VK)((()=>(0,p.q3)(i)),[i]),c=(0,a.VK)((()=>(0,oe.mX)(t,ce.Z.getMode(t,s),s)),[t,s]),d=(0,n.useCallback)((()=>{if(!s||!i||!(0,p.cu)(i))return;const e=(0,p.xo)(i);if(!e)return;const n=[];if(l)P._e(t,{type:"remove_ai_inference",ai_inference_type:l.type,collection_id:s.id}),n.push({pointer:s.pointer,command:"set",path:["schema",o,e],args:void 0});else{const r={type:i.type,auto_update_on_edit:!1,add_options:!1};P._e(t,{type:"set_ai_inference",ai_inference_type:r.type,collection_id:s.id}),n.push({pointer:s.pointer,command:"set",path:["schema",o,e],args:r})}N.HW({environment:t,collectionStore:s,performTransaction:e=>{for(const t of n)V.applyOperation({store:(0,de.Kv)(s,t.pointer),operation:t,transaction:e})}})}),[l,s,t,o,i]),u=(0,n.useCallback)((e=>{if(!i||!s||!(0,p.qQ)(i))return;const n=(0,p.xo)(i);if(!n)return;const r={pointer:s.pointer,command:"set",path:["schema",o,n],args:e};N.HW({environment:t,collectionStore:s,performTransaction:e=>{V.applyOperation({store:(0,de.Kv)(s,r.pointer),operation:r,transaction:e})}})}),[s,t,o,i]);return(0,a.VK)((()=>(0,oe.KZ)()),[])?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Lt,{disabled:!0,overrideStyle:{marginTop:6,paddingTop:6}},"aiSectionHeader"),(0,je.jsx)(Le.Z,{title:(0,je.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,je.jsx)(I.FormattedMessage,{defaultMessage:"AI Autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"}),(0,je.jsx)(q.Z,{style:{display:"inline-block"}})]}),showChevron:!1,right:(0,je.jsx)($.Z,{on:Boolean(l),onClick:d,disabled:!1,noColor:!1}),onClick:d,disabled:!c}),l&&("select"===l.type||"multi_select"===l.type)&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(E.Z,{setAiInference:u,aiInference:l,disabled:!c}),(0,je.jsx)(Le.Z,{title:(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",lineHeight:1.2,color:m.ZP.uiGray},children:[(0,je.jsx)(I.FormattedMessage,{id:"database.collectionsettings.aiAutofillOptions.more",defaultMessage:"More"}),(0,S.o)({fill:m.ZP.uiGray,width:12,height:12,marginLeft:4})]}),disabled:!1,onClick:()=>{F.H4({collectionSettingsStore:r,item:{type:"propertyAiAutofill",propertySchema:i,property:o}})}})]})]}):null}function wo(e){window.__c={n:"AutofillAllPagesButton"};const{environment:t,property:o,propertySchema:n,collectionContextStore:i,collectionStore:r}=e,s=(0,a.VK)((()=>{var e;const t=(null===(e=pe.subscriptionDataStoreInstance.state)||void 0===e?void 0:e.addOns)??[];return(0,j.de)(t)}),[]),l=(0,a.VK)((()=>{const e=i.collectionStore();return e&&(0,oe.mX)(t,ce.Z.getMode(t,e),e)}),[t,i]);return(0,a.VK)((()=>(0,p.cu)(n)&&(0,oe.KZ)()&&n.select_ai_inference),[n])?(0,je.jsx)(L.TB,{environment:t,collectionContextStore:i,collectionStore:r,property:o,propertySchema:n,doesUserHaveAIAddOn:s,isAutofillSetupEnabled:Boolean(l)}):null}function jo(e){let{propertySchema:t,collectionSettingsStore:o,collectionContextStore:n,property:i}=e;window.__c={n:"SelectOptionsComponent"};const r=(0,l.O7)(),s=(0,a.VK)((()=>n.collectionStore()),[n]);return s?(0,je.jsx)(Kt,{collectionSettingsStore:o,collectionContextStore:n,property:i,disabled:!1,aIAutofillOption:(0,je.jsx)(bo,{environment:r,collectionStore:s,collectionSettingsStore:o,property:i,propertySchema:t})}):null}function _o(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"LearnAboutRelationsMenuItemComponent"};const n=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t])[o];let i;return i=(0,u.Kp)(n)?(0,je.jsx)(Ge.Z,{href:(0,ie.UY)("guides.githubRelation"),title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Learn about GitHub Pull Requests",id:"database.viewSettings.propertyTab.githubPrRelation.learnMoreButton.title"}),analyticsFrom:"view_settings_property_github_pr_relation"}):(0,je.jsx)(Ge.Z,{href:(0,ie.UY)("guides.relations"),title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"}),(0,je.jsx)(z.Z,{topBorder:!0,children:i})}function Mo(e,t,o,n){const i=lo(n,o,t),r=t.collectionViewStore(),s=t.normalizedFormatStore.state,l=go(t,n);if(!l)return;if(!(i&&r&&o&&l))return;const a=io(o,t).map((e=>e.property===i.property?{...i,visible:!i.visible}:e)),c={...s,[o]:a};V.createAndCommit({userAction:"CollectionSettingsProperty.handleToggleVisibilityClick",environment:e,perform:s=>{N.iG({collectionViewStore:r,update:{format:c},transaction:s});const l=ao(n,o,t);A.oz({environment:e,collectionContextStore:t,currentIndex:l,entrypoint:"CollectionSettingsProperty",transaction:s,propertyAction:i.visible?"hide":"show"})}}),k.wd({environment:e,collectionContextStore:t,action:"toggle_property_visibility",original_view_type:r.getType(),property_type:l.type})}async function Io(e,t,o,n,i,r){await T.TI({environment:e,collectionContextStore:o,property:n,handleDeleteAccept:()=>function(e,t,o,n,i){const r=go(o,t),s=so(o),l=no(o);r&&(l&&V.createAndCommitAsync({environment:e,userAction:"CollectionSettingsProperty.handleDeleteAccept",waitForServerCommit:!1,perform:async n=>{await T.yV({environment:e,collectionStore:l,schema:s,property:t,transaction:n});const r=ao(t,i,o);A.oz({environment:e,collectionContextStore:o,currentIndex:r,entrypoint:"CollectionSettingsProperty",transaction:n,propertyAction:"delete"})}}),F.z$({collectionSettingsStore:n}),k.wd({environment:e,collectionContextStore:o,action:"delete_property",property_type:null==r?void 0:r.type}),k.y9({environment:e,collectionContextStore:o,property_type:r.type,from:"view_settings",property:t}))}(e,n,o,i,r),theme:t,from:"view_settings"})}function Po(e){let{collectionContextStore:t,property:o,collectionSettingsStore:n}=e;window.__c={n:"AiAutofillMenuItemComponent"};const i=(0,a.VK)((()=>go(t,o)),[t,o]);if(!i||"text"!==i.type)return null;const r=(0,p.q3)(i);let s;return r&&(0,p.MD)(r.type)?"summarize"===r.type?s=te.Dr.autofillSummary:"extract"===r.type?s=te.Dr.autofillExtract:"custom"===r.type?s=te.Dr.autofillCustom:"translate"===r.type?s=te.Dr.autofillTranslate:(0,_.t1)(r):s=Jt.autofillOffLabel,(0,je.jsx)(Le.Z,{title:(0,je.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,je.jsx)(I.FormattedMessage,{defaultMessage:"AI Autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"}),(0,je.jsx)(q.Z,{style:{display:"inline-block"}})]}),showChevron:!0,right:ne.default.formatMessage(s),onClick:()=>function(e,t,o){const n=go(t,o);t.collectionStore()&&n&&F.H4({collectionSettingsStore:e,item:{type:"propertyAiAutofill",propertySchema:n,property:o}})}(n,t,o)})}function ko(e){let{property:t,collectionContextStore:o}=e;window.__c={n:"RollupOptionsComponent"};const n=(0,l.O7)(),i=(0,a.VK)((()=>no(o)),[o]),r=(0,a.VK)((()=>so(o)),[o]),s=(0,a.VK)((()=>Boolean((null==i?void 0:i.getDatabaseType())&&(null==i?void 0:i.isTypedProperty(t)))),[i,t]);return i?(0,je.jsx)(Q.Z,{disabled:s,context:Q.t.ViewSettings,property:t,schema:r,analyticsFrom:"view_settings",parentStore:i,onChange:e=>function(e,t,o,n){const i=no(n);i&&V.createAndCommit({userAction:"CollectionSettingsProperty.handleRollupPropertyMenuChange",environment:t,perform:n=>{N.xO({environment:t,collectionStore:i,update:{[o]:e.propertySchema},transaction:n})}})}(e,n,t,o)}):null}function To(e){let{isRequiredTypedProperty:t,databaseType:o,collectionContextStore:n,property:i,collectionSettingsStore:r,formatKey:s}=e;window.__c={n:"DeletePropertyMenuItemComponent"};const a=(0,c.Fg)(),d=(0,l.O7)();return(0,je.jsx)(H.ZP,{disableTooltip:!t,placement:H.ug.Left,renderTooltip:e=>(0,D.A7)(o,e),render:e=>(0,je.jsx)(Le.Z,{...e,isRed:!0,disabled:t,onClick:()=>Io(d,a,n,i,r,s),icon:()=>t?(0,je.jsx)("div",{...e,style:{display:"inline-flex"},children:(0,v.Q)({width:14,marginLeft:4,marginRight:4})}):(0,C.y)({width:14,marginLeft:4,marginRight:4}),title:(0,je.jsx)(I.FormattedMessage,{defaultMessage:"Delete property",id:"database.viewSettings.propertyTab.deleteButton.title"}),caption:d.device.isMobile&&t?(0,D.A7)(o):null})})}},34532:(e,t,o)=>{o.d(t,{Z:()=>h});o(67294);var n=o(480),i=o(86628),r=o(24405),s=o(15145),l=o(82990),a=o(9291),c=o(84076),d=o(31278),p=o(76798),u=o(84210),m=o(94166),g=o(85893);function h(e){window.__c={n:"CollectionSettingsRelationTarget"};const{isSelfRelation:t,collectionStore:o,showAs:h,disabled:S,onClick:f}=e,y=(0,i.VK)((()=>Boolean(o)),[o]),x=(0,i.VK)((()=>null==o?void 0:o.getIcon()),[o]),v=(0,i.VK)((()=>{if(t)return;const e=null==o?void 0:o.getParentBlockStore();return e&&(0,u.ZP)({store:e,pageVisitSource:s.tY.LinkInPage})}),[o,t]),C=(0,n.Fy)(),b=(0,r.yK)((e=>({linkBox:{display:"flex",alignItems:"center"},linkTitle:{color:e.regularTextColor,fontWeight:l.Z.fontWeight.semibold,fontSize:14,marginLeft:4*(C.isRetina?.5:1),wordBreak:"break-word",...l.Z.textOverflowStyle},chevronTitle:{display:"inline",wordBreak:"break-word",...l.Z.textOverflowStyle}})),[C]),w=(0,g.jsx)(d.Z,{icon:x,isEmptyPage:!1,size:20,disabled:!0});return(0,g.jsx)(m.Z,{title:(0,g.jsx)(a.FormattedMessage,{defaultMessage:"Related to",id:"database.viewSettings.editRelation.targetLink.title"}),showChevron:"chevron"===h,onClick:f,disabled:S,right:t?(0,g.jsx)(a.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettings.editRelation.selfRelationTarget.title"}):"link"===h&&v?(0,g.jsxs)(c.Z,{href:v,innerStyle:b.linkBox,children:[w,(0,g.jsx)(p.Z,{store:o,underline:!0,style:b.linkTitle,maxLength:15})]}):y?(0,g.jsxs)(g.Fragment,{children:[w,(0,g.jsx)(p.Z,{store:o,style:b.chevronTitle})]}):(0,g.jsx)(a.FormattedMessage,{defaultMessage:"No target",id:"database.viewSettings.editRelation.noTarget.title"}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0}})}},3943:(e,t,o)=>{o.d(t,{P:()=>U,Z:()=>H});var n=o(67294),i=o(83355),r=o(480),s=o(86628),l=o(24405),a=o(49085),c=o(49019),d=o(47453),p=o(72126),u=o(51454),m=o(9291),g=o(8406),h=o(34993),S=o(5149),f=o(24677),y=o(98104),x=o(7801),v=o(99042),C=o(23063),b=o(37601),w=o(79131),j=o(1743),_=o(74194),M=o(89728),I=o(53437),P=o(53336),k=o(96787),T=o(24098),F=o(97004),R=o(68641),Z=o(13273),A=o(34859),V=o(61766),B=o(75330),O=o(1456),D=o(52387),N=o(8298),K=o(22109),L=o(29651),E=o(82990),q=o(45257),W=o(85893);function G(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"CollectionViewFilterBarSort"};const{device:i}=(0,r.O7)(),l=(0,s.VK)((()=>o.state.open),[o]),a=(0,n.useCallback)((e=>{e&&(0,Z.yT)(e.target)||S.E3({collectionSettingsStore:o})}),[o]),c=(0,n.useCallback)((()=>(0,W.jsx)(x.P,{context:R.HV.FilterBar,collectionContextStore:t,collectionSettingsStore:o,hideDesktopHeader:!0})),[t,o]);return(0,n.useEffect)((()=>()=>S.E3({collectionSettingsStore:o})),[]),(0,W.jsx)(I.ZP,{popupType:i.isMobile?I.ZP.PopupType.SlideUp:I.ZP.PopupType.Popup,open:l,origin:(0,W.jsx)(z,{collectionContextStore:t,collectionSettingsStore:o}),onDismiss:a,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:c})}function z(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"CollectionViewFilterBarSortPill"};const i=(0,r.O7)(),[a,c,d,p]=(0,s.VK)((()=>[t.currentSortsStore.state,t.localStateDiffStore.state,t.normalizedSchemaStore.state,t.permissionScopes.state]),[t]),u=a[0],h=u?d[u.property]:void 0,f=(0,n.useCallback)((()=>{g.wd({environment:i,collectionContextStore:t,action:"click_sort"}),S.wl({collectionSettingsStore:o,item:{type:"sort"}})}),[t,o,i]),y=(0,l.yK)((e=>({arrowIcon:{width:12,marginRight:4,fill:e.blueColor},arrowsIcon:{width:16,marginRight:4,fill:e.blueColor},title:{marginTop:-1,maxWidth:220,...E.Z.textOverflowStyle}})),[]);let x;return x=1===a.length?u&&"descending"===u.direction?(0,N.N)(y.arrowIcon):(0,L.w)(y.arrowIcon):(0,K.T)(y.arrowsIcon),(0,W.jsx)(q.Z,{on:!0,hasDiff:Boolean(p.canConfigureBlock&&c.sorts),icon:x,title:(0,W.jsx)("span",{style:y.title,children:1===a.length&&h?h.name:(0,W.jsx)(m.FormattedMessage,{defaultMessage:"{sortCount} sorts",id:"database.filterBar.sorts.label",values:{sortCount:a.length}})}),onClick:f})}G.displayName="CollectionViewFilterBarSort";let U=function(e){return e[e.FilterBar=0]="FilterBar",e[e.SettingsFilters=1]="SettingsFilters",e}({});class $ extends i.Z{constructor(){super(...arguments),this.storeTypes={createFilterSettingsStore:a.default.createClass({open:!1,stack:[]}),saveControlMoreActionsButtonPopupStore:V.Z},this.renderViewSettingsPopup=()=>{const{collectionContextStore:e}=this.props,{createFilterSettingsStore:t}=this.stores;return(0,W.jsx)(x.P,{context:R.HV.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleNewFilterPopupClick=()=>{const{collectionContextStore:e}=this.props,{createFilterSettingsStore:t}=this.stores;g.wd({environment:this.environment,collectionContextStore:e,action:"click_new_filter"}),S.wl({collectionSettingsStore:t,item:{type:"createFilter"}})},this.handlePopupDismiss=e=>{const{createFilterSettingsStore:t}=this.stores;e&&(0,Z.yT)(e.target)||S.E3({collectionSettingsStore:t})},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,F.Nq)(e)}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.context.environment,{isPhone:o}=t,n=o&&e.searchOpen.state,i=e.currentPropertyFiltersStore.state,r=e.currentSortsStore.state,s=this.localStateHasChangesStore.state,l=this.props.collectionContextStore.shouldShowSource.state?8:12,a=e.filterBarSortSettingsStore.state.open,c=r.length>0||a,d=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0;return(0,W.jsxs)("div",{style:{width:"100%",zIndex:u._Y},onClick:e=>function(e,t){t.filtersBarOpen.setState(!0)}(0,this.props.collectionContextStore),children:[(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[n&&(0,W.jsx)(oe,{collectionContextStore:this.props.collectionContextStore}),!n&&(0,W.jsx)("div",{style:{position:"relative",flexGrow:0,overflow:"hidden"},children:(0,W.jsx)(P.Z,{type:A.Z.X,style:{display:"flex",alignItems:"center",paddingTop:l,paddingBottom:t.isPhone?12:8},showLeftRightOverlay:!t.isPhone,children:o?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(ne,{collectionContextStore:this.props.collectionContextStore}),c&&(0,W.jsx)(Q,{collectionContextStore:this.props.collectionContextStore}),c&&!t.isPhone&&(0,W.jsx)(J,{}),d&&(0,W.jsx)(Y,{collectionContextStore:this.props.collectionContextStore}),(0,W.jsx)(te,{collectionContextStore:this.props.collectionContextStore,propertyFilters:i}),this.renderAddFilterButton()]}):(0,W.jsxs)(W.Fragment,{children:[c&&(0,W.jsx)(Q,{collectionContextStore:this.props.collectionContextStore}),c&&!t.isPhone&&(0,W.jsx)(J,{}),d&&(0,W.jsx)(Y,{collectionContextStore:this.props.collectionContextStore}),(0,W.jsx)(te,{collectionContextStore:this.props.collectionContextStore,propertyFilters:i}),this.renderAddFilterButton()]})})}),(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:"auto"},children:[!o&&s&&this.renderSaveControl(),!o&&(0,W.jsx)(k.Z,{collectionContextStore:this.props.collectionContextStore})]})]}),o&&!n&&(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[s&&this.renderSaveControl(),(0,W.jsx)(k.Z,{collectionContextStore:this.props.collectionContextStore})]})]})}renderSaveControl(){const{collectionContextStore:e,showHoverActionsStore:t}=this.props;return(0,W.jsx)(v.ZP,{context:v.R1.FilterBar,collectionContextStore:e,showHoverActionsStore:t,moreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}renderAddFilterButton(){const{showHoverActionsStore:e}=this.props,t=this.stores.createFilterSettingsStore.state.open,o=e.state||t;return(0,W.jsx)(I.ZP,{open:t,popupType:this.environment.device.isMobile?I.kQ.SlideUp:I.kQ.Popup,origin:(0,W.jsx)(C.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,W.jsx)(M.Z,{icon:d.R,isSmall:!0,isLightGray:!0,hovered:t,onClick:this.handleNewFilterPopupClick,style:{fontSize:14},children:(0,W.jsx)(m.FormattedMessage,{defaultMessage:"Add filter",id:"database.filterBar.addButton.title"})})}),render:this.renderViewSettingsPopup,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,onDismiss:this.handlePopupDismiss})}}$.displayName="CollectionViewFilterBar";const H=(0,m.injectIntl)($);function Y(e){let{collectionContextStore:t}=e;return(0,W.jsx)(O.B,{context:U.FilterBar,collectionSettingsStore:t.filterBarCombinatorFilterSettingsStore,collectionContextStore:t})}function Q(e){let{collectionContextStore:t}=e;return(0,W.jsx)(G,{collectionContextStore:t,collectionSettingsStore:t.filterBarSortSettingsStore},"sort")}function X(e){let{filter:t,collectionContextStore:o}=e;window.__c={n:"PropertyFilterComponent"};const n=(0,s.VK)((()=>o.getFilterBarItemSettingsStore(t)),[o,t]);return(0,W.jsx)(D.Z,{id:t.id,context:U.FilterBar,collectionContextStore:o,collectionSettingsStore:n},t.id)}function J(){window.__c={n:"DividerComponent"};const e=(0,l.Fg)();return(0,W.jsx)("div",{style:{borderRight:`1px solid ${e.regularDividerColor}`,height:24,marginRight:12,marginLeft:8}})}function ee(e){e.searchOpen.setState(!1),e.searchQuery.setState("")}function te(e){let{propertyFilters:t,collectionContextStore:o}=e;window.__c={n:"PropertyFiltersComponent"};const n=(0,r.O7)();if((0,s.VK)((()=>o.permissionScopes.state),[o]).canConfigureBlock){const e=t.map((e=>e.id));return(0,W.jsx)(w.ZP,{direction:"horizontal",keys:e,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>{const n=t.find((t=>t.id===e));if(n)return(0,W.jsx)(X,{collectionContextStore:o,filter:n})},style:{display:"flex",flexShrink:0},onDrop:e=>function(e,t,o){if(!o.collectionViewBlockStore())return;const n=o.currentPropertyFiltersStore.state,i=p.oA(e.map((e=>n.find((t=>t.id===e)))));h.iU({environment:t,collectionContextStore:o,temporaryState:{...o.temporaryState.state,propertyFilters:{value:i}}}),g.wd({environment:t,collectionContextStore:o,action:"reorder_filters"})}(e,n,o)})}return(0,W.jsx)(W.Fragment,{children:t.map((e=>(0,W.jsx)(X,{filter:e,collectionContextStore:o},e.id)))})}function oe(e){let{collectionContextStore:t}=e;window.__c={n:"MobileSearchInputComponent"};const o=(0,m.useIntl)(),n=(0,l.Fg)(),i=(0,r.O7)(),a=(0,s.VK)((()=>t.searchQuery.state),[t]);return(0,W.jsx)(j.Z,{capture:!0,children:(0,W.jsx)(T.Z,{capture:!0,render:e=>(0,W.jsx)("div",{...e,style:{width:"100%",paddingTop:i.device.isMobile?8:12,paddingBottom:6},children:(0,W.jsx)(q.Z,{wrapStyle:{width:"100%"},innerStyle:{width:"100%"},icon:(0,c.e)({width:14,fill:n.mediumIconColor,marginRight:6}),hideChevron:!0,title:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(_.Z,{format:_.B.Transparent,value:a,placeholder:o.formatMessage({defaultMessage:"Type to search…",id:"database.filterBar.mobileSearch.placeholder"}),onChange:e=>function(e,t){t.searchQuery.setState(e.target.value)}(e,t),autoComplete:"on",autoCorrect:"on",onBlur:()=>function(e){e.searchQuery.state||ee(e)}(t),onClearButtonClick:()=>ee(t),showClearButton:!0,focus:!i.device.isIOS||void 0,focusInitial:!0,inputStyle:{height:"100%"}}),(0,W.jsx)(b.Z,{show:!0})]})})})})})}function ne(e){let{collectionContextStore:t}=e;window.__c={n:"MobileSearchButtonComponent"};const o=(0,l.Fg)(),n=(0,r.O7)();return(0,W.jsx)(q.Z,{wrapStyle:{display:"flex",alignItems:"center"},icon:(0,c.e)({width:14,fill:o.mediumIconColor,marginRight:6}),hideChevron:!0,title:(0,W.jsx)("span",{style:{marginTop:-1,color:o.mediumTextColor},children:(0,W.jsx)(m.FormattedMessage,{defaultMessage:"Search",id:"database.filterBar.search.title"})}),onClick:()=>function(e,t){y.ZH(e),f.ZH(e),B.wG(),t.searchOpen.setState(!0),t.searchQuery.setState(""),g.wd({environment:e,collectionContextStore:t,action:"click_mobile_search"})}(n,t)},"search")}},1456:(e,t,o)=>{o.d(t,{B:()=>x});var n=o(67294),i=o(480),r=o(86628),s=o(24405),l=o(21197),a=o(82990),c=o(9291),d=o(8406),p=o(34993),u=o(5149),m=o(7801),g=o(53437),h=o(68641),S=o(13273),f=o(45257),y=o(85893);function x(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"CollectionViewFilterBarCombinatorFilter"};const s=(0,i.O7)(),[l,a]=(0,r.VK)((()=>[o.state.open,t.currentCombinatorFilterStore.state]),[t,o]),c=(0,n.useCallback)((()=>(0,y.jsx)(m.P,{context:h.HV.FilterBar,collectionContextStore:t,collectionSettingsStore:o,hideDesktopHeader:!0})),[t,o]),d=(0,n.useCallback)((e=>{var n;e&&(0,S.yT)(e.target)||(u.E3({collectionSettingsStore:o}),a&&0===(null===(n=a.filters)||void 0===n?void 0:n.length)&&p.iU({environment:s,collectionContextStore:t,temporaryState:{...t.temporaryState.state,combinatorFilter:{value:void 0}}}))}),[t,o,s,a]);return(0,n.useEffect)((()=>()=>u.E3({collectionSettingsStore:o})),[]),(0,y.jsx)(g.ZP,{popupType:s.device.isMobile?g.ZP.PopupType.SlideUp:g.ZP.PopupType.Popup,open:l,origin:(0,y.jsx)(v,{collectionContextStore:t,collectionSettingsStore:o}),onDismiss:d,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:c})}function v(e){var t;let{collectionContextStore:o,collectionSettingsStore:p}=e;window.__c={n:"CollectionViewFilterBarCombinatorFilterPill"};const m=(0,i.O7)(),g=(0,s.yK)((e=>({icon:{width:void 0,height:m.device.isMobile?14:12,fill:e.blueColor,marginRight:6},title:{maxWidth:180,...a.Z.textOverflowStyle}})),[m.device]),[h,S]=(0,r.VK)((()=>[Boolean(o.localStateDiffStore.state.combinatorFilter),o.currentCombinatorFilterStore.state]),[o]),x=(0,n.useCallback)((()=>{S&&(u.wl({collectionSettingsStore:p,item:{type:"filter"}}),d.wd({environment:m,collectionContextStore:o,action:"click_combinator_filter"}))}),[o,p,m,S]);return S?(0,y.jsx)(f.Z,{icon:(0,l.Q)(g.icon),title:(0,y.jsx)("span",{style:g.title,children:(0,y.jsx)(c.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.filterBar.advancedFilterRulesCount.title",values:{ruleCount:(null===(t=S.filters)||void 0===t?void 0:t.length)||0}})}),on:!0,hasDiff:h,onClick:x},"combinator"):null}x.displayName="CollectionViewFilterBarCombinatorFilter"},52387:(e,t,o)=>{o.d(t,{Z:()=>Y});var n=o(67294),i=o(480),r=o(86628),s=o(24405),l=o(76205),a=o(39068),c=o(62965),d=o(82990),p=o(9291),u=o(8406),m=o(34993),g=o(5149),h=o(56416),S=o(53437),f=o(26388),y=o(97004),x=o(75079),v=o(13273),C=o(18245),b=o(3943),w=o(45257),j=o(83355),_=o(15070),M=o(99036),I=o(40506),P=o(76725),k=o(72126),T=o(96367),F=o(21202),R=o(77420),Z=o(6287),A=o(19889),V=o(97880),B=o(7928),O=o(76798),D=o(89845),N=o(17335),K=o(29376),L=o(68373),E=o(85893);class q extends j.Z{constructor(){super(...arguments),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,propertyFilter:t,parentStore:o}=this.props,n=e[t.property];if(n&&(0,M.p_)(n))return(0,K.ke)(n,o)}))}renderComponent(){const{valueOnly:e,propertyFilter:t,style:o}=this.props,{filter:n}=t,i=(0,l.a_)(n)?n.subfilter:n,r=(0,l.h6)(i)&&!(0,l.mv)(n),s={...o,maxWidth:void 0};return(0,E.jsx)("span",{style:(0,l.gE)(i)?s:o,children:(0,E.jsx)(p.FormattedMessage,{defaultMessage:"{propertyName}{colonSeparator} {filterOperator} {propertyValue}",id:"database.filterBarFilterValue.title",values:{propertyName:e?void 0:(0,E.jsx)(z,{propertyFilter:this.props.propertyFilter,schema:this.props.schema}),colonSeparator:e||r?void 0:":",filterOperator:(0,E.jsx)(U,{propertyFilter:this.props.propertyFilter}),propertyValue:this.renderValue()}})})}renderValue(){const{propertyFilter:e,schema:t,intl:o,parentStore:n}=this.props,{filter:i}=e,r=(0,l.a_)(i)?i.subfilter:i;if((0,l.vR)(r))if((0,l.Ly)(r)||(0,l.h6)(r)){const e=r.value.value;if(void 0!==e)return(0,E.jsx)("span",{children:e})}else if((0,l.XA)(r)){const e=r.value.value;if(!0===e)return(0,E.jsx)("span",{children:(0,E.jsx)(p.FormattedMessage,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"})});if(!1===e)return(0,E.jsx)("span",{children:(0,E.jsx)(p.FormattedMessage,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"})})}else{if((0,l.dx)(r)||(0,l.NU)(r)){const e=(0,l.dx)(r)?(0,l.mg)(r):(0,l.qC)(r),t=k.oA(e.map((e=>{let{value:t}=e;return t})));if(0===t.length)return;return(0,E.jsx)("span",{children:(0,P.Z)(t,(e=>(0,E.jsx)($,{index:e})))})}if((0,l.r2)(r)){const e=(0,l.wB)(r),t=k.oA(e.map((e=>{let{value:t}=e;return t})));if(0===t.length)return;return(0,E.jsx)("span",{children:(0,P.Z)(t,(e=>(0,E.jsx)($,{index:e})))})}if((0,l.e)(r)){const e=(0,l.YO)(r),t=k.oA(e.map(((e,t)=>{if(!e.value)return;const o=e.type;if("exact"===o){const t=L.G.createChildStore(n,{table:F.iU,id:e.value});return(0,E.jsx)(O.Z,{style:{display:"inline"},store:t},e.value)}if("relative"===o){var i;const o=this.getRelatedCollectionAppConfigUri.state;if(!o)return;return(0,E.jsx)("span",{children:(0,E.jsx)(p.FormattedMessage,{...null===(i=T.qB[o])||void 0===i||null===(i=i[e.value.variable])||void 0===i?void 0:i.messageDescriptor})},t)}(0,V.t1)(o)})));return(0,P.Z)(t,(e=>(0,E.jsx)($,{index:e})))}if((0,l.Gb)(r)){const e=(0,l.R8)(r),t=k.oA(e.map(((e,t)=>{if("relative"===e.type)return(0,E.jsx)("span",{children:(0,E.jsx)(p.FormattedMessage,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"})},t);if(e.value){const i=e.value;if(i.table===A.KJ){const e=L.t1.createChildStore(n,{table:i.table,id:i.id});return(0,E.jsx)("span",{children:(0,B.Nz)(o,e.getModel())},t)}if(i.table===R.cZ){const e=L.t1.createChildStore(n,{table:i.table,id:i.id});return(0,E.jsx)("span",{children:(0,_.Mh)(e.getModel())},t)}}})));return(0,P.Z)(t,(e=>(0,E.jsx)($,{index:e})))}if((0,l.Mp)(r)){const e=(0,l.u0)(r),t=k.oA(e.map((e=>{if(e.value){const t=e.value,o=L.t1.createChildStore(n,{table:Z.v,id:t});return(0,E.jsx)(O.Z,{style:{display:"inline"},store:o},t)}})));return(0,P.Z)(t,(e=>(0,E.jsx)($,{index:e})))}if((0,l.gE)(r)){const o=t[e.property],n=(o&&"date"===o.type?o.date_format:void 0)||I.sF;let i;if("exact"===r.value.type){const e=r.value;if(e.value)if((0,I.J_)(e.value))i=e.value;else if((0,I.gR)(e.value)){const t=(0,I.Gc)(e.value);t&&(i=t.value)}}else if(!(0,l.TQ)(r))return(0,N.x)(r.value);if(i)return(0,E.jsx)(D.Z,{style:{display:"inline"},value:i,dateFormat:n,shortenDateAndRange:!0})}else{if((0,l.Jw)(r)){const e=(0,l.fl)(r).filter((e=>{let{value:t}=e;return Boolean(t)})).map(N.cq);if(0===e.length)return;return(0,E.jsx)("span",{children:(0,P.Z)(e,(e=>(0,E.jsx)($,{index:e})))})}(0,V.t1)(r)}}}}q.displayName="CollectionViewFilterValue";const W=(0,p.injectIntl)(q);function G(){return(0,E.jsx)(p.FormattedMessage,{defaultMessage:"Not",id:"database.filterBarFilterValue.notOperator"})}function z(e){let{propertyFilter:t,schema:o}=e;const n=o[t.property];return n?(0,E.jsx)("span",{style:{fontWeight:d.Z.fontWeight.medium},children:n.name}):null}function U(e){let{propertyFilter:t}=e;const{filter:o}=t,n=(0,l.a_)(o)?o.subfilter:o;if((0,l.Ly)(n))return"string_contains"===n.operator||"string_is"===n.operator?null:"string_does_not_contain"===n.operator||"string_is_not"===n.operator?(0,E.jsx)(G,{}):(0,E.jsx)(E.Fragment,{children:(0,N.WC)(n.operator)});if((0,l.h6)(n))return(0,E.jsx)(E.Fragment,{children:(0,N.WC)(n.operator)});if((0,l.XA)(n)){if("checkbox_is_not"===n.operator)return(0,E.jsx)(G,{})}else{if((0,l.dx)(n))return"enum_is"===n.operator?null:"enum_is_not"===n.operator?(0,E.jsx)(G,{}):(0,E.jsx)(E.Fragment,{children:(0,N.WC)(n.operator)});if((0,l.NU)(n))return"enum_contains"===n.operator?null:"enum_does_not_contain"===n.operator?(0,E.jsx)(G,{}):(0,E.jsx)(E.Fragment,{children:(0,N.WC)(n.operator)});if((0,l.r2)(n))return"status_is"===n.operator?null:"status_is_not"===n.operator?(0,E.jsx)(G,{}):(0,E.jsx)(E.Fragment,{children:(0,N.WC)(n.operator)});if((0,l.e)(n))return"relation_contains"===n.operator?null:"relation_does_not_contain"===n.operator?(0,E.jsx)(G,{}):(0,E.jsx)(E.Fragment,{children:(0,N.WC)(n.operator)});if((0,l.Gb)(n))return"person_contains"===n.operator?null:"person_does_not_contain"===n.operator?(0,E.jsx)(G,{}):(0,E.jsx)(E.Fragment,{children:(0,N.WC)(n.operator)});if((0,l.Mp)(n)){if("location_is"===n.operator)return null;if("location_is_not"===n.operator)return(0,E.jsx)(G,{})}else if((0,l.gE)(n)){if("date_is"===n.operator)return null;if("date_is_after"===n.operator)return(0,E.jsx)(p.FormattedMessage,{defaultMessage:"After",id:"database.filterValue.dateType.dateIsAfter.title"});if("date_is_before"===n.operator)return(0,E.jsx)(p.FormattedMessage,{defaultMessage:"Before",id:"database.filterValue.dateType.dateIsBefore.title"});if("date_is_on_or_after"===n.operator)return(0,E.jsx)(p.FormattedMessage,{defaultMessage:"On or after",id:"database.filterValue.dateType.dateIsOnOrAfter.title"});if("date_is_on_or_before"===n.operator)return(0,E.jsx)(p.FormattedMessage,{defaultMessage:"On or before",id:"database.filterValue.dateType.dateIsOnOrBefore.title"});if(!(0,l.TQ)(n))return(0,E.jsx)(E.Fragment,{children:(0,N.WC)(n.operator)});{const e=n.value;if(!e.value||"exact"!==e.type||!(0,I.gR)(e.value))return(0,E.jsx)(E.Fragment,{children:(0,N.ip)(e)});if(e.value.start_date&&e.value.end_date)return null;if(e.value.start_date)return(0,E.jsx)(p.FormattedMessage,{defaultMessage:"Starting",id:"database.filterValue.dateType.starting.title"});if(e.value.end_date)return(0,E.jsx)(p.FormattedMessage,{defaultMessage:"Ending",id:"database.filterValue.dateType.ending.title"})}}else{if((0,l.Jw)(n))return"verification_is"===n.operator?null:"verification_is_not"===n.operator?(0,E.jsx)(G,{}):(0,E.jsx)(E.Fragment,{children:(0,N.WC)(n.operator)});(0,V.t1)(n)}}return null}function $(e){let{index:t}=e;return(0,E.jsx)("span",{style:{whiteSpace:"pre"},children:(0,E.jsx)(p.FormattedMessage,{defaultMessage:", ",id:"database.filterValue.commaSeparator"})},t)}function H(e){let{id:t,context:o,collectionContextStore:c,collectionSettingsStore:d}=e;window.__c={n:"CollectionViewFilterBarPropertyFilter"};const j=(0,i.O7)(),_=(0,s.Fg)(),{filter:M,isReadOnly:I}=(0,r.VK)((()=>{const e=function(e,t){return t.currentPropertyFiltersStore.state.find((t=>t.id===e))}(t,c);return{filter:e,isReadOnly:Boolean(e&&(0,y.mu)(e.id))}}),[c,t]),P=(0,r.VK)((()=>{const e=c.localStateDiffStore.state;return e.filters.updated.includes(t)||e.filters.added.includes(t)}),[c,t]),k=(0,r.VK)((()=>c.collectionViewStore()),[c]),T=(0,r.VK)((()=>c.normalizedSchemaStore.state),[c]),F=(0,r.VK)((()=>c.permissionScopes.state.canConfigureBlock),[c]),R=(0,r.VK)((()=>d.state.open),[d]),Z=(0,r.VK)((()=>{var e;return M?null==c||null===(e=c.collectionStore())||void 0===e||null===(e=e.getSchema()[M.filter.property])||void 0===e?void 0:e.type:void 0}),[c,M]),A=(0,n.useCallback)((e=>{e&&(0,v.yT)(e.target)||g.E3({collectionSettingsStore:d})}),[d]),V=(0,n.useCallback)((()=>{var e;M&&(g.wl({collectionSettingsStore:d,item:{type:"filter"}}),u.wd({environment:j,collectionContextStore:c,action:"click_property_filter",original_view_type:void 0,property_type:null==c||null===(e=c.collectionStore())||void 0===e||null===(e=e.getSchema()[M.filter.property])||void 0===e?void 0:e.type}))}),[c,d,j,M]),B=(0,n.useCallback)((()=>{g.E3({collectionSettingsStore:d})}),[d]),O=(0,n.useCallback)((e=>{var t;if(!M)return;const o=null===(t=c.remoteResult.state)||void 0===t?void 0:t.sizeHint,n=C.default.mark("collections.update_filter_lag");C.default.measureAfterNextFlush(n,{environment:j,getData:()=>x.Y5({from:"property_filter",property_type:Z,collectionContextStore:c,sizeHintAtStart:o})});const i=M.filter,r=c.currentPropertyFiltersStore.state.map((t=>{if(t.id===M.id){return{...M,filter:{...i,filter:e}}}return t}));m.iU({environment:j,collectionContextStore:c,temporaryState:{...c.temporaryState.state,propertyFilters:{value:r}}}),u.wd({environment:j,collectionContextStore:c,action:"update_property_filter",original_view_type:void 0,property_type:Z})}),[c,j,M,Z]),D=(0,n.useCallback)((()=>{var e;if(!M)return;const t=c.currentPropertyFiltersStore.state.filter((e=>e.id!==M.id));m.iU({environment:j,collectionContextStore:c,temporaryState:{...c.temporaryState.state,propertyFilters:{value:t}}}),u.wd({environment:j,collectionContextStore:c,action:"delete_property_filter",original_view_type:void 0,property_type:null==c||null===(e=c.collectionStore())||void 0===e||null===(e=e.getSchema()[M.filter.property])||void 0===e?void 0:e.type})}),[c,j,M]),N=(0,n.useCallback)((()=>{var e;if(!M)return;const{combinatorFilter:t,propertyFilters:n}=(0,y.Gz)(c,M);m.iU({environment:j,collectionContextStore:c,temporaryState:{...c.temporaryState.state,propertyFilters:{value:n},combinatorFilter:{value:t}}});const i=o===b.P.FilterBar?c.filterBarCombinatorFilterSettingsStore:c.filterOptionsCombinatorFilterSettingsStore;g.wl({collectionSettingsStore:i,item:{type:"filter"}}),u.wd({environment:j,collectionContextStore:c,action:"merge_filter_into_combinator",property_type:null==c||null===(e=c.collectionStore())||void 0===e||null===(e=e.getSchema()[M.filter.property])||void 0===e?void 0:e.type})}),[c,o,j,M]),K=(0,n.useCallback)(((e,t)=>{if(!k||!M)return null;const o=M.filter,n=!(0,l.Oo)(o),i=T[o.property];return(0,E.jsx)(w.Z,{icon:i&&(0,E.jsx)(a.ZP,{type:i.type,icon:i.icon,size:j.device.isMobile?18:16,theme:_,style:{fill:n?_.blueColor:_.mediumIconColor,marginRight:6}}),title:n?(0,E.jsx)(W,{propertyFilter:o,schema:T,style:Q(),parentStore:k}):(0,E.jsx)("span",{style:Q(),children:null==i?void 0:i.name}),on:n,hasDiff:P,disabled:t,hideChevron:t,onClick:V,...e},M.id)}),[k,j,M,V,P,T,_]),L=(0,n.useCallback)((()=>(0,E.jsx)(f.ZP,{placement:f.ug.Bottom,render:e=>K(e,!0),renderTooltip:()=>(0,E.jsx)(p.FormattedMessage,{id:"database.filterBarPropertyFilter.cannotConfigure",defaultMessage:"This filter cannot be modified on this view."})})),[K]),q=(0,n.useCallback)((()=>{if(!M)return;const e=M.filter;return k?(0,E.jsx)(h.ZP,{collectionViewId:k.id,propertyFilter:e,schema:T,parentStore:k,onChange:O,onClose:B,onDelete:D,onAddToCombinatorFilter:N,context:h.Qv.PropertyFilter,allowAddingToCombinatorFilter:F,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,collectionContextStore:c}):void 0}),[F,c,k,M,N,D,B,O,T]);return I?L():(0,E.jsx)(S.ZP,{popupType:j.device.isMobile?S.ZP.PopupType.SlideUp:S.ZP.PopupType.Popup,open:R,origin:I?L():K(void 0,!1),onDismiss:A,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:q})}const Y=n.memo(H,c.Z);function Q(){return{maxWidth:180,...d.Z.textOverflowStyle}}},45257:(e,t,o)=>{o.d(t,{Z:()=>a});o(67294);var n=o(480),i=o(24405),r=o(42853),s=o(64921),l=o(85893);function a(e){window.__c={n:"CollectionViewFilterPill"};const{icon:t,title:o,on:a,hasDiff:d,wrapStyle:p,innerStyle:u,hideChevron:m}=e,g=(0,i.Fg)(),h=(0,n.O7)();return(0,l.jsxs)("div",{style:{borderRadius:14,marginRight:6,display:"inline-flex",...d&&{position:"relative"},...p},children:[(0,l.jsxs)(s.Z,{disabled:e.disabled,style:c(Boolean(a),g,u,h.device.isMobile),hoveredStyle:a?{background:g.outlineBlueButtonHoveredBackground}:void 0,pressedStyle:a?{background:g.outlineBlueButtonPressedBackground}:void 0,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,onDoubleClick:e.onDoubleClick,children:[t,o,!m&&(0,r.i)({width:10,marginLeft:4,marginTop:1,fill:a?g.blueColor:g.lightIconColor})]}),d&&(0,l.jsx)("div",{style:{position:"absolute",top:-2,right:-2,background:"dark"===g.mode?g.accentColors.orange[500]:g.accentColors.orange[300],border:`1px solid ${g.contentBackground}`,width:9,height:9,borderRadius:9}})]})}function c(e,t,o,n){return{fontSize:14,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderRadius:32,height:n?28:24,lineHeight:n?"28px":"24px",padding:"0 8px",border:`1px solid ${t.outlineButtonBorder}`,color:t.mediumTextColor,...e&&{color:t.blueColor,border:`1px solid ${t.filterPillBorder}`,background:t.filterPillBackground},...o}}},68500:(e,t,o)=>{o.d(t,{Z:()=>L});o(67294);var n=o(83355),i=o(480),r=o(86628),s=o(66897),l=o(14714),a=o(99036),c=o(75e3),d=o(72126),p=o(4615),u=o(96367),m=o(21202),g=o(6287),h=o(97880),S=o(9291),f=o(47307),y=o(66890),x=o(23586),v=o(92658),C=o(87279),b=o(77907),w=o(75822),j=o(77556),_=o(29798),M=o(68373),I=o(42922),P=o(52275),k=o(36488),T=o(74194),F=o(68894),R=o(78140),Z=o(32163),A=o(43765),V=o(11470),B=o(72495),O=o(86765),D=o(97680),N=o(85893);class K extends n.Z{constructor(){super(...arguments),this.storeTypes={inputStore:v.Z,menuListStore:_.Z,collectionContextStore:j.Z},this.handleTextInputChange=e=>{const{inputStore:t,menuListStore:o}=this.stores;t.setState({...t.state,inputValue:e.target.value}),o.setState({...o.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.handleTextInputKeydown=e=>{if(13===e.keyCode)this.acceptTextInputValue();else if(27===e.keyCode){var t,o;null===(t=(o=this.props).onClose)||void 0===t||t.call(o)}},this.handleMenuClickRight=()=>{this.acceptTextInputValue()},this.handleClickSubmitButton=()=>{this.acceptTextInputValue()}}UNSAFE_willMount(e){var t;super.UNSAFE_willMount(e);const{inputStore:o}=this.stores,{groupFormat:n}=this.props;n&&("select"===n.value.type||"multi_select"===n.value.type)&&n.value.value?o.setState({...o.state,inputValue:n.value.value}):n&&(0,l.R7)(n.value)&&"exact"===(null===(t=n.value.value)||void 0===t?void 0:t.type)&&o.setState({...o.state,inputValue:n.value.value.value})}renderComponent(){const{groupFormat:e,onClose:t}=this.props;let o;var n;return o=this.environment.device.isPhone?{menuType:C.og.Modal,title:e?(0,N.jsx)(S.FormattedMessage,{defaultMessage:"Rename group",id:"codeBlock.databaseEditGroupMenu.renameGroupTitle"}):(0,N.jsx)(S.FormattedMessage,{defaultMessage:"Add a group",id:"codeBlock.databaseEditGroupMenu.addGroupTitle"}),left:(0,N.jsx)(S.FormattedMessage,{defaultMessage:"Cancel",id:"codeBlock.databaseEditGroupMenu.cancelButton.label"}),right:(0,N.jsx)(S.FormattedMessage,{defaultMessage:"Done",id:"codeBlock.databaseEditGroupMenu.doneButton.label"}),onClickRight:this.handleMenuClickRight,onClickLeft:t}:{menuType:C.og.Popup,width:(n=this.props.groupBy,"select"===n.type||"multi_select"===n.type||(0,l.HB)(n.type)?300:240),maxHeight:"50vh"},(0,N.jsx)(k.Z,{capture:!0,render:e=>(0,N.jsx)(R.Z,{...o,...e,children:this.renderMenuInner()})})}renderMenuInner(){const{groupBy:e,schema:t}=this.props;if(t[e.property])return"select"===e.type||"multi_select"===e.type?this.renderTextInput():"person"===e.type?(0,N.jsx)(q,{currentGroups:this.props.currentGroups,onChange:this.props.onChange,groupFormat:this.props.groupFormat,onClose:this.props.onClose,inputStore:this.stores.inputStore,menuListStore:this.stores.menuListStore}):"relation"===e.type?this.renderRelationValue():(0,l.HB)(e.type)?this.renderTextInput():void("number"!==e.type&&"status"!==e.type&&"date"!==e.type&&"formula"!==e.type&&"checkbox"!==e.type&&"created_time"!==e.type&&"last_edited_time"!==e.type&&"created_by"!==e.type&&"last_edited_by"!==e.type&&"last_visited_time"!==e.type&&"location"!==e.type&&(0,h.t1)(e.type))}renderTextInput(){const{intl:e,groupFormat:t}=this.props,{inputValue:o}=this.stores.inputStore.state,n=t?e.formatMessage({id:"database.collectionEditGroupMenu.renameGroupLabel.placeholder",defaultMessage:"Rename group"}):e.formatMessage({id:"database.collectionEditGroupMenu.newGroupLabel.placeholder",defaultMessage:"New group"});return this.environment.device.isPhone?(0,N.jsx)(B.Z,{children:(0,N.jsx)(F.ZP,{value:o,focus:!0,selectAll:!0,showClearButton:!1,focusInitial:!0,placeholder:n,onChange:this.handleTextInputChange,onKeyDown:this.handleTextInputKeydown})}):(0,N.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"8px 10px",width:"100%",background:this.theme.inputBackground},children:[(0,N.jsx)(T.Z,{value:o,focus:!0,selectAll:!0,focusInitial:!0,placeholder:n,onChange:this.handleTextInputChange,onKeyDown:this.handleTextInputKeydown,format:T.B.Transparent}),(0,N.jsxs)(I.Z,{onClick:this.handleClickSubmitButton,children:[(0,N.jsx)(S.FormattedMessage,{defaultMessage:"Done",id:"database.collectionEditGroupMenu.submitButton.label"}),(0,c.U)({height:14,width:14,fill:"currentColor",marginLeft:6,marginTop:2})]})]})}getCreateNewPageMenuListItem(){const{parentStore:e,schema:t,groupBy:o}=this.props,{inputValue:n}=this.stores.inputStore.state,i=t[o.property];if(!i||"relation"!==i.type)return null;const r=a.j0(i);if(!r)return null;const s=M.NW.createChildStore(e,r);return s.isDefined()&&n.length>0?{key:"new-page",render:e=>(0,N.jsx)(P.Z,{title:(0,N.jsx)(O.Z,{targetCollectionStore:s,title:n}),...e}),action:()=>{const{onChange:e}=this.props,t={table:m.iU,id:(0,p.ZP)(),spaceId:s.getSpaceId()};e({newGroupValue:{type:"relation",value:t},newPage:{id:t.id,spaceId:t.spaceId,name:n}})}}:null}getMenuListItemsForRelatedRecords(e,t){var o;const{currentGroups:n,parentStore:i}=this.props,r=null===(o=this.context.collectionContextStore)||void 0===o?void 0:o.relativeVariableStore.state,s=r&&r[t.id],a=(e,o)=>{const n=M.NW.createChildStore(i,t);if(!n.isDefined())return;const r=n.getFormat().app_config_uri;return r&&o?e.formatMessage(u.qB[r][o].messageDescriptor):void 0};return e.map((e=>{const t=M.G.createChildStore(i,e);if(t.isTemplate())return;const o=s?(0,u.P8)(t.id,s):void 0;return{key:t.id,render:e=>(0,N.jsx)(V.Z,{store:t,titlePrefix:a(this.props.intl,o),...e}),action:()=>{const{onChange:t,groupFormat:i}=this.props;let r={type:"relation",value:e};var s,a;(o&&(r={type:"relation",value:{type:"relative",value:{type:"builtin",variable:o}}}),i&&d.Xy(r,i.value))?null===(s=(a=this.props).onClose)||void 0===s||s.call(a):n.some((e=>(0,l.we)(r,e.value)))?f.showErrorMessage((0,N.jsx)(E,{})):t({newGroupValue:r})}}}))}renderRelationValue(){const{intl:e,parentStore:t,schema:o,groupBy:n}=this.props,{inputValue:i}=this.stores.inputStore.state,r=o[n.property];if(!r||"relation"!==r.type)return;const s=a.j0(r);if(!s)return;return M.NW.createChildStore(t,s).isDefined()?(0,N.jsx)(x.Z,{request:i,performRequest:e=>async function(e,t,o,n,i){const r=o[t.property];if(!r||!(0,a.p_)(r))return;const s=r.collection_pointer;if(!s)return;const l=M.NW.createChildStore(n,{table:g.v,id:s.id});if(await l.load(),!l.isDefined())return;const c=l.getSpaceId(),d=await b.deps.searchActions.loader();return(await d.searchPagesInCollection({environment:i,query:e,collectionId:s.id,spaceId:c,excludeTemplates:!0,source:"collection_group_value",limit:20,includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!1})).results.map((e=>({table:m.iU,id:e,spaceId:c})))}(e,this.props.groupBy,this.props.schema,this.props.parentStore,this.environment),debounce:w.vp,render:(t,o,n)=>{o||(o=[]);const r=d.oA([...this.getMenuListItemsForRelatedRecords(o,s),this.getCreateNewPageMenuListItem()]);let l;return l=n&&o&&0===r.length?(0,N.jsx)(B.Z,{children:(0,N.jsx)(A.Z,{title:(0,N.jsx)(S.FormattedMessage,{defaultMessage:"No results",id:"database.noRelationSearchResults.message"})})}):(0,N.jsx)(Z.Z,{type:Z.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,N.jsx)(B.Z,{...e}),items:r}],store:this.stores.menuListStore}),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(B.Z,{children:(0,N.jsx)(F.ZP,{value:i,focus:!0,placeholder:e.formatMessage({defaultMessage:"Type to search...",id:"database.searchRelation.placeholder"}),onChange:e=>{this.stores.inputStore.setState({...this.stores.inputStore.state,inputValue:e.target.value}),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})}),l]})}}):void 0}acceptTextInputValue(){const{onChange:e,currentGroups:t,groupBy:o,groupFormat:n}=this.props,{inputStore:i}=this.stores,r=i.state.inputValue.trim().replace(/,/g,"");let s;var a,c,p,u,m,g;("select"===o.type||"multi_select"===o.type?s={type:o.type,value:r}:(0,l.aB)(o)&&(s={type:o.type,value:{type:"exact",value:r}}),s)?r?n&&d.Xy(s,n.value)?null===(a=(c=this.props).onClose)||void 0===a||a.call(c):t.some((e=>s&&(0,l.we)(s,e.value)))?f.showErrorMessage((0,N.jsx)(E,{})):e({newGroupValue:s}):null===(p=(u=this.props).onClose)||void 0===p||p.call(u):null===(m=(g=this.props).onClose)||void 0===m||m.call(g)}}K.displayName="CollectionEditGroupMenu",K.contextTypes={...n.w,...y.xm};const L=(0,S.injectIntl)(K);function E(){return(0,N.jsx)(S.FormattedMessage,{defaultMessage:"Group already exists.",id:"database.groupExistsAlreadyError.message"})}function q(e){let{currentGroups:t,onChange:o,groupFormat:n,onClose:a,inputStore:c,menuListStore:p}=e;window.__c={n:"PersonValueComponent"};const u=(0,i.O7)(),m=(0,S.useIntl)(),g=(0,r.qz)(p,_.Z),h=(0,r.qz)(c,v.Z),{inputValue:y}=(0,r.VK)((()=>h.state),[h]);return(0,N.jsx)(x.Z,{request:y,performRequest:e=>async function(e,t){const o=await b.deps.searchActions.loader();return(await o.searchVisibleSpaceUsers({environment:t,query:e,membersOnly:!1})).slice(0,20)}(e,u),debounce:w.vp,render:(e,i,r)=>{i||(i=[]);const c=d.oA(i.map((e=>({key:e.id,render:t=>(0,N.jsx)(D.Z,{actor:(0,s.dp)(e),...t}),action:()=>{const i={type:"person",value:{table:"notion_user",id:e.id}};return n&&d.Xy(i,n.value)?(null==a||a(),null):t.some((e=>(0,l.we)(i,e.value)))?(f.showErrorMessage((0,N.jsx)(E,{})),null):void o({newGroupValue:i})}}))));let p;return p=r&&i&&0===c.length?(0,N.jsx)(B.Z,{children:(0,N.jsx)(A.Z,{title:(0,N.jsx)(S.FormattedMessage,{defaultMessage:"No results",id:"database.noPersonSearchResults.message"})})}):(0,N.jsx)(Z.Z,{type:Z.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,N.jsx)(B.Z,{...e}),items:c}],store:g}),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(B.Z,{children:(0,N.jsx)(F.ZP,{value:y,focus:!0,placeholder:m.formatMessage({defaultMessage:"Search for a person…",id:"database.searchPerson.placeholder"}),onChange:e=>{h.setState({...h.state,inputValue:e.target.value}),g.setState({...g.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})}),p]})}})}},26055:(e,t,o)=>{o.d(t,{Z:()=>G});o(67294);var n=o(83355),i=o(24405),r=o(66897),s=o(15145),l=o(14714),a=o(99036),c=o(80951),d=o(84619),p=o(7057),u=o(53877),m=o(42875),g=o(89767),h=o(38737),S=o(96367),f=o(97880),y=o(82990),x=o(9291),v=o(5149),C=o(16732),b=o(10906),w=o(26991),j=o(92996),_=o(29376);var M=o(84210),I=o(33929),P=o(80444),k=o(61766),T=o(68373),F=o(68500),R=o(97180),Z=o(64921),A=o(31945),V=o(60458),B=o(84076),O=o(31278),D=o(76798),N=o(26388),K=o(92864),L=o(25845),E=o(22084),q=o(85893);class W extends n.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:k.Z},this.renderEditPopup=()=>{const{schema:e,currentGroups:t,groupBy:o,groupFormat:n}=this.props,i=this.groupParentStore.state;if(i)return(0,q.jsx)(F.Z,{groupFormat:n,groupBy:o,currentGroups:t,schema:e,onChange:e=>{var t,o;this.stores.buttonPopupStore.reset(),null===(t=(o=this.props).onChange)||void 0===t||t.call(o,e)},onClose:()=>{var e,t;this.stores.buttonPopupStore.reset(),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)},parentStore:i})},this.groupParentStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.groupUiParentStore})),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.groupParentStore.state,n=e[t.property];if(n&&(0,a.p_)(n)&&o)return(0,_.ke)(n,o)}))}renderGroupType(e,t){return"select"===e.type||"multi_select"===e.type?this.renderSelectValue():"status"===e.type?(0,q.jsx)(Y,{groupFormat:this.props.groupFormat,schema:this.props.schema}):(0,l.pd)(e.type)?this.renderPersonValue(e):"relation"===e.type?this.renderRelationValue(e):"location"===e.type?this.renderLocationValue(e):(0,l.A1)(e.type)?(0,q.jsx)(ee,{style:this.props.style,groupValue:e}):(0,l.HB)(e.type)?this.renderTextValue(e):"number"===e.type?(0,q.jsx)(te,{style:this.props.style,groupValue:e,propertySchema:"number"===t.type?t:void 0}):"checkbox"===e.type?(0,q.jsx)(J,{style:this.props.style,propertySchema:t,groupValue:e}):void(0,f.t1)(e.type)}renderComponent(){const{groupFormat:e,schema:t}=this.props,o=e.value,n=void 0===o.value,i=t[e.property];if(i){if(n)return this.renderEmptyGroupLabel();if("formula"===o.type){if("formula"!==o.type)return;const e=o.value;if(!e)return;return this.renderGroupType(e,i)}return this.renderGroupType(o,i)}}renderEmptyGroupLabel(){const{groupFormat:e,schema:t,isHiddenGroup:o,collectionContextStore:n}=this.props,i=t[e.property],r=n.collectionStore(),s=this.groupParentStore.state;if(!i)return;const{name:l}=i;let c=!1;return null!=r&&r.isDefined()&&(0,a.p_)(i)&&s&&(c=function(e){const{collectionStore:t,property:o,propertySchema:n,parentStore:i}=e;let r=!1;if(null!=t&&t.isDefined()){const e=t.getPropertyMapping();r=(null==e?void 0:e[j.Es.TaskToSprintRelation])===o}return(0,_.ke)(n,i)===j.p$||r}({collectionStore:r,property:e.property,propertySchema:i,parentStore:s})),c?(0,q.jsx)(U,{style:this.props.style,uncategorizedIconStyle:this.props.uncategorizedIconStyle,isHiddenGroup:o,formattedLabelMessage:(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Backlog (No {name})",values:{name:l},id:"database.sprintDatabaseView.uncategorizedGroupLabel"})}):(0,q.jsx)(U,{style:this.props.style,uncategorizedIconStyle:this.props.uncategorizedIconStyle,isHiddenGroup:o,formattedLabelMessage:(0,q.jsx)(x.FormattedMessage,{defaultMessage:"No {name}",values:{name:l},id:"database.boardView.uncategorizedColumnTitle"})})}renderSelectValue(){var e;const{groupFormat:t,schema:o}=this.props,n=o[t.property];if(!n||!a.cu(n))return;const i=t.value;if(null===(e=n.options)||void 0===e||!e.length||void 0===i.value||i.type!==n.type)return;const r=(0,c.i7)(n.options,i.value);return r?(0,q.jsx)(A.ZP,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?A.Z4.SlideUp:A.Z4.Popup,originGap:4,renderOrigin:e=>(0,q.jsx)(Z.Z,{style:{...oe,...this.props.style},disabled:this.props.disabled,...e,children:(0,q.jsx)(E.a,{format:d.lo.Medium,isSingle:!0,value:r.value,color:r.color,showRemoveButton:!1})})}):void 0}renderPersonValue(e){if(!(0,l.q6)(e))return;const{value:t}=e;if(!t)return;const o=this.groupParentStore.state;if(!o)return;const n=(0,r.Hl)({pointer:t,getRecordValue:o.getRecordValue});return n.asActor?(0,q.jsx)(A.ZP,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?A.Z4.SlideUp:A.Z4.Popup,originGap:4,renderOrigin:e=>(0,q.jsx)(Z.Z,{style:{...oe,...this.props.style},disabled:this.props.disabled,...e,children:(0,q.jsx)(K.ZP,{format:K.ZP.Format.Medium,actor:n,showRemoveButton:!1,isSingle:!0,disableAvatarTooltip:this.props.isHiddenGroup,shouldShrink:!0})})}):void 0}renderLocationValue(e){const t=this.groupParentStore.state;if("location"!==e.type)return;if(!e.value)return;if(!t)return;const o=T.NW.createChildStore(t,e.value);return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(O.Z,{disabled:!0,icon:o.getIcon(),size:20,isEmptyPage:!1,style:{marginTop:2,marginRight:6}}),(0,q.jsx)(D.Z,{store:o,underline:!0,style:{fontWeight:y.Z.fontWeight.medium}})]})}renderRelationValue(e){const{schema:t,groupFormat:o,collectionContextStore:n}=this.props,i=this.groupParentStore.state;if(!i)return;if("relation"!==e.type)return;const r=t[o.property];if(!r||"relation"!==r.type)return;const c=a.j0(r);if(!c)return;const d=T.NW.createChildStore(i,c);if(d.isDefined()&&e.value){if((0,l.t2)(e.value)){var p;const t=this.getRelatedCollectionAppConfigUri.state;if(!t)return;let o;const r=e.value.value.variable;"current"===r?o=I.default.formatMessage(C.sY.tasksCurrentSprintV2ViewNamePrefix):"next"===r?o=I.default.formatMessage(C.sY.tasksNextSprintV2ViewNamePrefix):"last"===r?o=I.default.formatMessage(C.sY.tasksLastSprintV2ViewNamePrefix):(0,f.t1)(r);const l=null===(p=S.qB[t])||void 0===p?void 0:p[r];if(null!=d&&d.isDefined()){const e=(0,w.As)(n,r,c,d);if(!e)return(0,q.jsx)("div",{style:{fontWeight:y.Z.fontWeight.medium},children:(0,q.jsx)(x.FormattedMessage,{...null==l?void 0:l.messageDescriptor})});const{mainEditorCurrentBlockStore:t}=P.default.state,a=b.mb({store:e,mainEditorCurrentBlockStore:t,collectionContextStore:n})??(0,M.ZP)({store:e,pageVisitSource:s.tY.LinkInPage});if(e)return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{style:{fontWeight:y.Z.fontWeight.medium,marginBottom:.25},children:[o,":"]}),(0,q.jsx)(B.Z,{style:{...this.props.style,marginLeft:1},innerStyle:{...oe},href:a,onClick:()=>{v.E3({collectionSettingsStore:n.settingsStore})},children:(0,q.jsx)(L.Z,{format:K.ZP.Format.Medium,blockId:e.id,isSingle:!0,shouldShrink:!0,parentStore:i})})]})}return(0,q.jsx)("div",{style:{fontWeight:y.Z.fontWeight.medium,marginBottom:.25},children:(0,q.jsx)(x.FormattedMessage,{...null==l?void 0:l.messageDescriptor})})}if((0,l.RA)(e.value)){const t=T.G.createChildStore(i,e.value),{mainEditorCurrentBlockStore:o}=P.default.state,r=b.mb({store:t,mainEditorCurrentBlockStore:o,collectionContextStore:n})??(0,M.ZP)({store:t,pageVisitSource:s.tY.LinkInPage});return(0,q.jsx)(B.Z,{style:this.props.style,innerStyle:{...oe},href:r,onClick:()=>{v.E3({collectionSettingsStore:n.settingsStore})},children:(0,q.jsx)(L.Z,{format:K.ZP.Format.Medium,blockId:e.value.id,isSingle:!0,shouldShrink:!0,parentStore:i})})}}}renderTextValue(e){if((0,l.R7)(e)&&void 0!==e.value){const t=(0,q.jsx)(H,{value:e.value});return"exact"===e.value.type?(0,q.jsx)(A.ZP,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?A.Z4.SlideUp:A.Z4.Popup,originGap:4,renderOrigin:e=>(0,q.jsx)(Z.Z,{style:{...z,...y.Z.textOverflowStyle,...this.props.style},disabled:this.props.disabled,...e,children:t})}):(0,q.jsx)("div",{style:z,children:t})}}}W.displayName="CollectionGroupValue";const G=(0,x.injectIntl)(W),z={overflow:"hidden",padding:3,borderRadius:4,fontWeight:y.Z.fontWeight.medium};function U(e){const{isHiddenGroup:t}=e;return t?(0,q.jsx)($,{...e,tooltipEvents:void 0}):(0,q.jsx)(N.ZP,{renderTooltip:()=>(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Any items with an empty <b>{name}</b> property will go here. This group cannot be removed.",values:{name:null,b:e=>(0,q.jsx)("span",{style:{fontWeight:y.Z.fontWeight.semibold},children:e})},id:"database.boardView.uncategorizedColumnTooltip"}),style:{width:240},textWrap:!0,render:t=>(0,q.jsx)($,{...e,tooltipEvents:t})})}function $(e){const t={display:"flex",alignItems:"center",fontSize:14,lineHeight:1.2,paddingLeft:2,paddingRight:4,whiteSpace:"nowrap",overflow:"hidden",fontWeight:y.Z.fontWeight.medium},{style:o,uncategorizedIconStyle:n,tooltipEvents:i,formattedLabelMessage:r}=e;return(0,q.jsxs)("div",{style:{...t,paddingLeft:0,...o},...i,children:[(0,g.R)({width:14,marginLeft:6,marginRight:6,...n}),(0,q.jsx)("span",{style:{...y.Z.textOverflowStyle},children:r})]})}function H(e){let{value:t}=e;return"other"===t.type?(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Other",id:"database.collectionGroupValue.textGroup.other"}):"alphabet_prefix"===t.type||"exact"===t.type?(0,q.jsx)(q.Fragment,{children:t.value}):void(0,f.t1)(t)}function Y(e){let{groupFormat:t,schema:o}=e;const n=o[t.property];if(!n||"status"!==n.type)return null;const i=t.value;if(i.type!==n.type)return null;const{value:r}=i;if(!r)return null;const s=n.options??[],l=n.groups??[];if("by_group"===r.type){const e=l.find((e=>e.name===r.group));return e?(0,q.jsx)(R.r_,{group:e,style:{fontWeight:500},showIcon:!0,showColor:!0}):null}if("by_option"===r.type){const e=(0,c.i7)(s,r.option),t=e&&l.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)}));return e?(0,q.jsx)("span",{style:{fontWeight:500,lineHeight:"normal",overflow:"hidden"},children:(0,q.jsx)(E.F,{format:d.lo.Medium,isSingle:!0,value:e.value,color:e.color,showRemoveButton:!1,groupColor:null==t?void 0:t.color})}):null}(0,f.t1)(r)}function Q(e){let{value:t}=e;window.__c={n:"DateGroupValue"};const o=(0,x.useIntl)();if("today"===t.type)return(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Today",id:"database.collectionGroupValue.dateGroup.today"});if("yesterday"===t.type)return(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Yesterday",id:"database.collectionGroupValue.dateGroup.yesterday"});if("last_7_days"===t.type)return(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Last 7 days",id:"database.collectionGroupValue.dateGroup.last7Days"});if("last_30_days"===t.type)return(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Last 30 days",id:"database.collectionGroupValue.dateGroup.last_30Days"});if("tomorrow"===t.type)return(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Tomorrow",id:"database.collectionGroupValue.dateGroup.tomorrow"});if("next_7_days"===t.type)return(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Next 7 days",id:"database.collectionGroupValue.dateGroup.next7Days"});if("next_30_days"===t.type)return(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Next 30 days",id:"database.collectionGroupValue.dateGroup.next30Days"});if("day"===t.type){const e=(0,u.NK)(t.range,(0,m.r)(),o.locale);return(0,q.jsx)(q.Fragment,{children:(0,p.ZW)(e.start,"medium")})}if("week"===t.type){const e=(0,u.NK)(t.range,(0,m.r)(),o.locale),n=(0,p.ZW)(e.start,"month_short"),i=(0,p.ZW)(e.start,"day"),r=e.start.year,s=(0,p.ZW)(e.end,"month_short"),l=(0,p.ZW)(e.end,"day"),a=e.end.year;return r!==a?(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Week of {startMonth} {startDay} {startYear} - {endMonth} {endDay} {endYear}",id:"database.collectionGroupValue.dateGroup.week.differingStartAndEndYear",values:{startMonth:n,startDay:i,endMonth:s,endDay:l,startYear:r,endYear:a}}):n!==s?(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Week of {startMonth} {startDay} - {endMonth} {endDay} {startYear}",id:"database.collectionGroupValue.dateGroup.week.differingStartAndEndMonth",values:{startMonth:n,startDay:i,endMonth:s,endDay:l,startYear:r}}):(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Week of {startMonth} {startDay}-{endDay} {startYear}",id:"database.collectionGroupValue.dateGroup.week.sameStartAndEndMonth",values:{startMonth:n,startDay:i,endDay:l,startYear:r}})}if("month"===t.type){const e=(0,u.NK)(t.range,(0,m.r)(),o.locale);return(0,q.jsx)(q.Fragment,{children:(0,p.ZW)(e.start,"month_year_short")})}if("year"===t.type){const e=(0,u.NK)(t.range,(0,m.r)(),o.locale);return(0,q.jsx)(q.Fragment,{children:e.start.year.toString()})}(0,f.t1)(t)}function X(e){let{value:t,format:o}=e;window.__c={n:"NumberGroupValue"};const n=(0,x.useIntl)();if("out_of_range"===t.type)return(0,q.jsx)(x.FormattedMessage,{defaultMessage:"Out of range",id:"database.collectionGroupValue.numberGroup.outOfRange"});if("range"===t.type){const e=h.uf(t.start,o,n),i=h.uf(t.end,o,n);return(0,q.jsx)(x.FormattedMessage,{defaultMessage:"{start} to {end}",id:"database.collectionGroupValue.numberGroup.range",values:{start:e,end:i}})}(0,f.t1)(t)}function J(e){let{groupValue:t,propertySchema:o,style:n}=e;window.__c={n:"CheckboxValue"};const r=(0,i.yK)((()=>({checkboxStyle:{display:"inline-flex",marginRight:6},wrapperStyle:{fontWeight:y.Z.fontWeight.medium,marginRight:3,display:"flex",alignItems:"center"}})),[]);return"checkbox"!==t.type?null:(0,q.jsxs)("div",{style:{...y.Z.textOverflowStyle,...r.wrapperStyle,...n},children:[(0,q.jsx)(V.Z,{checked:t.value,checkSize:10,size:14,disabled:!0,style:r.checkboxStyle}),(0,q.jsx)("span",{children:null==o?void 0:o.name})]})}function ee(e){let{groupValue:t,style:o}=e;return(0,l.Mc)(t)&&t.value?(0,q.jsx)("div",{style:{...oe,...y.Z.textOverflowStyle,...o},children:(0,q.jsx)(Q,{value:t.value})}):null}function te(e){let{groupValue:t,propertySchema:o,style:n}=e;if("number"!==t.type||!t.value)return null;const i=(null==o?void 0:o.number_format)||h.dk;return(0,q.jsx)("div",{style:{...oe,...n},children:(0,q.jsx)(X,{value:t.value,format:i})})}const oe={overflow:"hidden",padding:3,paddingRight:6,borderRadius:4,fontWeight:y.Z.fontWeight.medium}},71638:(e,t,o)=>{o.d(t,{Z:()=>x});var n=o(67294),i=o(83355),r=o(1302),s=o(86628),l=o(49085),a=o(72126),c=o(71644),d=o(75330),p=o(77080),u=o(28155),m=o(40107);function g(e){const{reducerId:t,localReducerResult:o,remoteReducerResult:n,collectionContextStore:i,reducer:r}=e,s=i.reducers.state,l=i.remoteResult.state;if(i.isClientModeEnabled.state)return o;if("aggregation"===r.type||"groups"===r.type){if(null!=l&&l.reducerResults[t])return l.reducerResults[t];return Boolean(l&&"reducer"===l.type&&a.sE(l.reducerResults,((e,t)=>{const o=s[t];return Boolean(o&&"results"===o.reducer.type&&!o.reducer.searchQuery&&"results"===e.type&&e.hasMore&&a.Xy(r.filter,o.reducer.filter))})))?o:n}if("results"===r.type){var c;const e=i.wasCreatedThisSession.state,r=Boolean(l&&"reducer"===l.type&&l.reducerResults[t]),s=(0,u.nx)(null===(c=i.collectionViewStore())||void 0===c?void 0:c.getCollectionSource());if((r||e)&&!s&&o&&"results"===o.type){return{...o,hasMore:n&&"results"===n.type?n.hasMore:o.hasMore}}return n}}var h=o(85893);class S extends i.Z{constructor(){super(...arguments),this.reducerId=this.props.id,this.instanceId=(0,c.ZP)(),this.localResultStoreChangeIsQueued=!1,this.storeTypes={resultStore:l.default.createClass(void 0)},this.handleLocalResultStoreChange=()=>{this.localResultStoreChangeIsQueued||(this.localResultStoreChangeIsQueued=!0,r.default.afterNextFlush(this.dequeueLocalResultStoreChange))},this.dequeueLocalResultStoreChange=()=>{const{resultStore:e}=this.stores;if(this.localResultStoreChangeIsQueued=!1,!this.componentIsMounted)return;const t=this.getCurrentResult();a.Xy(t,e.state)||e.setState(t)}}UNSAFE_willMount(e){const{collectionContextStore:t}=e;t.remoteResult.addListener(this.handleLocalResultStoreChange),t.localResultStore.addListener(this.handleLocalResultStoreChange),this.updateReducer(e),this.handleLocalResultStoreChange()}UNSAFE_willUpdate(e){this.updateReducer(e)}willUnmount(){super.willUnmount();const{collectionContextStore:e,groupsPointer:t}=this.props;d.$D({reducerId:this.reducerId,instanceId:this.instanceId,reducer:void 0,collectionContextStore:e,groupsPointer:t}),e.remoteResult.removeListener(this.handleLocalResultStoreChange),e.localResultStore.removeListener(this.handleLocalResultStoreChange)}renderComponent(){const{render:e}=this.props;if(e)return e(this.stores.resultStore)}updateReducer(e){const{reducer:t,collectionContextStore:o,groupsPointer:n}=e;d.$D({reducerId:this.reducerId,instanceId:this.instanceId,reducer:t,collectionContextStore:o,groupsPointer:n})}getCurrentResult(){const{reducer:e,collectionContextStore:t}=this.props,o=t.localResultStore.state,n=t.remoteResult.state,i=o&&"reducer"===o.type?o.reducerResults[this.reducerId]:void 0,r=n&&"reducer"===n.type?n.reducerResults[this.reducerId]:void 0;return g({reducerId:this.reducerId,localReducerResult:i,remoteReducerResult:r,reducer:e,collectionContextStore:t})}}function f(e){window.__c={n:"MigratedCollectionReducerRequest"};const{resultStore:t,render:o,...i}=e,c=function(e){const{id:t,reducer:o,collectionContextStore:i,groupsPointer:l}=e,c=(0,s.VK)((()=>l),[l],{useDeepEqual:!0}),p=(0,s.VK)((()=>o),[o],{useDeepEqual:!0}),u=(0,n.useRef)(!1),h=(0,m.S)(),[S,f]=(0,n.useReducer)(((e,t)=>a.Xy(e,t)?e:t),void 0),y=(0,n.useCallback)((()=>{const e=i.localResultStore.state,o=i.remoteResult.state,n=e&&"reducer"===e.type?e.reducerResults[t]:void 0,r=o&&"reducer"===o.type?o.reducerResults[t]:void 0;return g({reducerId:t,collectionContextStore:i,reducer:p,localReducerResult:n,remoteReducerResult:r})}),[i,p,t]),x=(0,n.useCallback)((()=>{u.current=!1,h()||f(y())}),[y,h]),v=(0,n.useCallback)((()=>{u.current||(u.current=!0,r.default.afterNextFlush(x))}),[x]);return(0,n.useEffect)((()=>(i.remoteResult.addListener(v),i.localResultStore.addListener(v),()=>{i.remoteResult.removeListener(v),i.localResultStore.removeListener(v)})),[i,v]),(0,n.useEffect)((()=>(d.$D({reducerId:t,instanceId:void 0,reducer:p,collectionContextStore:i,groupsPointer:c}),()=>{d.$D({reducerId:t,instanceId:void 0,reducer:void 0,collectionContextStore:i,groupsPointer:c})})),[i,c,p,t]),(0,n.useEffect)((()=>{v()}),[]),S}(i),p=(0,s.qz)(t,l.default.createClass(void 0));(0,n.useEffect)((()=>{p.setState(c)}),[c,p]);const u=(0,s.VK)((()=>o?o(p):null),[o,p]);return(0,h.jsx)(h.Fragment,{children:u})}S.displayName="CollectionReducerRequest";const y=n.memo(f);const x=function(e){window.__c={n:"CollectionReducerRequest"};const t=(0,s.VK)((()=>p.default.checkGate("use_collection_reducer_request_hook")),[]),[o]=(0,n.useState)(t);return o?(0,h.jsx)(y,{...e}):(0,h.jsx)(S,{...e})}},5233:(e,t,o)=>{o.d(t,{Z:()=>Y});var n=o(67294),i=o(480),r=o(86628),s=o(24405),l=o(64275),a=o(26139),c=o(9291),d=o(12714),p=o(77907),u=o(30806),m=o(94841),g=o(5933),h=o(42922),S=o(64921),f=o(32662),y=o(41892),x=o(8848),v=o(65422),C=o(5257),b=o(49019),w=o(56666),j=o(62208),_=o(52821),M=o(55797),I=o(73063),P=o(74420),k=o(89728),T=o(95691),F=o(85893);const R="32%",Z="60%",A="cubic-bezier(0.4, 0, 0.07, 1)",V="45%",B="60%",O="75%",D=(0,c.defineMessages)({filter:{defaultMessage:"Filter",id:"collectionTasksEmptyStateDiagram.action.filter.title"},sort:{defaultMessage:"Sort",id:"collectionTasksEmptyStateDiagram.action.sort.title"},automation:{defaultMessage:"Automations",id:"collectionTasksEmptyStateDiagram.action.automations.title"},search:{defaultMessage:"Search",id:"collectionTasksEmptyStateDiagram.action.search.title"},more:{defaultMessage:"More",id:"collectionTasksEmptyStateDiagram.action.more.title"},new:{defaultMessage:"New",id:"collectionTasksEmptyStateDiagram.action.new.title"},viewOptions:{defaultMessage:"View options",id:"collectionTasksEmptyStateDiagram.settings.title"},turnInto:{defaultMessage:"Turn into task database",id:"collectionTasksEmptyStateDiagram.settings.turnInto.title"},showTasks:{defaultMessage:"Show tasks assigned to you in Home and get status notifications",id:"collectionTasksEmptyStateDiagram.settings.turnInto.caption"}});function N(){window.__c={n:"CollectionTasksEmptyStateDiagram"};const e=(0,s.Fg)(),t=(0,c.useIntl)(),o=n.useRef(null),i=n.useRef(null),r=n.useRef(null),l=n.useRef(null),a=n.useRef({cursor:o,more:i,settings:r,turn:l}),d=n.useMemo((()=>[{cursor:{keyframes:[{transform:"translate(0, 0)"}],options:{duration:600,delay:200,fill:"forwards",ease:A}},more:{keyframes:[{background:"none"}],options:{duration:1,fill:"forwards"}},settings:{keyframes:[{right:"-50%",display:"none"}],options:{duration:1,fill:"forwards"}},turn:{keyframes:[{outline:`2px solid ${x.ZP.blueWithAlpha(0)}`,borderRadius:0}],options:{duration:1,fill:"forwards"}}},{cursor:{keyframes:[{transform:"scale(1)"},{transform:"scale(0.8)"},{transform:"scale(1)"}],options:{duration:200,fill:"forwards"}},more:{keyframes:[{background:e.whiteButtonHoveredBackground}],options:{duration:100,fill:"forwards"}},settings:{keyframes:[{right:0,display:"block"}],options:{duration:800,fill:"forwards",easing:A}}},{cursor:{keyframes:[{}],options:{duration:1,delay:600,fill:"forwards"}}},{cursor:{keyframes:[{transform:"translate(100%, 500%)"}],options:{duration:600,fill:"forwards",easing:A}},turn:{keyframes:[{outline:`2px solid ${x.ZP.blueWithAlpha(0)}`},{outline:`2px solid ${x.ZP.blueWithAlpha(.3)}`,borderRadius:"4px"}],options:{duration:400,delay:200,fill:"forwards",easing:A}}},{cursor:{keyframes:[{}],options:{duration:1,delay:2400}}}]),[e.whiteButtonHoveredBackground]),p=n.useCallback((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>=d.length)return void p();const t=d[e];let o=null;for(const n in t){const e=t[n],i=a.current[n].current;if(!e||!i)return;const r=i.animate(e.keyframes,e.options);"cursor"===n&&(o=r)}o&&(o.onfinish=()=>p(e+1))}),[d]);return n.useEffect((()=>{p()}),[p]),(0,F.jsx)(M.Z,{ratio:7/16,children:(0,F.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:4,display:"flex",flexDirection:"row",overflow:"hidden"},children:[(0,F.jsx)("img",{ref:o,className:"notion-diagram-cursor",style:{position:"absolute",width:"4%",top:"18%",left:"85%",zIndex:1},src:y.Z.images.icons.cursorPointerPng}),(0,F.jsx)(K,{}),(0,F.jsxs)("div",{style:{flexGrow:1,height:"100%",display:"flex",flexDirection:"column",paddingTop:40,paddingLeft:40,paddingRight:40},children:[(0,F.jsx)(L,{ref:i}),(0,F.jsxs)("div",{style:{flexGrow:1,display:"flex",flexDirection:"column",padding:"16px 0px",position:"relative"},children:[(0,F.jsxs)("div",{ref:r,style:{width:"50%",height:"100%",position:"absolute",top:0,right:"-50%",display:"none",padding:12,background:e.cardContentBackground,borderLeft:`1px solid ${e.tableDividerColor}`,fontSize:12},children:[(0,F.jsx)("div",{style:{fontWeight:500,marginBottom:4},children:t.formatMessage(D.viewOptions)}),(0,F.jsx)(H,{barWidth:O}),(0,F.jsx)(H,{barWidth:V}),(0,F.jsx)(H,{barWidth:B}),(0,F.jsxs)(S.Z,{ref:l,disabled:!0,style:{width:"calc(100% + 24px)",height:72,position:"relative",left:-12,display:"flex",flexDirection:"row",alignItems:"top",borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,margin:"8px 0px",padding:8,outline:`2px solid ${x.ZP.blueWithAlpha(0)}`},children:[(0,j.z)({width:16,height:16,marginRight:8}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[t.formatMessage(D.turnInto),(0,F.jsx)(P.Z,{})]}),(0,F.jsx)("div",{style:{marginTop:4,fontSize:10,color:e.lightTextColor},children:t.formatMessage(D.showTasks)})]}),(0,C.o)({width:14,height:14,fill:e.lightIconColor,alignSelf:"center",marginLeft:8})]}),(0,F.jsx)(H,{barWidth:B}),(0,F.jsx)(H,{barWidth:V}),(0,F.jsx)(H,{barWidth:B})]}),(0,F.jsx)(G,{})]})]})]})})}function K(){window.__c={n:"SidebarLoadingSkeleton"};const e=(0,s.Fg)();return(0,F.jsxs)("div",{style:{width:"20%",height:"100%",background:"dark"===e.mode?e.floatingSidebarBackground:e.sidebarBackground,boxShadow:e.sidebarBoxShadow,padding:10},children:[(0,F.jsx)($,{barWidth:V}),(0,F.jsx)("div",{style:{width:"100%",height:16}}),(0,F.jsx)($,{barWidth:V}),(0,F.jsx)($,{barWidth:B}),(0,F.jsx)($,{barWidth:V}),(0,F.jsx)($,{barWidth:O}),(0,F.jsx)($,{barWidth:B}),(0,F.jsx)("div",{style:{width:"100%",height:24}}),(0,F.jsx)(U,{barWidth:B}),(0,F.jsx)("div",{style:{width:"100%",height:8}}),(0,F.jsx)($,{barWidth:O}),(0,F.jsx)($,{barWidth:B}),(0,F.jsx)($,{barWidth:B}),(0,F.jsx)($,{barWidth:O}),(0,F.jsx)($,{barWidth:B})]})}const L=n.forwardRef(((e,t)=>{window.__c={n:"ViewBar"};const o=(0,c.useIntl)(),n=(0,s.Fg)();return(0,F.jsxs)("div",{style:{width:"100%",height:32,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:`1px solid ${n.tableDividerColor}`,fontSize:12},children:[(0,F.jsxs)("div",{style:{height:"100%",display:"flex"},children:[(0,F.jsx)(E,{viewType:"gallery",selected:!0}),(0,F.jsx)(E,{viewType:"table"})]}),(0,F.jsxs)("div",{style:{height:24,display:"flex",alignItems:"center",color:n.lightTextColor,paddingBottom:4},children:[(0,F.jsx)(q,{type:"filter"}),(0,F.jsx)(q,{type:"sort"}),(0,F.jsx)(W,{type:"automation"}),(0,F.jsx)(W,{type:"search"}),(0,F.jsx)(W,{type:"more",ref:t}),(0,F.jsx)(f.Z,{size:6}),(0,F.jsx)(T.Z,{disabled:!0,style:{height:"inherit"},title:o.formatMessage(D.new),color:"blue"})]})]})}));function E(e){window.__c={n:"Tab"};const t=(0,s.Fg)(),o=_.Bh[e.viewType],n=_.aW[e.viewType]({width:14,height:14,fill:e.selected?void 0:t.lightTextColor});return(0,F.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",position:"relative",top:1,height:"100%",fontWeight:500,paddingLeft:6,paddingRight:8,paddingBottom:2,borderBottom:`2px solid ${e.selected?t.regularTextColor:"transparent"}`,color:e.selected?void 0:t.lightTextColor},children:[n,(0,F.jsx)(f.Z,{size:6}),o]})}function q(e){window.__c={n:"ActionText"};const t=(0,c.useIntl)();return(0,F.jsx)(k.Z,{disabled:!0,style:{height:"inherit",color:"inherit",fontSize:"inherit",padding:"0px 6px"},children:t.formatMessage(D[e.type])})}const W=n.forwardRef(((e,t)=>{window.__c={n:"ActionIcon"};const o=(0,c.useIntl)(),n=(0,s.Fg)(),i={automation:v.K,search:b.e,more:w.o};return(0,F.jsx)(I.Z,{ref:t,disabled:!0,disabledFeedback:!1,ariaLabel:o.formatMessage(D[e.type]),style:{height:"inherit",color:"inherit",fontSize:"inherit",padding:"0px 6px"},icon:i[e.type],iconStyle:{fill:n.lightTextColor,width:12}})}));function G(){return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(U,{barWidth:"20%"}),(0,F.jsx)("div",{style:{width:"100%",height:10}}),(0,F.jsxs)("div",{style:{flexGrow:1,display:"flex",justifyContent:"space-between"},children:[(0,F.jsx)(z,{width:R,height:Z}),(0,F.jsx)(z,{width:R,height:Z}),(0,F.jsx)(z,{width:R,height:Z})]})]})}function z(e){window.__c={n:"LoadingBox"};const t=(0,s.Fg)();return(0,F.jsx)("div",{style:{width:e.width,height:e.height,background:t.cardHoveredBackground,borderRadius:4}})}function U(e){window.__c={n:"LoadingBar"};const t=(0,s.Fg)();return(0,F.jsx)("div",{style:{width:e.barWidth,height:8,background:t.cardHoveredBackground,borderRadius:10}})}function $(e){return(0,F.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",paddingTop:4,paddingBottom:4},children:[(0,F.jsx)(z,{width:16,height:16}),(0,F.jsx)(f.Z,{size:6}),(0,F.jsx)(U,{barWidth:e.barWidth})]})}function H(e){return(0,F.jsx)("div",{style:{width:"100%",padding:"6px 0px"},children:(0,F.jsx)(U,{barWidth:e.barWidth})})}function Y(e){window.__c={n:"CollectionTasksEmptyStateModal"};const t=(0,i.O7)(),o=(0,r.VK)((()=>g.Z.state),[]);return(0,F.jsx)(p.LazyAnnouncementModal,{shouldShow:o&&!t.device.isPhone,calloutId:"tasks_migration_empty_modal",desktopInnerStyle:{width:768,padding:32},desktopOnDismiss:()=>{(0,u.SJ)({environment:t,from:e.from}),g.Z.setState(!1)},desktopRenderInner:()=>(0,F.jsx)(Q,{isPhone:!1,from:e.from}),phoneRenderInner:()=>(0,F.jsx)(Q,{isPhone:!0,from:e.from})})}function Q(e){window.__c={n:"ModalInner"};const t=(0,i.O7)(),o=(0,s.yK)((t=>({container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:e.isPhone?"90%":void 0,height:e.isPhone?"100%":void 0},header:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1},closeButton:{width:22,height:22,position:"absolute",top:16,right:16,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},closeIcon:{width:16,height:16,fill:t.lightIconColor},headerText:{fontSize:e.isPhone?16:20,fontWeight:500,color:t.regularTextColor,margin:0,textAlign:"center"},subheaderText:{width:e.isPhone?"100%":"75%",fontSize:14,fontWeight:400,color:t.lightTextColor,margin:0,textAlign:"center"},footer:{width:"100%",display:"flex",flexDirection:"row",justifyContent:"space-between"},learnMoreButton:{display:"flex",flexDirection:"row",alignItems:"center",fontSize:14,color:t.lightTextColor,padding:4,borderRadius:4},learnMoreIcon:{width:18,height:18,fill:t.lightTextColor},gotItButton:{width:e.isPhone?"100%":void 0,height:36}})),[e.isPhone]);return(0,F.jsxs)("div",{style:o.container,children:[(0,F.jsxs)("div",{style:o.header,children:[e.isPhone?null:(0,F.jsx)(S.Z,{hovered:!0,style:o.closeButton,onClick:()=>{(0,u.SJ)({environment:t,from:e.from}),g.Z.setState(!1)},children:(0,l.D)(o.closeIcon)}),(0,F.jsx)("h1",{style:o.headerText,children:(0,F.jsx)(c.FormattedMessage,{id:"tasksEmptyState.modal.headerText",defaultMessage:"Which databases do you use to track tasks?"})}),(0,F.jsx)(f.Z,{size:8}),(0,F.jsx)("h2",{style:o.subheaderText,children:(0,F.jsx)(c.FormattedMessage,{id:"tasksEmptyState.modal.subheaderText",defaultMessage:"Go to your database, and follow the simple steps to turn it into a task database. Once this is done, you and your team will see assigned tasks in Home."})}),(0,F.jsx)(f.Z,{size:24}),(0,F.jsx)(N,{}),(0,F.jsx)(f.Z,{size:24})]}),(0,F.jsxs)("div",{style:o.footer,children:[e.isPhone?null:(0,F.jsxs)(S.Z,{style:o.learnMoreButton,onClick:e=>{e.preventDefault(),d.D({environment:t,url:m.h5,targetSelf:!1})},children:[(0,F.jsx)(c.FormattedMessage,{id:"tasksEmptyState.modal.learnAbout",defaultMessage:"Learn about tasks"}),(0,F.jsx)(f.Z,{size:2}),(0,a.K)(o.learnMoreIcon)]}),(0,F.jsx)(h.Z,{style:o.gotItButton,onClick:()=>{(0,u.SJ)({environment:t,from:e.from}),g.Z.setState(!1)},children:(0,F.jsx)(c.FormattedMessage,{id:"tasksEmptyState.modal.gotIt",defaultMessage:"Got it"})})]})]})}},86765:(e,t,o)=>{o.d(t,{Z:()=>p});o(67294);var n=o(480),i=o(86628),r=o(24405),s=o(9291),l=o(1018),a=o(31278),c=o(76798),d=o(85893);const p=(0,s.injectIntl)((function(e){window.__c={n:"RelationCreateItemText"};const{title:t,targetCollectionStore:o}=e,p=(0,n.Fy)(),u=(0,i.VK)((()=>o.getIcon()),[o]),m=(0,r.yK)((e=>({medium:{color:e.mediumTextColor},dbName:{display:"flex",alignItems:"center",marginLeft:4},title:{marginLeft:l.Qi*(p.isRetina?.5:1)}})),[p.isRetina]),g=t?(0,d.jsxs)("span",{children:[" ",t," "]}):(0,d.jsx)("span",{children:" "}),h=(0,d.jsxs)("div",{style:m.dbName,children:[(0,d.jsx)(a.Z,{disabled:!0,icon:u,isEmptyPage:!1,size:p.isMobile?24:20}),(0,d.jsx)(c.Z,{store:o,style:m.title})]});return(0,d.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,d.jsx)(s.FormattedMessage,{id:"database.searchRelation.createNewPageFooter",defaultMessage:"<medium>New</medium> {pageName} <medium> in</medium> {databaseNameWithIcon}",values:{medium:e=>(0,d.jsx)("span",{style:m.medium,children:e}),pageName:g,databaseNameWithIcon:h}})})}))},97680:(e,t,o)=>{o.d(t,{Z:()=>h});var n=o(67294),i=o(480),r=o(66897),s=o(97880),l=o(9291),a=o(98742),c=o(4023),d=o(52275),p=o(26388),u=o(70301),m=o(45653),g=o(85893);const h=n.forwardRef(((e,t)=>{window.__c={n:"UserMenuItem"};const{actor:o,userTitle:n,useEmailAsTooltip:h,tooltip:S,tooltipPlacement:f}=e,y=(0,i.O7)(),x=(0,l.useIntl)(),v=o.asActor&&o.isUser()?o.email:void 0,C=h&&v?v:S,b=y.device.isMobile?24:20;let w;return(0,r.YU)(o)?w=(0,g.jsx)(u.Z,{botValue:null==o?void 0:o.asActor,size:b}):(0,r.$S)(o)?w=(0,g.jsx)(m.Z,{userValue:null==o?void 0:o.asActor,size:b}):(0,r.Iq)(o)?w=(0,g.jsx)(m.Z,{userValue:void 0,size:b}):(0,s.t1)(o),(0,g.jsx)(p.ZP,{ref:t,placement:f??c.u.Bottom,alignment:c.v.Start,textWrap:!0,render:t=>(0,g.jsx)(d.Z,{...(0,a.Z)(t,e),icon:w,title:n??(0,r.$4)(x,o),className:"notranslate"}),disableTooltip:!C,renderTooltip:()=>C})}))},30905:(e,t,o)=>{o.d(t,{TB:()=>b,Xh:()=>x,Y7:()=>C,ZP:()=>v,qQ:()=>y});var n=o(67294),i=o(86628),r=o(24405),s=o(6695),l=o(20669),a=o(38737),c=o(3791),d=o(9291),p=o(44866),u=o(94166),m=o(14976),g=o(88280),h=o(91839),S=o(26388),f=o(85893);function y(e){let{collectionStore:t,propertySchema:o}=e;window.__c={n:"AiAutofillFillAllPagesTooltip"};const n=(0,i.VK)((()=>(0,m.Xh)(t.getName(),t)),[t]),r=(0,i.VK)((()=>{var e;const t=(null===(e=g.subscriptionDataStoreInstance.state)||void 0===e?void 0:e.addOns)??[];return(0,c.de)(t)}),[]);return(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(0,f.jsx)(d.FormattedMessage,{...p.fillAllPagesMessages.fillAllPagesTooltip,values:{hasNames:Boolean(n)&&Boolean(o.name),collectionName:n,propertyName:o.name}})}),!r&&(0,f.jsx)("div",{style:{color:"#ACABA9",fontWeight:500},children:(0,f.jsx)(d.FormattedMessage,{...p.fillAllPagesMessages.fillAllPagesAddOnMessage})})]})}function x(e){let{updateAiInferencesTaskStatus:t,iconStyle:o,progressIconStyle:n}=e;window.__c={n:"AiAutofillFillAllPagesButtonIcon"};const i=(0,r.Fg)();return t.isRunning?(0,f.jsx)("div",{style:n,children:(0,f.jsx)(h.Z,{})}):(0,l.y)({width:14,color:i.accentColors.purple[400],...o})}function v(e){let{updateAiInferencesTaskStatus:t,style:o}=e;window.__c={n:"AiAutofillFillAllPagesButtonInner"};const n=(0,d.useIntl)();return(0,f.jsx)("div",{style:o,children:t.isRunning?(0,f.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:void 0===t.numPagesFilled||void 0===t.numPagesRequested?(0,f.jsx)(d.FormattedMessage,{defaultMessage:"Autofilling all pages",id:"aiAutofill.fillallPages.updatingAllPages"}):(0,f.jsx)(d.FormattedMessage,{defaultMessage:"{numPagesRequested, plural, one {Autofilling {numPagesFilled} of {numPagesRequested} page} other {Updating {numPagesFilled} of {numPagesRequested} pages}}",id:"aiAutofill.fillallPages.updatingAllPagesWithProgress",values:{numPagesFilled:(0,a.uf)(t.numPagesFilled,"compact",n),numPagesRequested:(0,a.uf)(t.numPagesRequested,"compact",n)}})}):(0,f.jsx)(d.FormattedMessage,{defaultMessage:"Autofill all pages",id:"aiAutofill.fillAllPages.buttonTitle"})})}function C(e){let{updateAiInferencesTaskStatus:t}=e;window.__c={n:"AiAutofillFillAllPagesButtonCaption"};const{numPagesFilled:o,numPagesRequested:n}={numPagesFilled:void 0,numPagesRequested:void 0,...t},i=(0,r.yK)((e=>({inner:{background:e.accentColors.purple[400],height:"100%",transition:"width .5s"},outer:{background:e.accentColors.gray[100],height:3,borderRadius:2,minWidth:120,overflow:"hidden",marginTop:8}})),[]);return void 0===o||void 0===n?null:(0,f.jsx)("div",{style:i.outer,role:"progressbar",children:(0,f.jsx)("div",{style:{...i.inner,width:100*Math.min(o/n,1)+"%"}})})}function b(e){window.__c={n:"AiAutofillFillAllPagesMenuItem"};const{environment:t,collectionContextStore:o,collectionStore:r,property:l,propertySchema:a,doesUserHaveAIAddOn:c,isAutofillSetupEnabled:d}=e,m=(0,i.VK)((()=>{const e=o.collectionStore();return e?(0,s.De)(e.getFormat(),l):{isRunning:!1,numPagesFilled:void 0,numPagesRequested:void 0}}),[o,l]),g=(0,n.useCallback)((async()=>{const e=o.collectionStore();e&&a&&await p.autofillPropertyForCollection({environment:t,collectionStore:e,propertySchema:a,property:l})}),[t,a,l,o]);return(0,f.jsx)(S.ZP,{disableTooltip:c,renderTooltip:()=>(0,f.jsx)(y,{collectionStore:r,propertySchema:a}),render:e=>(0,f.jsx)(u.Z,{icon:e=>(0,f.jsx)(x,{updateAiInferencesTaskStatus:m,iconStyle:e,progressIconStyle:{marginTop:4,marginLeft:4,marginRight:2}}),title:(0,f.jsx)(v,{updateAiInferencesTaskStatus:m}),caption:void 0!==m.numPagesFilled&&void 0!==m.numPagesRequested&&(0,f.jsx)(C,{updateAiInferencesTaskStatus:m}),focused:!1,onClick:g,disabled:m.isRunning||!d,...e})})}},91965:(e,t,o)=>{o.d(t,{Z:()=>p});var n=o(67294),i=o(4615),r=o(9291),s=o(94166),l=o(24006),a=o(26388),c=o(85893);function d(e){let{setAiInference:t,aiInference:o,disabled:d}=e;window.__c={n:"CollectionSettingsAiAutofillAddOptionsToggle"};const p=(0,n.useRef)((0,i.ZP)()),u=()=>{if(!o)return;const e={...o,add_options:!o.add_options};t(e)};return(0,c.jsx)(a.ZP,{renderTooltip:()=>(0,c.jsx)(r.FormattedMessage,{id:"collectionSettingsAiAutofillAddOptionsToggle.title.description",defaultMessage:"New options are created based on property name & page details"}),placement:a.ug.Bottom,render:e=>(0,c.jsx)(s.Z,{title:(0,c.jsx)(r.FormattedMessage,{id:"collectionSettingsAiAutofillAddOptionsToggle.title.text",defaultMessage:"Generate new options"}),showChevron:!1,right:(0,c.jsx)(l.Z,{inputId:p.current,on:!(null==o||!o.add_options),onClick:u,disabled:!1,noColor:!1}),onClick:u,disabled:Boolean(d),textWrapperStyle:{minWidth:"auto"},...e})})}const p=n.memo(d)},43350:(e,t,o)=>{o.d(t,{Z:()=>r});o(67294);var n=o(65742);o(57658);var i=o(85893);function r(e){const{startPoint:t,endPoint:o,style:r,showArrowHead:a,useRightAngles:c,cornerRadiusOverride:d,handleMouseMove:p,handleMouseLeave:u}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l,{startPoint:t,startCurvePoint:c?void 0:{x:t.x+n.i2,y:t.y},endPoint:a?{x:o.x-1.5,y:o.y}:o,endCurvePoint:c?void 0:{x:o.x-n.i2,y:o.y},cornerRadiusOverride:d,style:r,handleMouseMove:p,handleMouseLeave:u,children:e.children}),a&&(0,i.jsx)(s,{endPoint:o,style:r})]})}function s(e){const{endPoint:t,style:o}=e;return(0,i.jsx)("polyline",{points:`${t.x-5},${t.y-6} ${t.x},${t.y} ${t.x-5},${t.y+6}`,style:o,fill:"transparent"})}function l(e){const{startPoint:t,startCurvePoint:o,endPoint:n,endCurvePoint:r,style:s,cornerRadiusOverride:l,handleMouseMove:a,handleMouseLeave:c}=e;let d="";d=o&&r?`M ${t.x} ${t.y} L ${o.x} ${o.y} L ${r.x} ${r.y} L ${n.x} ${n.y}`:`M ${t.x} ${t.y} L ${t.x} ${n.y} L ${n.x} ${n.y}`;const p=function(e,t){function o(e,t,o){const i=t.x-e.x,r=t.y-e.y,s=Math.sqrt(i*i+r*r);return n(e,t,Math.min(1,o/s))}function n(e,t,o){return{x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}}function i(e,t){e.length>2&&(e[e.length-2]=t.x.toString(),e[e.length-1]=t.y.toString())}function r(e){return{x:parseFloat(e[e.length-2]),y:parseFloat(e[e.length-1])}}const s=e.split(/[,\s]/).reduce(((e,t)=>{const o=t.match("([a-zA-Z])(.+)");return o?(e.push(o[1]),e.push(o[2])):e.push(t),e}),[]).reduce((function(e,t){return!isNaN(parseFloat(t))&&e.length?e[e.length-1].push(t):e.push([t]),e}),[]);let l=[];if(s.length>1){const e=r(s[0]);let a=null;"Z"===s[s.length-1][0]&&s[0].length>2&&(a=["L",e.x.toString(),e.y.toString()],s[s.length-1]=a),l.push(s[0]);for(let c=1;c<s.length;c++){const e=l[l.length-1],d=s[c],p=d===a?s[1]:s[c+1];if(p&&e&&e.length>2&&"L"===d[0]&&p.length>2&&"L"===p[0]){const s=r(e),a=r(d),c=r(p),u=o(a,s,t),m=o(a,c,t);i(d,u),l.push(d);const g=n(u,a,.5),h=n(a,m,.5),S=["C",g.x.toString(),g.y.toString(),h.x.toString(),h.y.toString(),m.x.toString(),m.y.toString()];l.push(S)}else l.push(d)}if(a){const e=r(l[l.length-1]);l.push(["Z"]),i(l[0],e)}}else l=s;return l.reduce((function(e,t){return`${e}${t.join(" ")} `}),"")}(d,l||16);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:p,style:s,fill:"transparent"}),(a||c)&&(0,i.jsxs)("g",{onMouseMove:a,onMouseLeave:c,children:[(0,i.jsx)("path",{d:p,style:{strokeOpacity:0,strokeWidth:16,pointerEvents:"stroke",cursor:"default"},fill:"transparent"}),e.children]})]})}},65089:(e,t,o)=>{o.d(t,{FF:()=>s,Yy:()=>a,bZ:()=>l});o(67294);var n=o(9291),i=o(88492),r=o(85893);function s(e){let{origin:t}=e;return(0,r.jsx)(i.r,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"current-sprint-view-tooltip",header:(0,r.jsx)(n.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.header",defaultMessage:"Manage the current sprint"}),content:(0,r.jsx)(n.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.content",defaultMessage:"Add tasks and update task status as your team makes progress during the sprint."})})}function l(e){let{origin:t}=e;return(0,r.jsx)(i.r,{origin:t,placementToOrigin:"bottom",tutorialId:"sprints-onboarding",tutorialStepId:"sprint-task-tooltip",header:(0,r.jsx)(n.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.header",defaultMessage:"Change tasks status"}),content:(0,r.jsx)(n.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.content",defaultMessage:'Drag this task to "In progress".'})})}function a(e){let{origin:t}=e;return(0,r.jsx)(i.r,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"complete-sprint-button-tooltip",header:(0,r.jsx)(n.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.header",defaultMessage:"Complete this sprint"}),content:(0,r.jsx)(n.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.content",defaultMessage:"Click the button when you're done with this sprint."})})}},96787:(e,t,o)=>{o.d(t,{Z:()=>St});var n=o(67294),i=o(86628),r=o(77080),s=o(480),l=o(24405),a=o(82990),c=o(9291),d=o(50906),p=o(27370),u=o(75079),m=o(64856),g=o(80444),h=o(65089),S=(o(21703),o(63123)),f=o(49085),y=o(15145),x=o(92996),v=o(99036),C=o(2607),b=o(35102),w=o(4615),j=o(96367),_=o(6287),M=o(70203),I=o(97880);const P=(0,c.defineMessages)({nextSprintName:{id:"structuredAutomations.createNextSprint.nextSprintName",defaultMessage:"Sprint"}});function k(e){const{createNextSprintActionId:t,sprintCollectionPointer:o,sprintStatusNextOptionName:n,intl:i,spaceId:r,getCurrentSprintActionId:s,sprintStatusPropertyId:l,sprintUniqueIdPropertyId:a}=e;return{id:t,type:"create_page",config:{values:{title:{value:{type:"formula",value:D({actionId:s,sprintCollectionPointer:o,sprintUniqueIdPropertyId:a,incrementBy:1,intl:i})},action:"replace"},[l]:{value:{type:"simple",value:[[`"${n}"`]]},action:"replace"}},properties:["title",l],collection:o},space_id:r}}function T(e){const{getCurrentSprintActionId:t,sprintCollectionPointer:o,sprintCollectionSchema:n,spaceId:i}=e;return{id:t,type:"query_collection",config:{filter:j.qB[x.p$].current.reducer.getCombinatorFilter(n),collection:o},space_id:i}}function F(e){const{getLargestUniqueIdSprintActionId:t,sprintCollectionPointer:o,sprintUniqueIdPropertyId:n,spaceId:i}=e;return{id:t,type:"query_collection",config:{filter:void 0,collection:o,sort:[{property:n,direction:"descending"}],limit:1},space_id:i}}function R(e){const{createFutureSprintActionId:t,sprintCollectionPointer:o,sprintStatusFutureOptionName:n,intl:i,spaceId:r,getLargestUniqueIdSprintActionId:s,sprintStatusPropertyId:l,sprintUniqueIdPropertyId:a,incrementBy:c}=e;return{id:t,type:"create_page",config:{values:{title:{value:{type:"formula",value:D({actionId:s,sprintCollectionPointer:o,sprintUniqueIdPropertyId:a,intl:i,incrementBy:c})},action:"replace"},[l]:{value:{type:"simple",value:[[`"${n}"`]]},action:"replace"}},properties:["title",l],collection:o},space_id:r}}function Z(e){const{updateFutureSprintToNextActionId:t,sprintCollectionPointer:o,sprintStatusNextOptionName:n,sprintStatusFutureOptionName:i,spaceId:r,sprintStatusPropertyId:s,sprintUniqueIdPropertyId:l}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:o,filter:{operator:"and",filters:[{property:s,filter:{operator:"status_is",value:{type:"is_option",value:i}}}]},sort:[{property:l,direction:"ascending"}],limit:1},values:{[s]:{value:{type:"simple",value:[[`"${n}"`]]},action:"replace"}},properties:[s]},space_id:r}}function A(e){const{moveIncompleteTasksActionId:t,createNextSprintActionId:o,taskCollectionPointer:n,taskStatusCompleteGroupName:i,spaceId:r,nextSprintInput:s,taskStatusPropertyId:l,taskSprintRelationPropertyId:a}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:n,filter:{operator:"and",filters:[{property:l,filter:{operator:"status_is_not",value:{type:"is_group",value:i}}},{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:"current"}}},property:a}]}},properties:[a],values:{[a]:{value:{type:"simple",value:"pointer"===s.type?C.b.mentionPage(s.pointer).build():C.b.mentionFormulaContextVariable({id:(0,b.Kd)({source:"action",action_id:o,action_output_type:"page"})}).build()},action:"replace"}}},space_id:r}}function V(e){const{moveIncompleteTasksToBacklogActionId:t,taskCollectionPointer:o,taskStatusCompleteGroupName:n,spaceId:i,taskStatusPropertyId:r,taskSprintRelationPropertyId:s}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:o,filter:{operator:"and",filters:[{property:r,filter:{operator:"status_is_not",value:{type:"is_group",value:n}}},{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:"current"}}},property:s}]}},properties:[s],values:{[s]:{value:void 0,action:"remove"}}},space_id:i}}function B(e){const{updateCurrentSprintToPastActionId:t,getCurrentSprintActionId:o,sprintStatusPastOptionName:n,spaceId:i,sprintStatusPropertyId:r}=e;return{id:t,type:"update_pages",config:{target:{id:(0,b.Kd)({source:"action",action_id:o,action_output_type:"pages"}),type:"variable"},values:{[r]:{value:{type:"simple",value:[[`"${n}"`]]},action:"replace"}},properties:[r]},space_id:i}}function O(e){const{updateNextSprintToCurrentActionId:t,createNextSprintActionId:o,sprintStatusCurrentOptionName:n,spaceId:i,nextSprintInput:r,nextSprintDateRange:s,sprintStatusPropertyId:l,sprintDatePropertyId:a}=e;return{id:t,type:"update_pages",config:{target:"pointer"===r.type?{type:"page",page:r.pointer}:{id:(0,b.Kd)({source:"action",action_id:o,action_output_type:"page"}),type:"variable"},values:{[l]:{value:{type:"simple",value:[[`"${n}"`]]},action:"replace"},[a]:{value:{type:"simple",value:[(0,M.YCD)(["d",s])]},action:"replace"}},properties:[l,a]},space_id:i}}function D(e){const{actionId:t,sprintCollectionPointer:o,sprintUniqueIdPropertyId:n,incrementBy:i,intl:r}=e;return C.b.concat([C.b.text(`"${r.formatMessage(P.nextSprintName)}" + " " + format(`),C.b.mentionFormulaContextVariable({id:(0,b.Kd)({source:"action",action_id:t,action_output_type:"pages"})}),C.b.text(".first()."),C.b.mentionFormulaPagePropertyVariable({collection:o,property:n}),C.b.text('.split("-").at(-1).toNumber()'),C.b.text(`+${i})`)]).build()}var N=o(8848),K=o(84619),L=o(40506),E=o(7057),q=o(36591),W=o(42853),G=o(13148),z=o(47453),U=o(53523),$=o(606),H=o(149),Y=o(21202),Q=o(94438),X=o(63143),J=o(75754),ee=o(36821),te=o(47043),oe=o(87279),ne=o(37034),ie=o(29376),re=o(58484),se=o(68373),le=o(97039),ae=o(78030),ce=o(42922),de=o(52275),pe=o(31945),ue=o(73063),me=o(36596),ge=o(78140),he=o(32163),Se=o(40721),fe=o(89728),ye=o(31278),xe=o(76798),ve=o(72495),Ce=o(83264),be=o(50506),we=o(53437),je=o(85893);function _e(e){window.__c={n:"DefaultPopupOrModalFunctional"};const{isOpen:t,onDismiss:o,render:n,origin:i,style:r,innerStyle:l,ariaLabel:a,ariaLabelledBy:c}=e,{isMobile:d}=(0,s.Fy)();return d?(0,je.jsx)(we.ZP,{ariaLabel:a,ariaLabelledBy:c,open:t,popupType:we.ZP.PopupType.SlideUp,origin:i,onDismiss:o,render:n,style:r}):(0,je.jsx)(be.Z,{ariaLabel:a,ariaLabelledBy:c,open:t,preventHideChildrenWhileOpening:!0,render:n,onDismiss:o,style:r,innerStyle:l})}var Me=o(42402),Ie=o(85567);const Pe=(0,c.defineMessages)({completedPercentSummary:{id:"completeAutomationSprintModal.sprintSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} total tasks"},selectNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectNextSprintLabel",defaultMessage:"Next sprint"},selectDatesForNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectDatesForNextSprintLabel",defaultMessage:"Start and end dates"},nextSprintDatesLabel:{id:"completeAutomationSprintModal.sprintSummary.nextSprintDatesLabel",defaultMessage:"Next sprint dates"},cancelButton:{id:"completeAutomationSprintModal.sprintSummary.cancel",defaultMessage:"Cancel"},fallbackSprintName:{id:"completeAutomationSprintModal.sprintName.placeholder",defaultMessage:"Sprint"}});function ke(e){let{onDismiss:t,...o}=e;window.__c={n:"CompleteSprintAutomationModal"};const{isOpen:i}=o,r=(0,s.O7)(),l=(0,n.useId)(),a=e=>{t();let n=!1;(0,I.Kn)(e)&&(0,I.$K)(e.clickedCancel)&&(n=!0===e.clickedCancel),d.$X(r,{...(0,u.Pn)(o.taskCollectionContextStore),action:n?"cancel_modal":"dismiss_modal"})};return(0,je.jsx)(_e,{ariaLabelledBy:l,isOpen:i,onDismiss:()=>a(),render:()=>(0,je.jsx)(Te,{...o,onDismiss:a,titleAriaId:l})})}function Te(e){var t;window.__c={n:"SprintSummaryModal"};const{completeSprintAutomationContext:o,setIsLoading:l,taskCollectionContextStore:a,onDismiss:p,completeSprintAutomationState:m,onAutomationComplete:h,titleAriaId:y}=e,{currentSprintId:C,querySprintsResult:b,currentSprintTaskSummary:j}=m,M=(0,c.useIntl)(),P=(0,s.O7)(),{isMobile:D}=(0,s.Fy)(),N=(0,i.VK)((()=>r.default.checkGate("recurring_sprints")),[]),K=(0,i.VK)((()=>g.default.state.currentUserSettingsStore),[]),E=(0,i.VK)((()=>o.sprintCollectionStore),[o]),q=(0,i.VK)((()=>{var e;const t=null===(e=o.automationContext)||void 0===e?void 0:e.automationStore;return null==t?void 0:t.getRecurrence()}),[o]),W=(0,i.VK)((()=>{var e;return(null===(e=o.automationContext)||void 0===e||null===(e=e.automationActionStore.getConfig())||void 0===e?void 0:e.complete_sprint_action)??"complete_sprint_and_move_incomplete_tasks_to_next_sprint"}),[null===(t=o.automationContext)||void 0===t?void 0:t.automationActionStore]),G=(0,i.VK)((()=>E.getSpaceId()),[E]),z=(0,i.VK)((()=>{if(C)return se.G.createChildStore(E,{id:C,table:Y.iU,spaceId:E.getSpaceId()})}),[C,E]),U=(0,i.VK)((()=>z?(0,ne.vU)({intl:M,environment:P,store:z,untitledFallback:Pe.fallbackSprintName}):M.formatMessage(Pe.fallbackSprintName)),[z,M,P]),$=(0,i.VK)((()=>Be({sprintBlockStore:z,sprintCollectionStore:E})),[z,E]),J=(0,i.VK)((()=>Oe({sprintDateRange:$,intl:M})),[$,M]),[ee,oe]=n.useState(),ie=(0,i.VK)((()=>f.default.createValue(W)),[W]),re=n.useMemo((()=>{if(!q||!N||null==$||!$.end_date)return;const e=(0,Q.Su)(q);return e?(0,Q.rP)({currentSprintEndDate:$.end_date,sprintSchedule:e}):void 0}),[q,null==$?void 0:$.end_date,N]),le=(0,i.VK)((()=>{if("pointer"!==(null==ee?void 0:ee.type))return;return Be({sprintBlockStore:se.G.createChildStore(E,ee.pointer),sprintCollectionStore:E})}),[ee,E]),[ae,de]=n.useState(void 0),pe=n.useMemo((()=>{if(ae&&(0,L.h)(ae))return ae}),[ae]),ue=n.useMemo((()=>{if(!b)return;const{nextSprintIds:e,futureSprintIds:t}=b;return e.length>0?e:t}),[b]),me=(0,i.VK)((()=>{if(void 0===ue)return;const e=ue[0];return e?{type:"pointer",pointer:{id:e,table:Y.iU,spaceId:G}}:{type:"actionId"}}),[ue,G]),ge=(0,i.VK)((()=>{var e;const t=Boolean(null==K||null===(e=K.getSettings())||void 0===e?void 0:e.seen_sprint_settings_engagement_banner);return N&&!t}),[K,N]);n.useEffect((()=>{me&&oe(me)}),[me,oe]),n.useEffect((()=>{de(le??re)}),[le,re,de]);const he=n.useCallback((async()=>{if(p(),!ee||!pe)return;l(!0);const e=0===(null==j?void 0:j.incompleteTaskCount)?"complete_sprint":ie.state,t=function(e){var t,o,n,i,r,s,l;const{sprintCollectionValue:a,nextSprintInput:c,intl:d,nextSprintDateRange:p}=e,u=a.space_id,m={id:a.id,table:_.v,spaceId:u},g=(0,w.ZP)(),h=(0,w.ZP)(),S=(0,w.ZP)(),f=(0,w.ZP)(),y=(0,w.ZP)(),C=(0,w.ZP)(),b=(0,w.ZP)(),j=(0,v.oC)(a),M=null===(t=a.format)||void 0===t||null===(t=t.app_uri_map)||void 0===t?void 0:t[x.b0.StatusV2];if(!M)return{error:{message:`${x.b0.StatusV2} not found.`}};const P=null===(o=a.format)||void 0===o||null===(o=o.app_uri_map)||void 0===o?void 0:o[x.b0.UniqueId];if(!P)return{error:{message:`${x.b0.UniqueId} not found.`}};const D=null===(n=a.format)||void 0===n||null===(n=n.app_uri_map)||void 0===n?void 0:n[x.b0.Dates];if(!D)return{error:{message:`${x.b0.Dates} not found.`}};const N=j[M];if(!N||"status"!==N.type)return{error:{message:`${x.b0.StatusV2} not found.`}};const K=null===(i=N.options)||void 0===i||null===(i=i.find((e=>e.id===x.df)))||void 0===i?void 0:i.value,L=null===(r=N.options)||void 0===r||null===(r=r.find((e=>e.id===x.SF)))||void 0===r?void 0:r.value,E=null===(s=N.options)||void 0===s||null===(s=s.find((e=>e.id===x.YE)))||void 0===s?void 0:s.value,q=null===(l=N.options)||void 0===l||null===(l=l.find((e=>e.id===x.eH)))||void 0===l?void 0:l.value;if(!(K&&L&&E&&q))return{error:{message:`Could not find required options for ${x.b0.StatusV2}.`}};const W="pointer"===c.type?1:2;if("complete_sprint"===e.type)return{value:[F({getLargestUniqueIdSprintActionId:C,sprintCollectionPointer:m,sprintUniqueIdPropertyId:P,spaceId:u}),T({getCurrentSprintActionId:g,sprintCollectionPointer:m,sprintCollectionSchema:j,spaceId:u}),..."pointer"===c.type?[]:[k({createNextSprintActionId:b,getCurrentSprintActionId:g,sprintCollectionPointer:m,sprintStatusNextOptionName:E,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:P})],B({updateCurrentSprintToPastActionId:h,getCurrentSprintActionId:g,sprintStatusPastOptionName:K,sprintStatusPropertyId:M,spaceId:u}),O({updateNextSprintToCurrentActionId:S,createNextSprintActionId:b,nextSprintInput:c,sprintStatusCurrentOptionName:L,sprintStatusPropertyId:M,spaceId:u,nextSprintDateRange:p,sprintDatePropertyId:D}),R({createFutureSprintActionId:y,sprintCollectionPointer:m,sprintStatusFutureOptionName:q,getLargestUniqueIdSprintActionId:C,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:P,incrementBy:W}),Z({updateFutureSprintToNextActionId:f,sprintCollectionPointer:m,sprintStatusNextOptionName:E,sprintStatusFutureOptionName:q,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:P})]};if("complete_sprint_and_move_incomplete_tasks_to_next_sprint"===e.type){var G,z,U;const{taskCollectionValue:t}=e,o={id:t.id,table:_.v,spaceId:t.space_id},n=(0,w.ZP)(),i=null===(G=t.format)||void 0===G||null===(G=G.app_uri_map)||void 0===G?void 0:G[x.Es.Status];if(!i)return{error:{message:`${x.Es.Status} not found.`}};const r=null===(z=t.format)||void 0===z||null===(z=z.app_uri_map)||void 0===z?void 0:z[x.Es.TaskToSprintRelation];if(!r)return{error:{message:`${x.Es.TaskToSprintRelation} not found.`}};const s=(0,v.oC)(t)[i];if(!s||"status"!==s.type)return{error:{message:`${x.Es.Status} not found.`}};const l=null===(U=s.groups)||void 0===U||null===(U=U.find((e=>e.id===x.uS)))||void 0===U?void 0:U.name;return l?{value:[F({getLargestUniqueIdSprintActionId:C,sprintCollectionPointer:m,sprintUniqueIdPropertyId:P,spaceId:u}),T({getCurrentSprintActionId:g,sprintCollectionPointer:m,sprintCollectionSchema:j,spaceId:u}),..."pointer"===c.type?[]:[k({createNextSprintActionId:b,getCurrentSprintActionId:g,sprintCollectionPointer:m,sprintStatusNextOptionName:E,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:P})],A({moveIncompleteTasksActionId:n,createNextSprintActionId:b,nextSprintInput:c,taskCollectionPointer:o,taskStatusCompleteGroupName:l,spaceId:u,taskStatusPropertyId:i,taskSprintRelationPropertyId:r}),B({updateCurrentSprintToPastActionId:h,getCurrentSprintActionId:g,sprintStatusPastOptionName:K,spaceId:u,sprintStatusPropertyId:M}),O({updateNextSprintToCurrentActionId:S,createNextSprintActionId:b,nextSprintInput:c,sprintStatusCurrentOptionName:L,spaceId:u,sprintStatusPropertyId:M,nextSprintDateRange:p,sprintDatePropertyId:D}),R({createFutureSprintActionId:y,sprintCollectionPointer:m,sprintStatusFutureOptionName:q,getLargestUniqueIdSprintActionId:C,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:P,incrementBy:W}),Z({updateFutureSprintToNextActionId:f,sprintCollectionPointer:m,sprintStatusNextOptionName:E,sprintStatusFutureOptionName:q,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:P})]}:{error:{message:`Could not find required group for ${x.Es.Status}.`}}}if("complete_sprint_and_move_incomplete_tasks_to_backlog"===e.type){var $,H,Y;const{taskCollectionValue:t}=e,o={id:t.id,table:_.v,spaceId:t.space_id},n=(0,w.ZP)(),i=null===($=t.format)||void 0===$||null===($=$.app_uri_map)||void 0===$?void 0:$[x.Es.Status];if(!i)return{error:{message:`${x.Es.Status} not found.`}};const r=null===(H=t.format)||void 0===H||null===(H=H.app_uri_map)||void 0===H?void 0:H[x.Es.TaskToSprintRelation];if(!r)return{error:{message:`${x.Es.TaskToSprintRelation} not found.`}};const s=(0,v.oC)(t)[i];if(!s||"status"!==s.type)return{error:{message:`${x.Es.Status} not found.`}};const l=null===(Y=s.groups)||void 0===Y||null===(Y=Y.find((e=>e.id===x.uS)))||void 0===Y?void 0:Y.name;return l?{value:[F({getLargestUniqueIdSprintActionId:C,sprintCollectionPointer:m,sprintUniqueIdPropertyId:P,spaceId:u}),T({getCurrentSprintActionId:g,sprintCollectionPointer:m,sprintCollectionSchema:j,spaceId:u}),..."pointer"===c.type?[]:[k({createNextSprintActionId:b,getCurrentSprintActionId:g,sprintCollectionPointer:m,sprintStatusNextOptionName:E,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:P})],V({moveIncompleteTasksToBacklogActionId:n,taskCollectionPointer:o,taskStatusCompleteGroupName:l,spaceId:u,taskStatusPropertyId:i,taskSprintRelationPropertyId:r}),B({updateCurrentSprintToPastActionId:h,getCurrentSprintActionId:g,sprintStatusPastOptionName:K,spaceId:u,sprintStatusPropertyId:M}),O({updateNextSprintToCurrentActionId:S,createNextSprintActionId:b,nextSprintInput:c,sprintStatusCurrentOptionName:L,spaceId:u,sprintStatusPropertyId:M,nextSprintDateRange:p,sprintDatePropertyId:D}),R({createFutureSprintActionId:y,sprintCollectionPointer:m,sprintStatusFutureOptionName:q,getLargestUniqueIdSprintActionId:C,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:P,incrementBy:W}),Z({updateFutureSprintToNextActionId:f,sprintCollectionPointer:m,sprintStatusNextOptionName:E,sprintStatusFutureOptionName:q,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:P})]}:{error:{message:`Could not find required group for ${x.Es.Status}.`}}}return(0,I.t1)(e.type)}({type:e,sprintCollectionValue:o.sprintCollectionValue,taskCollectionValue:o.taskCollectionValue,nextSprintInput:ee,nextSprintDateRange:pe,intl:M});if(N||d.$X(P,{...(0,u.Pn)(a),action:"complete_sprint",currentSprintTaskSummary:m.currentSprintTaskSummary,completeSprintActionType:e,nextSprintDateRange:pe,nextSprintInput:ee}),H.x.isFail(t))throw new Error(t.error.message);let n;n=N&&o.automationContext?{type:"recurrence",recurrence:{type:"completeSprint",completeSprintActionType:e,nextSprintDateRange:pe},persisted:!0,automationStore:o.automationContext.automationStore,intl:M,parentRecordStore:o.currentCollectionViewBlockStore}:{type:"structured_automation",persisted:!1,intl:M,parentRecordStore:o.currentCollectionViewBlockStore,actions:t.value,parentPointer:o.currentCollectionViewBlockStore.getSpaceShardedPointer(),shouldBatch:!0};const i=()=>{h()};await te.oS({environment:P,store:o.currentCollectionViewBlockStore,clientContext:n,onUndo:()=>{l(!0),i(),l(!1)}}),i(),l(!1)}),[p,ee,pe,l,null==j?void 0:j.incompleteTaskCount,ie,o.sprintCollectionValue,o.taskCollectionValue,o.automationContext,o.currentCollectionViewBlockStore,M,P,a,m.currentSprintTaskSummary,N,h]),Se=Ze({isMobile:D}),{status:ye}=(0,S.V)({value:m,validateLoaded:e=>!1===e.isLoading,waitTimeInMs:1*X.hM});if("pending"!==ye&&m.isLoading)return(0,je.jsx)(Fe,{titleAriaId:y,onDismiss:p,sprintCollectionStore:E});if(m.isLoading)return(0,je.jsx)(Re,{titleAriaId:y,onDismiss:p});const{incompleteTaskCount:xe}=m.currentSprintTaskSummary,ve=Boolean(ee)&&Boolean(pe),Ce=void 0!==ue&&ue.length>0;return(0,je.jsxs)("div",{style:Se.modalContainer,children:[(0,je.jsx)("div",{style:Se.header,id:y,children:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.title",defaultMessage:"{sprintName} summary",values:{sprintName:U}})}),(0,je.jsx)(Ve,{currentSprintFormattedDateRange:J,currentSprintTaskSummary:j}),ge&&(0,je.jsx)(Ae,{collectionContextStore:a,userSettingsStore:K,onDismissModal:p}),Ce&&(0,je.jsxs)("div",{style:Se.flexRow,children:[M.formatMessage(Pe.selectNextSprintLabel),(0,je.jsx)(Ee,{nextSprintInput:ee,setNextSprintInput:oe,completeSprintAutomationContext:o,sprintPageIds:ue})]}),(0,je.jsxs)("div",{style:Se.flexRow,children:[Ce?M.formatMessage(Pe.selectDatesForNextSprintLabel):M.formatMessage(Pe.nextSprintDatesLabel),(0,je.jsx)(We,{sprintDateRange:ae,setSprintDateRange:de})]}),xe>0&&(0,je.jsxs)("div",{style:Se.flexRow,children:[(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksLabel",defaultMessage:"{incompleteTaskCount, plural, one {{incompleteTaskCount} incomplete task} other {{incompleteTaskCount} incomplete tasks}}",values:{incompleteTaskCount:xe}}),(0,je.jsx)(Ne,{actionTypeStore:ie})]}),(0,je.jsx)(ce.Z,{disabled:!ve,onClick:()=>{he()},style:Se.button,children:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButton",defaultMessage:"Complete {sprintName}",values:{sprintName:U}})}),(0,je.jsx)(fe.Z,{onClick:()=>p({clickedCancel:!0}),style:Se.button,children:M.formatMessage(Pe.cancelButton)})]})}function Fe(e){window.__c={n:"MissingCurrentSprintError"};const{onDismiss:t,sprintCollectionStore:o,titleAriaId:n}=e,r=(0,s.O7)(),l=(0,c.useIntl)(),{isMobile:a}=(0,s.Fy)(),d=(0,i.VK)((()=>o.getParentBlockStore()),[o]),p=Ze({isMobile:a});return(0,je.jsxs)("div",{style:p.modalContainer,children:[(0,je.jsx)("div",{style:p.header,id:n,children:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.missingCurrentSprint.title",defaultMessage:"No current sprint found"})}),(0,je.jsx)(ce.Z,{onClick:()=>{d&&J._({environment:r,store:d,pageVisitSource:y.tY.LinkInPage})},style:{...p.button,marginTop:24},children:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.missingCurrentSprint.navigateToSprintsDatabase",defaultMessage:"Fix in Sprints database"})}),(0,je.jsx)(fe.Z,{onClick:t,style:p.button,children:l.formatMessage(Pe.cancelButton)})]})}function Re(e){window.__c={n:"LoadingStatePlaceholder"};const{onDismiss:t,titleAriaId:o}=e,n=(0,c.useIntl)(),{isMobile:i}=(0,s.Fy)(),r=Ze({isMobile:i});return(0,je.jsxs)("div",{style:r.modalContainer,children:[(0,je.jsx)("div",{style:r.header,id:o,children:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.titlePlaceholder",defaultMessage:"Sprint summary"})}),(0,je.jsx)("div",{style:r.subheader,children:(0,je.jsx)(me.Z,{style:r.subheaderShimmer})}),(0,je.jsxs)("div",{style:r.flexRow,children:[n.formatMessage(Pe.selectNextSprintLabel),(0,je.jsx)(me.Z,{style:r.flexRowShimmerBox1})]}),(0,je.jsxs)("div",{style:r.flexRow,children:[n.formatMessage(Pe.selectDatesForNextSprintLabel),(0,je.jsx)(me.Z,{style:r.flexRowShimmerBox2})]}),(0,je.jsxs)("div",{style:r.flexRow,children:[(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksPlaceholder",defaultMessage:"Incomplete tasks"}),(0,je.jsx)(me.Z,{style:r.flexRowShimmerBox3})]}),(0,je.jsx)(ce.Z,{disabled:!0,onClick:()=>{},style:r.button,children:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButtonPlaceholder",defaultMessage:"Complete sprint"})}),(0,je.jsx)(fe.Z,{onClick:t,style:r.button,children:n.formatMessage(Pe.cancelButton)})]})}function Ze(e){let{isMobile:t}=e;return(0,l.yK)((e=>{const o={height:44,borderRadius:8,display:"flex",alignItems:"center",width:void 0},n={...o,marginTop:12,marginBottom:18};return{modalContainer:{width:400,display:"flex",fontSize:t?a.Z.fontSize.UIRegular.mobile:a.Z.fontSize.UIRegular.desktop,flexDirection:"column",justifyContent:"center",padding:20},header:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:t?18:16,fontWeight:a.Z.fontWeight.semibold},subheader:{display:"flex",alignItems:"center",justifyContent:"center",color:e.lightTextColor,marginBottom:16,gap:8},separator:{height:2,width:2,borderRadius:2,backgroundColor:e.lightIconColor},flexRow:{display:"flex",...t?{flexDirection:"column",fontSize:14,color:e.mediumTextColor}:{justifyContent:"space-between",alignItems:"center",height:24,marginBottom:16}},completedTaskGroup:{display:"flex",gap:4},button:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:8,...t&&o},subheaderShimmer:{borderRadius:4,marginTop:6,width:200,height:16,...t&&{height:22}},flexRowShimmerBox1:{borderRadius:4,width:60,height:16,...t&&n},flexRowShimmerBox2:{borderRadius:4,width:80,height:16,...t&&n},flexRowShimmerBox3:{borderRadius:4,width:140,height:16,...t&&n},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:4,...t&&{...n,border:`1px solid ${e.accentColors.gray[50]}`,justifyContent:"space-between"}},dropdownChevronIcon:{color:e.lightIconColor,width:12,height:"auto"}}}),[t])}function Ae(e){window.__c={n:"EngagementBanner"};const{collectionContextStore:t,userSettingsStore:o,onDismissModal:n}=e,i=(0,s.O7)(),r=(0,l.yK)((e=>({banner:{width:"100%",display:"flex",alignItems:"start",backgroundColor:e.accentColors.blue["light"===e.mode?50:300],borderRadius:4,padding:12,marginBottom:12,fontSize:12,lineHeight:1.5,gap:8},bannerContent:{flex:"1 1 auto",color:e.regularTextColor},bannerTitle:{fontWeight:a.Z.fontWeight.regular},icon:{width:12,color:e.blueColor},repeatIcon:{flex:"0 0 auto",marginBlockStart:3},closeButton:{marginTop:-3,borderRadius:"50%"},link:{color:e.text.uiBluePrimary}})),[]),d=()=>{o&&(n(),ee.zX({environment:i,userSettingsStore:o}),ee.Rh(t))};return(0,je.jsxs)("div",{style:r.banner,children:[(0,je.jsx)("div",{style:r.repeatIcon,children:(0,U.N)(r.icon)}),(0,je.jsx)("div",{style:r.bannerContent,children:(0,je.jsx)("div",{style:r.bannerTitle,children:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.turnOnAutomaticSprints.banner.title",defaultMessage:"Complete your sprints automatically. Turn on Automated sprints in <linkToSprintSettings>Settings</linkToSprintSettings>.",values:{linkToSprintSettings:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,je.jsx)(Me.Z,{onClick:()=>d(),disableUnderline:!0,style:r.link,children:t})}}})})}),(0,je.jsx)(ue.Z,{icon:G.U,ariaLabel:"closeButton",style:r.closeButton,onClick:()=>{o&&ee.zX({environment:i,userSettingsStore:o})}})]})}function Ve(e){window.__c={n:"SprintSummarySubheader"};const{currentSprintFormattedDateRange:t,currentSprintTaskSummary:o}=e,{isMobile:n}=(0,s.Fy)(),i=(0,c.useIntl)(),r=Ze({isMobile:n}),l=o?i.formatMessage(Pe.completedPercentSummary,{completedTaskCount:o.completedTaskCount,totalTaskCount:o.totalTaskCount}):void 0,a=t&&o?(0,je.jsxs)(je.Fragment,{children:[t,(0,je.jsx)("div",{style:r.separator}),l]}):t||l;return void 0===a?null:(0,je.jsx)("div",{style:r.subheader,children:a})}function Be(e){const{sprintBlockStore:t,sprintCollectionStore:o}=e;if(!t)return;const n=o.getPropertyMapping(),i=null==n?void 0:n[x.b0.Dates];if(!i)return;const r=t.getPropertyValue(i);if(!r)return;const s=(0,M.nai)(r)[0];return s?(0,L.Ls)(s):void 0}function Oe(e){const{sprintDateRange:t,intl:o}=e;if(t&&(0,L.h)(t))return(0,E.ZV)({value:t,allowRelativeDates:!1,shortenDateAndRange:!0,displayInUserTimezone:!0,intl:o})}const De={complete_sprint_and_move_incomplete_tasks_to_next_sprint:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.moveToNextSprintOption",defaultMessage:"Move to next sprint"}),complete_sprint_and_move_incomplete_tasks_to_backlog:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.moveToBacklogOption",defaultMessage:"Move to backlog"}),complete_sprint:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.keepInThisSprintOption",defaultMessage:"Keep in current sprint"})};function Ne(e){window.__c={n:"SelectIncompleteTaskAutomationPopupButton"};const{actionTypeStore:t}=e,{isMobile:o}=(0,s.Fy)(),n=(0,i.VK)((()=>t.state),[t]),r=Ze({isMobile:o});return(0,je.jsx)(pe.ZP,{popupType:o?pe.Z4.SlideUp:pe.Z4.Popup,alignmentToOrigin:pe.vR.Start,placementToOrigin:pe.pO.Bottom,render:e=>(0,je.jsx)(Le,{actionTypeStore:t,buttonPopupParent:e}),renderOrigin:e=>(0,je.jsxs)(fe.Z,{...e,style:r.dropdownButton,children:[De[n],(0,W.i)(r.dropdownChevronIcon)]})})}const Ke=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];function Le(e){window.__c={n:"AutomationActionOptionsMenu"};const{actionTypeStore:t,buttonPopupParent:o}=e,{isMobile:n}=(0,s.Fy)(),r=(0,l.yK)((e=>({checkIcon:{color:e.lightIconColor,width:12,height:"auto",marginLeft:4}})),[]),a=(0,i.VK)((()=>Ke.map((e=>{const n=e===t.state;return{key:e,action:()=>{t.setState(e),o.close()},render:t=>(0,je.jsx)(de.Z,{...t,title:De[e],right:n&&(0,q.e)(r.checkIcon)})}}))),[t,r.checkIcon,o]);let c;return c=n?{menuType:oe.og.ActionSheet}:{menuType:oe.og.Popup,maxHeight:"50vh",minWidth:230},(0,je.jsx)(ge.Z,{...c,children:(0,je.jsx)(he.Z,{type:he.i.Vertical,initialFocus:0,sections:[{key:"sprint_automations",items:a,render:e=>(0,je.jsx)(ve.Z,{...e})}]})})}function Ee(e){window.__c={n:"SelectSprintPopupButton"};const{nextSprintInput:t,completeSprintAutomationContext:o,setNextSprintInput:n,sprintPageIds:r}=e,{sprintCollectionStore:a}=o,{isMobile:d}=(0,s.Fy)(),p=(0,s.O7)(),u=(0,c.useIntl)(),m=(0,i.VK)((()=>{if(void 0===t)return(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSelect.empty",defaultMessage:"Select sprint"});if("actionId"===t.type)return(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSelect.newSprint",defaultMessage:"New sprint"});if("pointer"===t.type){const e=se.G.createChildStore(a,t.pointer);return(0,ne.vU)({intl:u,environment:p,store:e,untitledFallback:Pe.fallbackSprintName})}(0,I.t1)(t)}),[t,u,a,p]),g=Ze({isMobile:d}),h=(0,l.yK)((e=>({button:{...void 0===t&&{color:e.lightTextColor}}})),[t]),S={...g.dropdownButton,...h.button};return 0===r.length||1===r.length?(0,je.jsx)(fe.Z,{style:S,disabled:!0,children:m}):(0,je.jsx)(pe.ZP,{popupType:d?pe.Z4.SlideUp:pe.Z4.Popup,alignmentToOrigin:pe.vR.Start,placementToOrigin:pe.pO.Bottom,render:e=>(0,je.jsx)(qe,{buttonPopupParent:e,completeSprintAutomationContext:o,sprintPageIds:r,nextSprintInput:t,setNextSprintInput:n}),renderOrigin:e=>(0,je.jsxs)(fe.Z,{...e,style:S,children:[m,(0,W.i)(g.dropdownChevronIcon)]})})}function qe(e){window.__c={n:"SelectSprintDropdown"};const{sprintPageIds:t,completeSprintAutomationContext:o,buttonPopupParent:r,nextSprintInput:a,setNextSprintInput:d}=e,{sprintCollectionStore:p}=o,{isMobile:u}=(0,s.Fy)(),m=(0,i.VK)((()=>p.getSpaceId()),[p]),g=(0,i.VK)((()=>(0,ie.U1)({collectionStore:o.taskCollectionStore,property:x.Es.TaskToSprintRelation}).filter((e=>e.visible&&("title"===e.property||o.sprintCollectionSchema[e.property])))),[o]),h=(0,i.VK)((()=>new re.Z),[]),S=(0,l.yK)((e=>({checkIcon:{color:e.lightIconColor,width:12,height:"auto",marginLeft:4},plusIcon:{color:e.lightIconColor,width:12,height:"auto"},createSprintRow:{display:"flex",gap:4},sprintRow:{display:"flex",maxHeight:22,alignItems:"center"},recordTitle:{...u&&{marginRight:12}}})),[u]),f="purple",y=(0,l.Fg)(),v=(0,N.KR)(y,f),C=n.useMemo((()=>{const e="actionId"===(null==a?void 0:a.type);return{key:"new_sprint",action:()=>{d({type:"actionId"}),r.close()},render:t=>(0,je.jsx)(de.Z,{...t,icon:(0,z.R)(S.plusIcon),title:(0,je.jsxs)("div",{style:S.createSprintRow,children:[(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.selectSprintDropdown.createNew",defaultMessage:"New sprint"}),(0,je.jsx)(Ie.Z,{isRound:!0,showRemoveButton:!1,value:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.selectSprintDropdown.createNewToken",defaultMessage:"Next"}),format:K.lo.Medium,isSingle:!0,color:v.textColor,backgroundColor:v.backgroundColor,showColoredDot:f})]}),right:e&&(0,q.e)(S.checkIcon)})}}),[a,r,d,S,v]),b=(0,i.VK)((()=>t.map((e=>{const t={id:e,table:Y.iU,spaceId:m},o=se.G.createChildStore(p,t),n=o.getIcon(),i="pointer"===(null==a?void 0:a.type)&&$.dr.isEqual(a.pointer,t);return{key:e,action:()=>{d({type:"pointer",pointer:t}),r.close()},render:e=>(0,je.jsx)(de.Z,{...e,icon:n&&(0,je.jsx)(ye.Z,{disabled:!0,icon:n,isEmptyPage:!1,size:20}),title:(0,je.jsx)("div",{style:S.sprintRow,children:g.map((e=>"title"===e.property?(0,je.jsx)(xe.Z,{store:o,style:S.recordTitle},"title"):(0,je.jsx)(le.Z,{store:o,property:e.property,disabled:!1,locked:!1,format:ae.C.Relation,tableWrap:!1,blockPropertyValueOverlayStore:h,collectionStore:p},e.property))).filter(I.$K)}),right:i&&(0,q.e)(S.checkIcon)})}}))),[p,h,r,a,g,m,d,S,t]),w=[{key:"sprints",items:n.useMemo((()=>b.length>0?b:[C]),[b,C]),render:e=>(0,je.jsx)(ve.Z,{...e})}];let j;return j=u?{menuType:oe.og.ActionSheet}:{menuType:oe.og.Popup,maxHeight:"50vh",minWidth:230},(0,je.jsx)(ge.Z,{...j,children:(0,je.jsx)(he.Z,{type:he.i.Vertical,initialFocus:0,sections:w})})}function We(e){window.__c={n:"SelectNextSprintDate"};const{sprintDateRange:t,setSprintDateRange:o}=e,r=(0,c.useIntl)(),{isMobile:a}=(0,s.Fy)(),d=n.useMemo((()=>Oe({sprintDateRange:t,intl:r})),[t,r]),p=Ze({isMobile:a}),u=(0,l.yK)((e=>({button:{...!d&&{color:e.lightTextColor}}})),[d]),m=(0,i.VK)((()=>d||(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.nextSprintDate.placeholder",defaultMessage:"Select dates"})),[d]);return(0,je.jsx)(pe.ZP,{popupType:a?pe.Z4.SlideUp:pe.Z4.Popup,alignmentToOrigin:pe.vR.Start,placementToOrigin:pe.pO.Bottom,render:e=>(0,je.jsx)(Ge,{sprintDateRange:t,setSprintDateRange:o,onDismiss:()=>{e.close()}}),renderOrigin:e=>(0,je.jsxs)(fe.Z,{...e,style:{...p.dropdownButton,...u.button},children:[m,(0,W.i)(p.dropdownChevronIcon)]})})}function Ge(e){window.__c={n:"SprintDateRangePicker"};const{sprintDateRange:t,setSprintDateRange:o,onDismiss:i}=e,{isMobile:r}=(0,s.Fy)(),l=n.useMemo((()=>({starting:null!=t&&t.start_date?{type:"date",start_date:t.start_date}:void 0,ending:null!=t&&t.end_date?{type:"date",start_date:t.end_date}:void 0})),[t]);let a;return a=r?{menuType:oe.og.Modal,right:(0,je.jsx)(Se.DoneMenuText,{}),onClickRight:i}:{menuType:oe.og.Popup,maxHeight:"50vh",paddingTop:6},(0,je.jsxs)(ge.Z,{...a,children:[(0,je.jsx)(ve.Z,{children:(0,je.jsx)(Ce.Z,{title:void 0,disableMenuWrap:!0,allowRelativeRangeFilter:!0,value:l,onUpdate:e=>{var t,n;if(e.error)return;const i={...l,...e.value},r=null===(t=i.starting)||void 0===t?void 0:t.start_date,s=null===(n=i.ending)||void 0===n?void 0:n.start_date;o({type:"daterange",start_date:r,end_date:s})},onDismiss:i})}),(0,je.jsx)(ve.Z,{topBorder:!0,children:(0,je.jsx)(de.Z,{focused:!1,onClick:()=>{o(void 0)},title:(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.datePicker.clear",defaultMessage:"Clear"})})})]})}var ze=o(42875),Ue=o(59054),$e=o(54642),He=o(16732);function Ye(e){if(!e)return;if("aggregation"!==e.type)return;if("text"!==e.aggregationResult.type)return;const t=e.aggregationResult.value,o=null==t?void 0:t.split("/");if(!o||2!==o.length)return;const n=Number(o[0]),i=Number(o[1]);return{completedTaskCount:n,incompleteTaskCount:i-n,totalTaskCount:i,completedTaskPercent:0===i?0:n/i}}function Qe(e){if(!e)return;const t=e.getPropertyMapping(),o=null==t?void 0:t[x.Es.TaskToSprintRelation];if(!o)return;return He.Ws.filter.property=o,{...He.Ws.filter,property:o}}function Xe(e){var t;if(!e)return;const o=e.getPropertyMapping(),n=Qe(e);if(!n)return;const i=null==o?void 0:o[x.Es.Status];if(!i)return;const r=e.getSchema()[i];if(!r||"status"!==r.type)return;const s=null===(t=r.groups)||void 0===t||null===(t=t.find((e=>(null==e?void 0:e.id)===x.uS)))||void 0===t?void 0:t.name;return s?{type:"aggregation",filter:{operator:"and",filters:[n]},aggregation:{aggregator:{operator:"count_per_group",groupName:s},property:i}}:void 0}class Je extends f.default{getInitialState(){return{isLoading:!0,currentSprintId:void 0,querySprintsResult:void 0,currentSprintTaskSummary:void 0}}updateCurrentSprint(e){const{querySprintsResult:t,currentSprintTaskSummary:o}=this.state;void 0!==e&&void 0!==t&&void 0!==o?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:t,currentSprintTaskSummary:o}):e?this.setState({...this.state,currentSprintId:e}):this.setState({...this.state,isLoading:!0,currentSprintId:e})}updateNextAndFutureSprints(e){const{currentSprintId:t,currentSprintTaskSummary:o}=this.state;void 0!==t&&void 0!==e&&void 0!==o?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:e,currentSprintTaskSummary:o}):e?this.setState({...this.state,querySprintsResult:e}):this.setState({...this.state,isLoading:!0,querySprintsResult:e})}updateCurrentSprintTaskSummary(e){const{currentSprintId:t,querySprintsResult:o}=this.state;void 0!==t&&void 0!==o&&void 0!==e?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:o,currentSprintTaskSummary:e}):e?this.setState({...this.state,currentSprintTaskSummary:e}):this.setState({...this.state,isLoading:!0,currentSprintTaskSummary:e})}}const et=Je;function tt(e){window.__c={n:"CompleteSprintAutomationButtonLoader"};const{taskCollectionContextStore:t,completeSprintAutomationContext:o,children:r,isModalOpen:l}=e,{sprintCollectionStore:a}=o,c=a.id,d=(0,s.O7)(),p=(0,i.VK)((()=>new et),[]),u=(0,i.VK)((()=>p.state),[p]),m=(0,i.VK)((()=>{var e;const o=t.relativeVariableStore.state;return null==o||null===(e=o[c])||void 0===e?void 0:e.current}),[c,t]);n.useEffect((()=>{p.updateCurrentSprint(m)}),[m,p]);const[{value:g}]=(0,Ue.r5)((async()=>await async function(e){var t;const{environment:o,completeSprintAutomationContext:n}=e,{sprintCollectionStore:i}=n,r=function(e){var t,o;const{sprintCollectionStore:n,sprintCollectionSchema:i}=e,r=n.getPropertyMapping(),s=null==r?void 0:r[x.b0.StatusV2];if(!s)return;const l=i[s];if(!l||"status"!==l.type)return;const a=null===(t=l.options)||void 0===t||null===(t=t.find((e=>e.id===x.YE)))||void 0===t?void 0:t.value,c=null===(o=l.options)||void 0===o||null===(o=o.find((e=>e.id===x.eH)))||void 0===o?void 0:o.value;if(!a||!c)return;const d=j.qB[x.p$].next.reducer.getCombinatorFilter(i);if(!d)return;const p={type:"results",filter:d,limit:5},u={type:"results",filter:{operator:"and",filters:[{property:s,filter:{operator:"status_is",value:{type:"is_option",value:c}}}]},limit:5};return{[x.YE]:p,[x.eH]:u}}(n),s=i.getPropertyMapping(),l=null==s?void 0:s[x.b0.Dates],a=null==s?void 0:s[x.b0.UniqueId];if(!r||!l||!a)return;const c={userId:o.currentUser.id,userTimeZone:(0,ze.r)(),searchQuery:void 0,sort:[{property:l,direction:"ascending"},{property:a,direction:"ascending"}],reducers:r},d=null===(t=i.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores()[0],p=i.getSpaceId();if(!d)return;const u=await $e.queryCollection(o,{source:{type:"collection",id:i.id,spaceId:p},collectionView:{id:d.id,spaceId:p},loader:c},void 0,{src:"complete_sprint_modal_sprint_picker"});if("success"!==u.type)return;const m=u.data.result.reducerResults[x.YE],g=u.data.result.reducerResults[x.eH];if("results"!==m.type||"results"!==g.type)return;const h=m.blockIds,S=g.blockIds;return{nextSprintIds:h,futureSprintIds:S}}({environment:d,completeSprintAutomationContext:o})),[m,d,o]);n.useEffect((()=>{p.updateNextAndFutureSprints(g)}),[g,p]);const[{value:h}]=(0,Ue.r5)((async()=>await async function(e){var t;const{environment:o,completeSprintAutomationContext:n}=e,{taskCollectionStore:i}=n,r=Xe(i);if(!r)return;const s=Qe(i);if(!s)return;const l={filter:{operator:"and",filters:[s]},userId:o.currentUser.id,userTimeZone:(0,ze.r)(),searchQuery:"",sort:[],reducers:{completed_tasks_in_current_sprint:r}},a=null===(t=i.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores()[0],c=i.getSpaceId();if(!a)return;const d=await $e.queryCollection(o,{source:{type:"collection",id:i.id,spaceId:c},collectionView:{id:a.id,spaceId:c},loader:l},void 0,{src:"complete_sprint_modal_sprint_picker"});if("success"!==d.type)return;return Ye(d.data.result.reducerResults.completed_tasks_in_current_sprint)}({environment:d,completeSprintAutomationContext:o})),[m,d,o,l]);return n.useEffect((()=>{p.updateCurrentSprintTaskSummary(h)}),[h,p]),(0,je.jsx)(je.Fragment,{children:r({completeSprintAutomationState:u,onAutomationComplete:()=>{p.reset()}})})}var ot=o(63296),nt=o(97004),it=o(71638),rt=o(56247);function st(e){const{percentage:t}=e;return(0,je.jsx)(rt.b,{numberValue:t,numberFormat:void 0,numberShowAs:{type:"ring",maxValue:1,color:"blue",showValue:!1},shouldRenderTooltip:!1,progressSize:15})}var lt=o(68785);const at=function(e){const{isLoading:t,taskSummary:o,styles:n}=e;return(0,je.jsx)("div",{style:{width:16,height:"auto",...n},children:t?(0,je.jsx)(lt.Z,{}):(0,je.jsx)(st,{percentage:(null==o?void 0:o.completedTaskPercent)??0})})};function ct(e){window.__c={n:"SprintRemainingTasksSummary"};const{taskCollectionContextStore:t,children:o}=e,n=(0,i.VK)((()=>(0,nt.Nq)(t)),[t]),r=(0,i.VK)((()=>t.collectionStore()),[t]),s=(0,i.VK)((()=>Xe(r)),[r]);return!s||n?null:(0,je.jsx)(it.Z,{id:"completed_tasks_in_current_sprint_view",collectionContextStore:t,reducer:s,render:e=>{const t=Ye(e.state);return t?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(dt,{currentSprintTasksInView:t}),o(t)]}):null}})}function dt(e){window.__c={n:"RemainingTasksSummary"};const{currentSprintTasksInView:t}=e,o=(0,l.yK)((e=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",columnGap:5,color:e.lightTextColor,fontSize:a.Z.fontSize.UIRegular.desktop,fontWeight:a.Z.fontWeight.regular,whiteSpace:"nowrap"}})),[]),{isPhone:n}=(0,s.Fy)();return n?null:(0,je.jsxs)("div",{style:o.summary,children:[(0,je.jsx)(at,{styles:{paddingTop:1},isLoading:!1,taskSummary:t}),(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} tasks",values:{completedTaskCount:t.completedTaskCount,totalTaskCount:t.totalTaskCount}})]})}function pt(e){window.__c={n:"CompleteSprintAutomationButton"};const{collectionContextStore:t,completeSprintAutomationContext:o}=e,r=(0,s.O7)(),[l,a]=n.useState(!1),[c,h]=n.useState(!1),S=n.useCallback((()=>{h(!1)}),[h]),f=(0,i.VK)((()=>o.permissionsContext.canEdit),[o.permissionsContext.canEdit]),y=(0,i.VK)((()=>g.default.state.currentUserSettingsStore),[]),x=()=>{h(!0);"complete-sprint-button-tooltip"===(0,m.wF)(y,"sprints-onboarding")&&p.tutorialGoToNextStep(r,"sprints-onboarding"),d.$X(r,{...(0,u.Pn)(t),action:"open_modal"})};return f?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(tt,{completeSprintAutomationContext:o,taskCollectionContextStore:t,isModalOpen:c,children:e=>{let{completeSprintAutomationState:n,onAutomationComplete:i}=e;return(0,je.jsx)(ke,{completeSprintAutomationContext:o,isOpen:c,onDismiss:S,setIsLoading:a,taskCollectionContextStore:t,completeSprintAutomationState:n,onAutomationComplete:i})}}),(0,je.jsx)(ct,{taskCollectionContextStore:t,children:()=>(0,je.jsx)(ut,{taskCollectionContextStore:t,onClick:x,isLoading:l})})]}):null}function ut(e){window.__c={n:"SprintButton"};const{taskCollectionContextStore:t,onClick:o,isLoading:r}=e,{isPhone:d}=(0,s.Fy)(),p=n.useRef(null),u=function(e){const{isPhone:t}=e;return(0,l.yK)((e=>({button:{height:26,marginLeft:8,fontWeight:a.Z.fontWeight.medium,...t&&{flexGrow:1,borderRadius:8,height:44}}})),[t])}({isPhone:d}),m=(0,i.VK)((()=>t.collectionViewBlockStore()),[t]),S=(0,i.VK)((()=>g.default.state.currentSpaceStore),[]),f=(0,i.VK)((()=>null==m?void 0:m.getSpaceId()),[m]);if(!m)return(0,je.jsx)(je.Fragment,{});const y=f===(null==S?void 0:S.id);return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(ot.Z,{ref:p,onClick:o,style:u.button,disabled:r,disabledFeedback:r,children:(0,je.jsx)(c.FormattedMessage,{defaultMessage:"Complete sprint",id:"completeSprintAutomationButton.label"})}),y&&(0,je.jsx)(h.Yy,{origin:p})]})}var mt=o(30120);function gt(e){var t;window.__c={n:"SprintSummaryAndDaysRemaining"};const{collectionContextStore:o,sprintAutomationContext:n}=e,r=(0,l.yK)((e=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:17,columnGap:5,color:e.lightTextColor,fontSize:a.Z.fontSize.UIRegular.desktop,fontWeight:a.Z.fontWeight.regular,whiteSpace:"nowrap"},icon:{width:16,height:"auto",paddingTop:2}})),[]),{isPhone:c}=(0,s.Fy)(),d=(0,i.VK)((()=>{var e;const t=null===(e=n.automationContext)||void 0===e?void 0:e.automationStore.getRunAt();if(!t)return;const o=mt.ou.fromMillis(t,{zone:"utc"}).toLocal().startOf("day"),i=mt.ou.now().startOf("day"),r=o.diff(i,"days").days;return r<1?"soon":1===r?"today":2===r?"tomorrow":r-1}),[null===(t=n.automationContext)||void 0===t?void 0:t.automationStore]);return d?(0,je.jsx)(ct,{taskCollectionContextStore:o,children:()=>c?null:(0,je.jsxs)("div",{style:r.summary,children:[(0,U.N)(r.icon),(0,je.jsx)(ht,{daysRemaining:d})]})}):null}function ht(e){const{daysRemaining:t}=e;return"soon"===t?(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.endingSoon",defaultMessage:"Ending soon"}):"today"===t?(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.endsToday",defaultMessage:"Ends today"}):"tomorrow"===t?(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.endsTomorrow",defaultMessage:"Ends tomorrow"}):(0,je.jsx)(c.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.daysRemaining",defaultMessage:"Ends in {daysRemaining} days",values:{daysRemaining:t}})}const St=function(e){var t;window.__c={n:"SprintDetailsOrCompleteSprintButton"};const{collectionContextStore:o}=e,n=(0,i.VK)((()=>r.default.checkGate("recurring_sprints")),[]),s=(0,i.VK)((()=>o.getCompleteSprintButtonContext.state),[o]),l=(0,i.VK)((()=>{var e;return null==s||null===(e=s.automationContext)||void 0===e?void 0:e.automationStore.getStatus()}),[null==s||null===(t=s.automationContext)||void 0===t?void 0:t.automationStore]);return s?n&&"active"===l?(0,je.jsx)(gt,{collectionContextStore:o,sprintAutomationContext:s}):(0,je.jsx)(pt,{collectionContextStore:o,completeSprintAutomationContext:s}):null}},57145:(e,t,o)=>{o.d(t,{_:()=>r});var n=o(67294);const i=new Map;function r(e){const t=!i.get(e),o=(0,n.useRef)(t);return o.current&&i.set(e,!0),(0,n.useEffect)((()=>()=>{o.current&&i.set(e,!1)}),[e]),o.current}},12205:(e,t,o)=>{o.d(t,{J:()=>r});var n=o(86628),i=o(80444);function r(){const{currentSpaceStore:e}=(0,n.Kw)(i.default);return(0,n.VK)((()=>(null==e?void 0:e.canAdmin())??!1),[e])}},5933:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(49085);class i extends n.default{getInitialState(){return!1}}const r=new i},67695:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(35431);class i extends n.Z{findTableHeaderCell(e,t){return this.find((o=>o.collectionContextStore===e&&o.property===t))}}const r=new i},29109:(e,t,o)=>{o.d(t,{d:()=>i});var n=o(84939);function i(e,t){const{r:o,g:i,b:r}=(null==e?void 0:e.info.accent_color)||{r:0,g:0,b:0},s=`rgba(${o},${i},${r},${"dark"===t?.6:1})`;return{background:s,hoveredBackground:(0,n._j)(s,.4),pressedBackground:(0,n._j)(s,.9)}}}}]);